{"meta":{"title":"æœç€ç‰›é€¼çš„é“è·¯ä¸€è·¯ç‹‚å¥”","subtitle":null,"description":null,"author":"æ®µçºªåˆš","url":"https://jigangduan.github.io","root":"/"},"pages":[],"posts":[{"title":"å‘¨è‚²å¦‚ K.K éŸ³æ¨™è‹±æ–‡æ•™å­¸ (è‡ªç„¶ç™¼éŸ³)","slug":"prefix_2135de493ff217a4f8bee2d4752741ba","date":"2020-02-11T02:14:19.000Z","updated":"2020-07-25T03:25:32.149Z","comments":true,"path":"2020/02/11/prefix_2135de493ff217a4f8bee2d4752741ba/","link":"","permalink":"https://jigangduan.github.io/2020/02/11/prefix_2135de493ff217a4f8bee2d4752741ba/","excerpt":"","text":"è§†é¢‘åœ°å€ aã€Ã¦ã€‘å“ ä¸æŠŠÄ«éŸ³è¯»å‡ºbã€bã€‘ä¸ æµŠéŸ³ä¸å‘Ã¹cã€kã€‘å…‹ è½»éŸ³ä¸å‘Ã¨dã€dã€‘å¾— æµŠéŸ³ä¸å‘Ã©eã€eã€‘å“ ä¸æŠŠÄ«éŸ³è¯»å‡ºæ¥fã€fã€‘ç¦ è½»éŸ³ä¸å‘Ãºgã€gã€‘å„ æµŠéŸ³ä¸å‘Ã¨hã€hã€‘å– è½»éŸ³ä¸è¯»Ä“iã€Iã€‘å“ æ€¥ä¿ƒåœ°å‘å£°jã€dÊ’ã€‘å§¬ æµŠéŸ³ä¸å‘Ä«(æ’…)kã€kã€‘å…‹ è½»éŸ³ä¸å‘Ã¨lã€lã€‘å‰é¢(å˜å˜) åé¢(å‡¹å‡¹)mã€mã€‘å‰é¢(ä¹ˆä¹ˆ) åé¢(å—¯å—¯é—­å˜´)nã€nã€‘å‰é¢(è®·è®·) åé¢(å—¯å—¯å¼ å˜´)oã€a:ã€‘å•Š å˜´é•¿åˆ°æœ€å¤§pã€pã€‘æ™® è½»éŸ³ä¸å‘Ä«qã€kwã€‘é˜”rã€rã€‘å‰é¢ï¼šè•Š æµŠéŸ³ ä¸å‘uÇ(å¼±) åé¢ï¼šè€³è€³sã€sã€‘ä¸ è½»éŸ³ä¸å‘Ä«tã€tã€‘ç‰¹ è½»éŸ³ä¸å‘Ã¨uã€ÊŒã€‘ é˜¿ å˜´å¾®å¾®å¼ å¼€vã€vã€‘å‘œ æµŠéŸ³ä¸å‘Ãºwã€wã€‘æˆ‘ æµŠéŸ³ä¸å‘Ç’xã€ksã€‘å…‹syã€jã€‘å‘€ æµŠéŸ³ä¸å‘Ç(çˆ·)zã€zã€‘å°±æ˜¯/s/çš„æµŠéŸ³ é™¤äº†aeiou æ¯éŸ³ = å…ƒéŸ³ æœ‰å˜åŒ–ã€‚ï¼ˆæ¯éŸ³å…ˆç©ºç€å†è‡ªè¡Œåˆ¤æ–­å‘éŸ³ï¼‰å‰©ä¸‹éƒ½æ˜¯ å­—éŸ³ = è¾…éŸ³ æ²¡æœ‰å˜åŒ–ã€‚ï¼ˆå­—éŸ³éƒ¨åˆ†å…ˆç…§æŠ„ï¼‰ ç¢°åˆ°ç¬¬ä¸€ä¸ªé‡éŸ³èŠ‚è‡ªè¡Œåˆ¤æ–­å‘éŸ³ï¼Œç¢°åˆ°ç¬¬äºŒä¸ª ä¸å†æ˜¯é‡éŸ³èŠ‚ï¼Œä¸å†é‡éŸ³çš„æ—¶å€™ aeiouç»å¤§å¤šæ•°éƒ½å¿µ aé¢ã€‚ eåœ¨å°¾å·´æ—¶ä¸å‘éŸ³å‰é¢å°±å‘æœ¬èº«çš„éŸ³ AEIOUç¢°åˆ°Rç¬¬ä¸€æ¬¡å‘ äºŒï¼ˆå·èˆŒæ‹–é•¿éŸ³ï¼‰ ç¬¬äºŒæ¬¡ç¢°åˆ°å‘ é¢ï¼ˆçŸ­éŸ³ï¼‰ ä¸¤ä¸ªOOç›¸è¿ æœ€å¤§å‡ ç‡å¿µã€”Uåˆã€• ç¬¬äºŒå‡ ç‡å¿µã€”ué›¾ã€• au ou aw ow ç›¸è¿ å¸¸å¸¸å¿µã€”aUå—·~ã€• æ­»è®°ç¡¬èƒŒä»¥ä¸‹ â†“ th ç›¸è¿ ç¬¬ä¸€ä¸ªä¸Šé—¨ç‰™è½»è½»å’¬ä½èˆŒå°– æ— éŸ³çš„ï¼ˆæœ‰ç‚¹é€æ°”éŸ³ æ–¯~ï¼‰ï¼Œç¬¬äºŒä¸ªä¸Šé—¨ç‰™è½»è½»å’¬ä½èˆŒå°–å¿µ å­~ chç›¸è¿ å–~ shç›¸è¿ å˜˜~ phç›¸è¿ ç¬¦~ ngç›¸è¿ åœ¨å°¾å·´æ—¶å¸¸å¸¸å¿µ å—¯~ æœ‰æ—¶å€™å¿µ å—¯å‰²~ nkç›¸è¿ å—¯å…‹~","categories":[{"name":"K.K éŸ³æ¨™","slug":"K-K-éŸ³æ¨™","permalink":"https://jigangduan.github.io/categories/K-K-éŸ³æ¨™/"},{"name":"è‹±è¯­","slug":"K-K-éŸ³æ¨™/è‹±è¯­","permalink":"https://jigangduan.github.io/categories/K-K-éŸ³æ¨™/è‹±è¯­/"}],"tags":[{"name":"K.K éŸ³æ¨™","slug":"K-K-éŸ³æ¨™","permalink":"https://jigangduan.github.io/tags/K-K-éŸ³æ¨™/"}]},{"title":"SQLè¯­å¥ - INSERT æ’å…¥è¡Œ","slug":"prefix_7dca6963ecbd1930c3060e682f98a4c4","date":"2020-01-17T03:47:10.000Z","updated":"2020-07-25T03:24:20.323Z","comments":true,"path":"2020/01/17/prefix_7dca6963ecbd1930c3060e682f98a4c4/","link":"","permalink":"https://jigangduan.github.io/2020/01/17/prefix_7dca6963ecbd1930c3060e682f98a4c4/","excerpt":"","text":"æ’å…¥è¯­å¥12345# ä½¿ç”¨æ‰€æœ‰åˆ—çš„å€¼æ’å…¥è¯­å¥INSERT INTO mytableVALUES (value_or_expr, another_value_or_expr, â€¦), (value_or_expr_2, another_value_or_expr_2, â€¦), â€¦; 123456# æ’å…¥å…·æœ‰ç‰¹å®šåˆ—çš„è¯­å¥INSERT INTO mytable(column, another_column, â€¦)VALUES (value_or_expr, another_value_or_expr, â€¦), (value_or_expr_2, another_value_or_expr_2, â€¦), â€¦; ä¾‹å­1234# å¸¦è¡¨è¾¾å¼çš„ç¤ºä¾‹æ’å…¥è¯­å¥INSERT INTO boxoffice(movie_id, rating, sales_in_millions)VALUES (1, 9.9, 283742034 / 1000000);","categories":[{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/categories/SQL/"},{"name":"SQLè¯­å¥","slug":"SQL/SQLè¯­å¥","permalink":"https://jigangduan.github.io/categories/SQL/SQLè¯­å¥/"}],"tags":[{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/tags/SQL/"}]},{"title":"SQLè¯­å¥ - CREATE åˆ›å»ºè¡¨","slug":"prefix_45dbc5c48467fcc6ae6a50af83ada169","date":"2020-01-17T02:14:19.000Z","updated":"2020-07-25T03:24:06.993Z","comments":true,"path":"2020/01/17/prefix_45dbc5c48467fcc6ae6a50af83ada169/","link":"","permalink":"https://jigangduan.github.io/2020/01/17/prefix_45dbc5c48467fcc6ae6a50af83ada169/","excerpt":"","text":"CREATE TABLE è¯­å¥åˆ›å»ºæ–°çš„æ•°æ®åº“è¡¨ 123456# åˆ›å»ºå¸¦æœ‰å¯é€‰è¡¨çº¦æŸå’Œé»˜è®¤å€¼çš„è¡¨è¯­å¥CREATE TABLE IF NOT EXISTS mytable ( column DataType TableConstraint DEFAULT default_value, another_column DataType TableConstraint DEFAULT default_value, â€¦); å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„è¡¨ï¼Œåˆ™SQLå®ç°é€šå¸¸ä¼šå¼•å‘é”™è¯¯ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è¯¥IF NOT EXISTSå­å¥æ¥æŠ‘åˆ¶è¯¥é”™è¯¯å¹¶è·³è¿‡åˆ›å»ºè¡¨çš„æ“ä½œï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ è¡¨æ•°æ®ç±»å‹ æ•°æ®ç±»å‹ æè¿° INTEGER , BOOLEAN INTEGERç±»å‹å¯ä»¥å­˜å‚¨æ•´ä¸ªæ•´æ•°å€¼ï¼Œä¾‹å¦‚æ•°å­—æˆ–å¹´é¾„ã€‚åœ¨æŸäº›å®ç°ä¸­ï¼ŒBOOLEANä»…è¡¨ç¤ºä¸ºä»…0æˆ–1çš„æ•´æ•°å€¼ã€‚ FLOATï¼ŒDOUBLEï¼ŒREAL æµ®ç‚¹æ•°æ® ç±»å‹å¯ä»¥å­˜å‚¨æ›´ç²¾ç¡®çš„æ•°å­—æ•°æ®ï¼Œä¾‹å¦‚æµ‹é‡å€¼æˆ–åˆ†æ•°å€¼ã€‚æ ¹æ®è¯¥å€¼æ‰€éœ€çš„æµ®ç‚¹ç²¾åº¦ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç±»å‹ã€‚ CHARACTER(num_chars)ï¼ŒVARCHAR(num_chars)ï¼ŒTEXT åŸºäºæ–‡æœ¬çš„æ•°æ®ç±»å‹å¯ä»¥åœ¨å„ç§è¯­è¨€ç¯å¢ƒä¸­å­˜å‚¨å­—ç¬¦ä¸²å’Œæ–‡æœ¬ã€‚åœ¨ä½¿ç”¨è¿™äº›åˆ—æ—¶ï¼Œå„ç§ç±»å‹ä¹‹é—´çš„åŒºåˆ«é€šå¸¸ç­‰äºåº•å±‚æ•°æ®åº“çš„æ•ˆç‡ã€‚ CHARACTERå’ŒVARCHAR(å¯å˜å­—ç¬¦)ç±»å‹å‡æŒ‡å®šäº†å®ƒä»¬å¯ä»¥å­˜å‚¨çš„æœ€å¤§å­—ç¬¦æ•°ï¼ˆè¾ƒé•¿çš„å€¼å¯èƒ½ä¼šè¢«æˆªæ–­ï¼‰ï¼Œå› æ­¤å¯ä»¥æ›´æœ‰æ•ˆåœ°å­˜å‚¨å’ŒæŸ¥è¯¢å¤§è¡¨ã€‚ DATEï¼Œ DATETIME SQLè¿˜å¯ä»¥å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´æˆ³ï¼Œä»¥è·Ÿè¸ªæ—¶é—´åºåˆ—å’Œäº‹ä»¶æ•°æ®ã€‚å®ƒä»¬å¯èƒ½å¾ˆéš¾å¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨è·¨æ—¶åŒºå¤„ç†æ•°æ®æ—¶ã€‚ BLOB æœ€åï¼ŒSQLå¯ä»¥å°†äºŒè¿›åˆ¶æ•°æ®ç›´æ¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„blobä¸­ã€‚è¿™äº›å€¼å¯¹äºæ•°æ®åº“é€šå¸¸æ˜¯ä¸é€æ˜çš„ï¼Œå› æ­¤é€šå¸¸å¿…é¡»å°†å®ƒä»¬ä¸æ­£ç¡®çš„å…ƒæ•°æ®ä¸€èµ·å­˜å‚¨æ‰èƒ½é‡æ–°æŸ¥è¯¢å®ƒä»¬ æ–‡ä»¶ï¼š MySQLï¼Œ Postgresï¼Œ SQLiteï¼Œ Microsoft SQL Server è¡¨çº¦æŸ çº¦æŸ æè¿° PRIMARY KEY ä¸»é”®ï¼Œè¿™æ„å‘³ç€è¯¥åˆ—ä¸­çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ¯ä¸ªå€¼éƒ½å¯ç”¨äºæ ‡è¯†è¯¥è¡¨ä¸­çš„å•ä¸ªè¡Œã€‚ AUTOINCREMENT å¯¹äºæ•´æ•°å€¼ï¼Œè¿™æ„å‘³ç€è¯¥å€¼å°†è‡ªåŠ¨å¡«å……ï¼Œå¹¶éš æ¯æ¬¡è¡Œæ’å…¥è€Œå¢åŠ ã€‚å¹¶éæ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒã€‚ UNIQUE è¿™æ„å‘³ç€æ­¤åˆ—ä¸­çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤æ‚¨ä¸èƒ½åœ¨æ­¤åˆ—ä¸­æ’å…¥ä¸è¡¨ä¸­çš„å¦ä¸€è¡Œå…·æœ‰ç›¸åŒå€¼çš„å¦ä¸€è¡Œã€‚ä¸â€œ PRIMARY KEYâ€ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸å¿…æ˜¯è¡¨ä¸­ä¸€è¡Œçš„é”®ã€‚ NOT NULL è¿™æ„å‘³ç€æ’å…¥çš„å€¼ä¸èƒ½ä¸ºâ€œ NULLâ€ã€‚ CHECK (expression) è¿™ä½¿æ‚¨å¯ä»¥è¿è¡Œæ›´å¤æ‚çš„è¡¨è¾¾å¼æ¥æµ‹è¯•æ’å…¥çš„å€¼æ˜¯å¦æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥å€¼æ˜¯æ­£æ•°è¿˜æ˜¯å¤§äºç‰¹å®šå¤§å°ï¼Œæˆ–è€…ä»¥ç‰¹å®šå‰ç¼€å¼€å¤´ç­‰ç­‰ã€‚ FOREIGN KEY å¤–é”®ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¯ç¡®ä¿æ­¤åˆ—ä¸­çš„æ¯ä¸ªå€¼éƒ½ä¸å¦ä¸€ä¸ªè¡¨ä¸­åˆ—ä¸­çš„å¦ä¸€ä¸ªå€¼ç›¸å¯¹åº”ã€‚ ä¾‹å­12345678# ç”µå½±è¡¨æ¶æ„CREATE TABLE movies ( id INTEGER PRIMARY KEY, title TEXT, director TEXT, year INTEGER, length_minutes INTEGER);","categories":[{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/categories/SQL/"},{"name":"SQLè¯­å¥","slug":"SQL/SQLè¯­å¥","permalink":"https://jigangduan.github.io/categories/SQL/SQLè¯­å¥/"}],"tags":[{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/tags/SQL/"}]},{"title":"SQLè¯­å¥ - SELECTçš„æ‰§è¡Œé¡ºåº","slug":"prefix_a6d5748b732dc69356c9aeed82b9a5b4","date":"2020-01-16T03:47:10.000Z","updated":"2020-07-25T03:27:07.043Z","comments":true,"path":"2020/01/16/prefix_a6d5748b732dc69356c9aeed82b9a5b4/","link":"","permalink":"https://jigangduan.github.io/2020/01/16/prefix_a6d5748b732dc69356c9aeed82b9a5b4/","excerpt":"","text":"å®ŒæˆSELECTæŸ¥è¯¢ 123456789SELECT DISTINCT column, AGG_FUNC(column_or_expression), â€¦FROM mytable JOIN another_table ON mytable.column = another_table.column WHERE constraint_expression GROUP BY column HAVING constraint_expression ORDER BY column ASC/DESC LIMIT count OFFSET COUNT; æ¯ä¸ªæŸ¥è¯¢éƒ½ä»åœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°æˆ‘ä»¬æ‰€éœ€çš„æ•°æ®å¼€å§‹ï¼Œç„¶åå°†è¿™äº›æ•°æ®è¿‡æ»¤æˆå¯ä»¥å°½å¿«å¤„ç†å’Œç†è§£çš„å†…å®¹ã€‚ç”±äºæŸ¥è¯¢çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œå› æ­¤äº†è§£æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ï¼Œè¿™æ ·æ‚¨æ‰èƒ½çŸ¥é“åœ¨ä½•å¤„å¯ä»¥è®¿é—®å“ªäº›ç»“æœ. æŸ¥è¯¢æ‰§è¡Œé¡ºåº FROMå’ŒJOINsé¦–å…ˆæ‰§è¡Œè¯¥FROMå­å¥å’ŒéšåJOINçš„ï¼Œä»¥ç¡®å®šè¦æŸ¥è¯¢çš„æ•°æ®çš„æ€»å·¥ä½œé›†ã€‚è¿™åŒ…æ‹¬æ­¤å­å¥ä¸­çš„å­æŸ¥è¯¢ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´åœ¨åŒ…å«è¦è¿æ¥çš„è¡¨çš„æ‰€æœ‰åˆ—å’Œè¡Œçš„åå°åˆ›å»ºä¸´æ—¶è¡¨ã€‚ WHEREä¸€æ—¦æœ‰äº†å…¨éƒ¨å·¥ä½œæ•°æ®é›†ï¼Œé¦–å…ˆé€šè¿‡WHEREçº¦æŸåº”ç”¨äºå„ä¸ªè¡Œï¼Œè€Œä¸æ»¡è¶³çº¦æŸçš„è¡Œå°†è¢«ä¸¢å¼ƒã€‚æ¯ä¸ªçº¦æŸåªèƒ½ç›´æ¥ä»FROMå­å¥ä¸­è¯·æ±‚çš„è¡¨ä¸­è®¿é—®åˆ—ã€‚SELECTæŸ¥è¯¢éƒ¨åˆ†ä¸­çš„åˆ«ååœ¨ å¤§å¤šæ•°æ•°æ®åº“ä¸­ä¸å¯è®¿é—®ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å«ä¾èµ–äºå°šæœªæ‰§è¡Œçš„æŸ¥è¯¢éƒ¨åˆ†çš„è¡¨è¾¾å¼ã€‚ GROUP BYWHEREåï¼Œæ ¹æ®GROUP BYå­å¥ä¸­æŒ‡å®šåˆ—ä¸­çš„å…¬å…±å€¼ï¼Œå°†åº”ç”¨çº¦æŸåçš„å…¶ä½™è¡Œåˆ†ç»„ã€‚åˆ†ç»„çš„ç»“æœæ˜¯ï¼Œè¯¥åˆ—ä¸­çš„è¡Œæ•°ä¸å”¯ä¸€å€¼çš„æ•°ç›®ä¸€æ ·å¤šã€‚éšå¼åœ°ï¼Œè¿™æ„å‘³ç€ä»…åœ¨æŸ¥è¯¢ä¸­å…·æœ‰èšåˆå‡½æ•°æ—¶æ‰éœ€è¦ä½¿ç”¨æ­¤å‡½æ•°ã€‚ HAVINGå¦‚æœæŸ¥è¯¢ä¸­æœ‰ä¸€ä¸ªGROUP BYå­å¥ï¼Œåˆ™è¯¥HAVINGå­å¥ä¸­çš„çº¦æŸå°†åº”ç”¨äºå·²åˆ†ç»„çš„è¡Œï¼Œä¸¢å¼ƒä¸æ»¡è¶³çº¦æŸçš„å·²åˆ†ç»„çš„è¡Œã€‚åƒè¯¥WHEREå­å¥ä¸€æ ·ï¼Œå¤§å¤šæ•°æ•°æ®åº“ä¸­çš„æ­¤æ­¥éª¤ä¹Ÿæ— æ³•è®¿é—®åˆ«åã€‚ SELECTSELECTæœ€åï¼ŒæŸ¥è¯¢éƒ¨åˆ†ä¸­çš„æ‰€æœ‰è¡¨è¾¾å¼éƒ½ä¼šè¢«è®¡ç®—ã€‚ DISTINCTåœ¨å…¶ä½™çš„è¡Œä¸­ï¼Œå°†åˆ é™¤åˆ—ä¸­æ ‡è®°ä¸ºçš„é‡å¤å€¼çš„è¡ŒDISTINCTã€‚ ORDER BYå¦‚æœORDER BYå­å¥æŒ‡å®šäº†é¡ºåºï¼Œåˆ™å°†æŒ‰æŒ‡å®šçš„æ•°æ®ä»¥å‡åºæˆ–é™åºå¯¹è¡Œè¿›è¡Œæ’åºã€‚ç”±äºSELECTæŸ¥è¯¢éƒ¨åˆ†ä¸­çš„æ‰€æœ‰è¡¨è¾¾å¼å‡å·²è®¡ç®—ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨æ­¤å­å¥ä¸­å¼•ç”¨åˆ«åã€‚ LIMIT/OFFSETæœ€åï¼Œè½å…¥ç”±æ‰€æŒ‡å®šçš„èŒƒå›´ä¹‹å¤–çš„è¡ŒLIMITå’ŒOFFSETä»æŸ¥è¯¢è¿”å›çš„è¢«ä¸¢å¼ƒï¼Œåœ¨ç¦»å¼€æœ€åè¡Œçš„é›†åˆã€‚","categories":[{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/categories/SQL/"},{"name":"SQLè¯­å¥","slug":"SQL/SQLè¯­å¥","permalink":"https://jigangduan.github.io/categories/SQL/SQLè¯­å¥/"}],"tags":[{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/tags/SQL/"}]},{"title":"Git é¡¹ç›®æ¨è","slug":"prefix_4e0e07cc7827bfe7c7b4453215aa54ef","date":"2020-01-15T07:47:10.000Z","updated":"2020-07-25T03:18:04.273Z","comments":true,"path":"2020/01/15/prefix_4e0e07cc7827bfe7c7b4453215aa54ef/","link":"","permalink":"https://jigangduan.github.io/2020/01/15/prefix_4e0e07cc7827bfe7c7b4453215aa54ef/","excerpt":"","text":"Javaæ±‡æ€»javaç”Ÿæ€åœˆ æ±‡æ€»javaç”Ÿæ€åœˆå¸¸ç”¨æŠ€æœ¯æ¡†æ¶ã€å¼€æºä¸­é—´ä»¶ï¼Œç³»ç»Ÿæ¶æ„ã€æ•°æ®åº“ã€å¤§å…¬å¸æ¶æ„æ¡ˆä¾‹ã€å¸¸ç”¨ä¸‰æ–¹ç±»åº“ã€é¡¹ç›®ç®¡ç†ã€çº¿ä¸Šé—®é¢˜æ’æŸ¥ã€ä¸ªäººæˆé•¿ã€æ€è€ƒç­‰çŸ¥è¯† Golangthe-way-to-goæ ‡å‡†Goé¡¹ç›®ç»“æ„Go è¯­è¨€çš„ goroutine æ± kotlinKotlinå®æˆ˜(Kotlin in action) QtQMLQLMBookQmlBook-In-Chinese å¯è§†åŒ–åŠ¨æ€å¯è§†åŒ– flourish æ•™ç¨‹ æ–‡æ¡£ä¸€è¡Œä»£ç ï¼šä½ çš„çº¯æ–‡æœ¬ç§’å˜Markdown : markdeepandroidæŠ“åŒ…ç²¾çµMySQLåœ¨çº¿ç»ƒä¹ MySQLsqlzooYearning SQLå®¡æ ¸å¹³å°bilibili è§†é¢‘å¯ç”¨ å®˜ç½‘ è¯­è¨€ï¼š Golang åŠŸèƒ½: SQLæŸ¥è¯¢ æŸ¥è¯¢å·¥å• å¯¼å‡º è‡ªåŠ¨è¡¥å…¨ï¼Œæ™ºèƒ½æç¤º æŸ¥è¯¢è¯­å¥å®¡è®¡ SQLå®¡æ ¸ æµç¨‹åŒ–å·¥å• SQLè¯­å¥æ£€æµ‹ä¸æ‰§è¡Œ SQLå›æ»š å†å²å®¡æ ¸è®°å½• æ¨é€ E-mailå·¥å•æ¨é€ é’‰é’‰webhookæœºå™¨äººå·¥å•æ¨é€ ç”¨æˆ·æƒé™åŠç®¡ç† è§’è‰²åˆ’åˆ† åŸºäºç”¨æˆ·çš„ç»†ç²’åº¦æƒé™ æ³¨å†Œ å…¶ä»– todoList LDAPç™»å½• åŠ¨æ€å®¡æ ¸è§„åˆ™é…ç½® AutoTaskè‡ªåŠ¨æ‰§è¡Œ åšå®¢mtianyanâ€™s blog","categories":[{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://jigangduan.github.io/categories/ç¬”è®°/"},{"name":"æ¨è","slug":"ç¬”è®°/æ¨è","permalink":"https://jigangduan.github.io/categories/ç¬”è®°/æ¨è/"}],"tags":[{"name":"æ¨è","slug":"æ¨è","permalink":"https://jigangduan.github.io/tags/æ¨è/"}]},{"title":"Python è™šæ‹Ÿç¯å¢ƒ virtualenvwrapper","slug":"prefix_cc4fe649cad80b981be6647f61f06695","date":"2020-01-15T03:47:10.000Z","updated":"2020-07-25T03:29:02.991Z","comments":true,"path":"2020/01/15/prefix_cc4fe649cad80b981be6647f61f06695/","link":"","permalink":"https://jigangduan.github.io/2020/01/15/prefix_cc4fe649cad80b981be6647f61f06695/","excerpt":"","text":"å®‰è£…12pip3 install virtualenvwrappermkdir ~/.virtualenvs æŸ¥æ‰¾virtualenvwrapper.sh1which virtualenvwrapper.sh é…ç½®æ–‡ä»¶~/.bash_profile : 12345678export WORKON_HOME=$HOME/.virtualenvsexport PROJECT_HOME=$DEV_PATH/workspaceexport VIRTUALENVWRAPPER_SCRIPT=/usr/local/bin/virtualenvwrapper.shexport VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python3export VIRTUALENVWRAPPER_VIRTUALENV=/usr/local/bin/virtualenvexport VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'source /usr/local/bin/virtualenvwrapper.sh è¯·å¯¹åº”çœŸå®è·¯å¾„ ä½¿ç”¨123456789101112$ mkvirtualenv test --python=python3$ lsvirtualenvtest====workon test## é€€å‡ºç¯å¢ƒtestdeactivate## åˆ é™¤ç¯å¢ƒtestrmvirtualenv test å…¶å®ƒ123pip freeze &gt; requirements.txtpip install -r requirements.txt","categories":[{"name":"è™šæ‹Ÿç¯å¢ƒ","slug":"è™šæ‹Ÿç¯å¢ƒ","permalink":"https://jigangduan.github.io/categories/è™šæ‹Ÿç¯å¢ƒ/"},{"name":"Python","slug":"è™šæ‹Ÿç¯å¢ƒ/Python","permalink":"https://jigangduan.github.io/categories/è™šæ‹Ÿç¯å¢ƒ/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"}]},{"title":"Node.js Web ä»‹ç»","slug":"node-web","date":"2019-10-23T07:12:30.000Z","updated":"2020-07-25T02:57:18.223Z","comments":true,"path":"2019/10/23/node-web/","link":"","permalink":"https://jigangduan.github.io/2019/10/23/node-web/","excerpt":"","text":"Node.jsNode.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚ Node.js ä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I/O çš„æ¨¡å‹ã€‚1 Node.jsä½œè€…è®¤ä¸º WebæœåŠ¡å™¨çš„å‡ ä¸ªè¦ç‚¹: äº‹ä»¶é©±åŠ¨ éé˜»å¡I/O ç‰¹æ€§JavaScriptå¯¹æ¯”å…¶å®ƒè¯­è¨€ï¼Œé€‰æ‹©JavaScriptçš„åŸå› ï¼š å¯¹æ¯”è¯­è¨€ï¼š Cçš„å¼€å‘é—¨æ§›é«˜ï¼Œä¸šåŠ¡å¼€å‘å›°éš¾ Haskellå¤ªè¿‡å¤æ‚ Luaæœ¬èº«æœ‰å¾ˆå¤šé˜»å¡IOåº“ Rubyè™šæ‹Ÿæœºæ€§èƒ½ä¸å¥½ JavaScriptçš„ä¼˜åŠ¿ï¼š å¼€å‘é—¨æ§›ä½ æ²¡æœ‰é˜»å¡IOåº“çš„å†å²åŒ…è¢± JavaScriptåœ¨æµè§ˆå™¨å¹¿æ³›ä½¿ç”¨äº‹ä»¶é©±åŠ¨ V8çš„æ€§èƒ½ä¼˜åŠ¿ å¼‚æ­¥I/OIOå¯†é›†å‹ ç¼–ç¨‹æ¨¡å¼çš„å‘å±•ï¼š è¿›ç¨‹ â€”â€”&gt; çº¿ç¨‹ â€”â€”&gt; å¼‚æ­¥ â€”â€”&gt; åç¨‹ å¼‚æ­¥I/Oçš„ä¼˜åŠ¿ï¼š ç”¨æˆ·ä½“éªŒ èµ„æºåˆ†é… é˜»å¡ä¸éé˜»å¡ é˜»å¡IOçš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ è°ƒç”¨ä¹‹åä¸€å®šè¦ç­‰å¾… ç³»ç»Ÿå†…æ ¸å±‚é¢å®Œæˆæ“ä½œåï¼Œè°ƒç”¨æ‰ç»“æŸ éé˜»å¡IO è°ƒç”¨åä¼šç«‹å³è¿”å› éé˜»å¡çš„é—®é¢˜ï¼š å¦‚ä½•ç¡®å®šI/Oæ“ä½œæ˜¯å¦å®Œæˆ â€”â€” è½®è¯¢ 8 å¾ªç¯read: é€šè¿‡é‡å¤è°ƒç”¨æ¥ æŸ¥è¯¢I/OçŠ¶æ€ã€‚æœ€åŸå§‹ï¼Œæ€§èƒ½æœ€ä½ select I/Oå¤šè·¯å¤ç”¨ï¼Œé€šè¿‡æŠŠå¤šä¸ªI/Oçš„é˜»å¡å¤ç”¨åˆ°åŒä¸€ä¸ªselectçš„é˜»å¡ä¸Š é€šè¿‡å¯¹æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶çŠ¶æ€æ¥è¿›è¡Œåˆ¤æ–­ å­˜å‚¨çŠ¶æ€é‡‡ç”¨1024é•¿åº¦çš„æ•°ç»„ï¼Œé™åˆ¶äº†åŒæ—¶æ£€æŸ¥çš„æ•°é‡ poll å¯¹selectçš„æ”¹è¿› é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼é¿å…æ•°ç»„é•¿åº¦çš„é™åˆ¶ epoll åŸºäºäº‹ä»¶é©±åŠ¨çš„I/Oæ–¹å¼ å°†ç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ ç”¨æˆ·çº¿ç¨‹è°ƒç”¨åè¿›å…¥ç¡çœ çŠ¶æ€ æ•°æ®å‡†å¤‡å¥½åå†…æ ¸å”¤é†’ï¼Œç„¶ååªè¦éå†Readyé˜Ÿåˆ—çš„æè¿°ç¬¦é›†åˆ çº¢é»‘æ ‘å­˜å‚¨ AIOï¼ˆå¼‚æ­¥I/Oæ–¹å¼ï¼‰ é€šè¿‡ä¿¡å·æˆ–å›è°ƒä¼ é€’æ•°æ® æœ‰ç³»ç»Ÿå®ç°ä¸Šçš„ç¼ºé™·ï¼Œæ— æ³•åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ çº¿ç¨‹æ± æ¨¡æ‹Ÿå¼‚æ­¥I/O ç¬¬ä¸‰æ–¹å®ç° glibc libeio: é‡‡ç”¨çº¿ç¨‹æ± ä¸é˜»å¡I/Oæ¨¡æ‹Ÿå¼‚æ­¥I/O (node v0.9.3ä¹‹å‰é‡‡ç”¨æ–¹å¼) node è‡ªå®ç°äº†çº¿ç¨‹æ± å¼‚æ­¥I/O Windowsçš„IOCPï¼š å¼‚æ­¥æ–¹æ³•ï¼Œç­‰å¾…I/Oå®Œæˆåé€šçŸ¥ï¼Œæ‰§è¡Œå›è°ƒï¼Œç”¨æˆ·æ— éœ€è½®è¯¢ï¼Œçº¿ç¨‹æ± ç”±ç³»ç»Ÿå†…æ ¸ç®¡ç† libuv: å°è£…äº†Windows å’Œ *nix å·®å¼‚ï¼Œæä¾›æŠ½è±¡å±‚ äº‹ä»¶é©±åŠ¨Node è‡ªèº«çš„æ‰§è¡Œæ¨¡å‹ â€”â€” äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰äº‹ä»¶é©±åŠ¨çš„å®è´¨ï¼šé€šè¿‡ä¸»å¾ªç¯ï¼ˆEvent Loopï¼‰åŠ äº‹ä»¶è§¦å‘çš„æ–¹å¼æ¥è¿è¡Œç¨‹åº nodeè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç±»ä¼¼äº while(true) çš„å¾ªç¯ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“çš„è¿‡ç¨‹ ç§°ä¸ºTick.æ¯ä¸ªTickçš„è¿‡ç¨‹å°±æ˜¯æŸ¥çœ‹æ˜¯å¦æœ‰äº‹ä»¶å¾…å¤„ç†ï¼Œå¦‚æœæœ‰ï¼Œå°±å–å‡ºäº‹ä»¶çš„å›è°ƒå‡½æ•° æ‰§è¡Œï¼›ç„¶åè¿›å…¥ä¸‹æ¬¡å¾ªç¯ã€‚ Node.js çš„è¿è¡Œæœºåˆ¶å¦‚ä¸‹: V8 å¼•æ“è§£æ JavaScript è„šæœ¬ã€‚ è§£æåçš„ä»£ç ï¼Œè°ƒç”¨ Node APIã€‚ libuv åº“è´Ÿè´£ Node API çš„æ‰§è¡Œã€‚å®ƒå°†ä¸åŒçš„ä»»åŠ¡åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹ï¼Œå½¢æˆä¸€ä¸ª Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ï¼Œä»¥å¼‚æ­¥çš„æ–¹å¼å°†ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿”å›ç»™ V8 å¼•æ“ã€‚ V8 å¼•æ“å†å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ libuvå¼•æ“ä¸­çš„äº‹ä»¶å¾ªç¯åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼š Node çš„ Event Loop åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œã€‚æ¯å½“è¿›å…¥æŸä¸€ä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œéƒ½ä¼šä»å¯¹åº”çš„å›è°ƒé˜Ÿåˆ—ä¸­å–å‡ºå‡½æ•°å»æ‰§è¡Œã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ•°é‡åˆ°è¾¾ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚ timertimers é˜¶æ®µä¼šæ‰§è¡Œ setTimeout å’Œ setInterval å›è°ƒï¼Œå¹¶ä¸”æ˜¯ç”± poll é˜¶æ®µæ§åˆ¶çš„ã€‚åŒæ ·ï¼Œåœ¨ Node ä¸­å®šæ—¶å™¨æŒ‡å®šçš„æ—¶é—´ä¹Ÿä¸æ˜¯å‡†ç¡®æ—¶é—´ï¼Œåªèƒ½æ˜¯å°½å¿«æ‰§è¡Œã€‚ I/OI/O é˜¶æ®µä¼šå¤„ç†ä¸€äº›ä¸Šä¸€è½®å¾ªç¯ä¸­çš„å°‘æ•°æœªæ‰§è¡Œçš„ I/O å›è°ƒ idle, prepareidle, prepare é˜¶æ®µå†…éƒ¨å®ç° pollpoll æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é˜¶æ®µï¼Œè¿™ä¸€é˜¶æ®µä¸­ï¼Œç³»ç»Ÿä¼šåšä¸¤ä»¶äº‹æƒ… å›åˆ° timer é˜¶æ®µæ‰§è¡Œå›è°ƒ æ‰§è¡Œ I/O å›è°ƒå¹¶ä¸”åœ¨è¿›å…¥è¯¥é˜¶æ®µæ—¶å¦‚æœæ²¡æœ‰è®¾å®šäº† timer çš„è¯ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹ä¸¤ä»¶äº‹æƒ… å¦‚æœ poll é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…è¾¾åˆ°ç³»ç»Ÿé™åˆ¶ å¦‚æœ poll é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¼šæœ‰ä¸¤ä»¶äº‹å‘ç”Ÿ å¦‚æœæœ‰ setImmediate å›è°ƒéœ€è¦æ‰§è¡Œï¼Œpoll é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”è¿›å…¥åˆ° check é˜¶æ®µæ‰§è¡Œå›è°ƒ å¦‚æœæ²¡æœ‰ setImmediate å›è°ƒéœ€è¦æ‰§è¡Œï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒï¼Œè¿™é‡ŒåŒæ ·ä¼šæœ‰ä¸ªè¶…æ—¶æ—¶é—´è®¾ç½®é˜²æ­¢ä¸€ç›´ç­‰å¾…ä¸‹å» å½“ç„¶è®¾å®šäº† timer çš„è¯ä¸” poll é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ timer è¶…æ—¶ï¼Œå¦‚æœæœ‰çš„è¯ä¼šå›åˆ° timer é˜¶æ®µæ‰§è¡Œå›è°ƒã€‚ check check é˜¶æ®µæ‰§è¡Œ setImmediate close callbacksclose callbacks é˜¶æ®µæ‰§è¡Œ close äº‹ä»¶ å¯¹æ¯”ä¸€ä¸‹: æµè§ˆå™¨ä¸­çš„ Event Loopä»»åŠ¡æºä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„ Task é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡æºå¯ä»¥åˆ†ä¸º å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ å’Œ å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰ã€‚åœ¨ ES6 è§„èŒƒä¸­ï¼Œmicrotask ç§°ä¸º jobsï¼Œmacrotask ç§°ä¸º taskã€‚ å¾®ä»»åŠ¡ åŒ…æ‹¬ process.nextTick ï¼Œpromise ï¼ŒMutationObserverã€‚ å®ä»»åŠ¡ åŒ…æ‹¬ script ï¼Œ setTimeout ï¼ŒsetInterval ï¼ŒsetImmediate ï¼ŒI/O ï¼ŒUI renderingã€‚ Event Loop æ‰§è¡Œé¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š é¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡ å½“æ‰§è¡Œå®Œæ‰€æœ‰åŒæ­¥ä»£ç åï¼Œæ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¼‚æ­¥ä»£ç éœ€è¦æ‰§è¡Œ æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ å½“æ‰§è¡Œå®Œæ‰€æœ‰å¾®ä»»åŠ¡åï¼Œå¦‚æœ‰å¿…è¦ä¼šæ¸²æŸ“é¡µé¢ ç„¶åå¼€å§‹ä¸‹ä¸€è½® Event Loopï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç ï¼Œä¹Ÿå°±æ˜¯ setTimeout ä¸­çš„å›è°ƒå‡½æ•° å•çº¿ç¨‹Nodeåœ¨åœ¨V8å¼•æ“ä¸Šæ„å»ºï¼Œæ‰€ä»¥å®ƒçš„æ¨¡å¼å’Œæµè§ˆå™¨ç±»ä¼¼ï¼ŒJavaScriptè¿è¡Œåœ¨å•ä¸ªè¿›ç¨‹çš„å•ä¸ªçº¿ç¨‹ä¸Šã€‚ ä¼˜ç‚¹ï¼š ç¨‹åºçŠ¶æ€ å•ä¸€ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹æƒ…å†µä¸­çš„ é”, çº¿ç¨‹åŒæ­¥ ç­‰é—®é¢˜ï¼Œå‡å°‘æ“ä½œç³»ç»Ÿåœ¨è°ƒåº¦æ—¶çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ ç¼ºç‚¹ï¼š å•çº¿ç¨‹ ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸CPU â€“ (æ€§èƒ½) ä¸€æ—¦å•çº¿ç¨‹ä¸ŠæŠ›å‡ºçš„å¼‚å¸¸æ²¡æœ‰è¢«æ•è·ï¼Œä¼šå¼•èµ·æ•´ä¸ªè¿›ç¨‹çš„å¥”æºƒ â€“ (å¥å£®æ€§/ç¨³å®šæ€§) è§£å†³çš„æ–¹æ³•ï¼šé›†ç¾¤ä¸»ä»æ¨¡å¼ : ä¸»è¿›ç¨‹ï¼šè´Ÿè´£è°ƒåº¦æˆ–ç®¡ç†å·¥ä½œè¿›ç¨‹ï¼Œä¸è´Ÿè´£å…·ä½“çš„ä¸šåŠ¡å¤„ç† å·¥ä½œè¿›ç¨‹ï¼šè´Ÿè´£å…·ä½“çš„ä¸šåŠ¡å¤„ç† å¯åŠ¨å¤šä¸ªè¿›ç¨‹åªæ˜¯ä¸ºäº†å……åˆ†å°†CPUèµ„æºåˆ©ç”¨èµ·æ¥ï¼Œè€Œä¸æ˜¯ä¸ºäº†è§£å†³å¹¶å‘é—®é¢˜ï¼›å¹¶å‘æ˜¯é äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ã€‚ é›†ç¾¤ç¨³å®šéœ€è¦è€ƒè™‘ï¼š æ€§èƒ½é—®é¢˜ å¤šä¸ªå·¥ä½œè¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ç®¡ç† å·¥ä½œè¿›ç¨‹çš„å¹³æ»‘é‡å¯ é…ç½®æˆ–é™æ€æ•°æ®çš„åŠ¨æ€é‡æ–°è½½å…¥ å…¶å®ƒç»†èŠ‚ Node Webç®€å•çš„å®ç°node.js å†…ç½®äº† http package, å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç° web serverçš„åŠŸèƒ½ã€‚ 1234567891011var http = require('http')const PORT = 4337const HOST = '127.0.0.1'http.createServer(function (req, res) &#123; res.writeHead(200, &#123; 'Content-Type': 'text/plain' &#125;); res.end('Hello World\\n');&#125;).listen(PORT, HOST);console.log(`æœåŠ¡è¿è¡Œï¼š http://$&#123;HOST&#125;:$&#123;PORT&#125;/`) å°è£…ä¸­é—´ä»¶çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101const http = require('http')const url = require('url')const &#123; pathRegexp &#125; = require('./util')const &#123; resJSON, querystring &#125; = require('./middleware')const bodyParser = require('body-parser')const routes = &#123; all: [] &#125;;const app = &#123;&#125;;app.use = function(path) &#123; let handle; if (typeof path === 'string') &#123; handle = &#123; path: pathRegexp(path), stack: Array.prototype.slice.call(arguments, 1) &#125;; &#125; else &#123; handle = &#123; path: pathRegexp(), stack: Array.prototype.slice.call(arguments, 0) &#125; &#125; routes.all.push(handle)&#125;const methods = ['get', 'put', 'delete', 'post']methods.forEach(method =&gt; &#123; routes[method] = []; app[method] = (path, action) =&gt; &#123; const handle = &#123; path: pathRegexp(path), stack: action &#125;; routes[method].push(handle); &#125;;&#125;);const handle = (req, res, stack) =&gt; &#123; const next = (err) =&gt; &#123; if (err) &#123; return handle500(err, req, res, stack) &#125; const middleware = stack.shift(); if (middleware) &#123; // ä¼ å…¥next()å‡½æ•°è‡ªsèº«ï¼Œä½¿ä¸­é—´ä»¶èƒ½å¤Ÿæ‰§è¡Œç»“æŸåé€’å½’ try &#123; middleware(req, res, next) &#125; catch (error) &#123; next(error) &#125; &#125; &#125; next();&#125;app.use(resJSON);app.use(bodyParser.json())app.use(querystring);const requestListener = (req, res) =&gt; &#123; const match = (pathname, routes) =&gt; &#123; let stacks = []; for (let i = 0; i &lt; routes.length; i++) &#123; const route = routes[i]; const reg = route.path.regexp; const keys = route.path.keys; const matched = reg.exec(pathname); if (matched) &#123; const params = &#123;&#125;; for (let i = 0, l = keys.length; i &lt; l; i++) &#123; const value = matched[i + 1]; if (value) &#123; params[keys[i]] = value; &#125; &#125; req.params = params; stacks = stacks.concat(route.stack) &#125; &#125; return stacks; &#125; const pathname = url.parse(req.url).pathname; const method = req.method.toLowerCase(); let stacks = match(pathname, routes.all); if (Object.hasOwnProperty.call(routes, method)) &#123; stacks = stacks.concat(match(pathname, routes[method])); &#125; if (stacks.length) &#123; handle(req, res, stacks); &#125; else &#123; handle404(req. res); &#125;&#125;app.server = (port, hostname) =&gt; &#123; http.createServer(requestListener).listen(port, hostname);&#125;exports.app = app Express 2åŸºäº Node.js å¹³å°ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ Web å¼€å‘æ¡†æ¶ Express åº”ç”¨ç¨‹åºç”Ÿæˆå™¨: 1npx express-generator --view=pug myapp ç‰¹æ€§ï¼š ä¿æŒæœ€å°è§„æ¨¡çš„çµæ´» ä½¿ç”¨æ‚¨æ‰€é€‰æ‹©çš„å„ç§ HTTP å®ç”¨å·¥å…·å’Œä¸­é—´ä»¶ï¼Œå¿«é€Ÿæ–¹ä¾¿åœ°åˆ›å»ºå¼ºå¤§çš„ API æä¾›ç²¾ç®€çš„åŸºæœ¬ Web åº”ç”¨ç¨‹åºåŠŸèƒ½ï¼Œè€Œä¸ä¼šéšè—æ‚¨äº†è§£å’Œé’ççš„ Node.js åŠŸèƒ½ æ¡†æ¶ / è®¸å¤š æµè¡Œçš„å¼€å‘æ¡†æ¶ éƒ½åŸºäº Express æ„å»º 1234567var express = require('express')var app = express()// respond with \"hello world\" when a GET request is made to the homepageapp.get('/', function (req, res) &#123; res.send('hello world')&#125;) Koa 3Koa æ˜¯ä¸€ä¸ªæ–°çš„ web æ¡†æ¶ï¼Œç”± Express å¹•åçš„åŸç­äººé©¬æ‰“é€ ï¼Œ è‡´åŠ›äºæˆä¸º web åº”ç”¨å’Œ API å¼€å‘é¢†åŸŸä¸­çš„ä¸€ä¸ªæ›´å°ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®çš„åŸºçŸ³ã€‚ koa wiki ğŸŒ° ï¼š koa-rest-api-boilerplate 123456789const Koa = require('koa');const app = new Koa();// responseapp.use(ctx =&gt; &#123; ctx.body = 'Hello Koa';&#125;);app.listen(3000); ThinkJs 4ThinkJS æ˜¯ä¸€æ¬¾é¢å‘æœªæ¥å¼€å‘çš„ Node.js æ¡†æ¶ï¼Œæ•´åˆäº†å¤§é‡çš„é¡¹ç›®æœ€ä½³å®è·µï¼Œè®©ä¼ä¸šçº§å¼€å‘å˜å¾—æ›´ç®€å•ã€é«˜æ•ˆã€‚ä» 3.0 å¼€å§‹ï¼Œæ¡†æ¶åº•å±‚åŸºäº Koa 2.x å®ç°ï¼Œå…¼å®¹ Koa çš„æ‰€æœ‰åŠŸèƒ½ã€‚ ç‰¹æ€§ï¼š åŸºäº Koa 2.xï¼Œå…¼å®¹ middleware å†…æ ¸å°å·§ï¼Œæ”¯æŒ Extendã€Adapter ç­‰æ’ä»¶æ–¹å¼ æ€§èƒ½ä¼˜å¼‚ï¼Œå•å…ƒæµ‹è¯•è¦†ç›–ç¨‹åº¦é«˜ å†…ç½®è‡ªåŠ¨ç¼–è¯‘ã€è‡ªåŠ¨æ›´æ–°æœºåˆ¶ï¼Œæ–¹ä¾¿å¿«é€Ÿå¼€å‘ ä½¿ç”¨æ›´ä¼˜é›…çš„ async/await å¤„ç†å¼‚æ­¥é—®é¢˜ï¼Œä¸å†æ”¯æŒ */yield ä» 3.2 å¼€å§‹æ”¯æŒ TypeScript æ¨¡ä»¿ ThinkPHP çš„ä»£ç æ¨¡å¼ ä»£ç é£æ ¼ï¼š 12345678//src/controller/user.jsconst Base = require('./base.js');module.exports = class extends Base &#123; indexAction()&#123; this.body = 'hello world!'; &#125;&#125; nest 5ç”¨äºæ„å»ºé«˜æ•ˆä¸”å¯ä¼¸ç¼©çš„æœåŠ¡ç«¯åº”ç”¨ç¨‹åºçš„æ¸è¿›å¼Node.jsæ¡†æ¶ã€‚ ç‰¹æ€§ï¼š é¢å‘AOPç¼–ç¨‹ æ”¯æŒtypeorm Node.jsç‰ˆçš„spring æ„å»ºå¾®æœåŠ¡åº”ç”¨ ä»¿Angularå’ŒSpringçš„é£æ ¼ï¼Œæ³¨è§£å½¢å¼çš„ç¼–ç é£æ ¼ ä»£ç é£æ ¼ï¼š 12345678910import &#123; Controller, Get, Req &#125; from '@nestjs/common';import &#123; Request &#125; from 'express';@Controller('cats')export class CatsController &#123; @Get() findAll(@Req() request: Request): string &#123; return 'This action returns all cats'; &#125;&#125; Egg.js 6Egg.js ä¸ºä¼ä¸šçº§æ¡†æ¶å’Œåº”ç”¨è€Œç”Ÿï¼Œæˆ‘ä»¬å¸Œæœ›ç”± Egg.js å­•è‚²å‡ºæ›´å¤šä¸Šå±‚æ¡†æ¶ï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿå’Œå¼€å‘äººå‘˜é™ä½å¼€å‘å’Œç»´æŠ¤æˆæœ¬ã€‚ ç‰¹æ€§ï¼š æä¾›åŸºäº Egg å®šåˆ¶ä¸Šå±‚æ¡†æ¶çš„èƒ½åŠ› é«˜åº¦å¯æ‰©å±•çš„æ’ä»¶æœºåˆ¶ å†…ç½®å¤šè¿›ç¨‹ç®¡ç† åŸºäº Koa å¼€å‘ï¼Œæ€§èƒ½ä¼˜å¼‚ æ¡†æ¶ç¨³å®šï¼Œæµ‹è¯•è¦†ç›–ç‡é«˜ æ¸è¿›å¼å¼€å‘ egg æ¯”è¾ƒå¥½çš„å°±æ˜¯å®ƒçš„æ’ä»¶æœºåˆ¶ï¼Œå’Œ ç»Ÿä¸€çš„ä»£ç é£æ ¼ eggjs æ’ä»¶ eggjs ğŸŒ° ä»£ç é£æ ¼ï¼š 12345678910// app/controller/home.jsconst Controller = require('egg').Controller;class HomeController extends Controller &#123; async index() &#123; this.ctx.body = 'Hello world'; &#125;&#125;module.exports = HomeController; MidwayJS 7Midwayæ˜¯ä¸€ä¸ªç”±typescriptç¼–å†™çš„Node.js Webæ¡†æ¶ï¼Œå®ƒåˆ©ç”¨IoCæ³¨å…¥æœºåˆ¶æ¥è§£è€¦åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å¤§å‹Node.jsåº”ç”¨ç¨‹åºçš„å¼€å‘å˜å¾—æ›´ç®€å•ã€æ›´è‡ªç„¶ã€‚ ç‰¹æ€§ï¼š âœ”ï¸å¤æ‚çš„ç»„ä¸­é—´ä»¶ä½“ç³»ç»“æ„å’Œå…¼å®¹æ€§ âœ”ï¸å¯æ‰©å±•çš„æ’ä»¶åŠŸèƒ½å’Œç”Ÿæ€ç»„æ’ä»¶ âœ”ï¸å¥½çš„åº”ç”¨åˆ†å±‚å’Œåˆ†ç¦»èƒ½åŠ› âœ”ï¸å¾ˆå¥½çš„æœªæ¥å‘å±•ç»éªŒ âœ”ï¸æ”¯æŒeggæ’ä»¶å’Œkoaçš„ä¸­é—´ä»¶ midwayä¾‹å­ ğŸŒ° TSç¼–ç¨‹è¯­è¨€ï¼Œå’Œæ³¨è§£å½¢å¼çš„ç¼–ç é£æ ¼ï¼š 12345678910111213141516import &#123; provide, controller, inject, get &#125; from 'midway';@provide()@controller('/user')export class UserController &#123; @inject('userService') service: IUserService; @get('/:id') async getUser(ctx): Promise&lt;void&gt; &#123; const id: number = ctx.params.id; const user: IUserResult = await this.service.getUser(&#123;id&#125;); ctx.body = &#123;success: true, message: 'OK', data: user&#125;; &#125;&#125; Node.js ä¸­æ–‡ç½‘ Express ä¸­æ–‡ç½‘ Koa ä¸­æ–‡ç½‘ ThinkJs ä¸­æ–‡ç½‘ nest ä¸­æ–‡ç½‘ Egg.js MidwayJS","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"Web","slug":"Node-js/Web","permalink":"https://jigangduan.github.io/categories/Node-js/Web/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"}]},{"title":"errors ç¼–ç¨‹","slug":"programming-with-errors","date":"2019-09-18T02:17:37.000Z","updated":"2020-07-25T02:57:18.225Z","comments":true,"path":"2019/09/18/programming-with-errors/","link":"","permalink":"https://jigangduan.github.io/2019/09/18/programming-with-errors/","excerpt":"","text":"Go 1.13å¼•å…¥äº†ä¸€ä¸ªå¢å¼ºçš„package errors(å³xerrors)ï¼Œå®ƒå¤§è‡´æ ‡å‡†åŒ–äº†å¸¦æœ‰é”™è¯¯çš„ç¼–ç¨‹ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªAPIä»¤äººå›°æƒ‘ã€‚è¿™æ˜¯ä¸€ä¸ªå¦‚ä½•æœ‰æ•ˆä½¿ç”¨å®ƒçš„å¿«é€Ÿå‚è€ƒã€‚ åˆ›å»ºerrorså‰å“¨é”™è¯¯çš„å·¥ä½œåŸç†ä¸ä»¥å‰ç›¸åŒã€‚å°†å®ƒä»¬å‘½åä¸ºErrXxxï¼Œå¹¶ä½¿ç”¨errors.Newåˆ›å»ºå®ƒä»¬ã€‚ 1var ErrFoo = errors.New(\"foo error\") é”™è¯¯ç±»å‹çš„å·¥ä½œåŸç†ä¸ä»¥å‰åŸºæœ¬ç›¸åŒã€‚å°†å®ƒä»¬å‘½åä¸ºXxxErrorï¼Œå¹¶ç¡®ä¿å®ƒä»¬æœ‰ä¸€ä¸ªé”™è¯¯æ–¹æ³•ï¼Œä»¥æ»¡è¶³é”™è¯¯æ¥å£ã€‚ 1234567type BarError struct &#123; Reason string&#125;func (e BarError) Error() string &#123; return fmt.Sprintf(\"bar error: %s\", e.Reason)&#125; å¦‚æœæ‚¨çš„é”™è¯¯ç±»å‹åŒ…è£…äº†å¦ä¸€ä¸ªé”™è¯¯ï¼Œè¯·æä¾›ä¸€ä¸ªUnwrapæ–¹æ³•ã€‚ 123456789101112131415type BazError struct &#123; Reason string Inner error&#125;func (e BazError) Error() string &#123; if e.Inner != nil &#123; return fmt.Sprintf(\"baz error: %s: %v\", e.Reason, e.Inner) &#125; return fmt.Sprintf(\"baz error: %s\", e.Reason)&#125;func (e BazError) Unwrap() error &#123; return e.Inner&#125; åŒ…è£…å’Œè¿”å›é”™è¯¯é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨åœ¨å‡½æ•°ä¸­é‡åˆ°é”™è¯¯å¹¶éœ€è¦å°†å…¶è¿”å›ç»™è°ƒç”¨è€…æ—¶ï¼Œä½¿ç”¨fmt.Errorfå’Œæ–°çš„%wè°“è¯å°†å…¶ä¸æœ‰å…³é”™è¯¯çš„ä¸Šä¸‹æ–‡åŒ…è£…èµ·æ¥ã€‚ 12345func process(j Job) error &#123; result, err := preprocess(j) if err != nil &#123; return fmt.Errorf(\"error preprocessing job: %w\", err) &#125; è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé”™è¯¯æ³¨é‡Šã€‚é¿å…è¿”å›æœªæ³¨é‡Šçš„é”™è¯¯ï¼Œå› ä¸ºè¿™ä¼šä½¿è°ƒç”¨è€…å¾ˆéš¾ç†è§£å“ªé‡Œå‡ºé”™äº†ã€‚ æ­¤å¤–ï¼Œå¯¹äºæ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡è‡ªå®šä¹‰é”™è¯¯ç±»å‹(å¦‚ä¸Šé¢çš„BazError)åŒ…è£…é”™è¯¯ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé”™è¯¯æ³¨é‡Šã€‚é¿å…è¿”å›æœªæ³¨é‡Šçš„é”™è¯¯ï¼Œå› ä¸ºè¿™ä¼šä½¿è°ƒç”¨è€…å¾ˆéš¾ç†è§£å“ªé‡Œå‡ºé”™äº†ã€‚ æ­¤å¤–ï¼Œå¯¹äºæ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡è‡ªå®šä¹‰é”™è¯¯ç±»å‹(å¦‚ä¸Šé¢çš„BazError)åŒ…è£…é”™è¯¯ã€‚ 12345 p := getPriority()widget, err := manufacture(p, result)if err != nil &#123; return ManufacturingError&#123;Priority: p, Error: err&#125; &#125; æ£€æŸ¥é”™è¯¯å¤§å¤šæ•°æ—¶å€™ï¼Œå½“æ‚¨æ”¶åˆ°é”™è¯¯æ—¶ï¼Œæ‚¨å¹¶ä¸å…³å¿ƒç»†èŠ‚ã€‚æ— è®ºæ‚¨å°è¯•åšä»€ä¹ˆéƒ½å¤±è´¥äº†ï¼Œæ‰€ä»¥æ‚¨è¦ä¹ˆéœ€è¦æŠ¥å‘Šé”™è¯¯(ä¾‹å¦‚ï¼Œè®°å½•å®ƒ)ï¼Œç„¶åç»§ç»­;æˆ–è€…ï¼Œå¦‚æœæ— æ³•ç»§ç»­ï¼Œåˆ™ä½¿ç”¨ä¸Šä¸‹æ–‡æ³¨é‡Šé”™è¯¯ï¼Œå¹¶å°†å…¶è¿”å›ç»™è°ƒç”¨è€…ã€‚ å¦‚æœå…³å¿ƒæ¥æ”¶åˆ°çš„é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨errors.Isæ£€æŸ¥å‰å“¨é”™è¯¯ï¼Œå¹¶ä½¿ç”¨errors.Asæ£€æŸ¥é”™è¯¯å€¼ã€‚ 123456789101112err := f()if errors.Is(err, ErrFoo) &#123; // ä½ çŸ¥é“ä½ é”™äº† // åšå‡ºé€‚å½“çš„å›åº”&#125;var bar BarErrorif errors.As(err, &amp;bar) &#123; // ä½ çŸ¥é“ä½ æœ‰ä¸ªBarError // barçš„å­—æ®µè¢«å¡«å…… // åšå‡ºé€‚å½“çš„å›åº”&#125; errors.Iså’Œerrors.Aséƒ½å°†å°è¯•é€’å½’åœ°å±•å¼€é”™è¯¯ï¼Œä»¥ä¾¿æ‰¾åˆ°åŒ¹é…é¡¹ã€‚è¿™æ®µä»£ç æ¼”ç¤ºäº†åŸºæœ¬çš„é”™è¯¯åŒ…è£…å’Œæ£€æŸ¥æŠ€æœ¯ã€‚æŸ¥çœ‹func a()ä¸­çš„æ£€æŸ¥é¡ºåºï¼Œç„¶åå°è¯•æ›´æ”¹func c()è¿”å›çš„é”™è¯¯ï¼Œä»¥ç›´è§‚åœ°äº†è§£æ‰€æœ‰å†…å®¹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æ­£å¦‚åŒ…é”™è¯¯æ–‡æ¡£æ‰€è¿°ï¼Œå®å¯ä½¿ç”¨errors.Isï¼Œä¹Ÿä¸è¦æ£€æŸ¥æ™®é€šçš„ç­‰å¼ï¼Œä¾‹å¦‚if err == ErrFoo;å¹¶ä¸”æ›´å–œæ¬¢ä½¿ç”¨errors.Asè€Œä¸æ˜¯æ™®é€šç±»å‹æ–­è¨€ï¼Œä¾‹å¦‚if e, ok:= err.(MyError)ï¼Œå› ä¸ºæ™®é€šç‰ˆæœ¬ä¸æ‰§è¡Œå±•å¼€ã€‚å¦‚æœæ‚¨æ˜¾å¼åœ°ä¸å…è®¸è°ƒç”¨æ–¹æ‰“å¼€é”™è¯¯ï¼Œè¯·ä¸ºfmtæä¾›ä¸€ä¸ªä¸åŒçš„æ ¼å¼åŒ–è°“è¯ã€‚Errorf,æ¯”å¦‚% v;æˆ–è€…ä¸å¯¹é”™è¯¯ç±»å‹æä¾›Unwrapæ–¹æ³•ã€‚ä½†è¿™ç§æƒ…å†µåº”è¯¥å¾ˆå°‘è§ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"}]},{"title":"å¼€æºæ•™è‚²æŠ€æœ¯æ ˆ","slug":"edustack","date":"2019-05-04T02:36:49.000Z","updated":"2020-07-25T02:57:18.200Z","comments":true,"path":"2019/05/04/edustack/","link":"","permalink":"https://jigangduan.github.io/2019/05/04/edustack/","excerpt":"","text":"åº”ç”¨ç›®å½• åŸºç¡€è½¯ä»¶ è™šæ‹ŸåŒ– openstack æ“ä½œç³»ç»Ÿ Unbuntu Centos é‚®ä»¶ RoundCube webæœåŠ¡å™¨ Apache Nginx æ•°æ®åº“æœåŠ¡å™¨Mysql phpmyadmin / Postgresql postgresqlstudio å•ç‚¹ç™»å½• Apereo CAS è½»å‹ç›®å½•è®¿é—®åè®®LDAP OpenLDAP äº‘ç›˜ ownCloud Seafile pydio APIå¹³å° Dreamfactory Swagger ç§»åŠ¨åç«¯å¼€å‘ Parse è¯ä¹¦ LetsEncrypt ç½‘ç»œå­˜å‚¨ FreeNAS å¤§æ•°æ® æ•°æ®ä»“åº“ETL pentaho-kettle å•†ä¸šæ™ºèƒ½BI spagoBI æ—¥å¿—åˆ†æ ELK Flume+Kafka+Strom CDH Cloudera æ•°æ®ä»“åº“ Greenplum æ•°æ®åˆ†æåŠå¯è§†åŒ– SuperSet å†…å­˜å¤§æ•°æ® Alluxio Geode ç¥ç»ç½‘ç»œ TensorFlow ç®¡ç† ç³»ç»Ÿç®¡ç† Webmin è™šæ‹Ÿä¸»æœº ISPconfig æ•°æ®ä¸­å¿ƒ RackTables ç›‘æ§ zabbix APM pinpoint è¿ç»´ SaltStack Ansible æ¼æ´æ‰«æ openvas w3af ç½‘ç»œå…‹éš† CloneZilla DBRL è·³æ¿æœº JumpServer å†…å®¹ å†…å®¹ç®¡ç†ç³»ç»Ÿ WordPress æœç´¢ Solr çŸ¥è¯†ç¤¾åŒº WeCenter è§†é¢‘é—¨æˆ· MediaDrop githubåœ°å€ è§†é¢‘å¤„ç† Kaltura èµ„æºç®¡ç† ResourceSpace æ•™å­¦ç§‘ç ” æ…•è¯¾MOOCS Open edX Canvas è¯¾ç¨‹ç®¡ç† Moodle ä»£ç ç®¡ç† Gitlab çœ‹æ¿ WeKan åœ¨çº¿ä¼šè®® BigBlueButton è¯¾ç¨‹åˆ¶ä½œ Course Builder / oppia å­¦æœ¯åä½œ OAEproject FOLIO FOLIOæ˜¯å›¾ä¹¦é¦†ï¼Œå¼€å‘å•†å’Œä¾›åº”å•†åˆä½œå»ºç«‹çš„ä¸€ä¸ªå¼€æºå›¾ä¹¦é¦†æœåŠ¡å¹³å°ã€‚ å®ƒæ”¯æŒä¼ ç»Ÿçš„èµ„æºç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥æ‰©å±•åˆ°å…¶ä»–æœºæ„é¢†åŸŸã€‚ ç¤¾äº¤ èŠå¤©æœºå™¨äºº Hubot è®¨è®ºåŒº Discourse æŠ•ç¥¨ Limesurvey å³æ—¶é€šä¿¡ Rocket.Chat åˆ†å¸ƒå¼ç¤¾äº¤ç½‘ç»œ Mastodon æ¡Œé¢ ç»˜å›¾ krita æ•°å­¦è½¯ä»¶ Geogebra","categories":[],"tags":[]},{"title":"editors","slug":"editors","date":"2019-05-02T16:41:40.000Z","updated":"2020-07-25T02:57:18.200Z","comments":true,"path":"2019/05/03/editors/","link":"","permalink":"https://jigangduan.github.io/2019/05/03/editors/","excerpt":"","text":"WEBCODESK React Webåº”ç”¨ç¨‹åºçš„å¿«é€Ÿå¼€å‘å·¥å…· å…ˆè¿›çš„React GUIç¼–è¾‘å™¨ â€” Structor å¼ƒç”¨ é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·å‰ç”Ÿä»Šä¸–é¡µé¢å¯è§†åŒ–æ­å»ºå·¥å…·æŠ€æœ¯è¦ç‚¹ pipeline-editor","categories":[],"tags":[]},{"title":"åœ¨çº¿æ–‡æ¡£æ”¶å½•","slug":"online-doc","date":"2019-05-02T12:06:37.000Z","updated":"2020-07-25T02:57:18.224Z","comments":true,"path":"2019/05/02/online-doc/","link":"","permalink":"https://jigangduan.github.io/2019/05/02/online-doc/","excerpt":"","text":"æºç ä¸‹è½½ å‘ç°-è¯­é›€ ä»å‰ç«¯è§’åº¦çœ‹ä¼ä¸šè½¯ä»¶çš„ç ”å‘è¿‡ç¨‹ ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦è¯¾ç¨‹èµ„æº äº’è”ç½‘å…¬å¸æŠ€æœ¯æ¶æ„ï¼Œå¾®ä¿¡/æ·˜å®/å¾®åš/è…¾è®¯/é˜¿é‡Œ/ç¾å›¢ç‚¹è¯„/ç™¾åº¦/Google/Facebook/Amazon/eBayçš„æ¶æ„ äººäººéƒ½èƒ½ç”¨è‹±è¯­ æç¬‘æ¥ githubå›¾ç‰‡ æ ‘è“æ´¾å¼€å§‹ï¼Œç©è½¬Linux ä¸­å°ä¹‹ä¸Š ä»åˆåˆ›å‹åˆ°ç‹¬è§’å…½ä¼ä¸šï¼Œç›‘æ§æ¶æ„æ¼”è¿›çš„é‚£äº›äº‹å„¿ IntelliJ IDEA ç®€ä½“ä¸­æ–‡ä¸“é¢˜æ•™ç¨‹ åå°äº§å“è®¾è®¡ç³»åˆ— å„å¤§äº’è”ç½‘å…¬å¸æ¶æ„æ¼”è¿›ä¹‹è·¯æ±‡æ€» ç›˜ç‚¹é˜¿é‡Œå·´å·´ 15 æ¬¾å¼€å‘è€…å·¥å…· æ˜é‡‘ç¿»è¯‘è®¡åˆ’ vi/vimä½¿ç”¨è¿›é˜¶ Mavenå²ä¸Šæœ€å…¨æ•™ç¨‹ GitHubä¸Šæœ‰ä¸€ä»½å¤§ç¥æ•´ç†çš„åå‡ å¹´â€œæ¸—é€æ”»å‡»â€ç»éªŒ 11ä¸ªspringbootå¿«é€Ÿå¼€å‘çš„é¡¹ç›®ï¼Œæ¥ç§æ´»åˆ©å™¨ åå°å¼€æºç®¡ç†ç³»ç»ŸæŠ€æœ¯åŠè®¾è®¡å­¦ä¹ æ€»ç»“ å‰ç«¯ ä¸€ä¸ªåˆæ ¼(ä¼˜ç§€)çš„å‰ç«¯éƒ½åº”è¯¥é˜…è¯»è¿™äº›æ–‡ç«  å‰ç«¯åŸºç¡€è¿›é˜¶ç³»åˆ— å‰ç«¯ä¹éƒ¨ - å…¥é—¨è€…æ‰‹å†Œ2019 JS å‡½æ•°å¼ç¼–ç¨‹æŒ‡å— åœ¨ JavaScript ES6+ ä¸­ä»é›¶å¼€å§‹å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹&amp;ç»„åˆå¼è½¯ä»¶ç¼–å†™ç³»åˆ—è¯‘æ–‡ å‰ç«¯å·¥åŒ  æ·±äºˆä¹‹ä¸ªäººåšå®¢ ä» 1 åˆ°å®Œç¾ï¼Œç”¨ node å†™ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· eagle.js: ä¸€ä¸ªç”¨Vue.jsæ„å»ºçš„å¯ç¼–ç¨‹å¹»ç¯ç‰‡æ¡†æ¶ CSS_training ç°ä»£ JavaScript æ•™ç¨‹ JavaScript ä»£ç æ•´æ´ä¹‹é“ ç½‘ç«™æ¸è¿›å¼å¢å¼ºä½“éªŒ(PWA)æ”¹é€ ï¼šService Worker åº”ç”¨è¯¦è§£ Vue.js æŠ€æœ¯æ­ç§˜ React æºç è§£æ 15 ä¸ªæœ‰è¶£çš„ JS å’Œ CSS åº“ wechat-h5-boilerplate: ä¸ºè…¾è®¯å¾®ä¿¡ä¼˜åŒ–çš„H5åŠ¨æ•ˆæ¨¡æ¿ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ„å»ºå…¨å±æ»šåŠ¨å‹H5é¡µé¢ã€‚ iSlider å¦‚ä¸èˆ¬é«˜æ€§èƒ½H5å…¨å±æ»‘åŠ¨ç»„ä»¶ å‰ç«¯åœ¨çº¿ç®€å†èƒ½ç”¨åˆ°çš„ç‚«é…·UIåº“ ä¸€æ¬¾é«˜æ•ˆã€é«˜æ€§èƒ½çš„å¸§åŠ¨ç”»ç”Ÿæˆå·¥å…· TypeScript Awesome TypeScript TypeScriptï¼Œåˆæ¬¡è§é¢ï¼Œè¯·å¤šæŒ‡æ•™ å¯èƒ½æ˜¯ä½ éœ€è¦çš„react + typescript 50æ¡è§„èŒƒå’Œç»éªŒ WebGL WebGL ç†è®ºåŸºç¡€ Flutter Flutter å®æˆ˜ Flutterç¤¾åŒºä¸­æ–‡èµ„æº Node.js Node.js è°ƒè¯•æŒ‡å— é€šè¿‡Githubä¸PM2éƒ¨ç½²Nodeåº”ç”¨ Golang Goå‘½ä»¤è¡Œåº“Cobraçš„ä½¿ç”¨ Viper:Goåº”ç”¨ç¨‹åºçš„å®Œæ•´é…ç½®è§£å†³æ–¹æ¡ˆ Java Java 8 Tutorial Design patterns implemented in Java(Javaè®¾è®¡æ¨¡å¼) Spring Cloud Streamä¸­æ–‡æŒ‡å¯¼æ‰‹å†Œ Docker æ¯å¤©5åˆ†é’Ÿç©è½¬ Docker å®¹å™¨æŠ€æœ¯ æ¯å¤©5åˆ†é’Ÿç©è½¬ Kubernetes å®¹å™¨ç›‘æ§æ–¹æ¡ˆæ±‡æ€» github Knative å…¥é—¨ç³»åˆ— - åŸºäº Kubernetes çš„serverless prometheus(æ™®ç½—ç±³ä¿®æ–¯) - ç›‘æ§æŠ¥è­¦ç³»ç»Ÿ 0ä¸ªåŸºäºDOCKERçš„é¡¶å°–å¼€å‘å·¥å…· Python Python - 100å¤©ä»æ–°æ‰‹åˆ°å¤§å¸ˆ å¤§ç‰›æ¨èçš„10æœ¬å­¦ä¹  Python çš„å¥½ä¹¦ Djangoå…¥é—¨ä¸å®è·µæ•™ç¨‹ Pythonè¿›é˜¶ æœºå™¨å­¦ä¹  100-Days-Of-ML-Codeä¸­æ–‡ç‰ˆ æ·±åº¦å­¦ä¹ 500é—® é¢è¯• Js é¢è¯•ä¹‹é“ äº’è”ç½‘ Java å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†å®Œå…¨æ‰«ç›² React é¢è¯•é¢˜ &amp; å›ç­” 100é“pythonçœŸå®é¢è¯•é¢˜ JavaGuide ç¨‹åºå‘˜ä¿®ç‚¼ä¹‹è·¯ feguideé¢è¯•åº“ å¯è§†åŒ–å’Œåˆ†æå›¾http://js.cytoscape.orgå¯å‚è€ƒï¼šhttps://graphqleditor.comhttps://diagram.graphqleditor.comhttps://gojs.net/latest/index.htmlå¯å‚è€ƒï¼š https://webglstudio.orgæ•°æ®åº“æ•°æ®å¯è§†åŒ–ï¼š https://metabase.com/ å’Œ https://github.com/getredash/redashï¼ˆå¾ˆåƒå…¬å¸å¯è§†åŒ–ç”Ÿæˆéœ€æ±‚ï¼‰http://visjs.orghttps://github.com/mojs/mojsï¼ˆmotionï¼‰ Cube.jsæ˜¯ä¸€ä¸ªå¼€æºæ¨¡å—åŒ–æ¡†æ¶ï¼Œç”¨äºæ„å»ºåˆ†æWebåº”ç”¨ç¨‹åºã€‚å®ƒä¸»è¦ç”¨äºæ„å»ºå†…éƒ¨å•†ä¸šæ™ºèƒ½å·¥å…·æˆ–å°†é¢å‘å®¢æˆ·çš„åˆ†ææ·»åŠ åˆ°ç°æœ‰åº”ç”¨ç¨‹åºã€‚ å¿«é€Ÿå¼€å‘å¼€æºé¡¹ç›®SpringWindï¼šJava EEï¼ˆJ2EEï¼‰å¿«é€Ÿå¼€å‘æ¡†æ¶Crownï¼šMybatisplus 3.0 æ•™å­¦ç‰ˆCrabï¼šWEB æé€Ÿå¼€å‘æ¡†æ¶KangarooAdminï¼šè½»é‡çº§æƒé™ç®¡ç†æ¡†æ¶iBase4Jï¼šJava åˆ†å¸ƒå¼å¿«é€Ÿå¼€å‘åŸºç¡€å¹³å°frameworkï¼šåå°ç®¡ç†æ¡†æ¶BMSï¼šåŸºç¡€æƒé™å¼€å‘æ¡†æ¶spring-shiro-trainingï¼šç®€å•å®ç”¨çš„æƒé™è„šæ‰‹æ¶centerï¼šç³»ç»Ÿç®¡ç†ä¸­å¿ƒç³»ç»Ÿskeletonï¼šSpringboot-Shiro è„šæ‰‹æ¶springboot_mybatisplusï¼šåŸºäº SpringBoot çš„ç¾å¥³å›¾ç‰‡çˆ¬è™«ç³»ç»Ÿgunsï¼šguns åå°ç®¡ç†ç³»ç»Ÿmapleï¼šmaple ä¼ä¸šä¿¡æ¯åŒ–çš„å¼€å‘åŸºç¡€å¹³å°jeeweb-mybatisï¼šJeeWeb æ•æ·å¼€å‘å¹³å°youngcmsï¼šCMS å¹³å°king-adminï¼šå‰åç«¯åˆ†ç¦»çš„åŸºç¡€æƒé™ç®¡ç†åå°jeefastï¼šå‰åç«¯åˆ†ç¦» Vue å¿«é€Ÿå¼€å‘å¹³å°bing-upmsï¼šSpringBoot + Shiro +FreeMarker åˆ¶ä½œçš„é€šç”¨æƒé™ç®¡ç†slifeï¼šSpringBoot ä¼ä¸šçº§å¿«é€Ÿå¼€å‘è„šæ‰‹æ¶pigï¼šå¾®æœåŠ¡ Spring Cloud æ¶æ„mysiteformeï¼šç³»ç»Ÿåå°watchdog-frameworkï¼šåŸºç¡€æƒé™æ¡†æ¶iartisan-admin-templateï¼šJava å¿«é€Ÿå¼€å‘å¹³å°ifastï¼šifast å¿«é€Ÿå¼€å‘å¹³å°rosesï¼šåŸºäº Spring Cloud çš„åˆ†å¸ƒå¼æ¡†æ¶renren-securityï¼šäººäººæƒé™ç³»ç»Ÿfreeter-adminï¼šé£ç‰¹åå°ç®¡ç†ç³»ç»Ÿvblogï¼šVBlog åšå®¢ç³»ç»Ÿjiiiiiin-securityï¼šjiiiiiinæƒé™ç³»ç»Ÿhdw-dubboï¼šHDWå¿«é€Ÿå¼€å‘å¹³å°pybbsï¼šæ›´å¥½ç”¨çš„Javaè¯­è¨€ç¤¾åŒº(è®ºå›)SmallBunï¼šSmallBunä¼ä¸šçº§å¼€å‘è„šæ‰‹æ¶webplusï¼šç»¼åˆå¼€å‘å¹³å°x-bootï¼šVUE å‰åç«¯åˆ†ç¦»å¼€å‘å¹³å°nice-blog-sysï¼šåŸºäºSpirngBootå¼€å‘ï¼Œå¥½çœ‹çš„ä¸ªäººåšå®¢ã€‚ å¿«é€Ÿä¸Šæ‰‹ Spring Boot çœ‹è¿™äº›å°±å¤Ÿäº†ï¼ zheng å¼€æºæ¨èSpring boot å¾®æœåŠ¡é«˜æ•ˆå¼€å‘ mica å·¥å…·é›†ï¼šhttps://gitee.com/596392912/micaAvue ä¸€æ¬¾åŸºäºvueå¯é…ç½®åŒ–çš„ç¥å¥‡æ¡†æ¶ï¼šhttps://gitee.com/smallweigit/avuepig å®‡å®™æœ€å¼ºå¾®æœåŠ¡ï¼ˆæ¶æ„å¸ˆå¿…å¤‡ï¼‰ï¼šhttps://gitee.com/log4j/pigSpringBlade å®Œæ•´çš„çº¿ä¸Šè§£å†³æ–¹æ¡ˆï¼ˆä¼ä¸šå¼€å‘å¿…å¤‡ï¼‰ï¼šhttps://gitee.com/smallc/SpringBladeåŠ å…¥ã€å¦‚æ¢¦æŠ€æœ¯ã€‘Spring QQç¾¤ï¼š479710041ï¼Œäº†è§£æ›´å¤šã€‚","categories":[{"name":"æ–‡æ¡£","slug":"æ–‡æ¡£","permalink":"https://jigangduan.github.io/categories/æ–‡æ¡£/"}],"tags":[{"name":"æ–‡æ¡£","slug":"æ–‡æ¡£","permalink":"https://jigangduan.github.io/tags/æ–‡æ¡£/"}]},{"title":"Javaé«˜å¹¶å‘(2) å¹¶å‘åŸºç¡€","slug":"java-high-concurrency-02","date":"2019-04-18T13:57:56.000Z","updated":"2020-07-25T02:57:18.210Z","comments":true,"path":"2019/04/18/java-high-concurrency-02/","link":"","permalink":"https://jigangduan.github.io/2019/04/18/java-high-concurrency-02/","excerpt":"","text":"CPUå¤šçº§ç¼“å­˜CPUä¸ºä½•è¦æœ‰é«˜é€Ÿç¼“å­˜CPUçš„é¢‘ç‡å¤ªå¿«äº†ï¼Œå¿«åˆ°ä¸»å­˜è·Ÿä¸ä¸Šï¼Œè¿™æ ·åœ¨å¤„ç†æ—¶é’Ÿå‘¨æœŸå†…ï¼ŒCPUå¸¸å¸¸éœ€è¦ç­‰å¾…ä¸»å­˜ï¼Œæµªè´¹èµ„æºã€‚æ‰€ä»¥cacheçš„å‡ºç°ï¼Œæ˜¯ä¸ºäº†ç¼“è§£CPUå’Œå†…å­˜ä¹‹é—´é€Ÿåº¦çš„ä¸åŒ¹é…é—®é¢˜(ç»“æ„ï¼š cpu -&gt; cache -&gt; memory) CPUåœ¨æ‘©å°”å®šå¾‹çš„æŒ‡å¯¼ä¸‹ä»¥æ¯18ä¸ªæœˆç¿»ä¸€ç•ªçš„é€Ÿåº¦åœ¨å‘å±•ï¼Œç„¶è€Œå†…å­˜å’Œç¡¬ç›˜çš„å‘å±•é€Ÿåº¦è¿œè¿œä¸åŠCPUã€‚è¿™å°±é€ æˆäº†é«˜æ€§èƒ½èƒ½çš„å†…å­˜å’Œç¡¬ç›˜ä»·æ ¼åŠå…¶æ˜‚è´µã€‚ç„¶è€ŒCPUçš„é«˜åº¦è¿ç®—éœ€è¦é«˜é€Ÿçš„æ•°æ®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCPUå‚å•†åœ¨CPUä¸­å†…ç½®äº†å°‘é‡çš„é«˜é€Ÿç¼“å­˜ä»¥è§£å†³I\\Oé€Ÿåº¦å’ŒCPUè¿ç®—é€Ÿåº¦ä¹‹é—´çš„ä¸åŒ¹é…é—®é¢˜ã€‚ CPU cache æ„ä¹‰ æ—¶é—´å±€éƒ¨æ€§ï¼šå¦‚æœä¸€ä¸ªä¿¡æ¯é¡¹æ­£åœ¨è¢«è®¿é—®ï¼Œé‚£ä¹ˆåœ¨è¿‘æœŸå®ƒå¾ˆå¯èƒ½è¿˜ä¼šè¢«å†æ¬¡è®¿é—®ã€‚ ç©ºé—´å±€éƒ¨æ€§: å¦‚æœä¸€ä¸ªå­˜å‚¨å™¨çš„ä½ç½®è¢«å¼•ç”¨ï¼Œé‚£ä¹ˆå°†æ¥ä»–é™„è¿‘çš„ä½ç½®ä¹Ÿä¼šè¢«å¼•ç”¨ã€‚ å¸¦æœ‰é«˜é€Ÿç¼“å­˜çš„CPUæ‰§è¡Œè®¡ç®—çš„æµç¨‹ ç¨‹åºä»¥åŠæ•°æ®è¢«åŠ è½½åˆ°ä¸»å†…å­˜ æŒ‡ä»¤å’Œæ•°æ®è¢«åŠ è½½åˆ°CPUçš„é«˜é€Ÿç¼“å­˜ CPUæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŠŠç»“æœå†™åˆ°é«˜é€Ÿç¼“å­˜ é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å†™å›ä¸»å†…å­˜ ç›®å‰æµè¡Œå¤šçº§ç¼“å­˜ç»“æ„ ç¼“å­˜ä¸€è‡´æ€§ï¼ˆMESIï¼‰ ç¼“å­˜è¡Œï¼ˆCache lineï¼‰: ç¼“å­˜å­˜å‚¨æ•°æ®çš„å•å…ƒ MESI æ˜¯æŒ‡4ä¸­çŠ¶æ€çš„é¦–å­—æ¯ã€‚æ¯ä¸ªCache lineæœ‰4ä¸ªçŠ¶æ€ï¼Œå¯ç”¨2ä¸ªbitè¡¨ç¤ºï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š çŠ¶æ€ æè¿° ç›‘å¬ä»»åŠ¡ M ä¿®æ”¹ (Modified) è¯¥Cache lineæœ‰æ•ˆï¼Œæ•°æ®è¢«ä¿®æ”¹äº†ï¼Œå’Œå†…å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ•°æ®åªå­˜åœ¨äºæœ¬Cacheä¸­ã€‚ ç¼“å­˜è¡Œå¿…é¡»æ—¶åˆ»ç›‘å¬æ‰€æœ‰è¯•å›¾è¯»è¯¥ç¼“å­˜è¡Œç›¸å¯¹å°±ä¸»å­˜çš„æ“ä½œï¼Œè¿™ç§æ“ä½œå¿…é¡»åœ¨ç¼“å­˜å°†è¯¥ç¼“å­˜è¡Œå†™å›ä¸»å­˜å¹¶å°†çŠ¶æ€å˜æˆSï¼ˆå…±äº«ï¼‰çŠ¶æ€ä¹‹å‰è¢«å»¶è¿Ÿæ‰§è¡Œã€‚ E ç‹¬äº«ã€äº’æ–¥ (Exclusive) è¯¥Cache lineæœ‰æ•ˆï¼Œæ•°æ®å’Œå†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œæ•°æ®åªå­˜åœ¨äºæœ¬Cacheä¸­ã€‚ ç¼“å­˜è¡Œä¹Ÿå¿…é¡»ç›‘å¬å…¶å®ƒç¼“å­˜è¯»ä¸»å­˜ä¸­è¯¥ç¼“å­˜è¡Œçš„æ“ä½œï¼Œä¸€æ—¦æœ‰è¿™ç§æ“ä½œï¼Œè¯¥ç¼“å­˜è¡Œéœ€è¦å˜æˆSï¼ˆå…±äº«ï¼‰çŠ¶æ€ã€‚ S å…±äº« (Shared) è¯¥Cache lineæœ‰æ•ˆï¼Œæ•°æ®å’Œå†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œæ•°æ®å­˜åœ¨äºå¾ˆå¤šCacheä¸­ã€‚ ç¼“å­˜è¡Œä¹Ÿå¿…é¡»ç›‘å¬å…¶å®ƒç¼“å­˜ä½¿è¯¥ç¼“å­˜è¡Œæ— æ•ˆæˆ–è€…ç‹¬äº«è¯¥ç¼“å­˜è¡Œçš„è¯·æ±‚ï¼Œå¹¶å°†è¯¥ç¼“å­˜è¡Œå˜æˆæ— æ•ˆï¼ˆInvalidï¼‰ã€‚ I æ— æ•ˆ (Invalid) è¯¥Cache lineæ— æ•ˆã€‚ æ—  MESIçŠ¶æ€è½¬æ¢: è§¦å‘äº‹ä»¶: è§¦å‘äº‹ä»¶ æè¿° æœ¬åœ°è¯»å–ï¼ˆLocal readï¼‰ æœ¬åœ°cacheè¯»å–æœ¬åœ°cacheæ•°æ® æœ¬åœ°å†™å…¥ï¼ˆLocal writeï¼‰ æœ¬åœ°cacheå†™å…¥æœ¬åœ°cacheæ•°æ® è¿œç«¯è¯»å–ï¼ˆRemote readï¼‰ å…¶ä»–cacheè¯»å–æœ¬åœ°cacheæ•°æ® è¿œç«¯å†™å…¥ï¼ˆRemote writeï¼‰ å…¶ä»–cacheå†™å…¥æœ¬åœ°cacheæ•°æ® å³è¾¹å›¾ç¤ºæ„äº†ï¼Œå½“ä¸€ä¸ªcache lineçš„è°ƒæ•´çš„çŠ¶æ€çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªcache line éœ€è¦è°ƒæ•´çš„çŠ¶æ€ ä¸¾ä¸ªæ —å­æ¥è¯´ï¼šå‡è®¾cache 1 ä¸­æœ‰ä¸€ä¸ªå˜é‡x = 0çš„cache line å¤„äºSçŠ¶æ€(å…±äº«)ã€‚é‚£ä¹ˆå…¶ä»–æ‹¥æœ‰xå˜é‡çš„cache 2ã€cache 3ç­‰xçš„cache lineè°ƒæ•´ä¸ºSçŠ¶æ€ï¼ˆå…±äº«ï¼‰æˆ–è€…è°ƒæ•´ä¸º I çŠ¶æ€ï¼ˆæ— æ•ˆï¼‰ã€‚ æŒ‡ä»¤é‡æ’å’Œå†…å­˜å±éšœæŒ‡ä»¤é‡æ’ç°ä»£CPUçš„é€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œä¸ºäº†å……åˆ†çš„åˆ©ç”¨CPUï¼Œåœ¨ç¼–è¯‘å™¨å’ŒCPUæ‰§è¡ŒæœŸï¼Œéƒ½å¯èƒ½å¯¹æŒ‡ä»¤é‡æ’ã€‚ åœ¨å¹¶å‘æ¨¡å‹ä¸‹ï¼Œé‡æ’åºè¿˜æ˜¯å¯èƒ½ä¼šå¼•å‘é—®é¢˜ï¼Œæ¯”è¾ƒç»å…¸çš„å°±æ˜¯â€œå•ä¾‹æ¨¡å¼å¤±æ•ˆâ€é—®é¢˜ 12345678910111213141516public class Singleton &#123; private static Singleton instance = null; private Singleton() &#123; &#125; public static Singleton getInstance() &#123; if(instance == null) &#123; synchronzied(Singleton.class) &#123; if(instance == null) &#123; instance = new Singleton(); // &#125; &#125; &#125; return instance; &#125;&#125; ä¸Šé¢è¿™æ®µä»£ç ï¼Œåˆçœ‹æ²¡é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¹¶å‘æ¨¡å‹ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºé”™,é‚£æ˜¯å› ä¸ºinstance= new Singleton()å¹¶éä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒå®é™…ä¸Šä¸‹é¢è¿™ä¸‰ä¸ªæ“ä½œï¼š 123memory = allocate(); //1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´ctorInstance(memory); //2ï¼šåˆå§‹åŒ–å¯¹è±¡instance = memory; //3ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ ä¸Šé¢æ“ä½œ2ä¾èµ–äºæ“ä½œ1ï¼Œä½†æ˜¯æ“ä½œ3å¹¶ä¸ä¾èµ–äºæ“ä½œ2ï¼Œæ‰€ä»¥JVMæ˜¯å¯ä»¥é’ˆå¯¹å®ƒä»¬è¿›è¡ŒæŒ‡ä»¤çš„ä¼˜åŒ–é‡æ’åºçš„ï¼Œç»è¿‡é‡æ’åºåå¦‚ä¸‹ï¼š 123memory = allocate(); //1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´instance = memory; //3ï¼šinstanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ï¼Œæ­¤æ—¶å¯¹è±¡è¿˜æœªåˆå§‹åŒ–ctorInstance(memory); //2ï¼šåˆå§‹åŒ–å¯¹è±¡ å¯ä»¥çœ‹åˆ°æŒ‡ä»¤é‡æ’ä¹‹åï¼ŒinstanceæŒ‡å‘åˆ†é…å¥½çš„å†…å­˜æ”¾åœ¨äº†å‰é¢ï¼Œè€Œè¿™æ®µå†…å­˜çš„åˆå§‹åŒ–è¢«æ’åœ¨äº†åé¢ã€‚åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¯èƒ½Açº¿ç¨‹æ‰§è¡Œåˆ°äº†3ï¼ŒBçº¿ç¨‹å‘ç°å·²ç»ä¸ä¸ºç©ºå°±è¿”å›ç»§ç»­æ‰§è¡Œï¼Œå°±ä¼šå‡ºé”™ã€‚ åœ¨javaé‡Œé¢volatileå¯ä»¥é˜²æ­¢é‡æ’ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªä½œç”¨å³å†…å­˜å¯è§æ€§ å†…å­˜å±éšœç¡¬ä»¶å±‚çš„å†…å­˜å±éšœåˆ†ä¸ºä¸¤ç§ï¼šLoad Barrier å’Œ Store Barrierå³è¯»å±éšœå’Œå†™å±éšœã€‚å†…å­˜å±éšœæœ‰ä¸¤ä¸ªä½œç”¨ï¼š é˜»æ­¢å±éšœä¸¤ä¾§çš„æŒ‡ä»¤é‡æ’åºï¼› å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜ä¸­çš„è„æ•°æ®ç­‰å†™å›ä¸»å†…å­˜ï¼Œè®©ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å¤±æ•ˆã€‚ å¯¹äºvolatileå…³é”®å­—ï¼ŒæŒ‰ç…§è§„èŒƒä¼šæœ‰ä¸‹é¢çš„æ“ä½œï¼š åœ¨æ¯ä¸ªvolatileå†™å…¥ä¹‹å‰ï¼Œæ’å…¥ä¸€ä¸ªStoreStoreï¼Œå†™å…¥ä¹‹åï¼Œæ’å…¥ä¸€ä¸ªStoreLoad åœ¨æ¯ä¸ªvolatileè¯»å–ä¹‹å‰ï¼Œæ’å…¥LoadLoadï¼Œä¹‹åæ’å…¥LoadStore Javaå†…å­˜æ¨¡å‹","categories":[{"name":"Java","slug":"Java","permalink":"https://jigangduan.github.io/categories/Java/"},{"name":"é«˜å¹¶å‘","slug":"Java/é«˜å¹¶å‘","permalink":"https://jigangduan.github.io/categories/Java/é«˜å¹¶å‘/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"}]},{"title":"Javaé«˜å¹¶å‘(1) ä»‹ç»","slug":"java-high-concurrency-01","date":"2019-04-17T12:54:14.000Z","updated":"2020-07-25T02:57:18.210Z","comments":true,"path":"2019/04/17/java-high-concurrency-01/","link":"","permalink":"https://jigangduan.github.io/2019/04/17/java-high-concurrency-01/","excerpt":"","text":"ç›¸å…³æ¦‚å¿µå¹¶å‘çŸ¥è¯†ç‚¹ï¼š çº¿ç¨‹å®‰å…¨ çº¿ç¨‹å°é—­ çº¿ç¨‹è°ƒåº¦ åŒæ­¥å®¹å™¨ å¹¶å‘å®¹å™¨ AQS J.U.C â€¦ é«˜å¹¶å‘è§£å†³æ€è·¯ä¸æ‰‹æ®µï¼š æ‰©å®¹ ç¼“å­˜ é˜Ÿåˆ— æ‹†åˆ† æœåŠ¡é™çº§ä¸ç†”æ–­ æ•°æ®åº“åˆ‡åº“ åˆ†åº“åˆ†è¡¨ â€¦ ç®€å•åœºæ™¯ä¸¾ä¾‹ç®€å•è®¡æ•° Demo 1 - CountExample 1234567891011121314151617181920212223242526272829303132333435package com.mmall.demo;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;public class CountExample &#123; private static int threadTotal = 200; private static int clientTotal = 5000; private static long count = 0; public static void main(String[] args) &#123; ExecutorService exec = Executors.newCachedThreadPool(); final Semaphore semaphore = new Semaphore(threadTotal); for (int i = 0; i &lt; clientTotal; i++) &#123; exec.execute(() -&gt; &#123; try &#123; semaphore.acquire(); add(); semaphore.release(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; exec.shutdown(); System.out.println(count); &#125; private static void add() &#123; count++; &#125;&#125; ä½¿ç”¨çº¿ç¨‹æ± å’Œä¿¡å·é‡(Semaphore)ï¼Œä½¿ç”¨æ•´å‹è®¡æ•°ã€‚ è¾“å‡ºç»“æœï¼š 1234998Process finished with exit code 0 æ¯æ¬¡è¾“å‡ºç»“æœéƒ½ä¸ä¸€æ · Demo 2 - MapExample 123456789101112131415161718192021222324252627282930313233343536373839package com.mmall.demo;import java.util.HashMap;import java.util.Map;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;import java.util.concurrent.Semaphore;public class MapExample &#123; private static int threadTotal = 200; private static int clientTotal = 5000; private static Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); public static void main(String[] args) &#123; ExecutorService exec = Executors.newCachedThreadPool(); final Semaphore semaphore = new Semaphore(threadTotal); for (int i = 0; i &lt; clientTotal; i++) &#123; final int threadNmu = i; exec.execute(() -&gt; &#123; try &#123; semaphore.acquire(); func(threadNmu); semaphore.release(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); &#125; exec.shutdown(); System.out.println(map.size()); &#125; private static void func(int threadNmu) &#123; map.put(threadNmu, threadNmu); &#125;&#125; åŒæ ·ä½¿ç”¨çº¿ç¨‹æ± å’Œä¿¡å·é‡(Semaphore)ï¼Œä½†ä½¿ç”¨Mapè®¡æ•°ã€‚ è¾“å‡ºç»“æœï¼š 1234999Process finished with exit code 0 æ¯æ¬¡è¾“å‡ºç»“æœéƒ½ä¸ä¸€æ · å¹¶å‘ä¸é«˜å¹¶å‘åŸºæœ¬æ¦‚å¿µå¹¶å‘åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ï¼Œå¦‚æœç¨‹åºåœ¨å•æ ¸å¤„ç†å™¨ä¸Šè¿è¡Œï¼Œå¤šä¸ªçº¿ç¨‹å°†äº¤æ›¿åœ°æ¢å…¥æˆ–è€…æ¢å‡ºå†…å®¹ï¼Œè¿™äº›çº¿ç¨‹æ˜¯åŒæ—¶å­˜åœ¨çš„ï¼Œæ¯ä¸ªçº¿ç¨‹å¤„äºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸ªçŠ¶æ€ï¼Œå¦‚æœè¿è¡Œåœ¨å¤šæ ¸å¤„ç†ä¸Šæ—¶ï¼Œç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½å°†åˆ†é…åˆ°ä¸€ä¸ªå¤„ç†å™¨æ ¸ä¸Šï¼Œå› æ­¤å¯ä»¥åŒæ—¶è¿è¡Œã€‚ é«˜å¹¶å‘(High Concurrency)é«˜å¹¶å‘æ˜¯äº’è”ç½‘åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ï¼Œå®ƒé€šå¸¸æ˜¯æŒ‡ï¼Œé€šè¿‡è®¾è®¡ä¿è¯ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¹¶è¡Œå¤„ç†å¾ˆå¤šè¯·æ±‚ã€‚ æ¯”è¾ƒ å¹¶å‘ï¼š å¤šä¸ªçº¿ç¨‹æ“ä½œç›¸åŒçš„èµ„æºï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆç†ä½¿ç”¨èµ„æº é«˜å¹¶å‘ï¼š æœåŠ¡èƒ½åŒæ—¶å¤„ç†å¾ˆå¤šè¯·æ±‚ï¼Œæé«˜ç¨‹åºæ€§èƒ½ æ¶‰åŠçŸ¥è¯†ç‚¹ çŸ¥è¯†æŠ€èƒ½ åŸºç¡€æ¡†æ¶ï¼š Spring Boot, Maven, JDK8, MySQL åŸºç¡€ç»„ä»¶ï¼š Mybatis, Guava, Lombok, Redis, Kafka é«˜çº§ç±»ï¼š Joda-Time, AtomicåŒ…, J.U.C, AQS, ThreadLoacl, RateLimiter, Hystrix, threadPool, shardbatis, curator, elastic-jobâ€¦","categories":[{"name":"Java","slug":"Java","permalink":"https://jigangduan.github.io/categories/Java/"},{"name":"é«˜å¹¶å‘","slug":"Java/é«˜å¹¶å‘","permalink":"https://jigangduan.github.io/categories/Java/é«˜å¹¶å‘/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"}]},{"title":"Spring Cloud Alibaba(1) nacosæœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"spring-cloud-alibaba-nacos-p1","date":"2019-03-20T08:58:53.000Z","updated":"2020-07-25T02:57:18.228Z","comments":true,"path":"2019/03/20/spring-cloud-alibaba-nacos-p1/","link":"","permalink":"https://jigangduan.github.io/2019/03/20/spring-cloud-alibaba-nacos-p1/","excerpt":"","text":"","categories":[{"name":"Spring Cloud Alibaba","slug":"Spring-Cloud-Alibaba","permalink":"https://jigangduan.github.io/categories/Spring-Cloud-Alibaba/"},{"name":"Spring Cloud","slug":"Spring-Cloud-Alibaba/Spring-Cloud","permalink":"https://jigangduan.github.io/categories/Spring-Cloud-Alibaba/Spring-Cloud/"},{"name":"Spring","slug":"Spring-Cloud-Alibaba/Spring-Cloud/Spring","permalink":"https://jigangduan.github.io/categories/Spring-Cloud-Alibaba/Spring-Cloud/Spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring cloud","slug":"spring-cloud","permalink":"https://jigangduan.github.io/tags/spring-cloud/"},{"name":"nacos","slug":"nacos","permalink":"https://jigangduan.github.io/tags/nacos/"}]},{"title":"react-parsing-2","slug":"react-parsing-2","date":"2019-03-18T14:12:13.000Z","updated":"2020-07-25T02:57:18.226Z","comments":true,"path":"2019/03/18/react-parsing-2/","link":"","permalink":"https://jigangduan.github.io/2019/03/18/react-parsing-2/","excerpt":"","text":"å‡†å¤‡å·¥ä½œ æºç åœ°å€ä»¥åŠç›®å½•ç»“æ„ Reactå’ŒReact-Dom Flow Type","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"React è§£æ","slug":"React/React-è§£æ","permalink":"https://jigangduan.github.io/categories/React/React-è§£æ/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"}]},{"title":"React è§£æ(1) - API","slug":"react-parsing","date":"2019-03-18T11:30:16.000Z","updated":"2020-07-25T02:57:18.226Z","comments":true,"path":"2019/03/18/react-parsing/","link":"","permalink":"https://jigangduan.github.io/2019/03/18/react-parsing/","excerpt":"","text":"React çš„ç‰¹è‰² React æ˜¯çº¯ç²¹çš„æ¡†æ¶ 1UI = fn(x) åªèƒ½ä½¿ç”¨setStateï¼Œæ²¡æœ‰åŒå‘æ•°æ®ç»‘å®š æ€æƒ³è¶…å¼ºï¼ŒReact16é‡å†™äº†åº•å±‚ä½†ä¸€ç‚¹éƒ½ä¸å½±å“ä¸Šå±‚ä»£ç  Fiber: æ”¹å˜äº†ä¹‹å‰reactçš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶ï¼Œæ–°çš„æ¶æ„ä½¿åŸæ¥åŒæ­¥æ¸²æŸ“çš„ç»„ä»¶ç°åœ¨å¯ä»¥å¼‚æ­¥åŒ–ï¼Œå¯ä¸­é€”ä¸­æ–­æ¸²æŸ“ï¼Œæ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œé‡Šæ”¾æµè§ˆå™¨ä¸»çº¿ç¨‹ã€‚ React API createElement createContext JSX =&gt; JS ConcurrentMode Ref Component Suspense Hooks Reactä¸­çš„æ›´æ–°åˆ›å»º ReactDOM.render Fiber UpdateQueue FiberRoot Update expirationTime React Schedulerï¼ˆè°ƒåº¦ï¼‰ scheduleWork batchedUpdates performWork performUnitOfWork requestWork react scheduler renderRoot å¼€å§‹æ›´æ–° beginWorkä»¥åŠä¼˜åŒ– å„ç±»ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ è°ƒå’Œå­èŠ‚ç‚¹çš„è¿‡ç¨‹ å®Œæˆå„ä¸ªèŠ‚ç‚¹çš„æ›´æ–° completeUnitOfWork completeWork unwindWork è™šæ‹ŸDOMå¯¹æ¯” é”™è¯¯æ•è·å¤„ç† å®Œæˆæ•´æ£µæ ‘æ›´æ–° æäº¤æ›´æ–° commitRootæ•´ä½“æµç¨‹ å¼€å‘æ—¶çš„å¸®åŠ©æ–¹æ³• æäº¤å¿«ç…§ æäº¤DOMæ’å…¥ æäº¤DOMæ›´æ–° æäº¤DOMåˆ é™¤ æäº¤æ‰€æœ‰å£°æ˜å‘¨æœŸ å„ç§åŠŸèƒ½çš„å®ç°è¿‡ç¨‹ contextçš„å®ç°è¿‡ç¨‹ refçš„å®ç°è¿‡ç¨‹ hydrateçš„å®ç°è¿‡ç¨‹ Reactçš„äº‹ä»¶ä½“ç³» Suspense æ›´æ–°ä¼˜å…ˆçº§çš„æ¦‚å¿µ Suspenseç»„ä»¶æ›´æ–° retryæ›´æ–°å°è¯•æ¸²æŸ“ æ›´æ–°æŒ‚èµ·çš„æ¦‚å¿µ timeoutå¤„ç† lazyç»„ä»¶æ›´æ–° Hooks æ ¸å¿ƒåŸç† useState useEffect useContext å…¶å®ƒHooks API Reactçš„æºç å®ç° Fiber, Update, Schedulerç­‰æ ¸å¿ƒç€é‡è®²è§£ æµç¨‹å›¾å’Œç»“æ„å›¾è¾…åŠ©","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"React è§£æ","slug":"React/React-è§£æ","permalink":"https://jigangduan.github.io/categories/React/React-è§£æ/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"}]},{"title":"MySQL è§„èŒƒ","slug":"mysql-specification","date":"2019-03-13T04:53:32.000Z","updated":"2020-07-25T02:57:18.222Z","comments":true,"path":"2019/03/13/mysql-specification/","link":"","permalink":"https://jigangduan.github.io/2019/03/13/mysql-specification/","excerpt":"","text":"æ•°æ®åº“å‘½å æ•°æ®åº“åŸºæœ¬è®¾è®¡ æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨Innodbå­˜å‚¨å¼•æ“ æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨UTF8 æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨500ä¸‡ä»¥å†… è°¨æ…ä½¿ç”¨MySQLåˆ†åŒºè¡¨ å°½é‡åšåˆ°å†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œå‡å°è¡¨çš„å®½åº¦ ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ® ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯• ç¦æ­¢ä»å¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿæˆç¯å¢ƒæ•°æ®åº“ æ•°æ®åº“å­—æ®µ ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹ é¿å…ä½¿ç”¨TEXTã€BLOBæ•°æ®ç±»å‹ï¼Œæœ€å¸¸è§çš„TEXTç±»å‹å¯ä»¥å­˜å‚¨64kçš„æ•°æ® é¿å…ä½¿ç”¨ENUMç±»å‹ å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸ºNOT NULL ä½¿ç”¨TIMESTAMPï¼ˆ4ä¸ªå­—èŠ‚ï¼‰æˆ–DATETIMEç±»å‹ï¼ˆ8ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨æ—¶é—´ åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨decimalç±»å‹ ç´¢å¼• é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡5ä¸ª ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼• æ¯ä¸ªInnodbè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”® å¸¸è§ç´¢å¼•åˆ—å»ºè®® å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼• ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼• ç´¢å¼•SETè§„èŒƒ æ•°æ®åº“SQLå¼€å‘ å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢ å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼• æ•°æ®åº“è®¾è®¡æ—¶ï¼Œåº”è¯¥è¦å¯¹ä»¥åæ‰©å±•è¿›è¡Œè€ƒè™‘ ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œè¿›åˆ¶è·¨åº“æŸ¥è¯¢ ç¦æ­¢ä½¿ç”¨SELECT * å¿…é¡»ä½¿ç”¨SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢ ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„INSERTè¯­å¥ é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸ºjoinæ“ä½œ é¿å…ä½¿ç”¨JOINå…³è”å¤ªå¤šçš„è¡¨ å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•° å¯¹åº”åŒä¸€åˆ—è¿›è¡Œoråˆ¤æ–­æ—¶ï¼Œä½¿ç”¨inä»£æ›¿or ç¦æ­¢ä½¿ç”¨order by rand() è¿›è¡Œéšæœºæ’åº WHEREä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®— åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨UNION ALLè€Œä¸æ˜¯UNION æ‹†åˆ†å¤æ‚çš„å¤§SQLä¸ºå¤šä¸ªå°SQL æ•°æ®åº“æ“ä½œè¡Œä¸º è¶…100ä¸‡è¡Œçš„æ‰¹é‡å†™ï¼ˆUPDATEã€DELETEã€INSERTï¼‰æ“ä½œï¼Œè¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ å¯¹äºå¤§è¡¨ä½¿ç”¨pt-online-schema-changeä¿®æ”¹è¡¨ç»“æ„ ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆsuperæƒé™ å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·ï¼Œéµå¾ªæƒé™æœ€å°åŸåˆ™ æ•°æ®åº“å‘½å æ•°æ®åº“å¯¹è±¡åç§°å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯å¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰² æ•°æ®åº“å¯¹è±¡åç§°ç¦æ­¢ä½¿ç”¨mysqlä¿ç•™å…³é”®å­—ï¼ˆå¦‚æœè¡¨åä¸­åŒ…å«å…³é”®å­—æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å°†å…¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼‰ æ•°æ®åº“å¯¹è±¡çš„å‘½åè¦èƒ½åšåˆ°è§åè¯†æ„ï¼Œå¹¶ä¸”æœ€åä¸è¦è¶…è¿‡32ä¸ªå­—ç¬¦ ä¸´æ—¶åº“è¡¨å¿…é¡»ä»¥tmp_ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼Œå¤‡ä»½è¡¨å¿…é¡»ä»¥bak_ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸ(æ—¶é—´æˆ³)ä¸ºåç¼€ æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢ å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰ æ•°æ®åº“åŸºæœ¬è®¾è®¡æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨Innodbå­˜å‚¨å¼•æ“æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³Innodbæ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨Innodbå­˜å‚¨å¼•æ“ Innodb æ”¯æŒäº‹åŠ¡ï¼Œæ”¯æŒè¡Œçº§é”ï¼Œæ›´å¥½çš„æ¢å¤æ€§ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ mysql5.5ä¹‹å‰é»˜è®¤ä½¿ç”¨Myisamï¼Œ5.6ä»¥åé»˜è®¤çš„ä¸ºInnodb æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨UTF8å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆ æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Šä½¿ç”¨commentä»å¥æ·»åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ ä»ä¸€å¼€å§‹å°±è¿›è¡Œæ•°æ®å­—å…¸çš„ç»´æŠ¤ å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨500ä¸‡ä»¥å†…500ä¸‡å¹¶ä¸æ˜¯MySQLæ•°æ®åº“çš„é™åˆ¶ï¼Œè¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ï¼Œå¤‡ä»½ï¼Œæ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ å¯ä»¥ç”¨å†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œåˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å° è°¨æ…ä½¿ç”¨MySQLåˆ†åŒºè¡¨åˆ†åŒºè¡¨åœ¨ç‰©ç†ä¸Šè¡¨ç°ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨é€»è¾‘ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªè¡¨ è°¨æ…é€‰æ‹©åˆ†åŒºé”®ï¼Œè·¨åˆ†åŒºæŸ¥è¯¢æ•ˆç‡å¯èƒ½æ›´ä½ å»ºè®®é‡‡ç”¨ç‰©ç†åˆ†è¡¨çš„æ–¹å¼ç®¡ç†å¤§æ•°æ® å°½é‡åšåˆ°å†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œå‡å°è¡¨çš„å®½åº¦MySQLé™åˆ¶æ¯ä¸ªè¡¨æœ€å¤šå­˜å‚¨4096åˆ—ï¼Œå¹¶ä¸”æ¯ä¸€è¡Œæ•°æ®çš„å¤§å°ä¸èƒ½è¶…è¿‡65535å­—èŠ‚ å‡å°‘ç£ç›˜IO,ä¿è¯çƒ­æ•°æ®çš„å†…å­˜ç¼“å­˜å‘½ä¸­ç‡ï¼ˆè¡¨è¶Šå®½ï¼ŒæŠŠè¡¨è£…è½½è¿›å†…å­˜ç¼“å†²æ± æ—¶æ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§,ä¹Ÿä¼šæ¶ˆè€—æ›´å¤šçš„IOï¼‰ æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç¼“å­˜ï¼Œé¿å…è¯»å…¥æ— ç”¨çš„å†·æ•°æ®ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼ˆé¿å…æ›´å¤šçš„å…³è”æ“ä½œï¼‰ ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µé¢„ç•™å­—æ®µçš„å‘½åå¾ˆéš¾åšåˆ°è§åè¯†ä¹‰ é¢„ç•™å­—æ®µæ— æ³•ç¡®è®¤å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ— æ³•é€‰æ‹©åˆé€‚çš„ç±»å‹ å¯¹é¢„ç•™å­—æ®µç±»å‹çš„ä¿®æ”¹ï¼Œä¼šå¯¹è¡¨è¿›è¡Œé”å®š ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ®é€šå¸¸æ–‡ä»¶å¾ˆå¤§ï¼Œä¼šçŸ­æ—¶é—´å†…é€ æˆæ•°æ®é‡å¿«é€Ÿå¢é•¿ï¼Œæ•°æ®åº“è¿›è¡Œæ•°æ®åº“è¯»å–æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå¤§é‡çš„éšæœºIOæ“ä½œï¼Œæ–‡ä»¶å¾ˆå¤§æ—¶ï¼ŒIOæ“ä½œå¾ˆè€—æ—¶ é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•ç¦æ­¢ä»å¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿæˆç¯å¢ƒæ•°æ®åº“æ•°æ®åº“å­—æ®µä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹ åŸå›  åˆ—çš„å­—æ®µè¶Šå¤§ï¼Œå»ºç«‹ç´¢å¼•æ—¶æ‰€éœ€è¦çš„ç©ºé—´ä¹Ÿå°±è¶Šå¤§ï¼Œè¿™æ ·ä¸€é¡µä¸­æ‰€èƒ½å­˜å‚¨çš„ç´¢å¼•èŠ‚ç‚¹çš„æ•°é‡ä¹Ÿå°±è¶Šå°‘ä¹Ÿè¶Šå°‘ï¼Œåœ¨éå†æ—¶æ‰€éœ€è¦çš„IOæ¬¡æ•°ä¹Ÿå°±è¶Šå¤šï¼Œ ç´¢å¼•çš„æ€§èƒ½ä¹Ÿå°±è¶Šå·® æ–¹æ³• 1) å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ç±»å‹å­˜å‚¨ï¼Œå¦‚ï¼šå°†IPåœ°å€è½¬æ¢æˆæ•´å½¢æ•°æ® mysqlæä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç†ipåœ°å€ï¼š 12inet_ation æŠŠipè½¬æˆæ— ç¬¦å·æ•´å‹(4-8ä½)inet_ntoa æŠŠæ•´å‹çš„IPè½¬æˆåœ°å€ æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨inet_atonæŠŠipåœ°å€è½¬ä¸ºæ•´å‹ï¼Œå¯ä»¥èŠ‚çœç©ºé—´ã€‚æ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨inet_ntoaæŠŠæ•´å‹çš„ipåœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚ 2ï¼‰å¯¹äºéè´Ÿå‹çš„æ•°æ®ï¼ˆå¦‚è‡ªå¢IDã€æ•´å‹IPï¼‰æ¥è¯´ï¼Œè¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹æ¥å­˜å‚¨ å› ä¸ºï¼šæ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´ 12SIGNED INT -2147483648~2147483647UNSIGNED INT 0~4294967295 VARCHAR(N)ä¸­çš„Nä»£è¡¨çš„æ˜¯å­—ç¬¦æ•°ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•° ä½¿ç”¨UTF8å­˜å‚¨255ä¸ªæ±‰å­— Varchar(255)=765ä¸ªå­—èŠ‚ã€‚è¿‡å¤§çš„é•¿åº¦ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ é¿å…ä½¿ç”¨TEXTã€BLOBæ•°æ®ç±»å‹ï¼Œæœ€å¸¸è§çš„TEXTç±»å‹å¯ä»¥å­˜å‚¨64kçš„æ•°æ® å»ºè®®æŠŠBLOBæˆ–æ˜¯TEXTåˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ Mysqlå†…å­˜ä¸´æ—¶è¡¨ä¸æ”¯æŒTEXTã€BLOBè¿™æ ·çš„å¤§æ•°æ®ç±»å‹ï¼Œå¦‚æœæŸ¥è¯¢ä¸­åŒ…å«è¿™æ ·çš„æ•°æ®ï¼Œåœ¨æ’åºç­‰æ“ä½œæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå¿…é¡»ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨è¿›è¡Œã€‚ è€Œä¸”å¯¹äºè¿™ç§æ•°æ®ï¼ŒMysqlè¿˜æ˜¯è¦è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ï¼Œä¼šä½¿sqlæ€§èƒ½å˜å¾—å¾ˆå·®ï¼Œä½†æ˜¯ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ä½¿ç”¨è¿™æ ·çš„æ•°æ®ç±»å‹ã€‚ å¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œå»ºè®®æŠŠBLOBæˆ–æ˜¯TEXTåˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä¸€å®šä¸è¦ä½¿ç”¨select * è€Œåªéœ€è¦å–å‡ºå¿…è¦çš„åˆ—ï¼Œä¸éœ€è¦TEXTåˆ—çš„æ•°æ®æ—¶ä¸è¦å¯¹è¯¥åˆ—è¿›è¡ŒæŸ¥è¯¢ã€‚ TEXTæˆ–BLOBç±»å‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼• å› ä¸ºMySQLå¯¹ç´¢å¼•å­—æ®µé•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥TEXTç±»å‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¹¶ä¸”TEXTåˆ—ä¸Šæ˜¯ä¸èƒ½æœ‰é»˜è®¤å€¼çš„ã€‚ é¿å…ä½¿ç”¨ENUMç±»å‹ ä¿®æ”¹ENUMå€¼éœ€è¦ä½¿ç”¨ALTERè¯­å¥ ENUMç±»å‹çš„ORDER BYæ“ä½œæ•ˆç‡ä½ï¼Œéœ€è¦é¢å¤–æ“ä½œ ç¦æ­¢ä½¿ç”¨æ•°å€¼ä½œä¸ºENUMçš„æšä¸¾å€¼ å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸ºNOT NULLåŸå› ï¼š ç´¢å¼•NULLåˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ï¼› è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹NULLå€¼åšç‰¹åˆ«çš„å¤„ç† ä½¿ç”¨TIMESTAMPï¼ˆ4ä¸ªå­—èŠ‚ï¼‰æˆ–DATETIMEç±»å‹ï¼ˆ8ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨æ—¶é—´TIMESTAMP å­˜å‚¨çš„æ—¶é—´èŒƒå›´ 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07ã€‚ TIMESTAMP å ç”¨4å­—èŠ‚å’ŒINTç›¸åŒï¼Œä½†æ¯”INTå¯è¯»æ€§é«˜ è¶…å‡ºTIMESTAMPå–å€¼èŒƒå›´çš„ä½¿ç”¨DATETIMEç±»å‹å­˜å‚¨ã€‚ ç»å¸¸ä¼šæœ‰äººç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸå‹çš„æ•°æ®ï¼ˆä¸æ­£ç¡®çš„åšæ³•ï¼‰ï¼š ç¼ºç‚¹1ï¼šæ— æ³•ç”¨æ—¥æœŸå‡½æ•°è¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒ ç¼ºç‚¹2ï¼šç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸè¦å ç”¨æ›´å¤šçš„ç©ºé—´ åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨decimalç±»å‹ éç²¾å‡†æµ®ç‚¹ï¼šfloat,double ç²¾å‡†æµ®ç‚¹ï¼šdecimal Decimalç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯4ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨9ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚å¯ç”¨äºå­˜å‚¨æ¯”bigintæ›´å¤§çš„æ•´å‹æ•°æ®ã€‚ ç´¢å¼•é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡5ä¸ªç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆç‡åŒæ ·å¯ä»¥é™ä½æ•ˆç‡ã€‚ ç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„æ•ˆç‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚ å› ä¸ºmysqlä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œå°±ä¼šå¢åŠ mysqlä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼ŒåŒæ ·ä¼šé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚ ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ä¸ªsqlåªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ï¼Œ5.6ä»¥åï¼Œè™½ç„¶æœ‰äº†åˆå¹¶ç´¢å¼•çš„ä¼˜åŒ–æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯è¿œè¿œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªè”åˆç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼å¥½ æ¯ä¸ªInnodbè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®Innodbæ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚ æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ Innodbæ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„ã€‚ ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸é€‚ç”¨å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºè”åˆç´¢å¼•ï¼‰ ä¸è¦ä½¿ç”¨UUIDã€MD5ã€HASHã€å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ï¼‰ã€‚ ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢IDå€¼ã€‚ å¸¸è§ç´¢å¼•åˆ—å»ºè®® å‡ºç°åœ¨SELECTã€UPDATEã€DELETEè¯­å¥çš„WHEREä»å¥ä¸­çš„åˆ— åŒ…å«åœ¨ORDER BYã€GROUP BYã€DISTINCTä¸­çš„å­—æ®µ å¹¶ä¸è¦å°†ç¬¦åˆ1å’Œ2ä¸­çš„å­—æ®µçš„åˆ—éƒ½å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œé€šå¸¸å°†1ã€2ä¸­çš„å­—æ®µå»ºç«‹è”åˆç´¢å¼•æ•ˆæœæ›´å¥½ å¤šè¡¨joinçš„å…³è”åˆ— å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåºå»ºç«‹ç´¢å¼•çš„ç›®çš„æ˜¯ï¼šå¸Œæœ›é€šè¿‡ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå‡å°‘éšæœºIOï¼Œå¢åŠ æŸ¥è¯¢æ€§èƒ½ ï¼Œç´¢å¼•èƒ½è¿‡æ»¤å‡ºè¶Šå°‘çš„æ•°æ®ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å…¥çš„æ•°æ®ä¹Ÿå°±è¶Šå°‘ã€‚ åŒºåˆ†åº¦æœ€é«˜çš„æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆåŒºåˆ†åº¦=åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡/åˆ—çš„æ€»è¡Œæ•°ï¼‰ï¼› å°½é‡æŠŠå­—æ®µé•¿åº¦å°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆå› ä¸ºå­—æ®µé•¿åº¦è¶Šå°ï¼Œä¸€é¡µèƒ½å­˜å‚¨çš„æ•°æ®é‡è¶Šå¤§ï¼ŒIOæ€§èƒ½ä¹Ÿå°±è¶Šå¥½ï¼‰ï¼› ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ï¼ˆè¿™æ ·å¯ä»¥æ¯”è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ï¼‰ã€‚ é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•å› ä¸ºè¿™æ ·ä¼šå¢åŠ æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ã€‚ é‡å¤ç´¢å¼•ç¤ºä¾‹ï¼šprimary key(id)ã€index(id)ã€unique index(id) å†—ä½™ç´¢å¼•ç¤ºä¾‹ï¼šindex(a,b,c)ã€index(a,b)ã€index(a) ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚ è¦†ç›–ç´¢å¼•ï¼šå°±æ˜¯åŒ…å«äº†æ‰€æœ‰æŸ¥è¯¢å­—æ®µ(where,select,ordery by,group byåŒ…å«çš„å­—æ®µ)çš„ç´¢å¼• è¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š é¿å…Innodbè¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ Innodbæ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äºInnodbæ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œ å¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¯ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜è¦é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚è€Œåœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ ï¼Œå‡å°‘äº†IOæ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚ å¯ä»¥æŠŠéšæœºIOå˜æˆé¡ºåºIOåŠ å¿«æŸ¥è¯¢æ•ˆç‡ ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äºIOå¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ®IOè¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„IOè½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåºIOã€‚ ç´¢å¼•SETè§„èŒƒå°½é‡é¿å…ä½¿ç”¨å¤–é”®çº¦æŸ ä¸å»ºè®®ä½¿ç”¨å¤–é”®çº¦æŸï¼ˆforeign keyï¼‰ï¼Œä½†ä¸€å®šè¦åœ¨è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”é”®ä¸Šå»ºç«‹ç´¢å¼•ï¼› å¤–é”®å¯ç”¨äºä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§ï¼Œä½†å»ºè®®åœ¨ä¸šåŠ¡ç«¯å®ç°ï¼› å¤–é”®ä¼šå½±å“çˆ¶è¡¨å’Œå­è¡¨çš„å†™æ“ä½œä»è€Œé™ä½æ€§èƒ½ã€‚ æ•°æ®åº“SQLå¼€å‘å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œé¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›è®¡åˆ’ï¼Œå‡å°‘SQLç¼–è¯‘æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è§£å†³åŠ¨æ€SQLæ‰€å¸¦æ¥çš„SQLæ³¨å…¥çš„é—®é¢˜ åªä¼ å‚æ•°ï¼Œæ¯”ä¼ é€’SQLè¯­å¥æ›´é«˜æ•ˆ ç›¸åŒè¯­å¥å¯ä»¥ä¸€æ¬¡è§£æï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚ é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢éšå¼è½¬æ¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚å¦‚ï¼šselect name,phone from customer where id = &#39;111&#39;; å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼• é¿å…ä½¿ç”¨åŒ%å·çš„æŸ¥è¯¢æ¡ä»¶ å¦‚a like &#39;%123%&#39;ï¼Œï¼ˆå¦‚æœæ— å‰ç½®%,åªæœ‰åç½®%ï¼Œæ˜¯å¯ä»¥ç”¨åˆ°åˆ—ä¸Šçš„ç´¢å¼•çš„ï¼‰ ä¸€ä¸ªSQLåªèƒ½åˆ©ç”¨åˆ°å¤åˆç´¢å¼•ä¸­çš„ä¸€åˆ—è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ å¦‚ï¼šæœ‰ a,b,cåˆ—çš„è”åˆç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰aåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™åœ¨b,cåˆ—ä¸Šçš„ç´¢å¼•å°†ä¸ä¼šè¢«ç”¨åˆ°ï¼Œåœ¨å®šä¹‰è”åˆç´¢å¼•æ—¶ï¼Œå¦‚æœaåˆ—è¦ç”¨åˆ°èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œå°±è¦æŠŠaåˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å³ä¾§ã€‚ ä½¿ç”¨left joinæˆ– not existsæ¥ä¼˜åŒ–not inæ“ä½œ å› ä¸ºnot in ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•å¤±æ•ˆã€‚ æ•°æ®åº“è®¾è®¡æ—¶ï¼Œåº”è¯¥è¦å¯¹ä»¥åæ‰©å±•è¿›è¡Œè€ƒè™‘ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œè¿›åˆ¶è·¨åº“æŸ¥è¯¢ ä¸ºæ•°æ®åº“è¿ç§»å’Œåˆ†åº“åˆ†è¡¨ç•™å‡ºä½™åœ° é™ä½ä¸šåŠ¡è€¦åˆåº¦ é¿å…æƒé™è¿‡å¤§è€Œäº§ç”Ÿçš„å®‰å…¨é£é™© ç¦æ­¢ä½¿ç”¨SELECT * å¿…é¡»ä½¿ç”¨SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢åŸå› ï¼š æ¶ˆè€—æ›´å¤šçš„CPUå’ŒIOä»¥ç½‘ç»œå¸¦å®½èµ„æº æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼• å¯å‡å°‘è¡¨ç»“æ„å˜æ›´å¸¦æ¥çš„å½±å“ ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„INSERTè¯­å¥å¦‚ï¼šinsert into values (&#39;a&#39;,&#39;b&#39;,&#39;c&#39;); åº”ä½¿ç”¨insert into t(c1,c2,c3) values (&#39;a&#39;,&#39;b&#39;,&#39;c&#39;); é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸ºjoinæ“ä½œé€šå¸¸å­æŸ¥è¯¢åœ¨inå­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å•SQL(ä¸åŒ…å«unionã€group byã€order byã€limitä»å¥)æ—¶ï¼Œæ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ ä¼šå—åˆ°ä¸€å®šçš„å½±å“ï¼› ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ï¼› ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„CPUå’ŒIOèµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚ é¿å…ä½¿ç”¨JOINå…³è”å¤ªå¤šçš„è¡¨å¯¹äºMysqlæ¥è¯´ï¼Œæ˜¯å­˜åœ¨å…³è”ç¼“å­˜çš„ï¼Œç¼“å­˜çš„å¤§å°å¯ä»¥ç”±join_buffer_sizeå‚æ•°è¿›è¡Œè®¾ç½®ã€‚ åœ¨Mysqlä¸­ï¼Œå¯¹äºåŒä¸€ä¸ªSQLå¤šå…³è”ï¼ˆjoinï¼‰ä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå¤šåˆ†é…ä¸€ä¸ªå…³è”ç¼“å­˜ï¼Œå¦‚æœåœ¨ä¸€ä¸ªSQLä¸­å…³è”çš„è¡¨è¶Šå¤šï¼Œæ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ã€‚ å¦‚æœç¨‹åºä¸­å¤§é‡çš„ä½¿ç”¨äº†å¤šè¡¨å…³è”çš„æ“ä½œï¼ŒåŒæ—¶join_buffer_sizeè®¾ç½®çš„ä¹Ÿä¸åˆç†çš„æƒ…å†µä¸‹ï¼Œå°±å®¹æ˜“é€ æˆæœåŠ¡å™¨å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œå°±ä¼šå½±å“åˆ°æœåŠ¡å™¨æ•°æ®åº“æ€§èƒ½çš„ç¨³å®šæ€§ã€‚ åŒæ—¶å¯¹äºå…³è”æ“ä½œæ¥è¯´ï¼Œä¼šäº§ç”Ÿä¸´æ—¶è¡¨æ“ä½œï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡Mysqlæœ€å¤šå…è®¸å…³è”61ä¸ªè¡¨ï¼Œå»ºè®®ä¸è¶…è¿‡5ä¸ªã€‚ å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°æ•°æ®åº“æ›´é€‚åˆå¤„ç†æ‰¹é‡æ“ä½œ åˆå¹¶å¤šä¸ªç›¸åŒçš„æ“ä½œåˆ°ä¸€èµ·ï¼Œå¯ä»¥æé«˜å¤„ç†æ•ˆç‡ å¯¹åº”åŒä¸€åˆ—è¿›è¡Œoråˆ¤æ–­æ—¶ï¼Œä½¿ç”¨inä»£æ›¿orinçš„å€¼ä¸è¦è¶…è¿‡500ä¸ªinæ“ä½œå¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ï¼Œorå¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå°‘èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚ ç¦æ­¢ä½¿ç”¨order by rand() è¿›è¡Œéšæœºæ’åºä¼šæŠŠè¡¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­å¯¹æ‰€æœ‰æ•°æ®æ ¹æ®éšæœºç”Ÿæˆçš„å€¼è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ¯ä¸€è¡Œéƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„æ•°æ®é›†éå¸¸å¤§ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„CPUå’ŒIOåŠå†…å­˜èµ„æºã€‚ æ¨èåœ¨ç¨‹åºä¸­è·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç„¶åä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„æ–¹å¼ WHEREä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢æˆ–è®¡ç®—æ—¶ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ ä¸æ¨èï¼š 1where date(create_time)='20190101' æ¨èï¼š 1where create_time &gt;= '20190101' and create_time &lt; '20190102' åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨UNION ALLè€Œä¸æ˜¯UNION UNIONä¼šæŠŠä¸¤ä¸ªç»“æœé›†çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­åå†è¿›è¡Œå»é‡æ“ä½œ UNION ALLä¸ä¼šå†å¯¹ç»“æœé›†è¿›è¡Œå»é‡æ“ä½œ æ‹†åˆ†å¤æ‚çš„å¤§SQLä¸ºå¤šä¸ªå°SQL å¤§SQLï¼šé€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡CPUè¿›è¡Œè®¡ç®—çš„SQL MySQLï¼šä¸€ä¸ªSQLåªèƒ½ä½¿ç”¨ä¸€ä¸ªCPUè¿›è¡Œè®¡ç®— SQLæ‹†åˆ†åå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆç‡ æ•°æ®åº“æ“ä½œè¡Œä¸ºè¶…100ä¸‡è¡Œçš„æ‰¹é‡å†™ï¼ˆUPDATEã€DELETEã€INSERTï¼‰æ“ä½œï¼Œè¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿ ä¸»ä»ç¯å¢ƒä¸­ï¼Œå¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿï¼Œå¤§æ‰¹é‡çš„å†™æ“ä½œä¸€èˆ¬éƒ½éœ€è¦æ‰§è¡Œä¸€å®šé•¿çš„æ—¶é—´ï¼Œè€Œåªæœ‰å½“ä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šåœ¨å…¶ä»–ä»åº“ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥ä¼šé€ æˆä¸»åº“ä¸ä»åº“é•¿æ—¶é—´çš„å»¶è¿Ÿæƒ…å†µ binlogæ—¥å¿—ä¸ºrowæ ¼å¼æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿— å¤§æ‰¹é‡å†™æ“ä½œä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯å¯¹äºrowæ ¼å¼äºŒè¿›åˆ¶æ•°æ®è€Œè¨€ï¼Œç”±äºåœ¨rowæ ¼å¼ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®è¶Šå¤šï¼Œäº§ç”Ÿçš„æ—¥å¿—é‡ä¹Ÿå°±ä¼šè¶Šå¤šï¼Œæ—¥å¿—çš„ä¼ è¾“å’Œæ¢å¤æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿå°±è¶Šé•¿ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆä¸»ä»å»¶è¿Ÿçš„ä¸€ä¸ªåŸå› ã€‚ é¿å…äº§ç”Ÿå¤§äº‹åŠ¡æ“ä½œ å¤§æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼Œä¸€å®šæ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œçš„ï¼Œè¿™å°±ä¼šé€ æˆè¡¨ä¸­å¤§æ‰¹é‡æ•°æ®è¿›è¡Œé”å®šï¼Œä»è€Œå¯¼è‡´å¤§é‡çš„é˜»å¡ï¼Œé˜»å¡ä¼šå¯¹MySQLçš„æ€§èƒ½äº§ç”Ÿéå¸¸å¤§çš„å½±å“ã€‚ ç‰¹åˆ«æ˜¯é•¿æ—¶é—´çš„é˜»å¡ä¼šå æ»¡æ‰€æœ‰æ•°æ®åº“çš„å¯ç”¨è¿æ¥ï¼Œè¿™ä¼šä½¿ç”Ÿäº§ç¯å¢ƒä¸­çš„å…¶ä»–åº”ç”¨æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼Œå› æ­¤ä¸€å®šè¦æ³¨æ„å¤§æ‰¹é‡å†™æ“ä½œè¦è¿›è¡Œåˆ†æ‰¹ã€‚ å¯¹äºå¤§è¡¨ä½¿ç”¨pt-online-schema-changeä¿®æ”¹è¡¨ç»“æ„ é¿å…å¤§è¡¨ä¿®æ”¹äº§ç”Ÿçš„ä¸»ä»å»¶è¿Ÿ é¿å…åœ¨å¯¹è¡¨å­—æ®µè¿›è¡Œä¿®æ”¹æ—¶è¿›è¡Œé”è¡¨ å¯¹å¤§è¡¨æ•°æ®ç»“æ„çš„ä¿®æ”¹ä¸€å®šè¦è°¨æ…ï¼Œä¼šé€ æˆä¸¥é‡çš„é”è¡¨æ“ä½œï¼Œå°¤å…¶æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œæ˜¯ä¸èƒ½å®¹å¿çš„ã€‚ pt-online-schema-changeå®ƒä¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ªä¸åŸè¡¨ç»“æ„ç›¸åŒçš„æ–°è¡¨ï¼Œå¹¶ä¸”åœ¨æ–°è¡¨ä¸Šè¿›è¡Œè¡¨ç»“æ„çš„ä¿®æ”¹ï¼Œç„¶åå†æŠŠåŸè¡¨ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œå¹¶åœ¨åŸè¡¨ä¸­å¢åŠ ä¸€äº›è§¦å‘å™¨ã€‚ æŠŠåŸè¡¨ä¸­æ–°å¢çš„æ•°æ®ä¹Ÿå¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œåœ¨è¡Œæ‰€æœ‰æ•°æ®å¤åˆ¶å®Œæˆä¹‹åï¼ŒæŠŠæ–°è¡¨å‘½åæˆåŸè¡¨ï¼Œå¹¶æŠŠåŸæ¥çš„è¡¨åˆ é™¤æ‰ã€‚ æŠŠåŸæ¥ä¸€ä¸ªDDLæ“ä½œï¼Œåˆ†è§£æˆå¤šä¸ªå°çš„æ‰¹æ¬¡è¿›è¡Œã€‚ ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆsuperæƒé™å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•°é™åˆ¶æ—¶ï¼Œè¿˜è¿è¡Œ1ä¸ªæœ‰superæƒé™çš„ç”¨æˆ·è¿æ¥superæƒé™åªèƒ½ç•™ç»™DBAå¤„ç†é—®é¢˜çš„è´¦å·ä½¿ç”¨ã€‚ å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·ï¼Œéµå¾ªæƒé™æœ€å°åŸåˆ™ç¨‹åºä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ªDBä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“ ç¨‹åºä½¿ç”¨çš„è´¦å·åŸåˆ™ä¸Šä¸å‡†æœ‰dropæƒé™ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (20) è¡¨ç»´æŠ¤/æ‚é¡¹","slug":"mysql-notes-20","date":"2019-03-12T14:54:24.000Z","updated":"2020-07-25T02:57:18.221Z","comments":true,"path":"2019/03/12/mysql-notes-20/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-20/","excerpt":"","text":"è¡¨ç»´æŠ¤ åˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒ 1ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE è¡¨å ... æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯ 12CHECK TABLE tbl_name [, tbl_name] ... [option] ...option = &#123;QUICK | FAST | MEDIUM | EXTENDED | CHANGED&#125; æ•´ç†æ•°æ®æ–‡ä»¶çš„ç¢ç‰‡ 1OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... æ‚é¡¹ å¯ç”¨åå¼•å·ï¼ˆ`ï¼‰ä¸ºæ ‡è¯†ç¬¦ï¼ˆåº“åã€è¡¨åã€å­—æ®µåã€ç´¢å¼•ã€åˆ«åï¼‰åŒ…è£¹ï¼Œä»¥é¿å…ä¸å…³é”®å­—é‡åï¼ä¸­æ–‡ä¹Ÿå¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦ï¼ æ¯ä¸ªåº“ç›®å½•å­˜åœ¨ä¸€ä¸ªä¿å­˜å½“å‰æ•°æ®åº“çš„é€‰é¡¹æ–‡ä»¶db.optã€‚ æ³¨é‡Šï¼š å•è¡Œæ³¨é‡Š # æ³¨é‡Šå†…å®¹ å¤šè¡Œæ³¨é‡Š / æ³¨é‡Šå†…å®¹ / å•è¡Œæ³¨é‡Š â€“ æ³¨é‡Šå†…å®¹ (æ ‡å‡†SQLæ³¨é‡Šé£æ ¼ï¼Œè¦æ±‚åŒç ´æŠ˜å·ååŠ ä¸€ç©ºæ ¼ç¬¦ï¼ˆç©ºæ ¼ã€TABã€æ¢è¡Œç­‰ï¼‰) æ¨¡å¼é€šé…ç¬¦ï¼š _ ä»»æ„å•ä¸ªå­—ç¬¦ % ä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œç”šè‡³åŒ…æ‹¬é›¶å­—ç¬¦ å•å¼•å·éœ€è¦è¿›è¡Œè½¬ä¹‰ \\â€™ CMDå‘½ä»¤è¡Œå†…çš„è¯­å¥ç»“æŸç¬¦å¯ä»¥ä¸º â€œ;â€, â€œ\\Gâ€, â€œ\\gâ€ï¼Œä»…å½±å“æ˜¾ç¤ºç»“æœã€‚å…¶ä»–åœ°æ–¹è¿˜æ˜¯ç”¨åˆ†å·ç»“æŸã€‚delimiter å¯ä¿®æ”¹å½“å‰å¯¹è¯çš„è¯­å¥ç»“æŸç¬¦ã€‚ SQLå¯¹å¤§å°å†™ä¸æ•æ„Ÿ æ¸…é™¤å·²æœ‰è¯­å¥ï¼š\\c","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (19) ç”¨æˆ·å’Œæƒé™ç®¡ç†","slug":"mysql-notes-19","date":"2019-03-12T14:46:21.000Z","updated":"2020-07-25T02:57:18.220Z","comments":true,"path":"2019/03/12/mysql-notes-19/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-19/","excerpt":"","text":"rootå¯†ç é‡ç½® åœæ­¢MySQLæœåŠ¡ [Linux] /usr/local/mysql/bin/safe_mysqld â€“skip-grant-tables &amp; [Windows] mysqld â€“skip-grant-tables use mysql; UPDATE user SET PASSWORD=PASSWORD(â€œå¯†ç â€) WHERE user = â€œrootâ€; FLUSH PRIVILEGES; ç”¨æˆ·ä¿¡æ¯è¡¨ï¼šmysql.user åˆ·æ–°æƒé™1FLUSH PRIVILEGES; å¢åŠ ç”¨æˆ·1CREATE USER ç”¨æˆ·å IDENTIFIED BY [PASSWORD] å¯†ç (å­—ç¬¦ä¸²) å¿…é¡»æ‹¥æœ‰mysqlæ•°æ®åº“çš„å…¨å±€CREATE USERæƒé™ï¼Œæˆ–æ‹¥æœ‰INSERTæƒé™ã€‚ åªèƒ½åˆ›å»ºç”¨æˆ·ï¼Œä¸èƒ½èµ‹äºˆæƒé™ã€‚ ç”¨æˆ·åï¼Œæ³¨æ„å¼•å·ï¼šå¦‚ â€˜user_nameâ€˜@â€™192.168.1.1â€™ å¯†ç ä¹Ÿéœ€å¼•å·ï¼Œçº¯æ•°å­—å¯†ç ä¹Ÿè¦åŠ å¼•å· è¦åœ¨çº¯æ–‡æœ¬ä¸­æŒ‡å®šå¯†ç ï¼Œéœ€å¿½ç•¥PASSWORDå…³é”®è¯ã€‚è¦æŠŠå¯†ç æŒ‡å®šä¸ºç”±PASSWORD()å‡½æ•°è¿”å›çš„æ··ç¼–å€¼ï¼Œéœ€åŒ…å«å…³é”®å­—PASSWORD é‡å‘½åç”¨æˆ·1RENAME USER old_user TO new_user è®¾ç½®å¯†ç 12SET PASSWORD = PASSWORD('å¯†ç ') -- ä¸ºå½“å‰ç”¨æˆ·è®¾ç½®å¯†ç SET PASSWORD FOR ç”¨æˆ·å = PASSWORD('å¯†ç ') -- ä¸ºæŒ‡å®šç”¨æˆ·è®¾ç½®å¯†ç  åˆ é™¤ç”¨æˆ·1DROP USER ç”¨æˆ·å åˆ†é…æƒé™/æ·»åŠ ç”¨æˆ·1GRANT æƒé™åˆ—è¡¨ ON è¡¨å TO ç”¨æˆ·å [IDENTIFIED BY [PASSWORD] 'password'] all privileges è¡¨ç¤ºæ‰€æœ‰æƒé™ . è¡¨ç¤ºæ‰€æœ‰åº“çš„æ‰€æœ‰è¡¨ åº“å.è¡¨å è¡¨ç¤ºæŸåº“ä¸‹é¢çš„æŸè¡¨ 1GRANT ALL PRIVILEGES ON `pms`.* TO 'pms'@'%' IDENTIFIED BY 'pms0817'; æŸ¥çœ‹æƒé™1SHOW GRANTS FOR ç”¨æˆ·å æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ 1SHOW GRANTS; æˆ– 1SHOW GRANTS FOR CURRENT_USER; æˆ– SHOW GRANTS FOR CURRENT_USER(); æ’¤æ¶ˆæƒé™12REVOKE æƒé™åˆ—è¡¨ ON è¡¨å FROM ç”¨æˆ·åREVOKE ALL PRIVILEGES, GRANT OPTION FROM ç”¨æˆ·å -- æ’¤é”€æ‰€æœ‰æƒé™ æƒé™å±‚çº§è¦ä½¿ç”¨GRANTæˆ–REVOKEï¼Œæ‚¨å¿…é¡»æ‹¥æœ‰GRANT OPTIONæƒé™ï¼Œå¹¶ä¸”æ‚¨å¿…é¡»ç”¨äºæ‚¨æ­£åœ¨æˆäºˆæˆ–æ’¤é”€çš„æƒé™ã€‚ å…¨å±€å±‚çº§ï¼šå…¨å±€æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šæœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ•°æ®åº“ï¼Œmysql.user GRANT ALL ON .å’Œ REVOKE ALL ON .åªæˆäºˆå’Œæ’¤é”€å…¨å±€æƒé™ã€‚ æ•°æ®åº“å±‚çº§ï¼šæ•°æ®åº“æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰ç›®æ ‡ï¼Œmysql.db, mysql.host GRANT ALL ON db_name.å’ŒREVOKE ALL ON db_name.åªæˆäºˆå’Œæ’¤é”€æ•°æ®åº“æƒé™ã€‚ è¡¨å±‚çº§ï¼šè¡¨æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šè¡¨ä¸­çš„æ‰€æœ‰åˆ—ï¼Œmysql.talbes_priv GRANT ALL ON db_name.tbl_nameå’ŒREVOKE ALL ON db_name.tbl_nameåªæˆäºˆå’Œæ’¤é”€è¡¨æƒé™ã€‚ åˆ—å±‚çº§ï¼šåˆ—æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šè¡¨ä¸­çš„å•ä¸€åˆ—ï¼Œmysql.columns_priv å½“ä½¿ç”¨REVOKEæ—¶ï¼Œæ‚¨å¿…é¡»æŒ‡å®šä¸è¢«æˆæƒåˆ—ç›¸åŒçš„åˆ—ã€‚ æƒé™åˆ—è¡¨12345678910111213141516171819202122232425262728ALL [PRIVILEGES] -- è®¾ç½®é™¤GRANT OPTIONä¹‹å¤–çš„æ‰€æœ‰ç®€å•æƒé™ALTER -- å…è®¸ä½¿ç”¨ALTER TABLEALTER ROUTINE -- æ›´æ”¹æˆ–å–æ¶ˆå·²å­˜å‚¨çš„å­ç¨‹åºCREATE -- å…è®¸ä½¿ç”¨CREATE TABLECREATE ROUTINE -- åˆ›å»ºå·²å­˜å‚¨çš„å­ç¨‹åºCREATE TEMPORARY TABLES -- å…è®¸ä½¿ç”¨CREATE TEMPORARY TABLECREATE USER -- å…è®¸ä½¿ç”¨CREATE USER, DROP USER, RENAME USERå’ŒREVOKE ALL PRIVILEGESã€‚CREATE VIEW -- å…è®¸ä½¿ç”¨CREATE VIEWDELETE -- å…è®¸ä½¿ç”¨DELETEDROP -- å…è®¸ä½¿ç”¨DROP TABLEEXECUTE -- å…è®¸ç”¨æˆ·è¿è¡Œå·²å­˜å‚¨çš„å­ç¨‹åºFILE -- å…è®¸ä½¿ç”¨SELECT...INTO OUTFILEå’ŒLOAD DATA INFILEINDEX -- å…è®¸ä½¿ç”¨CREATE INDEXå’ŒDROP INDEXINSERT -- å…è®¸ä½¿ç”¨INSERTLOCK TABLES -- å…è®¸å¯¹æ‚¨æ‹¥æœ‰SELECTæƒé™çš„è¡¨ä½¿ç”¨LOCK TABLESPROCESS -- å…è®¸ä½¿ç”¨SHOW FULL PROCESSLISTREFERENCES -- æœªè¢«å®æ–½RELOAD -- å…è®¸ä½¿ç”¨FLUSHREPLICATION CLIENT -- å…è®¸ç”¨æˆ·è¯¢é—®ä»å±æœåŠ¡å™¨æˆ–ä¸»æœåŠ¡å™¨çš„åœ°å€REPLICATION SLAVE -- ç”¨äºå¤åˆ¶å‹ä»å±æœåŠ¡å™¨ï¼ˆä»ä¸»æœåŠ¡å™¨ä¸­è¯»å–äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼‰SELECT -- å…è®¸ä½¿ç”¨SELECTSHOW DATABASES -- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“SHOW VIEW -- å…è®¸ä½¿ç”¨SHOW CREATE VIEWSHUTDOWN -- å…è®¸ä½¿ç”¨mysqladmin shutdownSUPER -- å…è®¸ä½¿ç”¨CHANGE MASTER, KILL, PURGE MASTER LOGSå’ŒSET GLOBALè¯­å¥ï¼Œmysqladmin debugå‘½ä»¤ï¼›å…è®¸æ‚¨è¿æ¥ï¼ˆä¸€æ¬¡ï¼‰ï¼Œå³ä½¿å·²è¾¾åˆ°max_connectionsã€‚UPDATE -- å…è®¸ä½¿ç”¨UPDATEUSAGE -- â€œæ— æƒé™â€çš„åŒä¹‰è¯GRANT OPTION -- å…è®¸æˆäºˆæƒé™","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (18) SQLç¼–ç¨‹","slug":"mysql-notes-18","date":"2019-03-12T14:23:24.000Z","updated":"2020-07-25T02:57:18.220Z","comments":true,"path":"2019/03/12/mysql-notes-18/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-18/","excerpt":"","text":"å±€éƒ¨å˜é‡å˜é‡å£°æ˜1declare var_name[,...] type [default value] è¿™ä¸ªè¯­å¥è¢«ç”¨æ¥å£°æ˜å±€éƒ¨å˜é‡ã€‚è¦ç»™å˜é‡æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¯·åŒ…å«ä¸€ä¸ªdefaultå­å¥ã€‚å€¼å¯ä»¥è¢«æŒ‡å®šä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸éœ€è¦ä¸ºä¸€ä¸ªå¸¸æ•°ã€‚å¦‚æœæ²¡æœ‰defaultå­å¥ï¼Œåˆå§‹å€¼ä¸ºnullã€‚ èµ‹å€¼ä½¿ç”¨ set å’Œ select into è¯­å¥ä¸ºå˜é‡èµ‹å€¼ã€‚ æ³¨æ„ï¼šåœ¨å‡½æ•°å†…æ˜¯å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ï¼ˆç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ï¼‰ å…¨å±€å˜é‡å®šä¹‰ã€èµ‹å€¼set è¯­å¥å¯ä»¥å®šä¹‰å¹¶ä¸ºå˜é‡èµ‹å€¼ã€‚ 1set @var = value; ä¹Ÿå¯ä»¥ä½¿ç”¨select intoè¯­å¥ä¸ºå˜é‡åˆå§‹åŒ–å¹¶èµ‹å€¼ã€‚è¿™æ ·è¦æ±‚selectè¯­å¥åªèƒ½è¿”å›ä¸€è¡Œï¼Œä½†æ˜¯å¯ä»¥æ˜¯å¤šä¸ªå­—æ®µï¼Œå°±æ„å‘³ç€åŒæ—¶ä¸ºå¤šä¸ªå˜é‡è¿›è¡Œèµ‹å€¼ï¼Œå˜é‡çš„æ•°é‡éœ€è¦ä¸æŸ¥è¯¢çš„åˆ—æ•°ä¸€è‡´ã€‚ è¿˜å¯ä»¥æŠŠèµ‹å€¼è¯­å¥çœ‹ä½œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé€šè¿‡selectæ‰§è¡Œå®Œæˆã€‚æ­¤æ—¶ä¸ºäº†é¿å…=è¢«å½“ä½œå…³ç³»è¿ç®—ç¬¦çœ‹å¾…ï¼Œä½¿ç”¨:=ä»£æ›¿ã€‚ï¼ˆsetè¯­å¥å¯ä»¥ä½¿ç”¨= å’Œ :=ï¼‰ã€‚ 123select @var:=20;select @v1:=id, @v2=name from t1 limit 1;select * from tbl_name where @var:=30; select into å¯ä»¥å°†è¡¨ä¸­æŸ¥è¯¢è·å¾—çš„æ•°æ®èµ‹ç»™å˜é‡ã€‚ 1select max(height) into @max_height from tb; è‡ªå®šä¹‰å˜é‡åä¸ºäº†é¿å…selectè¯­å¥ä¸­ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ä¸ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯å­—æ®µåï¼‰å†²çªï¼Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡åœ¨å˜é‡åå‰ä½¿ç”¨@ä½œä¸ºå¼€å§‹ç¬¦å·ã€‚ 1@var=10; å˜é‡è¢«å®šä¹‰åï¼Œåœ¨æ•´ä¸ªä¼šè¯å‘¨æœŸéƒ½æœ‰æ•ˆï¼ˆç™»å½•åˆ°é€€å‡ºï¼‰ æ§åˆ¶ç»“æ„ifè¯­å¥12345678if search_condition then statement_list[elseif search_condition then statement_list]...[else statement_list]end if; caseè¯­å¥1234CASE value WHEN [compare-value] THEN result[WHEN [compare-value] THEN result ...][ELSE result]END whileå¾ªç¯123[begin_label:] while search_condition do statement_listend while [end_label]; å¦‚æœéœ€è¦åœ¨å¾ªç¯å†…æå‰ç»ˆæ­¢ whileå¾ªç¯ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ ‡ç­¾ï¼›æ ‡ç­¾éœ€è¦æˆå¯¹å‡ºç°ã€‚ é€€å‡ºå¾ªç¯é€€å‡ºæ•´ä¸ªå¾ªç¯ leaveé€€å‡ºå½“å‰å¾ªç¯ iterateé€šè¿‡é€€å‡ºçš„æ ‡ç­¾å†³å®šé€€å‡ºå“ªä¸ªå¾ªç¯ å†…ç½®å‡½æ•°æ•°å€¼å‡½æ•°1234567891011abs(x) -- ç»å¯¹å€¼ abs(-10.9) = 10format(x, d) -- æ ¼å¼åŒ–åƒåˆ†ä½æ•°å€¼ format(1234567.456, 2) = 1,234,567.46ceil(x) -- å‘ä¸Šå–æ•´ ceil(10.1) = 11floor(x) -- å‘ä¸‹å–æ•´ floor (10.1) = 10round(x) -- å››èˆäº”å…¥å»æ•´mod(m, n) -- m%n m mod n æ±‚ä½™ 10%3=1pi() -- è·å¾—åœ†å‘¨ç‡pow(m, n) -- m^nsqrt(x) -- ç®—æœ¯å¹³æ–¹æ ¹rand() -- éšæœºæ•°truncate(x, d) -- æˆªå–dä½å°æ•° æ—¶é—´æ—¥æœŸå‡½æ•°12345678now(), current_timestamp(); -- å½“å‰æ—¥æœŸæ—¶é—´current_date(); -- å½“å‰æ—¥æœŸcurrent_time(); -- å½“å‰æ—¶é—´date('yyyy-mm-dd hh:ii:ss'); -- è·å–æ—¥æœŸéƒ¨åˆ†time('yyyy-mm-dd hh:ii:ss'); -- è·å–æ—¶é—´éƒ¨åˆ†date_format('yyyy-mm-dd hh:ii:ss', '%d %y %a %d %m %b %j'); -- æ ¼å¼åŒ–æ—¶é—´unix_timestamp(); -- è·å¾—unixæ—¶é—´æˆ³from_unixtime(); -- ä»æ—¶é—´æˆ³è·å¾—æ—¶é—´ å­—ç¬¦ä¸²å‡½æ•°1234567891011121314151617length(string) -- stringé•¿åº¦ï¼Œå­—èŠ‚char_length(string) -- stringçš„å­—ç¬¦ä¸ªæ•°substring(str, position [,length]) -- ä»strçš„positionå¼€å§‹,å–lengthä¸ªå­—ç¬¦replace(str ,search_str ,replace_str) -- åœ¨strä¸­ç”¨replace_stræ›¿æ¢search_strinstr(string ,substring) -- è¿”å›substringé¦–æ¬¡åœ¨stringä¸­å‡ºç°çš„ä½ç½®concat(string [,...]) -- è¿æ¥å­—ä¸²charset(str) -- è¿”å›å­—ä¸²å­—ç¬¦é›†lcase(string) -- è½¬æ¢æˆå°å†™left(string, length) -- ä»string2ä¸­çš„å·¦è¾¹èµ·å–lengthä¸ªå­—ç¬¦load_file(file_name) -- ä»æ–‡ä»¶è¯»å–å†…å®¹locate(substring, string [,start_position]) -- åŒinstr,ä½†å¯æŒ‡å®šå¼€å§‹ä½ç½®lpad(string, length, pad) -- é‡å¤ç”¨padåŠ åœ¨stringå¼€å¤´,ç›´åˆ°å­—ä¸²é•¿åº¦ä¸ºlengthltrim(string) -- å»é™¤å‰ç«¯ç©ºæ ¼repeat(string, count) -- é‡å¤countæ¬¡rpad(string, length, pad) --åœ¨stråç”¨padè¡¥å……,ç›´åˆ°é•¿åº¦ä¸ºlengthrtrim(string) -- å»é™¤åç«¯ç©ºæ ¼strcmp(string1 ,string2) -- é€å­—ç¬¦æ¯”è¾ƒä¸¤å­—ä¸²å¤§å° æµç¨‹å‡½æ•°case when [condition] then result [when [condition] then result â€¦] [else result] end å¤šåˆ†æ”¯if(expr1,expr2,expr3) åŒåˆ†æ”¯ã€‚ èšåˆå‡½æ•°123456count()sum();max();min();avg();group_concat() å…¶ä»–å¸¸ç”¨å‡½æ•°12md5();default(); å­˜å‚¨å‡½æ•°ï¼Œè‡ªå®šä¹‰å‡½æ•°æ–°å»º12CREATE FUNCTION function_name (å‚æ•°åˆ—è¡¨) RETURNS è¿”å›å€¼ç±»å‹ å‡½æ•°ä½“ å‡½æ•°åï¼Œåº”è¯¥åˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”ä¸åº”è¯¥ä¸å·²æœ‰çš„å…³é”®å­—å†²çªã€‚ ä¸€ä¸ªå‡½æ•°åº”è¯¥å±äºæŸä¸ªæ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨db_name.funciton_nameçš„å½¢å¼æ‰§è¡Œå½“å‰å‡½æ•°æ‰€å±æ•°æ®åº“ï¼Œå¦åˆ™ä¸ºå½“å‰æ•°æ®åº“ã€‚ å‚æ•°éƒ¨åˆ†ï¼Œç”±â€å‚æ•°åâ€å’Œâ€å‚æ•°ç±»å‹â€ç»„æˆã€‚å¤šä¸ªå‚æ•°ç”¨é€—å·éš”å¼€ã€‚ å‡½æ•°ä½“ç”±å¤šæ¡å¯ç”¨çš„mysqlè¯­å¥ï¼Œæµç¨‹æ§åˆ¶ï¼Œå˜é‡å£°æ˜ç­‰è¯­å¥æ„æˆã€‚ å¤šæ¡è¯­å¥åº”è¯¥ä½¿ç”¨ beginâ€¦end è¯­å¥å—åŒ…å«ã€‚ ä¸€å®šè¦æœ‰ return è¿”å›å€¼è¯­å¥ã€‚ åˆ é™¤1DROP FUNCTION [IF EXISTS] function_name; æŸ¥çœ‹12SHOW FUNCTION STATUS LIKE 'partten'SHOW CREATE FUNCTION function_name; ä¿®æ”¹1ALTER FUNCTION function_name å‡½æ•°é€‰é¡¹ å­˜å‚¨è¿‡ç¨‹ï¼Œè‡ªå®šä¹‰åŠŸèƒ½å®šä¹‰å­˜å‚¨å­˜å‚¨è¿‡ç¨‹ æ˜¯ä¸€æ®µä»£ç ï¼ˆè¿‡ç¨‹ï¼‰ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„sqlç»„æˆã€‚ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹é€šå¸¸ç”¨äºå®Œæˆä¸€æ®µä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚æŠ¥åï¼Œäº¤ç­è´¹ï¼Œè®¢å•å…¥åº“ç­‰ã€‚è€Œä¸€ä¸ªå‡½æ•°é€šå¸¸ä¸“æ³¨ä¸æŸä¸ªåŠŸèƒ½ï¼Œè§†ä¸ºå…¶ä»–ç¨‹åºæœåŠ¡çš„ï¼Œéœ€è¦åœ¨å…¶ä»–è¯­å¥ä¸­è°ƒç”¨å‡½æ•°æ‰å¯ä»¥ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸èƒ½è¢«å…¶ä»–è°ƒç”¨ï¼Œæ˜¯è‡ªå·±æ‰§è¡Œ é€šè¿‡callæ‰§è¡Œã€‚ åˆ›å»º1234CREATE PROCEDURE è¿‡ç¨‹å (å‚æ•°åˆ—è¡¨)BEGIN è¿‡ç¨‹ä½“END è°ƒç”¨ï¼šCALL è¿‡ç¨‹å å‚æ•°åˆ—è¡¨ï¼šä¸åŒäºå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œéœ€è¦æŒ‡æ˜å‚æ•°ç±»å‹IN|OUT|INOUT å‚æ•°å æ•°æ®ç±»å‹IN è¾“å…¥ï¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®è¾“å…¥åˆ°è¿‡ç¨‹ä½“å†…éƒ¨çš„å‚æ•°OUT è¾“å‡ºï¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå°†è¿‡ç¨‹ä½“å¤„ç†å®Œçš„ç»“æœè¿”å›åˆ°å®¢æˆ·ç«¯INOUT è¾“å…¥è¾“å‡ºï¼šæ—¢å¯è¾“å…¥ï¼Œä¹Ÿå¯è¾“å‡ºæ³¨æ„ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"MySQL ç¬”è®°","slug":"VS-Code/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/VS-Code/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (17) è§¦å‘å™¨","slug":"mysql-notes-17","date":"2019-03-12T14:09:56.000Z","updated":"2020-07-25T02:57:18.220Z","comments":true,"path":"2019/03/12/mysql-notes-17/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-17/","excerpt":"","text":"è§¦å‘ç¨‹åºæ˜¯ä¸è¡¨æœ‰å…³çš„å‘½åæ•°æ®åº“å¯¹è±¡ï¼Œå½“è¯¥è¡¨å‡ºç°ç‰¹å®šäº‹ä»¶æ—¶ï¼Œå°†æ¿€æ´»è¯¥å¯¹è±¡ç›‘å¬ï¼šè®°å½•çš„å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€‚ åˆ›å»ºè§¦å‘å™¨1CREATE TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_stmt å‚æ•°ï¼š trigger_timeæ˜¯è§¦å‘ç¨‹åºçš„åŠ¨ä½œæ—¶é—´ã€‚å®ƒå¯ä»¥æ˜¯ before æˆ– afterï¼Œä»¥æŒ‡æ˜è§¦å‘ç¨‹åºæ˜¯åœ¨æ¿€æ´»å®ƒçš„è¯­å¥ä¹‹å‰æˆ–ä¹‹åè§¦å‘ã€‚ trigger_eventæŒ‡æ˜äº†æ¿€æ´»è§¦å‘ç¨‹åºçš„è¯­å¥çš„ç±»å‹ INSERTï¼šå°†æ–°è¡Œæ’å…¥è¡¨æ—¶æ¿€æ´»è§¦å‘ç¨‹åº UPDATEï¼šæ›´æ”¹æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘ç¨‹åº DELETEï¼šä»è¡¨ä¸­åˆ é™¤æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘ç¨‹åº tbl_nameï¼šç›‘å¬çš„è¡¨ï¼Œå¿…é¡»æ˜¯æ°¸ä¹…æ€§çš„è¡¨ï¼Œä¸èƒ½å°†è§¦å‘ç¨‹åºä¸TEMPORARYè¡¨æˆ–è§†å›¾å…³è”èµ·æ¥ã€‚ trigger_stmtï¼šå½“è§¦å‘ç¨‹åºæ¿€æ´»æ—¶æ‰§è¡Œçš„è¯­å¥ã€‚æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œå¯ä½¿ç”¨BEGINâ€¦ENDå¤åˆè¯­å¥ç»“æ„ åˆ é™¤1DROP TRIGGER [schema_name.]trigger_name å¯ä»¥ä½¿ç”¨oldå’Œnewä»£æ›¿æ—§çš„å’Œæ–°çš„æ•°æ® æ›´æ–°æ“ä½œï¼Œæ›´æ–°å‰æ˜¯oldï¼Œæ›´æ–°åæ˜¯new. åˆ é™¤æ“ä½œï¼Œåªæœ‰old. å¢åŠ æ“ä½œï¼Œåªæœ‰new. æ³¨æ„å¯¹äºå…·æœ‰ç›¸åŒè§¦å‘ç¨‹åºåŠ¨ä½œæ—¶é—´å’Œäº‹ä»¶çš„ç»™å®šè¡¨ï¼Œä¸èƒ½æœ‰ä¸¤ä¸ªè§¦å‘ç¨‹åºã€‚ å­—ç¬¦è¿æ¥å‡½æ•°concat(str1,str2,â€¦])concat_ws(separator,str1,str2,â€¦) åˆ†æ”¯è¯­å¥if æ¡ä»¶ then æ‰§è¡Œè¯­å¥elseif æ¡ä»¶ then æ‰§è¡Œè¯­å¥else æ‰§è¡Œè¯­å¥end if; ä¿®æ”¹æœ€å¤–å±‚è¯­å¥ç»“æŸç¬¦delimiter è‡ªå®šä¹‰ç»“æŸç¬¦å· SQLè¯­å¥è‡ªå®šä¹‰ç»“æŸç¬¦å·delimiter ; â€“ ä¿®æ”¹å›åŸæ¥çš„åˆ†å·â€“ è¯­å¥å—åŒ…è£¹begin è¯­å¥å—end ç‰¹æ®Šçš„æ‰§è¡Œ åªè¦æ·»åŠ è®°å½•ï¼Œå°±ä¼šè§¦å‘ç¨‹åºã€‚ Insert into on duplicate key update è¯­æ³•ä¼šè§¦å‘ï¼š å¦‚æœæ²¡æœ‰é‡å¤è®°å½•ï¼Œä¼šè§¦å‘ before insert, after insert; å¦‚æœæœ‰é‡å¤è®°å½•å¹¶æ›´æ–°ï¼Œä¼šè§¦å‘ before insert, before update, after update; å¦‚æœæœ‰é‡å¤è®°å½•ä½†æ˜¯æ²¡æœ‰å‘ç”Ÿæ›´æ–°ï¼Œåˆ™è§¦å‘ before insert, before update Replace è¯­æ³• å¦‚æœæœ‰è®°å½•ï¼Œåˆ™æ‰§è¡Œ before insert, before delete, after delete, after insert","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (16) äº‹åŠ¡(transaction)/é”è¡¨","slug":"mysql-notes-16","date":"2019-03-12T13:59:07.000Z","updated":"2020-07-25T02:57:18.219Z","comments":true,"path":"2019/03/12/mysql-notes-16/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-16/","excerpt":"","text":"äº‹åŠ¡(transaction)äº‹åŠ¡æ˜¯æŒ‡é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œç»„æˆè¿™ç»„æ“ä½œçš„å„ä¸ªå•å…ƒï¼Œè¦ä¸å…¨æˆåŠŸè¦ä¸å…¨å¤±è´¥ã€‚ æ”¯æŒè¿ç»­SQLçš„é›†ä½“æˆåŠŸæˆ–é›†ä½“æ’¤é”€ã€‚ äº‹åŠ¡æ˜¯æ•°æ®åº“åœ¨æ•°æ®æ™šè‡ªä¹ æ–¹é¢çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ éœ€è¦åˆ©ç”¨ InnoDB æˆ– BDB å­˜å‚¨å¼•æ“ï¼Œå¯¹è‡ªåŠ¨æäº¤çš„ç‰¹æ€§æ”¯æŒå®Œæˆã€‚ InnoDBè¢«ç§°ä¸ºäº‹åŠ¡å®‰å…¨å‹å¼•æ“ã€‚ äº‹åŠ¡å¼€å¯START TRANSACTION; æˆ–è€… BEGIN; å¼€å¯äº‹åŠ¡åï¼Œæ‰€æœ‰è¢«æ‰§è¡Œçš„SQLè¯­å¥å‡è¢«è®¤ä½œå½“å‰äº‹åŠ¡å†…çš„SQLè¯­å¥ã€‚ äº‹åŠ¡æäº¤COMMIT; äº‹åŠ¡å›æ»šROLLBACK; å¦‚æœéƒ¨åˆ†æ“ä½œå‘ç”Ÿé—®é¢˜ï¼Œæ˜ å°„åˆ°äº‹åŠ¡å¼€å¯å‰ã€‚ äº‹åŠ¡çš„ç‰¹æ€§ åŸå­æ€§ï¼ˆAtomicityï¼‰ äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ äº‹åŠ¡å‰åæ•°æ®çš„å®Œæ•´æ€§å¿…é¡»ä¿æŒä¸€è‡´ã€‚ äº‹åŠ¡å¼€å§‹å’Œç»“æŸæ—¶ï¼Œå¤–éƒ¨æ•°æ®ä¸€è‡´ åœ¨æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œæ“ä½œæ˜¯è¿ç»­çš„ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶å®ƒç”¨æˆ·çš„äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´çš„æ•°æ®è¦ç›¸äº’éš”ç¦»ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚ äº‹åŠ¡çš„å®ç° è¦æ±‚æ˜¯äº‹åŠ¡æ”¯æŒçš„è¡¨ç±»å‹ æ‰§è¡Œä¸€ç»„ç›¸å…³çš„æ“ä½œå‰å¼€å¯äº‹åŠ¡ æ•´ç»„æ“ä½œå®Œæˆåï¼Œéƒ½æˆåŠŸï¼Œåˆ™æäº¤ï¼›å¦‚æœå­˜åœ¨å¤±è´¥ï¼Œé€‰æ‹©å›æ»šï¼Œåˆ™ä¼šå›åˆ°äº‹åŠ¡å¼€å§‹çš„å¤‡ä»½ç‚¹ã€‚ äº‹åŠ¡çš„åŸç†åˆ©ç”¨InnoDBçš„è‡ªåŠ¨æäº¤(autocommit)ç‰¹æ€§å®Œæˆã€‚æ™®é€šçš„MySQLæ‰§è¡Œè¯­å¥åï¼Œå½“å‰çš„æ•°æ®æäº¤æ“ä½œå‡å¯è¢«å…¶ä»–å®¢æˆ·ç«¯å¯è§ã€‚è€Œäº‹åŠ¡æ˜¯æš‚æ—¶å…³é—­â€œè‡ªåŠ¨æäº¤â€æœºåˆ¶ï¼Œéœ€è¦commitæäº¤æŒä¹…åŒ–æ•°æ®æ“ä½œã€‚ æ³¨æ„ æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰è¯­å¥ä¸èƒ½è¢«å›æ»šï¼Œæ¯”å¦‚åˆ›å»ºæˆ–å–æ¶ˆæ•°æ®åº“çš„è¯­å¥ï¼Œå’Œåˆ›å»ºã€å–æ¶ˆæˆ–æ›´æ”¹è¡¨æˆ–å­˜å‚¨çš„å­ç¨‹åºçš„è¯­å¥ã€‚ äº‹åŠ¡ä¸èƒ½è¢«åµŒå¥— ä¿å­˜ç‚¹SAVEPOINT ä¿å­˜ç‚¹åç§° â€“ è®¾ç½®ä¸€ä¸ªäº‹åŠ¡ä¿å­˜ç‚¹ROLLBACK TO SAVEPOINT ä¿å­˜ç‚¹åç§° â€“ å›æ»šåˆ°ä¿å­˜ç‚¹RELEASE SAVEPOINT ä¿å­˜ç‚¹åç§° â€“ åˆ é™¤ä¿å­˜ç‚¹ InnoDBè‡ªåŠ¨æäº¤ç‰¹æ€§è®¾ç½®SET autocommit = 0|1; 0è¡¨ç¤ºå…³é—­è‡ªåŠ¨æäº¤ï¼Œ1è¡¨ç¤ºå¼€å¯è‡ªåŠ¨æäº¤ã€‚ å¦‚æœå…³é—­äº†ï¼Œé‚£æ™®é€šæ“ä½œçš„ç»“æœå¯¹å…¶ä»–å®¢æˆ·ç«¯ä¹Ÿä¸å¯è§ï¼Œéœ€è¦commitæäº¤åæ‰èƒ½æŒä¹…åŒ–æ•°æ®æ“ä½œã€‚ ä¹Ÿå¯ä»¥å…³é—­è‡ªåŠ¨æäº¤æ¥å¼€å¯äº‹åŠ¡ã€‚ä½†ä¸START TRANSACTIONä¸åŒçš„æ˜¯ï¼Œ SET autocommitæ˜¯æ°¸ä¹…æ”¹å˜æœåŠ¡å™¨çš„è®¾ç½®ï¼Œç›´åˆ°ä¸‹æ¬¡å†æ¬¡ä¿®æ”¹è¯¥è®¾ç½®ã€‚(é’ˆå¯¹å½“å‰è¿æ¥) è€ŒSTART TRANSACTIONè®°å½•å¼€å¯å‰çš„çŠ¶æ€ï¼Œè€Œä¸€æ—¦äº‹åŠ¡æäº¤æˆ–å›æ»šåå°±éœ€è¦å†æ¬¡å¼€å¯äº‹åŠ¡ã€‚(é’ˆå¯¹å½“å‰äº‹åŠ¡) é”è¡¨è¡¨é”å®šåªç”¨äºé˜²æ­¢å…¶å®ƒå®¢æˆ·ç«¯è¿›è¡Œä¸æ­£å½“åœ°è¯»å–å’Œå†™å…¥MyISAM æ”¯æŒè¡¨é”ï¼ŒInnoDB æ”¯æŒè¡Œé” é”å®š LOCK TABLES tbl_name [AS alias] è§£é” UNLOCK TABLES","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (15) è§†å›¾","slug":"mysql-notes-15","date":"2019-03-12T13:51:54.000Z","updated":"2020-07-25T02:57:18.219Z","comments":true,"path":"2019/03/12/mysql-notes-15/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-15/","excerpt":"","text":"ä»€ä¹ˆæ˜¯è§†å›¾ï¼š è§†å›¾æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œå…¶å†…å®¹ç”±æŸ¥è¯¢å®šä¹‰ã€‚åŒçœŸå®çš„è¡¨ä¸€æ ·ï¼Œè§†å›¾åŒ…å«ä¸€ç³»åˆ—å¸¦æœ‰åç§°çš„åˆ—å’Œè¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­ä»¥å­˜å‚¨çš„æ•°æ®å€¼é›†å½¢å¼å­˜åœ¨ã€‚è¡Œå’Œåˆ—æ•°æ®æ¥è‡ªç”±å®šä¹‰è§†å›¾çš„æŸ¥è¯¢æ‰€å¼•ç”¨çš„è¡¨ï¼Œå¹¶ä¸”åœ¨å¼•ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆã€‚è§†å›¾å…·æœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼Œä½†ä¸å­˜åœ¨æ•°æ®æ–‡ä»¶ã€‚å¯¹å…¶ä¸­æ‰€å¼•ç”¨çš„åŸºç¡€è¡¨æ¥è¯´ï¼Œè§†å›¾çš„ä½œç”¨ç±»ä¼¼äºç­›é€‰ã€‚å®šä¹‰è§†å›¾çš„ç­›é€‰å¯ä»¥æ¥è‡ªå½“å‰æˆ–å…¶å®ƒæ•°æ®åº“çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ï¼Œæˆ–è€…å…¶å®ƒè§†å›¾ã€‚é€šè¿‡è§†å›¾è¿›è¡ŒæŸ¥è¯¢æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œé€šè¿‡å®ƒä»¬è¿›è¡Œæ•°æ®ä¿®æ”¹æ—¶çš„é™åˆ¶ä¹Ÿå¾ˆå°‘ã€‚è§†å›¾æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œå®ƒä¸»è¦å‡ºäºä¸¤ç§åŸå› ï¼šå®‰å…¨åŸå› ï¼Œè§†å›¾å¯ä»¥éšè—ä¸€äº›æ•°æ®ï¼Œå¦‚ï¼šç¤¾ä¼šä¿é™©åŸºé‡‘è¡¨ï¼Œå¯ä»¥ç”¨è§†å›¾åªæ˜¾ç¤ºå§“åï¼Œåœ°å€ï¼Œè€Œä¸æ˜¾ç¤ºç¤¾ä¼šä¿é™©å·å’Œå·¥èµ„æ•°ç­‰ï¼Œå¦ä¸€åŸå› æ˜¯å¯ä½¿å¤æ‚çš„æŸ¥è¯¢æ˜“äºç†è§£å’Œä½¿ç”¨ã€‚ åˆ›å»ºè§†å›¾1CREATE [OR REPLACE] [ALGORITHM = &#123;UNDEFINED | MERGE | TEMPTABLE&#125;] VIEW view_name [(column_list)] AS select_statement è§†å›¾åå¿…é¡»å”¯ä¸€ï¼ŒåŒæ—¶ä¸èƒ½ä¸è¡¨é‡åã€‚ è§†å›¾å¯ä»¥ä½¿ç”¨selectè¯­å¥æŸ¥è¯¢åˆ°çš„åˆ—åï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šç›¸åº”çš„åˆ—åã€‚ å¯ä»¥æŒ‡å®šè§†å›¾æ‰§è¡Œçš„ç®—æ³•ï¼Œé€šè¿‡ALGORITHMæŒ‡å®šã€‚ column_listå¦‚æœå­˜åœ¨ï¼Œåˆ™æ•°ç›®å¿…é¡»ç­‰äºSELECTè¯­å¥æ£€ç´¢çš„åˆ—æ•° æŸ¥çœ‹ç»“æ„1SHOW CREATE VIEW view_name åˆ é™¤è§†å›¾ åˆ é™¤è§†å›¾åï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ã€‚ å¯åŒæ—¶åˆ é™¤å¤šä¸ªè§†å›¾ã€‚ 1DROP VIEW [IF EXISTS] view_name ... ä¿®æ”¹è§†å›¾ç»“æ„ ä¸€èˆ¬ä¸ä¿®æ”¹è§†å›¾ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„æ›´æ–°è§†å›¾éƒ½ä¼šæ˜ å°„åˆ°è¡¨ä¸Šã€‚ 1ALTER VIEW view_name [(column_list)] AS select_statement è§†å›¾ä½œç”¨ ç®€åŒ–ä¸šåŠ¡é€»è¾‘ å¯¹å®¢æˆ·ç«¯éšè—çœŸå®çš„è¡¨ç»“æ„ è§†å›¾ç®—æ³•(ALGORITHM)MERGE åˆå¹¶ å°†è§†å›¾çš„æŸ¥è¯¢è¯­å¥ï¼Œä¸å¤–éƒ¨æŸ¥è¯¢éœ€è¦å…ˆåˆå¹¶å†æ‰§è¡Œï¼TEMPTABLE ä¸´æ—¶è¡¨ å°†è§†å›¾æ‰§è¡Œå®Œæ¯•åï¼Œå½¢æˆä¸´æ—¶è¡¨ï¼Œå†åšå¤–å±‚æŸ¥è¯¢ï¼UNDEFINED æœªå®šä¹‰(é»˜è®¤)ï¼ŒæŒ‡çš„æ˜¯MySQLè‡ªä¸»å»é€‰æ‹©ç›¸åº”çš„ç®—æ³•ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (14) å¤‡ä»½ä¸è¿˜åŸ","slug":"mysql-notes-14","date":"2019-03-12T13:49:42.000Z","updated":"2020-07-25T02:57:18.219Z","comments":true,"path":"2019/03/12/mysql-notes-14/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-14/","excerpt":"","text":"å¤‡ä»½ï¼Œå°†æ•°æ®çš„ç»“æ„ä¸è¡¨å†…æ•°æ®ä¿å­˜èµ·æ¥ã€‚ åˆ©ç”¨ mysqldump æŒ‡ä»¤å®Œæˆã€‚ å¯¼å‡ºmysqldump [options] db_name [tables]mysqldump [options] â€”database DB1 [DB2 DB3â€¦]mysqldump [options] â€“allâ€“database å¯¼å‡ºä¸€å¼ è¡¨ mysqldump -uç”¨æˆ·å -på¯†ç  åº“å è¡¨å &gt; æ–‡ä»¶å(D:/a.sql) å¯¼å‡ºå¤šå¼ è¡¨ mysqldump -uç”¨æˆ·å -på¯†ç  åº“å è¡¨1 è¡¨2 è¡¨3 &gt; æ–‡ä»¶å(D:/a.sql) å¯¼å‡ºæ‰€æœ‰è¡¨ mysqldump -uç”¨æˆ·å -på¯†ç  åº“å &gt; æ–‡ä»¶å(D:/a.sql) å¯¼å‡ºä¸€ä¸ªåº“ mysqldump -uç”¨æˆ·å -på¯†ç  â€“lock-all-tables â€“database åº“å &gt; æ–‡ä»¶å(D:/a.sql) å¯ä»¥-wæºå¸¦WHEREæ¡ä»¶ å¯¼å…¥ åœ¨ç™»å½•mysqlçš„æƒ…å†µä¸‹ï¼š source å¤‡ä»½æ–‡ä»¶ åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹ mysql -uç”¨æˆ·å -på¯†ç  åº“å &lt; å¤‡ä»½æ–‡ä»¶","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (13) DELETE/TRUNCATE","slug":"mysql-notes-13","date":"2019-03-12T13:43:21.000Z","updated":"2020-07-25T02:57:18.219Z","comments":true,"path":"2019/03/12/mysql-notes-13/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-13/","excerpt":"","text":"DELETE1DELETE FROM tbl_name [WHERE where_definition] [ORDER BY ...] [LIMIT row_count] æŒ‰ç…§æ¡ä»¶åˆ é™¤ã€‚where æŒ‡å®šåˆ é™¤çš„æœ€å¤šè®°å½•æ•°ã€‚limit å¯ä»¥é€šè¿‡æ’åºæ¡ä»¶åˆ é™¤ã€‚order by + limit æ”¯æŒå¤šè¡¨åˆ é™¤ï¼Œä½¿ç”¨ç±»ä¼¼è¿æ¥è¯­æ³•ã€‚ delete from éœ€è¦åˆ é™¤æ•°æ®å¤šè¡¨1ï¼Œè¡¨2 using è¡¨è¿æ¥æ“ä½œ æ¡ä»¶ã€‚ TRUNCATE1TRUNCATE [TABLE] tbl_name æ¸…ç©ºæ•°æ®åˆ é™¤é‡å»ºè¡¨ åŒºåˆ«ï¼š truncate æ˜¯åˆ é™¤è¡¨å†åˆ›å»ºï¼Œdelete æ˜¯é€æ¡åˆ é™¤ truncate é‡ç½®auto_incrementçš„å€¼ã€‚è€Œdeleteä¸ä¼š truncate ä¸çŸ¥é“åˆ é™¤äº†å‡ æ¡ï¼Œè€ŒdeleteçŸ¥é“ã€‚ å½“è¢«ç”¨äºå¸¦åˆ†åŒºçš„è¡¨æ—¶ï¼Œtruncate ä¼šä¿ç•™åˆ†åŒº","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (12) INSERT","slug":"mysql-notes-12","date":"2019-03-12T13:36:01.000Z","updated":"2020-07-25T02:57:18.219Z","comments":true,"path":"2019/03/12/mysql-notes-12/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-12/","excerpt":"","text":"selectè¯­å¥è·å¾—çš„æ•°æ®å¯ä»¥ç”¨insertæ’å…¥ã€‚ å¯ä»¥çœç•¥å¯¹åˆ—çš„æŒ‡å®šï¼Œè¦æ±‚ values () æ‹¬å·å†…ï¼Œæä¾›ç»™äº†æŒ‰ç…§åˆ—é¡ºåºå‡ºç°çš„æ‰€æœ‰å­—æ®µçš„å€¼ã€‚æˆ–è€…ä½¿ç”¨setè¯­æ³•ã€‚ 1INSERT INTO tbl_name SET field=value,...ï¼› å¯ä»¥ä¸€æ¬¡æ€§ä½¿ç”¨å¤šä¸ªå€¼ï¼Œé‡‡ç”¨(), (), ();çš„å½¢å¼ã€‚ 1INSERT INTO tbl_name VALUES (), (), (); å¯ä»¥åœ¨åˆ—å€¼æŒ‡å®šæ—¶ï¼Œä½¿ç”¨è¡¨è¾¾å¼ã€‚ 1INSERT INTO tbl_name VALUES (field_value, 10+10, now()); å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šå€¼ DEFAULTï¼Œè¡¨ç¤ºè¯¥åˆ—ä½¿ç”¨é»˜è®¤å€¼ã€‚ 1INSERT INTO tbl_name VALUES (field_value, DEFAULT); å¯ä»¥é€šè¿‡ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœï¼Œä½œä¸ºéœ€è¦æ’å…¥çš„å€¼ã€‚ 1INSERT INTO tbl_name SELECT ...; å¯ä»¥æŒ‡å®šåœ¨æ’å…¥çš„å€¼å‡ºç°ä¸»é”®ï¼ˆæˆ–å”¯ä¸€ç´¢å¼•ï¼‰å†²çªæ—¶ï¼Œæ›´æ–°å…¶ä»–éä¸»é”®åˆ—çš„ä¿¡æ¯ã€‚ 1INSERT INTO tbl_name VALUES/SET/SELECT ON DUPLICATE KEY UPDATE å­—æ®µ=å€¼, â€¦;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (11) å¯¼å…¥å¯¼å‡º","slug":"mysql-notes-11","date":"2019-03-12T13:27:53.000Z","updated":"2020-07-25T02:57:18.218Z","comments":true,"path":"2019/03/12/mysql-notes-11/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-11/","excerpt":"","text":"å¯¼å‡ºè¡¨æ•°æ®1select * into outfile æ–‡ä»¶åœ°å€ [æ§åˆ¶æ ¼å¼] from è¡¨å; å¯¼å…¥æ•°æ®1load data [local] infile æ–‡ä»¶åœ°å€ [replace|ignore] into table è¡¨å [æ§åˆ¶æ ¼å¼]; ç”Ÿæˆçš„æ•°æ®é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯åˆ¶è¡¨ç¬¦localæœªæŒ‡å®šï¼Œåˆ™æ•°æ®æ–‡ä»¶å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Šreplace å’Œ ignore å…³é”®è¯æ§åˆ¶å¯¹ç°æœ‰çš„å”¯ä¸€é”®è®°å½•çš„é‡å¤çš„å¤„ç† æ§åˆ¶æ ¼å¼fields æ§åˆ¶å­—æ®µæ ¼å¼ é»˜è®¤ï¼šfields terminated by â€˜\\tâ€™ enclosed by â€˜â€™ escaped by â€˜\\â€˜ terminated by â€˜stringâ€™ â€“ ç»ˆæ­¢ enclosed by â€˜charâ€™ â€“ åŒ…è£¹ escaped by â€˜charâ€™ â€“ è½¬ä¹‰ ç¤ºä¾‹ï¼š 1234SELECT a,b,a+b INTO OUTFILE '/tmp/result.text'FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '\"'LINES TERMINATED BY '\\n'FROM test_table; lines æ§åˆ¶è¡Œæ ¼å¼ é»˜è®¤ï¼šlines terminated by â€˜\\nâ€™ terminated by â€˜stringâ€™ â€“ ç»ˆæ­¢","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (10) è¿æ¥æŸ¥è¯¢(join)","slug":"mysql-notes-10","date":"2019-03-12T13:09:05.000Z","updated":"2020-07-25T02:57:18.218Z","comments":true,"path":"2019/03/12/mysql-notes-10/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-10/","excerpt":"","text":"å°†å¤šä¸ªè¡¨çš„å­—æ®µè¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æŒ‡å®šè¿æ¥æ¡ä»¶ã€‚ å†…è¿æ¥(inner join) é»˜è®¤å°±æ˜¯å†…è¿æ¥ï¼Œå¯çœç•¥innerã€‚ åªæœ‰æ•°æ®å­˜åœ¨æ—¶æ‰èƒ½å‘é€è¿æ¥ã€‚å³è¿æ¥ç»“æœä¸èƒ½å‡ºç°ç©ºè¡Œã€‚ on è¡¨ç¤ºè¿æ¥æ¡ä»¶ã€‚å…¶æ¡ä»¶è¡¨è¾¾å¼ä¸whereç±»ä¼¼ã€‚ä¹Ÿå¯ä»¥çœç•¥æ¡ä»¶ï¼ˆè¡¨ç¤ºæ¡ä»¶æ°¸è¿œä¸ºçœŸï¼‰ä¹Ÿå¯ç”¨whereè¡¨ç¤ºè¿æ¥æ¡ä»¶ã€‚è¿˜æœ‰ using, ä½†éœ€å­—æ®µåç›¸åŒã€‚ using(å­—æ®µå) äº¤å‰è¿æ¥ cross joinå³ï¼Œæ²¡æœ‰æ¡ä»¶çš„å†…è¿æ¥ã€‚ 1select * from tb1 cross join tb2; å¤–è¿æ¥(outer join)å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‡ºç°åœ¨è¿æ¥ç»“æœä¸­ã€‚ å·¦å¤–è¿æ¥ left join å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå·¦è¡¨è®°å½•ä¼šå‡ºç°ï¼Œè€Œå³è¡¨ä¸ºnullå¡«å…… å³å¤–è¿æ¥ right join å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå³è¡¨è®°å½•ä¼šå‡ºç°ï¼Œè€Œå·¦è¡¨ä¸ºnullå¡«å…… è‡ªç„¶è¿æ¥(natural join)è‡ªåŠ¨åˆ¤æ–­è¿æ¥æ¡ä»¶å®Œæˆè¿æ¥ã€‚ç›¸å½“äºçœç•¥äº†usingï¼Œä¼šè‡ªåŠ¨æŸ¥æ‰¾ç›¸åŒå­—æ®µåã€‚natural joinnatural left joinnatural right join 1select info.id, info.name, info.stu_num, extra_info.hobby, extra_info.sex from info, extra_info where info.stu_num = extra_info.stu_id;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (9) å­æŸ¥è¯¢","slug":"mysql-notes-9","date":"2019-03-12T12:52:45.000Z","updated":"2020-07-25T02:57:18.222Z","comments":true,"path":"2019/03/12/mysql-notes-9/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-9/","excerpt":"","text":"å­æŸ¥è¯¢éœ€ç”¨æ‹¬å·åŒ…è£¹ã€‚ fromå‹fromåè¦æ±‚æ˜¯ä¸€ä¸ªè¡¨ï¼Œå¿…é¡»ç»™å­æŸ¥è¯¢ç»“æœå–ä¸ªåˆ«åã€‚ ç®€åŒ–æ¯ä¸ªæŸ¥è¯¢å†…çš„æ¡ä»¶ã€‚ fromå‹éœ€å°†ç»“æœç”Ÿæˆä¸€ä¸ªä¸´æ—¶è¡¨æ ¼ï¼Œå¯ç”¨ä»¥åŸè¡¨çš„é”å®šçš„é‡Šæ”¾ã€‚ å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªè¡¨ï¼Œè¡¨å‹å­æŸ¥è¯¢ã€‚ 1select * from (select * from tb where id&gt;0) as subfrom where id&gt;1; whereå‹ å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªå€¼ï¼Œæ ‡é‡å­æŸ¥è¯¢ã€‚ ä¸éœ€è¦ç»™å­æŸ¥è¯¢å–åˆ«åã€‚ whereå­æŸ¥è¯¢å†…çš„è¡¨ï¼Œä¸èƒ½ç›´æ¥ç”¨ä»¥æ›´æ–°ã€‚ 1select * from tb where money = (select max(money) from tb); åˆ—å­æŸ¥è¯¢ å¦‚æœå­æŸ¥è¯¢ç»“æœè¿”å›çš„æ˜¯ä¸€åˆ—ã€‚ä½¿ç”¨ in æˆ– not in å®ŒæˆæŸ¥è¯¢exists å’Œ not exists æ¡ä»¶å¦‚æœå­æŸ¥è¯¢è¿”å›æ•°æ®ï¼Œåˆ™è¿”å›1æˆ–0ã€‚å¸¸ç”¨äºåˆ¤æ–­æ¡ä»¶ã€‚ 1select column1 from t1 where exists (select * from t2); è¡Œå­æŸ¥è¯¢ æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªè¡Œã€‚ 1select * from t1 where (id, gender) in (select id, gender from t2); è¡Œæ„é€ ç¬¦ï¼š(col1, col2, â€¦) æˆ– ROW(col1, col2, â€¦) è¡Œæ„é€ ç¬¦é€šå¸¸ç”¨äºä¸å¯¹èƒ½è¿”å›ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šåˆ—çš„å­æŸ¥è¯¢è¿›è¡Œæ¯”è¾ƒã€‚ ç‰¹æ®Šè¿ç®—ç¬¦: != all() ç›¸å½“äº not in= some() ç›¸å½“äº inã€‚any æ˜¯ some çš„åˆ«å!= some() ä¸ç­‰åŒäº not inï¼Œä¸ç­‰äºå…¶ä¸­æŸä¸€ä¸ªã€‚all, some å¯ä»¥é…åˆå…¶ä»–è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (8) SELECT","slug":"mysql-notes-8","date":"2019-03-12T11:48:11.000Z","updated":"2020-07-25T02:57:18.222Z","comments":true,"path":"2019/03/12/mysql-notes-8/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-8/","excerpt":"","text":"è¯­æ³•1SELECT [ALL|DISTINCT] select_expr FROM -&gt; WHERE -&gt; GROUP BY [åˆè®¡å‡½æ•°] -&gt; HAVING -&gt; ORDER BY -&gt; LIMIT select_expr å¯ä»¥ç”¨ è¡¨ç¤ºæ‰€æœ‰å­—æ®µã€‚ `select from tb;` å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼ˆè®¡ç®—å…¬å¼ã€å‡½æ•°è°ƒç”¨ã€å­—æ®µä¹Ÿæ˜¯ä¸ªè¡¨è¾¾å¼ï¼‰ select stu, 29+25, now() from tb; å¯ä»¥ä¸ºæ¯ä¸ªåˆ—ä½¿ç”¨åˆ«åã€‚é€‚ç”¨äºç®€åŒ–åˆ—æ ‡è¯†ï¼Œé¿å…å¤šä¸ªåˆ—æ ‡è¯†ç¬¦é‡å¤ã€‚ ä½¿ç”¨ as å…³é”®å­—ï¼Œä¹Ÿå¯çœç•¥ as.select stu+10 as add10 from tb; FROM å­å¥ç”¨äºæ ‡è¯†æŸ¥è¯¢æ¥æºã€‚ å¯ä»¥ä¸ºè¡¨èµ·åˆ«åã€‚ä½¿ç”¨aså…³é”®å­—ã€‚ SELECT * FROM tb1 AS tt, tb2 AS bb; fromå­å¥åï¼Œå¯ä»¥åŒæ—¶å‡ºç°å¤šä¸ªè¡¨ã€‚ å¤šä¸ªè¡¨ä¼šæ¨ªå‘å åŠ åˆ°ä¸€èµ·ï¼Œè€Œæ•°æ®ä¼šå½¢æˆä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚SELECT * FROM tb1, tb2; å‘ä¼˜åŒ–ç¬¦æç¤ºå¦‚ä½•é€‰æ‹©ç´¢å¼• 123USE INDEXã€IGNORE INDEXã€FORCE INDEXSELECT * FROM table1 USE INDEX (key1,key2) WHERE key1=1 AND key2=2 AND key3=3;SELECT * FROM table1 IGNORE INDEX (key3) WHERE key1=1 AND key2=2 AND key3=3; WHERE å­å¥ ä»fromè·å¾—çš„æ•°æ®æºä¸­è¿›è¡Œç­›é€‰ã€‚ æ•´å‹1è¡¨ç¤ºçœŸï¼Œ0è¡¨ç¤ºå‡ã€‚ è¡¨è¾¾å¼ç”±è¿ç®—ç¬¦å’Œè¿ç®—æ•°ç»„æˆã€‚ è¿ç®—æ•°ï¼šå˜é‡ï¼ˆå­—æ®µï¼‰ã€å€¼ã€å‡½æ•°è¿”å›å€¼ è¿ç®—ç¬¦ï¼š=, &lt;=&gt;, &lt;&gt;, !=, &lt;=, &lt;, &gt;=, &gt;, !, &amp;&amp;, ||,in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xoris/is not åŠ ä¸Šture/false/unknownï¼Œæ£€éªŒæŸä¸ªå€¼çš„çœŸå‡&lt;=&gt;ä¸&lt;&gt;åŠŸèƒ½ç›¸åŒï¼Œ&lt;=&gt;å¯ç”¨äºnullæ¯”è¾ƒ GROUP BY å­å¥, åˆ†ç»„å­å¥GROUP BY å­—æ®µ/åˆ«å [æ’åºæ–¹å¼] åˆ†ç»„åä¼šè¿›è¡Œæ’åºã€‚ å‡åºï¼šASCï¼Œ é™åºï¼šDESC ä»¥ä¸‹[åˆè®¡å‡½æ•°]éœ€é…åˆ GROUP BY ä½¿ç”¨ï¼š count è¿”å›ä¸åŒçš„éNULLå€¼æ•°ç›® count(*)ã€count(å­—æ®µ) sum æ±‚å’Œ max æ±‚æœ€å¤§å€¼ min æ±‚æœ€å°å€¼ avg æ±‚å¹³å‡å€¼ group_concat è¿”å›å¸¦æœ‰æ¥è‡ªä¸€ä¸ªç»„çš„è¿æ¥çš„éNULLå€¼çš„å­—ç¬¦ä¸²ç»“æœã€‚ç»„å†…å­—ç¬¦ä¸²è¿æ¥ã€‚ HAVING å­å¥ï¼Œæ¡ä»¶å­å¥ä¸ where åŠŸèƒ½ã€ç”¨æ³•ç›¸åŒï¼Œæ‰§è¡Œæ—¶æœºä¸åŒã€‚ where åœ¨å¼€å§‹æ—¶æ‰§è¡Œæ£€æµ‹æ•°æ®ï¼Œå¯¹åŸæ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚ having å¯¹ç­›é€‰å‡ºçš„ç»“æœå†æ¬¡è¿›è¡Œè¿‡æ»¤ã€‚ having å­—æ®µå¿…é¡»æ˜¯æŸ¥è¯¢å‡ºæ¥çš„ï¼Œwhere å­—æ®µå¿…é¡»æ˜¯æ•°æ®è¡¨å­˜åœ¨çš„ã€‚ where ä¸å¯ä»¥ä½¿ç”¨å­—æ®µçš„åˆ«åï¼Œhaving å¯ä»¥ã€‚å› ä¸ºæ‰§è¡ŒWHEREä»£ç æ—¶ï¼Œå¯èƒ½å°šæœªç¡®å®šåˆ—å€¼ã€‚ where ä¸å¯ä»¥ä½¿ç”¨åˆè®¡å‡½æ•°ã€‚ä¸€èˆ¬éœ€ç”¨åˆè®¡å‡½æ•°æ‰ä¼šç”¨ having SQLæ ‡å‡†è¦æ±‚HAVINGå¿…é¡»å¼•ç”¨GROUP BYå­å¥ä¸­çš„åˆ—æˆ–ç”¨äºåˆè®¡å‡½æ•°ä¸­çš„åˆ—ã€‚ ORDER BY å­å¥ï¼Œæ’åºå­å¥order by æ’åºå­—æ®µ/åˆ«å æ’åºæ–¹å¼ [,æ’åºå­—æ®µ/åˆ«å æ’åºæ–¹å¼]... å‡åºï¼šASC é™åºï¼šDESC æ”¯æŒå¤šä¸ªå­—æ®µçš„æ’åºã€‚ LIMIT å­å¥ï¼Œé™åˆ¶ç»“æœæ•°é‡å­å¥ä»…å¯¹å¤„ç†å¥½çš„ç»“æœè¿›è¡Œæ•°é‡é™åˆ¶ã€‚å°†å¤„ç†å¥½çš„ç»“æœçš„çœ‹ä½œæ˜¯ä¸€ä¸ªé›†åˆï¼ŒæŒ‰ç…§è®°å½•å‡ºç°çš„é¡ºåºï¼Œç´¢å¼•ä»0å¼€å§‹ã€‚ limit èµ·å§‹ä½ç½®, è·å–æ¡æ•° çœç•¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä»ç´¢å¼•0å¼€å§‹ã€‚limit è·å–æ¡æ•° DISTINCT, ALL é€‰é¡¹distinct å»é™¤é‡å¤è®°å½•é»˜è®¤ä¸º all, å…¨éƒ¨è®°å½• UNIONå°†å¤šä¸ªselectæŸ¥è¯¢çš„ç»“æœç»„åˆæˆä¸€ä¸ªç»“æœé›†åˆã€‚ SELECT ... UNION [ALL|DISTINCT] SELECT ... é»˜è®¤ DISTINCT æ–¹å¼ï¼Œå³æ‰€æœ‰è¿”å›çš„è¡Œéƒ½æ˜¯å”¯ä¸€çš„ å»ºè®®ï¼Œå¯¹æ¯ä¸ªSELECTæŸ¥è¯¢åŠ ä¸Šå°æ‹¬å·åŒ…è£¹ã€‚ORDER BY æ’åºæ—¶ï¼Œéœ€åŠ ä¸Š LIMIT è¿›è¡Œç»“åˆã€‚éœ€è¦å„selectæŸ¥è¯¢çš„å­—æ®µæ•°é‡ä¸€æ ·ã€‚æ¯ä¸ªselectæŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨(æ•°é‡ã€ç±»å‹)åº”ä¸€è‡´ï¼Œå› ä¸ºç»“æœä¸­çš„å­—æ®µåä»¥ç¬¬ä¸€æ¡selectè¯­å¥ä¸ºå‡†ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (7) å»ºè¡¨è§„èŒƒ","slug":"mysql-notes-7","date":"2019-03-12T11:38:57.000Z","updated":"2020-07-25T02:57:18.222Z","comments":true,"path":"2019/03/12/mysql-notes-7/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-7/","excerpt":"","text":"Normal Format, NF æ¯ä¸ªè¡¨ä¿å­˜ä¸€ä¸ªå®ä½“ä¿¡æ¯ æ¯ä¸ªè¡¨å…·æœ‰ä¸€ä¸ªIDå­—æ®µä½œä¸ºä¸»é”® IDä¸»é”® + åŸå­è¡¨ 1NF, ç¬¬ä¸€èŒƒå¼å­—æ®µä¸èƒ½å†åˆ†ï¼Œå°±æ»¡è¶³ç¬¬ä¸€èŒƒå¼ã€‚ 2NF, ç¬¬äºŒèŒƒå¼ æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„å‰æä¸‹ï¼Œä¸èƒ½å‡ºç°éƒ¨åˆ†ä¾èµ–ã€‚ æ¶ˆé™¤ç¬¦åˆä¸»é”®å°±å¯ä»¥é¿å…éƒ¨åˆ†ä¾èµ–ã€‚å¢åŠ å•åˆ—å…³é”®å­—ã€‚ 3NF, ç¬¬ä¸‰èŒƒå¼ æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„å‰æä¸‹ï¼Œä¸èƒ½å‡ºç°ä¼ é€’ä¾èµ–ã€‚ æŸä¸ªå­—æ®µä¾èµ–äºä¸»é”®ï¼Œè€Œæœ‰å…¶ä»–å­—æ®µä¾èµ–äºè¯¥å­—æ®µã€‚è¿™å°±æ˜¯ä¼ é€’ä¾èµ–ã€‚ å°†ä¸€ä¸ªå®ä½“ä¿¡æ¯çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªè¡¨å†…å®ç°ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (6) åˆ—å±æ€§ï¼ˆåˆ—çº¦æŸï¼‰","slug":"mysql-notes-6","date":"2019-03-12T11:15:03.000Z","updated":"2020-07-25T02:57:18.221Z","comments":true,"path":"2019/03/12/mysql-notes-6/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-6/","excerpt":"","text":"PRIMARY ä¸»é”® èƒ½å”¯ä¸€æ ‡è¯†è®°å½•çš„å­—æ®µï¼Œå¯ä»¥ä½œä¸ºä¸»é”®ã€‚ ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚ ä¸»é”®å…·æœ‰å”¯ä¸€æ€§ã€‚ å£°æ˜å­—æ®µæ—¶ï¼Œç”¨ primary key æ ‡è¯†ã€‚ ä¹Ÿå¯ä»¥åœ¨å­—æ®µåˆ—è¡¨ä¹‹åå£°æ˜ä¾‹ï¼šcreate table tab ( id int, stu varchar(10), primary key (id)); ä¸»é”®å­—æ®µçš„å€¼ä¸èƒ½ä¸ºnullã€‚ ä¸»é”®å¯ä»¥ç”±å¤šä¸ªå­—æ®µå…±åŒç»„æˆã€‚æ­¤æ—¶éœ€è¦åœ¨å­—æ®µåˆ—è¡¨åå£°æ˜çš„æ–¹æ³•ã€‚ ä¾‹ï¼šcreate table tab ( id int, stu varchar(10), age int, primary key (stu, age)); UNIQUE å”¯ä¸€ç´¢å¼•ï¼ˆå”¯ä¸€çº¦æŸï¼‰ä½¿å¾—æŸå­—æ®µçš„å€¼ä¹Ÿä¸èƒ½é‡å¤ã€‚ NULL çº¦æŸnullä¸æ˜¯æ•°æ®ç±»å‹ï¼Œæ˜¯åˆ—çš„ä¸€ä¸ªå±æ€§ã€‚è¡¨ç¤ºå½“å‰åˆ—æ˜¯å¦å¯ä»¥ä¸ºnullï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ null, å…è®¸ä¸ºç©ºã€‚é»˜è®¤ã€‚ not null, ä¸å…è®¸ä¸ºç©ºã€‚ 1insert into tab values (null, 'val'); æ­¤æ—¶è¡¨ç¤ºå°†ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼è®¾ä¸ºnull, å–å†³äºè¯¥å­—æ®µæ˜¯å¦å…è®¸ä¸ºnull DEFAULT é»˜è®¤å€¼å±æ€§å½“å‰å­—æ®µçš„é»˜è®¤å€¼ã€‚ 1insert into tab values (default, 'val'); æ­¤æ—¶è¡¨ç¤ºå¼ºåˆ¶ä½¿ç”¨é»˜è®¤å€¼ã€‚ 1create table tab ( add_time timestamp default current_timestamp ); è¡¨ç¤ºå°†å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³è®¾ä¸ºé»˜è®¤å€¼ã€‚ current_date, current_time AUTO_INCREMENT è‡ªåŠ¨å¢é•¿çº¦æŸ è‡ªåŠ¨å¢é•¿å¿…é¡»ä¸ºç´¢å¼•ï¼ˆä¸»é”®æˆ–uniqueï¼‰ åªèƒ½å­˜åœ¨ä¸€ä¸ªå­—æ®µä¸ºè‡ªåŠ¨å¢é•¿ã€‚ é»˜è®¤ä¸º1å¼€å§‹è‡ªåŠ¨å¢é•¿ã€‚å¯ä»¥é€šè¿‡è¡¨å±æ€§ auto_increment = xè¿›è¡Œè®¾ç½®ï¼Œæˆ– alter table tbl auto_increment = x; COMMENT æ³¨é‡Šä¾‹ï¼š 1create table tab ( id int ) comment 'æ³¨é‡Šå†…å®¹'; FOREIGN KEY å¤–é”®çº¦æŸç”¨äºé™åˆ¶ä¸»è¡¨ä¸ä»è¡¨æ•°æ®å®Œæ•´æ€§ã€‚ 1alter table t1 add constraint `t1_t2_fk` foreign key (t1_id) references t2(id); å°†è¡¨t1çš„t1_idå¤–é”®å…³è”åˆ°è¡¨t2çš„idå­—æ®µã€‚ æ¯ä¸ªå¤–é”®éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œå¯ä»¥é€šè¿‡ constraint æŒ‡å®š å­˜åœ¨å¤–é”®çš„è¡¨ï¼Œç§°ä¹‹ä¸ºä»è¡¨ï¼ˆå­è¡¨ï¼‰ï¼Œå¤–é”®æŒ‡å‘çš„è¡¨ï¼Œç§°ä¹‹ä¸ºä¸»è¡¨ï¼ˆçˆ¶è¡¨ï¼‰ã€‚ ä½œç”¨ï¼šä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œå®Œæ•´æ€§ï¼Œä¸»è¦ç›®çš„æ˜¯æ§åˆ¶å­˜å‚¨åœ¨å¤–é”®è¡¨ï¼ˆä»è¡¨ï¼‰ä¸­çš„æ•°æ®ã€‚ MySQLä¸­ï¼Œå¯ä»¥å¯¹InnoDBå¼•æ“ä½¿ç”¨å¤–é”®çº¦æŸï¼šè¯­æ³•ï¼š 1foreign key (å¤–é”®å­—æ®µï¼‰ references ä¸»è¡¨å (å…³è”å­—æ®µ) [ä¸»è¡¨è®°å½•åˆ é™¤æ—¶çš„åŠ¨ä½œ] [ä¸»è¡¨è®°å½•æ›´æ–°æ—¶çš„åŠ¨ä½œ] æ­¤æ—¶éœ€è¦æ£€æµ‹ä¸€ä¸ªä»è¡¨çš„å¤–é”®éœ€è¦çº¦æŸä¸ºä¸»è¡¨çš„å·²å­˜åœ¨çš„å€¼ã€‚ å¤–é”®åœ¨æ²¡æœ‰å…³è”çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸ºnull.å‰ææ˜¯è¯¥å¤–é”®åˆ—ï¼Œæ²¡æœ‰not nullã€‚ å¯ä»¥ä¸æŒ‡å®šä¸»è¡¨è®°å½•æ›´æ”¹æˆ–æ›´æ–°æ—¶çš„åŠ¨ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸»è¡¨çš„æ“ä½œè¢«æ‹’ç»ã€‚ å¦‚æœæŒ‡å®šäº† on update æˆ– on deleteï¼šåœ¨åˆ é™¤æˆ–æ›´æ–°æ—¶ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªæ“ä½œå¯ä»¥é€‰æ‹©ï¼š cascadeï¼Œçº§è”æ“ä½œã€‚ä¸»è¡¨æ•°æ®è¢«æ›´æ–°ï¼ˆä¸»é”®å€¼æ›´æ–°ï¼‰ï¼Œä»è¡¨ä¹Ÿè¢«æ›´æ–°ï¼ˆå¤–é”®å€¼æ›´æ–°ï¼‰ã€‚ä¸»è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä»è¡¨ç›¸å…³è®°å½•ä¹Ÿè¢«åˆ é™¤ã€‚ set nullï¼Œè®¾ç½®ä¸ºnullã€‚ä¸»è¡¨æ•°æ®è¢«æ›´æ–°ï¼ˆä¸»é”®å€¼æ›´æ–°ï¼‰ï¼Œä»è¡¨çš„å¤–é”®è¢«è®¾ç½®ä¸ºnullã€‚ä¸»è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä»è¡¨ç›¸å…³è®°å½•å¤–é”®è¢«è®¾ç½®æˆnullã€‚ä½†æ³¨æ„ï¼Œè¦æ±‚è¯¥å¤–é”®åˆ—ï¼Œæ²¡æœ‰not nullå±æ€§çº¦æŸã€‚ restrictï¼Œæ‹’ç»çˆ¶è¡¨åˆ é™¤å’Œæ›´æ–°ã€‚ æ³¨æ„ï¼Œå¤–é”®åªè¢«InnoDBå­˜å‚¨å¼•æ“æ‰€æ”¯æŒã€‚å…¶ä»–å¼•æ“æ˜¯ä¸æ”¯æŒçš„ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (5) æ•°æ®ç±»å‹ï¼ˆåˆ—ç±»å‹ï¼‰","slug":"mysql-notes-5","date":"2019-03-12T05:43:56.000Z","updated":"2020-07-25T02:57:18.221Z","comments":true,"path":"2019/03/12/mysql-notes-5/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-5/","excerpt":"","text":"æ•°å€¼ç±»å‹æ•´å‹ ç±»å‹ å­—èŠ‚ èŒƒå›´ï¼ˆæœ‰ç¬¦å·ä½ï¼‰ tinyint 1å­—èŠ‚ -128 ~ 127 æ— ç¬¦å·ä½ï¼š0 ~ 255 smallint 2å­—èŠ‚ -32768 ~ 32767 mediumint 3å­—èŠ‚ -8388608 ~ 8388607 int 4å­—èŠ‚ bigint 8å­—èŠ‚ int(M) Mè¡¨ç¤ºæ€»ä½æ•° é»˜è®¤å­˜åœ¨ç¬¦å·ä½ï¼Œunsigned å±æ€§ä¿®æ”¹ æ˜¾ç¤ºå®½åº¦ï¼Œå¦‚æœæŸä¸ªæ•°ä¸å¤Ÿå®šä¹‰å­—æ®µæ—¶è®¾ç½®çš„ä½æ•°ï¼Œåˆ™å‰é¢ä»¥0è¡¥å¡«ï¼Œzerofill å±æ€§ä¿®æ”¹ ä¾‹ï¼šint(5) æ’å…¥ä¸€ä¸ªæ•°â€™123â€™ï¼Œè¡¥å¡«åä¸ºâ€™00123â€™ åœ¨æ»¡è¶³è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œè¶Šå°è¶Šå¥½ã€‚ 1è¡¨ç¤ºboolå€¼çœŸï¼Œ0è¡¨ç¤ºboolå€¼å‡ã€‚MySQLæ²¡æœ‰å¸ƒå°”ç±»å‹ï¼Œé€šè¿‡æ•´å‹0å’Œ1è¡¨ç¤ºã€‚å¸¸ç”¨tinyint(1)è¡¨ç¤ºå¸ƒå°”å‹ã€‚ æµ®ç‚¹å‹ ç±»å‹ å­—èŠ‚ èŒƒå›´ float(å•ç²¾åº¦) 4å­—èŠ‚ double(åŒç²¾åº¦) 8å­—èŠ‚ æµ®ç‚¹å‹æ—¢æ”¯æŒç¬¦å·ä½ unsigned å±æ€§ï¼Œä¹Ÿæ”¯æŒæ˜¾ç¤ºå®½åº¦ zerofill å±æ€§ã€‚ ä¸åŒäºæ•´å‹ï¼Œå‰åå‡ä¼šè¡¥å¡«0.å®šä¹‰æµ®ç‚¹å‹æ—¶ï¼Œéœ€æŒ‡å®šæ€»ä½æ•°å’Œå°æ•°ä½æ•°ã€‚ float(M, D) double(M, D) Mè¡¨ç¤ºæ€»ä½æ•°ï¼ŒDè¡¨ç¤ºå°æ•°ä½æ•°ã€‚ Må’ŒDçš„å¤§å°ä¼šå†³å®šæµ®ç‚¹æ•°çš„èŒƒå›´ã€‚ä¸åŒäºæ•´å‹çš„å›ºå®šèŒƒå›´ã€‚ Mæ—¢è¡¨ç¤ºæ€»ä½æ•°ï¼ˆä¸åŒ…æ‹¬å°æ•°ç‚¹å’Œæ­£è´Ÿå·ï¼‰ï¼Œä¹Ÿè¡¨ç¤ºæ˜¾ç¤ºå®½åº¦ï¼ˆæ‰€æœ‰æ˜¾ç¤ºç¬¦å·å‡åŒ…æ‹¬ï¼‰ã€‚ æ”¯æŒç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºã€‚ æµ®ç‚¹æ•°è¡¨ç¤ºè¿‘ä¼¼å€¼ã€‚ å®šç‚¹æ•° decimal â€“ å¯å˜é•¿åº¦ decimal(M, D) Mä¹Ÿè¡¨ç¤ºæ€»ä½æ•°ï¼ŒDè¡¨ç¤ºå°æ•°ä½æ•°ã€‚ ä¿å­˜ä¸€ä¸ªç²¾ç¡®çš„æ•°å€¼ï¼Œä¸ä¼šå‘ç”Ÿæ•°æ®çš„æ”¹å˜ï¼Œä¸åŒäºæµ®ç‚¹æ•°çš„å››èˆäº”å…¥ã€‚å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¥ä¿å­˜ï¼Œæ¯9ä½æ•°å­—ä¿å­˜ä¸º4ä¸ªå­—èŠ‚ã€‚ å­—ç¬¦ä¸²ç±»å‹char, varchar char å®šé•¿å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æµªè´¹ç©ºé—´ varchar å˜é•¿å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†èŠ‚çœç©ºé—´ Mè¡¨ç¤ºèƒ½å­˜å‚¨çš„æœ€å¤§é•¿åº¦ï¼Œæ­¤é•¿åº¦æ˜¯å­—ç¬¦æ•°ï¼Œéå­—èŠ‚æ•°ã€‚ ä¸åŒçš„ç¼–ç ï¼Œæ‰€å ç”¨çš„ç©ºé—´ä¸åŒã€‚ char,æœ€å¤š255ä¸ªå­—ç¬¦ï¼Œä¸ç¼–ç æ— å…³ã€‚ varchar,æœ€å¤š65535å­—ç¬¦ï¼Œä¸ç¼–ç æœ‰å…³ã€‚ ä¸€æ¡æœ‰æ•ˆè®°å½•æœ€å¤§ä¸èƒ½è¶…è¿‡65535ä¸ªå­—èŠ‚ã€‚ utf8 æœ€å¤§ä¸º21844ä¸ªå­—ç¬¦ï¼Œgbk æœ€å¤§ä¸º32766ä¸ªå­—ç¬¦ï¼Œlatin1 æœ€å¤§ä¸º65532ä¸ªå­—ç¬¦ varchar æ˜¯å˜é•¿çš„ï¼Œéœ€è¦åˆ©ç”¨å­˜å‚¨ç©ºé—´ä¿å­˜ varchar çš„é•¿åº¦ï¼Œå¦‚æœæ•°æ®å°äº255ä¸ªå­—èŠ‚ï¼Œåˆ™é‡‡ç”¨ä¸€ä¸ªå­—èŠ‚æ¥ä¿å­˜é•¿åº¦ï¼Œåä¹‹éœ€è¦ä¸¤ä¸ªå­—èŠ‚æ¥ä¿å­˜ã€‚ varchar çš„æœ€å¤§æœ‰æ•ˆé•¿åº¦ç”±æœ€å¤§è¡Œå¤§å°å’Œä½¿ç”¨çš„å­—ç¬¦é›†ç¡®å®šã€‚ æœ€å¤§æœ‰æ•ˆé•¿åº¦æ˜¯65532å­—èŠ‚ï¼Œå› ä¸ºåœ¨varcharå­˜å­—ç¬¦ä¸²æ—¶ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ç©ºçš„ï¼Œä¸å­˜åœ¨ä»»ä½•æ•°æ®ï¼Œç„¶åè¿˜éœ€ä¸¤ä¸ªå­—èŠ‚æ¥å­˜æ”¾å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥æœ‰æ•ˆé•¿åº¦æ˜¯64432-1-2=65532å­—èŠ‚ã€‚ ä¾‹ï¼šè‹¥ä¸€ä¸ªè¡¨å®šä¹‰ä¸º CREATE TABLE tb(c1 int, c2 char(30), c3 varchar(N)) charset=utf8; é—®Nçš„æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Ÿç­”ï¼š(65535-1-2-4-30*3)/3 blob, text blob äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—èŠ‚å­—ç¬¦ä¸²ï¼‰ tinyblob blob mediumblob longblob text éäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—ç¬¦å­—ç¬¦ä¸²ï¼‰ tinytext text mediumtext longtext text åœ¨å®šä¹‰æ—¶ï¼Œä¸éœ€è¦å®šä¹‰é•¿åº¦ï¼Œä¹Ÿä¸ä¼šè®¡ç®—æ€»é•¿åº¦ã€‚ text ç±»å‹åœ¨å®šä¹‰æ—¶ï¼Œä¸å¯ç»™defaultå€¼ binary, varbinaryç±»ä¼¼äºcharå’Œvarcharï¼Œç”¨äºä¿å­˜äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜å­—èŠ‚å­—ç¬¦ä¸²è€Œéå­—ç¬¦å­—ç¬¦ä¸²ã€‚char, varchar, text å¯¹åº” binary, varbinary, blob. æ—¥æœŸæ—¶é—´ç±»å‹ä¸€èˆ¬ç”¨æ•´å‹ä¿å­˜æ—¶é—´æˆ³ï¼Œå› ä¸ºPHPå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†æ—¶é—´æˆ³è¿›è¡Œæ ¼å¼åŒ–ã€‚ ç±»å‹ å­—èŠ‚ èŒƒå›´ datetime 8å­—èŠ‚ æ—¥æœŸåŠæ—¶é—´ 1000-01-01 00:00:00 åˆ° 9999-12-31 23:59:59 date 3å­—èŠ‚ æ—¥æœŸ 1000-01-01 åˆ° 9999-12-31 timestamp 4å­—èŠ‚ æ—¶é—´æˆ³ 19700101000000 åˆ° 2038-01-19 03:14:07 time 3å­—èŠ‚ æ—¶é—´ -838:59:59 åˆ° 838:59:59 year 1å­—èŠ‚ å¹´ä»½ 1901 - 2155 12345678910111213141516171819datetime YYYY-MM-DD hh:mm:sstimestamp YY-MM-DD hh:mm:ss YYYYMMDDhhmmss YYMMDDhhmmss YYYYMMDDhhmmss YYMMDDhhmmssdate YYYY-MM-DD YY-MM-DD YYYYMMDD YYMMDD YYYYMMDD YYMMDDtime hh:mm:ss hhmmss hhmmssyear YYYY YY YYYY YY æšä¸¾å’Œé›†åˆæšä¸¾(enum)enum(val1, val2, val3...) åœ¨å·²çŸ¥çš„å€¼ä¸­è¿›è¡Œå•é€‰ã€‚æœ€å¤§æ•°é‡ä¸º65535. æšä¸¾å€¼åœ¨ä¿å­˜æ—¶ï¼Œä»¥2ä¸ªå­—èŠ‚çš„æ•´å‹(smallint)ä¿å­˜ã€‚æ¯ä¸ªæšä¸¾å€¼ï¼ŒæŒ‰ä¿å­˜çš„ä½ç½®é¡ºåºï¼Œä»1å¼€å§‹é€ä¸€é€’å¢ã€‚ è¡¨ç°ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå­˜å‚¨å´æ˜¯æ•´å‹ã€‚ NULLå€¼çš„ç´¢å¼•æ˜¯NULLã€‚ ç©ºå­—ç¬¦ä¸²é”™è¯¯å€¼çš„ç´¢å¼•å€¼æ˜¯0ã€‚ é›†åˆï¼ˆset)set(val1, val2, val3...) 12create table tab ( gender set('ç”·', 'å¥³', 'æ— ') );insert into tab values ('ç”·, å¥³'); æœ€å¤šå¯ä»¥æœ‰64ä¸ªä¸åŒçš„æˆå‘˜ã€‚ä»¥bigintå­˜å‚¨ï¼Œå…±8ä¸ªå­—èŠ‚ã€‚é‡‡å–ä½è¿ç®—çš„å½¢å¼ã€‚å½“åˆ›å»ºè¡¨æ—¶ï¼ŒSETæˆå‘˜å€¼çš„å°¾éƒ¨ç©ºæ ¼å°†è‡ªåŠ¨è¢«åˆ é™¤ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (4) æ•°æ®æ“ä½œ","slug":"mysql-notes-4","date":"2019-03-12T05:39:16.000Z","updated":"2020-07-25T02:57:18.221Z","comments":true,"path":"2019/03/12/mysql-notes-4/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-4/","excerpt":"","text":"å¢1INSERT [INTO] è¡¨å [(å­—æ®µåˆ—è¡¨)] VALUES (å€¼åˆ—è¡¨)[, (å€¼åˆ—è¡¨), ...] å¦‚æœè¦æ’å…¥çš„å€¼åˆ—è¡¨åŒ…å«æ‰€æœ‰å­—æ®µå¹¶ä¸”é¡ºåºä¸€è‡´ï¼Œåˆ™å¯ä»¥çœç•¥å­—æ®µåˆ—è¡¨ã€‚ å¯åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®è®°å½•ï¼ REPLACE ä¸ INSERT å®Œå…¨ä¸€æ ·ï¼Œå¯äº’æ¢ã€‚ 1INSERT [INTO] è¡¨å SET å­—æ®µå=å€¼[, å­—æ®µå=å€¼, ...] æŸ¥1SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å[ å…¶ä»–å­å¥] å¯æ¥è‡ªå¤šä¸ªè¡¨çš„å¤šä¸ªå­—æ®µ å…¶ä»–å­å¥å¯ä»¥ä¸ä½¿ç”¨ å­—æ®µåˆ—è¡¨å¯ä»¥ç”¨*ä»£æ›¿ï¼Œè¡¨ç¤ºæ‰€æœ‰å­—æ®µ åˆ 1DELETE FROM è¡¨å[ åˆ é™¤æ¡ä»¶å­å¥] æ²¡æœ‰æ¡ä»¶å­å¥ï¼Œåˆ™ä¼šåˆ é™¤å…¨éƒ¨ æ”¹1UPDATE è¡¨å SET å­—æ®µå=æ–°å€¼[, å­—æ®µå=æ–°å€¼] [æ›´æ–°æ¡ä»¶] å­—ç¬¦é›†ç¼–ç  MySQLã€æ•°æ®åº“ã€è¡¨ã€å­—æ®µå‡å¯è®¾ç½®ç¼–ç  æ•°æ®ç¼–ç ä¸å®¢æˆ·ç«¯ç¼–ç ä¸éœ€ä¸€è‡´ 1234567891011SHOW VARIABLES LIKE 'character_set_%' -- æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†ç¼–ç é¡¹ -- character_set_client å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ä½¿ç”¨çš„ç¼–ç  -- character_set_results æœåŠ¡å™¨ç«¯å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„ç¼–ç  -- character_set_connection è¿æ¥å±‚ç¼–ç SET å˜é‡å = å˜é‡å€¼ SET character_set_client = gbk; SET character_set_results = gbk; SET character_set_connection = gbk;SET NAMES GBK; -- ç›¸å½“äºå®Œæˆä»¥ä¸Šä¸‰ä¸ªè®¾ç½® æ ¡å¯¹é›† æ ¡å¯¹é›†ç”¨ä»¥æ’åº 12SHOW CHARACTER SET [LIKE 'pattern']/SHOW CHARSET [LIKE 'pattern'] æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†SHOW COLLATION [LIKE 'pattern'] æŸ¥çœ‹æ‰€æœ‰æ ¡å¯¹é›† CHARSET å­—ç¬¦é›†ç¼–ç  è®¾ç½®å­—ç¬¦é›†ç¼–ç COLLATE æ ¡å¯¹é›†ç¼–ç  è®¾ç½®æ ¡å¯¹é›†ç¼–ç ","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (3) è¡¨çš„æ“ä½œ","slug":"mysql-notes-3","date":"2019-03-12T05:35:32.000Z","updated":"2020-07-25T02:57:18.221Z","comments":true,"path":"2019/03/12/mysql-notes-3/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-3/","excerpt":"","text":"åˆ›å»ºè¡¨1CREATE [TEMPORARY] TABLE[ IF NOT EXISTS] [åº“å.]è¡¨å ( è¡¨çš„ç»“æ„å®šä¹‰ )[ è¡¨é€‰é¡¹] æ¯ä¸ªå­—æ®µå¿…é¡»æœ‰æ•°æ®ç±»å‹ æœ€åä¸€ä¸ªå­—æ®µåä¸èƒ½æœ‰é€—å· TEMPORARY ä¸´æ—¶è¡¨ï¼Œä¼šè¯ç»“æŸæ—¶è¡¨è‡ªåŠ¨æ¶ˆå¤± å¯¹äºå­—æ®µçš„å®šä¹‰ï¼š 1å­—æ®µå æ•°æ®ç±»å‹ [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY] [COMMENT 'string'] è¡¨é€‰é¡¹ å­—ç¬¦é›† CHARSET = charset_name å¦‚æœè¡¨æ²¡æœ‰è®¾å®šï¼Œåˆ™ä½¿ç”¨æ•°æ®åº“å­—ç¬¦é›† å­˜å‚¨å¼•æ“ENGINE = engine_nameè¡¨åœ¨ç®¡ç†æ•°æ®æ—¶é‡‡ç”¨çš„ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œç»“æ„ä¸åŒä¼šå¯¼è‡´å¤„ç†æ–¹å¼ã€æä¾›çš„ç‰¹æ€§æ“ä½œç­‰ä¸åŒå¸¸è§çš„å¼•æ“ï¼šInnoDB MyISAM Memory/Heap BDB Merge Example CSV MaxDB Archiveä¸åŒçš„å¼•æ“åœ¨ä¿å­˜è¡¨çš„ç»“æ„å’Œæ•°æ®æ—¶é‡‡ç”¨ä¸åŒçš„æ–¹å¼ MyISAMè¡¨æ–‡ä»¶å«ä¹‰ï¼š.frmè¡¨å®šä¹‰ï¼Œ.MYDè¡¨æ•°æ®ï¼Œ.MYIè¡¨ç´¢å¼• InnoDBè¡¨æ–‡ä»¶å«ä¹‰ï¼š.frmè¡¨å®šä¹‰ï¼Œè¡¨ç©ºé—´æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶ 12SHOW ENGINES -- æ˜¾ç¤ºå­˜å‚¨å¼•æ“çš„çŠ¶æ€ä¿¡æ¯SHOW ENGINE å¼•æ“å &#123;LOGS|STATUS&#125; -- æ˜¾ç¤ºå­˜å‚¨å¼•æ“çš„æ—¥å¿—æˆ–çŠ¶æ€ä¿¡æ¯ è‡ªå¢èµ·å§‹æ•° AUTO_INCREMENT = è¡Œæ•° æ•°æ®æ–‡ä»¶ç›®å½• DATA DIRECTORY = &#39;ç›®å½•&#39; ç´¢å¼•æ–‡ä»¶ç›®å½• INDEX DIRECTORY = &#39;ç›®å½•&#39; è¡¨æ³¨é‡Š COMMENT = &#39;string&#39; åˆ†åŒºé€‰é¡¹ PARTITION BY ... (è¯¦ç»†è§æ‰‹å†Œ) æŸ¥çœ‹æ‰€æœ‰è¡¨12SHOW TABLES[ LIKE 'pattern']SHOW TABLES FROM è¡¨å æŸ¥çœ‹è¡¨æœºæ„123SHOW CREATE TABLE è¡¨å ï¼ˆä¿¡æ¯æ›´è¯¦ç»†ï¼‰DESC è¡¨å / DESCRIBE è¡¨å / EXPLAIN è¡¨å / SHOW COLUMNS FROM è¡¨å [LIKE 'PATTERN']SHOW TABLE STATUS [FROM db_name] [LIKE 'pattern'] ä¿®æ”¹è¡¨ ä¿®æ”¹è¡¨æœ¬èº«çš„é€‰é¡¹ 1ALTER TABLE è¡¨å è¡¨çš„é€‰é¡¹ eg: 1ALTER TABLE è¡¨å ENGINE=MYISAM; å¯¹è¡¨è¿›è¡Œé‡å‘½å 12RENAME TABLE åŸè¡¨å TO æ–°è¡¨åRENAME TABLE åŸè¡¨å TO åº“å.è¡¨å ï¼ˆå¯å°†è¡¨ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ï¼‰ RENAMEå¯ä»¥äº¤æ¢ä¸¤ä¸ªè¡¨å ä¿®æ”¹è¡¨çš„å­—æ®µæœºæ„ï¼ˆ13.1.2. ALTER TABLEè¯­æ³•ï¼‰ 1ALTER TABLE è¡¨å æ“ä½œå æ“ä½œå ADD[ COLUMN] å­—æ®µå®šä¹‰ â€“ å¢åŠ å­—æ®µ AFTER å­—æ®µå â€“ è¡¨ç¤ºå¢åŠ åœ¨è¯¥å­—æ®µååé¢ FIRST â€“ è¡¨ç¤ºå¢åŠ åœ¨ç¬¬ä¸€ä¸ª ADD PRIMARY KEY(å­—æ®µå) â€“ åˆ›å»ºä¸»é”® ADD UNIQUE [ç´¢å¼•å] (å­—æ®µå) â€“ åˆ›å»ºå”¯ä¸€ç´¢å¼• ADD INDEX [ç´¢å¼•å] (å­—æ®µå) â€“ åˆ›å»ºæ™®é€šç´¢å¼• DROP[ COLUMN] å­—æ®µå â€“ åˆ é™¤å­—æ®µ MODIFY[ COLUMN] å­—æ®µå å­—æ®µå±æ€§ â€“ æ”¯æŒå¯¹å­—æ®µå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œä¸èƒ½ä¿®æ”¹å­—æ®µå(æ‰€æœ‰åŸæœ‰å±æ€§ä¹Ÿéœ€å†™ä¸Š) CHANGE[ COLUMN] åŸå­—æ®µå æ–°å­—æ®µå å­—æ®µå±æ€§ â€“ æ”¯æŒå¯¹å­—æ®µåä¿®æ”¹ DROP PRIMARY KEY â€“ åˆ é™¤ä¸»é”®(åˆ é™¤ä¸»é”®å‰éœ€åˆ é™¤å…¶AUTO_INCREMENTå±æ€§) DROP INDEX ç´¢å¼•å â€“ åˆ é™¤ç´¢å¼• DROP FOREIGN KEY å¤–é”® â€“ åˆ é™¤å¤–é”® åˆ é™¤è¡¨1DROP TABLE[ IF EXISTS] è¡¨å ... æ¸…ç©ºè¡¨æ•°æ®1TRUNCATE [TABLE] è¡¨å å¤åˆ¶è¡¨ç»“æ„1CREATE TABLE è¡¨å LIKE è¦å¤åˆ¶çš„è¡¨å å¤åˆ¶è¡¨ç»“æ„å’Œæ•°æ®1CREATE TABLE è¡¨å [AS] SELECT * FROM è¦å¤åˆ¶çš„è¡¨å æ£€æŸ¥è¡¨æ˜¯å¦æœ‰é”™è¯¯1CHECK TABLE tbl_name [, tbl_name] ... [option] ... ä¼˜åŒ–è¡¨1OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... ä¿®å¤è¡¨1REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... [QUICK] [EXTENDED] [USE_FRM] åˆ†æè¡¨1ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (2) æ•°æ®åº“æ“ä½œ","slug":"mysql-notes-2","date":"2019-03-12T05:32:22.000Z","updated":"2020-07-25T02:57:18.220Z","comments":true,"path":"2019/03/12/mysql-notes-2/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-2/","excerpt":"","text":"æŸ¥çœ‹å½“å‰æ•°æ®åº“1SELECT DATABASE(); æ˜¾ç¤ºå½“å‰æ—¶é—´ã€ç”¨æˆ·åã€æ•°æ®åº“ç‰ˆæœ¬1SELECT now(), user(), version(); åˆ›å»ºåº“1CREATE DATABASE[ IF NOT EXISTS] æ•°æ®åº“å æ•°æ®åº“é€‰é¡¹ æ•°æ®åº“é€‰é¡¹ï¼š CHARACTER SET charset_name COLLATE collation_name æŸ¥çœ‹å·²æœ‰åº“1SHOW DATABASES[ LIKE 'PATTERN'] æŸ¥çœ‹å½“å‰åº“ä¿¡æ¯1SHOW CREATE DATABASE æ•°æ®åº“å ä¿®æ”¹åº“çš„é€‰é¡¹ä¿¡æ¯1ALTER DATABASE åº“å é€‰é¡¹ä¿¡æ¯ åˆ é™¤åº“1DROP DATABASE[ IF EXISTS] æ•°æ®åº“å åŒæ—¶åˆ é™¤è¯¥æ•°æ®åº“ç›¸å…³çš„ç›®å½•åŠå…¶ç›®å½•å†…å®¹","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"MySQL ç¬”è®° (1) MySQLæœåŠ¡","slug":"mysql-notes-1","date":"2019-03-12T04:31:53.000Z","updated":"2020-07-25T02:57:18.218Z","comments":true,"path":"2019/03/12/mysql-notes-1/","link":"","permalink":"https://jigangduan.github.io/2019/03/12/mysql-notes-1/","excerpt":"","text":"MySQL åŸºæœ¬çš„çŸ¥è¯†ç‚¹ å¯åŠ¨/å…³é—­/é‡å¯ Windowsä¸‹ å¯åŠ¨æœåŠ¡ 1mysqld --console æˆ– 1net start mysql å…³é—­æœåŠ¡ 1mysqladmin -uroot shudown æˆ– 1net stop mysql Linuxä¸‹ å¯åŠ¨æœåŠ¡ 1service mysql start å…³é—­æœåŠ¡ 1service mysql stop é‡å¯æœåŠ¡ 1service restart stop Macä¸‹ å¯åŠ¨MySQLæœåŠ¡ 1sudo /usr/local/mysql/support-files/mysql.server start åœæ­¢MySQLæœåŠ¡ 1/usr/local/mysql/support-files/mysql.server stop é‡å¯MySQLæœåŠ¡ 1/usr/local/mysql/support-files/mysql.server restart è¿æ¥ä¸æ–­å¼€æœåŠ¡å™¨1mysql -h åœ°å€ -P ç«¯å£ -u ç”¨æˆ·å -p å¯†ç  12SHOW PROCESSLIST -- æ˜¾ç¤ºå“ªäº›çº¿ç¨‹æ­£åœ¨è¿è¡ŒSHOW VARIABLES -- æ˜¾ç¤ºç³»ç»Ÿå˜é‡ä¿¡æ¯","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"}]},{"title":"CSSè®²è§£(10) ä¸‰å¤§æ¡†æ¶ä¸­çš„CSS","slug":"CSSè®²è§£-10","date":"2019-02-10T10:18:56.000Z","updated":"2020-07-25T02:57:18.149Z","comments":true,"path":"2019/02/10/CSSè®²è§£-10/","link":"","permalink":"https://jigangduan.github.io/2019/02/10/CSSè®²è§£-10/","excerpt":"","text":"Angular Vue React ä¸‰å¤§æ¡†æ¶ Angular Vue å†…ç½®æ ·å¼é›†æˆ React ä¸€äº›ä¸šç•Œå®è·µ Angular Angular.js (1.x) æ²¡æœ‰æ ·å¼é›†æˆèƒ½åŠ› Angular (2+) æä¾›äº†æ ·å¼å°è£…èƒ½åŠ› ä¸ç»„ä»¶æ·±åº¦é›†æˆ å‡ ä¸ªæ¦‚å¿µçŸ¥è¯†ï¼š ShadowDOM é€»è¾‘ä¸Šä¸€ä¸ªDOM ç»“æ„ä¸Šå­˜åœ¨å­é›†ç»“æ„ Scoped CSS é™å®šäº†èŒƒå›´çš„CSS æ— æ³•å½±å“å¤–éƒ¨å…ƒç´  å¤–éƒ¨æ ·å¼ä¸€èˆ¬ä¸å½±å“å†…éƒ¨ å¯ä»¥é€šè¿‡/deep/æˆ–&gt;&gt;&gt;ç©¿é€ æ¨¡æ‹ŸScoped CSS æ–¹æ¡ˆä¸€: éšæœºé€‰æ‹©å™¨(ä¸æ”¯æŒ) æ–¹æ¡ˆäºŒ: éšæœºå±æ€§ &lt;div abcdefg&gt; div[abcdefg] {} Angular é€‰ç”¨äº†æ–¹æ¡ˆäºŒ Vue æ¨¡æ‹ŸScoped CSS æ–¹æ¡ˆä¸€: éšæœºé€‰æ‹©å™¨ æ–¹æ¡ˆäºŒ: éšæœºå±æ€§ &lt;div abcdefg&gt; div[abcdefg] {} Vue æ”¯æŒä¸¤ç§ React å®˜æ–¹æ²¡æœ‰é›†æˆæ–¹æ¡ˆ ç¤¾åŒºæ–¹æ¡ˆä¼—å¤š css modules (babel)react-css-module styled components styled jsx","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(9) å·¥ç¨‹åŒ–","slug":"CSSè®²è§£-9","date":"2019-02-10T08:46:32.000Z","updated":"2020-07-25T02:57:18.151Z","comments":true,"path":"2019/02/10/CSSè®²è§£-9/","link":"","permalink":"https://jigangduan.github.io/2019/02/10/CSSè®²è§£-9/","excerpt":"","text":"å·¥ç¨‹åŒ–å…³æ³¨: ç»„ç»‡ ä¼˜åŒ– æ„å»º ç»´æŠ¤ PostCSSCSS â€“&gt; PostCSS(è§£æè½¬æ¢) â€“&gt; CSS å¯ä»¥ä½œ: æ¨¡å—åŒ– åŠ å‰ç¼€ å…¼å®¹æ€§ â€¦ PostCSSæœ¬èº«åªæœ‰è§£æèƒ½åŠ› å„ç§ç¥å¥‡çš„ç‰¹æ€§å…¨é æ’ä»¶ ç›®å‰è‡³å°‘æœ‰200å¤šä¸ªæ’ä»¶ å¸¸ç”¨çš„æ’ä»¶ï¼š importæ¨¡å—åˆå¹¶ autoperfixier è‡ªåŠ¨åŠ å‰ç¼€ cssnnao å‹ç¼©ä»£ç  cssnext ä½¿ç”¨CSSæ–°ç‰¹æ€§ precss å˜é‡, mixin, å¾ªç¯ç­‰ å®‰è£…ï¼š 1npm install postcss-cli ä½¿ç”¨ï¼š 1postcss input.css -o out.css æ’ä»¶postcss.config.js å¼•ç”¨å„ç§æ’ä»¶ 12345678910111213const cssnano = require('cssnano');const atImport = require('postcss-import');const autoprefixer = require('autoprefixer');module.exports = &#123; plugins: [ atImport, autoprefixer(&#123; browsers: ['&gt;0%'] &#125;), cssnano ]&#125;; Browserlist cssnextä½¿ç”¨CSSæ–°ç‰¹æ€§ ç‰¹æ€§: custom properties &amp; var() automatic vendor prefixes custom properties set &amp; @apply reduced calc() custom media queries media queries ranges custom selectors nesting image-set() function color() function hwb() function gray() function #rrggbbaa colors rgba function (rgb fallback) rebeccapurple color font-variant property filter property (svg fallback) initial value rem unit (px fallback) :any-link pseudo-class :matches pseudo-class :not pseudo-class (to l.3) ::pseudo syntax (: fallback) overflow-wrap property (word-wrap fallback) attribute case insensitive rgb() function (functional-notation) hsl() function (functional-notation) system-ui font-family (font-family fallback) CSSå˜é‡ä¸¾ä¾‹ï¼š 123456789101112131415:root &#123; --mainColor: red; --danger-theme: &#123; color: white; background-color: red; &#125;;&#125;a &#123; color: var(--mainColor);&#125;.danger &#123; @apply --danger-theme;&#125; postcss.config.js 1234567const cssnext = require('postcss-cssnext');module.exports = &#123; plugins: [ cssnext, ]&#125;; precss PreCSSä¸­çš„åµŒå¥—å¯ä»¥ä½¿ç”¨ &amp; ç¬¦ï¼ŒæŠŠçˆ¶é€‰æ‹©å™¨å¤åˆ¶åˆ°å­é€‰æ‹©å™¨ä¸­ PreCSSä½¿ç”¨ $ ç¬¦å£°æ˜å˜é‡ï¼Œæ¯”å¦‚ $color: #ccc PreCSSä¸­ç”¨ @if å’Œ @else æ¥æ§åˆ¶å¾ªç¯ PreCSSä¸­ç”¨ @define-mixin mixin_name $arg1,$arg2{â€¦} è¯­æ³•æ¥å£°æ˜æ··åˆå® PreCSSä¸­ç”¨ @mixin mixin_name pass_arg1, pass_arg2; è¯­æ³•æ¥è°ƒç”¨æ··åˆå® PreCSSä¸­ç”¨ @mixin-content ä¿ç•™ä¼ é€’å†…å®¹ PreCSSä¸­ä½¿ç”¨ @define-extend extend_name{â€¦} æ¥å£°æ˜å¯æ‰©å±•çš„ä»£ç å— PreCSSä¸­ä½¿ç”¨ @extend extend_name è¯­æ³•æ¥è°ƒç”¨å£°æ˜çš„ä»£ç æ‰©å±•å— PreCSSå¯ä»¥ä½¿ç”¨ @import ä¸­å¯¼å…¥CSSæ–‡ä»¶ æ„å»ºå·¥å…·PostCSS æ”¯æŒçš„æ„å»ºå·¥å…·ï¼š CLI å‘½ä»¤è¡Œå·¥å…· webpack postcss-loader Gulp gulp-postcss Grunt grunt-postcss Rollup rollup-postcss â€¦ gulp-postcssgulpfile.js webpack JSæ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒå…¥å£ ä¸€åˆ‡èµ„æºå‡ç”±JSç®¡ç†ä¾èµ– ä¸€åˆ‡èµ„æºå‡ç”±webpackæ‰“åŒ… webpackå¤„ç†CSSjs å¼•ç”¨ CSS, css-loader/sytle-loader, å°†CSSæ–‡ä»¶è½¬æ¢æˆ JSæ–‡ä»¶ 123require(./xxx.css);console.log('hello'); css-modules æ˜¯ä»€ä¹ˆï¼ŸCSSæ¨¡å—åŒ–çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ˆå¯¹cssç±»åé™å®šä½œç”¨åŸŸçš„ä¸€ç§ï¼Œåªé™å®šç±»é€‰æ‹©å™¨ï¼Œå¯¹idã€å…ƒç´ ç­‰é€‰æ‹©å™¨ä¸ç®¡ï¼‰ åŸç†ï¼Ÿé€šè¿‡ webpack åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç»™ç±»åèµ·ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„åå­—ï¼Œè¿™ä¸ªåå­—å¯ä»¥é€šè¿‡webpacké…ç½® å¥½å¤„ï¼Ÿ é¿å…ç±»åé‡å¤å¯¼è‡´æ ·å¼è¦†ç›–é—®é¢˜ï¼› JS &amp; CSS å…±äº«å˜é‡ å¥å£®å¯æ‰©å±• extract-text-pluginè¯¥æ’ä»¶çš„ä¸»è¦æ˜¯ä¸ºäº†æŠ½ç¦»cssæ ·å¼,é˜²æ­¢å°†æ ·å¼æ‰“åŒ…åœ¨jsä¸­å¼•èµ·é¡µé¢æ ·å¼åŠ è½½é”™ä¹±çš„ç°è±¡ ä»jså°†æ ·å¼æŠ½ç¦»å‡ºæ¥ç”ŸæˆCSSæ–‡ä»¶ å…¶å®ƒ å¦‚ä½•è§£å†³CSSæ¨¡å—åŒ–é—®é¢˜ Less Sass ç­‰CSSé¢„å¤„ç†å™¨ PostCSSæ’ä»¶ (postcss-import / precssç­‰) webpackå¤„ç†CSS (css-loader + style-loader) PostCSS å¯ä»¥ä½œä»€ä¹ˆï¼Ÿ å–å†³äºæ’ä»¶å¯ä»¥åšä»€ä¹ˆ autoprefixer cssnext precssç­‰ å…¼å®¹æ€§å¤„ç† import æ¨¡å—åˆå¹¶ cssè¯­æ³•æ£€æŸ¥ å…¼å®¹æ€§æ£€æŸ¥ å‹ç¼©æ–‡ä»¶ CSS modules æ˜¯åšä»€ä¹ˆçš„ï¼Œå¦‚ä½•ä½¿ç”¨ è§£å†³ç±»åå†²çªçš„é—®é¢˜ ä½¿ç”¨PostCSSæˆ–è€…webpackç­‰æ„å»ºå·¥å…·è¿›è¡Œç¼–è¯‘ åœ¨HTMLæ¨¡ç‰ˆä¸­ä½¿ç”¨ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„ç±»å ä¸ºä»€ä¹ˆä½¿ç”¨JSæ¥å¼•ç”¨,åŠ è½½CSS JSä½œä¸ºå…¥å£ï¼Œç®¡ç†èµ„æºæœ‰å¤©ç„¶ä¼˜åŠ¿ å°†ç»„ä»¶çš„ç»“æ„ï¼Œæ ·å¼ï¼Œè¡Œä¸ºå°è£…åˆ°ä¸€èµ·ï¼Œå¢å¼ºå†…èš å¯ä»¥åšæ›´å¤šå¤„ç†(webpack)","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(8) Bootstrap","slug":"CSSè®²è§£-8","date":"2019-02-10T07:52:49.000Z","updated":"2020-07-25T02:57:18.151Z","comments":true,"path":"2019/02/10/CSSè®²è§£-8/","link":"","permalink":"https://jigangduan.github.io/2019/02/10/CSSè®²è§£-8/","excerpt":"","text":"ä»‹ç» CSSæ¡†æ¶ twitter å‡ºå“ æä¾›é€šç”¨åŸºç¡€æ ·å¼ Bootstrap 4 å…¼å®¹IE10+ ä½¿ç”¨flexboxå¸ƒå±€ æŠ›å¼ƒNomalize.css æä¾›å¸ƒå±€å’Œrebootç‰ˆæœ¬ æä¾›ï¼š åŸºç¡€æ ·å¼ å¸¸ç”¨ç»„ä»¶ JSæ’ä»¶ åŸºæœ¬ç”¨æ³• See the Pen KEqEWz by jigang.duan (@jigang-duan) on CodePen. JSç»„ä»¶ ç”¨äºç»„ä»¶äº¤äº’ dropdown(ä¸‹æ‹‰) modal(å¼¹çª—) â€¦ jQuery Popper.js bootstrap.js ä½¿ç”¨æ–¹å¼ï¼š åŸºäº data-*å±æ€§ åŸºäºJS API å“åº”å¼å¸ƒå±€ See the Pen qvjvoy by jigang.duan (@jigang-duan) on CodePen. å®šåˆ¶æ–¹æ³• ä½¿ç”¨CSSåŒåç±» ä¿®æ”¹æºç é‡æ–°æ„å»º å¼•ç”¨scssæºæ–‡ä»¶ ä¿®æ”¹å˜é‡ å…¶å®ƒ Bootstrapçš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š CSSä»£ç ç»“æ„åˆç† ç°æˆçš„æ ·å¼å¯ä»¥ç›´æ¥ä½¿ç”¨ ç¼ºç‚¹ï¼š å®šåˆ¶è¾ƒä¸ºç¹ç ä½“ç§¯å¤§ Bootstrapå¦‚ä½•å®ç°å“åº”å¼å¸ƒå±€ åŸç†ï¼šé€šè¿‡media queryè®¾ç½®ä¸åŒåˆ†è¾¨ç‡çš„class ä½¿ç”¨: ä¸ºä¸åŒåˆ†è¾¨ç‡é€‰æ‹©ä¸åŒçš„ç½‘æ ¼class å¦‚ä½•åŸºäºBootstrapå®šåˆ¶è‡ªå·±çš„æ ·å¼ ä½¿ç”¨CSSåŒåç±»è¦†ç›– ä¿®æ”¹æºç é‡æ–°æ„å»º å¼•ç”¨scssæºæ–‡ä»¶ ä¿®æ”¹å˜é‡","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(7)-é¢„å¤„ç†","slug":"CSSè®²è§£-7","date":"2019-02-10T00:57:21.000Z","updated":"2020-07-25T02:57:18.150Z","comments":true,"path":"2019/02/10/CSSè®²è§£-7/","link":"","permalink":"https://jigangduan.github.io/2019/02/10/CSSè®²è§£-7/","excerpt":"","text":"ä»‹ç»CSSé¢„å¤„ç†å™¨ï¼š åŸºäºCSSçš„å¦ä¸€ç§è¯­è¨€ é€šè¿‡å·¥å…·ç¼–è¯‘æˆCSS æ·»åŠ äº†å¾ˆå¤šCSSä¸å…·å¤‡çš„ç‰¹æ€§ èƒ½æå‡CSSæ–‡ä»¶çš„ç»„ç»‡ æ–¹æ¡ˆï¼š less node.js å†™çš„ å®‰è£…ï¼š npm install less sass ruby å†™çš„ åŠŸèƒ½ï¼š åµŒå¥— æ”¾æ˜ å±‚çº§å’Œçº¦æŸ å˜é‡å’Œè®¡ç®— å‡å°‘é‡å¤ä»£ç  Extendå’ŒMixin ä»£ç ç‰‡æ®µ å¾ªç¯ é€‚ç”¨äºå¤æ‚æœ‰è§„å¾‹çš„æ ·å¼ import CSSæ–‡ä»¶æ¨¡å—åŒ– lessåµŒå¥—123456789101112131415161718body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:white; .nav&#123; font-size: 12px; &#125; .content&#123; font-size: 14px; &amp;:hover&#123; background:red; &#125; &#125;&#125; &amp; å¹³çº§,æŠŠç©ºæ ¼å»æ‰ ç¼–è¯‘æˆCSSåï¼š 1234567891011121314151617181920body &#123; padding: 0; margin: 0;&#125;.wrapper &#123; background: white;&#125;.wrapper .nav &#123; font-size: 12px;&#125;.wrapper .content &#123; font-size: 14px;&#125;.wrapper .content:hover &#123; background: red;&#125; sassåµŒå¥—123456789101112131415161718body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:white; .nav&#123; font-size: 12px; &#125; .content&#123; font-size: 14px; &amp;:hover&#123; background:red; &#125; &#125;&#125; å†™æ³•å’Œlessæ˜¯ä¸€æ ·çš„ï¼Œç¼–ç¨‹æˆcssä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚sassè¾“å‡ºæœ‰å¾ˆå¤šç§æ ¼å¼ lesså˜é‡@ å˜é‡å®šä¹‰ 12345678910111213141516171819202122@fontSize: 12px;@bgColor: red;body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:lighten(@bgColor, 40%); .nav&#123; font-size: @fontSize; &#125; .content&#123; font-size: @fontSize + 2px; &amp;:hover&#123; background:@bgColor; &#125; &#125;&#125; sasså˜é‡$ å˜é‡å®šä¹‰ 12345678910111213141516171819202122$fontSize: 12px;$bgColor: red;body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:lighten($bgColor, 40%); .nav&#123; font-size: $fontSize; &#125; .content&#123; font-size: $fontSize + 2px; &amp;:hover&#123; background:red; &#125; &#125;&#125; less mixin1234567891011121314151617181920212223242526272829303132333435363738394041@fontSize: 12px;@bgColor: red;.box&#123; color:green;&#125;.box1&#123; .box(); line-height: 2em;&#125;.box2&#123; .box(); line-height: 3em;&#125;.block(@fontSize)&#123; font-size: @fontSize; border: 1px solid #ccc; border-radius: 4px;&#125;body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:lighten(@bgColor, 40%); .nav&#123; .block(@fontSize); &#125; .content&#123; .block(@fontSize + 2px); &amp;:hover&#123; background:red; &#125; &#125;&#125; sass mixin123456789101112131415161718192021222324252627$fontSize: 12px;$bgColor: red;@mixin block($fontSize)&#123; font-size: $fontSize; border: 1px solid #ccc; border-radius: 4px;&#125;body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:lighten($bgColor, 40%); .nav&#123; @include block($fontSize); &#125; .content&#123; @include block($fontSize + 2px); &amp;:hover&#123; background:red; &#125; &#125;&#125; less extend123456789101112131415161718192021222324252627@fontSize: 12px;@bgColor: red;.block&#123; font-size: @fontSize; border: 1px solid #ccc; border-radius: 4px;&#125;body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:lighten(@bgColor, 40%); .nav:extend(.block)&#123; color: #333; &#125; .content&#123; &amp;:extend(.block); &amp;:hover&#123; background:red; &#125; &#125;&#125; sass extend12345678910111213141516171819202122232425262728$fontSize: 12px;$bgColor: red;.block&#123; font-size: $fontSize; border: 1px solid #ccc; border-radius: 4px;&#125;body&#123; padding:0; margin:0;&#125;.wrapper&#123; background:lighten($bgColor, 40%); .nav&#123; @extend .block; color: #333; &#125; .content&#123; @extend .block; &amp;:hover&#123; background:red; &#125; &#125;&#125; less loopæ¯”å¦‚è¦å®ç°å¦‚ä¸‹CSSæ ·å¼ï¼Œ 123456789101112131415161718192021222324252627282930313233343536.col-12 &#123; width: 1000px;&#125;.col-11 &#123; width: 916.66666667px;&#125;.col-10 &#123; width: 833.33333333px;&#125;.col-9 &#123; width: 750px;&#125;.col-8 &#123; width: 666.66666667px;&#125;.col-7 &#123; width: 583.33333333px;&#125;.col-6 &#123; width: 500px;&#125;.col-5 &#123; width: 416.66666667px;&#125;.col-4 &#123; width: 333.33333333px;&#125;.col-3 &#123; width: 250px;&#125;.col-2 &#123; width: 166.66666667px;&#125;.col-1 &#123; width: 83.33333333px;&#125; ä½¿ç”¨lessçš„é€’å½’çš„æ–¹å¼ï¼š 12345678.gen-col(@n) when (@n &gt; 0)&#123; .gen-col(@n - 1); .col-@&#123;n&#125; &#123; width: 1000px/12*@n; &#125;&#125;.gen-col(12); sass loop12345@for $i from 1 through 12 &#123; .col-#&#123;$i&#125; &#123; width: 1000px/12*$i; &#125;&#125; less import123@import \"./6-import-variable\";@import \"./6-import-module1\";@import \"./6-import-module2\"; sass import123@import \"./6-import-variable\";@import \"./6-import-module1\";@import \"./6-import-module2\"; é¢„å¤„ç†å™¨æ¡†æ¶ SASS - Compass Less - Lesshat / EST æä¾›ç°æˆçš„mixin ç±»ä¼¼JSç±»åº“ å°è£…å¸¸ç”¨åŠŸèƒ½ Compass Estæ˜¯ä¸€ä¸ªåŸºäºLessçš„mixinåº“ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ç¼–å†™æ›´å°‘çš„ä»£ç ã€‚ Estæä¾›äº†100å¤šä¸ªæ–¹ä¾¿çš„mixinï¼Œåªæœ‰åœ¨è°ƒç”¨å®ƒä»¬æ—¶æ‰ç”Ÿæˆæ ·å¼è§„åˆ™ã€‚Estæ²¡æœ‰ä¸ºç‰¹å®šçš„HTMLç±»åæä¾›ä»»ä½•æ ·å¼ï¼Œå› ä¸ºè¿™æ ·çš„â€œå¯è§†åŒ–ç±»åâ€å¯èƒ½ä¼šæ±¡æŸ“HTMLè¯­ä¹‰ã€‚æ‚¨å¯ä»¥åŸºäºestæ„å»ºè‡ªå·±çš„æ ·å¼åº“æ¥åŠ é€Ÿå¼€å‘ã€‚ æ€»ç»“ å¸¸è§çš„CSSé¢„å¤„ç†å™¨ Lessï¼ˆNode.jsï¼‰ Sass (Ruby æœ‰Nodeç‰ˆæœ¬) é¢„å¤„ç†å™¨çš„ä½œç”¨ å¸®åŠ©æ›´å¥½åœ°ç»„ç»‡CSSä»£ç  æé«˜ä»£ç å¤ç”¨ç‡ æé«˜å‡ç ç»´æŠ¤æ€§ é¢„å¤„ç†å™¨çš„èƒ½åŠ› åµŒå¥— æ”¾æ˜ å±‚çº§å’Œçº¦æŸ å˜é‡å’Œè®¡ç®— å‡å°‘é‡å¤ä»£ç  Extendå’ŒMixinä»£ç ç‰‡æ®µ å¾ªç¯ é€‚ç”¨äºå¤æ‚æœ‰è§„å¾‹çš„æ ·å¼ import CSSæ–‡ä»¶æ¨¡å—åŒ– ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š æé«˜ä»£ç å¤ç”¨ç‡å’Œå¯ç»´æŠ¤æ€§ ç¼ºç‚¹ï¼š éœ€è¦å¼•å…¥ç¼–è¯‘è¿‡ç¨‹ï¼Œæœ‰å­¦ä¹ æˆæœ¬","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(6) åŠ¨ç”»","slug":"CSSè®²è§£-6","date":"2019-02-09T13:41:24.000Z","updated":"2020-07-25T02:57:18.150Z","comments":true,"path":"2019/02/09/CSSè®²è§£-6/","link":"","permalink":"https://jigangduan.github.io/2019/02/09/CSSè®²è§£-6/","excerpt":"","text":"ä»‹ç»åŠ¨ç”»çš„åŸç†ï¼š è§†è§‰æš‚ç•™ä½œç”¨ ç”»é¢é€æ¸å˜åŒ– åŠ¨ç”»çš„ä½œç”¨ï¼š æ„‰æ‚¦æ„Ÿ å¼•èµ·æ³¨æ„ åé¦ˆ æ©é¥° CSSä¸­çš„åŠ¨ç”»ç±»å‹ï¼š transitionè¡¥é—´åŠ¨ç”» keyframeå…³é”®å¸§åŠ¨ç”» é€å¸§åŠ¨ç”» è¡¥é—´åŠ¨ç”» ä½ç½® - å¹³ç§»(left/right/margin/transform) æ–¹ä½ - æ—‹è½¬ (transform) å¤§å° - ç¼©æ”¾ (transform) é€æ˜åº¦(opacity) å…¶å®ƒ - çº¿æ€§å˜æ¢ (transform) See the Pen eXEROJ by jigang.duan (@jigang-duan) on CodePen. timing(easing)å®šä¹‰åŠ¨ç”»è¿›åº¦å’Œæ—¶é—´çš„å…³ç³» CSSç¼“åŠ¨åŠ¨ç”»å·¥å…· å…³é”®å¸§åŠ¨ç”»A -&gt; B -&gt; C ç›¸å½“äºå¤šä¸ªè¡¥é—´åŠ¨ç”»ä¸å…ƒç´ çŠ¶æ€çš„å˜åŒ–æ— å…³å®šä¹‰æ›´åŠ çµæ´» See the Pen LajLYz by jigang.duan (@jigang-duan) on CodePen. é€å¸§åŠ¨ç”»A B C CSSä¸­å±äºå…³é”®å¸§åŠ¨ç”»ï¼Œé€‚ç”¨äºæ— æ³•è¡¥é—´è®¡ç®—çš„åŠ¨ç”» èµ„æºè¾ƒå¤§ ä½¿ç”¨steps() See the Pen LajLpO by jigang.duan (@jigang-duan) on CodePen. 3D See the Pen qvXjbP by jigang.duan (@jigang-duan) on CodePen. çœŸé¢˜ cssåŠ¨ç”»çš„å®ç°æ–¹å¼æœ‰å‡ ç§ transition keyframesï¼ˆanimationï¼‰ è¿‡æ¸¡åŠ¨ç”»å’Œå…³é”®å¸§åŠ¨ç”»çš„åŒºåˆ« è¿‡æ¸¡åŠ¨ç”»éœ€è¦æœ‰çŠ¶æ€å˜åŒ– å…³é”®å¸§åŠ¨ç”»ä¸éœ€è¦çŠ¶æ€å˜åŒ– å…³é”®å¸§åŠ¨ç”»èƒ½æ§åˆ¶æ›´ç²¾ç»† å¦‚ä½•å®ç°é€å¸§åŠ¨ç”» ä½¿ç”¨å…³é”®å¸§åŠ¨ç”» å»æ‰è¡¥é—´(steps) CSSåŠ¨ç”»çš„æ€§èƒ½ æ€§èƒ½ä¸å éƒ¨åˆ†æƒ…å†µä¸‹ä¼˜äºJS ä½†JSå¯ä»¥åšåˆ°æ›´å¥½ éƒ¨åˆ†é«˜å±å±æ€§ box-shadowç­‰ æ¨è Animate.css","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(5) æ•ˆæœ","slug":"CSSè®²è§£-5","date":"2019-02-09T10:27:38.000Z","updated":"2020-07-25T02:57:18.150Z","comments":true,"path":"2019/02/09/CSSè®²è§£-5/","link":"","permalink":"https://jigangduan.github.io/2019/02/09/CSSè®²è§£-5/","excerpt":"","text":"æ•ˆæœå±æ€§**è¿™ä¸ªæ•ˆæœæ€ä¹ˆå®ç°ï¼Ÿ CSSæœ€å‡ºå½©ç­‰ä¸€éƒ¨åˆ† box-shadowbox-shadow å±æ€§å‘æ¡†æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªé˜´å½± è¥é€ å±‚æ¬¡æ„Ÿ(ç«‹ä½“æ„Ÿ) å……å½“æ²¡æœ‰å®½åº¦çš„è¾¹æ¡† ç‰¹æ®Šæ•ˆæœ See the Pen OqjgpG by jigang.duan (@jigang-duan) on CodePen. See the Pen qvXjmp by jigang.duan (@jigang-duan) on CodePen. See the Pen WmEOON by jigang.duan (@jigang-duan) on CodePen. CSS3é˜´å½±æ¼”ç¤ºå·¥å…· text-shadow ç«‹ä½“æ„Ÿ å°åˆ·å“è´¨æ„Ÿ See the Pen JzyJrM by jigang.duan (@jigang-duan) on CodePen. border-radius åœ†è§’è·å½¢ åœ†å½¢ åŠåœ† / æ‰‡å½¢ ä¸€äº›å¥‡æ€ªçš„è§’è§’ See the Pen eXERev by jigang.duan (@jigang-duan) on CodePen. background çº¹ç†ï¼Œå›¾æ¡ˆ æ¸å˜ é›ªç¢§å›¾åŠ¨ç”» èƒŒæ™¯å›¾å°ºå¯¸é€‚åº” See the Pen rRzwJm by jigang.duan (@jigang-duan) on CodePen. See the Pen rRzwdw by jigang.duan (@jigang-duan) on CodePen. clip-path å¯¹å®¹å™¨è¿›è¡Œè£å‰ª å¸¸è§å‡ ä½•å›¾å½¢ è‡ªå®šä¹‰è·¯å¾„ See the Pen RdZgyv by jigang.duan (@jigang-duan) on CodePen. 3D å˜æ¢ å˜æ¢ transform translate å¹³ç§» scale ç¼©æ”¾ skew å€¾æ–œ rotate æ—‹è½¬ åœ¨3Dç©ºé—´è¿›è¡Œå˜æ¢ See the Pen xBLrJW by jigang.duan (@jigang-duan) on CodePen. çœŸé¢˜ å¦‚ä½•ç”¨ä¸€ä¸ªdivç”» xxx box-shadow æ— é™æŠ•å½± ::before ::after å¦‚ä½•äº§ç”Ÿä¸å ç©ºé—´çš„è¾¹æ¡† box-shadow outline å¦‚ä½•å®ç°åœ†å½¢å…ƒç´  border-radius:50% å¦‚æœå®ç°iOSå›¾æ ‡çš„åœ†è§’ clip-path: (svg) å¦‚ä½•å®ç°åŠåœ†ï¼Œæ‰‡å½¢ç­‰å›¾å½¢ border-radiusç»„åˆï¼š æœ‰æ— è¾¹æ¡† è¾¹æ¡†ç²—ç»† åœ†è§’åŠå¾„ å¦‚ä½•å®ç°èƒŒæ™¯å›¾å±…ä¸­æ˜¾ç¤º / ä¸é‡å¤ / æ”¹å˜å¤§å° background-position background-repeat background-size(cover/contain) å¦‚ä½•å¹³ç§»/æ”¾å¤§ä¸€ä¸ªå…ƒç´  transform: translateX(100px) transform: scale(2) å¦‚ä½•å®ç°3Dæ•ˆæœ perspective: 300px transform-style: preserve-3d; transform: translate rotate â€¦","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(4) å¸ƒå±€","slug":"CSSè®²è§£-4","date":"2019-02-07T22:25:25.000Z","updated":"2020-07-25T02:57:18.150Z","comments":true,"path":"2019/02/08/CSSè®²è§£-4/","link":"","permalink":"https://jigangduan.github.io/2019/02/08/CSSè®²è§£-4/","excerpt":"","text":"ç®€ä»‹ CSSçŸ¥è¯†ä½“ç³»çš„é‡ä¸­ä¹‹é‡ æ—©æœŸä»¥tableä¸ºä¸»(ç®€å•) åæ¥ä»¥æŠ€å·§æ€§å¸ƒå±€ä¸ºä¸»(éš¾) ç°ä»£æœ‰flexbox/griod(åç®€å•) å“åº”å¼å¸ƒå±€ å¸¸è§å¸ƒå±€æ–¹æ³• table è¡¨æ ¼å¸ƒå±€ float æµ®åŠ¨ + margin inline-block å¸ƒå±€ flexboxå¸ƒå±€ è¡¨æ ¼å¸ƒå±€å¸ƒå±€ç®€å• See the Pen MxmYvx by jigang.duan (@jigang-duan) on CodePen. tableä¸­å†…å®¹æ°´å¹³å±…ä¸­ æ¨¡æ‹Ÿtable: 123display: table;display: table-row;display: table-cell; ä¸€äº›å¸ƒå±€å±æ€§ç›’æ¨¡å‹ display / position ç¡®å®šå…ƒç´ çš„æ˜¾ç¤ºç±»å‹ block / inline / inline-block See the Pen pYPvYm by jigang.duan (@jigang-duan) on CodePen. ç¡®å®šå…ƒç´ çš„ä½ç½® static é»˜è®¤ï¼Œæ­£å¸¸æ–‡æ¡£æµ relative ç›¸å¯¹å®šä½ ç›¸å¯¹è‡ªèº« ä¸ä¼šå½±å“æ–‡æ¡£æµ å¯¹absoluteçš„é™åˆ¶ä½œç”¨ absolute ç»å¯¹å¸ƒå±€ è„±ç¦»æ–‡æ¡£æµ fixed ç›¸å¯¹äºå±å¹• è„±ç¦»æ–‡æ¡£æµ ã€å‰ç«¯Talkkingã€‘CSSç³»åˆ—â€”â€”CSSæ·±å…¥ç†è§£ä¹‹absoluteå®šä½ã€å‰ç«¯Talkkingã€‘CSSç³»åˆ—â€”â€”CSSæ·±å…¥ç†è§£ä¹‹absoluteå®šä½ flexbox å¼¹æ€§ç›’å­ ç›’å­æœ¬æ¥å°±æ˜¯å¹¶åˆ—çš„ æŒ‡å®šå®½åº¦å³å¯ See the Pen GeEWBW by jigang.duan (@jigang-duan) on CodePen. inline-block åƒæ–‡æœ¬ä¸€æ ·æ’blockå…ƒç´  æ²¡æœ‰æ¸…é™¤æµ®åŠ¨ç­‰é—®é¢˜ éœ€è¦å¤„ç†é—´éš™ See the Pen PLKjzV by jigang.duan (@jigang-duan) on CodePen. å“åº”å¼å¸ƒå±€ åœ¨ä¸åŒè®¾å¤‡ä¸Šæ­£å¸¸ä½¿ç”¨ ä¸€èˆ¬ä¸»è¦å¤„ç†å±å¹•å¤§å°é—®é¢˜ ä¸»è¦æ–¹æ³• éšè— + æŠ˜è¡Œ + è‡ªé€‚åº”ç©ºé—´ rem / viewport / media query See the Pen XGagNp by jigang.duan (@jigang-duan) on CodePen. See the Pen GevErP by jigang.duan (@jigang-duan) on CodePen.","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(3) CSSåŸºç¡€","slug":"CSSè®²è§£-3","date":"2019-02-06T15:45:44.000Z","updated":"2020-07-25T02:57:18.149Z","comments":true,"path":"2019/02/06/CSSè®²è§£-3/","link":"","permalink":"https://jigangduan.github.io/2019/02/06/CSSè®²è§£-3/","excerpt":"","text":"CSS Cascading Style Sheet å±‚å æ ·å¼è¡¨ ä¸¾ä¾‹ï¼š See the Pen MxJELO by jigang.duan (@jigang-duan) on CodePen. æƒé‡é«˜é€‰æ‹©å™¨çš„æ ·å¼è¦†ç›–æƒé‡ä½çš„ï¼Œè¿›è¡Œå åŠ  åŸºæœ¬è§„åˆ™1234é€‰æ‹©å™¨ &#123; å±æ€§: å€¼; å±æ€§: å€¼;&#125; é€‰æ‹©å™¨ ç”¨äºåŒ¹é…HTMLå…ƒç´  æœ‰ä¸åŒçš„åŒ¹é…è§„åˆ™ å¤šä¸ªé€‰æ‹©æ˜¯å¯ä»¥å åŠ çš„ åˆ†ç±»å’Œæƒé‡ è§£ææ–¹å¼å’Œæ€§èƒ½ è§£ææ–¹å¼ æµè§ˆå™¨æ˜¯ä»å³å¾€å·¦ï¼Œå…ˆæ‰¾æœ€å³è¾¹çš„é€‰æ‹©å™¨ï¼Œå†éªŒè¯ä¸Šçº§æ˜¯å¦ç¬¦åˆ ä¸ºäº†åŠ å¿«å“ªäº›ä¸ç¬¦åˆ å€¼å¾—å…³æ³¨çš„é€‰æ‹©å™¨ é€‰æ‹©å™¨åˆ†ç±» å…ƒç´ é€‰æ‹©å™¨ a{} ä¼ªå…ƒç´ é€‰æ‹©å™¨ ::before{} ç±»é€‰æ‹©å™¨ .link{} å±æ€§é€‰æ‹©å™¨ [type=rodio]{} ä¼ªç±»é€‰æ‹©å™¨ :hover{} IDé€‰æ‹©å™¨ #id{} ç»„åˆé€‰æ‹©å™¨ [type=checkbox] + label{} å¦å®šé€‰æ‹©å™¨ :not(.link){} é€šç”¨é€‰æ‹©å™¨ *{} ä¼ªå…ƒç´ : ä¸ä¼šå‡ºç°å†HTMLä¸­ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨DOMæ ‘ä¸­ï¼Œä½†å®ƒä¸€ä¸ªçœŸå®å­˜åœ¨çš„å…ƒç´ ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå†…å®¹å’Œè®¾ç½®æ ·å¼ ä¼ªç±»: è¡¨ç¤ºçŠ¶æ€ é€‰æ‹©å™¨æƒé‡ é€‰æ‹©å™¨ æƒé‡å€¼ IDé€‰æ‹©å™¨ #id{} +100 ç±» +10 å±æ€§ +10 ä¼ªç±» +10 å…ƒç´  +1 ä¼ªå…ƒç´  +1 å…¶å®ƒ +0 è®¡ç®—ä¸€ä¸ªä¸è¿›ä½çš„æƒé‡å€¼ æ¯”å¦‚ï¼š #id .link a[href] 100(#id) + 10(.link) + 1(a) + 0([href]) = 111 #id .link.active 100(#id) + 10(.link) + 10(.active) = 120 ä¸è¿›ä½: æ•°å­—ä¸è¿›ä½çš„ï¼Œæ¯”å¦‚å¤šå°‘ä¸ªç±»é€‰æ‹©å™¨æƒé‡ç›¸åŠ éƒ½ä¸èƒ½è¶…è¿‡IDé€‰æ‹©å™¨æƒé‡ ä¸¾ä¾‹ï¼š See the Pen EMZoOZ by jigang.duan (@jigang-duan) on CodePen. å…¶å®ƒè§„åˆ™ !important ä¼˜å…ˆçº§æœ€é«˜ å…ƒç´ å±æ€§ ä¼˜å…ˆçº§é«˜ ç›¸åŒæƒé‡ åå†™çš„ç”Ÿæ•ˆ ä¾‹å­ï¼š See the Pen KEaQzV by jigang.duan (@jigang-duan) on CodePen. éå¸ƒå±€æ ·å¼å­—ä½“ å­—ä½“æ— serif / sans-serif / monospace / cursive / fantantasy å¤šå­—ä½“fallback æŒ‡å®šå­—ä½“æ‰¾ä¸åˆ°ï¼Œå°±å‘åæŸ¥æ‰¾ ç½‘ç»œå­—ä½“ï¼Œè‡ªå®šä¹‰å­—ä½“ iconfont See the Pen KEaQXg by jigang.duan (@jigang-duan) on CodePen. iconfont-é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“ä½¿ç”¨äº†ä¼ªå…ƒç´  before è¡Œé«˜ è¡Œé«˜çš„æ„æˆ è¡Œé«˜ç›¸å…³çš„ç°è±¡å’Œæ–¹æ¡ˆ è¡Œé«˜çš„è°ƒæ•´ See the Pen Gerxoo by jigang.duan (@jigang-duan) on CodePen. ä¸ºä»€ä¹ˆè¡Œé«˜è®¾çš„ä¸ä¸€æ ·ï¼Œä½†æ˜¾ç¤ºçš„è¡Œé«˜æ˜¯ä¸€æ ·çš„ï¼Ÿ æ–‡æœ¬æ’ç‰ˆ cssè¡Œé«˜line-heightçš„ä¸€äº›æ·±å…¥ç†è§£åŠåº”ç”¨ èƒŒæ™¯ èƒŒæ™¯é¢œè‰² æ¸å˜è‰²èƒŒæ™¯ å¤šèƒŒæ™¯å åŠ  èƒŒæ™¯å›¾ç‰‡å’Œå±æ€§ (é›ªç¢§å›¾) base64å’Œæ€§èƒ½ä¼˜åŒ– å¤šåˆ†è¾¨ç‡é€‚é… See the Pen WmpEBW by jigang.duan (@jigang-duan) on CodePen. See the Pen pYepLB by jigang.duan (@jigang-duan) on CodePen. è¾¹æ¡† è¾¹æ¡†çš„å±æ€§ï¼š çº¿å‹ å¤§å° é¢œè‰² è¾¹æ¡†èƒŒæ™¯å›¾ è¾¹æ¡†è¡”æ¥(ä¸‰å˜å½¢) See the Pen xBqYMj by jigang.duan (@jigang-duan) on CodePen. æ»šåŠ¨ æ»šåŠ¨è¡Œä¸ºå’Œæ»šåŠ¨æ¡ visible hidden scroll auto æ–‡æœ¬æŠ˜è¡Œ overflow-wrap(word-wrap)é€šç”¨æ¢è¡Œæ§åˆ¶ æ˜¯å¦ä¿ç•™å•è¯ word-break é’ˆå¯¹å¤šå­—èŠ‚æ–‡å­— ä¸­æ–‡å¥å­ä¹Ÿæ˜¯å•è¯ white-space ç©ºç™½å¤„æ˜¯å¦æ–­è¡Œ è£…é¥°æ€§å±æ€§ å­—é‡ï¼ˆç²—ä½“ï¼‰ font-weight æ–œä½“ font-style: itatic ä¸‹åˆ’çº¿ text-decoration æŒ‡é’ˆ cursor See the Pen pYeVrG by jigang.duan (@jigang-duan) on CodePen. CSS Hack Hack å³ä¸åˆæ³•ä½†ç”Ÿæ•ˆçš„å†™æ³• ä¸»è¦ç”¨äºåŒºåˆ†ä¸åŒæµè§ˆå™¨ ç¼ºç‚¹ï¼šéš¾ç†è§£ éš¾ç»´æŠ¤ æ˜“å¤±æ•ˆ æ›¿ä»£æ–¹æ¡ˆï¼š ç‰¹æ€§æ£€æµ‹ æ›¿ä»£æ–¹æ¡ˆï¼š é’ˆå¯¹æ€§åŠ class å®ä¾‹ See the Pen KEWejN by jigang.duan (@jigang-duan) on CodePen. çœŸé¢˜ CSSæ ·å¼(é€‰æ‹©å™¨)çš„ä¼˜å…ˆçº§ è®¡ç®—æƒé‡ç¡®å®š !important å†…è”æ ·å¼ åå†™ä¼˜å…ˆçº§é«˜ é›ªç¢§å›¾çš„ä½œç”¨ å‡å°‘HTTPè¯·æ±‚æ•° æé«˜åŠ è½½æ€§èƒ½ æœ‰ä¸€äº›æƒ…å†µä¸‹å¯ä»¥å‡å°‘å›¾ç‰‡å¤§å° è‡ªå®šä¹‰å­—ä½“çš„ä½¿ç”¨åœºæ™¯ å®£ä¼ /å“ç‰Œ/bannerç­‰å›ºå®šæ–‡æ¡ˆ å­—ä½“å›¾æ ‡","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(2) HTML","slug":"CSSè®²è§£-2","date":"2019-02-05T15:36:29.000Z","updated":"2020-07-25T02:57:18.149Z","comments":true,"path":"2019/02/05/CSSè®²è§£-2/","link":"","permalink":"https://jigangduan.github.io/2019/02/05/CSSè®²è§£-2/","excerpt":"","text":"å‰ç«¯ä¸‰å¤§ä»¶ï¼š HTML ç»“æ„ CSS æ ·å¼ JavaScript è¡Œä¸º å¸¸è§å…ƒç´ å’Œç†è§£å¸¸è§å…ƒç´ headä¸ç›´æ¥å‡ºç°åœ¨é¡µé¢ä¸Š,æè¿°æˆ–å¼•ç”¨èµ„æº meta title style link script base 1&lt;meta charset=\"utf-8\"&gt; å­—ç¬¦é›† utf-8 1&lt;meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no\"&gt; è§†å£ width=device-width è§†å£å®½åº¦ç­‰äºè®¾å¤‡å®½åº¦ initial-scale=1.0 åˆå§‹åŒ–çš„ç¼©æ”¾ 1å€ maximum-scale=1.0 æœ€å¤§ç¼©æ”¾ 1å€ user-scalable=no ç”¨æˆ·ä¸èƒ½ç¼©æ”¾ 1&lt;base href=\"/\"&gt; æŒ‡å®šåŸºç¡€è·¯å¾„ï¼Œæ‰€æœ‰é“¾æ¥éƒ½æ˜¯ä»¥è¿™ä¸ªè·¯å¾„ä¸ºåŸºç¡€ bodyå‡ºç°åœ¨é¡µé¢ä¸Š div / section / article / aside / header / footer p span / em / strong table / thead / tbody / tr / td ul / ol / li / dl / dt / dd a form / input / select / textarea / button HTMLé‡è¦å±æ€§ a[href,target] href é“¾æ¥åœ°å€ target _blank æ–°çª—å£ä¸­æ‰“å¼€é“¾æ¥ _self ç›¸åŒçš„æ¡†æ¶ä¸­æ‰“å¼€é“¾æ¥ _parent çˆ¶æ¡†æ¶é›†ä¸­æ‰“å¼€é“¾æ¥ _top åœ¨æ•´ä¸ªçª—å£ä¸­æ‰“å¼€é“¾æ¥ framename æŒ‡å®šçš„æ¡†æ¶ä¸­æ‰“å¼€é“¾æ¥ img[src,alt] src å›¾ç‰‡åœ°å€ alt æ›¿æ¢å­—ç¬¦ï¼Œå½“å›¾ç‰‡ä¸å¯ç”¨æ—¶æ˜¾ç¤º table td[colspan,rowspan] colspan å•å…ƒæ ¼å¯æ¨ªè·¨çš„åˆ—æ•° rowspan å•å…ƒæ ¼å¯æ¨ªè·¨çš„è¡Œæ•° form[target,method,enctype] target è§„å®šåœ¨ä½•å¤„æ‰“å¼€ action URL _blank _self _parent _top framename method è§„å®šå¦‚ä½•å‘é€è¡¨å•æ•°æ® POST æ–¹æ³• GET æ–¹æ³• enctype è§„å®šå¦‚ä½•å¯¹è¡¨å•æ•°æ®è¿›è¡Œç¼–ç  application/x-www-form-urlencoded: urlencodedç¼–ç æ‰€æœ‰å­—ç¬¦ multipart/form-data: ä¸å¯¹å­—ç¬¦ç¼–ç ,ä½¿ç”¨åŒ…å«æ–‡ä»¶ä¸Šä¼  text/plain: ç©ºæ ¼è½¬æ¢ä¸º â€œ+â€ åŠ å· input[type,value] type è§„å®š input å…ƒç´ çš„ç±»å‹ button å¯ç‚¹å‡»æŒ‰é’® checkbox å¤é€‰æ¡† file æ–‡ä»¶ä¸Šä¼  hidden éšè—çš„è¾“å…¥å­—æ®µ image å›¾åƒå½¢å¼çš„æäº¤æŒ‰é’® password å¯†ç  radio å•é€‰æŒ‰é’® name å•é€‰æ¡†nameä¸€æ ·è¡¨ç¤ºä¸€ç»„ reset é‡ç½®æŒ‰é’®,æ¸…é™¤è¡¨å•ä¸­çš„æ‰€æœ‰æ•°æ® submit æäº¤æŒ‰é’®,æŠŠè¡¨å•æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ text è¾“å…¥å­—æ®µ button[type] type è§„å®šæŒ‰é’®çš„ç±»å‹ submit button reset select&gt;option[value] label[for] for å’Œè¡¨å•é¡¹å…³è” äº‹ä¾‹ See the Pen gELEQG by jigang.duan (@jigang-duan) on CodePen. å¦‚æœç†è§£HTML HTML æ–‡æ¡£ æè¿°æ–‡æ¡£çš„ç»“æ„ æœ‰åŒºå—å’Œå¤§çº² 123456789101112131415161718192021&lt;section&gt; &lt;h1&gt;æ£®æ—è±¡&lt;/h1&gt; &lt;section&gt; &lt;h1&gt;ä»‹ç»&lt;/h1&gt; &lt;p&gt;åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºé²œä¸ºäººçŸ¥çš„æ£®æ—è±¡.&lt;/p&gt; &lt;/section&gt; &lt;section&gt; &lt;h1&gt;æ –æ¯åœ°&lt;/h1&gt; &lt;p&gt;æ£®æ—è±¡ä¸ç”Ÿæ´»åœ¨æ ‘ä¸Šï¼Œè€Œæ˜¯ç”Ÿæ´»åœ¨æ ‘ä¸Š.&lt;/p&gt; &lt;/section&gt; &lt;aside&gt; &lt;p&gt;å¹¿å‘Šå—&lt;/p&gt; &lt;/aside&gt;&lt;/section&gt;&lt;footer&gt; &lt;p&gt;(c) 2010 å…¬å¸ä¾‹å­&lt;/p&gt;&lt;/footer&gt; æ–‡æ¡£çš„å¤§çº²ï¼š 12341. æ£®æ—è±¡ 1.1 ä»‹ç» 1.2 æ –æ¯åœ° 1.3 Section (aside) è¯­ä¹‰åŒ–çš„æ ‡ç­¾ W3Cå¤§çº²å·¥å…·ï¼š http://h5o.github.io/ è…¾è®¯é¦–é¡µçš„å¤§çº²: HTMLç‰ˆæœ¬HTML5 æ¨èç‰ˆæœ¬ HTML4 / 4.01(SGML) SGML æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ XHTML (XML) HTML5 HTML4 XHTML HTML5 æ ‡ç­¾å…è®¸ä¸ç»“æŸ æ ‡ç­¾å¿…é¡»ç»“æŸ æ ‡ç­¾å…è®¸ä¸ç»“æŸ å±æ€§ä¸ç”¨å¸¦å¼•å· å±æ€§å¿…é¡»å¸¦å¼•å· å±æ€§ä¸ç”¨å¸¦å¼•å· æ ‡ç­¾å±æ€§å¯å¤§å†™ æ ‡ç­¾å±æ€§å¿…é¡»å°å†™ æ ‡ç­¾å±æ€§å¯å¤§å†™ Booleanå±æ€§å¯çœç•¥å€¼ Booleanå±æ€§å¿…é¡»å†™å€¼ Booleanå±æ€§å¯çœç•¥å€¼ XHTML ä¾‹å­: 12345678910111213141516&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /&gt;&lt;title&gt;test&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"test\"&gt;åˆæ³•&lt;/div&gt; &lt;DIV class=\"test\"&gt;æ ‡ç­¾åå¤§å†™&lt;/DIV&gt; &lt;div ID=\"test\"&gt;å±æ€§åå¤§å†™&lt;/div&gt; &lt;input type=\"checkbox\" checked /&gt; &lt;p&gt;æ ‡ç­¾ä¸ç»“æŸ1 &lt;p&gt;æ ‡ç­¾ä¸ç»“æŸ2 &lt;div style=color:red&gt;å±æ€§ä¸å¸¦å¼•å·&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; DOCTYPE ä¸ä¸€æ · xmlns å‘½åç©ºé—´ HTML5 ä¾‹å­: 123456789101112131415&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=\"utf-8\" /&gt;&lt;title&gt;test&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;DIV class=\"test\"&gt;æ ‡ç­¾åå¤§å†™&lt;/DIV&gt; &lt;div ID=\"test\"&gt;å±æ€§åå¤§å†™&lt;/div&gt; &lt;input type=\"checkbox\" checked /&gt; &lt;p&gt;æ ‡ç­¾ä¸ç»“æŸ1 &lt;p&gt;æ ‡ç­¾ä¸ç»“æŸ2 &lt;div style=color:red&gt;å±æ€§ä¸å¸¦å¼•å·&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; HTML5æ–°å¢å†…å®¹ æ–°åŒºå—æ ‡ç­¾ section article nav aside è¡¨å•å¢å¼º æ—¥æœŸ,æ—¶é—´,æœç´¢ è¡¨å•éªŒè¯ Placeholder è‡ªåŠ¨èšç„¦ è¯­ä¹‰çš„æ”¹å˜ header / footer å¤´å°¾ section / article åŒºåŸŸ nav å¯¼èˆª aside ä¸é‡è¦å†…å®¹ em / strong å¼ºè°ƒ i icon HTMLå…ƒç´ åˆ†ç±» æŒ‰é»˜è®¤æ ·å¼åˆ†ç±» å—çº§ block ç‹¬å ä¸€è¡Œ è¡Œå†… inline ä¸ä¸€å®šæœ‰è§„åˆ™å½¢çŠ¶ï¼Œè®¾ç½®å°ºå¯¸æ— æ•ˆ inline-block å¯¹å¤–inlineå¯¹å†…blockï¼Œæ˜¯è§„åˆ™çš„æ–¹å—ï¼Œæœ‰å°ºå¯¸ See the Pen GerNYR by jigang.duan (@jigang-duan) on CodePen. æŒ‰å†…å®¹åˆ†ç±» ï¼ˆå†…å®¹æ¨¡å‹ï¼‰ æµï¼ˆFlowï¼‰å†…å®¹ï¼šåŒ…å«åœ¨æ–‡æ¡£æ­£å¸¸æµä¸­çš„å¤§å¤šæ•°HTML5å…ƒç´  å…ƒæ•°æ®ï¼ˆMetadataï¼‰ï¼šé€šå¸¸å‡ºç°åœ¨é¡µé¢çš„headä¸­ï¼Œè®¾ç½®é¡µé¢å…¶ä»–éƒ¨åˆ†çš„è¡¨ç°å’Œè¡Œä¸º å…ƒç´ ï¼š&lt;base&gt;ï¼Œ&lt;link&gt;ï¼Œ&lt;meta&gt;ï¼Œ&lt;noscript&gt;ï¼Œ&lt;script&gt;ï¼Œ&lt;style&gt;ï¼Œ&lt;title&gt; å†…è”ï¼ˆEmbeddedï¼‰ï¼šåœ¨æ–‡æ¡£ä¸­æ·»åŠ å…¶ä»–ç±»å‹çš„å†…å®¹ å…ƒç´ ï¼š&lt;audio&gt;ï¼Œ&lt;video&gt;ï¼Œ&lt;canvas&gt;ï¼Œ&lt;iframe&gt;ï¼Œ&lt;img&gt;ï¼Œ&lt;math&gt;ï¼Œ&lt;object&gt;ï¼Œ&lt;svg&gt; äº¤äº’ï¼ˆInteractiveï¼‰ï¼šä¸ç”¨æˆ·äº¤äº’çš„å†…å®¹ å…ƒç´ ï¼š&lt;a&gt; , &lt;audio&gt; , &lt;video&gt; , &lt;button&gt; , &lt;details&gt; , &lt;embed&gt; , &lt;iframe&gt; , &lt;img&gt; , &lt;input&gt; , &lt;label&gt; , &lt;object&gt; , &lt;select&gt; , &lt;textarea&gt; æ ‡é¢˜ï¼ˆHeadingï¼‰ï¼šå®šä¹‰æ®µè½æ ‡é¢˜ å…ƒç´ ï¼š&lt;h1&gt;ï¼Œ&lt;h2&gt;ï¼Œ&lt;h3&gt;ï¼Œ&lt;h4&gt;ï¼Œ&lt;h5&gt;ï¼Œ&lt;h6&gt;ï¼Œ&lt;hgroup&gt; çŸ­è¯­ï¼ˆPhrasingï¼‰ï¼šæ–‡æœ¬å’Œæ–‡æœ¬æ ‡è®°å…ƒç´  å…ƒç´ ï¼š&lt;img&gt;ï¼Œ&lt;span&gt;ï¼Œ&lt;strong&gt;ï¼Œ&lt;label&gt;ï¼Œ&lt;br /&gt;ï¼Œ&lt;small&gt;ï¼Œ&lt;sub&gt;ç­‰ åŒºæ®µï¼ˆsectioningï¼‰å†…å®¹ï¼šå®šä¹‰æ ‡é¢˜ï¼Œå†…å®¹ï¼Œå¯¼èˆªå’Œé¡µè„šçš„èŒƒå›´ å…ƒç´ ï¼š&lt;article&gt;ï¼Œ&lt;aside&gt;ï¼Œ&lt;nav&gt;ï¼Œ&lt;section&gt; å†…å®¹åˆ†ç±»åŠ¨æ€å›¾https://www.w3.org/TR/html51/dom.html#kinds-of-content HTMLå…ƒç´ åµŒå¥—å…³ç³» å—çº§å…ƒç´ å¯ä»¥åŒ…å«è¡Œå†…å…ƒç´  å—çº§å…ƒç´ ä¸ä¸€å®šèƒ½åŒ…å«å—çº§å…ƒç´  è¡Œå†…å…ƒç´ ä¸€èˆ¬ä¸èƒ½åŒ…å«å—çº§å…ƒç´  ä½†æ˜¯â€¦..ä»€ä¹ˆå«ä¸€èˆ¬ (æ¯”å¦‚aå…ƒç´ å¯ä»¥åŒ…å«å—å…ƒç´ ) HTML 4.01è¿‡æ¸¡çš„åµŒå¥—è§„åˆ™ ä¸ºä»€ä¹ˆa &gt; divæ˜¯åˆæ³•çš„ï¼Ÿ é€æ˜å†…å®¹æ¨¡å‹ï¼Œåœ¨è®¡ç®—å†…å®¹æ¨¡å‹æ—¶æ­¤å…ƒç´ æœ¬èº«ä¸å‚ä¸è®¡ç®—,ç›¸å½“äºaæ—¶ä¸å­˜åœ¨çš„ æ˜¯å¦åˆæ³•å–å†³å¤–é¢çš„å…ƒç´  123&lt;div&gt;&lt;a href=\"#\"&gt;DIV &amp;gt; A&lt;/a&gt;&lt;/div&gt;&lt;a href=\"#\"&gt;&lt;div&gt;A &amp;gt; DIV&lt;/div&gt;&lt;/a&gt;&lt;p&gt;&lt;a href=\"#\"&gt;&lt;div&gt;P &amp;gt; A &amp;gt; DIV&lt;/div&gt;&lt;/a&gt;&lt;/p&gt; DIV &gt; A åˆæ³• A &gt; DIV åˆæ³•ï¼ˆç›¸å½“äºDIVï¼‰ P &gt; A &gt; DIV (ç›¸å½“äºå»æ‰Aï¼ŒP &gt; DIV, Pä¸èƒ½åŒ…å«DIVï¼Œæµè§ˆå™¨ä¼šå»å®¹é”™å˜æ¢) HTMLå…ƒç´ é»˜è®¤æ ·å¼å’Œå®šåˆ¶åŒ–HTMLå…ƒç´ é»˜è®¤æ ·å¼ä¸åŠ ä»»ä½•æ ·å¼çš„æ—¶å€™ï¼Œå…ƒç´ æœ¬æ¥çš„æ ·å¼ é»˜è®¤æ ·å¼çš„æ„ä¹‰ æ¨¡å¼æ ·å¼å¸¦æ¥çš„é—®é¢˜ CSS Resetå¸¸è§çš„æ–¹æ¡ˆï¼š CSS Tools: Reset CSS é›…è™YUL CSS Reset æ¯”è¾ƒæœ‰äº‰è®®çš„ä¸€ç§:123456&lt;style&gt; *&#123; margin: 0; padding: 0; &#125;&lt;/style&gt; Normalize.css ä¿æŠ¤æœ‰ç”¨çš„æµè§ˆå™¨æ ·å¼è€Œä¸æ˜¯å»æ‰ä»–ä»¬ ä¸€èˆ¬åŒ–çš„æ ·å¼ï¼šä¸ºå¤§éƒ¨åˆ†HTMLå…ƒç´ æä¾› ä¿®å¤æµè§ˆå™¨è‡ªèº«çš„bugå¹¶ä¿è¯å„æµè§ˆå™¨çš„ä¸€è‡´æ€§ ä¼˜åŒ–csså¯ç”¨æ€§ï¼šç”¨ä¸€äº›å°æŠ€å·§ è§£é‡Šä»£ç ï¼šæ³¨é‡Šå’Œè¯¦ç»†çš„æ–‡æ¡£ HTML çœŸé¢˜ doctypeçš„æ„ä¹‰æ˜¯ä»€ä¹ˆ è®©æµè§ˆå™¨ä»¥æ ‡å‡†æ¨¡å¼æ¸²æŸ“ è®©æµè§ˆå™¨çŸ¥é“å…ƒç´ çš„åˆæ³•æ€§ HTML XHTML HTML5çš„å…³ç³» HTMLå±äºSGML XHTMLå±äºXML æ˜¯HTMLè¿›è¡ŒXMLä¸¥æ ¼åŒ–çš„ç»“æœ HTML5ä¸å±äºSGMLæˆ–XMLï¼Œæ¯”XHTMLå®½æ¾ HTML5æœ‰ä»€ä¹ˆå˜åŒ– æ–°çš„è¯­ä¹‰åŒ–å…ƒç´  è¡¨å•å¢å¼º æ–°çš„API (ç¦»çº¿ï¼ŒéŸ³é¢‘ï¼Œå›¾å½¢ï¼Œå®æ—¶é€šä¿¡ï¼Œæœ¬åœ°å­˜å‚¨ï¼Œè®¾å¤‡èƒ½åŠ›) åˆ†ç±»å’ŒåµŒå¥—å˜æ›´ em å’Œ i æœ‰ä»€ä¹ˆåŒºåˆ« em æ˜¯è¯­ä¹‰åŒ–çš„æ ‡ç­¾ï¼Œè¡¨å¼ºè°ƒ i æ˜¯çº¯æ ·å¼çš„æ ‡ç­¾ï¼Œè¡¨æ–œä½“ i ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼Œä¸€èˆ¬ä½œå›¾æ ‡iconä½¿ç”¨ è¯­ä¹‰åŒ–çš„æ„ä¹‰æ˜¯ä»€ä¹ˆ å¼€å‘è€…å®¹æ˜“ç†è§£ æœºå™¨å®¹æ˜“ç†è§£ç»“æ„ï¼ˆæœç´¢ï¼Œè¯»å±è½¯ä»¶ï¼‰ æœ‰åŠ©äºSEO semantic microdata å“ªäº›å…ƒç´ å¯ä»¥è‡ªé—­åˆ è¡¨å•å…ƒç´  input å›¾ç‰‡ img br hr meta link HTMLå’ŒDOMçš„å…³ç³» HTMLæ˜¯æ­»çš„ DOMç”±HTMLè§£æè€Œæ¥ï¼Œæ˜¯æ´»çš„ JSå¯ä»¥ç»´æŠ¤çš„æ˜¯DOM propertyå’Œattributeçš„åŒºåˆ« attribute æ˜¯æ­»çš„ property æ˜¯æ´»çš„ formçš„ä½œç”¨æœ‰å“ªäº› ç›´æ¥æäº¤è¡¨å• ä½¿ç”¨submit/resetæŒ‰é’® ä¾¿äºæµè§ˆå™¨ä¿å­˜è¡¨å• ç¬¬ä¸‰æ–¹åº“å¯ä»¥æ•´ä½“æå–å€¼ ç¬¬ä¸‰æ–¹å¯ä»¥è¿›è¡Œè¡¨å•éªŒè¯","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSè®²è§£(1) ä»‹ç»","slug":"CSSè®²è§£-1-1","date":"2019-02-05T13:22:38.000Z","updated":"2020-07-25T02:57:18.149Z","comments":true,"path":"2019/02/05/CSSè®²è§£-1-1/","link":"","permalink":"https://jigangduan.github.io/2019/02/05/CSSè®²è§£-1-1/","excerpt":"","text":"å‰ç«¯ä¸‰å¤§ä»¶ HTML CSS JavaScript ä¸ä¼šCSSçš„å‰ç«¯åªèƒ½å«ä½œä¼ªå‰ç«¯ å†…å®¹ HTMLå’ŒCSSåŸºç¡€çŸ¥è¯† HTMLå…ƒç´ çš„åˆ†ç±»å’Œç‰¹æ€§ HTMLå…ƒç´ é»˜è®¤æ ·å¼å’Œå®šåˆ¶åŒ– CSSé€‰æ‹©å™¨å…¨è§£æ CSSå¸¸è§å±æ€§ CSSå¸ƒå±€ å¸ƒå±€å±æ€§å’Œç»„åˆè§£æ å¸¸è§å¸ƒå±€æ–¹æ¡ˆ ä¸‰æ å¸ƒå±€ å›½å†…å¤§ç«™å¸ƒå±€æ–¹æ¡ˆ åŠ¨ç”»å’Œæ•ˆæœ å¤šèƒŒæ™¯å¤šæŠ•å½±ç‰¹æ•ˆ 3Dç‰¹æ•ˆç¼–å†™å®è·µ è¿‡æ¸¡åŠ¨ç”»å’Œå…³é”®å¸§åŠ¨ç”»å®è·µ åŠ¨ç”»ç»†èŠ‚å’ŒåŸç†è§£æ æ¡†æ¶é›†æˆå’ŒCSSå·¥ç¨‹åŒ– é¢„å¤„ç†å™¨ä½œç”¨å’ŒåŸç† Less/Sassä»£ç å®è·µ BootstrapåŸç†å’Œç”¨æ³• CSSå·¥ç¨‹åŒ–å®è·µæ–¹å¼ JSæ¡†æ¶ä¸­çš„CSSé›†æˆå®è·µ è§£æ HTMLå…ƒç´ çš„åµŒå¥—å…³ç³»æ˜¯æ€ä¹ˆç¡®å®šçš„ å“ªäº›åµŒå¥—ä¸å¯ä»¥å‘ç”Ÿ CSSé€‰æ‹©å™¨çš„æƒé‡æ˜¯å¦‚ä½•è®¡ç®—çš„ å†™ä»£ç æ—¶è¦æ³¨æ„ä»€ä¹ˆ æµ®åŠ¨å¸ƒå±€æ˜¯æ€ä¹ˆå›äº‹ æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ å›½å†…ç”¨å¾—å¤šå— CSSå¯ä»¥ä½œé€å¸§åŠ¨ç”»å— æ€§èƒ½å¦‚ä½• Bootstrapæ€ä¹ˆä½œå“åº”å¼å¸ƒå±€ å¦‚ä½•è§£å†³CSSæ¨¡å—åŒ–è¿‡ç¨‹ä¸­çš„é€‰æ‹©å™¨äº’ç›¸å¹²æ‰°é—®é¢˜","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"CSSä¸­çš„ç›’å­å®šä½","slug":"Learn-CSS-Layout-1","date":"2019-01-29T12:53:41.000Z","updated":"2020-07-25T02:57:18.158Z","comments":true,"path":"2019/01/29/Learn-CSS-Layout-1/","link":"","permalink":"https://jigangduan.github.io/2019/01/29/Learn-CSS-Layout-1/","excerpt":"","text":"CSSæ ¸å¿ƒå¸ƒå±€æ˜¯å°†ä¸€ç»„HTMLå…ƒç´ æ˜ å°„åˆ°ä¸€ç»„çŸ©å½¢æ¡†ï¼Œè¿™äº›çŸ©å½¢æ¡†å¯ä»¥ä½äºxè½´ï¼Œyè½´å’Œzè½´ä¸Šã€‚ è¿™äº›ç›’å­çš„xè½´å’Œyè½´å®šä½ç”±åº”ç”¨äºç›’å­çš„å®šä½æ–¹æ¡ˆç¡®å®šã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»CSS 2.1ä¸­å¼•å…¥çš„å®šä½æ–¹æ¡ˆï¼šæ­£å¸¸æµï¼Œæµ®åŠ¨å’Œç»å¯¹å®šä½ã€‚ ä»æ¦‚å¿µä¸Šè®²ï¼ŒCSSå¸ƒå±€çš„æœ€é«˜çº§æŠ½è±¡æ˜¯å®šä½æ–¹æ¡ˆã€‚ä¸€æ—¦ç¡®å®šäº†å®šä½æ–¹æ¡ˆï¼Œå°±å¯ä»¥é€šè¿‡ç‰¹å®šçš„å¸ƒå±€æ¨¡å¼è¿›ä¸€æ­¥ä¿®æ”¹å®ƒï¼Œä¾‹å¦‚display: tableæˆ–display: inline-tableã€‚å³ä½¿æ˜¯å¼•å…¥å¸ƒå±€æ¨¡å¼ï¼ˆå¦‚flexboxå’Œgridï¼‰çš„CSS 3æ‰©å±•ï¼Œä»ç„¶å­˜åœ¨äºä¸€ä¸ªä¸»è¦çš„å®šä½æ–¹æ¡ˆä¸­ï¼ˆä¾‹å¦‚display: flexvs. display: inline-flexï¼‰ã€‚ å®šä½æ–¹æ¡ˆCSS 2.1å®šä¹‰äº†ä¸‰ç§å®šä½æ–¹æ¡ˆï¼Œå®ƒä»¬æ˜¯ï¼š æ­£å¸¸æµï¼Œç”±ä¸‰ä¸ªæ ¼å¼åŒ–ä¸Šä¸‹æ–‡ç»„æˆï¼šå—ï¼Œå†…è”å’Œç›¸å¯¹æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ æµ®åŠ¨ï¼Œä»¥è‡ªå·±çš„æ–¹å¼ä¸æ­£å¸¸æµç›¸äº’ä½œç”¨ï¼Œå¹¶å½¢æˆå¤§å¤šæ•°ç°ä»£CSSç½‘æ ¼æ¡†æ¶çš„åŸºç¡€ ç»å¯¹å®šä½ï¼Œå®ƒå¤„ç†ç›¸å¯¹äºæ­£å¸¸æµåŠ¨çš„ç»å¯¹å’Œå›ºå®šå…ƒç´  å®šä½æ–¹æ¡ˆå¯¹å…ƒç´ çš„xè½´å’Œyè½´å®šä½æœ‰å¾ˆå¤§å½±å“ã€‚CSS 2.1è§„èŒƒçš„9.3èŠ‚æè¿°äº†è¿™ä¸‰ä¸ªå±æ€§ä¹‹é—´çš„äº¤äº’ï¼Œä½†æ˜¯çŸ­ç‰ˆæœ¬æ˜¯é»˜è®¤å±äºæ­£å¸¸æµçš„æ‰€æœ‰å…ƒç´ ï¼Œé™¤éå®ƒä»¬æ˜¯ä»æ­£å¸¸æµä¸­ä¸“é—¨åˆ é™¤çš„ - é€šå¸¸æ˜¯é€šè¿‡è®¾ç½®floatå±æ€§æˆ–positionå±æ€§ã€‚ å±æ€§ é»˜è®¤å€¼ ç›®çš„ display block æˆ– inline ç¡®å®šè¦ä½¿ç”¨çš„å¸ƒå±€ç®—æ³• position static æ§åˆ¶å…ƒç´ çš„ä½ç½® float none å…è®¸å…¶ä»–å…ƒç´ åœ¨å…ƒç´ å‘¨å›´æµ®åŠ¨ é€šè¿‡å®ƒä»¬å¦‚ä½•ä¸æ­£å¸¸æµåŠ¨ç›¸äº’ä½œç”¨ï¼Œä¸ºäº†å¯ä»¥æœ€å¥½åœ°ç†è§£æµ®åŠ¨å’Œç»å¯¹å®šä½ï¼Œå› æ­¤æˆ‘å°†é¦–å…ˆä»‹ç»æ­£å¸¸æµåŠ¨å®šä½æ–¹æ¡ˆã€‚ å¦‚æœä½ è€ƒè™‘ä¸€ä¸‹ï¼Œå®é™…ä¸Šæœ‰ä¸¤ä¸ªæ–¹é¢çš„å¸ƒå±€: å…ƒç´ çš„æ¡†çš„å¤§å°å’Œå¯¹é½æ–¹å¼ï¼Œä¸»è¦ç”±displayå±æ€§(ä»¥åŠwidth, heightå’Œmargin)æ§åˆ¶ã€‚ ç‰¹å®šçˆ¶å…ƒç´ ä¸­çš„å…ƒç´ æ˜¯å¦‚ä½•ç›¸å¯¹å®šä½çš„ åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å°†é‡ç‚¹å…³æ³¨åä¸€æ–¹é¢ - ç›¸å¯¹å®šä½ã€‚ä¸‹ä¸€ç« å°†ä»‹ç»ç›’å­æ¨¡å‹ï¼Œå®ƒå†³å®šäº†å¯¹é½å’Œå°ºå¯¸ã€‚ çˆ¶å…ƒç´ ä¸­å…ƒç´ çš„ç›¸å¯¹ä½ç½®ç”±ä¸ºç‰¹å®šçˆ¶å…ƒç´ çš„æ‰€æœ‰ç›´æ¥å­å…ƒç´ å»ºç«‹çš„æ ¼å¼åŒ–ä¸Šä¸‹æ–‡æ§åˆ¶ï¼Œåœ¨æ­£å¸¸æµä¸­ï¼Œæ ¼å¼åŒ–ä¸Šä¸‹æ–‡å¯ä»¥æ˜¯å—æˆ–å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚ ä¸‹é¢æ˜¯CSS 2.1è§„èŒƒå…³äºæ ¼å¼åŒ–ä¸Šä¸‹æ–‡çš„è¯´æ˜: æ™®é€šæµä¸­çš„æ¡†å±äºæ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æ˜¯å—æˆ–å†…è”çš„ï¼Œä½†ä¸èƒ½åŒæ—¶å±äºè¿™ä¸¤ç§æ ¼å¼ã€‚å—çº§æ¡†å‚ä¸å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚å†…è”çº§æ¡†å‚ä¸å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚normal-flow çˆ¶(å®¹å™¨)æ ¹æ®å­æ¡†æ˜¯å†…è”çº§çš„è¿˜æ˜¯å—çº§çš„ï¼Œä¸ºå…¶å­æ¡†å»ºç«‹æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚å®šä¹‰æœ¯è¯­å†…è”çº§å’Œå—çº§æ˜¯ä¸ºäº†çªå‡ºæ˜¾ç¤ºå…·æœ‰displayå±æ€§è€Œä¸æ˜¯inlineæˆ–blockçš„å—ä»ç„¶æ˜ å°„åˆ°æ™®é€šæµä¸­çš„ä¸¤ä¸ªæ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œdisplay: tableå…ƒç´ è¢«è®¤ä¸ºæ˜¯å—çº§çš„ï¼Œdisplay: inline-tableå…ƒç´ è¢«è®¤ä¸ºæ˜¯å†…è”çº§çš„ å—çº§å…ƒç´ å®šä¹‰ä¸º: å—çº§å…ƒç´ æ˜¯æºæ–‡æ¡£ä¸­ä»¥å—(ä¾‹å¦‚æ®µè½)çš„å½¢å¼å¯è§†åŒ–æ ¼å¼åŒ–çš„å…ƒç´ ã€‚â€œdisplayâ€å±æ€§çš„ä¸‹åˆ—å€¼æ„æˆå…ƒç´ å—çº§:â€™blockâ€™, â€˜list-itemâ€™å’Œâ€™tableâ€™ã€‚ å—çº§æ¡†æ˜¯å‚ä¸å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡çš„æ¡†ã€‚æ¯ä¸ªå—çº§å…ƒç´ ç”Ÿæˆä¸€ä¸ªä¸»å—çº§æ¡†ï¼Œè¯¥æ¡†åŒ…å«å­ä»£æ¡†å’Œç”Ÿæˆçš„å†…å®¹ï¼Œä¹Ÿæ˜¯ä»»ä½•å®šä½æ–¹æ¡ˆä¸­æ¶‰åŠçš„æ¡†ã€‚ä¸€äº›å—çº§å…ƒç´ å¯èƒ½ä¼šåœ¨ä¸»æ¡†ä¹‹å¤–ç”Ÿæˆé¢å¤–çš„æ¡†[ä¾‹å¦‚]:list-itemå…ƒç´ ã€‚è¿™äº›é¢å¤–çš„æ¡†æ˜¯ç›¸å¯¹äºä¸»æ¡†æ”¾ç½®çš„ã€‚ å‡ ä¹æ‰€æœ‰å—çº§åˆ«çš„ç›’ä¹Ÿæ˜¯å—å®¹å™¨ç›’ã€‚å—å®¹å™¨æ¡†åªæ˜¯ä¸€ç»„å…¶ä»–æ¡†çš„çˆ¶æ¡†ï¼Œå…·æœ‰ç‰¹å®šçš„æ ¼å¼åŒ–ä¸Šä¸‹æ–‡: é™¤äº†table boxes [â€¦]è€Œè¢«æ›¿æ¢çš„å…ƒç´ ï¼Œå—çº§æ¡†ä¹Ÿæ˜¯å—å®¹å™¨æ¡†ã€‚å—å®¹å™¨æ¡†è¦ä¹ˆåªåŒ…å«å—çº§æ¡†ï¼Œè¦ä¹ˆå»ºç«‹å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼Œå› æ­¤åªåŒ…å«å†…è”çº§æ¡† å†…è”çº§å…ƒç´ å®šä¹‰ä¸º: å†…è”çº§å…ƒç´ æ˜¯æºæ–‡æ¡£ä¸­ä¸å½¢æˆæ–°çš„å†…å®¹å—çš„å…ƒç´ ;å†…å®¹æŒ‰è¡Œåˆ†å¸ƒ(ä¾‹å¦‚ï¼Œæ®µè½ä¸­å¼ºè°ƒçš„æ–‡æœ¬ç‰‡æ®µã€å†…è”å›¾åƒç­‰)ã€‚displayå±æ€§çš„ä¸‹åˆ—å€¼æ„æˆå…ƒç´ çš„å†…è”çº§:inlineã€inline-tableå’Œinline-blockã€‚å†…è”çº§å…ƒç´ ç”Ÿæˆå†…è”çº§æ¡†ï¼Œè¿™äº›æ¡†å‚ä¸å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚ å†…è”æ¡†æ˜¯å†…è”çº§åˆ«çš„ï¼Œå…¶å†…å®¹å‚ä¸å…¶åŒ…å«çš„å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€‚ä¸€ä¸ªdisplayå€¼ä¸ºinlineçš„æœªæ›¿æ¢å…ƒç´ ç”Ÿæˆä¸€ä¸ªå†…è”æ¡†ã€‚ä¸æ˜¯å†…è”æ¡†çš„å†…è”çº§æ¡†(å¦‚æ›¿æ¢çš„å†…è”çº§å…ƒç´ ã€å†…è”å—å…ƒç´ å’Œå†…è”è¡¨å…ƒç´ )ç§°ä¸ºåŸå­å†…è”çº§æ¡†ï¼Œå› ä¸ºå®ƒä»¬ä»¥å•ä¸ªä¸é€æ˜æ¡†çš„å½¢å¼å‚ä¸å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ æˆ‘ä¸ä¼šçœŸæ­£è®¨è®ºè¢«æ›¿æ¢å’Œæœªè¢«æ›¿æ¢çš„å…ƒç´ ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªç›¸å½“å°çš„åŒºåˆ«ã€‚è€ƒè™‘æ›¿æ¢å…ƒç´ çš„æœ€ç®€å•æ–¹æ³•æ˜¯è€ƒè™‘imgæˆ–videoå…ƒç´ â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç´ åªæœ‰ä¸€ä¸ª(å¤–éƒ¨å®šä¹‰çš„)å†…å®¹ï¼Œä¸èƒ½åƒæ–‡æœ¬å†…å®¹é‚£æ ·åˆ†æˆè¡Œã€‚ æ‚¨å¯ä»¥å¤§è‡´è€ƒè™‘ä¸€ä¸‹å¸¸è§„æµä¸­çš„ä¸¤ä¸ªæ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼Œåˆ†åˆ«å¯¹åº”äºå‚ç›´å †æ ˆ(åœ¨å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­)å’Œæ°´å¹³å †æ ˆ(åœ¨å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­)ã€‚æˆ‘ä¸€ä¼šå„¿ä¼šè®²åˆ°è¿™ä¸¤ä¸ªé—®é¢˜ã€‚ ä¸Šè¿°å®šä¹‰çš„æœ‰è¶£ä¹‹å¤„åœ¨äºï¼Œæ¯ä¸ªæ¡†çš„æ ¼å¼åŒ–ä¸Šä¸‹æ–‡å¿…é¡»æ˜¯â€œå†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€æˆ–â€œå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸ªçˆ¶å…ƒç´ ï¼Œæ‰€æœ‰å­å…ƒç´ éƒ½ä½¿ç”¨ä¸€ç§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡è¿›è¡Œå¸ƒå±€ã€‚å½“æ‚¨å¯ä»¥æ¸…æ¥šåœ°æ··åˆå—çº§å†…å®¹(å¦‚div)å’Œå†…è”çº§å†…å®¹(å¦‚æ–‡æœ¬)æ—¶ï¼Œå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢?ç­”æ¡ˆæ˜¯ï¼Œæœ‰ä¸€ç§æœºåˆ¶å¯ä»¥å°†å†…è”çº§å…ƒç´ æå‡ä¸ºå—çº§å…ƒç´ ã€‚è¿™ç§æœºåˆ¶ç§°ä¸ºåŒ¿åç›’å­ç”Ÿæˆã€‚ åŒ¿åç›’å­ç”ŸæˆåŒ¿åç›’å­ç”Ÿæˆç”¨äºå¤„ç†æƒ…å†µä¸‹ä¸€ä¸ªçˆ¶å…ƒç´ åŒ…å«inline-levelå’Œå—çº§å­å…ƒç´ (åœ¨è¿™ç§æƒ…å†µä¸‹,â€œåŒ¿åå—ç›’â€ç”Ÿæˆ)å’Œæ ‡è®°çš„æƒ…å†µä¸‹åŒ…å«inline-levelå…ƒç´ ä¸å‘¨å›´æ–‡æœ¬æ··åˆ(åœ¨è¿™ç§æƒ…å†µä¸‹,â€œåŒ¿åå†…è”ç›’å­â€ç”Ÿæˆ),å¦‚ä¸€ä¸ªemæˆ–æˆ‘æ ‡è®°åœ¨ä¸€æ®µæ–‡æœ¬ã€‚ åŒ¿åå—ç›’å­è§„èŒƒç»™å‡ºäº†ä¸€ä¸ªåŒ¿åå—ç›’å­ç”Ÿæˆçš„ä¾‹å­: 1234&lt;div&gt; Some text &lt;p&gt;More text&lt;/p&gt;&lt;/div&gt; å¦‚æœä¸€ä¸ªå—å®¹å™¨ç›’å­(æ¯”å¦‚ä¸Šé¢ä¸ºDIVç”Ÿæˆçš„é‚£ä¸ª)å†…éƒ¨æœ‰ä¸€ä¸ªå—çº§åˆ«çš„ç›’å­(æ¯”å¦‚ä¸Šé¢çš„P)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼ºåˆ¶å®ƒåªåŒ…å«å—çº§åˆ«çš„ç›’å­ã€‚ ä¾‹å¦‚ï¼Œè§„èŒƒæä¾›äº†ä»¥ä¸‹ç¤ºä¾‹ä»£ç æ˜¯å¦‚ä½•å¯¼è‡´åŒ…è£…å†…è”çº§å†…å®¹çš„åŒ¿åæ¡†çš„: å½“å†…è”ç›’å­åŒ…å«ä¸€ä¸ªå­å—çº§ç›’å­,å†…è”ç›’å­(åŠå…¶å†…è”çš„ç¥–å…ˆåœ¨åŒä¸€ä¸ªç›’å­è¡Œ)è¢«æ‰“ç ´çš„å—çº§ç›’å­(å’Œä»»ä½•å—çº§çš„å…„å¼Ÿå§å¦¹è¿ç»­æˆ–éš”ç€å¯æŠ˜å çš„ç©ºç™½å’Œ/æˆ–out-of-flowå…ƒç´ ),æŠŠå†…è”ç›’å­åˆ†æˆä¸¤ä¸ªç›’å­(å³ä½¿æ˜¯ç©ºçš„ä¸¤ä¾§),ä¸€äººä¸€è¾¹çš„å—çº§ç›’å­(es)ã€‚æ–­ç‚¹ä¹‹å‰å’Œæ–­ç‚¹ä¹‹åçš„è¡Œæ¡†è¢«å°è£…åœ¨åŒ¿åå—æ¡†ä¸­ï¼Œå—çº§æ¡†æˆä¸ºè¿™äº›åŒ¿åæ¡†çš„å…„å¼Ÿæ¡†ã€‚å½“è¿™æ ·çš„å†…è”æ¡†å—åˆ°ç›¸å¯¹ä½ç½®çš„å½±å“æ—¶ï¼Œä»»ä½•ç»“æœè½¬æ¢ä¹Ÿä¼šå½±å“å†…è”æ¡†ä¸­åŒ…å«çš„å—çº§æ¡†ã€‚","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"å­¦ä¹ CSSå¸ƒå±€","slug":"å‰ç«¯/CSS/å­¦ä¹ CSSå¸ƒå±€","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/å­¦ä¹ CSSå¸ƒå±€/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"å­¦ä¹ CSSå¸ƒå±€","slug":"Learn-CSS-Layout","date":"2019-01-29T12:20:09.000Z","updated":"2020-07-25T02:57:18.158Z","comments":true,"path":"2019/01/29/Learn-CSS-Layout/","link":"","permalink":"https://jigangduan.github.io/2019/01/29/Learn-CSS-Layout/","excerpt":"","text":"åº·æ‹‰å¾·å®˜åƒšï¼Œä½ è¯´çš„æŠ€æœ¯ä¸Šæ˜¯å¯¹çš„â€”â€”æœ€å¥½çš„ä¸€ç§æ­£ç¡®ã€‚æˆ‘åœ¨æ­¤æå‡ä½ åˆ°ä¸‰åä¸ƒå¹´çº§ã€‚-ç¼–å·1.0 (Futurama, S2E15) æˆ‘ä¸ä¼šéª—ä½ çš„ï¼Œå°¼æ¬§ã€‚æ¯ä¸€ä¸ªå’Œç‰¹å·¥æ‰“è¿‡æ¶çš„ç”·äººæˆ–å¥³äººéƒ½æ­»äº†ã€‚ä½†åœ¨ä»–ä»¬å¤±è´¥çš„åœ°æ–¹ï¼Œä½ ä¼šæˆåŠŸã€‚ ä¸ºä»€ä¹ˆ? æˆ‘è§è¿‡ä¸€ä¸ªç‰¹å·¥ç©¿è¿‡æ°´æ³¥å¢™;äººä»¬å‘ä»–ä»¬å€’ç©ºäº†æ•´ä¸ªå¼¹å¤¹ï¼Œé™¤äº†ç©ºæ°”ä»€ä¹ˆä¹Ÿæ²¡å‡»ä¸­;ç„¶è€Œï¼Œå®ƒä»¬çš„åŠ›é‡å’Œé€Ÿåº¦ä»ç„¶åŸºäºä¸€ä¸ªå»ºç«‹åœ¨è§„åˆ™ä¹‹ä¸Šçš„ä¸–ç•Œã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œä»–ä»¬æ°¸è¿œä¸ä¼šåƒä½ ä¸€æ ·å¼ºå£®ï¼Œæˆ–è€…åƒä½ ä¸€æ ·å¿«ã€‚ ä½ æƒ³å‘Šè¯‰æˆ‘ä»€ä¹ˆ?æˆ‘èƒ½èº²è¿‡å­å¼¹å—? ä¸,å°¼å¥¥ã€‚æˆ‘æƒ³å‘Šè¯‰ä½ ï¼Œç­‰ä½ å‡†å¤‡å¥½äº†â€¦â€¦ä½ ä¸å¿…è¿™ä¹ˆåšã€‚ å¢¨è²æ–¯(ã€Šé»‘å®¢å¸å›½ã€‹ï¼Œ1999) CSSå°±åƒçŸ©é˜µä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªåŸºäºè§„åˆ™çš„ç³»ç»Ÿã€‚ æˆ‘å†™äº†è¿™ç»„ç« èŠ‚æ¥æè¿°è¿™äº›è§„åˆ™ã€‚è¿™æ˜¯é•¿ç¯‡çš„å†™ä½œï¼Œä½†ä¸æ˜¯ä¹¦çš„é•¿åº¦ã€‚æˆ‘ä¸è®¤ä¸ºæˆ‘æƒ³å†™ä¸€æœ¬å…³äºCSSçš„ä¹¦ï¼Œä½†å†™CSSå¸ƒå±€æ˜¯æœ‰ç”¨çš„ã€‚æˆ‘çš„æ–¹æ³•å¾ˆå­¦ç©¶: å­¦ç©¶:å½¢å®¹è¯ã€‚è¿‡åˆ†æ³¨é‡ç»†èŠ‚æˆ–å½¢å¼ä¸»ä¹‰ï¼Œå°¤æŒ‡åœ¨æ•™å­¦ä¸­ã€‚ æˆ‘çš„æ„æ€æ˜¯å¥½çš„ï¼Œè™½ç„¶è¿™ä¸ªè¯æ˜¾ç„¶æœ‰æ¶ˆæçš„å«ä¹‰ã€‚æŠ€æœ¯ä¸Šæ­£ç¡®æ˜¯æœ€å¥½çš„æ­£ç¡®å—?ä¸,å®ƒä¸æ˜¯ã€‚ä½†æ˜¯å¯¹äºè¿™ä¸ªä¸»é¢˜ï¼Œæœ‰è¶³å¤Ÿçš„èµ„æºåœ¨æŠ€æœ¯ä¸Šæ˜¯ä¸æ­£ç¡®çš„ã€‚ æ‚¨å¯èƒ½å¬è¯´è¿‡åœ¨CSSå¸¸è§„æµä¸­æœ‰å†…è”å’Œå—å…ƒç´ ã€‚ä½†æ˜¯æ‚¨çŸ¥é“åœ¨CSSä¸­ï¼Œå—å’Œå†…è”å…ƒç´ çš„ç›¸å¯¹ä½ç½®å®é™…ä¸Šä¸æ˜¯ç”±å…ƒç´ çš„displayå±æ€§å†³å®šçš„å—?å®ƒå®é™…ä¸Šæ˜¯ç”±æ ¼å¼åŒ–ä¸Šä¸‹æ–‡å†³å®šçš„ï¼Œæ ¼å¼åŒ–ä¸Šä¸‹æ–‡å—å…ƒç´ çš„å…„å¼Ÿå…ƒç´ çš„å½±å“ã€‚ æ‚¨å¯èƒ½å·²ç»ä½¿ç”¨z-indexæ¥â€œä¿®å¤â€å†…å®¹çš„ç›¸å¯¹å †æ ˆé¡ºåºã€‚ä½†æ˜¯æ‚¨çŸ¥é“z-indexå¹¶ä¸æ˜¯æ•´ä¸ªæ–‡æ¡£çš„ç»å¯¹ç´¢å¼•ï¼Œè€Œæ˜¯ç›¸å¯¹äºå †æ ˆä¸Šä¸‹æ–‡çš„å—? ä½ å¯èƒ½å¬è¯´è¿‡ç›’å­æ¨¡å‹ã€‚ä½†æ˜¯æ‚¨çŸ¥é“å®é™…ä¸Šè‡³å°‘æœ‰äº”ç§ä¸åŒçš„boxæ¨¡å‹ï¼Œå®ƒä»¬åœ¨å†…å®¹ç»´åº¦å’Œmargin: autoçš„å¤„ç†æ–¹å¼ä¸Šå­˜åœ¨ç»†å¾®çš„å·®å¼‚å—?å¦‚æœä½ è¯»äº†è¿™ç¯‡æ–‡ç« ï¼Œä½ ä¼šæ˜ç™½çš„ã€‚ è¿™æ˜¯ä¸€ç»„å…³äºCSSå¸ƒå±€çš„ç« èŠ‚ï¼Œé€‚ç”¨äºå·²ç»äº†è§£CSSçš„äººã€‚æˆ‘æ‰¿è®¤ï¼Œè¿™çœ‹èµ·æ¥æ˜¯ä¸ªå°å¸‚åœºã€‚æˆ‘å››å¤„å¯»æ‰¾å­¦ä¹ CSSå¸ƒå±€çš„å¥½èµ„æºï¼Œä½†æˆ‘å‘ç°å…¶ä¸­å¤§å¤šæ•°è¿˜ä¸å¤Ÿå­¦ç©¶ã€‚ CSSå¸ƒå±€å¯èƒ½å¾ˆéš¾å­¦ä¹ ï¼Œå› ä¸ºç½‘ç«™é€šå¸¸æ˜¯æ¸è¿›å‘å±•çš„ã€‚è¿™æ„å‘³ç€æ‚¨æœ€ç»ˆå°†åˆ°å¤„å­¦ä¹ å°æŠ€å·§ï¼Œè€Œæ°¸è¿œä¸ä¼šå­¦ä¹ åº•å±‚å¸ƒå±€ç®—æ³•ã€‚ è¿™ä¸€ç»„ç« èŠ‚å°†å¸¦æ‚¨äº†è§£CSSå¸ƒå±€ä¸­çš„æ¯ä¸ªä¸»è¦æ¦‚å¿µï¼Œå¹¶åŒ…æ‹¬è®¸å¤šåº”ç”¨ç¤ºä¾‹æ¥è¯´æ˜å„ç§æ¦‚å¿µã€‚ ç¬¬1ç« :åœ¨CSSä¸­çš„ç›’å­å®šä½æ¶µç›–äº†HTMLå…ƒç´ ç”Ÿæˆçš„ç›’å­æ˜¯å¦‚ä½•ç›¸å¯¹å®šä½çš„: CSSä¸­çš„ä¸‰ç§ä¸»è¦å®šä½æ–¹æ¡ˆ:æ™®é€šæµã€æµ®åŠ¨å’Œç»å¯¹å®šä½ æ™®é€šæµæ¦‚å¿µï¼Œå¦‚åŒ¿åç›’å­ç”Ÿæˆã€æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ã€è¡Œç›’å­å’Œè¡Œç›’å­ä¸­çš„å¯¹é½ æµ®åŠ¨æ¦‚å¿µï¼Œå¦‚æµ®åŠ¨é¡ºåºã€clearfixå’Œä¸çˆ¶çº§é«˜åº¦çš„æµ®åŠ¨äº¤äº’ ç¬¬2ç« :CSSä¸­çš„Box sizingè®¨è®ºäº†Boxæ¨¡å‹ï¼Œä½†æ›´é‡è¦çš„æ˜¯Boxæ¨¡å‹åœ¨CSSä¸­çš„ä¸åŒå®šä½æ–¹æ¡ˆä¸­æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚å…·ä½“æ¥è¯´ï¼Œé«˜ã€å®½ã€è¾¹è·æ˜¯ç”¨å®Œå…¨ä¸åŒçš„æœºæ„è®¡ç®—çš„ï¼Œåªæœ‰äº†è§£ä½¿ç”¨ä¸­çš„å®šä½æ–¹æ¡ˆå’Œè®¡ç®—æœºæ„ï¼Œæ‰èƒ½ç†è§£è¿™äº›è®¡ç®—ã€‚ ç¬¬3ç« :å½±å“å®šä½çš„é™„åŠ å±æ€§æ¶µç›–äº†å½±å“ç›’å­å®šä½çš„é™„åŠ æœºåˆ¶ï¼Œä¾‹å¦‚: marginå´©æºƒ è´Ÿmargins overflow max-width, max-height, min-width, min-height å †æ ˆä¸Šä¸‹æ–‡å’Œz-indeå±æ€§ ä¼ªå…ƒç´ å¦‚ä½•å½±å“å¸ƒå±€ CSS3ç›’å­å¤§å°å±æ€§ ç¬¬4ç« :Flexboxè®¨è®ºäº†CSS 3çš„Flexboxå¸ƒå±€æ¨¡å¼ã€‚ ç¬¬5ç« :CSSå¸ƒå±€æŠ€å·§å’Œå¸ƒå±€æŠ€æœ¯å°†æˆ‘ä»¬æ‰€å­¦çš„çŸ¥è¯†åº”ç”¨åˆ°ä¸€äº›å®é™…é—®é¢˜ä¸­ã€‚å®ƒè¿˜åŒ…å«ä¸€äº›ç±»ä¼¼äºå°æµ‹éªŒçš„é—®é¢˜ï¼Œä»¥æµ‹è¯•æ‚¨å¯¹å¸ƒå±€çš„ç†è§£ï¼Œä¾‹å¦‚: æ°´å¹³å’Œå‚ç›´å®šå¿ƒ CSSç½‘æ ¼æ¡†æ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ å¤šåˆ—å¸ƒå±€ å¸¸è§çš„é™·é˜±å’Œå¸ƒå±€æŠ€å·§ å¦‚æœæ‚¨éœ€è¦æŸ¥æ‰¾ç‰¹å®šçš„æ¦‚å¿µæˆ–å±æ€§ï¼Œè¯·æŸ¥çœ‹referenceç´¢å¼•ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥è·¨ç« èŠ‚é›†æŸ¥æ‰¾æ­£ç¡®çš„ç« èŠ‚å’Œéƒ¨åˆ†ã€‚","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"å­¦ä¹ CSSå¸ƒå±€","slug":"å‰ç«¯/CSS/å­¦ä¹ CSSå¸ƒå±€","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/å­¦ä¹ CSSå¸ƒå±€/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"}]},{"title":"Linux ç›‘æ§ Linux-dash","slug":"linux-dash","date":"2019-01-27T01:40:45.000Z","updated":"2020-07-25T02:57:18.212Z","comments":true,"path":"2019/01/27/linux-dash/","link":"","permalink":"https://jigangduan.github.io/2019/01/27/linux-dash/","excerpt":"","text":"v2.0 ä¸€ä¸ªç®€å•ä¸”ä½å¼€é”€çš„linuxç³»ç»ŸwebæŒ‡ç¤ºæ¿ æ¼”ç¤º &nbsp;|&nbsp; æ–‡æ¡£ ç‰¹æ€§ ä½“ç§¯å° â€”â€“ ç£ç›˜_ä¸Šçš„æ–‡ä»¶å°äº400KB (åˆ é™¤äº†.git)! ç®€å• â€”- ç®€çº¦ã€æ¼‚äº®çš„ä»ªè¡¨ç›˜ å®¹æ˜“ â€”â€” é¡ºä¾¿çš„å®‰è£… å¤šåŠŸèƒ½ â€“ å¯ä»¥ä»Node.jsã€Goã€Pythonã€PHPä¸­é€‰æ‹©å †æ ˆ å®‰è£…æ­¥éª¤112345## 1. å…‹éš†ä»“åº“git clone --depth 1 https://github.com/afaqurk/linux-dash.git## 2. è½¬åˆ°å…‹éš†ç›®å½•cd linux-dash/app/server æˆ–è€…ï¼Œå¦‚æœä½ å–œæ¬¢æ‰‹åŠ¨ä¸‹è½½: 12345## 1. ä¸‹è½½ .zipcurl -LOk https://github.com/afaqurk/linux-dash/archive/master.zip &amp;&amp; unzip master.zip## 2. å¯¼èˆªåˆ°ä¸‹è½½å’Œè§£å‹çš„ç›®å½•cd linux-dash-master/app/server æ­¥éª¤ 2è¯·å‚é˜…é¦–é€‰æœåŠ¡å™¨linux-dash server (åŒ…æ‹¬æ‰€æœ‰) çš„è¯´æ˜: Node.js (recommended) Go Python PHP å¦‚æœä½¿ç”¨ Node.js1234567## å®‰è£…ä¾èµ–å…³ç³»npm install --production## å¯åŠ¨linux-dash(é»˜è®¤åœ¨ç«¯å£80ä¸Š;å¯èƒ½éœ€è¦sudo)## æ‚¨å¯ä»¥ä½¿ç”¨ `LINUX_DASH_SERVER_PORT` ç¯å¢ƒå˜é‡ (ä¾‹å¦‚. `LINUX_DASH_SERVER_PORT=8080 node server`)## æˆ–è€…ä¸ºä¸‹é¢çš„å‘½ä»¤æä¾›ä¸€ä¸ªâ€”--portæ ‡å¿—node index.js å¦‚æœä½¿ç”¨ Go12## å¯åŠ¨æœåŠ¡å™¨(é»˜è®¤åœ¨ç«¯å£80ä¸Š;å¯èƒ½éœ€è¦sudo)go run index.go æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶, è¿è¡Œ go build &amp;&amp; ./server -h. æœ‰å…³äºŒè¿›åˆ¶ä½¿ç”¨é€‰é¡¹ï¼Œè¯·å‚é˜…@tehbillyçš„æ³¨é‡Š,åœ¨è¿™é‡Œ å¦‚æœä½¿ç”¨ Python12# å¯åŠ¨æœåŠ¡å™¨(é»˜è®¤åœ¨ç«¯å£80ä¸Š;å¯èƒ½éœ€è¦sudo)python index.py å¦‚æœä½¿ç”¨ PHP ç¡®ä¿å¯ç”¨äº† exec, shell_exec, å’Œ escapeshellarg å‡½æ•° å°†æ‚¨çš„webæœåŠ¡å™¨æŒ‡å‘linux-dashä¸‹çš„ app/ ç›®å½• é‡æ–°å¯åŠ¨webæœåŠ¡å™¨(Apacheã€nginxç­‰) å¯¹äºPHP + Apacheè®¾ç½®ï¼Œè¯·éµå¾ªDigital Oceanæ•™ç¨‹. æœ‰å…³nginxè®¾ç½®çš„å¸®åŠ©ï¼Œè¯·å‚è§@sergeifilippovæä¾›çš„è¦ç‚¹ æ”¯æŒå¦‚éœ€ä¸€èˆ¬å¸®åŠ©ï¼Œè¯·ä½¿ç”¨GitterèŠå¤©å®¤. å®‰å…¨å¼ºçƒˆå»ºè®®é€šè¿‡æ‚¨é€‰æ‹©çš„å®‰å…¨æªæ–½æ¥ä¿æŠ¤æ‰€æœ‰linux-dashå®‰è£…ã€‚ Linux Dashä¸æä¾›ä»»ä½•å®‰å…¨æˆ–èº«ä»½éªŒè¯ç‰¹æ€§.","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/categories/å·¥å…·/"}],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/tags/å·¥å…·/"},{"name":"linux","slug":"linux","permalink":"https://jigangduan.github.io/tags/linux/"}]},{"title":"äº¤äº’å¼ 3D å›¾å½¢ - 1.ä»‹ç»","slug":"Interactive3DGraphicsCourse1","date":"2019-01-15T14:20:49.000Z","updated":"2020-07-25T02:57:18.158Z","comments":true,"path":"2019/01/15/Interactive3DGraphicsCourse1/","link":"","permalink":"https://jigangduan.github.io/2019/01/15/Interactive3DGraphicsCourse1/","excerpt":"","text":"Eric Haines å°†ä¼šæ•™ä½ ä¸€äº›å……æ»¡æ¿€æƒ…çš„ä¸œè¥¿ â€”â€” è®¡ç®—æœºå›¾å½¢å­¦ éšç€è®¡ç®—æœºèŠ¯ç‰‡ä¸æ–­è·å¾—æ›´å¿«çš„å›¾å½¢è¿è¡Œé€Ÿåº¦ å¹¿ä¹‰ä¸Šæ¥è®² åœ¨ç”µè„‘å±å¹•ä¸Šçœ‹åˆ°çš„ä¸€åˆ‡éƒ½å¯ä»¥æˆä¸º è®¡ç®—æœºå›¾å½¢å­¦æ–‡å­—å¤„ç† / è§†é¢‘ / ç»˜å›¾ç¨‹åº / æ˜¾ç¤ºå™¨ä¸Šçš„å…¶ä»–å›¾åƒ äº’åŠ¨å¼3Dæ¸²æŸ“ æ¸²æŸ“ï¼š ç»˜åˆ¶ï¼Œåˆ›å»ºä¸€å‰¯å›¾ç‰‡çš„æ„æ€ 3Dï¼šåœ¨ä¸‰ç»´è®¡ç®—æœºå›¾å½¢é¢†åŸŸï¼Œç”¨æ•°å­¦æ–¹å¼å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œææ–™ï¼Œç¯å’Œæ‘„åƒå¤´ç»˜åˆ¶åˆ°äºŒä½çš„å±å¹•ä¸Š äº’åŠ¨å¼ï¼šä½ å¯¹å®ƒçš„æ“ä½œå¯ä»¥åœ¨å±å¹•ä¸Šç«‹åˆ»æ˜¾ç°å‡ºæ¥ï¼Œç”¨æˆ·çš„åŠ¨ä½œå¯ä»¥å½±å“3Dè™šæ‹Ÿä¸–ç•Œçš„ä¸œè¥¿ WebGLGLï¼ˆGraphics Libraryï¼‰å›¾å½¢åº“ è®¿é—®è¿™ä¸ªç½‘ç«™ï¼ŒæŸ¥çœ‹æ˜¯å¦æ”¯æŒWebGL","categories":[],"tags":[]},{"title":"SQLer","slug":"sqler","date":"2019-01-11T00:17:31.000Z","updated":"2020-07-25T02:57:18.229Z","comments":true,"path":"2019/01/11/sqler/","link":"","permalink":"https://jigangduan.github.io/2019/01/11/sqler/","excerpt":"","text":"SQL-er æ˜¯ä¸€ä¸ªå¾®å‹ http æœåŠ¡å™¨ï¼Œç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå°†æ—§çš„ CGI æ¦‚å¿µåº”ç”¨äº SQL æŸ¥è¯¢ã€‚SQLer å…è®¸ç¼–å†™ç«¯ç‚¹å¹¶åˆ†é…ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥ä¾¿ä»»ä½•äººç‚¹å‡»å®ƒæ—¶èƒ½æ‰§è¡ŒæŸ¥è¯¢ã€‚æ­¤å¤– SQLer è¿˜å…è®¸è‡ªå®šä¹‰éªŒè¯è§„åˆ™ï¼Œå¯éªŒè¯è¯·æ±‚æ­£æ–‡æˆ–æŸ¥è¯¢å‚æ•°ã€‚SQLer ä½¿ç”¨ nginx æ ·å¼é…ç½®è¯­è¨€ï¼ˆHCLï¼‰ã€‚ ä»‹ç»","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"GitHubç²¾é€‰","slug":"golang/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/golang/GitHubç²¾é€‰/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬10ç« ï¼šDjango Admin ä»‹ç»","slug":"django-start-guide-10","date":"2019-01-09T15:49:19.000Z","updated":"2020-07-25T02:57:18.198Z","comments":true,"path":"2019/01/09/django-start-guide-10/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-10/","excerpt":"","text":"Django Admin ç®€ä»‹å½“æˆ‘ä»¬å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼ŒDjangoå·²ç»é…ç½®äº†Django Adminï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºåˆ—å‡ºçš„INSTALLED_APPSã€‚ åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜å¸æˆ·ï¼š 1python manage.py createsuperuser æŒ‰ç…§è¯´æ˜æ“ä½œï¼š 12345Username (leave blank to use 'vitorfs'): adminEmail address: admin@example.comPassword:Password (again):Superuser created successfully. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥URLï¼šhttp://127.0.0.1:8000/admin/ è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•åˆ°ç®¡ç†ç•Œé¢ï¼š æ·»åŠ Boardæ¨¡å‹éå¸¸ç®€å•ã€‚æ‰“å¼€boardsç›®å½•ä¸­çš„admin.pyæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š boards/admin.py 1234from django.contrib import adminfrom .models import Boardadmin.site.register(Board) ç‚¹å‡»Boardsé“¾æ¥æŸ¥çœ‹ç°æœ‰ç‰ˆå—åˆ—è¡¨ï¼š ç‚¹å‡» Add Board æŒ‰é’®æ·»åŠ ä¸€ä¸ªæ–°çš„ç‰ˆå—ï¼š ç‚¹å‡»ä¿å­˜æŒ‰é’®ï¼š æˆ‘ä»¬å¯ä»¥æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ï¼Œæ‰“å¼€URL http://127.0.0.1:8000","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬8ç« ï¼šç¬¬ä¸€ä¸ªå•å…ƒæµ‹è¯•","slug":"django-start-guide-8","date":"2019-01-09T15:31:17.000Z","updated":"2020-07-25T02:57:18.200Z","comments":true,"path":"2019/01/09/django-start-guide-8/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-8/","excerpt":"","text":"boards/tests.py 1234567891011121314from django.core.urlresolvers import reversefrom django.urls import resolvefrom django.test import TestCasefrom .views import homeclass HomeTests(TestCase): def test_home_view_status_code(self): url = reverse('home') response = self.client.get(url) self.assertEquals(response.status_code, 200) def test_home_url_resolves_home_view(self): view = resolve('/') self.assertEquals(view.func, home) åœ¨ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬æµ‹è¯•çš„æ˜¯è¯·æ±‚è¯¥URLåè¿”å›çš„å“åº”çŠ¶æ€ç ã€‚çŠ¶æ€ç 200æ„å‘³ç€æˆåŠŸã€‚ åœ¨ç¬¬äºŒä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†resolveå‡½æ•°ã€‚Djangoä½¿ç”¨å®ƒæ¥å°†æµè§ˆå™¨å‘èµ·è¯·æ±‚çš„URLä¸urls.pyæ¨¡å—ä¸­åˆ—å‡ºçš„URLè¿›è¡ŒåŒ¹é…ã€‚è¯¥æµ‹è¯•ç”¨äºç¡®å®šURL / è¿”å› home è§†å›¾ã€‚ æ‰§è¡ŒDjangoçš„æµ‹è¯•å¥—ä»¶ï¼š 1python manage.py test è¦æŸ¥çœ‹æœ‰å…³æµ‹è¯•æ‰§è¡Œæ—¶æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯å°†verbosityçš„çº§åˆ«è®¾ç½®å¾—æ›´é«˜ä¸€ç‚¹ï¼š 1python manage.py test --verbosity=2 Verbosityå†³å®šäº†å°†è¦æ‰“å°åˆ°æ§åˆ¶å°çš„é€šçŸ¥å’Œè°ƒè¯•ä¿¡æ¯é‡; 0æ˜¯æ— è¾“å‡ºï¼Œ1æ˜¯æ­£å¸¸è¾“å‡ºï¼Œ2æ˜¯è¯¦ç»†è¾“å‡ºã€‚","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬7ç« ï¼šæ¨¡æ¿å¼•æ“è®¾ç½®","slug":"django-start-guide-7","date":"2019-01-09T15:18:36.000Z","updated":"2020-07-25T02:57:18.199Z","comments":true,"path":"2019/01/09/django-start-guide-7/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-7/","excerpt":"","text":"åœ¨manage.pyæ‰€åœ¨çš„ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸º templatesçš„æ–°æ–‡ä»¶å¤¹ï¼š 1234567myproject/ |-- myproject/ | |-- boards/ | |-- myproject/ | |-- templates/ &lt;-- è¿™é‡Œ | +-- manage.py +-- venv/ templates/home.html 123456789101112131415&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;Boards&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Boards&lt;/h1&gt; &#123;% for board in boards %&#125; &#123;&#123; board.name &#125;&#125; &lt;br&gt; &#123;% endfor %&#125; &lt;/body&gt;&lt;/html&gt; å‘Šè¯‰Djangoåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ¨¡æ¿ settings.pyæ–‡ä»¶ï¼Œæœç´¢TEMPLATESå˜é‡ï¼Œå¹¶è®¾ç½®DIRS çš„å€¼ä¸º os.path.join(BASE_DIR, &#39;templates&#39;)ï¼š 1234567891011121314151617TEMPLATES = [ &#123; 'BACKEND': 'django.template.backends.django.DjangoTemplates', 'DIRS': [ os.path.join(BASE_DIR, 'templates') ], 'APP_DIRS': True, 'OPTIONS': &#123; 'context_processors': [ 'django.template.context_processors.debug', 'django.template.context_processors.request', 'django.contrib.auth.context_processors.auth', 'django.contrib.messages.context_processors.messages', ], &#125;, &#125;,] æ›´æ–°homeè§†å›¾ï¼š boards/views.py 123456from django.shortcuts import renderfrom .models import Boarddef home(request): boards = Board.objects.all() return render(request, 'home.html', &#123;'boards': boards&#125;) ç”Ÿæˆçš„HTMLï¼š templates/home.html 12345678910111213141516171819202122232425262728293031323334&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;Boards&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Boards&lt;/h1&gt; &lt;table border=\"1\"&gt; &lt;thead&gt; &lt;tr&gt; &lt;th&gt;Board&lt;/th&gt; &lt;th&gt;Posts&lt;/th&gt; &lt;th&gt;Topics&lt;/th&gt; &lt;th&gt;Last Post&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &#123;% for board in boards %&#125; &lt;tr&gt; &lt;td&gt; &#123;&#123; board.name &#125;&#125;&lt;br&gt; &lt;small style=\"color: #888\"&gt;&#123;&#123; board.description &#125;&#125;&lt;/small&gt; &lt;/td&gt; &lt;td&gt;0&lt;/td&gt; &lt;td&gt;0&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &#123;% endfor %&#125; &lt;/tbody&gt; &lt;/table&gt; &lt;/body&gt;&lt;/html&gt;","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬6ç« ï¼šç¬¬ä¸€ä¸ªè§†å›¾å‡½æ•°","slug":"django-start-guide-6","date":"2019-01-09T15:12:57.000Z","updated":"2020-07-25T02:57:18.199Z","comments":true,"path":"2019/01/09/django-start-guide-6/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-6/","excerpt":"","text":"boards/views.py 12345678910111213from django.http import HttpResponsefrom .models import Boarddef home(request): boards = Board.objects.all() boards_names = list() for board in boards: boards_names.append(board.name) response_html = '&lt;br&gt;'.join(boards_names) return HttpResponse(response_html) ç»“æœå°±æ˜¯è¿™ä¸ªç®€å•çš„HTMLé¡µé¢ï¼š","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬5ç« ï¼šæ¨¡å‹è®¾è®¡","slug":"django-start-guide-5","date":"2019-01-09T14:23:52.000Z","updated":"2020-07-25T02:57:18.199Z","comments":true,"path":"2019/01/09/django-start-guide-5/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-5/","excerpt":"","text":"æ¨¡å‹è¿™äº›æ¨¡å‹åŸºæœ¬ä¸Šä»£è¡¨äº†åº”ç”¨ç¨‹åºçš„æ•°æ®åº“è®¾è®¡ã€‚ Board Topic Post User æ¨¡å‹è¢«å‘½åä¸ºå†…ç½®åº”ç”¨å« authï¼Œå®ƒä»¥å‘½åç©ºé—´ django.contrib.auth çš„å½¢å¼å‡ºç°åœ¨ INSTALLED_APPS é…ç½®ä¸­ã€‚ boards/models.py: 1234567891011121314151617181920from django.db import modelsfrom django.contrib.auth.models import Userclass Board(models.Model): name = models.CharField(max_length=30, unique=True) description = models.CharField(max_length=100)class Topic(models.Model): subject = models.CharField(max_length=255) last_updated = models.DateTimeField(auto_now_add=True) board = models.ForeignKey(Board, related_name='topics') starter = models.ForeignKey(User, related_name='topics')class Post(models.Model): message = models.TextField(max_length=4000) topic = models.ForeignKey(Topic, related_name='posts') created_at = models.DateTimeField(auto_now_add=True) updated_at = models.DateTimeField(null=True) created_by = models.ForeignKey(User, related_name='posts') updated_by = models.ForeignKey(User, null=True, related_name='+') æ‰€æœ‰æ¨¡å‹éƒ½æ˜¯django.db.models.Modelç±»çš„å­ç±»ã€‚æ¯ä¸ªç±»å°†è¢«è½¬æ¢ä¸ºæ•°æ®åº“è¡¨ æ¯ä¸ªå­—æ®µç”± django.db.models.Fieldå­ç±»ï¼ˆå†…ç½®åœ¨Django coreï¼‰çš„å®ä¾‹è¡¨ç¤ºï¼Œå®ƒä»¬å¹¶å°†è¢«è½¬æ¢ä¸ºæ•°æ®åº“çš„åˆ— å­—æ®µ CharFieldï¼ŒTextFieldï¼ŒDateTimeField, IntegerFieldï¼ŒBooleanFieldï¼Œ DecimalFieldç­‰ç­‰ï¼Œéƒ½æ˜¯ django.db.models.Field çš„å­ç±» å­—æ®µéœ€è¦å‚æ•° unique=Trueï¼Œå°†å¼ºåˆ¶æ•°æ®åº“çº§åˆ«å­—æ®µçš„å”¯ä¸€æ€§ auto_now_addè®¾ç½®ä¸ºTrue, åˆ›å»ºå¯¹è±¡æ—¶ä¸ºå½“å‰æ—¥æœŸå’Œæ—¶é—´ ForeignKeyå­—æ®µ, å¤–é”®å…³è”, ä½ç½®å‚æ•°related_nameï¼Œç”¨äºå¼•ç”¨å®ƒå…³è”çš„æ¨¡å‹ ä¸‹é¢æ‚¨å¯ä»¥çœ‹åˆ°ç±»å›¾å’ŒDjangoæ¨¡å‹çš„æºä»£ç ä¹‹é—´çš„æ¯”è¾ƒï¼Œç»¿çº¿è¡¨ç¤ºæˆ‘ä»¬å¦‚ä½•å¤„ç†åå‘å…³ç³»ã€‚ è¿ç§»æ¨¡å‹æ‰“å¼€ç»ˆç«¯ ï¼Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œè½¬åˆ° manage.pyæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1python manage.py makemigrations è¾“å‡ºçš„å†…å®¹æ˜¯ï¼š 1234567Migrations for 'boards': boards/migrations/0001_initial.py - Create model Board - Create model Post - Create model Topic - Add field topic to post - Add field updated_by to post Django åœ¨ boards/migrations ç›®å½•åˆ›å»ºäº†ä¸€ä¸ªåä¸º 0001_initial.pyçš„æ–‡ä»¶ã€‚ è¿ç§»æ–‡ä»¶å°†è¢«ç¿»è¯‘æˆSQLè¯­å¥ã€‚ 1python manage.py sqlmigrate boards 0001 Django ORMæ¥å®Œæˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸æ•°æ®åº“è¿›è¡Œé€šä¿¡çš„æŠ½è±¡å±‚ 1python manage.py migrate è¾“å‡ºå†…å®¹ 1234567891011121314151617Operations to perform: Apply all migrations: admin, auth, boards, contenttypes, sessionsRunning migrations: Applying contenttypes.0001_initial... OK Applying auth.0001_initial... OK Applying admin.0001_initial... OK Applying admin.0002_logentry_remove_auto_add... OK Applying contenttypes.0002_remove_content_type_name... OK Applying auth.0002_alter_permission_name_max_length... OK Applying auth.0003_alter_user_email_max_length... OK Applying auth.0004_alter_user_username_opts... OK Applying auth.0005_alter_user_last_login_null... OK Applying auth.0006_require_contenttypes_0002... OK Applying auth.0007_alter_validators_add_error_messages... OK Applying auth.0008_alter_user_username_max_length... OK Applying boards.0001_initial... OK Applying sessions.0001_initial... OK è¯•éªŒ Models APIä½¿ç”¨manage.py å·¥å…·åŠ è½½æˆ‘ä»¬çš„é¡¹ç›®æ¥å¯åŠ¨ Python shell 1python manage.py shell 12345Python 3.6.2 (default, Jul 17 2017, 16:44:45)[GCC 4.2.1 Compatible Apple LLVM 8.1.0 (clang-802.0.42)] on darwinType \"help\", \"copyright\", \"credits\" or \"license\" for more information.(InteractiveConsole)&gt;&gt;&gt; é¡¹ç›®å°†è¢«æ·»åŠ åˆ°sys.pathå¹¶åŠ è½½Djangoã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­å¯¼å…¥æˆ‘ä»¬çš„æ¨¡å‹å’Œå…¶ä»–èµ„æºå¹¶ä½¿ç”¨å®ƒã€‚ å¯¼å…¥Boardç±»å¼€å§‹ï¼š 1from boards.models import Board åˆ›å»ºæ–°çš„ boarrd å¯¹è±¡ 1board = Board(name='Django', description='This is a board about Django.') å°†è¿™ä¸ªå¯¹è±¡ä¿å­˜åœ¨æ•°æ®åº“ 1board.save() Djangoä¼šè‡ªåŠ¨è®¾ç½®ID 12board.id1 Pythonå±æ€§è®¿é—®ï¼š 12board.name'Django' 12board.description'This is a board about Django.' æ›´æ–°ä¸€ä¸ªå€¼ 12board.description = 'Django discussion board.'board.save() æ¯ä¸ªDjangoæ¨¡å‹éƒ½å¸¦æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§; æˆ‘ä»¬ç§°ä¹‹ä¸ºæ¨¡å‹ç®¡ç†å™¨(Model Manager)ã€‚ä½ å¯ä»¥é€šè¿‡å±æ€§objects æ¥è®¿é—®è¿™ä¸ªç®¡ç†å™¨ï¼Œå®ƒä¸»è¦ç”¨äºæ•°æ®åº“æ“ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Boardå¯¹è±¡ï¼š 1board = Board.objects.create(name='Python', description='General discussion about Python.') objectsåˆ—å‡ºæ•°æ®åº“ä¸­æ‰€æœ‰ç°æœ‰çš„åˆ—ï¼š 12Board.objects.all()&lt;QuerySet [&lt;Board: Board object&gt;, &lt;Board: Board object&gt;]&gt; QuerySet, å®ƒæ˜¯ä»æ•°æ®åº“ä¸­æŸ¥è¯¢çš„å¯¹è±¡åˆ—è¡¨ ç®¡ç†å™¨ï¼ˆManagerï¼‰ æ¥æŸ¥è¯¢æ•°æ®åº“å¹¶è¿”å›å•ä¸ªå¯¹è±¡ 1234django_board = Board.objects.get(id=1)django_board.name'Django' getæ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯æ¨¡å‹çš„ä»»ä½•å­—æ®µï¼Œä½†æœ€å¥½ä½¿ç”¨å¯å”¯ä¸€æ ‡è¯†å¯¹è±¡çš„å­—æ®µæ¥æŸ¥è¯¢ é€€å‡ºäº¤äº’å¼æ§åˆ¶å°ï¼š 1exit()","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬4ç« ï¼šç³»ç»Ÿè®¾è®¡","slug":"django-start-guide-4","date":"2019-01-09T13:58:10.000Z","updated":"2020-07-25T02:57:18.199Z","comments":true,"path":"2019/01/09/django-start-guide-4/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-4/","excerpt":"","text":"è®ºå›é¡¹ç›®ç”¨ä¾‹å›¾ å‡ ä¸ªè®ºå›ç‰ˆå—ï¼ˆboardsï¼‰ï¼Œæ¯ä¸ªç‰ˆå—åƒä¸€ä¸ªåˆ†ç±»ä¸€æ · æŒ‡å®šçš„ç‰ˆå—é‡Œé¢ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºæ–°ä¸»é¢˜ï¼ˆTopicï¼‰å¼€å§‹è®¨è®º å…¶ä»–ç”¨æˆ·å¯ä»¥å‚ä¸è®¨è®ºå›å¤ ç±»å›¾ Boardï¼šç‰ˆå— Topicï¼šä¸»é¢˜ Postï¼šå¸–å­ï¼ˆè¯‘æ³¨ï¼šå…¶å®å°±æ˜¯ä¸»é¢˜çš„å›å¤æˆ–è¯„è®ºï¼‰ è¿™æ˜¯æ¨¡å‹æœ€åŸºæœ¬çš„å†…å®¹ï¼š Board æ¨¡å‹ nameå­—æ®µå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸ºäº†é¿å…æœ‰é‡å¤çš„åç§°ã€‚ description ç”¨äºè¯´æ˜è¿™ä¸ªç‰ˆå—æ˜¯åšä»€ä¹ˆç”¨çš„ã€‚ Topic æ¨¡å‹ subject è¡¨ç¤ºä¸»é¢˜å†…å®¹ï¼Œ last_update ç”¨æ¥å®šä¹‰è¯é¢˜çš„æ’åºï¼Œ starter ç”¨æ¥è¯†åˆ«è°å‘èµ·çš„è¯é¢˜ï¼Œ board ç”¨äºæŒ‡å®šå®ƒå±äºå“ªä¸ªç‰ˆå—ã€‚ Post æ¨¡å‹ message ç”¨äºå­˜å‚¨å›å¤çš„å†…å®¹ï¼Œ created_at åœ¨æ’åºæ—¶å€™ç”¨ï¼ˆæœ€å…ˆå‘è¡¨çš„å¸–å­æ’æœ€å‰é¢ï¼‰ï¼Œ updated_at å‘Šè¯‰ç”¨æˆ·æ˜¯å¦æ›´æ–°äº†å†…å®¹ User æ¨¡å‹ username password email is_superuser ä¸€ä¸ªtopic å¿…é¡»ä¸ä¸€ä¸ªï¼ˆ1ï¼‰Boardï¼ˆè¿™æ„å‘³ç€å®ƒä¸èƒ½ä¸ºç©ºï¼‰ç›¸å…³è”ï¼Œä½†æ˜¯ Board ä¸‹é¢å¯èƒ½ä¸è®¸å¤šä¸ªæˆ–è€…0ä¸ª topic å…³è” (0..*)ã€‚è¿™æ„å‘³ç€ Board ä¸‹é¢å¯èƒ½æ²¡æœ‰ä¸»é¢˜ã€‚ï¼ˆè¯‘æ³¨ï¼šä¸€å¯¹å¤šå…³ç³»ï¼‰ ä¸€ä¸ª Topic è‡³å°‘æœ‰ä¸€ä¸ª Postï¼ˆå‘èµ·è¯é¢˜æ—¶ï¼ŒåŒæ—¶ä¼šå‘å¸ƒä¸€ä¸ªå¸–å­ï¼‰ï¼Œå¹¶ä¸”å®ƒä¹Ÿå¯èƒ½æœ‰è®¸å¤š Postï¼ˆ1..*ï¼‰ã€‚ä¸€ä¸ªPost å¿…é¡»ä¸ä¸€ä¸ªå¹¶ä¸”åªæœ‰ä¸€ä¸ªTopicï¼ˆ1ï¼‰ç›¸å…³è”ã€‚ ä¸€ä¸ª Topic å¿…é¡»æœ‰ä¸€ä¸ªä¸”åªæœ‰ä¸€ä¸ª User ç›¸å…³è”ï¼Œtopic çš„å‘èµ·è€…æ˜¯ï¼ˆ1ï¼‰ã€‚è€Œä¸€ä¸ªç”¨æˆ·å¯èƒ½æœ‰å¾ˆå¤šæˆ–è€…æ²¡æœ‰ topicï¼ˆ0..*ï¼‰ã€‚ Post å¿…é¡»æœ‰ä¸€ä¸ªå¹¶ä¸”åªæœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ç”¨æˆ·ï¼Œç”¨æˆ·å¯ä»¥æœ‰è®¸å¤šæˆ–æ²¡æœ‰ Postï¼ˆ0..*ï¼‰ã€‚Post å’Œ Userä¹‹é—´çš„ç¬¬äºŒä¸ªå…³è”æ˜¯ç›´æ¥å…³è”ï¼ˆå‚è§è¯¥è¡Œæœ€åçš„ç®­å¤´ï¼‰ï¼Œå°±æ˜¯ Post å¯ä»¥è¢«ç”¨æˆ·ä¿®æ”¹ï¼ˆupdated_byï¼‰ï¼Œupdated_by æœ‰å¯èƒ½æ˜¯ç©ºï¼ˆPost æ²¡æœ‰è¢«ä¿®æ”¹ï¼‰ ç”»è¿™ä¸ªç±»å›¾çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¼ºè°ƒå­—æ®µè€Œä¸æ˜¯æ¨¡å‹ä¹‹é—´çš„å…³ç³»ï¼š çº¿æ¡†å›¾ï¼ˆåŸå‹å›¾ï¼‰ç‰ˆå—ï¼š ä¸»é¢˜ï¼š â€œnew topicâ€ é¡µé¢ï¼š ä¸»é¢˜é¡µé¢æ˜¾ç¤ºäº†å¸–å­å’Œè®¨è®ºï¼š å¦‚æœç”¨æˆ·ç‚¹å‡»å›å¤æŒ‰é’®ï¼Œå°†çœ‹åˆ°ä¸‹é¢è¿™ä¸ªé¡µé¢ï¼Œå¹¶ä»¥å€’åºçš„æ–¹å¼ï¼ˆæœ€æ–°çš„åœ¨ç¬¬ä¸€ä¸ªï¼‰æ˜¾ç¤ºå¸–å­åˆ—è¡¨ï¼š","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬3ç« ï¼šHello World","slug":"django-start-guide-3","date":"2019-01-09T13:33:36.000Z","updated":"2020-07-25T02:57:18.198Z","comments":true,"path":"2019/01/09/django-start-guide-3/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-3/","excerpt":"","text":"ç°åœ¨æ¥å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè§†å›¾(view) boardsåº”ç”¨ç¨‹åºä¸­çš„views.pyæ–‡ä»¶ views.py 1234from django.http import HttpResponsedef home(request): return HttpResponse('Hello, World!') urls.py 123456789from django.conf.urls import urlfrom django.contrib import adminfrom boards import viewsurlpatterns = [ url(r'^$', views.home, name='home'), url(r'^admin/', admin.site.urls),] Djangoä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…è¯·æ±‚çš„URL homeè§†å›¾ï¼Œæˆ‘ä½¿ç”¨^$æ­£åˆ™ï¼Œå®ƒå°†åŒ¹é…ä¸€ä¸ªç©ºè·¯å¾„ï¼Œä¹Ÿå°±æ˜¯ä¸»é¡µï¼ˆè¿™ä¸ªURLï¼šhttp://127.0.0.1:8000 ï¼‰ã€‚å¦‚æœæˆ‘æƒ³åŒ¹é…çš„URLæ˜¯ http://127.0.0.1:8000/homepage/ ï¼Œé‚£ä¹ˆæˆ‘çš„URLæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šæ˜¯ï¼šurl(râ€™^homepage/$â€™, views.home, name=â€™homeâ€™)ã€‚ è¿è¡Œï¼š 1python manage.py runserver åœ¨ä¸€ä¸ªWebæµè§ˆå™¨ä¸­ï¼Œæ‰“å¼€ http://127.0.0.1:8000 è¿™ä¸ªé“¾æ¥ https://github.com/sibtc/django-beginners-guide/tree/v0.1-lw","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬2ç« ï¼šåˆ›å»ºé¡¹ç›®","slug":"django-start-guide-2","date":"2019-01-09T13:14:48.000Z","updated":"2020-07-25T02:57:18.198Z","comments":true,"path":"2019/01/09/django-start-guide-2/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-2/","excerpt":"","text":"å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°çš„ Django é¡¹ç›®ï¼š 1django-admin startproject myproject myprojectç›®å½•ç»“æ„: 123456789myproject/ &lt;-- é«˜çº§åˆ«çš„æ–‡ä»¶å¤¹ |-- myproject/ &lt;-- Djangoé¡¹ç›®æ–‡ä»¶å¤¹ | |-- myproject/ | | |-- __init__.py | | |-- settings.py | | |-- urls.py | | |-- wsgi.py | +-- manage.py +-- venv/ &lt;-- è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹ manage.py: ä½¿ç”¨django-adminå‘½ä»¤è¡Œå·¥å…·çš„å¿«æ·æ–¹å¼ã€‚å®ƒç”¨äºè¿è¡Œä¸æˆ‘ä»¬é¡¹ç›®ç›¸å…³çš„ç®¡ç†å‘½ä»¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼Œè¿è¡Œæµ‹è¯•ï¼Œåˆ›å»ºè¿ç§»ç­‰ç­‰ã€‚ __init.pyï¼šè¿™ä¸ªç©ºæ–‡ä»¶å‘Šè¯‰pythonè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªpythonåŒ…ã€‚ settings.pyï¼šè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æ‰€æœ‰çš„é¡¹ç›®é…ç½®ã€‚å°†æ¥æˆ‘ä»¬ä¼šä¸€ç›´æåˆ°è¿™ä¸ªæ–‡ä»¶ï¼ urls.pyï¼šè¿™ä¸ªæ–‡ä»¶è´Ÿè´£æ˜ å°„æˆ‘ä»¬é¡¹ç›®ä¸­çš„è·¯ç”±å’Œè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åœ¨è®¿é—®URL / about/ æ—¶æ˜¾ç¤ºæŸäº›å†…å®¹ï¼Œåˆ™å¿…é¡»å…ˆåœ¨è¿™é‡Œåšæ˜ å°„å…³ç³»ã€‚ wsgi.pyï¼šè¯¥æ–‡ä»¶æ˜¯ç”¨äºéƒ¨ç½²çš„ç®€å•ç½‘å…³æ¥å£ å¼€å‘è¿‡ç¨‹ä¸­,é€šè¿‡æ‰§è¡Œå‘½ä»¤æ¥æµ‹è¯•: 1python manage.py runserver æµè§ˆå™¨ä¸­æ‰“å¼€URLï¼šhttp://127.0.0.1:8000 Django åº”ç”¨ appï¼šæ˜¯ä¸€ä¸ªå¯ä»¥åšå®ŒæˆæŸä»¶äº‹æƒ…çš„Webåº”ç”¨ç¨‹åºã€‚ ä¸€ä¸ªåº”ç”¨ç¨‹åºé€šå¸¸ç”±ä¸€ç»„models(æ•°æ®åº“è¡¨)ï¼Œviews(è§†å›¾)ï¼Œtemplates(æ¨¡æ¿)ï¼Œtests(æµ‹è¯•) ç»„æˆã€‚ project: æ˜¯é…ç½®å’Œåº”ç”¨ç¨‹åºçš„é›†åˆã€‚ ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªåº”ç”¨ç¨‹åºæˆ–ä¸€ä¸ªåº”ç”¨ç¨‹åºç»„æˆã€‚ æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘ç»œè®ºå›æˆ–è®¨è®ºåŒºã€‚è¦åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯·è·³è½¬åˆ°manage.pyæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1django-admin startapp boards ç›®å½•ç»“æ„ï¼š 123456789101112131415161718myproject/ |-- myproject/ | |-- boards/ &lt;-- æˆ‘ä»¬æ–°çš„Djangoåº”ç”¨ï¼ˆappï¼‰! | | |-- migrations/ | | | +-- __init__.py | | |-- __init__.py | | |-- admin.py | | |-- apps.py | | |-- models.py | | |-- tests.py | | +-- views.py | |-- myproject/ | | |-- __init__.py | | |-- settings.py | | |-- urls.py | | |-- wsgi.py | +-- manage.py +-- venv/ migrations/ï¼šåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼ŒDjangoä¼šå­˜å‚¨ä¸€äº›æ–‡ä»¶ä»¥è·Ÿè¸ªä½ åœ¨models.pyæ–‡ä»¶ä¸­åˆ›å»ºçš„å˜æ›´ï¼Œç”¨æ¥ä¿æŒæ•°æ®åº“å’Œmodels.pyçš„åŒæ­¥ã€‚ admin.pyï¼šè¿™ä¸ªæ–‡ä»¶ä¸ºä¸€ä¸ªdjangoå†…ç½®çš„åº”ç”¨ç¨‹åºDjango Adminçš„é…ç½®æ–‡ä»¶ã€‚ apps.pyï¼šè¿™æ˜¯åº”ç”¨ç¨‹åºæœ¬èº«çš„é…ç½®æ–‡ä»¶ã€‚ models.pyï¼šè¿™é‡Œæ˜¯æˆ‘ä»¬å®šä¹‰Webåº”ç”¨ç¨‹åºæ•°æ®å®ä¾‹çš„åœ°æ–¹ã€‚modelsä¼šç”±Djangoè‡ªåŠ¨è½¬æ¢ä¸ºæ•°æ®åº“è¡¨ã€‚ tests.pyï¼šè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å†™å½“å‰åº”ç”¨ç¨‹åºçš„å•å…ƒæµ‹è¯•ã€‚ views.pyï¼šè¿™æ˜¯æˆ‘ä»¬å¤„ç†Webåº”ç”¨ç¨‹åºè¯·æ±‚(request)/å“åº”(resopnse)å‘¨æœŸçš„æ–‡ä»¶ã€‚ settings.py 12345678INSTALLED_APPS = [ 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles',] Djangoé»˜è®¤å·²ç»å®‰è£…äº†6ä¸ªå†…ç½®åº”ç”¨ç¨‹åºèº«ä»½éªŒè¯ï¼Œä¼šè¯ï¼Œé™æ€æ–‡ä»¶ç®¡ç†ï¼ˆå›¾åƒï¼ŒJavaScriptï¼ŒCSSç­‰ï¼‰ç­‰ å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºboardsæ·»åŠ åˆ°INSTALLED_APPSåˆ—è¡¨ï¼š 12345678910INSTALLED_APPS = [ 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles', 'boards', # è¯‘è€…æ³¨ï¼šå»ºè®®å’Œä½œè€…ä¸€æ ·ç©ºä¸€è¡Œæ¥åŒºåˆ«å†…ç½®appå’Œè‡ªå®šä¹‰çš„app]","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"Djangoå…¥é—¨ä¸å®è·µ-ç¬¬1ç« ï¼šç¯å¢ƒæ­å»º","slug":"django-start-guide-1","date":"2019-01-09T12:33:52.000Z","updated":"2020-07-25T02:57:18.198Z","comments":true,"path":"2019/01/09/django-start-guide-1/","link":"","permalink":"https://jigangduan.github.io/2019/01/09/django-start-guide-1/","excerpt":"","text":"ä¸ºä»€ä¹ˆè¦å­¦ä¹ Django?Djangoæ˜¯ä¸€ä¸ªç”¨pythonç¼–å†™çš„Webæ¡†æ¶ã€‚ Webæ¡†æ¶, æä¾›äº†ä¸€ç³»åˆ—å·¥å…·å’ŒåŠŸèƒ½: å®‰å…¨åŠŸèƒ½ æ•°æ®åº“è®¿é—® ä¼šè¯ æ¨¡æ¿å¤„ç† URLè·¯ç”± å›½é™…åŒ– æœ¬åœ°åŒ– ç­‰ç­‰ pythonè½¯ä»¶åŒ…èµ„æ–™åº“ï¼ˆpypiï¼‰æ‹¥æœ‰è¶…è¿‡11.6ä¸‡ä¸ªè½¯ä»¶åŒ… Djangoæ˜¯ç”¨pythonç¼–å†™çš„æœ€æµè¡Œçš„webæ¡†æ¶ä¹‹ä¸€ã€‚æä¾›äº†å„ç§å„æ ·çš„å¼€ç®±å³ç”¨çš„åŠŸèƒ½: ç”¨äºå¼€å‘å’Œæµ‹è¯•çš„ç‹¬ç«‹WebæœåŠ¡å™¨ ç¼“å­˜ ä¸­é—´ä»¶ç³»ç»Ÿ ORM æ¨¡æ¿å¼•æ“ è¡¨å•å¤„ç† åŸºäºPythonå•å…ƒæµ‹è¯•çš„å·¥å…·æ¥å£ Djangoè¿˜è‡ªå¸¦å†…éƒ¨ç”µæ± ï¼Œæä¾›å†…ç½®åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ ä¸€ä¸ªè®¤è¯ç³»ç»Ÿ ä¸€ä¸ªå¯ç”¨äº CRUD(å¢åˆ æ”¹æŸ¥) æ“ä½œå¹¶ä¸”è‡ªåŠ¨ç”Ÿæˆé¡µé¢çš„åå°ç®¡ç†ç•Œé¢ ç”Ÿæˆè®¢é˜…æ–‡æ¡£ï¼ˆRSS/Atomï¼‰ ç«™ç‚¹åœ°å›¾ ç”šè‡³åœ¨djangoä¸­å†…å»ºäº†ä¸€ä¸ªåœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰æ¡†æ¶ è°åœ¨ä½¿ç”¨Django?å¤§å‹ç½‘ç«™æœ‰ï¼š Instagram Disqus Mozilla Bitbucket Last.fm å›½å®¶åœ°ç† æ›´å¤šçš„ç¤ºä¾‹, Django Sites, è¶…è¿‡äº”åƒä¸ªDjangoé©±åŠ¨çš„ç½‘ç«™åˆ—è¡¨ å®‰è£…å®‰è£… Python 31brew install python3 è¿è¡ŒPython 3 12python3 --versionPython 3.6.2 å®‰è£… Virtualenvvirtualenv : å»ºç«‹è™šæ‹Ÿçš„pythonç¯å¢ƒvirtualenvwrapper : ç®¡ç†è™šæ‹Ÿç¯å¢ƒ 1sudo pip install virtualenv å¯¹äºä½ å¼€å§‹çš„æ¯ä¸ªDjangoé¡¹ç›®ï¼Œä½ é¦–å…ˆä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚è¿™å°±åƒæ¯ä¸ªDjangoé¡¹ç›®éƒ½æœ‰ä¸€ä¸ªæ²™ç›’ã€‚ è®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…django åœ¨myprojectæ–‡ä»¶å¤¹ä¸­ï¼š 1virtualenv venv -p python3 æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š 1source venv/bin/activate å¦‚æœä½ åœ¨å‘½ä»¤è¡Œå‰é¢çœ‹åˆ° (venv)ï¼Œå°±ä»£è¡¨æ¿€æ´»æˆåŠŸäº† è®©æˆ‘ä»¬è¯•ç€äº†è§£ä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºvenvçš„ç‰¹æ®Šæ–‡ä»¶å¤¹ã€‚ è¯¥æ–‡ä»¶å¤¹å†…åŒ…å«äº†ä¸€ä¸ªpythonçš„å‰¯æœ¬ã€‚ åœ¨æˆ‘ä»¬æ¿€æ´»äº†venvç¯å¢ƒä¹‹åï¼Œå½“æˆ‘ä»¬è¿è¡ŒPythonå‘½ä»¤æ—¶ï¼Œå®ƒå°†ä½¿ç”¨æˆ‘ä»¬å­˜å‚¨åœ¨venvé‡Œé¢çš„æœ¬åœ°å‰¯æœ¬ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æ“ä½œç³»ç»Ÿä¸­å®‰è£…çš„é‚£ä¸ªã€‚ å½“æˆ‘ä»¬å¯ç”¨venvæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤pythonï¼ˆè€Œä¸æ˜¯python3ï¼‰æ¥è°ƒç”¨Python 3.6.2ï¼Œå¹¶ä¸”ä»…ä½¿ç”¨pipï¼ˆè€Œä¸æ˜¯pip3ï¼‰æ¥å®‰è£…è½¯ä»¶åŒ…ã€‚ é€€å‡ºvenvç¯å¢ƒ 1deactivate virtualenvwrapperå®‰è£…ï¼š 1pip install virtualenvwrapper åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š 1mkvirtualenv project_env --python=python3.7 åœ¨è™šæ‹Ÿç¯å¢ƒä¸Šå·¥ä½œï¼š 1workon project_env åœæ­¢è™šæ‹Ÿç¯å¢ƒ 1deactivate åˆ é™¤ï¼š 1rmvirtualenv project_env lsvirtualenv #åˆ—ä¸¾æ‰€æœ‰çš„ç¯å¢ƒã€‚ cdvirtualenv #å¯¼èˆªåˆ°å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒçš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚è¯´è¿™æ ·æ‚¨å°±èƒ½å¤Ÿæµè§ˆå®ƒçš„ site-packagesã€‚ cdsitepackages # å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯ç›´æ¥è¿›å…¥åˆ° site-packages ç›®å½•ä¸­ã€‚ lssitepackages #æ˜¾ç¤º site-packages ç›®å½•ä¸­çš„å†…å®¹ã€‚ å®‰è£… Django 1.11.41234pip install django==1.11.4# è¯‘æ³¨ï¼šç›®å‰djangoå·²ç»å‡çº§åˆ°2.xç‰ˆæœ¬ï¼Œè¿™é‡Œä¸ºäº†è·Ÿåç»­æ•™ç¨‹å†…å®¹ä¿æŒä¸€ç›´ï¼Œæ‰€ä»¥å¿…é¡»æŒ‡å®šç‰ˆæœ¬å·è¿›è¡Œå®‰è£…# é™¤éä½ æœ‰èƒ½åŠ› debugï¼Œå¦åˆ™ä¸å»ºè®®ä½ ä½¿ç”¨django 2.xï¼Œç­‰ä½ ç†Ÿæ‚‰Djangoåï¼Œå†å‡çº§éƒ½Django2.0 ä¹Ÿä¸è¿Ÿï¼Œå› ä¸ºä¸¤ä¸ªç‰ˆæœ¬çš„å·®å¼‚éå¸¸å°","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"}]},{"title":"JSON:APIè§„èŒƒ","slug":"json-api","date":"2019-01-05T06:19:04.000Z","updated":"2020-07-25T02:57:18.211Z","comments":true,"path":"2019/01/05/json-api/","link":"","permalink":"https://jigangduan.github.io/2019/01/05/json-api/","excerpt":"","text":"è‹±æ–‡åŸå€ JSON:APIç‰ˆæœ¬ï¼Œç›®å‰æ˜¯1.0ç‰ˆã€‚æ–°ç‰ˆæœ¬çš„JSON:APIå°†å§‹ç»ˆå‘åå…¼å®¹ä½¿ç”¨æ°¸ä¸åˆ é™¤ï¼Œåªæ·»åŠ ç­–ç•¥ã€‚ ä»‹ç»JSON:APIæ˜¯å…³äºå®¢æˆ·æœºåº”è¯¥å¦‚ä½•è¯·æ±‚è·å–æˆ–ä¿®æ”¹èµ„æºï¼Œä»¥åŠæœåŠ¡å™¨åº”è¯¥å¦‚ä½•å“åº”è¿™äº›è¯·æ±‚çš„è§„èŒƒã€‚ JSON:APIæ—¨åœ¨å°†è¯·æ±‚æ•°é‡å’Œå®¢æˆ·æœºä¸æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®é‡æœ€å°åŒ–ã€‚è¿™ç§æ•ˆç‡æ˜¯åœ¨ä¸æŸå®³å¯è¯»æ€§ã€çµæ´»æ€§æˆ–å¯å‘ç°æ€§çš„æƒ…å†µä¸‹å®ç°çš„ã€‚ JSON:APIéœ€è¦ä½¿ç”¨JSON:APIåª’ä½“ç±»å‹(application/vnd.api+json)æ¥äº¤æ¢æ•°æ®ã€‚ çº¦å®šæœ¬æ–‡ä»¶ä¸­å¿…é¡»ã€ä¸€å®šä¸èƒ½`ã€REQUIREDã€SHALLã€SHALL NOTã€SHOULDã€SHOULD NOTã€suggestã€MAYã€OPTIONALç­‰å…³é”®è¯æŒ‰RFC2119 [RFC2119]è§£é‡Šã€‚ å†…å®¹åå•†å®¢æˆ·ç«¯è´£ä»»è¯·æ±‚ä¸­headerå¿…é¡»æºå¸¦Content-Type: application/vnd.api+json, è¡¨ç¤ºè¯·æ±‚æ•°æ®ä¸º JSON:APIæ•°æ®, ä¸èƒ½æºå¸¦å…¶å®ƒä»»ä½•åª’ä½“ç±»å‹å‚æ•°ã€‚ è¯·æ±‚ä¸­headerçš„Accept: application/vnd.api+json è¡¨ç¤ºå¯ä»¥æ¥æ”¶JSON:APIæ•°æ®ã€‚ å®¢æˆ·ç«¯å¿…é¡»å¿½ç•¥å“åº”æ–‡æ¡£çš„Content-Typeå¤´ä¸­æ¥æ”¶åˆ°çš„application/vnd.api+jsonåª’ä½“ç±»å‹çš„ä»»ä½•å‚æ•°ã€‚ æœåŠ¡ç«¯è´£ä»»æœåŠ¡ç«¯å“åº”JSON:APIæ•°æ®å¿…é¡»åœ¨å“åº”ä¸­æºå¸¦header Content-Type: application/vnd.api+jsonï¼Œè¡¨ç¤ºå“åº”æ•°æ®ä¸ºJSON:APIæ•°æ®ã€‚ å¦‚æœè¯·æ±‚æ²¡æœ‰æŒ‡å®šContent-Type: application/vnd.api+json headerçš„åª’ä½“ç±»å‹å‚æ•°ï¼ŒæœåŠ¡ç«¯å¿…é¡»å“åº”ä¸€ä¸ªå¸¦415 Unsupported Media Type(ä¸æ”¯æŒçš„åª’ä½“ç±»å‹)çš„çŠ¶æ€ç ã€‚ å¦‚æœè¯·æ±‚header ä¸åŒ…å«Acceptçš„åª’ä½“ç±»å‹å‚æ•°æˆ–å…¶å®ƒåª’ä½“å‚æ•°, æœåŠ¡ç«¯å¿…é¡»å“åº”ä¸€ä¸ªå¸¦406 Not Acceptable(ä¸å¯æ¥å—)çš„çŠ¶æ€ç ã€‚ æ³¨æ„:å­˜åœ¨å†…å®¹åå•†éœ€æ±‚ï¼Œä»¥å…è®¸æ­¤è§„èŒƒçš„æœªæ¥ç‰ˆæœ¬ä½¿ç”¨åª’ä½“ç±»å‹å‚æ•°è¿›è¡Œæ‰©å±•åå•†å’Œç‰ˆæœ¬æ§åˆ¶ æ–‡æ¡£ç»“æ„æœ¬èŠ‚æè¿°JSON:APIæ–‡æ¡£çš„ç»“æ„ï¼Œè¯¥æ–‡æ¡£ç”±åª’ä½“ç±»å‹application/vnd.api+jsonæ ‡è¯†ã€‚JSON:APIæ–‡æ¡£æ˜¯ç”¨JavaScriptå¯¹è±¡è¡¨ç¤ºæ³•(JSON) [RFC7159]å®šä¹‰çš„ã€‚ å°½ç®¡è¯·æ±‚å’Œå“åº”æ–‡æ¡£éƒ½ä½¿ç”¨ç›¸åŒçš„åª’ä½“ç±»å‹ï¼Œä½†æŸäº›æ–¹é¢åªé€‚ç”¨äºå…¶ä¸­ä¹‹ä¸€ã€‚ä¸‹é¢åˆ—å‡ºè¿™äº›å·®å¼‚ã€‚ é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æ­¤è§„èŒƒå®šä¹‰çš„å¯¹è±¡ä¸èƒ½åŒ…å«ä»»ä½•å…¶ä»–æˆå‘˜ã€‚å®¢æˆ·æœºå’ŒæœåŠ¡å™¨å®ç°å¿…é¡»å¿½ç•¥æ­¤è§„èŒƒä¸èƒ½è¯†åˆ«çš„æˆå‘˜ã€‚ é¡¶å±‚ç»“æ„ä¸€ä¸ªJSONå¯¹è±¡å¿…é¡»ä½äºæ¯ä¸ªJSON:APIè¯·æ±‚å’Œå“åº”æ•°æ®çš„æ ¹çº§ã€‚æ­¤å¯¹è±¡å®šä¹‰æ–‡æ¡£çš„ â€œé¡¶å±‚â€ã€‚ æ–‡ä»¶å¿…é¡»è‡³å°‘åŒ…å«ä¸‹åˆ—å…¶ä¸­ä¸€åé¡¶å±‚æˆå‘˜: data: æ–‡æ¡£çš„ä¸»è¦æ•°æ® errors: é”™è¯¯å¯¹è±¡æ•°ç»„ meta: åŒ…å«éæ ‡å‡†å…ƒä¿¡æ¯çš„å…ƒå¯¹è±¡ æˆå‘˜dataå’Œerrors ä¸€å®šä¸èƒ½åœ¨åŒä¸€æ–‡æ¡£ä¸­å…±å­˜ æ–‡æ¡£å¯ä»¥åŒ…å«ä»¥ä¸‹ä»»ä½•é¡¶å±‚æˆå‘˜ï¼š jsonapiï¼šæè¿°æœåŠ¡å™¨å®ç°çš„å¯¹è±¡ linksï¼šä¸ä¸»æ•°æ®ç›¸å…³çš„é“¾æ¥å¯¹è±¡ã€‚ includedï¼šä¸ä¸»æ•°æ®å’Œ/æˆ–å½¼æ­¤ç›¸å…³çš„èµ„æºå¯¹è±¡æ•°ç»„ï¼ˆåŒ…å«çš„èµ„æº) å¦‚æœæ–‡ä»¶ä¸åŒ…å«é¡¶å±‚dataæˆå‘˜ï¼Œincludedæˆå‘˜ å¿…é¡»ä¸å­˜ é¡¶å±‚linkså¯¹è±¡ å¯ä»¥åŒ…å«ä»¥ä¸‹æˆå‘˜ï¼š self: ç”Ÿæˆå½“å‰å“åº”æ–‡æ¡£çš„é“¾æ¥ related: ä¸»æ•°æ®è¡¨ç¤ºèµ„æºå…³ç³»æ—¶çš„ç›¸å…³èµ„æºé“¾æ¥ ä¸»è¦æ•°æ®çš„åˆ†é¡µé“¾æ¥ æ–‡æ¡£çš„ä¸»è¦æ•°æ®è¡¨ç¤ºè¯·æ±‚æ‰€é’ˆå¯¹çš„èµ„æºæˆ–èµ„æºé›†åˆã€‚ ä¸»è¦æ•°æ®å¿…é¡»æ˜¯ï¼š å¯¹äºä»¥å•ä¸ªèµ„æºä¸ºç›®æ ‡çš„è¯·æ±‚: å•ä¸ªèµ„æºå¯¹è±¡ï¼Œå•ä¸ªèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡ï¼Œæˆ–è€…null ç”¨äºå®šä½èµ„æºé›†åˆçš„è¯·æ±‚: èµ„æºå¯¹è±¡æ•°ç»„ï¼Œèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡æ•°ç»„ï¼Œæˆ–ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]) ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸»è¦æ•°æ®æ˜¯å•ä¸ªèµ„æºå¯¹è±¡ï¼š 123456789101112&#123; \"data\": &#123; \"type\": \"articles\", \"id\": \"1\", \"attributes\": &#123; // ... this article's attributes &#125;, \"relationships\": &#123; // ... this article's relationships &#125; &#125;&#125; ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸»è¦æ•°æ®æ˜¯å¼•ç”¨ç›¸åŒèµ„æºçš„å•ä¸ªèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡ï¼š 123456&#123; \"data\": &#123; \"type\": \"articles\", \"id\": \"1\" &#125;&#125; èµ„æºçš„é€»è¾‘é›†åˆå¿…é¡»è¡¨ç¤ºä¸ºæ•°ç»„ï¼Œå³ä½¿å®ƒåªåŒ…å«ä¸€ä¸ªç©ºæ•°ç»„ã€‚ èµ„æºå¯¹è±¡èµ„æºå¯¹è±¡å‡ºç°åœ¨JSON:APIæ–‡æ¡£ä¸­ä»¥è¡¨ç¤ºèµ„æºã€‚ èµ„æºå¯¹è±¡å¿…é¡»è‡³å°‘åŒ…å«ä»¥ä¸‹é¡¶çº§æˆå‘˜ï¼š id type ä¾‹å¤–ï¼šidå½“èµ„æºå¯¹è±¡åœ¨å®¢æˆ·ç«¯å‘èµ·å¹¶è¡¨ç¤ºè¦åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºçš„æ–°èµ„æºæ—¶ï¼Œä¸éœ€è¦è¯¥æˆå‘˜ã€‚ æ­¤å¤–ï¼Œèµ„æºå¯¹è±¡å¯ä»¥åŒ…å«ä»¥ä¸‹ä»»ä½•é¡¶çº§æˆå‘˜ï¼š attributes: è¡¨ç¤ºæŸäº›èµ„æºæ•°æ®çš„å±æ€§å¯¹è±¡ã€‚ relationships: æè¿°èµ„æºä¸å…¶ä»–JSON:APIèµ„æºä¹‹é—´å…³ç³»çš„å…³ç³»å¯¹è±¡ã€‚ links: åŒ…å«ä¸èµ„æºç›¸å…³çš„é“¾æ¥çš„é“¾æ¥å¯¹è±¡ã€‚ meta: åŒ…å«æœ‰å…³æ— æ³•è¡¨ç¤ºä¸ºå±æ€§æˆ–å…³ç³»çš„èµ„æºçš„éæ ‡å‡†å…ƒä¿¡æ¯çš„å…ƒå¯¹è±¡ã€‚ ä»¥ä¸‹æ˜¯æ–‡ç« ï¼ˆå³â€œæ–‡ç« â€ç±»å‹çš„èµ„æºï¼‰å¯èƒ½å‡ºç°åœ¨æ–‡æ¡£ä¸­çš„æ–¹å¼ï¼š 123456789101112131415161718// ...&#123; \"type\": \"articles\", \"id\": \"1\", \"attributes\": &#123; \"title\": \"Rails is Omakase\" &#125;, \"relationships\": &#123; \"author\": &#123; \"links\": &#123; \"self\": \"/articles/1/relationships/author\", \"related\": \"/articles/1/author\" &#125;, \"data\": &#123; \"type\": \"people\", \"id\": \"9\" &#125; &#125; &#125;&#125;// ... è¯†åˆ«(Identification)æ¯ä¸ªèµ„æºå¯¹è±¡ å¿…é¡»åŒ…å«ä¸€ä¸ªidæˆå‘˜å’Œä¸€ä¸ªtypeæˆå‘˜ã€‚idå’Œtypeæˆå‘˜çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚ åœ¨ç»™å®šçš„APIä¸­ï¼Œæ¯ä¸ªèµ„æºå¯¹è±¡typeå’Œidå¯¹å¿…é¡» è¯†åˆ«å•ä¸ªå”¯ä¸€èµ„æºã€‚ï¼ˆç”±æœåŠ¡å™¨æ§åˆ¶çš„URIé›†åˆï¼Œæˆ–ä½œä¸ºä¸€ä¸ªæœåŠ¡å™¨çš„å¤šä¸ªæœåŠ¡å™¨æ„æˆçš„APIï¼‰ è¯¥typeæˆå‘˜ç”¨äºæè¿°å…±äº«å…¬å…±å±æ€§å’Œå…³ç³»çš„èµ„æºå¯¹è±¡ typeæˆå‘˜çš„å€¼å¿…é¡»éµå®ˆä¸æˆå‘˜åç§°ç›¸åŒçš„çº¦æŸ å­—æ®µèµ„æºå¯¹è±¡çš„attributes(å±æ€§)å’Œå®ƒçš„relationships(å…³ç³»)ä¸­çš„åŸŸè¢«ç»Ÿç§°ä¸ºå®ƒçš„ å­—æ®µã€‚ èµ„æºå¯¹è±¡çš„ å­—æ®µå¿…é¡»å½¼æ­¤å…±äº«ä¸€ä¸ª å…±åŒçš„å‘½åç©ºé—´ï¼Œå¹¶ä¸èƒ½ä½¿ç”¨typeå’Œidã€‚æ¢å¥è¯è¯´ï¼Œèµ„æºä¸èƒ½å…·æœ‰ç›¸åŒåç§°çš„å±æ€§å’Œå…³ç³»ï¼Œä¹Ÿä¸èƒ½å…·æœ‰åç§°æ˜¯typeå’Œidçš„å±æ€§æˆ–å…³ç³»ã€‚ ä¸¾ä¾‹, ä»¥ä¸‹åŒ…æ‹¬é”™è¯¯âŒçš„å­—æ®µ: 1234567891011121314// ...&#123; \"type\": \"articles\", \"id\": \"1\", \"attributes\": &#123; \"type\": \"literature\", \"title\": \"Rails is Omakase\" &#125;, \"relationships\": &#123; \"title\": &#123; &#125; &#125;&#125;// ... å±æ€§ä¸­typeå­—æ®µ, é”™è¯¯å‘½åæˆäº†type å±æ€§å’Œå…³ç³»ä¸­éƒ½æœ‰äº†titleå­—æ®µ å±æ€§attributesé”®çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå±æ€§å¯¹è±¡ï¼‰ã€‚å±æ€§å¯¹è±¡ï¼ˆattributesï¼‰çš„æˆå‘˜è¡¨ç¤ºæœ‰å…³å…¶å®šä¹‰çš„èµ„æºå¯¹è±¡çš„ä¿¡æ¯ã€‚ å±æ€§å¯ä»¥åŒ…å«ä»»ä½•æœ‰æ•ˆçš„JSONå€¼ã€‚ å…è®¸æ¶‰åŠJSONå¯¹è±¡å’Œæ•°ç»„çš„å¤æ‚æ•°æ®ç»“æ„ä½œä¸ºå±æ€§å€¼ã€‚ç„¶è€Œï¼Œæ„æˆæˆ–åŒ…å«åœ¨ä¸€ä¸ªå±æ€§çš„ä»»ä½•å¯¹è±¡å¿…é¡»ä¸åŒ…å«relationshipsæˆ–linkså­—æ®µï¼Œå› ä¸ºè¿™äº›å­—æ®µç”±æœ¬è¯´æ˜ä¹¦ä¸­ä»¥ä¾›å°†æ¥ä½¿ç”¨ä¿ç•™ã€‚ è™½ç„¶æœ‰ä¸€ä¸ªå¤–é”®ï¼ˆä¾‹å¦‚author_idï¼‰é€šå¸¸å­˜å‚¨åœ¨å†…éƒ¨ä»¥åŠè¦åœ¨èµ„æºå¯¹è±¡ä¸­è¡¨ç¤ºçš„å…¶ä»–ä¿¡æ¯ï¼Œä½†è¿™äº›é”®ä¸åº”è¯¥ä½œä¸ºå±æ€§å‡ºç°ã€‚ å…³ç³»relationshipsé”®çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå…³ç³»å¯¹è±¡ï¼‰ã€‚å…³ç³»å¯¹è±¡ï¼ˆrelationshipsï¼‰çš„æˆå‘˜è¡¨ç¤ºä»å…¶å®šä¹‰åˆ°å…¶ä»–èµ„æºå¯¹è±¡çš„èµ„æºå¯¹è±¡çš„å¼•ç”¨ã€‚ å…³ç³»å¯èƒ½æ˜¯ä¸€å¯¹ä¸€æˆ–å¤šå¯¹ã€‚ å…³ç³»å¯¹è±¡ å¿…é¡»è‡³å°‘åŒ…å«ä»¥ä¸‹å…¶ä¸­ä¸€é¡¹ï¼š linksï¼šåŒ…å«ä»¥ä¸‹è‡³å°‘ä¸€é¡¹çš„é“¾æ¥å¯¹è±¡ï¼š selfï¼šå…³ç³»æœ¬èº«çš„é“¾æ¥ï¼ˆâ€œå…³ç³»é“¾æ¥â€)æ­¤é“¾æ¥å…è®¸å®¢æˆ·ç«¯ç›´æ¥æ“çºµå…³ç³»ã€‚ä¾‹å¦‚ï¼Œåˆ é™¤authoré€šè¿‡articleå…³ç³»URLå°†æ–­å¼€è¯¥äººä¸articleä¸åˆ é™¤peopleèµ„æºæœ¬èº«çš„å…³ç³»ã€‚æˆåŠŸè·å–åï¼Œæ­¤é“¾æ¥å°† ç›¸å…³èµ„æºçš„é“¾æ¥ä½œä¸ºå…¶ä¸»è¦æ•°æ®è¿”å›ã€‚ relatedï¼šç›¸å…³çš„èµ„æºé“¾æ¥ dataï¼šèµ„æºè”åŠ¨ metaï¼šåŒ…å«æœ‰å…³å…³ç³»çš„éæ ‡å‡†å…ƒä¿¡æ¯çš„å…ƒå¯¹è±¡ã€‚ è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»çš„å…³ç³»å¯¹è±¡ä¹Ÿå¯ä»¥åœ¨æˆå‘˜ä¸‹åŒ…å« åˆ†é¡µé“¾æ¥linksï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚å…³ç³»å¯¹è±¡ä¸­çš„ä»»ä½• åˆ†é¡µé“¾æ¥å¿…é¡»å¯¹å…³ç³»æ•°æ®è¿›è¡Œåˆ†é¡µï¼Œè€Œä¸æ˜¯ç›¸å…³èµ„æºã€‚ ç›¸å…³èµ„æºé“¾æ¥ç›¸å…³èµ„æºé“¾æ¥å¯ä»¥è®¿é—®èµ„æºå¯¹è±¡ é“¾æ¥ çš„å…³ç³»ã€‚è·å–æ—¶ï¼Œç›¸å…³èµ„æºå¯¹è±¡å°†ä½œä¸ºå“åº”çš„ä¸»æ•°æ®è¿”å›ã€‚ ä¾‹å¦‚ï¼Œarticleçš„comments å…³ç³»å¯ä»¥æŒ‡å®šä¸€ä¸ªé“¾æ¥è¿”å›è¯„è®ºçš„é›†åˆèµ„æºå¯¹è±¡ é€šè¿‡æ£€ç´¢æ—¶GETè¯·æ±‚ã€‚ å¦‚æœå­˜åœ¨ï¼Œç›¸å…³èµ„æºé“¾æ¥å¿…é¡»å¼•ç”¨æœ‰æ•ˆçš„URLï¼Œå³ä½¿è¯¥å…³ç³»å½“å‰æœªä¸ä»»ä½•ç›®æ ‡èµ„æºç›¸å…³è”ã€‚æ­¤å¤–ï¼Œç›¸å…³èµ„æºé“¾æ¥ä¸å¾—æ›´æ”¹ï¼Œå› ä¸ºå…¶å…³ç³»çš„å†…å®¹ä¼šå‘ç”Ÿå˜åŒ–ã€‚ èµ„æºé“¾æ¥å¤åˆæ–‡æ¡£ä¸­çš„èµ„æºé“¾æ¥å…è®¸å®¢æˆ·ç«¯å°†æ‰€æœ‰åŒ…å«çš„èµ„æºå¯¹è±¡é“¾æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ— éœ€GETé€šè¿‡é“¾æ¥è®¿é—®ä»»ä½•URL ã€‚ èµ„æºé“¾æ¥å¿…é¡»è¡¨ç¤ºä¸ºä»¥ä¸‹ä¹‹ä¸€ï¼š null ä¸ºäº†ç©ºå¯¹ä¸€çš„å…³ç³»ã€‚ ç©ºæ•°ç»„ï¼ˆ[]ï¼‰ç”¨äºç©ºå¯¹å¤šå…³ç³»ã€‚ éç©º å¯¹ä¸€å…³ç³»çš„å•ä¸ªèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡ã€‚ éç©º å¯¹å¤šå…³ç³»çš„èµ„æºæ ‡è¯†ç¬¦å¯¹è±¡æ•°ç»„ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹æ–‡ç« ä¸ä»¥ä¸‹å†…å®¹ç›¸å…³è”authorï¼š 123456789101112131415161718192021// ...&#123; \"type\": \"articles\", \"id\": \"1\", \"attributes\": &#123; \"title\": \"Rails is Omakase\" &#125;, \"relationships\": &#123; \"author\": &#123; \"links\": &#123; \"self\": \"http://example.com/articles/1/relationships/author\", \"related\": \"http://example.com/articles/1/author\" &#125;, \"data\": &#123; \"type\": \"people\", \"id\": \"9\" &#125; &#125; &#125;, \"links\": &#123; \"self\": \"http://example.com/articles/1\" &#125;&#125;// ... è¯¥authorå…³ç³»åŒ…æ‹¬å…³ç³»æœ¬èº«çš„é“¾æ¥ï¼ˆå…è®¸å®¢æˆ·ç«¯ç›´æ¥æ›´æ”¹ç›¸å…³ä½œè€…ï¼‰ï¼Œç”¨äºè·å–èµ„æºå¯¹è±¡çš„ç›¸å…³èµ„æºé“¾æ¥ä»¥åŠé“¾æ¥ä¿¡æ¯ã€‚ èµ„æºé“¾æ¥linksæ¯ä¸ªèµ„æºå¯¹è±¡ä¸­çš„å¯é€‰æˆå‘˜åŒ…å« ä¸èµ„æºç›¸å…³çš„é“¾æ¥ã€‚ å¦‚æœå­˜åœ¨ï¼Œåˆ™æ­¤é“¾æ¥å¯¹è±¡å¯ä»¥åŒ…å«æ ‡è¯†èµ„æºå¯¹è±¡æ‰€è¡¨ç¤ºçš„èµ„æºçš„self é“¾æ¥ã€‚ 123456789101112// ...&#123; \"type\": \"articles\", \"id\": \"1\", \"attributes\": &#123; \"title\": \"Rails is Omakase\" &#125;, \"links\": &#123; \"self\": \"http://example.com/articles/1\" &#125;&#125;// ... æœåŠ¡å™¨å¿…é¡»GETä½¿ç”¨åŒ…å«èµ„æºä½œä¸ºä¸»æ•°æ®çš„å“åº”æ¥å“åº”å¯¹æŒ‡å®šURL çš„è¯·æ±‚ã€‚ èµ„æºæ ‡è¯†ç¬¦å¯¹è±¡â€œèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡â€æ˜¯æ ‡è¯†å•ä¸ªèµ„æºçš„å¯¹è±¡ã€‚ â€œèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡â€ å¿…é¡»åŒ…å«typeå’Œidæˆå‘˜ã€‚ â€œèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡â€ å¯èƒ½è¿˜åŒ…æ‹¬ä¸€ä¸ªmetaæ„ä»¶ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå…ƒåŒ…å«éæ ‡å‡†å…ƒä¿¡æ¯å¯¹è±¡ã€‚ å¤åˆæ–‡ä»¶ä¸ºäº†å‡å°‘HTTPè¯·æ±‚çš„æ•°é‡ï¼ŒæœåŠ¡å™¨å¯ä»¥å…è®¸åŒ…å«ç›¸å…³èµ„æºå’Œæ‰€è¯·æ±‚çš„ä¸»è¦èµ„æºçš„å“åº”ã€‚è¿™ç§ååº”è¢«ç§°ä¸ºâ€œå¤åˆæ–‡ä»¶â€ã€‚ åœ¨å¤åˆæ–‡æ¡£ä¸­ï¼Œæ‰€æœ‰åŒ…å«çš„èµ„æºå¿…é¡»åŒ…å«åœ¨é¡¶çº§æˆå‘˜ä¸­çš„èµ„æºå¯¹è±¡æ•°ç»„includedä¸­ã€‚ å¤åˆæ–‡æ¡£éœ€è¦â€œå®Œå…¨é“¾æ¥â€ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªåŒ…å«çš„èµ„æºå¿…é¡»ç”± åŒä¸€æ–‡æ¡£ä¸­çš„è‡³å°‘ä¸€ä¸ªèµ„æºæ ‡è¯†ç¬¦å¯¹è±¡æ ‡è¯†ã€‚è¿™äº›èµ„æºæ ‡è¯†ç¬¦å¯¹è±¡å¯ä»¥æ˜¯ä¸»æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸»è¦æˆ–åŒ…å«çš„èµ„æºä¸­åŒ…å«çš„èµ„æºé“¾æ¥ã€‚ å®Œå…¨é“¾æ¥è¦æ±‚çš„å”¯ä¸€ä¾‹å¤–æ˜¯å½“é€šè¿‡ç¨€ç–å­—æ®µé›†æ’é™¤å¦åˆ™å°†åŒ…å«é“¾æ¥æ•°æ®çš„å…³ç³»å­—æ®µæ—¶ã€‚ æ³¨æ„ï¼šå®Œå…¨é“¾æ¥å¯ç¡®ä¿åŒ…å«çš„èµ„æºä¸ä¸»æ•°æ®ï¼ˆå¯ä»¥æ˜¯èµ„æºå¯¹è±¡æˆ–èµ„æºæ ‡è¯†ç¬¦å¯¹è±¡ï¼‰ç›¸å…³ï¼Œä¹Ÿå¯ä»¥ç›¸äº’å…³è”ã€‚ åŒ…å«å¤šä¸ªåŒ…å«å…³ç³»çš„å®Œæ•´ç¤ºä¾‹æ–‡æ¡£ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&#123; \"data\": [&#123; \"type\": \"articles\", \"id\": \"1\", \"attributes\": &#123; \"title\": \"JSON:API paints my bikeshed!\" &#125;, \"links\": &#123; \"self\": \"http://example.com/articles/1\" &#125;, \"relationships\": &#123; \"author\": &#123; \"links\": &#123; \"self\": \"http://example.com/articles/1/relationships/author\", \"related\": \"http://example.com/articles/1/author\" &#125;, \"data\": &#123; \"type\": \"people\", \"id\": \"9\" &#125; &#125;, \"comments\": &#123; \"links\": &#123; \"self\": \"http://example.com/articles/1/relationships/comments\", \"related\": \"http://example.com/articles/1/comments\" &#125;, \"data\": [ &#123; \"type\": \"comments\", \"id\": \"5\" &#125;, &#123; \"type\": \"comments\", \"id\": \"12\" &#125; ] &#125; &#125; &#125;], \"included\": [&#123; \"type\": \"people\", \"id\": \"9\", \"attributes\": &#123; \"first-name\": \"Dan\", \"last-name\": \"Gebhardt\", \"twitter\": \"dgeb\" &#125;, \"links\": &#123; \"self\": \"http://example.com/people/9\" &#125; &#125;, &#123; \"type\": \"comments\", \"id\": \"5\", \"attributes\": &#123; \"body\": \"First!\" &#125;, \"relationships\": &#123; \"author\": &#123; \"data\": &#123; \"type\": \"people\", \"id\": \"2\" &#125; &#125; &#125;, \"links\": &#123; \"self\": \"http://example.com/comments/5\" &#125; &#125;, &#123; \"type\": \"comments\", \"id\": \"12\", \"attributes\": &#123; \"body\": \"I like XML better\" &#125;, \"relationships\": &#123; \"author\": &#123; \"data\": &#123; \"type\": \"people\", \"id\": \"9\" &#125; &#125; &#125;, \"links\": &#123; \"self\": \"http://example.com/comments/12\" &#125; &#125;]&#125;","categories":[{"name":"JSON API","slug":"JSON-API","permalink":"https://jigangduan.github.io/categories/JSON-API/"},{"name":"è§„èŒƒ","slug":"JSON-API/è§„èŒƒ","permalink":"https://jigangduan.github.io/categories/JSON-API/è§„èŒƒ/"}],"tags":[{"name":"api","slug":"api","permalink":"https://jigangduan.github.io/tags/api/"}]},{"title":"ç‚¹é¤ç³»ç»Ÿ","slug":"ç‚¹é¤ç³»ç»Ÿ","date":"2019-01-02T04:34:26.000Z","updated":"2020-07-25T02:57:18.236Z","comments":true,"path":"2019/01/02/ç‚¹é¤ç³»ç»Ÿ/","link":"","permalink":"https://jigangduan.github.io/2019/01/02/ç‚¹é¤ç³»ç»Ÿ/","excerpt":"","text":"ä»‹ç»åŸºç¡€ä»‹ç» ä¹°å®¶ï¼ˆå¾®ä¿¡ï¼‰ å¾®ä¿¡ç‚¹é¤ å¾®ä¿¡æ”¯ä»˜ å¾®ä¿¡é€šçŸ¥ï¼ˆæ¨¡ç‰ˆæ¶ˆæ¯ï¼‰ å–å®¶ï¼ˆPCï¼‰ç®¡ç†ç³»ç»Ÿ æ‰«æç™»å½• è®¢å• å•†å“ ç±»ç›® æŠ€æœ¯è¦ç‚¹å‰åç«¯åˆ†ç¦» â€”â€” RestFul å‰ç«¯Vue â€”â€” WebApp åç«¯Spring Boot â€”â€” Bootstrap+Freemarker+JQuery Spring Boot â€”â€” æ•°æ®åº“ â€”â€” JPA â€”â€” MyBatis Spring Boot â€”â€” ç¼“å­˜ â€”â€” Redis â€”â€” åˆ†å¸ƒå¼Session + åˆ†å¸ƒå¼é” Spring Boot â€”â€” æ¶ˆæ¯æ¨é€ â€”â€” WebSocket å¾®ä¿¡æŠ€æœ¯ å¾®ä¿¡æ‰«æç™»å½• æ¨¡ç‰ˆæ¶ˆæ¯æ¨é€ å¾®ä¿¡æ”¯ä»˜å’Œé€€æ¬¾ é¡¹ç›®è®¾è®¡è§’è‰²åˆ’åˆ† ä¹°å®¶ å•†å“åˆ—è¡¨ è®¢å•åˆ›å»º è®¢å•æŸ¥è¯¢ è®¢å•å–æ¶ˆ â€¦ å–å®¶ è®¢å•ç®¡ç† å•†å“ç®¡ç† ç±»ç›®ç®¡ç† åŠŸèƒ½æ¨¡å—åˆ’åˆ†å•†å“ ä¹°å®¶ å•†å“åˆ—è¡¨ å–å®¶ å•†å“ç®¡ç† è®¢å• ä¹°å®¶ è®¢å•åˆ›å»º è®¢å•æŸ¥è¯¢ è®¢å•å–æ¶ˆ â€¦ å–å®¶ è®¢å•ç®¡ç† ç±»ç›® å–å®¶ ç±»ç›®ç®¡ç† å…³ç³» ä¹°å®¶ â€”â€”æŸ¥è¯¢â€”â€”&gt; å•†å“ å–å®¶ â€”â€”ç®¡ç†â€”â€”&gt; å•†å“ ä¹°å®¶ â€”â€”åˆ›å»º/æŸ¥è¯¢â€”â€”&gt; è®¢å• ä¹°å®¶ â€”â€”æŸ¥è¯¢/æ¥æ”¶â€”â€”&gt; è®¢å• ä¹°å®¶ &lt;â€”â€”æ¶ˆæ¯â€”â€”&gt; å–å®¶ éƒ¨ç½²æ¶æ„å¾®ä¿¡ &amp; PCæµè§ˆå™¨ â€”â€”&gt; NGINX â€”â€”&gt; Tomcat â€”â€”&gt; Redis &amp; MySQL æ•°æ®åº“è®¾è®¡è¡¨å…³ç³»ç±»ç›®è¡¨(product_category) â€”â€”&gt; å•†å“è¡¨(product_info) â€”â€”&gt; è®¢å•è¯¦æƒ…è¡¨(order_detail) nâ€”â€”&gt;1 è®¢å•ä¸»è¡¨(order_master) å–å®¶ä¿¡æ¯è¡¨(seller_info) è¡¨ç»“æ„å•†å“è¡¨(product_info) åç§° å•ä»· åº“å­˜ æè¿° å›¾ç‰‡ ç›®å½•ç¼–å· 12345678910111213CREATE TABLE IF NOT EXISTS `product_info` ( `product_id` VARCHAR(32) NOT NULL, `product_name` VARCHAR(64) NOT NULL COMMENT 'å•†å“åç§°', `product_price` DECIMAL(8, 2) NOT NULL COMMENT 'å•ä»·', `product_stock` INT NOT NULL COMMENT 'åº“å­˜', `product_description` VARCHAR(64) COMMENT 'æè¿°', `product_icon` VARCHAR(512) COMMENT 'å°å›¾ç‰‡', `product_status` TINYINT(3) NOT NULL DEFAULT '0' COMMENT 'å•†å“çŠ¶æ€: 0-é»˜è®¤æœªä¸Šæ¶', `category_type` INT NOT NULL COMMENT 'ç›®å½•ç¼–å·', `creat_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', `update_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', PRIMARY KEY (`product_id`)) COMMENT 'å•†å“è¡¨'; ç±»ç›®è¡¨(product_category) åç§° ç¼–å· 123456789CREATE TABLE IF NOT EXISTS `product_category` ( `category_id` INT NOT NULL auto_increment, `category_name` VARCHAR ( 64 ) NOT NULL COMMENT 'ç±»ç›®åç§°', `category_type` INT NOT NULL COMMENT 'ç¼–å·', `creat_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', `update_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', PRIMARY KEY ( `category_id` ), UNIQUE KEY `uqe_category_type` ( `category_type` ) ) COMMENT 'ç±»ç›®è¡¨'; è®¢å•è¡¨ ä¹°å®¶åç§° ä¹°å®¶ç”µè¯ ä¹°å®¶åœ°å€ ä¹°å®¶å¾®ä¿¡id æ€»é‡‘é¢ è®¢å•çŠ¶æ€ æ”¯ä»˜çŠ¶æ€ 1234567891011121314CREATE TABLE IF NOT EXISTS `order_master` ( `order_id` VARCHAR ( 32 ) NOT NULL, `buyer_name` VARCHAR ( 32 ) NOT NULL COMMENT 'ä¹°å®¶åç§°', `buyer_phone` VARCHAR ( 32 ) NOT NULL COMMENT 'ä¹°å®¶ç”µè¯', `buyer_address` VARCHAR ( 32 ) NOT NULL COMMENT 'ä¹°å®¶åœ°å€', `buyer_openid` VARCHAR ( 32 ) NOT NULL COMMENT 'ä¹°å®¶å¾®ä¿¡id', `order_amount` DECIMAL ( 8, 2 ) NOT NULL COMMENT 'æ€»é‡‘é¢', `order_status` TINYINT ( 3 ) NOT NULL DEFAULT '0' COMMENT 'è®¢å•çŠ¶æ€ï¼š 0-é»˜è®¤æ–°ä¸‹å•', `pay_status` TINYINT ( 3 ) NOT NULL DEFAULT '0' COMMENT 'æ”¯ä»˜çŠ¶æ€ï¼š 0-é»˜è®¤æœªæ”¯ä»˜', `creat_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', `update_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', PRIMARY KEY ( `order_id` ), KEY `idx_buyer_openid` ( `buyer_openid` ) ) COMMENT 'è®¢å•è¡¨'; è®¢å•id å•†å“id å•†å“åå­— å•†å“ä»·æ ¼ å•†å“æ•°é‡ å•†å“ç…§ç‰‡ 12345678910111213CREATE TABLE IF NOT EXISTS `order_detail` ( `detail_id` VARCHAR ( 32 ) NOT NULL, `order_id` VARCHAR ( 32 ) NOT NULL, `product_id` VARCHAR ( 32 ) NOT NULL, `product_name` VARCHAR ( 64 ) NOT NULL COMMENT 'å•†å“åç§°', `product_price` DECIMAL ( 8, 2 ) NOT NULL COMMENT 'å•†å“å•ä»·', `product_quantity` INT NOT NULL COMMENT 'å•†å“æ•°é‡', `product_icon` VARCHAR ( 512 ) COMMENT 'å•†å“å›¾ç‰‡', `creat_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', `update_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', PRIMARY KEY ( `detail_id` ), KEY `idx_order_id` ( `order_id` )) COMMENT 'è®¢å•è¯¦æƒ…è¡¨'; å¼€å‘ç¯å¢ƒ JDK Maven Ide æ—¥å¿—ä½¿ç”¨æ—¥å¿—æ¡†æ¶ä»€ä¹ˆæ˜¯æ—¥å¿—æ¡†æ¶ï¼Ÿ æ˜¯ä¸€å¥—èƒ½å®ç°æ—¥å¿—è¾“å‡ºçš„å·¥å…·åŒ… èƒ½å¤Ÿæè¿°ç³»ç»Ÿè¿è¡ŒçŠ¶æ€çš„æ‰€æœ‰æ—¶é—´éƒ½å¯ä»¥ç®—ä½œæ—¥å¿— ç”¨æˆ·ä¸‹çº¿ æ¥å£è¶…æ—¶ æ•°æ®åº“å´©æºƒ â€¦ èƒ½åŠ›ï¼š å®šåˆ¶è¾“å‡ºæ—¥å¿— å®šåˆ¶è¾“å‡ºæ ¼å¼ æºå¸¦ä¸Šä¸‹æ–‡ä¿¡æ¯ è¿è¡Œæ—¶é€‰æ‹©æ€§è¾“å‡º çµæ´»çš„é…ç½® ä¼˜å¼‚çš„æ€§èƒ½ å¸¸è§æ—¥å¿—æ¡†æ¶ï¼š æ—¥å¿—é—¨é¢ JUL JCL SLF4j jboss-logging æ—¥å¿—å®ç° Log4j Log4j2 Logback ä½¿ç”¨ï¼š 1234567891011121314151617181920212223242526272829@RunWith(SpringRunner.class)@SpringBootTest@Slf4jpublic class LoggerTests &#123; private final Logger logger = LoggerFactory.getLogger(LoggerTests.class); /** * ä¼ ç»Ÿæ–¹å¼å®ç°æ—¥å¿— */ @Test public void test1() &#123; logger.debug(\"debug ...\"); logger.info(\"info ...\"); logger.error(\"error ...\"); &#125; /** * Slf4jæ³¨è§£æ–¹å¼å®ç°æ—¥å¿— */ @Test public void test2() &#123; String name = \"sell\"; String password = \"***\"; log.debug(\"debug ...\"); log.info(\"info ... name: &#123;&#125;, password: &#123;&#125;\", name, password); log.error(\"error ...\"); &#125;&#125; Logbackçš„é…ç½® application.yml logback-spring.xml éœ€æ±‚ï¼š åŒºåˆ†infoå’Œerroræ—¥å¿— æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ logback-spring.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;&lt;configuration&gt; &lt;appender name=\"consoleLog\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;layout class=\"ch.qos.logback.classic.PatternLayout\"&gt; &lt;pattern&gt; %date %level [%thread] %logger&#123;10&#125; [%file:%line] ------ %msg%n &lt;/pattern&gt; &lt;/layout&gt; &lt;/appender&gt; &lt;appender name=\"fileInfoLog\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;DENY&lt;/onMatch&gt; &lt;onMismatch&gt;ACCEPT&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;pattern&gt; %d - %msg%n &lt;/pattern&gt; &lt;/encoder&gt; &lt;!--æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"&gt; &lt;!--è·¯å¾„--&gt; &lt;fileNamePattern&gt;/Users/jigang.duan/logs/tomcat/sell/info.%d.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;appender name=\"fileErrorLog\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;pattern&gt; %d - %msg%n &lt;/pattern&gt; &lt;/encoder&gt; &lt;!--æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"&gt; &lt;!--è·¯å¾„--&gt; &lt;fileNamePattern&gt;/Users/username/logs/tomcat/sell/error.%d.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;root level=\"info\"&gt; &lt;appender-ref ref=\"consoleLog\" /&gt; &lt;appender-ref ref=\"fileInfoLog\" /&gt; &lt;appender-ref ref=\"fileErrorLog\" /&gt; &lt;/root&gt;&lt;/configuration&gt; ä¹°å®¶ç±»ç›®DADå¼•å…¥JPAä¾èµ–123456789 &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt; æ•°æ®åº“é…ç½®12345678spring: datasource: driver-class-name: com.mysql.jdbc.Driver username: root password: root url: jdbc:mysql://localhost:8889/seil?characterEncoding=utf-8&amp;useSSL=false jpa: show-sql: true Entity12345678910111213141516171819202122232425262728@Entity@DynamicUpdate@Datapublic class ProductCategory &#123; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = \"category_id\") private Integer id; @Column(name = \"category_name\") private String name; @Column(name = \"category_type\") private Integer type; private Date creatAt; private Date updateAt; public ProductCategory(String name, Integer type) &#123; this.name = name; this.type = type; &#125; public ProductCategory() &#123; &#125;&#125; Repository1234public interface ProductCategoryRepository extends JpaRepository&lt;ProductCategory, Integer&gt; &#123; List&lt;ProductCategory&gt; findByTypeIn(List&lt;Integer&gt; typeList);&#125; æµ‹è¯•ï¼š 1234567891011121314151617181920212223242526272829303132@RunWith(SpringRunner.class)@SpringBootTest@Slf4jpublic class ProductCategoryRepositoryTest &#123; @Autowired private ProductCategoryRepository repository; @Test public void findOneTest() &#123; Optional&lt;ProductCategory&gt; category = repository.findById(1); String desc = category.map(ProductCategory::toString).orElse(\"No value found\"); log.info(desc); &#125; @Test @Transactional public void saveTest() &#123; ProductCategory category = new ProductCategory(\"æµ‹è¯•ç±»ç›®\", 1); ProductCategory result = repository.save(category); Assert.assertNotNull(result); &#125; @Test public void findByTypeInTest() &#123; List&lt;Integer&gt; list = Arrays.asList(0, 1, 2); List&lt;ProductCategory&gt; result = repository.findByTypeIn(list); log.info(result.toString()); Assert.assertNotEquals(0, result.size()); &#125;&#125; ServiceæœåŠ¡æ¥å£ 12345678910public interface CategoryService &#123; Optional&lt;ProductCategory&gt; findById(Integer id); List&lt;ProductCategory&gt; findAll(); List&lt;ProductCategory&gt; findByTypeIn(List&lt;Integer&gt; typeList); ProductCategory save(ProductCategory category);&#125; æœåŠ¡å®ç° 1234567891011121314151617181920212223242526@Servicepublic class CategoryServiceImpl implements CategoryService &#123; @Autowired private ProductCategoryRepository repository; @Override public Optional&lt;ProductCategory&gt; findById(Integer id) &#123; return repository.findById(id); &#125; @Override public List&lt;ProductCategory&gt; findAll() &#123; return repository.findAll(); &#125; @Override public List&lt;ProductCategory&gt; findByTypeIn(List&lt;Integer&gt; typeList) &#123; return repository.findByTypeIn(typeList); &#125; @Override public ProductCategory save(ProductCategory category) &#123; return repository.save(category); &#125;&#125; æµ‹è¯•ï¼š 12345678910111213141516171819202122232425262728@RunWith(SpringRunner.class)@SpringBootTest@Slf4jpublic class CategoryServiceImplTest &#123; @Autowired private CategoryServiceImpl categoryService; @Test public void findById() &#123; String result = categoryService.findById(1).map(ProductCategory::toString).orElse(\"No value found\"); Assert.assertNotEquals(result, \"No value found\"); &#125; @Test @Transactional public void test() &#123; ProductCategory category = new ProductCategory(\"æµ‹è¯•æ•°æ®\", 0); ProductCategory save = categoryService.save(category); Assert.assertNotNull(save); List&lt;ProductCategory&gt; all = categoryService.findAll(); Assert.assertNotEquals(0, all.size()); List&lt;ProductCategory&gt; byTypeIn = categoryService.findByTypeIn(Collections.singletonList(0)); Assert.assertEquals(1, byTypeIn.size()); &#125;&#125; ä¹°å®¶å•†å“å¾®ä¿¡ç‰¹æ€§å¾®ä¿¡æˆæƒè·å–OpenID æ”¶åˆ°æ–¹å¼ ç¬¬ä¸‰æ–¹SDKæ–¹å¼ å¾®ä¿¡å¾®ä¿¡æ”¯ä»˜å¾®ä¿¡é€€æ¬¾","categories":[{"name":"å®ä¾‹","slug":"å®ä¾‹","permalink":"https://jigangduan.github.io/categories/å®ä¾‹/"}],"tags":[{"name":"å®ä¾‹","slug":"å®ä¾‹","permalink":"https://jigangduan.github.io/tags/å®ä¾‹/"}]},{"title":"Webå¼€å‘è€…åº”è¯¥æŒæ¡çš„CSS","slug":"You-need-to-know-css","date":"2018-12-23T15:30:04.000Z","updated":"2020-07-25T02:57:18.172Z","comments":true,"path":"2018/12/23/You-need-to-know-css/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/You-need-to-know-css/","excerpt":"","text":"åŸä½œè€…å‘å¸ƒåœ°å€: github åœ¨çº¿æŸ¥çœ‹ğŸŒ ä½ éœ€è¦äº†è§£css å¿«é€Ÿå¼€å§‹ä¸€äº›å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨æœ¬é¡¹ç›®çš„æ“ä½œï¼š clone è¿™ä¸ªä»“åº“: https://github.com/l-hammer/You-need-to-know-css.git ç”¨yarn æˆ–è€… npmå…¨å±€å®‰è£… docsify-cli: npm install docsify-cli -g (or yarn global add docsify-cli) åœ¨ç»ˆç«¯è¿è¡Œå‘½ä»¤ docsify serve æ‰“å¼€ http://localhost:3000 åœ¨ä½ çš„æµè§ˆå™¨ åŒ…æ‹¬ä»€ä¹ˆ è´¡çŒ® :fork_and_knife:Fork è¿™ä¸ªé¡¹ç›®å¹¶cloneåˆ°æœ¬åœ° :twisted_rightwards_arrows:æ–°å»ºä¸€ä¸ªåˆ†æ”¯: git checkout -b new-branch :wrench:å¢åŠ æ–°ç‰¹æ€§æˆ–è€…è§£å†³ä¸€äº›bug :memo:æäº¤ä½ çš„æ”¹å˜: git commit -am &#39;Add some feature&#39; :rocket:æ¨é€ä½ çš„åˆ†æ”¯: git push origin new-branch :tada:æäº¤Pull Request æˆ–è€…æäº¤ä¸€ä¸ªissue - æ¬¢è¿ä»»ä½•æœ‰å¸®åŠ©æ€§çš„å»ºè®®:stuck_out_tongue_winking_eye:","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"GitHubç²¾é€‰","slug":"å‰ç«¯/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/GitHubç²¾é€‰/"}],"tags":[{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"}]},{"title":"å‰ç«¯æŠ€æœ¯æ¸…å•","slug":"frontend-tech-list","date":"2018-12-23T14:37:09.000Z","updated":"2020-07-25T02:57:18.202Z","comments":true,"path":"2018/12/23/frontend-tech-list/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/frontend-tech-list/","excerpt":"","text":"åŸä½œè€…å‘å¸ƒåœ°å€: github æœ‰åŒå­¦åé¦ˆè¯´æ¸…å•å†…å®¹è¾ƒå¤šï¼Œä¸€æ¬¡æ— æ³•è¯»å®Œï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´å›æ¥å°±è®°ä¸æ¸…é˜…è¯»è¿›åº¦äº†ã€‚ä¸ºäº†ä¾¿äºå¤§å®¶åˆ†æ¬¡é˜…è¯»ï¼Œæˆ‘åˆ¶ä½œäº†ä¸€ä¸ªé¡µé¢ï¼Œåœ¨æ¯ç¯‡æ–‡ç« å‰åŠ ä¸Šé€‰æ‹©æ¡†ï¼ˆé€‰ä¸­checkboxè¡¨ç¤ºå·²è¯»ï¼‰ç”¨äºè®°å½•ä½ å·²ç»è¯»è¿‡çš„æ–‡ç« ï¼Œä¾¿äºä¸‹æ¬¡å›æ¥æ—¶ç»§ç»­é˜…è¯»ã€‚é¡µé¢é“¾æ¥ï¼šFrontend Tech List å‰ç«¯æŠ€æœ¯æ¸…å•å­¦ä¹ æ–‡ç« çš„çŸ¥è¯†å¾€å¾€æ˜¯ç¢ç‰‡åŒ–çš„ã€‚è€Œå‰ç«¯æ¶‰åŠåˆ°çš„é¢å¾ˆå¹¿ï¼Œè¿™äº›çŸ¥è¯†å¦‚æœä¸è¿›è¡Œæœ‰æ•ˆæ¢³ç†ï¼Œåˆ™æ— æ³•ç›¸äº’ä¸²è”ã€å½¢æˆä½“ç³»ã€‚å› æ­¤ï¼Œæˆ‘ç»“åˆå·¥ä½œä½“ä¼šå°†æŠ½è±¡å‡ºäº†ä¸€äº›å‰ç«¯åŸºç¡€èƒ½åŠ›ï¼Œå¹¶å°†çœ‹è¿‡ã€å†™è¿‡çš„ä¸€äº›ä¸é”™çš„æ–‡ç« è¿›è¡Œæ•´ç†ï¼Œå½¢æˆäº†ä¸€ä»½ï¼ˆçº¯ï¼‰å‰ç«¯æŠ€æœ¯æ¸…å•ã€‚ ä¸è®ºä½ æ˜¯æ­£åœ¨è‡ªå­¦å‰ç«¯ï¼Œè¿˜æ˜¯å¯¹å‰ç«¯æŸäº›æŠ€æœ¯ç†Ÿç»ƒæŒæ¡ä½†æŸäº›è¿˜æœªæ¶‰è¶³ï¼Œæˆ‘éƒ½å¸Œæœ›è¿™ä»½æ¸…å•èƒ½å¸®åŠ©ä½  review ä¸€äº›å‰ç«¯çš„åŸºç¡€èƒ½åŠ›ã€‚ å‰ç«¯æŠ€æœ¯æ¸…å• 0. å¹´åº¦æŠ¥å‘Š 1. åŸºç¡€æ‹¾é— 1.1. JavaScript 1.2. CSS 1.3. æµè§ˆå™¨ 2. å·¥ç¨‹åŒ–ä¸å·¥å…· 2.1. webpack 2.2. Gulp 2.3. Linter 2.4. é™æ€ç±»å‹ï¼ˆTypescript/Flowï¼‰ 2.5. Babel 2.6. CSSé¢„å¤„ç†ä¸æ¨¡å—åŒ– 3. æ€§èƒ½ä¼˜åŒ– 3.1. åŠ è½½æ€§èƒ½ 3.2. è¿è¡Œæ—¶æ€§èƒ½ 3.3. å‰ç«¯ç¼“å­˜ 3.4. æ€§èƒ½è°ƒè¯•ä¸å®è·µ 3.5. æ€§èƒ½æŒ‡æ ‡ 4. å®‰å…¨ 4.1. XSS 4.2. CSRF 4.3. CSP 4.4. HTTPS 4.5. å®‰å…¨å®å½• 5. è‡ªåŠ¨åŒ–æµ‹è¯• 5.1. å•å…ƒæµ‹è¯• 5.2. ç«¯åˆ°ç«¯æµ‹è¯• (E2E) 5.3. å…¶ä»– 6. æ¡†æ¶ä¸ç±»åº“ 6.1. React 6.2. Vue 6.3. Redux 6.4. RxJS 7. æ–°æŠ€æœ¯/æ–¹å‘ 7.1. PWA 7.2. CSS Houdini 7.3. Web Components 7.4. å¾®å‰ç«¯ï¼ˆMicro Frontendsï¼‰ 7.5. HTTP/2 7.6. WebAssembly 8. ä¸šåŠ¡ç›¸å…³ 8.1. æ•°æ®æ‰“ç‚¹ä¸ŠæŠ¥ 8.2. å‰ç«¯ç›‘æ§ 8.3. A/Bæµ‹è¯• 8.4. â€œæœåŠ¡ç«¯æ¨â€ 8.5. åŠ¨æ•ˆ 9. ä¸å½’ç±»çš„å¥½æ–‡ 0. å¹´åº¦æŠ¥å‘Š 2018 å‰ç«¯å·¥å…·è°ƒæŸ¥æŠ¥å‘Š 2018 JavaScript è°ƒæŸ¥æŠ¥å‘Š 1. åŸºç¡€æ‹¾é— æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œä¸çŸ¥åˆ™ä¹ ä¹‹ï¼Œæ˜¯ä»¥ç‰¢å›ºæ ¹åŸºã€‚ 1.1. JavaScript You-Dont-Know-JS [è‹±] JavaScript åŸºç¡€è¿è¡Œæœºåˆ¶ï¼š JS å¼•æ“ã€è¿è¡Œæ—¶ä¸è°ƒç”¨æ ˆæ¦‚è¿° [è‹±] V8 å¼•æ“ç®€ä»‹ [è‹±] å†…å­˜ç®¡ç†ä¸4ä¸­å¸¸è§çš„æ³„æ¼ [è‹±] Event Loopï¼ˆé¢è¯•é‡Œæ€»ä¼šæœ‰ä¸€é¢˜ Event Loopâ€¦ï¼‰ï¼š ä» Event Loop è§„èŒƒæ¢ç©¶ JavaScript å¼‚æ­¥åŠæµè§ˆå™¨æ›´æ–°æ¸²æŸ“æ—¶æœº å¼‚æ­¥ä¹‹ Event Loop [è‹±] NodeJS ä¸­çš„ Event Loopã€Timers ä¸ process.nextTick() [è‹±] Tasksã€Microtasksã€Queues ä¸Schedules [è‹±] Web Workers åŠå…¶5ä¸ªå¸¸è§ä½¿ç”¨åœºæ™¯ [è‹±] å¦‚ä½•é¿å… async/await åœ°ç‹± [è‹±] â€œå›è°ƒåœ°ç‹±â€çš„è§£å†³æ€è·¯æ±‡æ€» 1.2. CSS You-Need-to-Know-CSS CSSå¸ƒå±€æŒ‡å— CSS ä¸­çš„å„ç±»æ¢è¡Œå¤„ç†æ–¹å¼ [è‹±]ï¼šå¤„ç†ç»å…¸çš„æ¢è¡Œé—®é¢˜ æµè§ˆå™¨å°†remè½¬æˆpxæ—¶æœ‰ç²¾åº¦è¯¯å·®æ€ä¹ˆåŠï¼Ÿ ç²¾å‡†æ“æ§çš„æ»šåŠ¨ä½“éªŒï¼Œæµ…è°ˆæ–°æ ‡å‡† Scroll Snap å¦‚ä½•å®Œç¾å®ç°ä¸€ä¸ªébuttonå…ƒç´ çš„æŒ‰é’® [è‹±] å·§ç”¨ CSS Grid æ¥åˆ›å»ºæ¨ªå‘æ»šåŠ¨å®¹å™¨ [è‹±] å¦‚ä½•å¤„ç†å†…è”å…ƒç´ ä¸­çš„ç©ºéš™ [è‹±] CSS Stacking Context é‡Œé‚£äº›é²œä¸ºäººçŸ¥çš„å‘ åœ¨ (S)CSS ä¸­å®ç°ä¸»é¢˜åŠŸèƒ½çš„ 4Â½ ç§æ–¹æ³• 1.3. æµè§ˆå™¨ æµè§ˆå™¨çš„å·¥ä½œåŸç† ç°ä»£æµè§ˆå™¨å†…éƒ¨æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼š Chromeæµè§ˆå™¨æ¦‚è§ˆ æµè§ˆæ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ æ¸²æŸ“è¿›ç¨‹çš„å†…éƒ¨å·¥ä½œåŸç† compositoræ˜¯å¦‚ä½•æ¥æé«˜äº¤äº’æ€§èƒ½çš„ï¼Ÿ å®Œæ•´çš„é¡µé¢ç”Ÿå‘½å‘¨æœŸ API ä»‹ç» [è‹±] å››ä¸ªæ–°çš„è§‚å¯Ÿè€…ï¼šIntersection / Mutation / Resize / Performance (Observer) æ¸²æŸ“å¼•æ“å·¥ä½œæ–¹å¼åŠä¼˜åŒ–å»ºè®® [è‹±] æµè§ˆå™¨å†…æ ¸æ¸²æŸ“ï¼šé‡å»ºå¼•æ“ è·¨åŸŸè§£å†³æ–¹æ¡ˆæ±‡æ€» 2. å·¥ç¨‹åŒ–ä¸å·¥å…· è½¯ä»¶è§„æ¨¡çš„æ‰©å¤§å¸¦æ¥äº†å·¥ç¨‹åŒ–çš„éœ€æ±‚ï¼Œå‰ç«¯ä¹Ÿä¸ä¾‹å¤–ã€‚éšç€ NodeJS çš„å‡ºç°ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ JS å¿«é€Ÿå¼€å‘æ‰€éœ€çš„å·¥å…·ã€‚å·¥å…·é“¾ç”Ÿæ€çš„ç¹è£ä¹Ÿæ˜¯å‰ç«¯åœˆç¹è£çš„ä¸€ä¸ªå†™ç…§ã€‚ 2.1. webpack webpack ä¸­çš„ Chunk å…³ç³»å›¾ç®—æ³• [è‹±] webpack è¿›é˜¶ç³»åˆ—æ–‡ç«  ç¼–è¯‘ä¼˜åŒ–ï¼š å¦‚ä½•æå‡å¤§å‹é¡¹ç›®ä¸­ webpack çš„æ€§èƒ½ ğŸ¥ [è‹±] è¿è¡Œæ—¶ä¼˜åŒ–ï¼šSeparating a Manifest [è‹±] åœ¨ webpack ä¸­ä½¿ç”¨ \\&lt;link rel=â€prefetch/preloadâ€&gt; [è‹±] å¦‚ä½•æ›´å¥½ä½¿ç”¨ webpack tree-shaking å…³äº webpack ç¼–è¯‘ç¼“å­˜çš„è®¨è®ºï¼š mzgoddardâ€™s comment [spec: webpack 5] - A module disk cache between build processes 2.2. Gulp Gulp 4 ç®€ä»‹ [è‹±] åŸºäºGulpçš„å¤šé¡µé¢åº”ç”¨å®è·µæŒ‡å— 2.3. Linter JS Linter è¿›åŒ–å² ä¸ºä½•è¦åœ¨é¡¹ç›®æ±‡æ€»ä½¿ç”¨ ESLint [è‹±] 2.4. é™æ€ç±»å‹ï¼ˆTypescript/Flowï¼‰ Typescript æ€»ä½“æ¶æ„ [è‹±] ä¸ºä»€ä¹ˆè¦åœ¨ JavaScript ä¸­è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥ï¼š ç¬¬ä¸€éƒ¨åˆ† ç¬¬äºŒã€ä¸‰éƒ¨åˆ† ç¬¬å››éƒ¨åˆ† 2.5. Babel Babel ç”¨æˆ·æ‰‹å†Œ Babel æ’ä»¶æ‰‹å†Œ 2.6. CSSé¢„å¤„ç†ä¸æ¨¡å—åŒ– CSS è¿›åŒ–å² [è‹±] CSS æ¨¡å—åŒ–æ–¹æ¡ˆç³»åˆ— 3. æ€§èƒ½ä¼˜åŒ– æ€§èƒ½ä¼˜åŒ–å…¶å®å°±æ˜¯åœ¨ç†è§£æµè§ˆå™¨çš„åŸºç¡€ä¸Šâ€œå› åœ°åˆ¶å®œâ€ï¼Œå› æ­¤å¯ä»¥é…åˆ1.3èŠ‚â€œæµè§ˆå™¨â€éƒ¨åˆ†è¿›è¡Œç†è§£ã€‚ å¼ºçƒˆæ¨èæŠŠ Google Web ä¸Šæ€§èƒ½ä¼˜åŒ– Tab ä¸­çš„æ–‡ç« éƒ½é€šè¯»ä¸€éï¼Œå…¶åŸºæœ¬æ¶µç›–äº†ç°ä»£æµè§ˆå™¨ä¸­æ€§èƒ½ä¼˜åŒ–çš„æ‰€æœ‰ç‚¹ï¼Œéå¸¸ç³»ç»Ÿã€‚ä¸‹é¢ä¹Ÿæ‘˜å½•äº†å…¶ä¸­ä¸€äº›ä¸ªäººè®¤ä¸ºéå¸¸ä¸é”™çš„ç¯‡å¹…ã€‚ 3.1. åŠ è½½æ€§èƒ½ PRPL æ¨¡å¼ [è‹±] å›¾ç‰‡æ‡’åŠ è½½å®Œå…¨æŒ‡å— [è‹±] ä½¿ç”¨ Intersection Observer æ¥æ‡’åŠ è½½å›¾ç‰‡ [è‹±] å›¾ç‰‡ä¸è§†é¢‘æ‡’åŠ è½½çš„è¯¦ç»†æŒ‡å— [è‹±] ä½¿ç”¨ Application Shell æ¶æ„æ¥å®ç°ç§’å¼€åº”ç”¨ [è‹±] 3.2. è¿è¡Œæ—¶æ€§èƒ½ é¿å…å¤§å‹ã€å¤æ‚çš„å¸ƒå±€å’Œå¸ƒå±€æŠ–åŠ¨ [è‹±] ä»€ä¹ˆå¯¼è‡´å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼ˆreflowï¼‰ï¼Ÿ [è‹±] å¦‚ä½•è¯Šæ–­å¼ºåˆ¶åŒæ­¥å¸ƒå±€ [è‹±] æ— çº¿æ€§èƒ½ä¼˜åŒ–ï¼šComposite å¦‚ä½•ä¸æ‹©æ‰‹æ®µæå‡scrolläº‹ä»¶çš„æ€§èƒ½ ä½¿ç”¨ passive event listener æ¥æé«˜æ»šåŠ¨æµç•…æ€§ [è‹±] èŠ‚æµå’Œå»æŠ–ï¼ˆthrottle &amp; debounceï¼‰ï¼š JavaScript å‡½æ•°èŠ‚æµå’Œå‡½æ•°å»æŠ–åº”ç”¨åœºæ™¯è¾¨æ underscore å‡½æ•°å»æŠ–çš„å®ç° requestIdleCallback - ä¸€ä¸ªå¼ºå¤§è€Œç¥å™¨çš„ APIï¼š requestIdleCallbackä½¿ç”¨å…¥é—¨ [è‹±] Idle Until Urgent [è‹±]ï¼šrequestIdleCallbackçš„å¦™ç”¨ 3.3. å‰ç«¯ç¼“å­˜ Web ç¼“å­˜ç®€ä»‹ï¼šä»¥è´­ä¹°ç‰›å¥¶çš„ä¸ºä¾‹ [è‹±] å¤§è¯å‰ç«¯ç¼“å­˜ [è‹±] ç¼“å­˜ï¼ˆä¸€ï¼‰â€”â€” ç¼“å­˜æ€»è§ˆï¼šä»æ€§èƒ½ä¼˜åŒ–çš„è§’åº¦çœ‹ç¼“å­˜ ç¼“å­˜ï¼ˆäºŒï¼‰â€”â€” æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ï¼šå¼ºç¼“å­˜ã€åå•†ç¼“å­˜ ç¼“å­˜ï¼ˆä¸‰ï¼‰â€”â€” æ•°æ®å­˜å‚¨ï¼šcookieã€Storageã€indexedDB 3.4. æ€§èƒ½è°ƒè¯•ä¸å®è·µ ä½¿ç”¨ Chrome DevTools æå‡é¡µé¢é€Ÿåº¦ [è‹±]ï¼šChrome DevToolså®æ“è®²è§£ äº†è§£ DevTools ä¸­çš„ Resource Timing æ·˜å®æ–°åŠ¿åŠ›å‘¨H5æ€§èƒ½ä¼˜åŒ–å®æˆ˜ ä¼˜åŒ–æ‰“åŒ…ç­–ç•¥æ¥æå‡é¡µé¢åŠ è½½é€Ÿåº¦ Chrome DevTools ä¸­ä½ å¯èƒ½ä¸çŸ¥é“çš„è°ƒè¯•æŠ€å·§ å‰ç«¯æ€§èƒ½æµ‹é‡ [è‹±] 3.5. æ€§èƒ½æŒ‡æ ‡ ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„å‰ç«¯æ€§èƒ½æŒ‡æ ‡ [è‹±]ï¼šå‰ç«¯æ€§èƒ½æŒ‡æ ‡çš„æ¥é¾™å»è„‰ DOMContentLoaded: ä½ ä¸çŸ¥é“çš„ DOMContentLoaded Deciphering the Critical Rendering Path [è‹±] FP (First Paint)ï¼š Chromeçš„First Paint FCP (First Contentful Paint)ï¼š First Contentful Paint Explained [è‹±] First Contentful Paint [è‹±] FMP (First Meaningful Paint)ï¼š Chrome ä¸­çš„ First Meaningful Paint Time to First Meaningful Paint TTI (Time to interactive)ï¼š Time to Interactive Explainer è¡¡é‡ç”¨æˆ·ä½“éªŒçš„æ–°æ ‡å‡† TTFB (Time To First Byte)ï¼š TTFBï¼Œä»¥åŠé¡µé¢åŠ è½½çš„æ—¶é—´èŠ‚ç‚¹ FID (First Input Delay)ï¼š First Input Delay Speed Indexï¼š WebPagetest: Speed Index 4. å®‰å…¨ å¾ˆå¤šå®‰å…¨é£é™©è€ç”Ÿå¸¸è°ˆï¼Œä½†æ˜¯å¾€å¾€åˆ°å‡ºç°é—®é¢˜æ—¶ï¼Œæ‰ä¼šè¢«é‡è§†æˆ–è€…æ„è¯†åˆ°ã€‚ 8å¤§å‰ç«¯å®‰å…¨é—®é¢˜ä¸Šç¯‡ 8å¤§å‰ç«¯å®‰å…¨é—®é¢˜ä¸‹ç¯‡ æ¦‚å¿µè®²è§£ï¼šç¼–ç ã€åŠ å¯†ã€å“ˆå¸Œä¸æ··æ·† [è‹±] å¸¸è§ Web å®‰å…¨æ”»é˜²æ€»ç»“ 4.1. XSS å¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ 4.2. CSRF å¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ Site Isolation [è‹±]ï¼šChromeçš„æ–°ç‰¹æ€§ 4.3. CSP Content Security Policy å…¥é—¨æ•™ç¨‹ Content Security Policy (CSP) [è‹±] 4.4. HTTPS å›¾æ–‡è¿˜åŸ HTTPS åŸç† æµ…è°ˆæœ‰èµå…¨ç«™ HTTPS æ¨è¿› 4.5. å®‰å…¨å®å½• About rel=noopener [è‹±]ï¼šæ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢æ˜¯å¦‚ä½•å¸¦æ¥å®‰å…¨éšæ‚£çš„ ä¸€ç§æ–°å‹çš„â€œé’“é±¼â€æ–¹å¼ [è‹±] ä¸€ä¸ªåª’ä½“æ–‡ä»¶è¯·æ±‚å¼•å‘çš„è·¨ç«™é£é™© [è‹±] Mitigating Spectre [è‹±]ï¼š Chrome ä¸­çš„è·¨ç«™å®‰å…¨é—®é¢˜ 5. è‡ªåŠ¨åŒ–æµ‹è¯• è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯è½¯ä»¶å·¥ç¨‹çš„é‡è¦éƒ¨åˆ†ä¹‹ä¸€ï¼Œä½†å´æå®¹æ˜“è¢«å¿½è§†ã€‚ 2018 å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ç»¼è¿° [è‹±] æµ‹è¯•ä½ çš„å‰ç«¯ä»£ç ï¼ˆä»‹ç»ç¯‡ï¼‰[è‹±] 5.1. å•å…ƒæµ‹è¯• æµ‹è¯•ä½ çš„å‰ç«¯ä»£ç ï¼ˆå•å…ƒæµ‹è¯•ç¯‡ï¼‰[è‹±] Fakesã€Mocks ä»¥åŠ Stubs æ¦‚å¿µæ˜æ™° æµ‹è¯•è¦†ç›–ï¼ˆç‡ï¼‰åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ 5.2. ç«¯åˆ°ç«¯æµ‹è¯• (E2E) æµ‹è¯•ä½ çš„å‰ç«¯ä»£ç ï¼ˆE2E æµ‹è¯•ç¯‡ï¼‰[è‹±] ä»€ä¹ˆæ˜¯ä¸€ä¸ªå¥½çš„ E2E æµ‹è¯•ï¼Ÿ[è‹±] å¹³è¡¡å•å…ƒæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯• å¯¹è¿‡å¤šçš„ E2E æµ‹è¯•è¯´â€œä¸â€ [è‹±] 5.3. å…¶ä»– æµ‹è¯•ä½ çš„å‰ç«¯ä»£ç ï¼ˆé›†æˆæµ‹è¯•ç¯‡ï¼‰[è‹±] æµ‹è¯•ä½ çš„å‰ç«¯ä»£ç ï¼ˆå¯è§†åŒ–æµ‹è¯•ç¯‡ï¼‰[è‹±] 6. æ¡†æ¶ä¸ç±»åº“ å¦‚æœè¯´åŸºç¡€çŸ¥è¯†æ˜¯é“ï¼Œé‚£æ¡†æ¶ä¸å·¥å…·å¯èƒ½å°±æ˜¯æœ¯ï¼›å­¦ä¹ ä¸ç†è§£å®ƒä»¬ï¼Œä½†åƒä¸‡ä¸è¦æˆä¸ºå®ƒä»¬çš„å¥´éš¶ã€‚ 6.1. React React åº•å±‚æ­ç§˜ [è‹±] ä½ æ‰€éœ€è¦çŸ¥é“çš„ React ç»†èŠ‚ React Fiber æ¶æ„ React 16 Fiber æºç é€Ÿè§ˆ React æ˜¯æ€æ ·ç‚¼æˆçš„ï¼šReactæ—©æœŸçš„è¿›åŒ–ä¹‹è·¯ ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªReactï¼š 1. JSXå’Œè™šæ‹ŸDOM 2. ç»„ä»¶å’Œç”Ÿå‘½å‘¨æœŸ 3. diffç®—æ³• 4. å¼‚æ­¥çš„setState ã€ŒreactæŠ€æœ¯æ ˆã€å•é¡µåº”ç”¨å®è·µå¿«é€Ÿå…¥é—¨ React ç”Ÿå‘½å‘¨æœŸå›¾ç¤º 6.2. Vue æ·±å…¥æµ…å‡º - vueå˜åŒ–ä¾¦æµ‹åŸç† Vue æ¨¡æ¿ç¼–è¯‘åŸç† 6.3. Redux é‡æ–°è®¾è®¡ Redux [è‹±]ï¼šRematch å¦‚ä½•ç”¨ GraphQL æ¥æ›¿ä»£ Redux [è‹±] è§£è¯» Redux çš„è®¾è®¡æ€è·¯ä¸ç”¨æ³• (Redux)åº”ç”¨æ„å»ºçš„ä¸‰ä¸ªåŸåˆ™ [è‹±] 6.4. RxJS ReactiveX å®˜ç½‘ï¼šå®çŸ³å›¾çœŸçš„éå¸¸å½¢è±¡æ˜“è¯» å“åº”å¼ç¼–ç¨‹ï¼Œæ˜¯æ˜æ™ºçš„é€‰æ‹© å›¾è§£RxJS [è‹±] è°ƒè¯•RxJSï¼šTooling [è‹±] è°ƒè¯•RxJSï¼šLogging [è‹±] 7. æ–°æŠ€æœ¯/æ–¹å‘ å‰ç«¯é¢†åŸŸæ–°æŠ€æœ¯ã€æ–°æ–¹å‘å±‚å‡ºä¸ç©·ï¼Œè¿™é‡Œæ±‡æ€»ä¸€äº›æ–°æŠ€æœ¯æ–¹å‘ï¼›ä½œä¸ºå¼€å‘è€…éœ€è¦å¤šäº†è§£ä½†æ˜¯ä¸è¦ç›²ä» 7.1. PWA PWA å­¦ä¹ ä¸å®è·µç³»åˆ— Service Worker å…¥é—¨ç®€ä»‹ [è‹±] PWA åœ¨ iOS å¹³å°ä¸Šçš„ç‰¹æ®Šé—®é¢˜ [è‹±] åœ¨ä½ çš„ PWA ä¸­å°å¿ƒä½¿ç”¨ iOS çš„ meta æ ‡ç­¾ [è‹±] é¥¿äº†ä¹ˆçš„ PWA å‡çº§å®è·µ ç¦»çº¿æŒ‡å— Android ä¸­çš„ WebAPKs [è‹±] Pinterest çš„ PWA å®è·µ [è‹±] å¼‚æ­¥ HTTP Cookies API [è‹±]ï¼šèµ‹èƒ½Service Worker 7.2. CSS Houdini è®¤è¯† Houdini ä¸ CSS Paint API [è‹±] ç”¨ Houdini æ¥æ‹¯æ•‘ CSS Polyfill [è‹±] 7.3. Web Components Web Components åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³• Web Components æŒ‡å— [è‹±] Shadow DOM ä½¿ç”¨ç®€ä»‹ HTMLUnknownElement ä¸ HTML5 è‡ªå®šä¹‰å…ƒç´ çš„æ•…äº‹ 7.4. å¾®å‰ç«¯ï¼ˆMicro Frontendsï¼‰ å¾®å‰ç«¯ä¸»é¡µ [è‹±] å¾®å‰ç«¯çš„é‚£äº›äº‹å„¿ æŠ€æœ¯é›·è¾¾ä¹‹ã€Œå¾®å‰ç«¯ã€- å°†å¾®æœåŠ¡ç†å¿µæ‰©å±•åˆ°å‰ç«¯å¼€å‘ 7.5. HTTP/2 HTTP/2 å¹•ååŸç† å…¨é¢ä»‹ç»çš„ HTTP/2 [è‹±] HTTP/2 ä¸»é¡µ: HTTP/2 åè®® [è‹±] HPACK: HTTP/2 Headerå‹ç¼© [è‹±] 7.6. WebAssembly WebAssembly å®˜ç½‘ WebAssembly ç°çŠ¶ä¸å®æˆ˜ WebAssembly ç³»åˆ—ï¼š ä¸€ã€ç”ŸåŠ¨å½¢è±¡åœ°ä»‹ç» WebAssembly äºŒã€JavaScript Just-in-time (JIT) å·¥ä½œåŸç† ä¸‰ã€ç¼–è¯‘å™¨å¦‚ä½•ç”Ÿæˆæ±‡ç¼– å››ã€WebAssembly å·¥ä½œåŸç† äº”ã€ä¸ºä»€ä¹ˆ WebAssembly æ›´å¿«ï¼Ÿ å…­ã€WebAssembly çš„ç°åœ¨ä¸æœªæ¥ 8. ä¸šåŠ¡ç›¸å…³ åœ¨ä¸šåŠ¡ä¸­å¾€å¾€è¿˜æœ‰ä¸€äº›ä¸â€œä¸šåŠ¡æ— å…³â€çš„åœºæ™¯éœ€æ±‚ â€”â€” ä¸è®ºæ˜¯ä»€ä¹ˆä¸šåŠ¡å‡ ä¹éƒ½ä¼šé‡åˆ°ï¼›å› æ­¤ï¼Œåœ¨å˜ä¸ä¸å˜ä¸­ï¼Œæˆ‘ä»¬æ›´éœ€è¦å»æŠ½è±¡å‡ºè¿™äº›é—®é¢˜ã€‚ 8.1. æ•°æ®æ‰“ç‚¹ä¸ŠæŠ¥ å¦‚ä½•ç²¾ç¡®ç»Ÿè®¡é¡µé¢åœç•™æ—¶é•¿ æ­å¼€JSæ— åŸ‹ç‚¹æŠ€æœ¯çš„ç¥ç§˜é¢çº± 8.2. å‰ç«¯ç›‘æ§ å‰ç«¯å¼‚å¸¸ç›‘æ§è§£å†³æ–¹æ¡ˆç ”ç©¶ ç›‘æ§å¹³å°å‰ç«¯SDKå¼€å‘å®è·µ æŠŠå‰ç«¯ç›‘æ§åšåˆ°æè‡´ å‰ç«¯ç›‘æ§ç³»ç»Ÿæ¢ç´¢æ€»ç»“ 8.3. A/Bæµ‹è¯• Twitterçš„A/Bæµ‹è¯•å®è·µï¼š ä¸€ã€ä¸ºä»€ä¹ˆè¦æµ‹è¯•ä»¥åŠæµ‹è¯•çš„æ„ä¹‰ äºŒã€æŠ€æœ¯æ¦‚è¿° ä¸‰ã€æ£€æµ‹å’Œé¿å… A/B Testä¸­ bucketä¸å¹³è¡¡é—®é¢˜ å››ã€A/B Testä¸­ä½¿ç”¨å¤šä¸ªæ§åˆ¶çš„å¯ç¤º Netflix A/B Test å®éªŒå¹³å°å®è·µ [è‹±] æŒ‡å¯¼æ–¹æ³• å®éªŒä¸­å®¹æ˜“é‡åˆ°çš„ä¸ƒç§é—®é¢˜ [è‹±] å®éªŒçš„ä¸ƒä¸ªå‡†åˆ™ [è‹±] å°æµé‡å¦‚ä½•è¿›è¡ŒABæµ‹è¯• æ¡ˆä¾‹åˆ†äº« å¤§ä¼—ç‚¹è¯„ABæµ‹è¯•æ¡†æ¶Gemini æ–°æµªæ–°é—»å®¢æˆ·ç«¯ABæµ‹è¯•ä¸ç°åº¦å‘å¸ƒ å¤©çŒ«App A/Bæµ‹è¯•å®è·µ å·¥å…· ABæµ‹è¯•æ ·æœ¬æ•°é‡è®¡ç®—å™¨ ABæµ‹è¯•ç»“æœæœ‰æ•ˆæ€§åˆ†æå·¥å…· 8.4. â€œæœåŠ¡ç«¯æ¨â€ å„ç±»â€œæœåŠ¡å™¨æ¨â€æŠ€æœ¯åŸç†ä¸å®ä¾‹ é•¿è¿æ¥/websocket/SSEç­‰ä¸»æµæœåŠ¡å™¨æ¨é€æŠ€æœ¯æ¯”è¾ƒ Cometï¼šåŸºäº HTTP é•¿è¿æ¥çš„â€œæœåŠ¡å™¨æ¨â€æŠ€æœ¯ æ·±å…¥ WebSocketsã€HTTP/2 SSE [è‹±] WebSocket åº”ç”¨å®‰å…¨é—®é¢˜åˆ†æ 8.5. åŠ¨æ•ˆ åŠ¨ç”»è®¾è®¡çš„12ä¸ªåŸåˆ™ğŸ¥ [è‹±] è´å¡å°”æ›²çº¿æ‰«ç›² åŠ¨ç”»ï¼šä» AE åˆ° Web æœ€å…¨æœ€å¥½ç”¨çš„åŠ¨æ•ˆè½åœ°æ–¹æ³•ï¼š åŸºç¡€çŸ¥è¯† è½åœ°æ–¹å¼ 9. ä¸å½’ç±»çš„å¥½æ–‡ å¼€å·æœ‰ç›Šã€‚ Recursion? We donâ€™t need no stinking recursion!ï¼šå¦‚ä½•å°†ä¸€äº›é€’å½’æ”¹ä¸ºå¾ªç¯ï¼ˆå°¾é€’å½’ä¼˜åŒ–ï¼‰ Turning your web traffic into a Super Computerï¼šé€šè¿‡ Web Worker å’Œ WebSocket æ¥å°†å…¨ä¸–ç•Œçš„ç”µè„‘è¿æ¥æˆè¶…çº§è®¡ç®—æœº Designing very large (JavaScript) applicationsï¼šé«˜å±‹å»ºç“´ï¼Œé€‚åˆé˜…è¯»ä¸æ€è€ƒ","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"GitHubç²¾é€‰","slug":"å‰ç«¯/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/GitHubç²¾é€‰/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"github","slug":"github","permalink":"https://jigangduan.github.io/tags/github/"}]},{"title":"Android å‘æ—¥è‘µ","slug":"android-sunflower","date":"2018-12-23T13:22:33.000Z","updated":"2020-07-25T02:57:18.172Z","comments":true,"path":"2018/12/23/android-sunflower/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/android-sunflower/","excerpt":"","text":"ä¸€ä¸ªå›­è‰ºåº”ç”¨ç¨‹åºè¯´æ˜Androidå¼€å‘æœ€ä½³å®è·µä¸Android Jetpack. Android å‘æ—¥è‘µ (alpha)Androidå‘æ—¥è‘µç›®å‰æ˜¯ä½œä¸ºä¸€ä¸ªalphaç‰ˆæœ¬å‘å¸ƒçš„ï¼Œæ­£åœ¨è¿›è¡Œå¤§é‡çš„å¼€å‘ã€‚è¦æŸ¥çœ‹æœ€æ–°çš„æ›´æ”¹ï¼Œè¯·è®¿é—®ç‰ˆæœ¬é¡µé¢.è¯·æ³¨æ„ï¼Œä¸€äº›æ›´æ”¹(å¦‚æ•°æ®åº“æ¨¡å¼ä¿®æ”¹)åœ¨æ­¤alphaæœŸé—´ä¸å‘åå…¼å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·å¸è½½å¹¶é‡æ–°å®‰è£…åº”ç”¨ç¨‹åº. ä»‹ç»Android Jetpackæ˜¯ä¸€å¥—ç»„ä»¶ã€å·¥å…·å’ŒæŒ‡å—ï¼Œç”¨æ¥åˆ¶ä½œä¼˜ç§€çš„Androidåº”ç”¨ç¨‹åºã€‚å®ƒä»¬å°†ç°æœ‰çš„æ”¯æŒåº“å’Œä½“ç³»ç»“æ„ç»„ä»¶ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶å°†å®ƒä»¬åˆ†ä¸ºå››ç±»: Androidå‘æ—¥è‘µæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™äº›ç»„ä»¶åˆ›å»ºä¸€ä¸ªç®€å•çš„å›­è‰ºåº”ç”¨ç¨‹åºã€‚é˜…è¯»Androidå‘æ—¥è‘µçš„ä»‹ç»æ–‡ç« ï¼Œäº†è§£ä¸€ä¸‹è¿™æ¬¾åº”ç”¨ç¨‹åºã€‚ å¼€å§‹è¿™ä¸ªé¡¹ç›®ä½¿ç”¨å±‚çº§æ„å»ºç³»ç»Ÿã€‚è¦æ„å»ºæ­¤é¡¹ç›®ï¼Œè¯·ä½¿ç”¨gradlew buildå‘½ä»¤æˆ–åœ¨Android Studioä¸­ä½¿ç”¨Import project æµ‹è¯•é¡¹ç›®æœ‰ä¸¤ä¸ªç­‰çº§çš„ä»»åŠ¡:: connectedAndroidTest - ç”¨äºåœ¨è¿æ¥è®¾å¤‡ä¸Šè¿è¡ŒEspresso test - ç”¨äºè¿è¡Œå•å…ƒæµ‹è¯• æœ‰å…³å­¦ä¹ Androidå¼€å‘çš„æ›´å¤šèµ„æºï¼Œè¯·è®¿é—®developer.android.comçš„å¼€å‘è€…æŒ‡å—ã€‚ æˆªå›¾ åº“çš„ä½¿ç”¨ Foundation - æ ¸å¿ƒç³»ç»ŸåŠŸèƒ½çš„ç»„ä»¶ï¼ŒKotlinæ‰©å±•å’Œå¯¹multidexå’Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ”¯æŒ. AppCompat - åœ¨æ—§ç‰ˆæœ¬çš„Androidä¸Šå¯ä»¥ä¼˜é›…åœ°é™çº§. Android KTX - ç¼–å†™æ›´ç®€æ´ã€æ›´ç¬¦åˆä¹ æƒ¯çš„Kotlinä»£ç . Test - ä¸€ä¸ªç”¨äºå•å…ƒå’Œè¿è¡Œæ—¶UIæµ‹è¯•çš„Androidæµ‹è¯•æ¡†æ¶. ä½“ç³»ç»“æ„ - ä¸€ç»„åº“ï¼Œå¸®åŠ©æ‚¨è®¾è®¡å¥å£®ã€å¯æµ‹è¯•å’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚ä»ç®¡ç†UIç»„ä»¶ç”Ÿå‘½å‘¨æœŸå’Œå¤„ç†æ•°æ®æŒä¹…æ€§çš„ç±»å¼€å§‹. Data Binding - å£°æ˜å¼åœ°å°†å¯è§‚å¯Ÿæ•°æ®ç»‘å®šåˆ°UIå…ƒç´ . Lifecycles - åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„UI. LiveData - æ„å»ºåœ¨åº•å±‚æ•°æ®åº“æ›´æ”¹æ—¶é€šçŸ¥è§†å›¾çš„æ•°æ®å¯¹è±¡. Navigation - å¤„ç†åº”ç”¨ç¨‹åºå†…å¯¼èˆªæ‰€éœ€çš„ä¸€åˆ‡. Room - ä½¿ç”¨åº”ç”¨ç¨‹åºå†…å¯¹è±¡å’Œç¼–è¯‘æ—¶æ£€æŸ¥è®¿é—®åº”ç”¨ç¨‹åºçš„SQLiteæ•°æ®åº“. ViewModel - å­˜å‚¨åº”ç”¨ç¨‹åºæ—‹è½¬æ—¶æœªé”€æ¯çš„uiç›¸å…³æ•°æ®ã€‚è½»æ¾åœ°ä¸ºæœ€ä¼˜æ‰§è¡Œè®¡åˆ’å¼‚æ­¥ä»»åŠ¡. WorkManager - ç®¡ç†ä½ çš„Androidåå°ä½œä¸š. UI - è¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆå’Œå¦‚ä½•åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨UIç»„ä»¶ - ä¸€èµ·æˆ–åˆ†å¼€ Animations &amp; Transitions - ç§»åŠ¨å°éƒ¨ä»¶å¹¶åœ¨å±å¹•ä¹‹é—´è½¬æ¢. Fragment - å¯ç»„åˆUIçš„åŸºæœ¬å•å…ƒ. Layout - ä½¿ç”¨ä¸åŒçš„ç®—æ³•æ¥å¸ƒç½®å°éƒ¨ä»¶. ç¬¬ä¸‰æ–¹ Glide åŠ è½½å›¾ç‰‡ Kotlin Coroutines ç”¨äºä»¥ç®€åŒ–çš„ä»£ç ç®¡ç†åå°çº¿ç¨‹å¹¶å‡å°‘å¯¹å›è°ƒçš„éœ€æ±‚ å³å°†åˆ°æ¥çš„æ–°ç‰¹æ€§éšç€ç»„ä»¶åº“çš„å‘å±•ï¼Œæ›´æ–°å°†åŒ…æ‹¬åˆå¹¶å…¶ä»–Jetpackç»„ä»¶å’Œæ›´æ–°ç°æœ‰ç»„ä»¶. æœ‰å…´è¶£çœ‹çœ‹åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­å®ç°çš„Androidæ¡†æ¶æˆ–Jetpackçš„ä¸€ä¸ªç‰¹å®šç‰¹æ€§å—?è¯·ç¿»å¼€æ–°ä¸€æœŸ. Android Studio IDE è®¾ç½®å¼€å‘éœ€è¦æœ€æ–°ç‰ˆæœ¬çš„Android Studio 3.2ã€‚æœ€æ–°ç‰ˆæœ¬å¯ä»¥ä»è¿™é‡Œä¸‹è½½ã€‚ å‘æ—¥è‘µä½¿ç”¨ktlintæ¥æ‰§è¡ŒKotlinç¼–ç æ ·å¼.ä¸‹é¢æ˜¯å¦‚ä½•å°†å…¶é…ç½®ä¸ºä¸Android Studioä¸€èµ·ä½¿ç”¨(æ¥è‡ªktlint READMEçš„è¯´æ˜): å¦‚æœAndroid Studioæ˜¯æ‰“å¼€çš„ï¼Œå…³é—­å®ƒ ä½¿ç”¨è¿™äº›å®‰è£…è¯´æ˜ä¸‹è½½ktlint åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œ: ./ktlint --apply-to-idea-project --android å¯åŠ¨ Android Studio é¢å¤–çš„èµ„æºæŸ¥çœ‹è¿™äº›Wikié¡µé¢ï¼Œäº†è§£æ›´å¤šå…³äºAndroidå‘æ—¥è‘µçš„ä¿¡æ¯: è‘—åçš„ç¤¾åŒºçš„è´¡çŒ® å‡ºç‰ˆç‰© éç›®æ ‡æœ¬é¡¹ç›®çš„é‡ç‚¹æ˜¯Android Jetpackå’ŒAndroidæ¡†æ¶ã€‚å› æ­¤ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–æ²¡æœ‰ç«‹å³å®ç°ç‰¹æ€§çš„è®¡åˆ’ã€‚ å…³äºä¾èµ–æ³¨å…¥çš„æ³¨æ„-è™½ç„¶è®¸å¤šé¡¹ç›®(å¦‚Plaid)ä½¿ç”¨Dagger 2ä½œä¸ºDIï¼Œä½†æ²¡æœ‰è®¡åˆ’å°†DIåˆå¹¶è¿›æ¥è¿™ä½¿å¾—ä¸ç†Ÿæ‚‰ä¾èµ–æ³¨å…¥çš„å¼€å‘äººå‘˜å¯ä»¥æ›´å¥½åœ°ç†è§£å‘æ—¥è‘µçš„ä»£ç ï¼Œè€Œä¸å¿…å­¦ä¹ DI. æ”¯æŒ Google+ ç¤¾åŒº: https://plus.google.com/communities/105153134372062985968 Stack Overflow: http://stackoverflow.com/questions/tagged/android http://stackoverflow.com/questions/tagged/android-jetpack å¦‚æœæ‚¨åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­å‘ç°é”™è¯¯ï¼Œè¯·æäº¤ä¸€ä¸ªé—®é¢˜:https://github.com/googlesamples/android-sunflower/issues æˆ‘ä»¬é¼“åŠ±ä½¿ç”¨è¡¥ä¸ï¼Œå¯ä»¥é€šè¿‡åˆ†å²”è¿™ä¸ªé¡¹ç›®å¹¶é€šè¿‡GitHubæäº¤pullè¯·æ±‚æ¥æäº¤è¡¥ä¸. ç¬¬ä¸‰æ–¹å†…å®¹é€šè¿‡CC BY-SA 3.0 US (license in ASSETS_LICENSE)ä»ç»´åŸºç™¾ç§‘ä¸­é€‰æ‹©ç”¨äºæè¿°æ¤ç‰©çš„æ–‡æœ¬(åœ¨plants.jsonä¸­)","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android Jetpack","slug":"Android/Android-Jetpack","permalink":"https://jigangduan.github.io/categories/Android/Android-Jetpack/"},{"name":"GitHub ç²¾é€‰","slug":"Android/Android-Jetpack/GitHub-ç²¾é€‰","permalink":"https://jigangduan.github.io/categories/Android/Android-Jetpack/GitHub-ç²¾é€‰/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"jetpack","slug":"jetpack","permalink":"https://jigangduan.github.io/tags/jetpack/"}]},{"title":"Kafkaå¹¶ä¸éš¾å­¦ (3) åŸºæœ¬æ“ä½œ","slug":"kafka-easy-3","date":"2018-12-23T07:42:49.000Z","updated":"2020-07-25T02:57:18.211Z","comments":true,"path":"2018/12/23/kafka-easy-3/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/kafka-easy-3/","excerpt":"","text":"Zookeeperçš„ä½œç”¨åŠèƒŒæ™¯ ç®¡ç†ä»£ç ä¸­çš„å˜é‡çš„é…ç½® è®¾ç½®å‘½åæœåŠ¡ æå‡ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§ ç®¡ç†Kafkaé›†ç¾¤ Zookeeperå•æœºæ¨¡å¼å’Œåˆ†å¸ƒå¼æ¨¡å¼å•æœºæ¨¡å¼ zkServer.sh start zkServer.sh status zkServer.sh stop åˆ†å¸ƒå¼æ¨¡å¼ Kafkaå•æœºæ¨¡å¼å’Œåˆ†å¸ƒå¼æ¨¡å¼å¦‚ä½•æ“ä½œä¸»é¢˜ï¼Ÿåˆ›å»ºï¼š 1kafka-topics.sh --create --zookeeper dn1:2181 --replication-factor 1 --partitions 1 --topic test æŸ¥çœ‹ï¼š 1kafka-topics.sh --describe --zookeeper dn1:2181 --topic test ä¿®æ”¹ï¼š 1kafka-topics.sh --alter --zookeeper dn1:2181 test --config max.message.bytes=102400 åˆ é™¤ï¼š 1kafka-topics.sh --delete --zookeeper dn1:2181 test","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"},{"name":"Kafkaå¹¶ä¸éš¾å­¦","slug":"Kafka/Kafkaå¹¶ä¸éš¾å­¦","permalink":"https://jigangduan.github.io/categories/Kafka/Kafkaå¹¶ä¸éš¾å­¦/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"}]},{"title":"Kafkaå¹¶ä¸éš¾å­¦ (2) å®‰è£…å’Œé…ç½®Kafka","slug":"kafka-easy-2","date":"2018-12-23T07:01:52.000Z","updated":"2020-07-25T02:57:18.211Z","comments":true,"path":"2018/12/23/kafka-easy-2/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/kafka-easy-2/","excerpt":"","text":"å®‰è£…JDKJDK Kafkaä¸ºä»€ä¹ˆéœ€è¦JDKKafkaçš„æºç æ˜¯åŸºäºScalaè¯­è¨€ç¼–å†™çš„ï¼Œè¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Š é…ç½®Linuxæ“ä½œç³»ç»Ÿå…å¯†ç ç™»é™†Linuxå…å¯†ç SSH - ä¸“ä¸ºè¿œç¨‹ç™»é™†ä¼šè¯å’Œå…¶å®ƒç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®® Kafkaé›†ç¾¤åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯å„ä¸ªä¸»æœºä¹‹é—´å®ç°å…å¯†ç ã€‚è¿™æ ·åœ¨å¯åŠ¨æ—¶å°±å¯ä»¥é¿å…å»è¾“å…¥å¯†ç ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„éº»çƒ¦ å¦‚ä½•é…ç½®ï¼š åˆ›å»ºå¯†é’¥ è®¤è¯æˆæƒ æ–‡ä»¶èµ‹æƒ åœ¨å…¶å®ƒä¸»æœºä¸Šåˆ›å»ºé’¥å¹¶åŒæ­¥è®¤è¯æ–‡ä»¶ Kafkaå•æœºæ¨¡å¼å’Œåˆ†å¸ƒå¼æ¨¡å¼çš„å®‰è£…æ­¥éª¤åŠæ³¨æ„äº‹é¡¹å•æœºæ¨¡å¼ Zookeeperä»¥å•æœºæ¨¡å¼å¯åŠ¨ ä¸‹è½½Kafkaå®‰è£…åŒ… è§£å‹å¹¶é…ç½® åˆ†å¸ƒå¼æ¨¡å¼ Zookeeperä»¥åˆ†å¸ƒå¼æ¨¡å¼å¯åŠ¨(Leader-Follower) ä¸‹è½½Kafkaå®‰è£…åŒ… è§£å‹å¹¶é…ç½® æ³¨æ„äº‹é¡¹æµ‹è¯•ç¯å¢ƒï¼Œæœ¬åœ°è°ƒè¯•å¯ä»¥ä½¿ç”¨å•æœºæ¨¡å¼ï¼›ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨åˆ†å¸ƒå¼æ¨¡å¼ã€‚åˆ†å¸ƒå¼æ¨¡å¼éƒ¨ç½²Kafkaï¼Œéœ€è¦äºŒæ¬¡å°è£…Kafkaç³»ç»Ÿå¯åŠ¨&amp;åœæ­¢è„šæœ¬ å¦‚ä½•ç¼–è¯‘Kafkaæºä»£ç ï¼Ÿ å®‰è£…ä¸é…ç½®Scalaè¿è¡Œç¯å¢ƒï¼Œå®‰è£…ä¸é…ç½®Gradleé…ç½®å·¥å…· è‹¥ç½‘ç»œçŠ¶æ€ä¸å¥½ï¼Œä¸‹è½½ç¦»çº¿ä¾èµ–åŒ…ï¼›è‹¥ç½‘ç»œçŠ¶æ€è‰¯å¥½ï¼Œå¯ä»¥åœ¨çº¿ç¼–è¯‘ Kafkaå…ƒæ•°æ®ä¿¡æ¯åœ¨Zookeeperæ˜¯å¦‚ä½•åˆ†å¸ƒçš„ï¼Ÿå­˜å‚¨çš„å…ƒæ•°æ®æœ‰ï¼š æ§åˆ¶å™¨é€‰ä¸¾æ¬¡æ•° ä»£ç†èŠ‚ç‚¹ ä¸»é¢˜ é…ç½® ç®¡ç†å‘˜æ“ä½œ æ§åˆ¶å™¨","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"},{"name":"Kafkaå¹¶ä¸éš¾å­¦","slug":"Kafka/Kafkaå¹¶ä¸éš¾å­¦","permalink":"https://jigangduan.github.io/categories/Kafka/Kafkaå¹¶ä¸éš¾å­¦/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"}]},{"title":"Kafkaå¹¶ä¸éš¾å­¦ (1) äº†è§£æ¶ˆæ¯é˜Ÿåˆ—å’ŒKafka","slug":"kafka-easy-1","date":"2018-12-23T06:40:49.000Z","updated":"2020-07-25T02:57:18.211Z","comments":true,"path":"2018/12/23/kafka-easy-1/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/kafka-easy-1/","excerpt":"","text":"ä»€ä¹ˆäº‹æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿå¦‚ä½•ç†è§£æ¶ˆæ¯é˜Ÿåˆ—çš„æ¦‚å¿µï¼Ÿ MQï¼Œæ‹¥æœ‰å…ˆè¿›å…ˆå‡º(FIFO)çš„ç‰¹æ€§ å¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼ŒåŒ…å«è¯¦ç»†çš„æ•°æ®è¯´æ˜ ä½œç”¨: åº”ç”¨è§£è€¦ å¼‚æ­¥å¤„ç† æ•°æ®é™æµ æ¶ˆæ¯é€šä¿¡ Kafkaçš„åŸºæœ¬æ¦‚å¿µ ä»£ç† Broker ç”Ÿäº§è€… Producer æ¶ˆè´¹è€… Consumer æ¶ˆè´¹è€…ç»„ Consumer Group Topic ä¸»é¢˜ Partition åˆ†åŒº Replication å‰¯æœ¬ Record è®°å½• kafka ä½¿ç”¨èŒƒå›´è®¾è®¡åˆè¡· é«˜ååé‡ é«˜å¯ç”¨é˜Ÿåˆ— ä½å»¶æ—¶ åˆ†å¸ƒå¼æœºåˆ¶ ç‰¹æ€§ å¼‚æ­¥ç”Ÿäº§æ•°æ® åç§»é‡è¿ç§» å®‰å…¨æœºåˆ¶ è¿æ¥å™¨ æœºæ¶æ„ŸçŸ¥ æ•°æ®æµ æ—¶é—´æˆ³ æ¶ˆæ¯è¯­ä¹‰ åœºæ™¯ æ—¥å¿—æ”¶é›† æ¶ˆæ¯ç³»ç»Ÿ ç”¨æˆ·è½¨è¿¹ è®°å½•è¿è¥ç›‘æ§æ•°æ® å®ç°æµå¤„ç† äº‹ä»¶æº","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"},{"name":"Kafkaå¹¶ä¸éš¾å­¦","slug":"Kafka/Kafkaå¹¶ä¸éš¾å­¦","permalink":"https://jigangduan.github.io/categories/Kafka/Kafkaå¹¶ä¸éš¾å­¦/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"}]},{"title":"Leaflet(äº¤äº’å¼åœ°å›¾JSåº“)","slug":"leafletjs","date":"2018-12-23T03:43:32.000Z","updated":"2020-07-25T02:57:18.212Z","comments":true,"path":"2018/12/23/leafletjs/","link":"","permalink":"https://jigangduan.github.io/2018/12/23/leafletjs/","excerpt":"","text":"ç”¨äºç§»åŠ¨å‹å¥½äº¤äº’å¼åœ°å›¾çš„JavaScriptåº“. https://leafletjs.com Leafletæ˜¯é¢†å…ˆçš„å¼€æºJavaScriptåº“ï¼Œå¯ç”¨äºç§»åŠ¨å‹å¥½çš„äº¤äº’å¼åœ°å›¾ã€‚å®ƒä»…é‡çº¦37kbçš„gzippedä»£ç ï¼Œå…·æœ‰å¤§å¤šæ•°å¼€å‘äººå‘˜æ‰€éœ€è¦çš„æ‰€æœ‰æ˜ å°„ç‰¹æ€§ã€‚ ä¼ å•çš„è®¾è®¡å…·æœ‰ç®€å•æ€§ã€æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ƒå¯ä»¥åœ¨æ‰€æœ‰ä¸»è¦çš„æ¡Œé¢å’Œç§»åŠ¨å¹³å°ä¸Šé«˜æ•ˆåœ°å·¥ä½œï¼Œå……åˆ†åˆ©ç”¨HTML5å’ŒCSS3åœ¨ç°ä»£æµè§ˆå™¨ä¸Šçš„ä¼˜åŠ¿ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨æ—§çš„æµè§ˆå™¨ä¸Šè®¿é—®ã€‚å®ƒå¯ä»¥é€šè¿‡å¤§é‡æ’ä»¶è¿›è¡Œæ‰©å±•ï¼Œå…·æœ‰æ¼‚äº®çš„ã€æ˜“äºä½¿ç”¨çš„ã€æ–‡æ¡£ä¸°å¯Œçš„APIå’Œç®€å•çš„ã€å¯è¯»çš„æºä»£ç ï¼Œè¿™æ˜¯ä¸€ç§ä¹è¶£ã€‚ æ›´å¤šä¿¡æ¯ï¼Œæ–‡æ¡£å’Œæ•™ç¨‹ï¼Œè¯·è®¿é—®å®˜æ–¹ç½‘ç«™ã€‚æœ‰å…³Leafletä¸‹è½½(åŒ…æ‹¬æ„å»ºçš„ä¸»ç‰ˆæœ¬)ï¼Œè¯·å‚é˜…ä¸‹è½½é¡µé¢ã€‚","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"GitHubç²¾é€‰","slug":"å‰ç«¯/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/GitHubç²¾é€‰/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"maps","slug":"maps","permalink":"https://jigangduan.github.io/tags/maps/"}]},{"title":"Spring Boot 2ç²¾é«“ - (17) ç›‘æ§ Spring Bootåº”ç”¨","slug":"SpringBoot2-H","date":"2018-12-22T15:22:04.000Z","updated":"2020-07-25T02:57:18.170Z","comments":true,"path":"2018/12/22/SpringBoot2-H/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-H/","excerpt":"","text":"SpringBootä¹Ÿæä¾›äº†ActuatoråŠŸèƒ½æ¥çš„ç›‘æ§, æŸ¥çœ‹ Spring Boot åº”ç”¨çš„é…ç½®ã€å„ç§æŒ‡æ ‡ã€å¥åº·ç¨‹åº¦ç­‰ æŸ¥çœ‹å’Œç›‘æ§ä»¥ä¸‹ä¿¡æ¯: Spring Boot çš„é…ç½®ä¿¡æ¯ Spring Boot é…ç½®çš„ Bean ä¿¡æ¯ æœ€è¿‘è¯·æ±‚çš„ HTTP ä¿¡æ¯ æ•°æ®æºï¼ŒNoSQL ç­‰æ•°æ®çŠ¶æ€ åœ¨çº¿æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼Œåœ¨çº¿æ—¥å¿—é…ç½®ä¿®æ”¹ æ‰€æœ‰@RequestMappingæ³¨è§£çš„URLè·¯å¾„ è‡ªåŠ¨è£…é…ä¿¡æ¯æ±‡æ€» æ‰“å°è™šæ‹Ÿæœºçš„çº¿ç¨‹æ ˆ Dump å†…å­˜ åº”ç”¨çš„å„ç§æŒ‡æ ‡ã€æ±‡æ€» è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ å®‰è£… Acutatorä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®: 1234management.server.port=8081management.endpoints.web.exposure.include=*#management.endpoints.web.exposure.exclude=env,beansmanagement.endpoints.web.base-path=/application HTIP è·Ÿè¸ªtraceè·Ÿè¸ªåŠŸèƒ½ï¼Œèƒ½æŸ¥çœ‹æœ€è¿‘çš„ HTTPè¯·æ±‚å’Œå“åº” http://localhost:8081/application/trace æ—¥å¿—æŸ¥çœ‹Actuator å…è®¸æŸ¥çœ‹æ—¥å¿—é…ç½®,è¿˜å…è®¸ä¿®æ”¹æ—¥å¿—ç­‰çº§é…ç½®ï¼ŒActuatorä¹Ÿå¯ä»¥åœ¨çº¿æŸ¥çœ‹æ—¥å¿—å†…å®¹ http://localhost:8081/application/loggers çº¿ç¨‹æ ¸ä¿¡æ¯å¯ä»¥é€šè¿‡è¾“å…¥dumpæ¥è·å–æŸä¸€æ—¶åˆ»è™šæ‹Ÿæœºçº¿ç¨‹æ¨µä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯ç±»ä¼¼ä½¿ç”¨JDKè‡ªå¸¦çš„ jstackå‘½ä»¤çš„è¾“å‡ºç»“æœæˆ–è€… kill -3 çš„ç»“æœã€‚çº¿ç¨‹æ¢°è¡¨ç¤ºæŸä¸€æ—¶åˆ»è™šæ‹Ÿæœºæ­£åœ¨åšçš„äº‹æƒ… http://localhost:8081/application/dump å†…å­˜ä¿¡æ¯heapdump ç±»ä¼¼JDKæä¾›çš„jmapå·¥å…·ï¼Œèƒ½å°†å†…å­˜é•œåƒå‹ç¼©ä¸‹è½½ä»¥æä¾›åˆ†æ http://localhost:8081/application/heapdump æŸ¥çœ‹URLæ˜ å°„Actuator çš„ mappings è¾“å‡ºæ‰€æœ‰é€šè¿‡æ³¨è§£@RequestMapping è®¾ç½®çš„URLæ˜ å°„ï¼Œå¯ä»¥é€šè¿‡æ­¤æ¥æŸ¥çœ‹URLå¯¹åº”çš„Controller æŸ¥çœ‹ Spring å®¹å™¨ç®¡ç†çš„ BeanActuator çš„ beans è¾“å‡ºæ‰€æœ‰ Spring ç®¡ç†çš„ Bean å…¶å®ƒç›‘æ§ health: æŸ¥çœ‹æ‰€åœ¨åº”ç”¨çš„å¥åº·çŠ¶æ€ï¼Œå¦‚ç£ç›˜ã€æ•°æ®æºã€Redisã€Elasticsearch ç­‰ã€‚ metrics: æ˜¾ç¤º Spring Boot çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚å·±æœ‰å†…å­˜ã€æœªå ç”¨å†…å­˜ã€åƒåœ¾å›æ”¶æ¬¡æ•°ã€ç±»ä¿¡æ¯ç­‰ã€‚ env: æ˜¾ç¤º SpringBootç¯å¢ƒå˜é‡ï¼Œå¦‚ä½¿ç”¨çš„ JDKç‰ˆæœ¬ã€åŠ è½½çš„ jaråŒ…ã€é…ç½®æ–‡ä»¶ä¿¡æ¯ã€æ—¥å¿—æ–‡ä»¶ä¿¡æ¯ã€‚ configprops: æ‰€æœ‰@ConfigurationProperties æ³¨è§£çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ çš„æœ€å¤§å…è®¸ é…ç½®ç­‰ã€‚ autoconfig:æ˜¾ç¤ºæ‰€æœ‰è‡ªåŠ¨è£…é…ç±»çš„æŠ¥å‘Šï¼Œä»¥åŠæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´è‡ªåŠ¨è£…é…æˆåŠŸæˆ–è€…ä¸æˆåŠŸ ç¼–å†™è‡ªå·±çš„ç›‘æ§ä¿¡æ¯health ç”¨äºæ£€æŸ¥ Spring Boot åº”ç”¨çš„å¥åº·çŠ¶æ€ï¼Œæä¾›äº†ç£ç›˜çš„å¥åº·çŠ¶æ€æ˜¾ç¤ºï¼Œå¦‚æœåº”ç”¨è¿˜ä½¿ç”¨äº†æ•°æ®æºã€NoSQLç­‰ï¼Œä¹Ÿä¼šæ˜¾ç¤ºç›¸åº”çš„å¥åº·çŠ¶æ€ã€‚Spring Boot ä½¿ç”¨ Healthlndicator æ¥å£å®ç°ç›‘æ§ä¿¡æ¯æ˜¾ç¤ºï¼Œé»˜è®¤æœ‰å¦‚ä¸‹ç±»å®ç° Healthlndicator æ¥å£ metrics ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿçš„å„é¡¹æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ä¸»æœºå†…å­˜çš„å¤§å°ã€è™šæ‹Ÿæœº heap ä¿¡æ¯ã€çº¿ç¨‹ä¿¡æ¯ã€åƒåœ¾å›æ”¶ã€Tomcatä¼šè¯ä¿¡æ¯ç­‰ã€‚ä¹Ÿå¯ä»¥åœ¨ä½ çš„Beanä¸­æ³¨å…¥CounterServiceï¼Œè°ƒç”¨ increment æ–¹æ³•å’Œ decrement æ–¹æ³•æ¥è®¾ç½®æŒ‡æ ‡å€¼ ç¼–å†™ HealthIndicatorç¼–å†™è‡ªå·±çš„ç›‘æ§å™¨ï¼Œåªéœ€è¦ç»§æ‰¿ Healthlndicatorï¼Œå®ç° health æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª Health å¯¹è±¡å³å¯ è‡ªå®šä¹‰ç›‘æ§æ³¨è§£@Endpointæ¥è‡ªå®šä¹‰ä¸€ä¸ªç›‘æ§ç±»ï¼Œå¹¶åœ¨æ–¹æ³•ä¸Šä½¿ç”¨@ReadOperationæ¥æ˜¾ç¤ºç›‘æ§æŒ‡æ ‡ï¼Œä½¿ç”¨@WriteOperationæ¥åŠ¨æ€æ›´æ”¹ç›‘æ§æŒ‡æ ‡","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (16) ZooKeeper","slug":"SpringBoot2-G","date":"2018-12-22T14:01:54.000Z","updated":"2020-07-25T02:57:18.170Z","comments":true,"path":"2018/12/22/SpringBoot2-G/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-G/","excerpt":"","text":"SpringBootæ°´å¹³æ‰©å±•åï¼Œæˆ‘ä»¬è¿˜é¢ä¸´ä¸€äº›æŒ‘æˆ˜: ä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªåº”ç”¨æ¥å¤„ç†æŸä¸ªä¸šåŠ¡ï¼Œè€Œä¸èƒ½å‘ç”ŸåŒæ—¶å¤„ç†çš„æƒ…å†µã€‚è¿™å°±éœ€è¦æä¾›ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œåªæœ‰è·å¾—é”çš„SpringBootåº”ç”¨æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚æ‰§è¡Œå®Œæ¯•åï¼Œé‡Šæ”¾é”ã€‚æ¯”å¦‚å®šæ—¶è°ƒåº¦æŸä¸ªä»»åŠ¡æ‰§è¡Œï¼ŒåŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªSpringBootåº”ç”¨èƒ½æ‰§è¡Œ åº”ç”¨ç³»ç»Ÿä¹‹é—´é€šè¿‡ REST æ¥å£æ¥ç›¸äº’è°ƒç”¨ï¼Œå¦‚ä½•è®© REST å®¢æˆ·ç«¯çŸ¥é“æœåŠ¡åœ¨å“ªé‡Œ?SpringBootåº”ç”¨å¯ä»¥æ°´å¹³æ‰©å±•ï¼Œä¸å¯èƒ½é€šè¿‡ application.propertiesæ¥é…ç½®æœåŠ¡å™¨åœ°å€ éœ€è¦åœ¨SpringBootåº”ç”¨ä¸­é€‰æ‹©ä¸€ä¸ªé¢†å¯¼èŠ‚ç‚¹ï¼Œè¿™ä¸ªé¢†å¯¼èŠ‚ç‚¹è´Ÿè´£åè°ƒæ‰€æœ‰ SpringBoot åº”ç”¨çš„å·¥ä½œ ZooKeeperZooKeeper æ¥æºäºApache Hadoopå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€åˆ†å¸ƒå¼çš„ã€å¼€æºåº”ç”¨åè°ƒæœåŠ¡ã€‚åˆ†å¸ƒå¼åº”ç”¨å¯ä»¥åŸºäºå®ƒå®ç°åè°ƒæœåŠ¡ï¼Œæ¯”å¦‚åŒæ­¥ã€é›†ç¾¤ã€é¢†å¯¼é€‰å–ï¼Œä»¥åŠåˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†ã€å‘½åæœåŠ¡ã€‚ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘ä½œä¸ºæ•°æ®æ¨¡å‹ ZooKeeper(ä¸‹é¢ç®€ç§° zk)æœ‰ä»¥ä¸‹ç‰¹ç‚¹: ç®€å•çš„APIå’Œæ•°æ®ç»“æ„å®Œæˆåè°ƒæœåŠ¡ï¼Œzkæä¾›äº†æ˜“äºç†è§£çš„æ•°æ®ç»“æ„æ¥å®Œæˆåè°ƒæœåŠ¡ï¼Œå…¶JavaAPIéå¸¸ç®€å•ã€‚Curatorè¿›ä¸€æ­¥å°è£…äº†è¿™äº›APIï¼Œç›´æ¥æä¾›äº†åˆ†å¸ƒå¼åè°ƒæœåŠ¡è€Œä¸éœ€è¦å…³å¿ƒç»†èŠ‚ åˆ†å¸ƒå¼ï¼Œä¸ä¼šå‡ºç°å•ç‚¹æ•…éšœï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè‡³å°‘éƒ¨ç½²3å°zkä»¥é¿å…å•ç‚¹æ•…éšœã€‚å®¢æˆ·ç«¯(æŒ‡Spring Bootåº”ç”¨)å¦‚æœè¿æ¥çš„zkå®•æœºï¼Œå®¢æˆ·ç«¯å°†è‡ªåŠ¨è¿æ¥åˆ°å¦å¤–ä¸€å°ã€‚ ä¿è¯æ“ä½œçš„æ—¶åºæ€§ï¼Œzkå¯¹æ¯æ¬¡æ›´æ–°éƒ½æœ‰æ—¶é—´æˆ³è®°å½•ï¼Œä»è€Œä¿è¯æ“ä½œçš„æ—¶åºæ€§ï¼Œä¿è¯å¯ä»¥å®Œæˆæ›´é«˜å±‚æ¬¡çš„åè°ƒæœåŠ¡ï¼Œå¦‚åˆ†å¸ƒå¼é”ã€‚ æ€§èƒ½æµ‹è¯•ç»“æœï¼Œzk æœ¬èº«çš„æ€§èƒ½éå¸¸å¥½ï¼Œæ—¢å¯ä»¥å¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç®¡ç†åè°ƒä»»åŠ¡ï¼Œå¦‚é€‰ä¸¾é¢†å¯¼ï¼Œä¹Ÿèƒ½èƒœä»»é«˜äº•å‘é‡çš„ä¸šåŠ¡åè°ƒå¤„ç†ï¼Œå¦‚ä¸šåŠ¡å¤„ç†çš„åˆ†å¸ƒå¼é”ã€‚ ZooKeeper çš„æ•°æ®ç»“æ„zkæä¾›çš„å‘½åç©ºé—´(name space)ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯é€šè¿‡è·¯å¾„æ¥è¡¨ç¤ºçš„ï¼Œä¸åŒçš„æ˜¯ï¼ŒèŠ‚ç‚¹å¯ä»¥åŒ…å«ä¸€å®šçš„æ•°æ®(2MB å­—èŠ‚)ï¼Œè¿™äº›èŠ‚ç‚¹å¯ä»¥ç”¨æ¥å­˜æ”¾ä¸šåŠ¡ä¿¡æ¯ï¼Œå¦‚é…ç½®ä¿¡æ¯ç­‰ èŠ‚ç‚¹è¿˜åŒ…å«äº†æ›´æ–°çš„ç‰ˆæœ¬ã€æ—¶é—´æˆ³ã€‚æœ‰ä¸€ç§ç‰¹æ®Šçš„èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ›å»ºèŠ‚ç‚¹çš„ä¼šè¯å­˜åœ¨ï¼ŒèŠ‚ç‚¹å°±å­˜åœ¨ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸï¼Œå¦‚å®¢æˆ·ç«¯åˆ›å»ºçš„è¿æ¥æ–­æ‰ï¼Œæˆ–è€…å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­æ­¤ä¼šè¯ï¼Œåˆ™èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ã€‚è¿˜å¯ä»¥æŒ‡å®šèŠ‚ç‚¹ä¸ºé¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œè‡ªåŠ¨ä¸ºèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªåºåˆ—å·ï¼Œäº•ä¸”åºåˆ—å·é€’å¢ã€‚ èŠ‚ç‚¹å¯ä»¥è¢«ç›‘æ§ï¼Œä¸€æ—¦èŠ‚ç‚¹å˜åŒ–ï¼Œå¦‚åˆ é™¤èŠ‚ç‚¹ï¼Œæˆ–è€…èŠ‚ç‚¹æ•°æ®å˜åŒ–ï¼Œå®¢æˆ·ç«¯å°±ä¼šæ”¶åˆ°æ­¤äº‹ä»¶ï¼Œæ­¤ç›‘æ§å¤±æ•ˆã€‚å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨APIç»§ç»­ç›‘æ§è¿™ä¸ªèŠ‚ç‚¹ å®‰è£… ZooKeeperZooKeeper å®˜ç½‘ ä¸‹è½½ zk åªéœ€è¦è§£å‹å³å¯ä½¿ç”¨ conf/zoo.cfg tickTime æ˜¯å¿ƒè·³æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 2 ç§’ dataDiræ˜¯ ZooKeeperä¿å­˜çš„å†…å­˜å¿«ç…§ï¼Œä»¥åŠäº‹åŠ¡æ—¥å¿—çš„ç›®å½• clientPort æ˜¯å®¢æˆ·ç«¯åº”ç”¨è¿æ¥çš„ç«¯å£ ZooKeeper çš„åŸºæœ¬å‘½ä»¤zkCli: helpï¼Œ è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ lsï¼Œ æŸ¥çœ‹ç›®å½• create, åˆ›å»ºèŠ‚ç‚¹ create -eï¼Œåˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸€æ—¦ç”¨æˆ·ä¼šè¯ç»“æŸï¼Œåˆ™èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤ getï¼Œè·å–èŠ‚ç‚¹æ•°æ®èŠ‚ç‚¹å†…éƒ¨æ•°æ®: cZxidï¼ŒèŠ‚ç‚¹åˆ›å»ºæ—¶çš„ zxid mZxidï¼ŒèŠ‚ç‚¹æœ€æ–°ä¸€æ¬¡æ›´æ–°å‘ç”Ÿæ—¶çš„ zxid ctimeï¼ŒèŠ‚ç‚¹åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ mtimeï¼ŒèŠ‚ç‚¹æœ€æ–°ä¸€æ¬¡æ›´æ–°å‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³ dataVersionï¼ŒèŠ‚ç‚¹æ•°æ®çš„æ›´æ–°æ¬¡æ•° cversionï¼Œå…¶å­èŠ‚ç‚¹çš„æ›´æ–°æ¬¡æ•° aclVersionï¼ŒèŠ‚ç‚¹ACL(æˆæƒä¿¡æ¯)çš„æ›´æ–°æ¬¡æ•° ephemeralOwnerï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹ï¼ŒephemeralOwnerå€¼è¡¨ç¤ºä¸è¯¥èŠ‚ç‚¹ç»‘å®šçš„ä¼šè¯IDï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹, ephemeralOwnerå€¼ä¸º 0; dataLengthï¼ŒèŠ‚ç‚¹æ•°æ®çš„å­—èŠ‚æ•° numChildrenï¼Œå­èŠ‚ç‚¹ä¸ªæ•° deleteï¼Œåˆ é™¤èŠ‚ç‚¹ set path dataï¼Œè®¾ç½®èŠ‚ç‚¹æ•°æ® watchæ“ä½œï¼Œlså‘½ä»¤å’Œgetå‘½ä»¤éƒ½å¯ä»¥å¢åŠ ä¸€ä¸ªwatchæ“ä½œï¼ŒèŠ‚ç‚¹å˜åŒ–çš„æ—¶å€™ä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚é€šçŸ¥å®Œæ¯•åï¼Œè¿˜éœ€è¦å†æ¬¡è°ƒç”¨ ls æˆ–è€… getæ‰èƒ½ç›‘æ˜•æ­¤èŠ‚ç‚¹å˜åŒ– é¢†å¯¼é€‰å–åˆ†å¸ƒå¼é”æœåŠ¡æ³¨å†Œé›†æˆ ZooKeeperCurator æ˜¯Apacheæä¾›çš„ä¸€ä¸ªè®¿é—®zkçš„å·¥å…·åŒ…ï¼Œå°è£…äº†è¿™äº›ä½çº§åˆ«æ“ä½œï¼ŒåŒæ—¶ä¹Ÿæä¾›ä¸€äº›é«˜çº§æœåŠ¡ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼é”ã€é¢†å¯¼é€‰å–ç­‰ å®ƒå…·æœ‰å¦‚ä¸‹ç‰¹æ€§: è‡ªåŠ¨é‡è¿ï¼Œæ— é¡»å¼€å‘äººå‘˜å…³å¿ƒ æä¾›ç®€å•çš„APIæ¥æ“ä½œ zk èŠ‚ç‚¹ï¼Œè¿˜æœ‰zkäº‹ä»¶ï¼ŒAPIæ˜¯é“¾å¼æ“ä½œé£æ ¼ Curatorå®ç°äº†ZooKeeperæä¾›çš„æ‰€æœ‰åº”ç”¨åœºæ™¯(é™¤äº†ä¸¤é˜¶æ®µæäº¤)ï¼Œæœ‰ä»¥ä¸‹å®ç°: é¢†å¯¼èŠ‚ç‚¹é€‰å– åˆ†å¸ƒå¼é” åˆ†å¸ƒå¼è¯»å†™é” å…±äº«ä¿¡å·é‡ æ …æ å’ŒåŒé‡ DoubleBarrier åˆ†å¸ƒå¼è®¡æ•°å™¨ï¼Œæ”¯æŒintegerå’Œlong åˆ†å¸ƒå¼é˜Ÿåˆ—å’Œåˆ†å¸ƒå¼ä¼˜å…ˆçº§é˜Ÿåˆ— æœåŠ¡æ³¨å†Œå’Œå‘ç° é›†æˆ Curatorä¾èµ–: 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-x-discovery&lt;/artifactId&gt; &lt;version&gt;4.0.1&lt;/version&gt;&lt;/dependency&gt; Configuration 1234567891011121314@Configurationpublic class ZookeeperConf &#123; @Value(\"$&#123;zk.url&#125;\") private String zkUrl; @Bean public CuratorFramework getCuratorFramework() throws Exception &#123; RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3); CuratorFramework client = CuratorFrameworkFactory.newClient(zkUrl, retryPolicy); client.start(); return client; &#125;&#125; RetryPolicy ç”¨äºé‡è¿ç­–ç•¥ Curator API createï¼Œåˆ›å»ºèŠ‚ç‚¹ï¼Œä¹Ÿå¯é€šè¿‡withModeä¸ºèŠ‚ç‚¹è®¾ç½®ç±»å‹ï¼Œå¦‚ä¸´æ—¶èŠ‚ç‚¹ã€åºåˆ—èŠ‚ç‚¹ï¼Œä»¥forPathç»“å°¾ã€‚å¦‚æœèŠ‚ç‚¹å·±ç»å­˜åœ¨ï¼ŒæŠ›å‡º NodeExistsExceptiono deleteï¼Œåˆ é™¤èŠ‚ç‚¹ï¼Œä»¥forPathç»“å°¾ï¼Œå¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œå°†æŠ›å‡º NoNodeExceptionï¼Œå¦‚æœèŠ‚ç‚¹æ˜¯éç©ºèŠ‚ç‚¹ï¼Œåˆ™æŠ›å‡º NotEmptyExceptiono checkExists()ï¼Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å› nullï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿”å› Statå¯¹è±¡ã€‚å¯ä»¥åŠ ä¸Š watch æ–¹æ³•æ¥ç›‘å¬èŠ‚ç‚¹å˜åŒ–ï¼Œè¯¥æ–¹æ³•ä»¥ forPath ç»“å°¾ getDataï¼Œè·å–èŠ‚ç‚¹æ•°æ®ï¼Œä»¥ forPath ç»“å°¾ï¼Œè¿”å› byte[] setDataï¼Œè®¾ç½®èŠ‚ç‚¹æ•°æ®ï¼Œä»¥ forPathç»“å°¾ getChildren()ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œä»¥forPathç»“å°¾ï¼Œè¿”å›ä¸€ä¸ªå­èŠ‚ç‚¹è·¯å¾„åˆ—è¡¨ å®ç°åˆ†å¸ƒå¼é”Curatoræä¾›äº†InterProcessMutexæ¥å®ç°åˆ†å¸ƒå¼é”InterProcessMutexç”¨acquireæ–¹æ³•è·å–é”ï¼Œä»¥åŠç”¨releaseé‡Šæ”¾é”ï¼ŒåŒå…¶ä»–é”ä¸€æ ·ï¼Œreleaseæ–¹æ³•éœ€è¦æ”¾åœ¨finallyä»£ç å—ä¸­ï¼Œç¡®ä¿é”èƒ½æ­£ç¡®é‡Šæ”¾ æœåŠ¡æ³¨å†Œcurator-x-discovery é€šè¿‡ ServiceDiscovery æ³¨å†ŒæœåŠ¡è·å–æœåŠ¡é¢†å¯¼é€‰å–LeaderSelector å³å¯å®ç°é¢†å¯¼çš„é€‰å–","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (15) Session","slug":"SpringBoot2-F","date":"2018-12-22T12:58:24.000Z","updated":"2020-07-25T02:57:18.169Z","comments":true,"path":"2018/12/22/SpringBoot2-F/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-F/","excerpt":"","text":"æ°´å¹³æ‰©å±•å®ç° Spring Boot åº”ç”¨æ°´å¹³æ‰©å±•æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³: å°†ç”¨æˆ·çš„è¯·æ±‚æ´¾å‘åˆ°æ°´å¹³éƒ¨ç½²çš„ä»»æ„ä¸€å°SpringBootåº”ç”¨ï¼Œé€šå¸¸ç”¨ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨æ¥å®ç° ä¼šè¯ç®¡ç†å…±äº«ä¼šè¯ä¿¡æ¯, æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç° å¤åˆ¶ä¼šè¯: WebæœåŠ¡å™¨é€šå¸¸éƒ½æ”¯æŒSessionå¤åˆ¶ï¼Œä¸€å°åº”ç”¨çš„ä¼šè¯ä¿¡æ¯æ”¹å˜å°†ç«‹åˆ»å¤åˆ¶åˆ°å…¶ä»–é›†ç¾¤çš„WebæœåŠ¡å™¨ä¸Š é›†ä¸­å¼ä¼šè¯: æ‰€æœ‰WebæœåŠ¡å™¨éƒ½å…±äº«ä¸€ä¸ªä¼šè¯ï¼Œä¼šè¯ä¿¡æ¯é€šå¸¸å­˜æ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæœ¬ç« ä½¿ç”¨RedisæœåŠ¡å™¨æ¥å­˜æ”¾ä¼šè¯ Spring Sessionä»‹ç»Spring Boot é…ç½®å¾ˆå®¹æ˜“åˆ‡æ¢åˆ°ä¸åŒçš„Sessionç®¡ç†æ–¹å¼ï¼Œæ€»å…±æœ‰ä»¥ä¸‹å‡ ç§: Redis, Sessionæ•°æ®å­˜æ”¾Redisä¸­ JDBCï¼Œä¼šè¯æ•°æ®å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹SPRING_SESSIONè¡¨å­˜æ”¾SessionåŸºæœ¬ä¿¡æ¯ï¼Œå¦‚sessionIdã€åˆ›å»ºæ—¶é—´ã€æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ç­‰ï¼ŒSPRING_SESSION_ATTRIBUTESå­˜æ”¾äº†sessionæ•°æ®ï¼ŒATTRIBUTE_NAMEåˆ—ä¿å­˜äº†Sessionçš„Key, ATTRIBUTE_BYTESåˆ—ä»¥å­—èŠ‚å½¢å¼ä¿å­˜äº†Sessionçš„Value, Spring Session ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸¤å¼ è¡¨ã€‚ Hazelcast, Sessionæ•°æ®å­˜æ”¾åˆ° Hazeleast Noneï¼Œç¦ç”¨ Spring Session åŠŸèƒ½ é€šè¿‡é…ç½®å±æ€§spring.session.store-typeæ¥æŒ‡å®šSessionçš„å­˜å‚¨æ–¹å¼ ä½¿ç”¨ Redis","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (14) Cache","slug":"SpringBoot2-E","date":"2018-12-22T11:47:19.000Z","updated":"2020-07-25T02:57:18.169Z","comments":true,"path":"2018/12/22/SpringBoot2-E/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-E/","excerpt":"","text":"Spring Cacheå¯¹Cacheè¿›è¡Œäº†æŠ½è±¡ï¼Œæä¾›äº†@Cacheableã€@CachePutã€@CacheEvictç­‰æ³¨è§£ã€‚SpringBootåº”ç”¨åŸºäºSpringCacheï¼Œæ—¢æä¾›äº†åŸºäºå†…å­˜å®ç°çš„ç¼“å­˜ç®¡ç†å™¨ï¼Œå¯ä»¥ç”¨äºå•ä½“åº”ç”¨ç³»ç»Ÿï¼Œä¹Ÿé›†æˆäº†Redisã€EhCacheç­‰ç¼“å­˜æœåŠ¡å™¨ï¼Œå¯ç”¨äºå¤§å‹ç³»ç»Ÿæˆ–è€…åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ Cacheåº”ç”¨ç³»ç»Ÿç¼“å­˜é€šå¸¸æœ‰ä»¥ä¸‹ä½œç”¨: ç¼“å­˜Webç³»ç»Ÿçš„è¾“å‡ºï¼Œå¦‚ä¼ªé™æ€é¡µé¢ ç¼“å­˜ç³»ç»Ÿä¸­ä¸ç»å¸¸æ”¹å˜çš„ä¸šåŠ¡æ•°æ®ï¼Œå¦‚ç”¨æˆ·æƒé™ã€å­—å…¸æ•°æ®ã€é…ç½®ä¿¡æ¯ç­‰ Cacheçš„ç»„ä»¶å’Œæ¦‚å¿µ CacheManagerï¼Œç”¨æ¥åˆ›å»ºã€ç®¡ç†ã€ç®¡ç†å¤šä¸ªå‘½åå”¯ä¸€çš„Cacheï¼Œå¦‚ç»„ç»‡æœºæ„ç¼“å­˜ã€èœå•é¡¹çš„ç¼“å­˜ã€èœå•æ ‘çš„ç¼“å­˜ç­‰ Cache ç±»ä¼¼Mapé‚£æ ·çš„Key-Valueå­˜å‚¨ç»“æ„ï¼ŒValueéƒ¨åˆ†é€šå¸¸åŒ…å«äº†ç¼“å­˜çš„å¯¹è±¡ï¼Œé€šè¿‡Keyæ¥å–å¾—ç¼“å­˜å¯¹è±¡ ç¼“å­˜é¡¹ï¼Œå­˜æ”¾åœ¨ç¼“å­˜é‡Œçš„å¯¹è±¡ï¼Œå¸¸å¸¸éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ï¼Œä»¥æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜ Cacheå­˜å‚¨æ–¹å¼ï¼Œç¼“å­˜ç»„ä»¶å¯ä»¥å°†å¯¹è±¡æ”¾åˆ°å†…å­˜æˆ–å…¶ä»–ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼ŒSpring Bootæä¾›äº†ä¸€ä¸ªåŸºäºConcurrentMapçš„ç¼“å­˜ï¼ŒåŒæ—¶ä¹Ÿé›†æˆäº†Redisã€EhCache2.xã€JCacheç¼“å­˜æœåŠ¡å™¨ç­‰ ç¼“å­˜ç­–ç•¥ï¼Œé€šå¸¸Cacheè¿˜å¯ä»¥æœ‰ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼Œå¦‚è®¾ç½®ç¼“å­˜æœ€å¤§çš„å®¹é‡ï¼Œç¼“å­˜é¡¹çš„è¿‡æœŸæ—¶é—´ç­‰ åˆ†å¸ƒå¼ç¼“å­˜ï¼Œç¼“å­˜é€šå¸¸æŒ‰ç…§ç¼“å­˜æ•°æ®ç±»å‹å­˜æ”¾åœ¨ä¸åŒç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…åŒä¸€ç±»å‹çš„ç¼“å­˜æŒ‰ç…§æŸç§ç®—æ³•ã€ä¸åŒKeyçš„æ•°æ®å­˜æ”¾åœ¨ä¸åŒçš„ç¼“å­˜æœåŠ¡å™¨ä¸Š Cache Hitï¼Œä»Cacheä¸­å–å¾—æœŸæœ›çš„ç¼“å­˜é¡¹ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºç¼“å­˜å‘½ä¸­ã€‚å¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç§°ä¹‹ä¸ºCache Missï¼Œæ„å‘³ç€éœ€è¦ä»æ•°æ®æ¥æºå¤„é‡æ–°å–å‡ºäº•æ”¾å›Cacheä¸­ Cache Missï¼Œç¼“å­˜ä¸¢å¤±ï¼Œæ ¹æ®Keyæ²¡æœ‰ä»ç¼“å­˜ä¸­æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜é¡¹ Cache Evicationï¼Œç¼“å­˜æ¸…é™¤æ“ä½œ Hot Dataï¼Œçƒ­ç‚¹æ•°æ®ï¼Œç¼“å­˜ç³»ç»Ÿèƒ½è°ƒæ•´ç®—æ³•æˆ–è€…å†…éƒ¨å­˜å‚¨æ–¹å¼ï¼Œä½¿å¾—æœ€æœ‰å¯èƒ½é¢‘ç¹è®¿é—®çš„æ•°æ®èƒ½è¢«å°½å¿«è®¿é—®åˆ° On-Heap, Javaåˆ†é…å¯¹è±¡éƒ½æ˜¯åœ¨å †å†…å­˜ä¸­ï¼Œæœ‰æœ€å¿«çš„è·å–é€Ÿåº¦ã€‚ç”±äºè™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶ç®¡ç†æœºåˆ¶ï¼Œç¼“å­˜æ”¾å…¥è¿‡å¤šçš„å¯¹è±¡ä¼šå¯¼è‡´åƒåœ¾å›æ”¶æ—¶é—´è¿‡é•¿ï¼Œä»è€Œæœ‰å¯èƒ½å½±å“æ€§èƒ½ off-Heapï¼Œå †å¤–å†…å­˜ï¼Œå¯¹è±¡å­˜æ”¾åœ¨è™šæ‹Ÿæœºåˆ†é…çš„å †å¤–å†…å­˜ä¸­ï¼Œå› æ­¤ä¸å—åƒåœ¾å› æ”¶ç®¡ç†æœºåˆ¶çš„ç®¡ç†ï¼Œä¸å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œä½†å †å¤–å†…å­˜çš„å¯¹è±¡è¦è¢«ä½¿ç”¨ï¼Œè¿˜è¦åºåˆ—åŒ–æˆå †å†…å¯¹è±¡ã€‚å¾ˆå¤šç¼“å­˜å·¥å…·ä¼šæŠŠä¸å¸¸ç”¨çš„å¯¹è±¡æ”¾åˆ°å †å¤–ï¼ŒæŠŠçƒ­ç‚¹æ•°æ®æ”¾åˆ°å †å†… Cacheçš„å•ä½“åº”ç”¨ä½¿ç”¨ä¸“æœ‰çš„CacheæœåŠ¡å™¨ä½¿ç”¨ä¸€äºŒçº§ç¼“å­˜æœåŠ¡å™¨Spring Boot CacheSpring Bootæœ¬èº«æä¾›äº†ä¸€ä¸ªåŸºäºConcurrentHashMapçš„ç¼“å­˜æœºåˆ¶ï¼Œä¹Ÿé›†æˆäº†EhCache2.xã€JCache CJSR-107ã€EhCache3.xã€ Hazå·³leastã€Infinispan)ï¼Œè¿˜æœ‰ Couchbaseã€Redisç­‰ã€‚Spring Bootåº”ç”¨é€šè¿‡æ³¨è§£çš„æ–¹å¼ä½¿ç”¨ç»Ÿä¸€çš„ç¼“å­˜ï¼Œåªéœ€åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ç¼“å­˜æ³¨è§£å³å¯ï¼Œå…¶ç¼“å­˜çš„å…·ä½“å®ç°ä¾ èµ–äºé€‰æ‹©çš„ç›®æ ‡ç¼“å­˜ç®¡ç†å™¨ã€‚ ä½¿ç”¨@Cacheable é›†æˆ Spring Cacheä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;&lt;/dependency&gt; appliaction.properties ä¸­é…ç½® 1spring.cache.type=Simple Simpleï¼ŒåŸºäº ConcurrentHashMapå®ç°çš„ç¼“å­˜ï¼Œé€‚åˆå•ä½“åº”ç”¨æˆ–è€…å¼€å‘ç¯å¢ƒä½¿ç”¨ noneï¼Œå…³é—­ç¼“å­˜ï¼Œæ¯”å¦‚å¼€å‘é˜¶æ®µä¸ºäº†ç¡®ä¿åŠŸèƒ½æ­£ç¡®, å¯ä»¥å…ˆç¦æ­¢ä½¿ç”¨ç¼“å­˜ redisï¼Œä½¿ç”¨ Redisä½œä¸ºç¼“å­˜ï¼Œè¿˜éœ€è¦åœ¨pomä¸­å¢åŠ  Redisä¾èµ– Genericï¼Œç”¨æˆ·è‡ªå®šä¹‰ç¼“å­˜å®ç°ï¼Œç”¨æˆ·éœ€è¦å®ç°ä¸€ä¸ªorg.springframework.cache.CacheManagerçš„å®ç° å…¶ä»–è¿˜æœ‰ JCacheã€ EhCache2.x, Hazelcastç­‰ æ³¨è§£@EnableCachingæ‰“å¼€ç¼“å­˜åŠŸèƒ½ æ³¨é‡Šé©±åŠ¨ç¼“å­˜@Cacheableæ³¨è§£@Cacheableå£°æ˜äº†æ–¹æ³•çš„ç»“æœæ˜¯å¯ç¼“å­˜çš„ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨ï¼Œåˆ™ç›®æ ‡æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ï¼Œç›´æ¥å–å‡ºç¼“å­˜ã€‚å¯ä»¥ä¸ºæ–¹æ³•å£°æ˜å¤šä¸ªç¼“å­˜ï¼Œå¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªç¼“å­˜æœ‰ç¼“å­˜é¡¹ï¼Œåˆ™å…¶ç¼“å­˜é¡¹å°†è¢«è¿”å›ã€‚ Keyç”Ÿæˆå™¨Springä½¿ç”¨äº†KeyGeneratorç±»æ¥æ ¹æ®æ–¹æ³•å‚æ•°ç”Ÿæˆ Key @CachePutæ³¨è§£CachePutæ€»æ˜¯ä¼šæ‰§è¡Œæ–¹æ³•ä½“ï¼Œäº•ä¸”ä½¿ç”¨è¿”å›çš„ç»“æœæ›´æ–°ç¼“å­˜ @CacheEvictæ³¨è§£CacheEvict ç”¨äºåˆ é™¤ç¼“å­˜é¡¹æˆ–è€…æ¸…ç©ºç¼“å­˜ï¼ŒCacheEvict å¯ä»¥æŒ‡å®šå¤šä¸ªç¼“å­˜åå­—æ¥æ¸…ç©ºå¤šä¸ªç¼“å­˜ CacheEvictå¯ä»¥æ¸…ç©ºç¼“å­˜ä¸­çš„æ‰€æœ‰é¡¹ç›®ï¼Œæ­¤æ—¶ä½¿ç”¨allEntries=trueæ¥åˆ é™¤æ¸…ç©ºç¼“å­˜ @Cachingæ³¨è§£Cachingå¯ä»¥æ··åˆä»¥ä¸Šå„ç§æ³¨è§£ï¼Œå¯ä»¥åœ¨Cachingæ ‡ç­¾ä¸­æ··åˆ@Cacheableã€@CachePutã€@CacheEvict @CacheConfigCacheæ³¨è§£éƒ½éœ€è¦æä¾›Cacheåç§°ï¼Œå¦‚æœæ¯ä¸ªServiceæ–¹æ³•ä¸Šéƒ½åŒ…å« Cacheåç§°ï¼Œå¯èƒ½å†™èµ·æ¥é‡å¤ã€‚æ³¨è§£ CacheConfigä½œç”¨äºç±»ä¸Šï¼Œå¯ä»¥ä¸ºæ­¤ç±»çš„æ–¹æ³•çš„ç¼“å­˜æ³¨è§£æä¾›é»˜è®¤å€¼ï¼ŒåŒ…æ‹¬: ç¼“å­˜çš„é»˜è®¤åç§° ç¼“å­˜çš„ KeyGenerator ä½¿ç”¨ RedisCacheé›†æˆRedisç¼“å­˜pom 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®application.properties: 1234spring.cache.type=REDISspring.redis.host=127.0.0.1spring.redis.port=6379spring.redis.password=Redis!123 ç¦æ­¢ç¼“å­˜é€šå¸¸åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œä¸éœ€è¦ä½¿ç”¨Redisç±»å‹çš„ç¼“å­˜ï¼Œä½ å¯ä»¥é…ç½®ä¸ºSimple,åŠ¨åˆ‡æ¢,ç”¨HashMapä½œä¸ºç¼“å­˜ï¼Œæˆ–è€…ä½¿ç”¨Noneç¦æ­¢ç¼“å­˜ä»¥æ–¹ä¾¿å¼€å‘ã€‚ å®šåˆ¶ç¼“å­˜å¯¹äº RedisCacheManageræ¥è¯´ï¼Œè¿˜å¯ä»¥å®šåˆ¶ç¼“å­˜é¡¹çš„å­˜æ´»æ—¶é—´ï¼Œç¼“å­˜åæ˜¯å¦åœ¨Redisä¸­åŠ ä¸Šå‰ç¼€ç­‰ï¼Œè¿™æ˜¯é€šè¿‡å®ç°CacheManagerCustomizeré…ç½®æ¥å®Œæˆå®šåˆ¶ Redis ç¼“å­˜åŸç†SpringBootçš„è‡ªåŠ¨é…ç›´ç±»RedisCacheConfigurationä¼šè‡ªåŠ¨æ£€æµ‹ spring.cache.typeçš„å€¼ï¼Œä»è€Œå†³å®šä½¿ç”¨ä½•ç§ç¼“å­˜ã€‚ å®ç°Redisä¸¤çº§ç¼“å­˜","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (13) Elasticsearch","slug":"SpringBoot2-D","date":"2018-12-22T10:33:39.000Z","updated":"2020-07-25T02:57:18.169Z","comments":true,"path":"2018/12/22/SpringBoot2-D/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-D/","excerpt":"","text":"Elasticsearch ä»‹ç»Elasticsearchï¼Œç®€ç§°ESã€‚æ˜¯ä¸€ä¸ªå…¨æ–‡æœç´¢æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸º NoSQLæ•°æ®åº“ï¼Œå­˜å‚¨ä»»æ„æ ¼å¼çš„æ–‡æ¡£å’Œæ•°æ®ï¼ŒåŒæ—¶ï¼Œä¹Ÿå¯ä»¥åšå¤§æ•°æ®çš„åˆ†æï¼Œæ˜¯ä¸€ä¸ªè·¨ç•Œå¼€æºäº§å“ã€‚ ESæœ‰å¦‚ä¸‹ç‰¹ç‚¹: å…¨æ–‡æœç´¢å¼•æ“ï¼Œ ESæ˜¯å»ºç«‹åœ¨ Lucene ä¸Šçš„å¼€æºæœç´¢å¼•æ“ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œ å…¨æ–‡æœç´¢ã€åœ°ç†ä¿¡æ¯æœç´¢ã€‚Wikipedia, GitHubã€ StackOverFlow ç­‰ç½‘ç«™å‡ä½¿ç”¨ ESã€‚ æ–‡æ¡£å­˜å‚¨å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥åƒNoSQLé‚£æ ·å­˜å‚¨ä»»æ„æ ¼å¼æ–‡æ¡£ï¼Œäº•èƒ½æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ–‡æ¡£ å¤§æ•°æ®åˆ†æï¼Œ ESå·ç§°èƒ½å‡†ç¡®å®æ—¶åœ°è¿›è¡Œå¤§æ•°æ®åˆ†æï¼Œæ•°æ®é‡ä»TBåˆ°PBï¼Œå›½å†…å¤–å¾ˆå¤šå¤§å…¬å¸éƒ½ç”¨ESåšå¤§æ•°æ®åˆ†æ ESæä¾›äº†RESTAPIï¼Œç”¨æ¥ç®€åŒ–å¯¹ESçš„æ“ä½œã€‚ å› æ­¤å¯ä»¥ä½¿ç”¨ä»»ä½•è¯­è¨€çš„å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¹Ÿæä¾› Java APIï¼Œ SpringBootä¹Ÿå¯¹ RESTAPIè¿›è¡Œäº†å°è£…ï¼Œç®€åŒ–äº†å¼€å‘ ESå¸¸å¸¸é…åˆä¼ ç»Ÿæ•°æ®åº“ä¸€èµ·ä½¿ç”¨ï¼Œ ESç”¨æ¥è´Ÿè´£å¤§æ•°æ®çš„æŸ¥è¯¢ã€æœç´¢ã€ç»Ÿè®¡åˆ†æ å®‰è£…JDK8+ www.elastic.co/downloads ä¸‹è½½ è§£å‹ elasticsearch-x.x.x.zip è¡Œ./bin/elasticsearch, ä¸èƒ½ä½¿ç”¨ rootç›´æ¥è¿è¡Œï¼Œæœ€å¥½ä¸ºè¿è¡Œ ES åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ· çœ‹åˆ°ä»¥ä¸‹æç¤ºï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸ 9200ç«¯å£æ˜¯å¯¹å¤–çš„ RESTFulæ¥å£ï¼Œ 9300ç«¯å£æ˜¯ ES å†…éƒ¨ä½¿ç”¨çš„ç«¯å£ æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® åŸºæœ¬æ¦‚å¿µ Index, Indexæ˜¯æ–‡æ¡£(Document)çš„é›†åˆï¼ŒIndexä¸‹é¢åŒ…å«äº† Typeï¼Œç”¨äºå¯¹ Document è¿›ä¸€æ­¥åˆ†ç±»ã€‚å¯ä»¥ç†è§£ä¸ºESä¸­çš„Indexç›¸å½“äºæ•°æ®åº“ï¼Œè€ŒTypeç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨ï¼ŒES ä¸­å¯ä»¥è½»æ˜“åœ°è”åˆIndexå’ŒTypeæ¥æœç´¢æ•°æ®ï¼Œæ•°æ®åº“å´ä¸èƒ½ã€‚ Typeï¼Œç”¨æ¥è¿›ä¸€æ­¥ç»„ç»‡Documentï¼Œä¸€ä¸ªIndexä¸‹å¯ä»¥æœ‰å¤šä¸ªTypeï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯æ˜¯ä¸€ ä¸ªTypeï¼Œç”¨æˆ·çš„æ”¯ä»˜è®°å½•æ˜¯ä¸€ä¸ªTypeã€‚ Documentï¼Œæ–‡æ¡£æ˜¯ESèƒ½å¤Ÿå­˜å‚¨å’Œæœç´¢çš„åŸºæœ¬ä¿¡æ¯ï¼Œç±»ä¼¼æ•°æ®åº“è¡¨è¡Œæ•°æ®ï¼ŒDocumentä¸ºJSONæ ¼å¼ï¼Œæ–‡æ¡£å±äºTypeã€‚ Node(èŠ‚ç‚¹)ï¼ŒèŠ‚ç‚¹æ˜¯é›†ç¾¤é‡Œçš„ä¸€å°ESServerï¼Œç”¨äºæ–‡æ¡£çš„å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚åº”ç”¨å¯ä»¥åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”±ä¸Šç™¾ä¸ªèŠ‚ç‚¹ç»„æˆé›†ç¾¤æ¥å­˜å‚¨å’Œæœç´¢æ•°æ®ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹åå­—ï¼Œä»¥åŠæ‰€å±é›†ç¾¤çš„åå­—ã€‚ é›†ç¾¤ï¼ŒåŒæ ·é›†ç¾¤åçš„èŠ‚ç‚¹å°†ç»„åˆä¸ºESé›†ç¾¤ï¼Œç”¨æ¥è”åˆå®Œæˆæ•°æ®çš„å­˜å‚¨å’Œæœç´¢ã€‚é»˜è®¤çš„é›†ç¾¤åå­—æ˜¯ elasticsearchã€‚ åˆ†åŒº(Shards)å’Œå¤åˆ¶(Replicas)ï¼Œæ¯ä¸ªIndexç†è®ºä¸Šéƒ½å¯ä»¥åŒ…å«å¤§é‡çš„æ•°æ®ï¼Œè¶…è¿‡äº†å•ä¸ªèŠ‚ç‚¹çš„å­˜å‚¨é™åˆ¶ï¼Œè€Œä¸”ï¼Œå•ä¸ªèŠ‚ç‚¹å¤„ç†é‚£ä¹ˆå¤§çš„æ•°æ®ï¼Œå°†æ˜æ˜¾é™åˆ¶å­˜å‚¨å’Œæœç´¢æ€§èƒ½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒESä¼šè¿›ä¸€æ­¥å°†Indexåœ¨ç‰©ç†ä¸Šç»†åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œè€Œä¸”è¿™äº›åˆ†åŒºä¼šæŒ‰ç…§é…ç½®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹Indexçš„åˆ†åŒºç§°ä¸ºä¸»åˆ†åŒº,å¤åˆ¶çš„åˆ†åŒºç§°ä¸ºå¤åˆ¶åˆ†åŒºã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ—¢ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œåˆæé«˜äº†æŸ¥è¯¢çš„æ€§èƒ½ã€‚ ä½¿ç”¨RESTè®¿é—® ElasticsearchES æ“ä½œåŸºæœ¬ä¸Šåˆ†ä¸ºä»¥ä¸‹å‡ ç±»: æ–‡æ¡£çš„å¢åˆ æ”¹æŸ¥ å…¨æ–‡æœç´¢ èšåˆæœç´¢ å¤„ç†äººç±»è¯­è¨€ åœ°ç†ä½ç½®æœç´¢ ä½¿ç”¨RestTemplateè®¿é—® ESSpring Data ElasticSpring Data Elasticæ˜¯Springå®˜æ–¹æä¾›çš„è®¿é—®ESçš„æ–¹å¼ï¼Œç›¸å¯¹äºç›´æ¥ RESTè®¿é—®ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿: å®Œå–„çš„å°è£…ï¼ŒSpring Data Elasticéµå¾ªSpring Dataè§„èŒƒï¼Œä½ åªè¦ä¼šä½¿ç”¨Spring Data,æ¯”å¦‚SpringJPAï¼Œå°±èƒ½ä½¿ç”¨ElasticDataã€‚ å±è”½äº†ES RESTæ¥å£çš„å¤æ‚æ€§ï¼Œå°±åƒè°ƒç”¨æ™®é€šæ–¹æ³•é‚£æ ·è°ƒç”¨ ElasticData, Springä¼šè‡ªåŠ¨è°ƒç”¨ Elasticåº•å±‚ APIæ¥å®ŒæˆæŸ¥è¯¢ã€‚ å®‰è£… Spring Dataä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;&lt;/dependency&gt; application.properties é…ç½®: 1spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300 Entity @Document è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª ElasticData, indexNameå’Œ typeå¯¹åº”äº Elasticsearch çš„Indexå’ŒType @Id å£°æ˜äº†æ–‡æ¡£çš„ä¸»é”®ï¼ŒåŒ SpringDataä¸€è‡´ DaoDaoç»§æ‰¿äº†Spring Data çš„CrudRepositoryï¼Œå› æ­¤è‡ªå¸¦äº†ç®€å•çš„å¢,åˆ ,æ”¹,æŸ¥æ“ä½œ","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (12) Redis","slug":"SpringBoot2-C","date":"2018-12-22T09:29:50.000Z","updated":"2020-07-25T02:57:18.169Z","comments":true,"path":"2018/12/22/SpringBoot2-C/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-C/","excerpt":"","text":"Redis(REmote Dictionary Server)æ˜¯ä¸€ä¸ªå¼€æº (BSDè®¸å¯)ã€å†…å­˜å­˜å‚¨çš„æ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå¯ç”¨ä½œæ•°æ®åº“æ¥å­˜å‚¨Key-Valueæ•°æ®ï¼Œå®ƒæ”¯æŒå­—ç¬¦ä¸²ã€å“ˆå¸Œè¡¨ã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆã€ä½å›¾ã€åœ°ç†ç©ºé—´ä¿¡æ¯ç­‰æ•°æ®ç±»å‹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºé«˜é€Ÿç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—ä»£ç†ã€‚ å®‰è£… Rediså®˜ç½‘ä¸‹è½½, è§£å‹åï¼Œè¿›å…¥srcç›®å½•ï¼Œè¿è¡Œmakeè¿›è¡Œç¼–è¯‘ Rediså®‰è£…å®Œæ¯•ï¼Œåœ¨srcç›®å½•ä¸‹æœ‰ä»¥ä¸‹ä¸¤ä¸ªå¸¸ç”¨å‘½ä»¤: redis-server, å¯åŠ¨ RedisæœåŠ¡å™¨ï¼Œé»˜è®¤ä¼šç›‘å¬6379ç«¯å£ redis-cli, Redis è‡ªå¸¦çš„å®¢æˆ·ç«¯ç®¡ç†å·¥å…· redis-cliRedis ä¸€å…±æœ‰ 14 ä¸ªå‘½ä»¤ç»„ã€ä¸¤ç™¾å¤šä¸ªå‘½ä»¤ è¿è¡Œ./redis-cliï¼Œè¿›å…¥Rediså®¢æˆ·ç«¯ç®¡ç†å·¥å…· pingå‘½ä»¤ï¼Œç”¨æ¥æ£€éªŒ RedisæœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ŒæœåŠ¡å™¨è¿”å›PONGæ¥åº”ç­”æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ å®‰å…¨è®¾ç½®redis.conf æ–‡ä»¶ 1requirepass Redis!123 å¯åŠ¨æœåŠ¡å™¨ 1./redis-server ../redis.conf åŸºæœ¬æ“ä½œ setå‘½ä»¤å¯ä»¥æ·»åŠ /è¦†ç›–ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ•°å­—ç±»å‹ get æ¥è·å–å…¶å€¼ mgetæ¥è·å–å¤šä¸ªkeyçš„å€¼ Keyï¼Œé€šå¸¸éƒ½æ˜¯åŒ…å«é€»è¾‘ä¸Šçš„å‘½åç©ºé—´ï¼Œç”¨ç¬¦å·:åˆ†å¼€ å¯¹äºæ•°å­—ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰ä»¥ä¸‹å‘½ä»¤å¯ä»¥å¯¹å…¶è¿›è¡Œç®—æ•°æ“ä½œ: DECR/INCRï¼Œæ•°å­—ç±»å‹æ•°æ®è‡ªå‡å’Œè‡ªå¢ DECRBY/INCRBYï¼Œæ•°å­—ç±»å‹æ•°æ®å‡å»æŸä¸ªæŒ‡å®šçš„æ•´æ•°æˆ–è€…å¢åŠ æŸä¸ªæŒ‡å®šæ•´æ•° INCRBYFLOATï¼Œæ•°å­—å¢åŠ  ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè´Ÿæ•°è¡¨ç¤ºå‡å» keysKey æ˜¯äºŒè¿›åˆ¶æ•°ï¼Œå› æ­¤å­—ç¬¦ä¸²å’Œå›¾ç‰‡éƒ½å¯ä»¥ä½œä¸ºKeyï¼Œå¯ä»¥é€šè¿‡keyså‘½ä»¤æ¥æŸ¥è¯¢ Redisä¸­æ‰€æœ‰çš„Key Key åé¢å¯ä»¥ç”¨*æˆ–è€…?: Platform:*, åŒ¹é…platform:å¼€å¤´çš„Key pl?tform, åŒ¹é… platformæˆ–è€…pletform *, æŸ¥è¯¢æ‰€æœ‰çš„ keys exist æ¥åˆ¤æ–­ Key æ˜¯å¦å­˜åœ¨ del å‘½ä»¤åˆ é™¤ Key-Value expire è®¾å®š Key çš„è¶…æ—¶æ—¶é—´ ttl å‘½ä»¤åˆ™ç”¨äºæŸ¥çœ‹ Key çš„å­˜æ´»æ—¶é—´ Redis ListRedis Listç±»å‹ç±»ä¼¼Javaçš„LinkedListï¼Œé€šè¿‡é“¾è¡¨æ¥å®Œæˆï¼Œå‘å…¶æ·»åŠ å…ƒç´ é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æŒ‰ç…§ç´¢å¼•æ–¹å¼è·å–å…ƒç´ æ¯”è¾ƒæ…¢ rpush å¯ä»¥å°†å¤šä¸ªå€¼æ”¾å…¥listå°¾éƒ¨ lpush å¯ä»¥å°†å¤š ä¸ªå€¼æ”¾åˆ°listå¤´éƒ¨ lrange ä»å·¦åˆ°å³æ˜¾ç¤ºæŒ‡å®šèŒƒå›´çš„åˆ—è¡¨ rpop å‘½ä»¤å¯ä»¥ä»åˆ—è¡¨å°¾éƒ¨å–å‡ºä¸€ä¸ªå…ƒç´  lpop å–å‡ºåˆ—è¡¨çš„å¤´ä¸€ä¸ªå…ƒç´  lien ç”¨æ¥è¿”å›Listçš„é•¿åº¦ Redis HashReids Hash ç±»ä¼¼Javaçš„HashMapï¼Œå…è®¸å­˜æ”¾å¤šä¸ª Key-Value Hash æœ‰ä»¥ä¸‹æŒ‡ä»¤ hset key field valueï¼Œç»™æŒ‡å®šçš„ Keyè®¾ç½®ä¸€ä¸ªå­—æ®µå€¼ï¼Œå¦‚æœå€¼å·²ç»å­˜åœ¨ï¼Œåˆ™è¦†ç›–ã€‚è¿”å›0è¡¨ç¤ºå¤±è´¥ï¼Œè¿”å›1è¡¨ç¤ºæˆåŠŸ hget key filedï¼Œè·å–æŒ‡å®š Key çš„ filed å­—æ®µçš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å› nil hexists key filedï¼Œåˆ¤æ–­æŒ‡å®šçš„ Key çš„è‡ªled å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œè¿”å› 1 è¡¨ç¤ºå­˜åœ¨ï¼Œ0 è¡¨ç¤ºä¸å­˜åœ¨ hkeys keyï¼Œè¿”å› Key æ‰€æŒ‡å®šçš„ hash æ‰€æœ‰çš„å­—æ®µåã€‚ hgetall keyï¼Œè¿”å›æ‰€æœ‰çš„å­—æ®µåå’Œ å­—æ®µå€¼ hdel key field [field]ï¼Œåˆ é™¤å¤šä¸ªå­—æ®µ Hash çš„å­—æ®µæ”¯æŒé€’å¢è®¡ç®—ï¼Œè¿™è·ŸåŸå§‹ç±»å‹æ“ä½œä¸€æ ·ï¼Œæ˜¯åŸå­æ“ä½œ hincby key field valueï¼Œå¯¹KeyæŒ‡å®šçš„Hashæ•°æ®ä¸­çš„fieldçš„å€¼è¿›è¡Œè®¡ç®—ï¼Œå¢åŠ æ•´å‹ value hincbyfloat key field valueï¼Œå¯¹ KeyæŒ‡å®šçš„ Hashæ•°æ®ä¸­çš„fieldçš„å€¼è¿›è¡Œè®¡ç®—ï¼Œå¢åŠ æµ®ç‚¹æ•° value SetSetä¸Javaä¸­çš„Java.util.Setç±»ä¼¼ï¼Œä»£è¡¨äº†å…ƒç´ ä¸é‡å¤çš„é›†åˆï¼ŒRedisçš„Seté™¤äº†å…ƒç´ æ·»åŠ åˆ é™¤æ“ä½œï¼Œè¿˜åŒ…å«äº†é›†åˆçš„äº•é›†ã€äº¤é›†ç­‰åŠŸèƒ½ sadd key member [member ..]ï¼Œæ·»åŠ å…ƒç´ ï¼Œæ¯”å¦‚ sadd ip 192.168.0.1ï¼Œå‘ ip é›†åˆæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå€¼æ˜¯ 192.168.0.1 srem key member [member ..]ï¼Œåˆ é™¤å…ƒç´  smemberkeyï¼Œè¿”å›ä¸€ä¸ªé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´  sinter key1 key2ï¼Œè¿”å›ä¸¤ä¸ªé›†åˆå…±åŒçš„å…ƒç´ ï¼Œkey1 å’Œ key2 åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªé›†åˆ sinterstore key1 key2 key3ï¼Œå–çš„ keyl å’Œ key2 çš„äº¤é›†ï¼Œäº•å­˜æ”¾åˆ°key3é›†åˆä¸­ sunion key1 key2ï¼Œ è¿”å›ä¸€ä¸ªåˆå¹¶å çš„é›†åˆ sunionstore key1 key2 key3ï¼Œåˆå¹¶key1å’Œkey2é›†åˆï¼Œå¹¶å­˜æ”¾åˆ°key3é›†åˆä¸­ Pub/SubReids é™¤äº†NoSQLç‰¹æ€§ï¼Œè¿˜æä¾›äº†ç®€å•çš„æ¶ˆæ¯æœåŠ¡ï¼Œæ”¯æŒpublish/subscribeã€‚ Redis å®¢æˆ·ç«¯ å¯ä»¥è®¢é˜… ä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢‘é“( Channel)ï¼Œè¿™ç§è¡Œä¸ºè¢«ç§°ä¸º subscribeã€‚å…¶ä»– Redis å®¢æˆ·ç«¯å‘è¿™äº›Channelå‘é€æ¶ˆæ¯ï¼Œç§°ä¸ºpublishï¼Œè®¢é˜…è¿™äº›é¢‘é“çš„å®¢æˆ·ç«¯èƒ½æ¥æ”¶åˆ°è¿™äº›æ¶ˆæ¯ Spring Booté›†æˆ Redisä¾èµ–: 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½® application.properties 12345spring.redis.host=127.0.0.1spring.redis.password=Redis!123spring.redis.port=6379#æœ€å¤§è¿æ¥æ•°,æ–°ç‰ˆæœ¬å·²ç»å–æ¶ˆ#spring.redis.pool.max-active=8 StringRedisTemplate æ˜¯Spring Booté»˜è®¤æä¾›çš„ Redis æ“ä½œæ¥å£ ï¼Œé€‚åˆKeyå’ŒValueéƒ½æ˜¯å­—ç¬¦ä¸²çš„æƒ…å†µ ä¹Ÿå¯ä»¥é‡‡ç”¨JDK åºåˆ—åŒ–çš„æ–¹å¼æ¥åºåˆ—åŒ–Keyå’ŒValueçš„ RedisTemplateç±»ï¼Œè¿™ æ˜¯ä¸€ä¸ªé€šç”¨ç±»ï¼Œå…¶å®ç°å¯ä»¥æä¾›ä¸åŒçš„åºåˆ—åŒ–æ–¹å¼ ä½¿ç”¨ StringRedisTemplateopsFor opsForValue, ç”¨æ¥è®¾ç½®æ™®é€šçš„ Key-Value opsForList ç”¨æ¥æ“ä½œ Listç»“æ„ opsForList æä¾›äº† lefPushã€leftPushAllã€leftPopã€rightPushã€ rightPushAIIã€ rightPop ç­‰æ“ä½œï¼Œä¹Ÿæä¾›äº† rangeæ“ä½œä¸ sizeæ“ä½œï¼Œç”¨äºæŸ¥çœ‹ Listçš„é•¿åº¦ opsForHashï¼Œç”¨æ¥æ“ä½œ Hash æ•°æ®ç»“æ„ ç»‘å®šKeyçš„æ“ä½œå¯ä»¥é€šè¿‡RedisTemplate æä¾›çš„boundXXXOps()æ¥æŒ‡å®šä¸€ä¸ªKeyï¼Œè¿”å›BoundXXXOperationsã€‚è¿™æ ·åœ¨BoundXXXOperationsä¸Šçš„æ“ä½œå°±ä¸éœ€è¦æä¾›Keyä½œä¸ºå‚æ•° boundValueOps boundListOps boundHashOps boundSetOps boundZSetOps boundGeoOps RedisConnectionRedisConnectionæä¾›äº†ä½çº§åˆ«çš„APIæ“ä½œï¼Œç”¨ byteæ•°ç»„ä½œä¸ºå‚æ•°æ“ä½œ RedisæœåŠ¡å™¨ã€‚ Pub/Sub convertAndSend æ–¹æ³•ç”¨äºå‘channalå‘é€æ¶ˆæ¯ è®¢é˜…æ¶ˆæ¯ï¼Œéœ€è¦å®ç°MessageListenerçš„onMessageæ–¹æ³• åºåˆ—åŒ–ç­–ç•¥ RedisTemplateåˆ™é‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ–ç­–ç•¥ JdkSerializationRedisSerializerï¼Œè¿™ä¸¤ç§åºåˆ—åŒ–ç­–ç•¥ éƒ½å®ç°äº† RedisSerializeræ¥å£","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (11) MongoDB","slug":"SpringBoot2-B","date":"2018-12-22T07:43:19.000Z","updated":"2020-07-25T02:57:18.168Z","comments":true,"path":"2018/12/22/SpringBoot2-B/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-B/","excerpt":"","text":"æ”¯æŒå„ç§ç¼–ç¨‹è¯­è¨€ï¼Œ Javaã€ C++ã€ PHPã€ C#ã€ Python ç­‰ é¢å‘æ–‡æ¡£å­˜å‚¨ï¼Œæ–‡æ¡£æ ¼å¼æ˜¯ç±»ä¼¼ JSON çš„ BSON æ ¼å¼ æä¾›ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒå¯¹æ•°æ®å»ºç«‹ç´¢å¼• æ¨¡å¼è‡ªç”±ï¼Œä¸éœ€è¦äº‹å…ˆå®šä¹‰æ–‡æ¡£æ ¼å¼ï¼Œå¯ä»¥ä»»æ„æ”¹å˜æ–‡æ¡£æ ¼å¼ å®‰è£… MongoDBè¿›å…¥ bin ç›®å½•ï¼Œæœ‰ä»¥ä¸‹å¸¸ç”¨å‘½ä»¤: mongodï¼Œå¯åŠ¨ MongoDB æ•°æ®åº“ã€‚é€šå¸¸éœ€è¦æŒ‡å®šä¸€ä¸ªæ•°æ®å­˜æ”¾çš„ç›®å½•ï¼Œé»˜è®¤æ˜¯/data/dbã€‚ å¦‚æœå¯åŠ¨çš„æ—¶å€™æ²¡æœ‰åˆ›å»º/data/å·¾ ï¼Œåˆ™ä¼šå¯åŠ¨å¤±è´¥ã€‚å¯ä»¥é€šè¿‡--dbpath å‚æ•°æŒ‡å®šç‰¹å®šçš„ç›®å½•ï¼Œå‚æ•°è¯¦æƒ…å¯ä»¥é”®å…¥./mongod --help mongoï¼Œå¯åŠ¨ä¸€ä¸ª Shell ./mongoï¼Œé€šè¿‡ shellå¯ä»¥å¯¹ MongoDBè¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œ mongodumpï¼Œå¤‡ä»½æ•°æ®åº“ mongorestoreï¼Œæ¢å¤æ•°æ®åº“ ä½¿ç”¨ shellSpring Booté›†æˆ MongoDB1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;&lt;/dependency&gt; 1spring.data.mongodb.uri=mongodb://127.0.0.1:27017/baike å¢åˆ æ”¹æŸ¥MongoTemplate insert save findByid find, Criteria ç±»æ„é€ æŸ¥è¯¢æ¡ä»¶ query update remove execute æ‰“å°æ—¥å¿—1logging.level.org.springframework.data=debug","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (10) REST","slug":"SpringBoot2-A","date":"2018-12-22T07:16:11.000Z","updated":"2020-07-25T02:57:18.168Z","comments":true,"path":"2018/12/22/SpringBoot2-A/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-A/","excerpt":"","text":"REST ç®€ä»‹RESTï¼Œå³Representational State Transferçš„ç¼©å†™ï¼Œç¿»è¯‘ä¸ºè¡¨ç°å±‚çŠ¶æ€è½¬åŒ– èµ„æº: ç½‘ç»œä¸Šçš„ä¸€ä¸ªå®ä½“, ä»¥ç”¨ ä¸€ä¸ª Ué˜³(ç»Ÿä¸€ èµ„æºå®šä½ç¬¦ã€‰æŒ‡å‘å®ƒï¼Œæ¯ç§èµ„æºå¯¹åº”ä¸€ä¸ªç‰¹å®šçš„ URI è¡¨ç°å±‚: â€œèµ„æºâ€å…·ä½“å‘ˆç°å‡ºæ¥çš„ å½¢å¼ç§°ä¸ºå®ƒçš„â€œè¡¨ç°å±‚â€( Representation) çŠ¶æ€è½¬åŒ–: æœåŠ¡å™¨ç«¯å‘ç”Ÿâ€œçŠ¶æ€è½¬åŒ–â€( State Transfer)ã€‚ è€Œè¿™ç§è½¬åŒ–æ˜¯å»ºç«‹åœ¨è¡¨ç°å±‚ä¹‹ä¸Šçš„ REST é£æ ¼çš„æ¶æ„ ä½¿ç”¨apiä½œä¸ºWebä¸Šä¸‹æ–‡ å¢åŠ ç‰ˆæœ¬æ ‡è¯† æ ‡è¯†èµ„æº RESTä¸­çš„ HTTP Method RESTä¸­çš„ HTTP Status ä½¿ç”¨apiä½œä¸ºWebä¸Šä¸‹æ–‡http://xxx.com/api æˆ– http://api.xxx.com å¢åŠ  ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†http://xxx.com/api/v1.1 æ ‡è¯†èµ„æºå°†èµ„æºåç§°æ”¾åˆ°URLä¸­ï¼Œå¦‚æœèµ„æºæœ‰å±‚çº§å…³ç³»ï¼Œåˆ™æ”¾å…¥å±‚çº§å…³ç³» HTTP Method POST ï¼Œä»£è¡¨å¢åŠ èµ„æº PUTï¼Œä»£è¡¨æ›´æ”¹èµ„æºï¼Œå®¢æˆ·ç«¯æä¾›éœ€å®Œæ•´çš„èµ„æºå±æ€§ GETï¼Œä»£è¡¨æŸ¥è¯¢èµ„æº PATCHï¼Œæ›´æ–°èµ„æºï¼Œå®¢æˆ·ç«¯æä¾›ä»…éœ€è¦æ›´æ”¹çš„èµ„æºå±æ€§; DELETEï¼Œé€šå¸¸ç”¨äºåˆ é™¤èµ„æº HEADï¼Œç±»ä¼¼ GETï¼Œä½†ä»…ä»…åªæœ‰ HTTP å¤´ä¿¡æ¯ï¼Œå¤´ä¿¡æ¯åŒ…å«äº†éœ€è¦æŸ¥æ‰¾çš„ä¿¡æ¯ OPTIONSï¼Œç”¨äºè·å– URIæ‰€æ”¯æŒçš„æ–¹æ³•ï¼Œå“åº”ä¿¡æ¯ä¼šåœ¨ HTTP å¤´ä¸­åŒ…å«ä¸€ä¸ªåä¸ºâ€Allowâ€çš„å¤´ï¼Œå€¼æ˜¯æ‰€æ”¯æŒçš„æ–¹æ³•ï¼Œå¦‚â€GET,POSTâ€ HTIP Status 200,0Kï¼Œç”¨æˆ·è¯·æ±‚æˆåŠŸï¼Œå¦‚æŸ¥è¯¢æ•°æ®æˆåŠŸè¿”å› ã€‚ 400ï¼Œé”™è¯¯çš„çš„è¯·æ±‚ï¼Œåœ¨ç¬¬ 3 ç«  ä¸­ï¼Œ URI åŒ¹é…ä¸Š Spring Boot ä¸­çš„ Controllerï¼Œä½†æ–¹æ³•å‚ æ•°åŒ¹é…é”™è¯¯ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ 404 NOT Foundï¼Œç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„èµ„æºä¸å­˜åœ¨ï¼Œé€šå¸¸æ˜¯ Spring Boot ä¸­çš„ Controller æ²¡æœ‰åŒ¹é…ä¸ŠURIï¼Œæˆ–è€…åŒ¹é…ä¸Šäº† Controlleræ–¹æ³•ï¼Œä½†æ¸²æŸ“çš„è§†å›¾ä¸å­˜åœ¨ã€‚ 405ï¼Œç”¨æ¥è®¿é—®æœ¬é¡µé¢çš„ HTTP Method ä¸è¢«å…è®¸ï¼Œæ¯”å¦‚é€šè¿‡ HTTP GET æ–¹å¼è®¿é—®äº†ä¸€ä¸ª@PostMapping çš„Controlleræ–¹æ³•ã€‚ 406ï¼Œè¡¨ç¤ºæ— æ³•ä½¿ç”¨è¯·æ±‚çš„ å†…å®¹ç‰¹æ€§æ¥å“åº”è¯·æ±‚çš„èµ„æºï¼Œæ¯”å¦‚åœ¨ Spring Boot ä¸­ï¼Œ è¯·æ±‚ åç¼€ä»¥ html ç»“å°¾ï¼Œä½†åŒæ—¶è¯·æ±‚çš„ HTTP å¤´ä¸­åˆåŒ…å«äº† Accept:application/json 500ï¼ŒæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ï¼Œé€šå¸¸æ˜¯ ControlleræŠ›å‡ºçš„å¼‚å¸¸ é›†æˆ REST1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; @RestController@Controllerå’Œ@ResponseBody çš„ç»„åˆ REST ClientRestTemplateå®šåˆ¶ RestTemplateåˆ›å»ºä¸€ä¸ªé…ç½®ç±»å®ç° RestTå·³mplateCustornizeræ¥å£çš„customizeæ–¹æ³• Swagger UIé›†æˆ SwaggerSwagger è§„èŒƒ","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (9) å•å…ƒæµ‹è¯•","slug":"SpringBoot2-9","date":"2018-12-22T07:13:40.000Z","updated":"2020-07-25T02:57:18.168Z","comments":true,"path":"2018/12/22/SpringBoot2-9/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-9/","excerpt":"","text":"","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (8) éƒ¨ç½²","slug":"SpringBoot2-8","date":"2018-12-22T06:53:27.000Z","updated":"2020-07-25T02:57:18.168Z","comments":true,"path":"2018/12/22/SpringBoot2-8/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-8/","excerpt":"","text":"Spring Boot åº”ç”¨éƒ¨ç½²é€šå¸¸ä¼šé¢ä¸´å¤šä¸ªéƒ¨ç½²ç¯å¢ƒï¼Œå¦‚æµ‹è¯•ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒã€æ¼”ç¤ºç¯å¢ƒç­‰ ä»¥ jaræ–‡ä»¶è¿è¡ŒSpringBooté»˜è®¤ä»¥jaråŒ…æ–¹å¼è¿è¡Œï¼Œ å¯ä»¥åœ¨ Mavené…ç½®å¦‚ä¸‹æ’ä»¶ï¼Œå°† SpringBootå¯¼å‡ºæˆå¯æ‰§è¡Œ çš„ jar æ–‡ä»¶ 123456789&lt;!-- Package as an executable jar --&gt;&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; åœ¨å·¥ç¨‹ç›®å½•ä¸‹çš„è¿è¡Œå‘½ä»¤è¡Œä¸­è¿è¡Œ mvn package jaræ–¹å¼è¿è¡Œ: 1java -jar target/target/xxx.x-0.0.1-SNAPSHOT.jar ä»¥warä¸‡å¼éƒ¨ç½²å°† SpringBootåº”ç”¨æ‰“æˆä¸€ä¸ª waråŒ…ï¼Œéƒ¨ç½²åˆ° Tomcat ã€JettyæœåŠ¡å™¨ï¼Œæˆ–è€…å•†ä¸šçš„ Weblogicã€ Websphere ä¸Š å¤šç¯å¢ƒéƒ¨ç½²æµ‹è¯•ç¯å¢ƒã€å‡†çº¿ä¸Šç¯å¢ƒ ã€ æ¼”ç¤ºç¯å¢ƒç­‰ ç¯å¢ƒå¯¹åº”äº†ä¸åŒçš„é…ç½®è¦æ±‚ï¼Œé€šå¸¸æœ‰: æ•°æ®åº“çš„è®¿é—®åœ°å€ä¸åŒï¼Œæ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ä¹Ÿä¸åŒï¼Œè¿æ¥æ± çš„é…ç½®ä¹Ÿå¤§ä¸ä¸€æ ·ï¼Œå¼€å‘ç¯å¢ƒå¯èƒ½åªé…ç½®5ä¸ªè¿æ¥ï¼Œè€Œçº¿ä¸Šç¯å¢ƒåˆ™å¤šè¾¾æ•°ç™¾ä¸ªã€‚ æ—¥å¿—é…ç½®ä¸åŒï¼Œå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒçš„æ—¥å¿—çº§åˆ«å¯èƒ½æ˜¯ debug çº§åˆ«, æ—¥å¿—ä¿¡æ¯ä¹Ÿå¸¸å¸¸åŒ…å« ä»£ç æ‰€åœ¨è¡Œï¼Œè€Œçº¿ä¸Šç¯å¢ƒ åˆ™ é€šå¸¸æ˜¯ INFO çº§åˆ« ï¼Œä¸”ä¸ºäº†æ€§èƒ½è€ƒè™‘ä¸ä¼šè¾“å‡ºæ—¥å¿—æ‰€åœ¨è¡Œã€‚å¦å¤–ï¼Œå¯¹æ—¥å¿—æ–‡ä»¶è¦æ±‚ä¹Ÿä¸å°½ç›¸åŒï¼Œ çº¿ä¸Šç¯å¢ƒè¦æ±‚æ—¥å¿—æ–‡ä»¶èƒ½å®šæ—¶æ‰“åŒ…å‹ç¼©ï¼Œ å¼€å‘ç¯ å¢ƒåˆ™å¾€å¾€ä¸ä¼šé…ç½®æ—¥å¿—æ–‡ä»¶ã€‚ è®¿é—®çš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿä¸ä¸€æ ·ï¼Œå¤æ‚çš„åº”ç”¨é€šå¸¸è¦è®¿é—®ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œå¦‚ç³»ç»Ÿå†…çš„ Redis ç¼“å­˜ï¼Œé€šè¿‡ RESTè®¿é—®å…¶ä»– SpringBootåº”ç”¨ï¼Œè¿™éƒ½éœ€è¦é…ç½®ä¸åŒçš„ IPåœ°å€ã€‚ ä¸åŒçš„ç¯å¢ƒæœ‰ä¸åŒçš„å¼€å…³å±æ€§ï¼Œæ¯”å¦‚å¼€å‘ç³»ç»Ÿï¼Œéœ€è¦å…³é—­çŸ­ä¿¡ã€å¾®ä¿¡çš„é€šçŸ¥åŠŸèƒ½ ï¼Œè€Œæ¼”ç¤ºç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒåˆ™éœ€è¦æ‰“å¼€è¿™äº›é…ç½® application-{profile}.propertiesçš„é…ç½®æ–‡ä»¶, å…¶ä¸­profileå¯ä»¥æ˜¯ä»»æ„åå­—ï¼Œæ¯”å¦‚: testï¼Œ è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ prodï¼Œè¡¨ç¤ºçº¿ä¸Šç¯å¢ƒ pre-prodï¼Œ é¢„å‘å¸ƒç¯å¢ƒ demo1.0 1.0ç‰ˆæœ¬æ¼”ç¤ºç¯å¢ƒ åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œspring.profiles.active æŒ‡å®šä½¿ç”¨å“ªä¸ª profile æ¯”å¦‚: 1java -jar -Dspring.profiles.active=prod target/xxx-0.0.1-SNAPSHOT.jar @Profileæ³¨è§£ @Profile æ³¨è§£ä»¥å†³å®šé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆ @Profile æ³¨è§£å¯ä»¥æ”¯æŒä½¿ç”¨å¤šç§ profileï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€œ!â€æ¥æ’é™¤ç‰¹å®š profile @Profile({â€œtestâ€, â€œprodâ€})ï¼Œæµ‹è¯•ç¯å¢ƒå’Œçº¿ä¸Šç¯å¢ƒç”Ÿæ•ˆ @Profile({â€œtestâ€, â€œ!prodâ€})ï¼Œæµ‹è¯•ç¯å¢ƒå’Œéçº¿ä¸Šç¯å¢ƒç”Ÿæ•ˆ","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (7) é…ç½®","slug":"SpringBoot2-7","date":"2018-12-22T06:18:24.000Z","updated":"2020-07-25T02:57:18.168Z","comments":true,"path":"2018/12/22/SpringBoot2-7/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-7/","excerpt":"","text":"é…ç½® Spring Bootapplication.properties æœåŠ¡å™¨é…ç½® server.address æœåŠ¡å™¨IP ç»‘å®šåœ°å€ï¼Œå¦‚æœä½ çš„ä¸»æœºä¸Šæœ‰å¤šä¸ªç½‘å¡ï¼Œå¯ä»¥ç»‘å®šä¸€ä¸ª IP åœ°å€ server.session.timeout ä¼šè¯è¿‡æœŸæ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ server.eÎ·or.path æœåŠ¡å™¨å‡ºé”™åçš„å¤„ç†è·¯å¾„/error server.servlet contextpath Spring Bootåº”ç”¨çš„ä¸Šä¸‹æ–‡ server.port Spring Boot åº”ç”¨ç›‘å¬ç«¯å£ ä½¿ç”¨å…¶ä»– Web æœåŠ¡å™¨Spring Boot å†…ç½®äº† Tomcatï¼ŒåŒæ—¶è¿˜æ”¯æŒJettyã€Undertow ä½œä¸º Web æœåŠ¡å™¨ã€‚ä½¿ç”¨è¿™äº›åº”ç”¨ æœåŠ¡å™¨ï¼Œ åªéœ€è¦å¼•å…¥ç›¸åº”çš„ starter é…ç½®å¯åŠ¨ä¿¡æ¯ å¯ä»¥åœ¨ classpath ä¸­å¢åŠ  banner.txtï¼Œ æ˜¾ç¤ºä½ è‡ªå·±çš„è¾“å‡ºä¿¡æ¯ï¼Œåœ¨ Spring Boot é¡¹ç›®çš„ resources ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª banner.txt å¯ä»¥è®¾ç½® banner.gif(png,jpg)ï¼Œæ§åˆ¶å°è‡ªåŠ¨å°†å›¾ç‰‡è½¬ä¸º ASCII å­—ç¬¦ï¼Œä½œä¸ºå¯åŠ¨ä¿¡æ¯è¾“å‡º banner.charset=UTF-8 # banner.txt å­—ç¬¦é›† banner.location=classpath:banner.txt banner.image.location=classpath:banner.gif #å¦‚é‡‡ä½¿ç”¨å›¾ç‰‡ï¼Œå›¾ç‰‡çš„ä½ç½®å¯ä»¥ä½¿ç”¨ jpg/ png banner.image.width=76 #å›¾ç‰‡å®½åº¦ï¼Œè¿™é‡ŒæŒ‡è½¬ä¸ºå­—ç¬¦çš„ä¸ªæ•°ï¼Œè¶Šå¤šè¶Šæ¸…æ¥š banner.image.height=76 #å›¾ç‰‡é•¿åº¦ banner.image.margin=2 #å›¾ç‰‡ä¸å·¦è¾¹çš„è¾¹è·ï¼Œé»˜è®¤ä¸º 2 ä¸ªå­—ç¬¦ é…ç½®æµè§ˆå™¨æ˜¾ç¤º icoåœ¨é¡¹ç›®çš„ resources ç›®å½•ä¸‹æ–°å»ºä¸€ ä¸ª static ç›®å½•ï¼Œåœ¨ static ç›®å½•ä¸‹åˆ›å»º images ç›®å½•(æˆ–è€…ä»»æ„æ”¾ç½®å›¾ç‰‡çš„ç›®å½•)ï¼Œç„¶åå°†é¡¹ç›®çš„ favicon.ico æ”¾åœ¨ images ç›®å½•ä¸‹ï¼Œæ¯ä¸ªé¡µé¢æ·»åŠ ä»¥ä¸‹æ ·å¼å³å¯: 1&lt;link rel=\"shortcut icon\" href=\"/images/apple.ico\"&gt; æ—¥å¿—é…ç½®é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å¯¹æ—¥å¿—åšä»»ä½•é…ç½®å°±å¯ä»¥ä½¿ç”¨ï¼Œ Spring Boot ä½¿ç”¨ LogBack ä½œä¸ºæ—¥å¿—çš„å®ç°ï¼Œä½¿ç”¨ apacheCommons Loggingä½œä¸ºæ—¥å¿—æ¥å£ 123456logging.level.root=infologging.level.org.springframework=infologging.level.com.bee.sample=debuglogging.file = my.loglogging.pattern.console=%level %date&#123;HH:mm:ss&#125; %logger&#123;20&#125;.%M %L :%m%nlogging.pattern.file= %level %date&#123;ISO8601&#125; [%thread] %logger&#123;20&#125;.%M %L :%m%n è¯»å–åº”ç”¨é…ç½®EnvironmentEnvironmentæ˜¯ä¸€ä¸ªé€šç”¨ çš„è¯»å–åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡çš„ç±»ï¼Œå¯ä»¥è¯»å– application.propertiesã€å‘½ä»¤è¡Œè¾“å…¥å‚æ•°ã€ç³»ç»Ÿå±æ€§ã€æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ç­‰ã€‚ @Valueç›´æ¥é€šè¿‡@Valueæ³¨è§£æ³¨å…¥ä¸€ä¸ªé…ç½®ä¿¡æ¯åˆ° Springç®¡ç†çš„ Bean ä¸­ @ConfigurationPropertieså°†ä¸€ç»„åŒæ ·ç±»å‹çš„é…ç½®å±æ€§æ˜ å°„ä¸ºä¸€ä¸ªç±»æ›´ä¸ºæ–¹ä¾¿ Spring Boot è‡ªåŠ¨è£…é…@Configuration å’Œ@Beanæ³¨è§£@Configuration, å‘ Spring è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç±»é‡Œçš„æ‰€æœ‰å¸¦@Beanæ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢« Springè°ƒç”¨ï¼Œè¿”å›å¯¹è±¡å°†ä¼šä½œä¸ºä¸€ä¸ª Springå®¹å™¨ç®¡ç†çš„ Bean Beanæ¡ä»¶è£…é…@ConditionalOnBeanï¼Œåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨æŸä¸ªå¯¹è±¡æ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–ä¸€ä¸ª Bean@ConditionalOnMissingBeanï¼Œ åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨æŸä¸ªå¯¹è±¡æ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–ä¸€ä¸ª Bean Classæ¡ä»¶è£…é…Classæ¡ä»¶è£…é…æ˜¯æŒ‰ç…§æŸä¸ªç±»æ˜¯å¦åœ¨ Classpath ä¸­æ¥å†³å®šæ˜¯å¦è¦é…ç½® Beanã€‚@ConditionalOnClassè¡¨ç¤ºå½“ classpath æœ‰æŒ‡å®šçš„ç±»æ—¶ï¼Œé…ç½®ç”Ÿæ•ˆ Environment è£…é…å¯ä»¥æ ¹æ® Spring Boot çš„ Environment å±æ€§æ¥å†³å®šé…ç½®æ˜¯å¦ç”Ÿæ•ˆ å…¶ä»–æ¡ä»¶è£…é… ConditionalOnExpressionï¼Œå½“è¡¨è¾¾å¼ä¸º true æ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–ä¸€ä¸ª Beanï¼Œæ”¯æŒ SpEL è¡¨è¾¾å¼ï¼Œæ¯”å¦‚æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„æŸä¸ªå€¼æ¥å†³å®šé…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚ ConditionalOnJavaï¼Œå½“å­˜åœ¨æŒ‡å®šçš„ Java ç‰ˆæœ¬çš„æ—¶å€™ è”åˆå¤šä¸ªæ¡ä»¶Condition æ¥å£åˆ¶ä½œ StarterstarteråŒ…å«äº†ä¸¤é¡¹ä¸»è¦ çš„åŠŸèƒ½æ‰ä½¿å¾— Spring Boot å˜å¾—éå¸¸å®¹æ˜“ä½¿ç”¨ : é…ç½®äº†ä¾èµ–åº“ï¼Œå¦‚ sprinh-boot-starter-web ä¾èµ–äº† Tomcat ç­‰ï¼Œ beetl-framework-starter ä¾èµ–äº†Beetlå’Œ BeetlSQL ç­‰ã€‚ è‡ªåŠ¨é…ç½®","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (6) Spring Data JPA","slug":"SpringBoot2-6","date":"2018-12-22T05:27:16.000Z","updated":"2020-07-25T02:57:18.167Z","comments":true,"path":"2018/12/22/SpringBoot2-6/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-6/","excerpt":"","text":"ä»¥ Java Entityä¸ºä¸­å¿ƒï¼Œ å°†å®ä½“å’Œå®ä½“å…³ç³»å¯¹åº”åˆ°æ•°æ®åº“çš„è¡¨å’Œè¡¨å…³ç³»ï¼Œ è¿™ç±»å·¥å…·é€šå¸¸å°±æ˜¯ ORM (Object Relational Mapping)å·¥å…·ã€‚ å¯¹å®ä½“å’Œå®ä½“å…³ç³»çš„æ“ä½œä¼šæ˜ å°„åˆ° æ•°æ®åº“æ“ä½œã€‚ SpringData JPAï¼Œå®ƒåœ¨ JPA æä¾›çš„ç®€å•è¯­ä¹‰ä¸Šåšäº†ä¸€å®šçš„å°è£…ï¼Œæ»¡è¶³ CRUD æŸ¥è¯¢ SpringDataï¼Œå®ƒä¸º Springæ¡†æ¶å¯¹è®¿é—® SQLå’Œ NoSQLæ•°æ®åº“æä¾›äº†ä¸€è‡´çš„æ–¹å¼ é›†æˆ Spring Data JPA1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt; HikariCP ä½œä¸ºæ•°æ®æºæä¾›è€… 12345678910&lt;dependency&gt; &lt;groupId&gt;com.zaxxer&lt;/groupId&gt; &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;6.0.5&lt;/version&gt;&lt;/dependency&gt; é…ç½®æ•°æ®æº 123456789101112@Configurationpublic class DataSourceConfig &#123; @Bean(name = \"dataSource\") public DataSource datasource(Environment env) &#123; HikariDataSource ds = new HikariDataSource(); ds.setJdbcUrl(env.getProperty(\"spring.datasource.url\")); ds.setUsername(env.getProperty(\"spring.datasource.username\")); ds.setPassword(env.getProperty(\"spring.datasource.password\")); ds.setDriverClassName(env.getProperty(\"spring.datasource.driver-class-name\")); return ds; &#125;&#125; é…ç½®JPAæ”¯æŒSpring JPA Data é‡‡ç”¨äº†Hibernateå®ç°ï¼ŒHibernateå®ç°ä¸­æœ‰ä¸¤ä¸ªç‰¹æ€§éœ€è¦å…³æ³¨: spring.jpa.hibemate.ddl-auto, æ˜¯å¦è‡ªåŠ¨å»ºåº“ spring.jpa.show-sql, æ˜¯å¦è‡ªåŠ¨æ‰“å° SQL Entityå®ä½“ç±»å°±å¿…é¡»ä½¿ç”¨@Entityæ¥æ³¨è§£ï¼ŒJPA ä¹Ÿæä¾›äº†å¤§é‡çš„æ³¨è§£æ¥è¡¨æ˜å®ä½“å±æ€§å’Œå…³ç³» @Id ï¼Œ å£°æ˜äº†ä¸€ä¸ªå±æ€§å°†æ˜ å°„åˆ°æ•°æ®åº“ä¸»é”®å®‡æ®µã€‚ä¸»é”®ç”Ÿæˆç­–ç•¥ç”±æ³¨è§£ @GeneratedValue æ¥æŒ‡å®šã€‚æ¯”å¦‚ï¼Œid ä¸ºè‡ªå¢ä¸»é”®ï¼Œæ˜¯ ä¸€ç§ç®€å•çš„æ•°æ®åº“ ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼Œå› æ­¤ä½¿ç”¨ GenerationType.IDENTITY ä½œä¸ºä¸»é”®ç”Ÿæˆçš„ç­–ç•¥ ã€‚ @Columnï¼Œæ­¤æ³¨è§£è¡¨æ˜å±æ€§å¯¹åº”åˆ°æ•°æ®åº“çš„ä¸€ä¸ªå­—æ®µï¼Œä¸”åˆ—åä¸º nameæŒ‡å®šçš„åç§°ã€‚ @ManyToOne, Many æŒ‡çš„æ˜¯å®šä¹‰æ­¤å±æ€§çš„å®ä½“ï¼Œå³ User å®ä½“ï¼Œè€Œ One æŒ‡çš„å°±æ˜¯æ­¤æ³¨ è§£æ‰€æ³¨è§£çš„å±æ€§ï¼Œ ManyToOne è¯´æ˜å¯¹è±¡ User å’Œ Department çš„å…³ç³»æ˜¯å¤šå¯¹ä¸€å…³ç³»ï¼Œå¤š ä¸ªç”¨æˆ·å±äºä¸€ä¸ªéƒ¨é—¨ ã€‚ @JoinColumnï¼Œä¸ ManyToOne æ­é…ä½¿ç”¨ï¼Œè¯´æ˜å¤–é”®å­—æ®µæ˜¯ department-idã€‚ RepositoryRepository æ˜¯ Spring Data çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒæŠ½è±¡äº†å¯¹æ•°æ®åº“å’Œ NoSQL çš„æ“ä½œï¼Œæä¾›äº†æ¥å£ ä¾›å¼€å‘è€…ä½¿ç”¨ CrudRepositoryå®ç° Entityçš„ç®€å•å¢åˆ æ”¹æŸ¥åŠŸèƒ½ save findByid findAll count deleteByid delete â€¦ PagingAndSortingRepositoryå¢åŠ äº†ç¿»é¡µæŸ¥æ‰¾å’Œæ’åºç›¸å…³çš„æ“ä½œ Iterable&lt;T&gt; findAll(Sort sort) Page&lt;T&gt; findAll(Pageable pageable) JpaRepositoryæä¾›äº†æ›´å¤šçš„å®ç”¨åŠŸèƒ½ï¼Œä»¥åŠé€šè¿‡ Example å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ Example å¯¹è±¡æ˜¯ Spring Data JPA æä¾›çš„ç”¨æ¥æ„é€ æŸ¥è¯¢æ¡ä»¶å¯¹è±¡ æŒä¹…åŒ– Entity saveæ–¹æ³• SortJpaRepository æä¾›äº†å¦‚ä¸‹è¡¨æ‰€è¿°çš„å†…ç½®æŸ¥è¯¢ List findAll(); è¿”å›æ‰€æœ‰å®ä½“ List findAJl(Iterable ids); è¿”å›æŒ‡å®š id çš„æ‰€æœ‰å®ä½“ T getOne(ID id) æ ¹æ® id è¿”å›å¯¹åº”çš„å®ä½“ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™è¿”å› ç©º List findAll(Sort sort); è¿”å›æ‰€æœ‰å®ä½“ï¼ŒæŒ‰ç…§æŒ‡å®šé¡ºåºæ’åºè¿”å› Page findAll(Pageable pageable); è¿”å›å®ä½“åˆ—è¡¨ï¼Œå®ä½“çš„offsetå’Œ limité€šè¿‡ pageableæ¥æŒ‡å®š Sortå¯¹è±¡ç”¨æ¥æŒ‡ç¤ºæ’åº å…¶ä»– Sort çš„æ„é€ æ–¹æ³•è¿˜åŒ…å«: public Sort(Stringâ€¦ properties)ï¼Œ æŒ‰ç…§æŒ‡å®š çš„å±æ€§åˆ—è¡¨å‡åºæ’åºã€‚ public Sort(Direction direction, Stringâ€¦ properties)ï¼ŒæŒ‰ç…§æŒ‡å®šå±æ€§åˆ—è¡¨æ’åº ï¼Œæ’åºç”± Direction æŒ‡å®šï¼Œ Direction æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œæœ‰ Direction.ASC å’Œ Direction.DESC ä¸¤ç±»ã€‚ publicSort(Orderâ€¦orders), Orderå¯ä»¥é€šè¿‡Orderé™æ€æ–¹æ³•æ¥åˆ›å»º public static Order asc(String propertyName) public static Order desc(String propertyName) Pageable å’Œ PagePageable æ¥å£ç”¨äºæ„é€ ç¿»é¡µæŸ¥è¯¢ï¼Œ PageRequest æ˜¯å…¶å®ç°ç±»ï¼Œå¯ä»¥é€šè¿‡æä¾›çš„å·¥å‚æ–¹æ³•åˆ›å»ºPageReques åŸºäºæ–¹æ³•åå­—æŸ¥è¯¢Spring Data é€šè¿‡æŸ¥è¯¢çš„æ–¹æ³•åå’Œå‚æ•°åæ¥è‡ªåŠ¨æ„é€ ä¸€ä¸ª JPA OQL æŸ¥è¯¢ æ–¹æ³•åå’Œå‚æ•°åéœ€è¦éµå®ˆä¸€å®šçš„è§„åˆ™ï¼Œ Spring Data JPA æ‰èƒ½è‡ªåŠ¨è½¬åŒ–ä¸º JPQL: æ–¹æ³•åé€šå¸¸åŒ…å«å¤šä¸ªå®ä½“å±æ€§ç”¨äºæŸ¥è¯¢ï¼Œå±æ€§ä¹‹é—´å¯ä»¥ä½¿ç”¨ AND å’Œ OR è¿æ¥ï¼Œä¹Ÿæ”¯æŒ Betweenã€ LessThanã€ GreaterThanã€ Like æ–¹æ³•åå¯ä»¥ä»¥findByã€ getByã€ queryBy å¼€å¤´ æŸ¥è¯¢ç»“æœå¯ä»¥æ’åºï¼Œæ–¹æ³•ååŒ…å« OrderBy+å±æ€§+ASC(DESC) å¯ä»¥é€šè¿‡ Topã€ Firstæ¥é™å®šæŸ¥è¯¢ç»“æœé›† ä¸€äº›ç‰¹æ®Šçš„å‚æ•°å¯ä»¥å‡ºç°åœ¨å‚æ•°åˆ—è¡¨é‡Œï¼Œæ¯”å¦‚ Pageableã€Sort @Query æŸ¥è¯¢æ³¨è§£ Queryå…è®¸åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ JPQL ä½¿ç”¨JPA QueryEntityManager æä¾›äº†å®ä½“æ“ä½œçš„æ‰€æœ‰æ¥å£ ï¼Œå¯ä»¥é€šè¿‡ è‡ªåŠ¨æ³¨å…¥æ–¹å¼æ³¨å…¥åˆ° Spring ç®¡ç†çš„ Bean ä¸­ï¼Œ é€šå¸¸æ˜¯ç”±@Service æ³¨è§£çš„ä¸šåŠ¡å¤„ç†ç±»ä¸Šã€‚ Example æŸ¥è¯¢æ ¹æ®å®ä½“åˆ›å»ºä¸€ä¸ª Exampleå¯¹è±¡ï¼ŒSpringDataé€šè¿‡ Exampleå¯¹è±¡æ¥æ„é€  JPQL","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (5) æ•°æ®åº“è®¿é—®","slug":"SpringBoot2-5","date":"2018-12-22T01:54:42.000Z","updated":"2020-07-25T02:57:18.167Z","comments":true,"path":"2018/12/22/SpringBoot2-5/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-5/","excerpt":"","text":"JDBCTemplateæ˜¯Spring è‡ªå¸¦çš„ï¼Œåœ¨JDBCçš„åŸºç¡€ä¸Šåšäº†ä¸€å®šå°è£… BeetlSQLæ˜¯ç¬”è€…ç ”å‘çš„ï¼Œé™¤äº†å°è£…äº† JDBCæ“ä½œï¼Œè¿˜å¸¦æœ‰ SQL ç®¡ç†ã€è·¨æ•°æ®åº“å¹³å°æ”¯æŒç­‰ä¼ä¸šåŠŸèƒ½ ä»¥SQLä¸ºæ ¸å¿ƒçš„æ•°æ®åº“è®¿é—®æ›´ä¸ºçµæ´»ï¼Œæ›´èƒ½é€‚åº”å¤§å‹çš„äº’è”ç½‘å’Œä¼ä¸šåº”ç”¨ï¼Œå­¦ä¹ é—¨æ§›è¾ƒä½ ä»¥å¯¹è±¡æ–¹å¼è®¿é—®æ•°æ®åº“æ›´é€‚åˆè¾ƒä¸ºç®€å•çš„ç³»ç»Ÿæˆ–è€…å·¥å…·ç±»ç³»ç»Ÿï¼Œå­¦ä¹ é—¨æ§›åˆšå¼€å§‹è¾ƒä½ï¼Œä½†å› ä¸º ORM(Object Relational Mapping)æŒä¹…åŒ–ä¸Šä¸‹æ–‡ç­‰æ¦‚å¿µè¿‡äºå¤æ‚ é…ç½®æ•°æ®æºæ•°æ®åº“è¿æ¥æ±  HikariCP 12345&lt;dependency&gt; &lt;groupid&gt;com.zaxxer&lt;/groupid&gt; &lt;artifactid&gt;HikariCP&lt;/artifactid&gt; &lt;version&gt;2.6.l&lt;/version&gt;&lt;/dependency&gt; MySQL 12345&lt;dependency&gt; &lt;groupid&gt;mysql&lt;/groupid&gt; &lt;artifactid&gt;mysql-connector-java&lt;/artifactid&gt; &lt;version&gt;6.0.5&lt;/version&gt;&lt;/dependency&gt; åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è¿æ¥æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯ä»¥ä¾› HikariCP ä½¿ç”¨ : 1234spring.datasource.url=jdbc:mysql://127.0.0.1:3306/orm?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8spring.datasource.username=rootspring.datasource.password=123456spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver JavaConfigæ¥åˆ›å»ºä¸€ä¸ªæ•°æ®æº: 1234567891011121314@Configurationpublic class DataSourceConfig &#123; @Bean(name = \"dataSource\") public DataSource datasource(Environment env) &#123; HikariDataSource ds = new HikariDataSource(); ds.setJdbcUrl(env.getProperty(\"spring.datasource.url\")); ds.setUsername(env.getProperty(\"spring.datasource.username\")); ds.setPassword(env.getProperty(\"spring.datasource.password\")); ds.setDriverClassName(env.getProperty(\"spring.datasource.driver-class-name\")); return ds; &#125;&#125; Spring JDBC TemplateSpringæä¾›äº†JdbcTemplateå¯¹æ•°æ®åº“è®¿é—®æŠ€æœ¯ JDBC åšäº†ä¸€å®šå°è£…ï¼ŒåŒ…æ‹¬ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œç®€å•æŸ¥è¯¢ç»“æœæ˜ å°„æˆ Java å¯¹è±¡ï¼Œå¤æ‚çš„ç»“æœé›†é€šè¿‡å®ç°RowMapperæ¥å£æ¥æ˜ å°„åˆ° Java å¯¹è±¡ã€‚ åœ¨ Spring Bootä¸­, åªè¦é…ç½®å¥½æ•°æ®æº DataSourceï¼Œ å°±èƒ½è‡ªåŠ¨ä½¿ç”¨ JdbcTemplate 12345@Repositorypublic class UserDao &#123; @Autowired JdbcTemplate jdbcTempalte;&#125; @Repository é€šå¸¸ç”¨åœ¨åŒå­˜å‚¨ç›¸å…³çš„ç±»ä¸Š æŸ¥è¯¢ä¸€ä¸ªç®€å•çš„è¿”å›æ€»æ•°çš„æŸ¥è¯¢: 1int rowCount = jdbcTempalte.queryForObject(\"select count(1) from user\", Integer.class); ä¸€ ä¸ªå¸¦å‚æ•°ç»‘å®šçš„æŸ¥è¯¢: 12String sql = \"select count(1) from user where department_id=?\";Integer rowCount = jdbcTempalte.queryForObject(sql, Integer.class, 1); å¦‚æœæœŸæœ›è¿”å›POJOå®ä¾‹ï¼ŒJdbcTemplateéœ€è¦ä¸€ä¸ªRowMapperï¼Œå°†æŸ¥è¯¢ç»“æœé›†ResultSetæ˜ å°„æˆä¸€ä¸ªå¯¹è±¡: 1234567891011121314public User findUserById(Long userId) &#123; String sql = \"select * from user where id=?\"; User user = jdbcTempalte.queryForObject(sql, new RowMapper&lt;User&gt;() &#123; public User mapRow(ResultSet rs, int rowNum) throws SQLException &#123; User user = new User(); user.setId(rs.getInt(\"id\")); user.setName(rs.getString(\"name\")); user.setDepartmentId(rs.getInt(\"department_id\")); return user; &#125; &#125;, userId); return user;&#125; é€šå¸¸RowMapperå¯ä»¥è¢«å…¶ä»–æŸ¥è¯¢å¤ç”¨ï¼Œå› æ­¤æœ€å¥½çš„åŠæ³•æ˜¯åœ¨ DAO ä¸­åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±» 123456789static class UserRowMapper implements RowMapper&lt;User&gt; &#123; public User mapRow(ResultSet rs, int rowNum) throws SQLException &#123; User user = new User(); user.setId(rs.getInt(\"id\")); user.setName(rs.getString(\"name\")); user.setDepartmentId(rs.getInt(\"department_id\")); return user; &#125;&#125; JdbcTemplateæŸ¥è¯¢å¦‚æœæœŸæœ›è¿”å›çš„æ˜¯åˆ—è¡¨: 12345public List&lt;User&gt; getUserByDepartmentId(Long departmenetId) &#123; String sql = \"select * from user where department_id=? \"; List&lt;User&gt; user = jdbcTempalte.query(sql, new UserRowMapper(), 1); return user;&#125; å¯¹äºå¤§å¤šæ•°DAOæ¡†æ¶æ¥è¯´ï¼Œå®Œæˆä¸Šè¿°çš„æŸ¥è¯¢ä¼šéå¸¸ç®€å•ï¼Œä¸éœ€è¦å†™ SOLï¼Œä¸éœ€è¦å†™RowMapperï¼Œæ¯”å¦‚åé¢è¦ä»‹ç»çš„ BeetlSOLï¼Œä»¥åŠ Spring Data éƒ½æ˜¯è¿™ç§æƒ…å†µ ã€‚ä»¥ BeetlSOL ä¸ºä¾‹ï¼Œé€šè¿‡sqlManagerå¯ä»¥ç›´æ¥å®Œæˆä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­: //æ ¹æ®ä¸»é”®æŸ¥è¯¢User user= sqlManager.unique(User.class , userid); //æŸ¥è¯¢éƒ¨é—¨çš„æ‰€æœ‰ç”¨æˆ·User template= new User();template.setDepartmentid(departmentid);List list= sqlManager.template(template); å¤§å¤šæ•° DAO æ¡†æ¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆ SOLï¼Œä»¥åŠå®Œæˆ ResultSet åˆ° POJO çš„è‡ªåŠ¨æ˜ å°„ã€‚ ä¿®æ”¹JdbcTempalte æä¾›updateæ–¹æ³•æ¥å®ç°SQLçš„ä¿®æ”¹è¯­æ—¬ï¼ŒåŒ…æ‹¬æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æ‰§è¡Œå­˜å‚¨ è¿‡ç¨‹ç­‰ 1234public void updateInfo(User user) &#123; String sql = \"update user set name=? and departmet_id=? where id = ?\"; jdbcTempalte.update(sql, user.getName(), user.getDepartmentId(), user.getId());&#125; æ•°æ®åº“æ’å…¥: 12345678910111213public Integer insertUser(final User user) &#123; final String sql = \"insert into user (name, departmet_id ) values (?,?)\"; KeyHolder keyHolder = new GeneratedKeyHolder(); jdbcTempalte.update(new PreparedStatementCreator() &#123; public PreparedStatement createPreparedStatement(Connection connection) throws SQLException &#123; PreparedStatement ps = connection.prepareStatement(sql, new String[] &#123; \"id\" &#125;); ps.setString(1, user.getName()); ps.setInt(2, user.getDepartmentId()); return ps; &#125; &#125;, keyHolder); return keyHolder.getKey().intValue();&#125; keyHolder åŒ…å«äº†è‡ªå¢é•¿çš„ç»“æœ JdbcTemplate å¢å¼ºJdbcTemplateï¼Œå¯¹SQLä¸­çš„å‚æ•°åªæ”¯æŒä¼ ç»Ÿçš„â€œ?â€å ä½ç¬¦ NamedParameterJdbcTemplateç»§æ‰¿äº† JdbcTemplate,å…è®¸SQLä¸­ä½¿ç”¨å‚æ•°çš„åå­—ä½œä¸ºå ä½ç¬¦ 12@AutowiredNamedParameterJdbcTemplate namedParameterJdbcTemplate; åœ¨SQLè¯­å¥ä¸­ï¼Œä¸å†ä½¿ç”¨?ï¼Œè€Œæ˜¯ä½¿ç”¨äº†â€œ:â€å¼€å¤´çš„å‚æ•°åå­—ï¼Œå¦‚â€œ:deptldâ€ BeetlSQLä»‹ç»åŠŸèƒ½æ¦‚è§ˆBeetlSQLæ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½ DAOå·¥å…·ï¼ŒåŒæ—¶å…·æœ‰ Hibernateå’Œ MyBatisçš„ä¼˜ç‚¹ï¼Œé€‚ç”¨äºæ‰¿è®¤ä»¥SQLä¸ºä¸­å¿ƒï¼ŒåŒæ—¶åˆéœ€è¦å·¥å…·èƒ½è‡ªåŠ¨ç”Ÿæˆå¤§é‡å¸¸ç”¨çš„ SQLçš„åº”ç”¨ã€‚ å¼€å‘æ•ˆç‡ æ— é¡»æ³¨è§£ï¼Œè‡ªåŠ¨ä½¿ç”¨å¤§é‡å†…ç½®SQLï¼Œè½»æ˜“å®Œæˆå¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼ŒèŠ‚çœçº¦50%çš„å¼€å‘å·¥ä½œé‡ æ•°æ®æ¨¡å‹æ”¯æŒ POJOï¼Œä¹Ÿæ”¯æŒ Map/List è¿™ç§å¿«é€Ÿæ¨¡å‹ï¼Œè¿˜æ”¯æŒæ··åˆæ¨¡å‹ SQLæ¨¡æ¿åŸºäºBeetl å®ç°ï¼Œæ›´å®¹æ˜“ç¼–å†™å’Œè°ƒè¯• ï¼Œä»¥åŠè¿›è¡Œæ‰©å±• å¯ä»¥é’ˆå¯¹å•ä¸ªè¡¨(æˆ–è€…è§†å›¾)ä»£ç ç”Ÿæˆ POJOç±»å’ŒSQLæ¨¡æ¿ï¼Œç”šè‡³æ˜¯æ•´ä¸ªæ•°æ®åº“ï¼Œèƒ½å‡å°‘ä»£ç ç¼–å†™å·¥ä½œé‡ æ”¯æŒ ORM æŸ¥è¯¢åŠŸèƒ½ ç»´æŠ¤æ€§ SQLå†™åœ¨Markdownæ–‡ä»¶ä¸­ï¼ŒåŒæ—¶æ–¹ä¾¿ç¨‹åºå¼€å‘å’Œæ•°æ®åº“ SQL è°ƒè¯• å¯ä»¥è‡ªåŠ¨å°†SQLæ–‡ä»¶æ˜ å°„ä¸ºDAOæ¥å£ç±» å…·å¤‡ Interceptor åŠŸèƒ½ï¼Œå¯ä»¥è°ƒè¯•ã€æ€§èƒ½è¯Šæ–­ SQLï¼Œä»¥åŠæ‰©å±•å…¶ä»–åŠŸèƒ½ çµæ´»ç›´è§‚åœ°æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šå…³ç³»æ˜ å°„è€Œä¸å¼•å…¥å¤æ‚çš„ORMappingæ¦‚å¿µå’ŒæŠ€æœ¯ å…¶ä»– å†…ç½®æ”¯æŒä¸»ä»æ•°æ®åº“çš„å¼€æºå·¥å…· æŒè·¨æ•°æ®åº“å¹³å°ï¼Œå°†å¼€å‘è€…æ‰€è¦å®Œæˆçš„å·¥ä½œå‡åˆ°æœ€å°ï¼Œç›®å‰è·¨æ•°æ®åº“æ”¯æŒ MySQLã€PostgreSQLã€Oracleã€SQL Serverã€H2, SQLiteã€DB2 Mavenä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;com.ibeetl&lt;/groupId&gt; &lt;artifactId&gt;beetl-framework-starter&lt;/artifactId&gt; &lt;version&gt;1.1.40.RELEASE&lt;/version&gt;&lt;/dependency&gt; é…ç½® BeetlSQLbeetl-framework-starter ä¼šè¯»å– application.properties å¦‚ä¸‹é…ç½®: beetlsql.sqlPathï¼Œé»˜è®¤ä¸º/sqlï¼Œä½œä¸ºå­˜æ”¾ SQLæ–‡ä»¶çš„æ ¹ç›®å½•ï¼Œä½äº/resources/sql ç›®å½•ä¸‹ beetlsql.nameConversion, é»˜è®¤æ˜¯ org.beetl.sql.core.UnderlineNameConversionï¼Œèƒ½å°†ä¸‹ç”»çº¿åˆ†å‰²çš„æ•°æ®åº“å‘½åé£æ ¼è½¬åŒ–ä¸º Java é©¼å³°å‘½åé£æ ¼ï¼Œè¿˜æœ‰å¸¸ç”¨çš„ DefaultNameConversion, æ•°æ®åº“å‘½åå®Œå…¨å’Œ Javaå‘½åä¸€è‡´ï¼Œä»¥åŠ JPA2NameConversionï¼Œå…¼å®¹ JPA å‘½å beetl-beetlsql.dev, é»˜è®¤æ˜¯ trueï¼Œå³å‘æ§åˆ¶å°è¾“å‡ºæ‰§è¡Œæ—¶çš„ SQLï¼ŒåŒ…æ‹¬å‚æ•°ã€æ‰§è¡Œæ—¶é—´ åŠæ‰§è¡Œçš„ä½ç½®ï¼Œæ¯æ¬¡ä¿®æ”¹ SQL æ–‡ä»¶æ—¶ï¼Œè‡ªåŠ¨æ£€æµ‹ SQL æ–‡ä»¶ä¿®æ”¹ beetlsql.daoSuffixï¼Œé»˜è®¤ä¸º Daoã€‚ä»»ä½•æ¥å£ç»§æ‰¿äº† BaseMapperæ¥å£ï¼Œå°†è‡ªåŠ¨å…·å¤‡å®ä½“å†…ç½®çš„CRUDåŠŸèƒ½ã€‚daoSuffixé€‰é¡¹ä¼šåœ¨ SpringBoot å¯åŠ¨çš„æ—¶å€™ï¼Œè‡ªåŠ¨æ‰«æä»¥ Dao ç»“å°¾çš„æ¥å£ï¼Œè‡ªåŠ¨æ³¨å†Œä¸º Spring ç®¡ç†çš„ Dao ç±»ï¼Œä½ å¯ä»¥ åœ¨ä»»ä½•åœ°æ–¹è‡ªåŠ¨æ³¨å…¥è¿™ä¸ª Daoç±»ï¼Œæ¯”å¦‚åœ¨ Serviceç±»ä¸­ã€‚ beetlsqI.basePackageï¼Œé»˜è®¤ä¸ºcomï¼Œæ­¤é€‰é¡¹é…ç½® beetlsql.daoSuffix æ¥è‡ªåŠ¨æ‰«æ com åŒ…åŠ å…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ä»¥ Dao ç»“å°¾çš„ Mapper ç±»ã€‚ä»¥æœ¬ç« ä¾‹å­è€Œè¨€ï¼Œä½ å¯ä»¥é…ç½®com.bee.sample.ch5.dao beetlsql.dbStyleï¼Œæ•°æ®åº“é£æ ¼ï¼Œé»˜è®¤æ˜¯ org.beetl.sql.core.db.MySqlStyleï¼Œå¯¹åº”ä¸åŒçš„æ•°æ®åº“ï¼Œå…¶ä»–è¿˜æœ‰ OracleStyleã€ PostgresStyleã€ SqlServerStyleã€ DB2Sq!Styleã€ SQLiteStyleã€ H2Style SQLManager12345@Servicepublic class UserServiceImpl implements UserService &#123; @Autowired SqlManager sqlManager;&#125; SQLManager æ˜¯ BeetlSQL çš„æ ¸å¿ƒç±»ï¼Œæä¾›äº†æ‰€æœ‰çš„æ•°æ®è®¿é—®æ“ä½œ: æ ¹æ®ä¸»é”®æŸ¥æ‰¾å®ä½“æ“ä½œï¼Œå¯è°ƒç”¨uniqueæ–¹æ³•: 1User user = sqlManager.unique(User.class, pk); ä¹Ÿå¯ä»¥è°ƒç”¨ single æ–¹æ³•ï¼Œå¦‚æœæœªæŸ¥æ‰¾åˆ°ï¼Œä»…ä»…è¿”å› null: 1User user = sqlManager.single(User.class, pk); æ·»åŠ ä¸€ä¸ªå®ä½“ï¼Œè°ƒç”¨ insertæ–¹æ³•: 12345User user = new User();user.setDepartmentID(1);user.setCreateTime(new Date();user.setName(name);sqlManager.selectSample(user); USERè¡¨çš„ IDæ˜¯è‡ªå¢çš„ï¼Œå¦‚æœæƒ³è·å–åˆ°è‡ªå¢ä¸»é”®ï¼Œå¯ä»¥ä¼ å…¥trueå‚æ•°: 1sqlManager.insert(user, true) ; æ ¹æ®ä¸»é”®æ›´æ–°å®ä½“: 12345User user= new User();user.setid(1);......user.setName(\"NewName\");sqlManager.updateByid(user); åªæ›´æ–°æœ‰å€¼çš„å±æ€§: 1234User user = new User();user.setid(l);user.setName(\"NewName\");sqlManager.updateTemplateByid(user) ; ä½¿ç”¨ SQL æ–‡ä»¶é¡¹ç›®ä¸­è¿˜æ˜¯æœ‰ä¸å°‘å¤æ‚çš„ SQL (æœ‰çš„åªæœ‰äº”å…­è¡Œï¼Œæœ‰çš„ç”šè‡³æœ‰æ•°ç™¾è¡Œ)ï¼Œæ”¾åœ¨å•ç‹¬çš„ SQL æ–‡ä»¶ä¸­æ›´å®¹æ˜“ç¼–å†™å’Œç»´æŠ¤ï¼Œéœ€è¦åœ¨/resources/sql ç›®å½•ä¸‹åˆ›å»º user.md æ–‡ä»¶ 12345678910selectSample===* ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ä¾‹å­* æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ· select * from user where 1=1 @if(!isEmpty(name)) &#123; and name = #name# @&#125; ç®€å•è¯´æ˜: é‡‡ç”¨ mdæ ¼å¼ï¼Œ===ä¸Šé¢æ˜¯ SQLè¯­å¥åœ¨æ–‡ä»¶ä¸­çš„å”¯ä¸€æ ‡ç¤ºï¼Œä¸‹é¢åˆ™æ˜¯SQLè¯­å¥ === ä¸‹é¢å¯ä»¥æ”¾å¤šè¡Œæ³¨é‡Šï¼Œé‡‡ç”¨*å¼€å¤´ @å’Œå›è½¦ç¬¦å·æ˜¯å®šç•Œç¬¦å·ï¼Œå¯ä»¥åœ¨é‡Œé¢å†™ Beetlè¯­å¥ï¼Œå¦‚æ¡ä»¶åˆ¤æ–­è¯­å¥ #æ˜¯å ä½ç¬¦ï¼Œç”ŸæˆSQLè¯­å¥çš„æ—¶å€™ï¼Œå ä½ç¬¦å°†è¾“å‡º?ï¼Œå¹¶è®°å½•æ­¤ä½ç½®çš„å€¼ï¼Œå¦‚æœæƒ³ç›´æ¥è¾“å‡ºå€¼ï¼Œéœ€è¦ç”¨ text å‡½æ•°ï¼Œæˆ–è€…ä»»ä½•ä»¥ db å¼€å¤´çš„å‡½æ•°ï¼Œå¼•æ“åˆ™è®¤ä¸ºæ˜¯ç›´æ¥è¾“å‡ºæ–‡æœ¬ isEmptyæ˜¯ Beetl çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºç©ºæˆ–è€…æ˜¯å¦ä¸å­˜åœ¨ æ–‡ä»¶åçº¦å®šä¸ºç±»åï¼Œé¦–å­—æ¯å°å†™ ä½¿ç”¨ï¼š 123User query = new User();query.setName(\"NewName\");List&lt;User&gt; list = sqlManager.select(\"user.selectSample\", User.class, query); MapperBeetlSQL æä¾› Mapper åŠŸèƒ½, èƒ½å°† md æ–‡ä»¶çš„ sqlld æ˜ å°„ä¸ºæ–¹æ³•å BaseMapperæ˜¯ BeetlSQLæä¾›çš„ä¸€ä¸ªå†…ç½® Daoæ¥å£ï¼Œå†…ç½®äº†å¤šç§å¢åˆ æ”¹æŸ¥æ–¹æ³•ï¼ŒåŒ…å«å¦‚ä¸‹: Insert æ’å…¥å®ä½“å¯¹è±¡åˆ°æ•°æ®åº“ insertTemplateï¼Œæ’å…¥å®ä½“åˆ°æ•°æ®åº“ï¼Œ åªæ’å…¥énullå±æ€§ insertBatchï¼Œ æ‰¹é‡æ’å…¥å®ä½“ updateByldï¼ŒæŒ‰ç…§ä¸»é”®æ›´æ–°å®ä½“ updateTemplateByldï¼ŒæŒ‰ç…§ä¸»é”®æ›´æ–°å®ä½“ï¼Œåªæ›´æ–°énullçš„å±æ€§ deleteByldï¼ŒæŒ‰ç…§ä¸»é”®åˆ é™¤å®ä½“ï¼Œä¸€äº›å¤§å‹åº”ç”¨ä¸¥æ ¼æ¥è¯´ç¦æ­¢åˆ é™¤ï¼Œå‚è€ƒ BeetlSQL å®˜ç½‘äº†è§£å¦‚ä½•å®šåˆ¶ BaseMapperï¼Œä¸æä¾› deleteByldæ–¹æ³• uniqueï¼Œæ ¹æ®ä¸»é”®æŸ¥è¯¢å®ä½“ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼ŒæŠ›å‡ºRuntimeå¼‚å¸¸ singleï¼Œæ ¹æ®ä¸»é”®æŸ¥è¯¢å®ä½“ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å› null lock, æ ¹æ®ä¸»é”®ä½¿ç”¨æ•°æ®åº“æ‚²è§‚é”ï¼Œ ç›¸å½“äºselect * from table where id = ? for update allï¼Œ è¿”å›æ‰€æœ‰å®ä½“ allCountï¼Œæ‰€æœ‰å®ä½“çš„ä¸ªæ•° templateï¼Œ æŸ¥è¯¢ç¬¦åˆæ¨¡æ¿çš„æ‰€æœ‰å®ä½“ templateOneï¼ŒæŸ¥è¯¢ç¬¦åˆæ¨¡æ¿çš„ç¬¬ä¸€ä¸ªå®ä½“ executeï¼Œæ‰§è¡Œä¸€ä¸ª JDBCæŸ¥è¯¢ï¼Œ åœ¨ Javaä¸­æä¾›ä¸€ä¸ª SQLè¯­å¥ executeUpdateï¼Œæ‰§è¡Œä¸€ä¸ª JDBC æ›´æ–°æ“ä½œï¼Œåœ¨ Java ä¸­æä¾›ä¸€ä¸ª SQL è¯­å¥ ä½¿ç”¨å®ä½“æŒ‰ç…§ NameConversonæŒ‡å®šçš„å‘½åçº¦å®šå¯¹åº”ä¸€ä¸ªæ™®é€šçš„ JavaBean å³å¯ BeetlSQL äº•ä¸è¦æ±‚åˆ—åèƒ½å’Œå®ä½“çš„å±æ€§åä¸€ä¸€å¯¹åº”ï¼Œ SQL æ“ä½œçš„æ—¶å€™, é€‰å–åˆ—åå’Œå±æ€§åçš„ â€œäº¤é›†â€æ¥æ“ä½œ SQLManager å†…ç½® CRUDå†…ç½®çš„æ’å…¥ API insert insertTemplate insertBatch å†…ç½®çš„æ›´æ–°(åˆ é™¤) API updateByld updateTemplateByld updateBatchTemplateByld updateByldBatch å†…ç½®çš„æŸ¥è¯¢ API all allCount template templateOne template unique single templateCount ä»£ç ç”Ÿæˆæ–¹æ³•BeetlSQL èƒ½è‡ªåŠ¨ç”Ÿæˆè¡¨å¯¹åº”çš„å®ä½“ã€ Dao æ“ä½œå’Œ md æ–‡ä»¶ md æ–‡ä»¶é‡ŒåŒ…å«äº†ç›¸å…³ SQL æŸ¥è¯¢è¯­å¥: genPojoCodeToConsole genSQLTemplateToConsole genPojoCode genSQLFile genAll ä½¿ç”¨sqlldæœ‰äº›ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®åº“æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œé€šå¸¸ SQLæœ‰å¾ˆå¤šè¡Œï¼Œ æ‹¼æ¥ SQLçš„æ¡ä»¶ä¹Ÿè¾ƒä¸ºå¤æ‚ BeetlSQL æ”¯æŒå°†SQLæ”¾åˆ° md ä¸­ï¼Œæœ‰ä»¥ä¸‹å¥½å¤„: mdæ ¼å¼æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œ é€‚åˆé˜…è¯»ä¹¦å†™ ä¸ BeetlSQL ç±»ä¼¼çš„ MyBatis é‡‡ç”¨ XML æ ¼å¼æ¥ç»´æŠ¤, md æ¯” XML æ›´åˆé€‚ SQL è¯­å¥ï¼Œå› ä¸ºæ²¡æœ‰åƒ XML é‚£æ ·è¿‡å¤šçš„æ ¼å¼æ§åˆ¶ï¼Œè¿˜æœ‰SQLä¸­çš„ &lt;ç¬¦å·æ˜¯ç‰¹æ®Šç¬¦å·ï¼Œæ”¾åœ¨XMLä¸­å¿…é¡»è½¬ä¹‰ md ç¼–è¾‘å™¨ æ¯”è¾ƒä¸°å¯Œï¼Œ ä¹Ÿæ”¯æŒå¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ï¼Œæ–¹ä¾¿é¡¹ç›®æ‰€æœ‰äººå‘˜é˜…è¯» md æ–‡ä»¶å‘½åé’ˆå¯¹æ•°æ®åº“ä¸­æ¯ä¸€ä¸ªè¡¨æˆ–è€…è§†å›¾å¯¹åº”çš„å®ä½“ POJOï¼Œéƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒåä¸”é¦–å­—æ¯å°å†™çš„ æ–‡ä»¶åï¼Œæ”¾åœ¨é»˜è®¤ çš„ SQL ç›®å½•ä¸‹ æ¯”å¦‚æ•°æ®åº“è¡¨SYS_USERï¼Œå¯¹åº”çš„POJOæ˜¯SysUserï¼Œå¯ä»¥åœ¨ SQLç›®å½•ä¸‹åˆ›å»ºsysUser.mdæ–‡ä»¶ md æ–‡ä»¶æ„æˆè°ƒç”¨ sqlld æŸ¥è¯¢ç±»æ¥å£ select selectSingle selectUnique intValue æ’å…¥æ–¹æ³• æ›´æ–°æ–¹æ³• ç¿»é¡µæŸ¥è¯¢BeetJSQL æä¾›ä¸€ä¸ª PageQueryå¯¹è±¡ç”¨äº SpringBootåº”ç”¨çš„ç¿»é¡µæŸ¥è¯¢ ã€‚å®ƒä¸ºæŸ¥è¯¢æä¾›å‚æ•°ã€æŸ¥è¯¢èŒƒå›´ã€æ’åº TailBeanBeetlSQL æä¾› TailBeanç±»ï¼ŒPOJOç±»ç»§æ‰¿æ­¤ç±»åï¼ŒSQLæŸ¥è¯¢ç»“æœé›†æ˜ å°„ä¸åˆ°çš„å­—æ®µå°†ä¼šæ”¾ åˆ°æ­¤ç±»ä¸­ï¼Œç§°ä¹‹ä¸ºæ··åˆæ¨¡å‹ ORM æŸ¥è¯¢å…¶ä»–API ç›´æ¥æ‰§è¡Œ SQLæ¨¡æ¿è¯­å¥ SQLReady BeetlSOL çš„å…¶å®ƒåŠŸèƒ½ SQL æ¨¡æ¿è¯­å¥å¸¸ç”¨å‡½æ•°å’Œæ ‡ç­¾ ä¸»é”® BeetlSQL å¸¸ç”¨æ³¨è§£ NameConvesionï¼Œ å‘½åè½¬åŒ–ç±» æ‚²è§‚é”å’Œä¹è§‚é”","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (4) è§†å›¾æŠ€æœ¯","slug":"SpringBoot2-4","date":"2018-12-21T18:23:20.000Z","updated":"2020-07-25T02:57:18.167Z","comments":true,"path":"2018/12/22/SpringBoot2-4/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-4/","excerpt":"","text":"Beetl æ¨¡æ¿å¼•æ“ç‰¹ç‚¹: åŠŸèƒ½å®Œå¤‡ è¯­æ³•å’Œä½¿ç”¨ä¹ ä¿—ç®€å•, ç±»ä¼¼ JavaScript è¯­æ³•å’Œä¹ ä¿— è¶…é«˜çš„æ€§èƒ½ æ˜“äºæ•´åˆ æ”¯æŒæ¨¡æ¿å•ç‹¬å¼€å‘å’Œæµ‹è¯• æ‰©å±•å’Œä¸ªæ€§åŒ–ã€‚ Beet!æ”¯æŒè‡ªå®šä¹‰æ–¹æ³•ã€æ ¼å¼åŒ–å‡½æ•°ã€è™šæ‹Ÿå±æ€§ã€æ ‡ç­¾å’Œ HTML æ ‡ç­¾ã€‚åŒæ—¶ ä¹Ÿæ”¯æŒè‡ªå®šä¹‰å ä½ç¬¦å’Œæ§åˆ¶è¯­å¥èµ·å§‹ç¬¦å·ã€‚ ä¾èµ–beetl-framework-starter å®šç•Œç¬¦å·å’Œå ä½ç¬¦Beetl æ”¯æŒè‡ªå®šä¹‰å®šç•Œç¬¦å·å’Œå ä½ç¬¦å· ï¼Œ é»˜è®¤ä½¿ç”¨&lt;%%&gt;ä½œä¸ºå®šç•Œç¬¦å·ï¼Œä½¿ç”¨${}ä½œä¸ºå ä½ç¬¦å· å˜é‡å…¨å±€å˜é‡å…¨å±€å˜é‡å³é€šè¿‡ Model æˆ–è€… ModelAndViewä¼ å…¥çš„å˜é‡ï¼Œå¯ä»¥åœ¨æ¨¡æ¿æˆ–è€…å­æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚ é»˜è®¤çš„å…¨å±€å˜é‡: request ä¸­æ‰€æœ‰çš„ attribute åœ¨æ¨¡æ¿ä¸­å¯ä»¥ç›´æ¥é€šè¿‡ name æ¥å¼•ç”¨ï¼Œæ¯”å¦‚åœ¨ Controller å±‚ request.setAttribute(â€userâ€ï¼Œuser)ï¼Œåˆ™åœ¨æ¨¡æ¿ä¸­å¯ä»¥ ç›´æ¥ç”¨ ${user.name}ã€‚è¿™é‡Œä¹ŸåŒ…æ‹¬ Model æˆ–è€… Mode!AndView ä¸­çš„æ‰€æœ‰å˜é‡ï¼Œéƒ½ä¼šæˆä¸ºæ¨¡æ¿çš„ å…¨å±€å˜é‡ Session æä¾›äº† Session ä¼šè¯ï¼Œæ¨¡æ¿é€šè¿‡ session[â€nameâ€]æˆ–è€… session.name å¼•ç”¨ Session ä¸­çš„å˜é‡ã€‚æ³¨æ„ï¼Œ Session å¹¶é Serviet ä¸­çš„æ ‡å‡† Session å¯¹è±¡ã€‚å‚è€ƒ Serviet æ¥è·å–HTTP Session requestï¼Œæ ‡å‡†çš„ HTTPServletRequestï¼Œå¯ä»¥åœ¨æ¨¡æ¿ä¸­å¼•ç”¨ request å±æ€§ (getter)ï¼Œå¦‚ ${request.requestURL} parameterï¼Œ è¯»å–ç”¨æˆ·æäº¤çš„å‚æ•°ï¼Œå¦‚${parameter.userld} ctxPath, Web åº”ç”¨ä¸­çš„ ContextPathã€‚ åœ¨ Spring Boot ä¸­ï¼Œ åº”ç”¨é»˜è®¤æ˜¯â€œ/â€ ã€‚ é€šè¿‡ application.properties çš„å±æ€§ server.context-path å¯ä»¥é…ç½®ã€‚ servlet, WebVariable çš„ å®ä¾‹ï¼ŒåŒ…å«äº† HTTPSessionã€ HTTPServletRequestã€ HTTPServletÂ­ Response ä¸‰ ä¸ªå±æ€§ï¼Œæ¨¡æ¿ä¸­å¯ä»¥é€šè¿‡ requestã€ responseã€ session æ¥å¼•ç”¨ï¼Œå¦‚ ${servlet.request.requestURL} æ‰€æœ‰ groupTemplate çš„å…±äº«å˜é‡ å±€éƒ¨å˜é‡åœ¨æ¨¡æ¿ä¸­å®šä¹‰çš„å˜é‡ï¼Œåªèƒ½åœ¨å½“å‰æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œæ— æ³•åœ¨å­æ¨¡æ¿ä¸­ä½¿ç”¨: 12@var salary = user.salary*2;&lt;span&gt;$&#123;user .name&#125;&lt;/span&gt; Beet! å®šä¹‰å˜é‡çš„æ–¹å¼ä¸ JS ç±»ä¼¼ å…±äº«å˜é‡ç±»ä¼¼å…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä»»ä½•æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œéœ€è¦é€šè¿‡ groupTemplate çš„ API æ·»åŠ  æ¨¡æ¿å˜é‡å˜é‡çš„å†…å®¹æ˜¯æ¨¡æ¿å¯¹åº”çš„è¾“å‡º è¡¨è¾¾å¼è®¡ç®—è¡¨è¾¾å¼ç±»ä¼¼ JSï¼Œ æ”¯æŒ+ã€ ã€æ°”/ã€%ç­‰è¡¨è¾¾å¼ï¼Œå˜é‡çš„ç±»å‹ä¸ç›¸åº”çš„ Javaç±»å‹ä¸€è‡´ é€»è¾‘è¡¨è¾¾å¼Beetl æ”¯æŒç±»ä¼¼ JavaScriptã€ Java çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚ã€‰ã€ã€ˆã€äºŒã€ !=ã€ã€‰=ã€&lt;=ã€ ä»¥åŠä¸‰å…ƒè¡¨è¾¾å¼ç­‰ æ§åˆ¶è¯­å¥å¾ªç¯è¯­æ—¬Beetl æ”¯æŒå¤šç§å¾ªç¯æ–¹å¼ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ forÂ·Â·Â·in å¾ªç¯è¯­å¥ forÂ·Â·Â·inå¾ªç¯æ”¯æŒ elsefor è¯­æ³•ï¼Œå³å¦‚æœæœªè¿›å…¥å¾ªç¯ä½“ï¼Œåˆ™æ‰§è¡Œ elseforéƒ¨åˆ† for(exp;exp,exp) while(exp) æ¡ä»¶è¯­æ—¬if else switch case break try catchå‡½æ•°è°ƒç”¨Beet!å†…ç›´äº†å¤§é‡çš„å¸¸ç”¨å‡½æ•°ä»¥è¾…åŠ©æ¨¡æ¿æ¸²æŸ“ã€è§„åˆ™å¼•æ“ç­‰åŠŸèƒ½ï¼Œ å‡½æ•°è°ƒç”¨æ–¹æ³•ä¸ JSä¸€æ ·ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥æ³¨å†Œè‡ªå®šä¹‰ çš„ å‡½æ•°ï¼Œè‡ªå®šä¹‰å‡½æ•°å¯ä»¥é€šè¿‡ Java æ¥å®ç° ï¼Œæˆ–è€…é€šè¿‡ Beet! æœ¬èº«æ¥å®ç°ã€‚ Beetl æä¾›çš„å¸¸ç”¨å‡½æ•°å¦‚ä¸‹ : printå’Œ printlnï¼Œè¾“å‡ºå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸ºç©ºï¼Œåˆ™ä¸è¾“å‡ºã€‚ hasï¼Œåˆ¤æ–­æ˜¯å¦å…·æœ‰è¿™ä¸ªå…¨å±€å˜é‡ï¼Œå¦‚ if(has(userList)){â€¦.}ï¼Œåˆ¤æ–­ åå°æ˜¯å¦æä¾›äº† userList å˜é‡ ã€‚ isEmptyï¼Œåˆ¤æ–­å˜é‡æˆ–è€…è¡¨è¾¾å¼æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¸º nullï¼Œéƒ½è¿”å› true:åŒæ—¶å¦‚ æœå­—ç¬¦ä¸²ç©ºï¼Œé›†åˆç©ºä¹Ÿè¿”å› true; isNotEmpty åˆ™ç›¸åã€‚ debugï¼Œåœ¨æ§åˆ¶å°æ‰“å°å˜é‡æˆ–è€…è¡¨è¾¾å¼ã€‚æ­¤æ–¹æ³•è¿˜ä¼šé™„å¸¦æ­¤è°ƒç”¨æ‰€åœ¨çš„æ–‡ä»¶å’Œæ¨¡æ¿ï¼Œä»¥åŠå˜é‡çš„åå­—ç­‰ä¿¡æ¯ï¼Œæ–¹ä¾¿è¿½è¸ª ã€‚ dateï¼Œæ—¥æœŸå‡½æ•°ï¼Œè·å¾—å½“å‰æ—¥æœŸã€‚ trimï¼Œæˆªå–ä¸€ä¸ªæ—¥æœŸæˆ–è€…æ•°å­—ç±»å‹äº•è¿”å›å­—ç¬¦ä¸²ï¼Œå¦‚trim(126.l8,1)è¿”å›å­—ç¬¦ä¸² 126.18, ä½im(date(),â€™yyyyâ€™)è¿”å›å¹´ä»½ 2017ã€‚ parseIntã€parseLongã€parseDoubleï¼Œå°†å­—ç¬¦ä¸²æˆ–è€… numberè½¬ä¸ºå¯¹åº”çš„ç±»å‹ globalï¼Œè¿”å›ä¸€ä¸ªå…¨å±€å˜é‡å€¼ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ varuser= global(â€œuser_â€+i) cookieï¼Œè¿”å›æŒ‡å®šçš„ cookieå¯¹è±¡ï¼Œ å¦‚ var userCook = cookie(â€userâ€),allCookies = cookie() strutil.* ç³»åˆ—å‡½æ•°ï¼Œå¯¹å­—ç¬¦ä¸²çš„æ“ä½œï¼Œå¦‚ strutil.split(â€œabc,defâ€,â€,â€)å°†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå…·ä½“å‚è€ƒBeetlä½¿ç”¨æ‰‹å†Œ array.*ï¼Œ é›†åˆçš„ç›¸å…³å‡½æ•° ï¼Œå¦‚ array.contain shiro.* Springæ˜¯å¸¸ç”¨çš„å®‰å…¨æ¡†æ¶ï¼Œå¹¶éæ˜¯Beetlçš„å†…ç½®å‡½æ•°(å‚è€ƒå®˜ç½‘æ‰‹å†Œ) spring.* Springæ¡†æ¶ä¸­å¯ä»¥ä½¿ç”¨çš„ä¸€ç³»åˆ—å‡½æ•°ï¼Œæ¯”å¦‚ spelè¡¨è¾¾å¼ reg.*ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„ç›¸å…³å‡½æ•° æ ¼å¼åŒ–å‡½æ•°æ ¼å¼åŒ–çš„æ ¼å¼æ˜¯${exp,formatName=â€å¯é€‰å‚æ•°â€} ç›´æ¥è°ƒç”¨Javaå¯ä»¥åœ¨æ¨¡æ¿ä¸­ä»¥ Javaæ–¹å¼è°ƒç”¨è¡¨è¾¾å¼ï¼Œä½¿ç”¨çš„æ—¶å€™ï¼Œå¿…é¡»åœ¨è¡¨è¾¾å¼å‰ä½¿ç”¨@ç¬¦å·ä»¥è¡¨ç¤ºå…¶ åè¡¨è¾¾å¼æ˜¯ Java é£æ ¼çš„ æ ‡ç­¾å‡½æ•°æ‰€è°“æ ‡ç­¾å‡½æ•°ï¼Œå³å…è®¸å¤„ç†æ¨¡æ¿æ–‡ä»¶ä¸­çš„ä¸€å—å†…å®¹ï¼ŒåŠŸèƒ½ç­‰åŒäº jsp tag HTML æ ‡ç­¾HTML æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‡ç­¾å‡½æ•°ï¼Œ Beetl åœ¨å½¢å¼ä¸Šä¸HTMLæ ‡ç­¾ç±»ä¼¼ï¼Œ Beetl é»˜è®¤é€šè¿‡#ç¬¦å· æ¥åŒºåˆ† Beetlçš„HTMLæ ‡ç­¾ å®‰å…¨è¾“å‡ºBeetl åœ¨å˜é‡è¡¨è¾¾å¼åé¢ä½¿ç”¨ç¬¦å·â€œ!â€æ¥æé†’ Beetl æ­¤å˜é‡å¯èƒ½ä¸å­˜åœ¨ï¼Œè¡¨è¾¾å¼å°†è¿”å›â€œ ! â€ åçš„è¡¨è¾¾å¼å€¼ï¼Œå¦‚æœå…¶åæ²¡æœ‰è¡¨è¾¾å¼ï¼Œåˆ™è¿”å› nullã€‚ é«˜çº§åŠŸèƒ½é…ç½® Beetlåœ¨ resources ä¸‹æ·»åŠ  beetl.properties æ–‡ä»¶æ¥ä¸ªæ€§åŒ– Beetl è‡ªå®šä¹‰å‡½æ•°è‡ªå®šä¹‰æ–¹æ³•å¯ä»¥é€šè¿‡ Functionæ¥å£çš„ callæ–¹æ³•å®ç° è‡ªå®šä¹‰æ ¼å¼åŒ–å‡½æ•°è‡ªå®šä¹‰æ ‡ç­¾å‡½æ•°è‡ªå®šä¹‰ HTML æ ‡ç­¾å¸ƒå±€å¸ƒå±€æ˜¯ä¿æŒæ¨¡æ¿é‡ç”¨çš„æœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œ Beet) å¯ä»¥è”åˆ include å’Œ layout æ¥å®ç°é‡ç”¨ AJAXå±€éƒ¨æ¸²æŸ“è„šæœ¬å¼•æ“Beetl æ˜¯æ¨¡æ¿å¼•æ“ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªè„šæœ¬è¯­è¨€ï¼Œå®ƒåœ¨è§£æé˜¶æ®µä¼šå°†æ¨¡æ¿è½¬åŒ–ä¸º Beetl è„šæœ¬æ‰§è¡Œã€‚groupTemplate æä¾›äº†æ‰§è¡Œè„šæœ¬çš„åŠŸèƒ½ï¼Œå¹¶èƒ½è·å–åˆ°è¿”å›å€¼ JSON æŠ€æœ¯åœ¨ Controller ä¸­ï¼Œæ–¹æ³•æ³¨è§£ä¸º@ResponseBodyï¼Œåˆ™ è‡ªåŠ¨å°†æ–¹æ³•è¿”å›çš„å¯¹è±¡åºåˆ—åŒ–æˆ JSONã€‚ MVCåˆ†ç¦»å¼€å‘Beetlæä¾›äº† WebSimulateæ¥æ”¯æŒè¿™ç§åˆ†ç¦»","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (3) MVC","slug":"SpringBoot2-3","date":"2018-12-21T16:27:44.000Z","updated":"2020-07-25T02:57:18.167Z","comments":true,"path":"2018/12/22/SpringBoot2-3/","link":"","permalink":"https://jigangduan.github.io/2018/12/22/SpringBoot2-3/","excerpt":"","text":"MVC æ¡†æ¶ä¼šå¤„ç†å¦‚ä¸‹æŠ€æœ¯éœ€æ±‚ : HTTP URL æ˜ å°„åˆ° ControlleræŸä¸ªæ–¹æ³• HTTP å‚æ•°æ˜ å°„åˆ° Controller æ–¹æ³•çš„å‚æ•°ä¸Šï¼Œæ¯”å¦‚å‚æ•°æ˜ å°„åˆ°æŸä¸ª Java å¯¹è±¡ï¼Œæˆ–è€…ä¸Š ä¼ é™„ä»¶æ˜ å°„åˆ°æŸä¸ª Fileå¯¹è±¡ä¸Š: å‚æ•°çš„æ ¡éªŒ; MVC é”™è¯¯å¤„ç† MVC ä¸­å¦‚ä½•è°ƒç”¨è§†å›¾ MVC ä¸­å¦‚ä½•åºåˆ—åŒ–å¯¹è±¡æˆ JSON æ‹¦æˆªå™¨ç­‰é«˜çº§å®šåˆ¶ é›†æˆMVCæ¡†æ¶å¼•å…¥ä¾èµ–1234&lt;depeÎ·dency&gt; &lt;groupid&gt;org.springframework.boot&lt;/groupid&gt; &lt;artifactid&gt;spring-boot-starter-web&lt;/artifactid&gt;&lt;/dependency&gt; Beetl æ¨¡æ¿ 12345&lt;dependency&gt; &lt;groupid&gt;com.ibeetl&lt;/groupid&gt; &lt;artifactid&gt;beetl-framework-starter&lt;/artifactid&gt; &lt;version&gt;1.1.15.RELEASE&lt;/version&gt;&lt;/dependency&gt; Web åº”ç”¨ç›®å½•ç»“æ„ resources/templates æ¨¡æ¿æ–‡ä»¶ resources/static é™æ€èµ„æºæ–‡ä»¶ï¼Œå¦‚ JSã€ cssã€å›¾ç‰‡ è§†å›¾åè‡ªåŠ¨åœ¨ templates ç›®å½•ä¸‹æ‰¾åˆ°å¯¹ åº”çš„æ¨¡æ¿åç§°ï¼Œæ¨¡æ¿ä¸­ä½¿ç”¨çš„é™æ€èµ„æºå°†åœ¨ static ç›®å½•ä¸‹æŸ¥æ‰¾ Java åŒ…åç»“æ„ Controller ä¸€ä¸€ æ­¤åŒ…ä¸‹åŒ…å«äº† MVC çš„ Controller Service ä¸€ä¸€ æ­¤åŒ…ä¸‹æœ‰ä¸šåŠ¡å¤„ç†ä»£ç  entity ä¸€ä¸€ åŒ…å«äº†ä¸šåŠ¡å®ä½“ conf ä¸€ä¸€ åŒ…å«äº†ä¸€äº›é…ç½®ç±»ï¼Œæ¯”å¦‚ç”¨äºé…ç½®æ•°æ®æºçš„ DataSourceConfig Controllerç±»ä¸Šå£°æ˜@Controllerï¼Œ æ ‡æ³¨è¿™æ˜¯ä¸€ä¸ª Controller @RequestMapping æ˜ å°„ HTTP è¯·æ±‚åˆ°ç‰¹å®šçš„æ–¹æ³•å¤„ç†ç±».@RequestMapping æ—¢å¯ä»¥ä½œç”¨åœ¨æ–¹æ³•ä¸Š ï¼Œ ä¹Ÿå¯ä»¥ä½œç”¨åœ¨ç±»ä¸Š è¿”å›çš„æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œå¦‚æœæƒ³ç›´æ¥è¿”å›å†…å®¹è€Œä¸æ˜¯è§†å›¾å ï¼Œåˆ™éœ€è¦åœ¨æ–¹ æ³•ä¸Šä½¿ç”¨@ResponseBody URLæ˜ å°„åˆ°ä¸‡æ³•@RequestMappingæ¥æ˜ å°„ URLRequestMapping å±æ€§: valueï¼Œè¯·æ±‚çš„ URL çš„è·¯å¾„ï¼Œæ”¯æŒ URLæ¨¡æ¿ã€æ­£åˆ™è¡¨è¾¾å¼ æ³¨è§£PathVariableä½œç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Šï¼Œç”¨æ¥è¡¨ç¤ºå‚æ•°çš„å€¼æ¥è‡ªäº URL è·¯å¾„ æœ‰é€šé…ç¬¦çš„ä½äºæ²¡æœ‰é€šé…ç¬¦çš„ï¼Œ æ¯”å¦‚/user/add.json æ¯”/user/*.jsonä¼˜å…ˆåŒ¹é… æœ‰â€œ*â€é€šé…ç¬¦çš„ä½äºæœ‰â€œâ€œé€šé…ç¬¦çš„ ä½¿ç”¨${}æ¥è·å¾—ç³»ç»Ÿçš„é…ç½®æˆ–è€…ç¯å¢ƒå˜é‡ method, HTTP è¯·æ±‚æ–¹æ³•ï¼Œæœ‰ GETã€ POSTã€ PUT ç­‰ GETï¼Œç”¨æ¥è·å– URL å¯¹åº”çš„å†…å®¹ POSTï¼Œç”¨æ¥å‘æœåŠ¡å™¨æäº¤ä¿¡æ¯, è¯­ä¹‰ä¸Šæ–°å¢æ“ä½œ HEADï¼ŒåŒ GETï¼Œä½†ä¸è¿”å›æ¶ˆæ¯ä½“ï¼Œé€šå¸¸ç”¨äºè¿”å› URL å¯¹åº”çš„å…ƒä¿¡æ¯ï¼Œå¦‚è¿‡æœŸæ—¶é—´ç­‰ PUTï¼Œ åŒPOSTï¼Œç”¨æ¥å‘æœåŠ¡å™¨æäº¤ä¿¡æ¯ï¼Œä½†è¯­ä¹‰ä¸Šæ›´æ–°æ“ä½œ DELETEï¼Œåˆ é™¤å¯¹åº”çš„èµ„æºä¿¡æ¯ PATCHæ–¹æ³•ï¼Œ ç±»ä¼¼PUTæ–¹æ³•ï¼Œè¡¨ç¤ºä¿¡æ¯çš„å±€éƒ¨æ›´æ–°ç®€åŒ–çš„@RequestMapping @GetMapping @PostMapping @PutMapping @DeleteMapping @PatchMapping consumesï¼Œå…è®¸çš„åª’ä½“ç±»å‹(Media Types)ï¼Œå¦‚ consumes=&quot;application/ison&quot;ï¼Œ å¯¹åº”äºè¯·æ±‚çš„HTTPçš„ Content-Type producesï¼Œç›¸åº”çš„åª’ä½“ç±»å‹ï¼Œå¦‚ produces=&quot;application/json&quot;ï¼Œ å¯¹åº”äº HTTP çš„ Acceptå®‡æ®µ params ï¼Œè¯·æ±‚çš„å‚æ•° ï¼Œå¦‚ params=&quot;action=update&quot; æ–¹æ³•å‚æ•°Controlleræ–¹æ³•å¯ä»¥æ¥å—å¤šç§ç±»å‹å‚æ•° @PathVariableï¼Œå¯ä»¥å°†URLä¸­çš„å€¼æ˜ å°„åˆ°æ–¹æ³•å‚æ•°ä¸­ Model, Spring ä¸­é€šç”¨çš„ MVC æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Map å’Œ ModelMap ä½œä¸ºæ¸²æŸ“è§†å›¾çš„æ¨¡å‹ ModelAndViewï¼ŒåŒ…å«äº†æ¨¡å‹å’Œè§†å›¾è·¯å¾„çš„å¯¹è±¡ JavaBeanï¼Œå°† HTTP å‚æ•°æ˜ å°„åˆ° JavaBean å¯¹è±¡ MultipartFileï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼  @ModelAttributeï¼Œä½¿ç”¨è¯¥æ³¨è§£çš„å˜é‡å°†ä½œä¸º Modelçš„ä¸€ä¸ªå±æ€§ WebRequest æˆ–è€… NativeWebRequestï¼Œç±»ä¼¼ Servlet Requestï¼Œä½†åšäº†ä¸€å®šå°è£… java.io.InputStream å’Œ java.io.Readerï¼Œç”¨æ¥è·å– Servlet API ä¸­çš„ lnputStream/Reader java.io.OutputStream/java.io.Writerï¼Œç”¨æ¥è·å– Servlet API ä¸­çš„ OutputStream/Writer HttpMethodï¼Œ æšä¸¾ç±»å‹ ï¼Œ å¯¹åº”äº HTTP Methodï¼Œå¦‚ POSTã€ GET @MatrixVariableï¼ŒçŸ©é˜µå˜é‡ @RequestParamï¼Œ å¯¹åº”äº HTTPè¯·æ±‚çš„å‚æ•°ï¼Œè‡ªåŠ¨è½¬åŒ–ä¸ºå‚æ•°å¯¹åº”çš„ç±»å‹ @RequestHeaderï¼Œå¯¹åº”äº HTTPè¯·æ±‚å¤´å‚æ•°ï¼Œè‡ªåŠ¨è½¬åŒ–ä¸ºå¯¹åº”çš„ç±»å‹ @RequestBodyï¼Œ è‡ªåŠ¨å°†è¯·æ±‚å†…å®¹è½¬ä¸ºæŒ‡å®šçš„å¯¹è±¡ ï¼Œ é»˜è®¤ä½¿ç”¨ HtÏˆMessageConverters æ¥è½¬åŒ– @RequestPartï¼Œç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼Œå¯¹åº”äº HTTP åè®®çš„ multipart/form-data @SessionAttributeï¼Œ è¯¥æ–¹æ³•æ ‡æ³¨çš„å˜é‡æ¥è‡ªäº Session çš„å±æ€§ @RequestAttributeï¼Œè¯¥æ ‡æ³¨çš„å˜é‡æ¥è‡ªäº request çš„å±æ€§ @InitBinderï¼Œç”¨åœ¨æ–¹æ³•ä¸Šï¼Œè¯´æ˜è¿™ä¸ªæ–¹æ³•ä¼šæ³¨å†Œå¤šä¸ªè½¬ åŒ– å™¨ï¼Œç”¨æ¥ä¸ªæ€§åŒ–åœ°å°† HTTP è¯·æ±‚å‚æ•°è½¬åŒ–æˆå¯¹åº”çš„ Javaå¯¹è±¡ï¼Œå¦‚è½¬åŒ–ä¸ºæ—¥æœŸç±»å‹ã€æµ®ç‚¹ç±»å‹ã€JavaBeanç­‰ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å®ç° WebBindinglnitializeræ¥å£æ¥ç”¨äº SpringBootåº”ç”¨æ‰€éœ€è¦çš„ dataBinder BindingResultå’Œ Errorsï¼Œ ç”¨æ¥å¤„ç†ç»‘å®šè¿‡ç¨‹ä¸­çš„é”™è¯¯ éªŒè¯JSR-303æ³¨è§£ç”¨æ¥éªŒè¯ Bean çš„å±æ€§: ç©ºæ£€æŸ¥ @Nullï¼Œ éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºç©º @NotNullï¼Œ éªŒè¯å¯¹è±¡ä¸ä¸ºç©º @NotBlankï¼Œ éªŒè¯å­—ç¬¦ä¸²ä¸ä¸ºç©ºæˆ–è€…ä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œ æ¯”å¦‚â€â€å’Œâ€â€éƒ½ä¼šéªŒè¯å¤±è´¥ @NotEmptyï¼Œ éªŒè¯å¯¹è±¡ä¸ä¸º nullï¼Œæˆ–è€…é›†åˆä¸ä¸ºç©º é•¿åº¦æ£€æŸ¥ @Size(min=, max=)ï¼ŒéªŒè¯å¯¹è±¡é•¿åº¦ï¼Œå¯æ”¯æŒå­—ç¬¦ä¸²ã€é›†åˆ @Lengthï¼Œ å­—ç¬¦ä¸²å¤§å° æ•°å€¼æ£€æµ‹ @Minï¼ŒéªŒè¯æ•°å­—æ˜¯å¦å¤§äºç­‰äºæŒ‡å®šçš„å€¼ @Maxï¼ŒéªŒè¯æ•°å­—æ˜¯å¦å°äºç­‰äºæŒ‡å®šçš„å€¼ @Digitsï¼ŒéªŒè¯æ•°å­—æ˜¯å¦ç¬¦åˆæŒ‡å®šæ ¼å¼ï¼Œå¦‚@Digits(integer=9ï¼Œfraction=2) @Rangeï¼ŒéªŒè¯æ•°å­—æ˜¯å¦åœ¨æŒ‡å®šçš„èŒƒå›´å†…ï¼Œå¦‚@Range(min=l, max=lOOO) å…¶ä»– @Emailï¼Œ éªŒè¯æ˜¯å¦ä¸ºé‚®ä»¶æ ¼å¼ï¼Œä¸º null åˆ™ä¸åšæ ¡éªŒ @Patternï¼Œ éªŒè¯ Stringå¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™ group, åªæœ‰ groupåŒ¹é…çš„æ—¶å€™ï¼Œæ ¡éªŒæ³¨è§£æ‰èƒ½ç”Ÿæ•ˆ @Validatedå‚æ•°ä½¿ç”¨@Validatedæ³¨è§£ï¼Œå°†è§¦å‘ Springçš„æ ¡éªŒï¼Œ äº•å°†éªŒè¯ç»“æœå­˜æ”¾åˆ° BindingResultå¯¹è±¡ä¸­ BindingResult åŒ…å«äº†éªŒè¯ç»“æœï¼Œæä¾›äº†å¦‚ä¸‹æ–¹æ³• : hasErrorsï¼Œåˆ¤æ–­éªŒè¯æ˜¯å¦é€šè¿‡ : getAllErrorsï¼Œå¾—åˆ°æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸è¿”å›çš„æ˜¯ FieldErroråˆ—è¡¨ è‡ªå®šä¹‰æ ¡éªŒ@Constraint æ³¨è§£å£°æ˜ç”¨ä»€ä¹ˆç±»æ¥å®ç°éªŒè¯ éªŒè¯æ³¨è§£å¿…é¡»è¦æä¾›å¦‚ä¸‹ä¿¡æ¯ : messageï¼Œ ç”¨äºåˆ›å»ºé”™è¯¯ä¿¡æ¯ï¼Œæ”¯æŒè¡¨è¾¾å¼ï¼Œå¦‚â€œé”™è¯¯ï¼Œ ä¸èƒ½è¶…è¿‡(max) å°æ—¶â€ groupsï¼ŒéªŒè¯è§„åˆ™åˆ†ç»„ï¼Œ æ¯”å¦‚æ–°å¢å’Œä¿®æ”¹çš„éªŒè¯è§„åˆ™ä¸ä¸€æ ·ï¼Œåˆ†ä¸ºä¸¤ä¸ªç»„ï¼ŒéªŒè¯æ³¨è§£å¿…é¡»æä¾› payloadï¼Œ å®šä¹‰äº†éªŒè¯ çš„æœ‰æ•ˆè´Ÿè· WebMvcConfigureræ‹¦æˆªå™¨addlnterceptors è®¾ç½®å¤šä¸ªæ‹¦æˆªå™¨ è·¨åŸŸè®¿é—®addCorsMappings æ ¼å¼åŒ–addFormatters æ³¨å†Œ ControlleraddViewController ddRedirectViewController è§†å›¾æŠ€æœ¯FreemarkerFreemarker ä¼šè‡ªåŠ¨æ·»åŠ åç¼€ è´Ÿl æ¥å¯»æ‰¾åŒ¹é… çš„ userlnfo.ftl æ¨¡æ¿ Beetlè¯­æ³•å’Œä½¿ç”¨ä¹ æƒ¯å‚è€ƒäº† JS JacksonJSONçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– Redirecté‡å®šå‘è¯·æ±‚ fowardç”¨æ¥åœ¨ Controlleræ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œå¦å¤–ä¸€ä¸ª Controller çš„æ–¹æ³• é€šç”¨é”™è¯¯å¤„ç†Controllerä¸­æŠ›å‡ºçš„å¼‚å¸¸é»˜è®¤äº¤ç»™äº†/erroræ¥å¤„ç†ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å°†/erroræ˜ å°„ åˆ°ä¸€ä¸ªç‰¹å®šçš„ Controller ä¸­å¤„ç†æ¥ä»£æ›¿ Spring Boot çš„é»˜è®¤å®ç° ï¼Œ åº”ç”¨å¯ ä»¥ç»§æ‰¿ AbstractEirnrÂ°Controller æ¥ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å„ç§å¼‚å¸¸ AbstractErrorConä½oiler æä¾› äº†å¤šä¸ªæ–¹æ³•å¯ä»¥ä» request ä¸­è·å–é”™è¯¯ä¿¡æ¯: timestampï¼Œ é”™è¯¯å‘ç”Ÿçš„æ—¶é—´ statusï¼Œ å¯¹åº”äº HTTP Statusï¼Œ å¦‚ 404 errorï¼Œ é”™è¯¯æ¶ˆæ¯ï¼Œ å¦‚ BadRequestã€ NotFound messageï¼Œ è¯¦ç»†é”™è¯¯ä¿¡æ¯ exceptionï¼Œ å¦‚æœåº”ç”¨æŠ›å‡ºæœ‰å¼‚å¸¸ï¼Œexceptionæ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å¼‚å¸¸çš„ç±»å pathï¼Œè¯·æ±‚çš„ URI errors, @Validated æ ¡éªŒé”™è¯¯çš„æ—¶å€™ ï¼Œ æ ¡éªŒç»“æœä¿¡æ¯æ”¾åˆ°è¿™é‡Œ @Service å’Œ@TransactionalServiceä¸­å¤„ç† ä¸šåŠ¡é€»è¾‘, å®šä¹‰ä¸€ä¸ªä¸šåŠ¡çš„æ¥å£ @Transanhlæ¥è®© Serviceå‚ä¸äº‹åŠ¡ç®¡ç† äº‹åŠ¡ä¸Šä¸‹æ–‡ : å¯¹äº Service è°ƒç”¨ï¼Œå¦‚æœå¤„äºåŒä¸€ä¸ªäº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“çš„æ“ä½œä¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚äº‹åŠ¡ä¸Šä¸‹æ–‡çš„å¼€å¯æ˜¯ä» Contralleã€Œä¸­è°ƒç”¨å¦é—® ice æ–¹æ³•çš„æ—¶å€™è‡ªåŠ¨å¼€å¯çš„ï¼Œ å¹¶åœ¨è°ƒç”¨æ­¤æ–¹æ³•åè‡ªåŠ¨ç»“æŸä»è€Œæäº¤äº‹åŠ¡ï¼Œæˆ–è€…æ ¹æ®æŠ›å‡ºçš„ RuntimeException æ¥è‡ªåŠ¨å›æ»šï¼Œè°ƒç”¨è¿‡ç¨‹ä¸­è°ƒç”¨çš„å…¶ä»– Service æ–¹æ³•éƒ½ä¼šå¤„äºè¿™ä¸ªäº‹ åŠ¡ä¸Šä¸‹æ–‡ä¸­ã€‚å¯ä»¥åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­å†æ¬¡å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œè¿™æ—¶å€™é€šè¿‡æ³¨è§£@ Transactiona1 (propagation = Propagation.REOUIRES_NEW)å®Œæˆï¼Œæ¯”å¦‚åœ¨ AuditService ä¸­ï¼Œå®¡è®¡æœåŠ¡æ—  è®ºä¸šåŠ¡è°ƒç”¨æ˜¯å¦æˆåŠŸï¼Œéƒ½å¿…é¡»æŠŠå®¡è®¡ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤ AuditService å¯ä»¥é…ç½® ä¸ºå¼€å¯æ–°çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (2) åŸºç¡€","slug":"SpringBoot2-2","date":"2018-12-21T15:27:17.000Z","updated":"2020-07-25T02:57:18.166Z","comments":true,"path":"2018/12/21/SpringBoot2-2/","link":"","permalink":"https://jigangduan.github.io/2018/12/21/SpringBoot2-2/","excerpt":"","text":"å¼€å‘å·¥å…· JDK8+ Maven ä½¿æ„å»ºé¡¹ç›®å˜å¾—å¾ˆå®¹æ˜“ï¼Œ Maven å±è”½äº†æ„å»ºçš„å¤æ‚è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼Œä½ åªéœ€è¦è¾“å…¥ maven package å°±å¯ä»¥æ„å»ºæ•´ä¸ª Java é¡¹ç›®ã€‚ ç»Ÿä¸€äº†æ„å»ºé¡¹ç›®çš„æ–¹å¼ï¼Œä¸åŒäººã€ä¸åŒå…¬å¸çš„é¡¹ç›®éƒ½æœ‰åŒæ ·çš„æè¿°é¡¹ç›®å’Œæ„å»ºé¡¹ç›®çš„ æ–¹å¼ï¼Œ Maven é€šè¿‡ pom.xml æ¥æè¿°é¡¹ç›®ï¼Œäº•æä¾›ä¸€ç³»åˆ—æ’ä»¶æ¥æ„å»ºé¡¹ç›® ã€‚åªè¦ç†Ÿæ‚‰äº† Mavenï¼Œå°±ç†Ÿæ‚‰äº†æ‰€æœ‰é¡¹ç›®çš„æ„å»ºæ–¹å¼ ã€‚ æå‡ºäº†ä¸€å¥—å¼€å‘é¡¹ç›®çš„æœ€ä½³å®è·µï¼Œè€Œä¸ç”¨æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ä¸åŒç»“æ„å’Œæ„å»ºæ–¹å¼ï¼Œæ¯”å¦‚æº ä»£ç åœ¨ src/main/iava ä¸­ï¼Œæµ‹è¯•ä»£ç åˆ™åœ¨ src/test/iava ä¸­ï¼Œé¡¹ç›®éœ€è¦çš„é…ç½®æ–‡ä»¶åˆ™æ”¾åœ¨ src/main/resources ä¸­ã€‚ åŒ…å«ä¸åŒç¯å¢ƒé¡¹ç›®çš„æ„å»ºæ–¹å¼ã€‚ è§£å†³äº†ç±»åº“ä¾èµ–çš„é—®é¢˜ï¼Œåªéœ€è¦å£°æ˜ä½¿ç”¨çš„ç±»åº“ï¼Œ Maven ä¼šè‡ªåŠ¨ä»ä»“åº“ä¸‹è½½ä¾èµ–çš„ jaråŒ…ï¼Œå¹¶èƒ½ååŠ©ä½ ç®¡ç† jaråŒ…ä¹‹é—´çš„å†²çªã€‚ pom.xrnlï¼Œç”¨ XML æ–¹å¼æè¿°äº†é¡¹ç›®æ¨¡å‹ï¼Œ porné€šå¸¸æœ‰ä»¥ä¸‹å…ƒç´ : groupId: è¡¨ç¤ºé¡¹ç›®æ‰€å±çš„ç»„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå…¬å¸æˆ–è€…ç»„ç»‡çš„åç§°ï¼Œå¦‚ orgå©ringframeworkã€‚ artifactld: é¡¹ç›®å”¯ä¸€çš„æ ‡è¯†ï¼Œæ¯”å¦‚ï¼Œæœ‰ spring-boot-starter-webã€ spring-boot-devtoolsã€groupId å’Œ artifactld èƒ½å”¯ä¸€æ ‡è¯†ä¸€ä¸ªé¡¹ç›®æˆ–è€…ä¸€ä¸ªåº“ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºé¡¹ç›®åæ ‡ ã€‚ packaging: é¡¹ç›®çš„ç±»å‹ï¼Œå¸¸ç”¨çš„æœ‰jarå’Œ warä¸¤ç§ï¼Œ jarè¡¨ç¤ºé¡¹ç›®ä¼šæ‰“åŒ…æˆä¸€ä¸ªjaråŒ…ï¼Œ è¿™æ˜¯ SpringBootçš„é»˜è®¤ä½¿ç”¨æ–¹å¼ã€‚ version: é¡¹ç›®çš„ç‰ˆæœ¬å· ï¼Œæ¯”å¦‚ 0Î².1å‰² APSHOTã€ 1.5.2.RELEASEã€‚ SNAPSHOT è¡¨ç¤ºå¼€å‘ä¸­çš„ç‰ˆæœ¬ï¼Œä¼šä¿®å¤ bug å’Œæ·»åŠ æ–° åŠŸèƒ½ RELEASE è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ­£å¼å‘å¸ƒç‰ˆ M1,M2(M æŒ‡ é‡Œç¨‹ç¢‘ ï¼Œ å³å°†å‘å¸ƒ) RC(Release Candidateï¼Œå‘å¸ƒå€™é€‰) GA(general availabilityï¼ŒåŸºæœ¬å¯ç”¨ç‰ˆæœ¬)SNAPSHOT&lt;ml&lt;m2...&lt;RC&lt;GA&lt;Realease modelVersion: ä»£è¡¨ pom æ–‡ä»¶çš„ Maven çš„ç‰ˆæœ¬ï¼Œå¦‚å†™ä½œçš„æ—¶å€™ Maven çš„ modelVersionæ˜¯ 4.0.0ã€‚ dependencies:æ­¤å…ƒç´ ä¸‹åŒ…å«äº†å¤šä¸ª dependencyï¼Œç”¨æ¥å£°æ˜é¡¹ç›® çš„ä¾èµ–ï¼Œè¿™æ˜¯ porn æœ€ æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚ dependency: åŒ…å«åœ¨ dependencies ä¸­ï¼Œç”¨ æ¥å£° æ˜é¡¹ç›®çš„ä¾èµ–ï¼Œæ¯”å¦‚é¡¹ç›®ç”¨åˆ°çš„ MySQL é©±åŠ¨ã€‚ scope: scope ä»£è¡¨æ­¤ç±»åº“ä¸é¡¹ç›®çš„å…³ç³» compile é»˜è®¤,ç¼–è¯‘å’Œæ‰“åŒ…éƒ½éœ€è¦æ­¤ ç±»åº“ test è¡¨ç¤ºä»…ä»…åœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™éœ€è¦ provided è¡¨ç¤ºåœ¨ç¼–è¯‘é˜¶æ®µéœ€è¦æ­¤ç±»åº“ï¼Œä½† æ‰“åŒ…é˜¶æ®µä¸éœ€è¦ï¼Œè¿™æ˜¯å› ä¸ºé¡¹ç›®çš„ç›®æ ‡ç¯å¢ƒå·±ç»æä¾›äº† runtimeè¡¨ç¤ºåœ¨ç¼–è¯‘å’Œæ‰“åŒ…çš„ æ—¶å€™éƒ½ä¸éœ€è¦ï¼Œä½†åœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦ï¼Œæ¯”å¦‚æŸä¸ªæŒ‡å®šçš„æ•°æ®åº“é©±åŠ¨ï¼Œç¼–è¯‘å’Œæ‰“åŒ…éƒ½ä¸ éœ€è¦ ï¼Œä½†æµ‹è¯•åº”ç”¨è¦è¿åˆ°æ•°æ®åº“ æ—¶å°± éœ€è¦æ­¤æ•°æ®åº“é©±åŠ¨ ã€‚ build: æ­¤é¡¹åœ¨ pom ä¸­å¯è¾¹ï¼Œ buildåŒ…å«äº†å¤šä¸ªæ’ä»¶ pluginï¼Œç”¨æ¥è¾…åŠ©é¡¹ç›®æ„å»º Maven å¸¸ç”¨å‘½ä»¤ mvn compile: ç¼–è¯‘ Maven å·¥ç¨‹ mvn package: ç¼–è¯‘äº•æ‰“åŒ…å·¥ç¨‹ï¼Œ æ ¹æ® pom.xml ä¸­å…ƒç´  packagingæ˜¯jarè¿˜æ˜¯ warè¿›è¡Œæ‰“åŒ… mvn install:æ‰“åŒ…äº•å®‰è£…åˆ°æœ¬åœ°ä»“åº“ mvn deploy: åŒ installï¼Œä½†æ‰“åŒ…äº•å®‰è£…åˆ°è¿œç¨‹ä»“åº“ mvn clean: åˆ é™¤ target ç›®å½• Spring æ ¸å¿ƒæŠ€æœ¯Spring å®¹å™¨Spring IoCIoC (Inversion ofControlï¼Œåå‘æ§åˆ¶ã€‰åŸåˆ™ï¼Œæ›´ä¸ºå½¢è±¡çš„ç§°å‘¼æ˜¯ DI (dependency injectionï¼Œä¾èµ–æ³¨å…¥)ã€‚ç›¸å¯¹äºBeanç›´æ¥æ„é€ ä¾èµ–çš„å¯¹è±¡ï¼Œ Springæ¡†æ¶åˆ™æ ¹æ®Beanä¹‹é—´çš„ä¾èµ–å…³ç³»åˆ›å»ºå¯¹è±¡ï¼Œå¹¶æ³¨å…¥åˆ° Bean ä¸­ã€‚ Spring å¸¸ç”¨æ³¨è§£ Controller: å£°æ˜æ­¤ç±»æ˜¯ä¸€ä¸ª MVC ç±»ï¼Œé€šå¸¸ä¸@RequestMapping ä¸€èµ·ä½¿ç”¨ Service: å£° æ˜æ­¤ç±»æ˜¯ä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼Œé€šå¸¸ä¸@Transactional ä¸€èµ·é…åˆä½¿ç”¨ Repository: å£°æ˜æ­¤ç±»æ˜¯ä¸€ä¸ªæ•°æ®åº“æˆ–è€…å…¶ä»– NoSQL å‡ºé—®ç±»ã€‚ RestController: åŒ Controllerï¼Œ ç”¨äº REST æœåŠ¡ã€‚ Component:å£°æ˜æ­¤ç±»æ˜¯ä¸€ä¸ª Springç®¡ç†çš„ç±»ï¼Œé€šå¸¸ç”¨äºæ— æ³•ç”¨ä¸Šè¿°æ³¨è§£æè¿°çš„ Springç®¡ç†ç±»ã€‚ Configuration: å£°æ˜æ­¤ç±»æ˜¯ ä¸€ä¸ªé…ç½®ç±»ï¼Œé€šå¸¸ä¸æ³¨è§£@Bean é…åˆä½¿ç”¨ã€‚ Bean: ä½œç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜è¯¥æ–¹æ³•æ‰§è¡Œçš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ª Spring å®¹å™¨ç®¡ç†çš„ Beanã€‚ Spring è´Ÿè´£å®ä¾‹åŒ– Beanï¼Œ å¼€å‘è€…å¯ ä»¥æä¾›ä¸€ç³»åˆ—å›è°ƒå‡½æ•° ï¼Œç”¨äºè¿›ä¸€æ­¥é…ç½® Beanï¼Œ åŒ…æ‹¬@PostConstruct æ³¨è§£å’Œ@PreDestory æ³¨è§£ã€‚ å½“ Bean è¢«å®¹å™¨åˆå§‹åŒ–åï¼Œä¼šè°ƒç”¨@PostConstruct çš„æ³¨è§£æ–¹æ³• åœ¨å®¹å™¨è¢«é”€æ¯ä¹‹å‰ï¼Œè°ƒç”¨è¢« @PreDestory æ³¨è§£çš„æ–¹æ³• å¼•ç”¨Bean: ä½¿ç”¨æ³¨è§£@Qualifieræ¥å¼•ç”¨, æ ¹æ®åå­— è¿‡@Autowired å£°æ˜å¯¹å…¶ä»– Bean çš„å¼•ç”¨, ä½œç”¨äºå±æ€§æˆ–è€…æ„é€ å‡½æ•°å‚æ•°ï¼Œç”šè‡³æ˜¯æ–¹æ³•è°ƒç”¨å‚æ•°ä¸Šã€‚ Spring AOPAOP (Aspect-Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹)æä¾›äº†å¦å¤–ä¸€ç§æ€è·¯æ¥å®ç°åº”ç”¨ç³»ç»Ÿ çš„å…¬å…±æœåŠ¡ ã€‚ æ¯ä¸ªä¸šåŠ¡æ–¹æ³•è°ƒç”¨çš„æƒé™ç®¡ç†: åœ¨ç”¨æˆ·è°ƒç”¨æ–¹æ³•å‰åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒè°ƒç”¨æ­¤æ–¹æ³• æ¯ä¸ªæ–¹æ³•è°ƒç”¨çš„å®¡è®¡: è®°å½•è°è°ƒç”¨äº†ä»€ä¹ˆä¸šåŠ¡æ–¹æ³•ï¼Œä¼ å…¥å‚æ•°æ˜¯ä»€ä¹ˆï¼Œæ“ä½œæ˜¯å¦æˆåŠŸã€‚ æ•°æ®åº“äº‹åŠ¡çš„ç®¡ç†: åœ¨æ‰§è¡Œæ•°æ®åº“ä¸€ç³»åˆ—æ“ä½œå‰ï¼Œå…ˆå¼€å¯äº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œåæäº¤äº‹åŠ¡: å¦‚æœæ‰§è¡Œå‡ºé”™ï¼Œåˆ™å›æ»šäº‹åŠ¡ã€‚ ç¼“å­˜: å¯¹ä¸šåŠ¡æ–¹æ³•è¿”å›çš„æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œä¸‹æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœå‚æ•°æœªå˜ï¼Œç›´æ¥ä»ç¼“ å­˜ä¸­è·å–æ•°æ®ï¼Œè€Œä¸å†è°ƒå–åº”ç”¨æ–¹æ³•ã€‚ AOP æœ‰å¦‚ä¸‹æœ¯è¯­: Aspect: Aspectå£°æ˜ç±»ä¼¼äº Java ä¸­çš„ç±»å£°æ˜ï¼Œåœ¨ Aspect ä¸­ä¼šåŒ…å«ä¸€äº› PointcutåŠç›¸åº” çš„ Advice Jointpoint: è¡¨ç¤ºåœ¨ç¨‹åºä¸­æ˜ç¡®å®šä¹‰çš„ç‚¹ï¼Œå…¸å‹çš„åŒ…æ‹¬æ–¹æ³•è°ƒç”¨ã€å¯¹ç±»æˆå‘˜çš„è®¿é—®ï¼Œ ä»¥åŠå¼‚å¸¸å¤„ç†ç¨‹åºå—çš„æ‰§è¡Œç­‰ã€‚ Spring ä¸­çš„ Jointpoint åªæ”¯æŒæ–¹æ³•è°ƒç”¨ã€‚ Pointcut: è¡¨ç¤ºä¸€ç»„ Joint pointï¼Œ å¦‚æ–¹æ³•åã€å‚æ•°ç±»å‹ã€è¿”å›ç±»å‹ç­‰ï¼Œè¿™äº› Joint point é€šè¿‡é€»è¾‘å…³ç³»ç»„åˆèµ·æ¥ï¼Œ å®ƒå®šä¹‰äº†ç›¸åº”çš„ Adviceå°†è¦å‘ç”Ÿçš„åœ°æ–¹ã€‚ç®€å•ç†è§£ Pointcut(ä¸€ç§è¡¨è¾¾å¼) ä¸€ä¸€ç”¨æ¥åˆ¤æ–­åœ¨ Jointpoint (æ–¹æ³•è°ƒç”¨)ä¸­æ‰§è¡Œ Advice (æ“ä½œ)ã€‚ Advice: Advice å®šä¹‰äº†åœ¨ Pointcuté‡Œé¢å®šä¹‰çš„ç¨‹åºç‚¹å…·ä½“è¦åšçš„æ“ä½œï¼Œ å®ƒé€šè¿‡ beforeã€ aroundã€ after ( returnã€ throwã€ finally)æ¥åŒº åˆ« æ˜¯åœ¨æ¯ä¸ª Joint point ä¹‹å‰ ã€ ä¹‹åè¿˜æ˜¯æ‰§ è¡Œå‰åè¦è°ƒç”¨çš„ä»£ç ã€‚ before: åœ¨æ‰§è¡Œæ–¹æ³•å‰è°ƒç”¨ Adviceï¼Œæ¯”å¦‚ cacheåŠŸèƒ½å¯ä»¥åœ¨æ‰§è¡Œæ–¹æ³•å‰å…ˆåˆ¤æ–­æ˜¯å¦ æœ‰ç¼“å­˜ã€‚ around: åœ¨æ‰§è¡Œæ–¹æ³•å‰åè°ƒç”¨ Adviceï¼Œ è¿™æ˜¯ Spring æ¡†æ¶å’Œåº”ç”¨ç³»ç»Ÿä¸€ç§æœ€ä¸ºå¸¸ç”¨ çš„æ–¹æ³•ï¼Œ after: åœ¨æ‰§è¡Œæ–¹æ³•åè°ƒç”¨ Advice, after returnæ˜¯æ–¹æ³•æ­£å¸¸è¿”å›åè°ƒç”¨ ï¼Œ after throw æ˜¯æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨ ã€‚ finally: æ–¹æ³•è°ƒç”¨åæ‰§è¡Œ Adviceï¼Œ æ— è®ºæ˜¯å¦æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯æ­£å¸¸è¿”å› AOPproxy: AOPProxyä¹Ÿæ˜¯Javaå¯¹è±¡ï¼Œç”±AOPæ¡†æ¶åˆ›å»ºï¼Œ ç”¨æ¥å®Œæˆä¸Šè¿°çš„åŠ¨ä½œï¼Œ AOPå¯¹è±¡é€šå¸¸å¯ä»¥é€šè¿‡ JDKdå½’amicproxyå®Œæˆï¼Œæˆ–è€…ä½¿ç”¨ CGLibå®Œæˆã€‚ Weaving: å®ç°ä¸Šè¿°åˆ‡é¢ç¼–ç¨‹çš„ä»£ç ç»‡å…¥ï¼Œ å¯ä»¥åœ¨ç¼–è¯‘æ—¶åˆ»(é€šè¿‡ AspectJ compiler),ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶åˆ»ï¼Œ Springå’Œå…¶ä»–å¤§å¤šæ•°Javaæ¡†æ¶éƒ½æ˜¯åœ¨è¿è¡Œæ—¶åˆ»ç”Ÿæˆä»£ç†ã€‚ spring-boot-starter-aop","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"Spring Boot 2ç²¾é«“ - (1) JavaEEç®€ä»‹","slug":"SpringBoot2-1-JavaEE","date":"2018-12-21T13:48:39.000Z","updated":"2020-07-25T02:57:18.166Z","comments":true,"path":"2018/12/21/SpringBoot2-1-JavaEE/","link":"","permalink":"https://jigangduan.github.io/2018/12/21/SpringBoot2-1-JavaEE/","excerpt":"","text":"Java EEJava EE æ¶æ„Java EE æ˜¯ä¸€ç§ä¼ä¸šåº”ç”¨çš„è½¯ä»¶æ¶æ„ ã€‚ ä½œä¸ºä¼ä¸šåº”ç”¨æˆ–è€…äº’è”ç½‘åº”ç”¨çš„æ¶æ„ï¼Œ æ€»æœ‰å¦‚ä¸‹åŠŸèƒ½éœ€æ±‚ï¼Œ JavaEEæœ‰ç›¸åº”çš„è§„èŒƒå®ç°ä¸ä¹‹ å¯¹åº” ã€‚ Web æ”¯æŒ : ä¼ä¸šåº”ç”¨ã€äº’è”ç½‘åº”ç”¨è¶Šæ¥è¶Šå¤šçš„æ˜¯åŸºäº B/S çš„ç»“æ„ï¼Œ Java EE å¯¹åº”çš„æœ‰Servietè§„èŒƒï¼Œè§„å®šäº† Web å®¹å™¨ã€ Serviet ç»„ä»¶ ï¼Œ è¿˜è®¾æœ‰ JSP&amp;JSTL å¤„ç†åŠ¨æ€é¡µé¢ ã€‚ äº‹åŠ¡æ”¯æŒ: æä¾›äº‹åŠ¡ç®¡ç†å™¨ï¼Œæ”¯æŒç®¡ç†äº‹åŠ¡ï¼Œå¦‚å•ä¸€æ•°æ®åº“ã€ å¤šä¸ªæ•°æ®åº“ï¼Œä»¥åŠæ•°æ® åº“å’Œå…¶ä»–èµ„æºçš„äº‹åŠ¡åä½œç­‰ã€‚ Java EEé‡Œæä¾›äº† JTAäº‹åŠ¡ APIå’Œ JTSäº‹åŠ¡æœåŠ¡è§„èŒƒã€‚ äº‹åŠ¡æ”¯æŒä¹Ÿå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ï¼Œ ç®¡ç†å¤šä¸ªæ•°æ®åº“æˆ–è€…æ”¯æŒäº‹åŠ¡çš„èµ„æºã€‚ æ¶ˆæ¯æœåŠ¡: ä¼ä¸šå„ä¸ªç³»ç»Ÿã€ ç³»ç»Ÿæ¨¡å—ä¹‹é—´é€šè¿‡æ¶ˆæ¯æœåŠ¡è¿›è¡Œå¹¶æ­¥äº¤äº’ï¼Œ JavaEEæä¾›äº† JMS æœåŠ¡ ï¼Œ ç”¨äºç³»ç»Ÿé—´å¯ é  çš„æ¶ˆæ¯äº¤äº’ ã€‚ æ•°æ®åº“æŒä¹…å±‚: JavaEEå…ˆæœ‰ EJBè§„èŒƒï¼Œ åæ¥åˆæå‡ºäº†æ›´æœ‰å®é™…æ“ä½œæ€§çš„ JPAï¼Œ è¿™äº›éƒ½ æ˜¯ä¼ä¸šè®¿ é—®æ•°æ®åº“å¸¸ç”¨çš„æ–¹æ³• ã€‚ Container: æä¾›äº† WebContainerï¼Œ ç”¨äºå®ç° Servietï¼Œä»¥åŠ EJB Containerï¼Œå®ç° EJB, Containerç”¨äºç®¡ç†è¿™äº›ç»„ä»¶ï¼Œå¹¶æä¾›ç»„ä»¶éœ€è¦çš„æœåŠ¡ï¼Œ æ¯”å¦‚ JTSã€ JMSç­‰ã€‚ å…¶ä»–æŠ€æœ¯è¿˜åŒ…æ‹¬å¦‚ä¸‹æ‰€è¿° çš„å†…å®¹: JWS: è¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿäº¤äº’çš„ä¸€ç§æ–¹å¼ï¼Œ æ˜¯ Javaå®ç°çš„ä¸€ç§ WebServiceã€‚ JAX-RS: Java EE 6 å¼•å…¥çš„æ–°æŠ€æœ¯ï¼Œé€šè¿‡ é˜» ST è¿›è¡Œäº¤äº’ ã€‚ JNDI: æŸ¥æ‰¾æœåŠ¡å’Œå¯¹è±¡çš„æ¥å£ï¼Œå¦‚æŸ¥æ‰¾ä¸€ä¸ªé…ç½®å¥½çš„æ•°æ®æºã€‚ JAXP/JAXB: XMLæµè¡Œçš„æ—¶å€™ï¼Œè§£æå’Œç»‘å®šJavaBeançš„XMLå·¥å…·ã€‚ JAX-RPC:åˆ†å¸ƒå¼ç³»ç»Ÿäº¤äº’çš„ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ RPC æ–¹å¼è°ƒç”¨ ã€‚ JACC: å®‰å…¨è®¤è¯ã€‚ Java EE Application Server:æä¾›äº†ä¸Šè¿°æ‰€æœ‰æœåŠ¡çš„ Web æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ Tomcatã€ Resinï¼Œ åªèƒ½ç®—æ˜¯ Java EE Web æœåŠ¡å™¨ï¼Œå¼€æºçš„ JBossã€å•†ä¸šçš„ weblogic ç­‰ç§°ä¸ºåº”ç”¨æœ åŠ¡å™¨ã€‚ Java EE çš„ç¼ºç‚¹ è¿‡äºå¤æ‚: JavaEEé’ˆå¯¹çš„æ˜¯å¤æ‚çš„åˆ†å¸ƒå¼ä¼ä¸šåº”ç”¨ï¼Œç„¶è€Œç°å®æƒ…å†µæ˜¯å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ¯”è¾ƒç®€å•ï¼Œå¤æ‚çš„æ¶æ„å¸¦æ¥äº†å¤æ‚çš„å¼€å‘æ–¹å¼å’Œéƒ¨ç½²æ–¹å¼(æ—©æœŸçš„ Java EE æ™®é€šç³»ç»Ÿæ‰“åŒ…éƒ¨ç½²éƒ½éœ€è¦æ•°ååˆ†é’Ÿ) ã€‚ è¿½æ±‚åˆ†å¸ƒå¼:å¤§éƒ¨åˆ†åº”ç”¨å¹¶ééƒ½æ˜¯ Java EE å‡å®šçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåƒ EJBã€ JMSã€ JWS ç­‰æŠ€æœ¯å®ç°é—¨æ§›åˆé«˜åˆå®¹æ˜“å‡ºé”™ã€‚ Spring æ›¾ç»åå¯¹è¿‡è¿™ç§åˆ†å¸ƒå¼æ¶æ„ï¼Œäº•åªæä¾›äº†å®¹ å™¨ç®¡ç†ï¼Œå› æ­¤è·å¾—äº†å·¨å¤§æˆåŠŸã€‚ å¤§å‹åº”ç”¨é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ä¸å¯é¿å…ï¼Œ Spring æä¾›äº†å…¶ ä»–çš„æŠ€æœ¯æ”¯æŒï¼Œæ¯”å¦‚æ”¯æŒé˜» RESTFul æ¶æ„ ã€‚ ä¸èƒ½åŠæ—¶ä¸æµè¡Œå¼€æºæŠ€æœ¯ç»“åˆ :æ¯”å¦‚æ¶ˆæ¯å¤„ç†ï¼Œé™¤äº†æœ‰æ ‡å‡†çš„ JMS æ”¯æŒï¼Œç°åœ¨è¿˜æœ‰æ€§èƒ½æ›´å¥½çš„ RabbitMQ å’Œ Kafkao Java EE å¹¶æ²¡æœ‰ä¸ä¹‹ç›¸åº”çš„æ ‡å‡†ï¼Œåè€Œæ˜¯Springï¼Œå…·æœ‰ç»Ÿä¸€çš„å®ç°æ¶ˆæ¯å¤„ç†æ¨¡å¼ï¼Œæ— è®ºç”¨çš„æ˜¯JMSã€RabbitMQï¼Œè¿˜æ˜¯æ€§èƒ½æ›´å¥½çš„ Kafkaï¼Œéƒ½èƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚ Java EE åº”ç”¨æœåŠ¡å™¨é€šå¸¸ç”±å•†ä¸šå…¬å¸æä¾›ï¼Œä»·æ ¼ä¸è²ï¼Œå°‘æœ‰å…¬å¸é‡‡ç”¨ã€‚ç®¡ç†åº”ç”¨æœåŠ¡å™¨å’Œéƒ¨ç½²åº”ç”¨å¯¹åˆå­¦è€…å’Œè‡ªå­¦è€…æœ‰ä¸€å®šé—¨æ§› ã€‚ SpringSpring æ˜¯ä¸ºäº†è§£å†³åº”ç”¨å¤æ‚æ€§è€Œäº§ç”Ÿçš„æ¡†æ¶ Spring åªæä¾›äº†ä¸¤ç§æœºåˆ¶ï¼Œæ§åˆ¶åè½¬(IoC)å’Œé¢å‘åˆ‡é¢(AOP)ï¼Œæ¥æä¾›ä»»æ„çš„æœåŠ¡å’Œå¢å¼º Bean çš„ä»»æ„ç‰¹æ€§ï¼Œä½¿å¾— Spring æœ¬èº«å®¹æ˜“æŒæ¡ï¼Œåˆå¯ä»¥é€šè¿‡ Bean ç®¡ç†æ¥æ— é™æ‰©å±•åŠŸèƒ½ ã€‚ SpringloCå®¹å™¨å’ŒAOPloC Core Container: Spring Container è´Ÿè´£ç®¡ç†ä½ çš„ä»»æ„å¯¹è±¡ï¼Œå¹¶ç»“åˆä½ å¯¹å¯¹è±¡çš„æè¿°è¿›è¡Œåˆå§‹åŒ–å’ŒåŠ å¼ºã€‚ æ¯”å¦‚ï¼Œå¯¹äº ä¸€ä¸ªç”¨æ³¨è§£@Controller å£°æ˜çš„å¯¹è±¡ï¼Œ Spring ä¼šè®¤ä¸ºè¿™ä¸ªå¯¹è±¡æ˜¯ä¸ª Web Controllerï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡é‡Œçš„æ–¹æ³•æœ‰@RequestMappingæ³¨è§£ï¼Œåˆ™ä¼šå°†å®¢æˆ·ç«¯å‘èµ·çš„ HTTP è¯·æ±‚è½¬åŒ–æˆ Javaæ–¹æ³•è°ƒç”¨ ã€‚ å¦‚å¸¸è§çš„@Service æ³¨è§£å¯¹è±¡ï¼Œé€šå¸¸ç”¨æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ ï¼Œ Spring Containerå¾€å¾€ä¼šå¢å¼ºè¿™ç±»å¯¹è±¡çš„äº‹åŠ¡æ§åˆ¶èƒ½åŠ› ã€‚ å®¹å™¨ç®¡ç†è¿˜å¯ä»¥ ä¸ºè¢«ç®¡ç†çš„Bean æä¾›å…¶ä»–è¢«ç®¡ç†å’Œè¢«å¢å¼ºçš„Bean. AOP: é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼æˆ–è€…è¿è¡Œæ—¶åˆ»å¯¹ç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°æ·»åŠ åŠŸèƒ½ã€‚ AOP åˆ†ç¦»äº† ä¼ä¸šåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ å’Œ ç³»ç»Ÿçº§æœåŠ¡ï¼Œæ¯”å¦‚äº‹åŠ¡æœåŠ¡ï¼Œè¿˜æœ‰åº”ç”¨ç³»ç»Ÿçš„å®¡è®¡ã€å®‰å…¨è®¿é—®ç­‰ä»£ç ã€‚ Spring çš„ç¼ºç‚¹ ä½¿ç”¨é—¨æ§›å‡é«˜ï¼Œè¦å…¥é—¨Springéœ€è¦è¾ƒé•¿æ—¶é—´ã€‚ å¯¹è¿‡æ—¶æŠ€æœ¯å…¼å®¹ï¼Œå¯¼è‡´ä½¿ç”¨å¤æ‚åº¦å‡é«˜ã€‚ XML é…ç½®å·²ç»ä¸æ˜¯æµè¡Œçš„ç³»ç»Ÿé…ç½®æ–¹å¼ã€‚ é›†æˆç¬¬ä¸‰æ–¹å·¥å…·æ—¶å€™ï¼Œç¨‹åºå‘˜è¿˜è¦è€ƒè™‘å·¥å…·ä¹‹é—´çš„å…¼å®¹æ€§ã€‚ ç³»ç»Ÿå¯åŠ¨æ…¢ï¼Œä¸å…·å¤‡çƒ­éƒ¨ç½²åŠŸèƒ½ï¼Œå®Œå…¨ä¾èµ–è™šæ‹Ÿæœºæˆ–è€… Web æœåŠ¡å™¨çš„çƒ­éƒ¨ç½²ã€‚ Spring BootSpring Boot ç®¡ç† Springå®¹å™¨ã€ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œå¹¶æä¾›å¾ˆå¤šé»˜è®¤ç³»ç»Ÿçº§çš„æœåŠ¡ã€‚ Spring Bootæä¾›çš„å¸¸ç”¨ Starter: åç§° ä½œç”¨ spring-boot-starter-web Webå¼€å‘æ”¯æŒï¼Œ é»˜è®¤ä½¿ç”¨ Tomcat8 spring-boot-starter-aop AOPå¼€å‘æ”¯æŒï¼Œä½¿ç”¨ AspectJ spring-boot-starter-jdbc Spring JDBC spring-boot-starter-data-jpa JPA æ–¹å¼è®¿é—®æ•°æ®åº“ï¼Œä½¿ç”¨Hibernate ä½œä¸ºJPAå®ç° spring-boot-starter-data-elasticsearch é›†æˆElasticsearch, é»˜è®¤è®¿é—® localhost:9200 spring-boot-starter-data-redis é›†æˆRedis, ä½¿ç”¨JRedisï¼Œé»˜è®¤è¿æ¥ localhost:6379 spring-boot-starter-cache ç¼“å­˜ï¼Œæ”¯æŒå¤šç§ç¼“å­˜æ–¹å¼ ï¼Œå¦‚æœ¬åœ°çš„ã€Redisã€Ehcache ç­‰ spring-boot-devtools åº”ç”¨ç¨‹åºå¿«é€Ÿé‡å¯çš„å·¥å…· ï¼Œæå‡å¼€å‘ä½“éªŒ spring-boot-starter-data-mongodb é›†æˆMongodb,é»˜è®¤è®¿é—® mongodb://localhos/test spring-boot-starter-data-neo4j é›†æˆneo4j,é»˜è®¤è®¿é—® localhos:7474 spring-boot-starter-data-gemfire é›†æˆåˆ†å¸ƒå¼ç¼“å­˜ spring-boot-starter-data-solr åŸºäº Apache lucene çš„æœç´¢å¹³å° ï¼Œé»˜è®¤è®¿é—® http://localhost:8983/solr spring-boot-starter-data-cassandra é›†æˆ Cassandraï¼Œé»˜è®¤è®¿é—® localhost:7474 spring-boot-staæ­¤er-data-ldap é›†æˆ ldap spring-boot-starter-activemq æ¶ˆæ¯é›†æˆ ActiveMQ æ”¯æŒ spring-boot-starter-amqp æ¶ˆæ¯é›†æˆAMQPåè®®æ”¯æŒï¼Œå¦‚æ”¯æŒ RabbitMQ spring-boot-starter-jta-atomikos åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒï¼Œä½¿ç”¨atomikos spring-boot-starter-jta-bitronix ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ spring-boot-starter-test åŒ…å« JUnitã€ SpringTestã€ Hamcrestã€ Mockito ç­‰æµ‹è¯•å·¥å…· spring-boot-starter-webservices webservice æ”¯æŒ spring-boot-starter-websocket websocketæ”¯æŒ spring-boot-starter-jersey REST åº”ç”¨å’Œ Jersey æ”¯æŒ spring-boot-starter-freemarker Freemakeræ”¯æŒ ä¼˜ç‚¹ : å®ç°çº¦å®šå¤§äºé…ç½®ï¼Œæ˜¯ä¸€ä¸ªä½é…ç½®çš„åº”ç”¨ç³»ç»Ÿæ¡†æ¶ã€‚ä¸åƒ Springé‚£æ ·åœ°ç‹±èˆ¬çš„é…ç½®ä½“éªŒï¼ŒSpring Boot ä¸éœ€è¦é…ç½®æˆ–è€…æå°‘é…ç½®ï¼Œå°±èƒ½ä½¿ç”¨ Spring å¤§é‡çš„åŠŸèƒ½ã€‚ æä¾›äº†å†…ç½®çš„ Tomcat æˆ–è€… Jetty å®¹å™¨ã€‚ é€šè¿‡ä¾èµ–çš„ jaråŒ…ç®¡ç†ã€è‡ªåŠ¨è£…é…æŠ€æœ¯ï¼Œå®¹æ˜“æ”¯æŒä¸å…¶ä»–æŠ€æœ¯ä½“ç³»ã€å·¥å…·é›†æˆã€‚ æ”¯æŒçƒ­åŠ è½½ï¼Œå¼€å‘ä½“éªŒå¥½ã€‚ä¹Ÿæ”¯æŒ Spring Boot ç³»ç»Ÿç›‘æ§ï¼Œæ–¹ä¾¿äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶å†µã€‚ Hello, Spring Bootåˆ›å»ºMavenå·¥ç¨‹ â€”â€” pom.xmlæ–‡ä»¶Webæ”¯æŒ â€”â€” spring-boot-starter-web spring-boot-dependencies é»˜è®¤ä¼šä½¿ç”¨å†…ç½®çš„ Tomcatï¼Œäº•æ”¯æŒ Spring MVCã€ RESSTFul æœåŠ¡ã€‚ pom.xml: 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.bee.sample&lt;/groupId&gt; &lt;artifactId&gt;ch1.helloworld&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;!-- ä¸ºwebåº”ç”¨ç¨‹åºæ·»åŠ å…¸å‹çš„ä¾èµ–é¡¹ --&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- ä½œä¸ºå¯æ‰§è¡ŒjaråŒ… --&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ç¤ºä¾‹ä»£ç Ch1Application.java 12345678910111213package com.bee.sample.ch1;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class Ch1Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Ch1Application.class, args); &#125;&#125; HelloworldController.java 1234567891011121314151617package com.bee.sample.ch1.controller;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import com.bee.sample.ch1.annotation.Function;@Controllerpublic class HelloworldController &#123; @RequestMapping(\"/sayhello.html\") @Function() public @ResponseBody String say(String name)&#123; return \"hello \"+name; &#125;&#125; å¯åŠ¨ ChlApplication ç¨‹åº, æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®åœ°å€ http://127.0.0.1:8080/say.htmlï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºäº†â€œ Hello Spring Bootâ€ã€‚ ä½¿ç”¨çƒ­éƒ¨ç½²spring-boot-devtoolsï¼Œ å®ƒèƒ½åœ¨ä¿®æ”¹ç±»æˆ–è€…é…ç½®æ–‡ä»¶çš„æ—¶å€™è‡ªåŠ¨é‡æ–°åŠ è½½ Spring Boot åº”ç”¨ æ”¯æŒRESTUserReditRestController.java 12345678910111213141516171819202122package com.bee.sample.ch1.rest;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.bind.annotation.RestController;/** * æ³¨è§£RestControllerç›¸å½“äºæ³¨è§£Controllerå’ŒResponseBodyçš„åˆä½“ã€‚ * è¯•è¯•è¯¡å¼‚åˆ¶é€ å¦‚ä¸‹é—®é¢˜: * 1 æ›´æ”¹getCreditLevelåå­—ä¸ºgetCreditLevelTest * 2 /usercredit/&#123;id&#125; æ›´æ”¹ä¸º /usercredit/&#123;id1&#125; * */@RestControllerpublic class UserReditRestController &#123; @RequestMapping(value=\"/usercredit/&#123;id&#125;\") public Integer getCreditLevel(@PathVariable String id) &#123; return Integer.parseInt(id); &#125;&#125;","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"}]},{"title":"httpie","slug":"httpie","date":"2018-12-21T08:38:35.000Z","updated":"2020-07-25T02:57:18.207Z","comments":true,"path":"2018/12/21/httpie/","link":"","permalink":"https://jigangduan.github.io/2018/12/21/httpie/","excerpt":"","text":"HTTPieâ€”aitch-tee-tee-pieâ€”æ˜¯ä¸€ä¸ªå‘½ä»¤è¡ŒHTTPå®¢æˆ·ç«¯ï¼Œå…·æœ‰ç›´è§‚çš„UIã€JSONæ”¯æŒã€è¯­æ³•é«˜äº®æ˜¾ç¤ºã€ç±»ä¼¼wgetçš„ä¸‹è½½ã€æ’ä»¶ç­‰ã€‚ HTTPieç”±ä¸€ä¸ªå•ç‹¬çš„httpå‘½ä»¤ç»„æˆï¼Œè¯¥å‘½ä»¤è¢«è®¾è®¡ç”¨äºä¸httpæœåŠ¡å™¨ã€RESTful apiå’ŒwebæœåŠ¡è¿›è¡Œæ— ç—›è°ƒè¯•å’Œäº¤äº’: åˆç†çš„é»˜è®¤å€¼ è¡¨è¾¾å’Œç›´è§‚çš„å‘½ä»¤è¯­æ³• å½©è‰²å’Œæ ¼å¼åŒ–çš„ç»ˆç«¯è¾“å‡º å†…ç½®çš„JSONæ”¯æŒ æŒä¹…ä¼šè¯ è¡¨å•å’Œæ–‡ä»¶ä¸Šä¼  HTTPSã€ä»£ç†å’Œèº«ä»½éªŒè¯æ”¯æŒ æ”¯æŒä»»æ„è¯·æ±‚æ•°æ®å’Œæ ‡é¢˜ Wget-likeä¸‹è½½ æ‰©å±• æ”¯æŒLinuxã€macOSå’ŒWindows å’Œæ›´å¤šâ€¦ å®‰è£… Mac: 1brew install httpie","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/categories/å·¥å…·/"}],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/tags/å·¥å…·/"},{"name":"httpie","slug":"httpie","permalink":"https://jigangduan.github.io/tags/httpie/"}]},{"title":"ORYç¼–è¾‘å™¨","slug":"ory-editor-readme","date":"2018-12-14T23:48:17.000Z","updated":"2020-07-25T02:57:18.224Z","comments":true,"path":"2018/12/15/ory-editor-readme/","link":"","permalink":"https://jigangduan.github.io/2018/12/15/ory-editor-readme/","excerpt":"","text":"ä¸‹ä¸€ä»£ï¼Œé«˜åº¦å®šåˆ¶çš„å†…å®¹ç¼–è¾‘å™¨ä¸ºæµè§ˆå™¨-Reactå’ŒReduxã€‚æ‰€è§å³æ‰€å¾—ã€‚https://ory-editor.aeneas.io ORYç¼–è¾‘å™¨æ˜¯ä¸€ä¸ªæ™ºèƒ½ã€å¯æ‰©å±•å’Œç°ä»£çš„ç¼–è¾‘å™¨(â€œæ‰€è§å³æ‰€å¾—â€)ï¼Œç”¨äºç”¨Reactç¼–å†™çš„webã€‚å¦‚æœæ‚¨å—å¤Ÿäº†contenteditableçš„é™åˆ¶ï¼Œé‚£ä¹ˆæ‚¨æ˜¯æ­£ç¡®çš„ã€‚ ORYç¼–è¾‘å™¨ç”¨äºå¾·å›½æœ€å¤§çš„ç”µå­å­¦ä¹ ç½‘ç«™www.serlo.org(æ¯æœˆçº¦800k uniques)ï¼Œä»¥æ”¹å–„wikiçš„ä½“éªŒã€‚ æŸ¥çœ‹æ¼”ç¤ºåœ¨ory-editor.aeneas.io! é‡è¦çš„: æ­¤ç¼–è¾‘å™¨æ˜¯é¢„å‘å¸ƒçš„ï¼Œä¸èƒ½ä¿è¯å‘åå…¼å®¹ã€‚å®ƒæ˜¯ç”±å®ƒçš„ä½œè€…å’Œæ ¸å¿ƒç»´æŠ¤è€…Aeneas Rekkasä½œä¸ºä¸€ä¸ªä¸ªäººé¡¹ç›®è¿›è¡Œç»´æŠ¤çš„ ä»‹ç»æˆ‘å·²ç»åœ¨ç»´åŸºç™¾ç§‘å­¦ä¹ äº†å°†è¿‘åå¹´ã€‚è¿™æ®µç»å†å’Œå­¦åˆ°çš„æ•™è®­è®©æˆ‘è¸ä¸Šäº†æ„å»ºORYç¼–è¾‘å™¨çš„å¾ç¨‹ã€‚æˆ‘æƒ³è®©webä¸Šçš„å†…å®¹ç¼–è¾‘å˜å¾—ç®€å•ï¼Œå¹¶é€šè¿‡æŠ€æœ¯ä¸°å¯Œå¼€æ”¾æºç ç¤¾åŒºï¼Œä»è€Œæ˜¾è‘—åœ°æ”¹å˜webä¸Šçš„å†…å®¹åˆ›å»ºå’Œç¼–è¾‘æ–¹å¼ã€‚ æœ‰ä»€ä¹ˆé—®é¢˜?æˆ‘å¿…é¡»æ„è¯†åˆ°ï¼Œç°æœ‰çš„å¼€æºå†…å®¹ç¼–è¾‘è§£å†³æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªç¼ºé™·ä¹‹ä¸€: åˆ¶ä½œçš„æ ‡è®°éå¸¸å¯æ€•ï¼Œå¿…é¡»è¿›è¡Œè®¸å¤šå®‰å…¨å·¥ä½œï¼ŒXSSæ€»æ˜¯ä¸€ä¸ªå¨èƒ. ä½œè€…å¿…é¡»å­¦ä¹ ç‰¹æ®Šçš„ä¸Šå±‚æ ‡ç­¾ï¼Œå¦‚markdownï¼Œæ‰èƒ½äº§ç”Ÿå†…å®¹ã€‚è¿™äº›åŸºäºæ–‡æœ¬çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ— æ³•æŒ‡å®šå¸ƒå±€ï¼Œè€Œä¸”åƒè¡¨è¿™æ ·çš„å¤æ‚æ•°æ®ç»“æ„å¾ˆéš¾ç¼–è¾‘. åŸºäºcontenteditableçš„ç¼–è¾‘å™¨æ— æ³•ä½¿ç”¨å¸ƒå±€ (e.g. flexbox æˆ– æµ®åŠ¨ç½‘æ ¼). æ‰€ä»¥æœ‰ä»€ä¹ˆä¸åŒ?æˆ‘ä»¬çš„ç»“è®ºæ˜¯ï¼Œè§£å†³åŠæ³•å¿…é¡»ç¬¦åˆä¸‹åˆ—åŸåˆ™: è¯¥çŠ¶æ€æ˜¯ä¸€ä¸ªè§„èŒƒåŒ–JSONå¯¹è±¡ï¼Œä¸æ¶‰åŠHTMLã€‚ å®ƒæ˜¯ä¸€ä¸ªä¸éœ€è¦ç¼–ç¨‹ç»éªŒæˆ–ç‰¹æ®ŠåŸ¹è®­çš„å¯è§†åŒ–ç¼–è¾‘å™¨ã€‚ å®ƒæ˜¯ç”±ä¸€å®¶å…¬å¸å»ºé€ çš„ï¼Œå‡å°‘äº†è¢«é—å¼ƒçš„å¯èƒ½æ€§ã€‚ åŸºäºå¯é‡ç”¨çš„Reactç»„ä»¶ï¼Œå®ƒä¸ºå¼€å‘äººå‘˜ã€ä½œè€…å’Œè®¾è®¡äººå‘˜æä¾›äº†æ–°çš„åˆä½œæ–¹å¼ï¼Œä»è€Œæ›´å®¹æ˜“åœ°åˆ›å»ºæ›´å¥½æ›´ä¸°å¯Œçš„ä½“éªŒã€‚ å®ƒé€‚ç”¨äºç§»åŠ¨å’Œè§¦æ§è®¾å¤‡ã€‚ å¸¦ç€è¿™äº›åŸåˆ™ï¼Œæˆ‘ä»¬å‡ºå»å®ç°äº†ORYç¼–è¾‘å™¨ï¼Œä¹Ÿå°±æ˜¯æ‚¨ç°åœ¨çœ‹åˆ°çš„ç¼–è¾‘å™¨ã€‚ å¿«é€Ÿå…¥é—¨ç›®å‰çš„é‡ç‚¹æ˜¯ä¼˜åŒ–ä½¿ç”¨Reactçš„ORYç¼–è¾‘å™¨ã€‚å°†æ¥ä¸éœ€è¦Reactçš„ç‰ˆæœ¬å¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶å€™å‘å¸ƒ. è¯·æ£€æŸ¥ ReactJS æ•™ç¨‹! 1$ npm install --save ory-editor è¯·æ³¨æ„: ory-editoråŒ…æ˜¯ä¸€ç§å…ƒåŒ…ã€‚å®ƒåŒ…æ‹¬æ ¸å¿ƒã€é»˜è®¤uiå’Œä¸€äº›å®˜æ–¹æ”¯æŒçš„æ’ä»¶ã€‚ä½¿ç”¨è¿™ä¸ªåŒ…ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿. æ–‡æ¡£æŸ¥çœ‹gitbookçš„ç”¨æˆ·æŒ‡å—. å¦‚ä½•è¿è¡Œã€å¼€å‘å’Œè´¡çŒ®æ‚¨å¸Œæœ›è¿è¡Œã€å¼€å‘æˆ–å‘ORYç¼–è¾‘å™¨æä¾›å†…å®¹å—?ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨ç³»ç»Ÿä¸Šå®‰è£…Nodeã€‚æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ä½¿ç”¨gitç­¾å‡ºè¿™ä¸ªå­˜å‚¨åº“ 12$ git clone https://github.com/ory/editor.git$ cd editor å®‰è£…ä¾èµ–å…³ç³»ORYç¼–è¾‘å™¨æ˜¯monorepoï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒåˆå§‹åŒ–: 1$ yarn i è¦æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦yarn. è¿è¡Œç¤ºä¾‹å¦‚æœæ‚¨æƒ³ç†Ÿæ‚‰ç¼–è¾‘å™¨ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¾‹å­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ã€‚è¦è¿è¡Œç¤ºä¾‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€ 123$ yarn run build$ cd examples$ yarn run start è¿è¡Œå·¥å…·é“¾å·¥å…·é“¾åŒ…å«æµ‹è¯•ã€eslintå’Œæµç±»å‹ã€‚å¼ºçƒˆå»ºè®®åœ¨å¼€å‘æ—¶è¿è¡Œæ­¤å·¥å…·é“¾. 12345678# run the tests in watch mode$ yarn run test:watch# run eslint in watch mode$ yarn run lint:watch# run flowtype in watch mode$ yarn run flow:watch è¿è¡Œè¯¥æ–‡æ¡£è¦åœ¨watchæ¨¡å¼ä¸‹è¿è¡ŒæŒ‡å—ï¼Œè¯·æ‰§è¡Œ: 1$ yarn run docs:guide To generate API docs, run: 1$ yarn run docs:api","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"GitHubç²¾é€‰","slug":"å‰ç«¯/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/GitHubç²¾é€‰/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"editor","slug":"editor","permalink":"https://jigangduan.github.io/tags/editor/"},{"name":"github","slug":"github","permalink":"https://jigangduan.github.io/tags/github/"},{"name":"sites","slug":"sites","permalink":"https://jigangduan.github.io/tags/sites/"}]},{"title":"ORYç¼–è¾‘å™¨ (4)æ•™ç¨‹","slug":"ory-editor-tutorials","date":"2018-12-14T14:15:14.000Z","updated":"2020-07-25T02:57:18.225Z","comments":true,"path":"2018/12/14/ory-editor-tutorials/","link":"","permalink":"https://jigangduan.github.io/2018/12/14/ory-editor-tutorials/","excerpt":"","text":"ReactJSä¾‹å­åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä½¿ç”¨ORYç¼–è¾‘å™¨çš„æœ€å°åŒ–reactåº”ç”¨ç¨‹åºã€‚åœ¨æˆ‘ä»¬è·³è¿‡ä¹‹å‰ï¼Œè¯·ç¡®ä¿node.jså·²å®‰è£…åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šã€‚ ç›®å‰ï¼ŒORYç¼–è¾‘å™¨åªèƒ½é€šè¿‡npmè·å¾—ï¼Œå¹¶ä¸”åœ¨ReactJSç¯å¢ƒä¸­å·¥ä½œå¾—æœ€å¥½ã€‚ ReactJSæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªä½¿ç”¨ç¼–è¾‘å™¨çš„ReactJSåº”ç”¨ç¨‹åºã€‚ä¸ºäº†åœ¨æœ¬æ•™ç¨‹ä¸­æ­å»ºreactåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ä½¿ç”¨create-react-app 12$ npm i -g create-react-app$ create-react-app . ä½¿ç”¨npmå®‰è£…ç¼–è¾‘å™¨: 1$ npm i --save ory-editor æ¥ä¸‹æ¥ï¼Œæ‰“å¼€æ–‡ä»¶src/components/App.jsï¼ŒåŒ…æ‹¬ORYç¼–è¾‘å™¨: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import React, &#123;Component&#125; from 'react'// The editor coreimport Editor, &#123; Editable, createEmptyState &#125; from 'ory-editor-core'import 'ory-editor-core/lib/index.css' // æˆ‘ä»¬è¿˜å¸Œæœ›åŠ è½½æ ·å¼è¡¨// éœ€è¦æˆ‘ä»¬çš„uiç»„ä»¶(å¯é€‰)ã€‚æ‚¨ä¹Ÿå¯ä»¥å®ç°å’Œä½¿ç”¨è‡ªå·±çš„ui !import &#123; Trash, DisplayModeToggle, Toolbar &#125; from 'ory-editor-ui'import 'ory-editor-ui/lib/index.css'// åŠ è½½ä¸€äº›ç¤ºä¾‹æ’ä»¶:import slate from 'ory-editor-plugins-slate' // Tå¯Œæ–‡æœ¬åŒºæ’ä»¶import 'ory-editor-plugins-slate/lib/index.css' // ä¸°å¯Œæ–‡æœ¬åŒºåŸŸæ’ä»¶çš„æ ·å¼è¡¨import parallax from 'ory-editor-plugins-parallax-background' // è§†å·®èƒŒæ™¯å›¾åƒæ’ä»¶import 'ory-editor-plugins-parallax-background/lib/index.css' // è§†å·®èƒŒæ™¯å›¾åƒçš„æ ·å¼è¡¨require('react-tap-event-plugin')() // react-tap-event-plugin is required by material-ui which is used by ory-editor-ui so we need to call it here// å®šä¹‰æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ’ä»¶ã€‚æˆ‘ä»¬åªæœ‰æ¿å²©å’Œè§†å·®å¯ç”¨ï¼Œæ‰€ä»¥åŠ è½½å®ƒä»¬.const plugins = &#123; content: [slate()], // ä¸ºå†…å®¹å•å…ƒæ ¼å®šä¹‰æ’ä»¶ã€‚è¦å¯¼å…¥å¤šä¸ªæ’ä»¶ï¼Œè¯·ä½¿ç”¨[slate()ï¼Œimage, spacer, divider] layout: [parallax(&#123; defaultPlugin: slate() &#125;)] // å®šä¹‰å¸ƒå±€å•å…ƒæ ¼çš„æ’ä»¶&#125;// Creates an empty editableconst content = createEmptyState()// Instantiate the editorconst editor = new Editor(&#123; plugins, // pass the content state - you can add multiple editables here editables: [content],&#125;)class App extends Component &#123; render() &#123; return ( &lt;div&gt; &lt;div className=\"App-header\"&gt; &lt;img src=&#123;logo&#125; className=\"App-logo\" alt=\"logo\"/&gt; &lt;h2&gt;Welcome to React&lt;/h2&gt; &lt;/div&gt; &#123;/* Content area */&#125; &lt;Editable editor=&#123;editor&#125; id=&#123;content.id&#125;/&gt; &#123;/* Default user interface */&#125; &lt;Trash editor=&#123;editor&#125;/&gt; &lt;DisplayModeToggle editor=&#123;editor&#125;/&gt; &lt;Toolbar editor=&#123;editor&#125;/&gt; &lt;/div&gt; ); &#125;&#125;export default App; å°±æ˜¯è¿™æ ·,æ­å–œä½ !ä½ ç°åœ¨åº”è¯¥çœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿: ç¼–å†™æ’ä»¶ç¼–å†™ä¸€ä¸ªå†…å®¹æ’ä»¶å½“ç„¶ï¼Œæ‚¨å¹¶ä¸å±€é™äºæ­¤åŠŸèƒ½ï¼Œè€Œä¸”å¯ä»¥è½»æ¾ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚æ’ä»¶æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ’ä»¶å®šä¹‰å’Œä¸€ä¸ªReactJSç»„ä»¶ã€‚ä¸€ä¸ªæœ€å°çš„æ’ä»¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤º 123456789101112131415import React, &#123;Component&#125; from 'react'// æ˜¾ç„¶ï¼Œæ‚¨å¹¶ä¸å±€é™äºmaterial-uiï¼Œä½†æ˜¯æˆ‘ä»¬éå¸¸å–œæ¬¢material-ui svgå›¾æ ‡import StarIcon from 'material-ui/svg-icons/toggle/star'// This is the ReactJS component which you can find below this snippetimport InputTextField from './Component'export default &#123; Component: InputTextField, IconComponent: &lt;StarIcon /&gt;, name: 'example/content/input-text-field', version: '0.0.1', text: 'Input Text Field'&#125; ä¸€ä¸ªæç®€æ’ä»¶çš„ä¾‹å­å¯èƒ½æ˜¯è¿™æ ·çš„: 123456789101112131415161718192021222324252627282930313233343536373839import React from 'react'// A callback function for the input fieldconst onInput = (onChange) =&gt; &#123; return (e) =&gt; &#123; // Dispatch the onChange action with the new value onChange(&#123; value: e.target.value &#125;) &#125;&#125;const InputTextField = (props) =&gt; &#123; const &#123; state: &#123; value &#125;, readOnly, onChange &#125; = props // If readOnly is false, it means that we are in edit mode! if (!readOnly) &#123; return ( &lt;div className=\"my-plugin\"&gt; &lt;input type=\"text\" onChange=&#123;onInput(onChange)&#125; value=&#123;value&#125; /&gt; &lt;/div&gt; ) &#125; // If we are not in edit mode, remove the input field return ( &lt;div className=\"my-plugin\"&gt; &#123;value&#125; &lt;/div&gt; )&#125;export default InputTextField å½“ç„¶ï¼Œè¿˜æœ‰æ›´å¤šçš„è®¾ç½®å’Œå›è°ƒå¯ç”¨ã€‚æˆ‘ä»¬é¼“åŠ±æ‚¨æŸ¥çœ‹å…³äºè¿™ä¸ªä¸»é¢˜çš„APIæ–‡æ¡£! ç¡®ä¿onChange propä¸ä¼šä¼ é€’ç»™HTMLå…ƒç´ (ä¾‹å¦‚{...props})ï¼Œå› ä¸ºè¿™ä¼šç”¨è¯¥å…ƒç´ å‘å‡ºçš„ä»»ä½•æ›´æ”¹äº‹ä»¶è¦†ç›–æ’ä»¶çš„çŠ¶æ€ã€‚è¿™é€‚ç”¨äºå†…å®¹å’Œå¸ƒå±€æ’ä»¶ã€‚ ç¼–å†™å¸ƒå±€æ’ä»¶å½“ç„¶ï¼Œæ‚¨å¹¶ä¸å±€é™äºæ­¤åŠŸèƒ½ï¼Œè€Œä¸”å¯ä»¥è½»æ¾ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚æ’ä»¶æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ’ä»¶å®šä¹‰å’Œä¸€ä¸ªReactJSç»„ä»¶ã€‚ä¸€ä¸ªå¸ƒå±€æ’ä»¶å°†éœ€è¦ä¸€ä¸ªåˆå§‹çš„å­å…ƒç´ ï¼Œå¦åˆ™ï¼Œå®ƒå°†è‡ªåŠ¨è¢«é”€æ¯ã€‚ä¸€ä¸ªæœ€å°çš„å¸ƒå±€æ’ä»¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031323334353637import React from 'react'import slate from 'ory-editor-plugins-slate'// You are obviously not limited to material-ui, but we really enjoy// the material-ui svg icons!import CropSquare from 'material-ui/svg-icons/image/crop-square'const BlackBorderPlugin = (&#123; children &#125;) =&gt; ( &lt;div style=&#123;&#123; border: '1px solid black', padding: '16px' &#125;&#125;&gt; &#123;children&#125; &lt;/div&gt;)export default &#123; Component: BlackBorderPlugin, IconComponent: &lt;CropSquare /&gt;, name: 'example/layout/black-border', version: '0.0.1', text: 'Black border', createInitialChildren: () =&gt; (&#123; id: v4(), rows: [ &#123; id: v4(), cells: [ &#123; content: &#123; plugin: slate(), state: slate().createInitialState() &#125;, id: v4() &#125; ] &#125; ] &#125;)&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ€åˆçš„å­å…ƒç´ æ˜¯ä¸€ä¸ªslateæ’ä»¶ã€‚ æ¸²æŸ“HTMLory-editor-rendereråŒ…é™„å¸¦äº†ä¸€ä¸ªè½»é‡çº§HTML rendereræ¨¡å—ã€‚æ‚¨å¯ä»¥å°†å…¶ç”¨äºæœåŠ¡å™¨ç«¯æ¸²æŸ“å’Œå†…å®¹å®¢æˆ·ç«¯æ¸²æŸ“ã€‚ 123456789101112import &#123; HTMLRenderer &#125; from 'ory-editor-renderer'const state = &#123; /* ... */ &#125;const plugins = &#123; layout: [/* ... */], content: [/* ... */]&#125;const element = document.getElementById('editable')ReactDOM.render(( &lt;HTMLRenderer state=&#123;content[0]&#125; plugins=&#123;plugins&#125;/&gt;), element) ä¿å­˜å’Œæ¢å¤ç¼–è¾‘å™¨å†…å®¹ä½¿ç”¨onChangeå›è°ƒè·å–ç¼–è¾‘å™¨çŠ¶æ€çš„å‰¯æœ¬ï¼Œä»¥ä¾¿ä¿å­˜åˆ°æŒä¹…å­˜å‚¨ã€‚ç„¶åå¯ä»¥å°†çŠ¶æ€åŠ è½½åˆ°ç¼–è¾‘å™¨ä¸­ï¼Œæˆ–è€…ç”±ory-editor-rendereråŒ…ç”¨äºå°†å…¶æ¸²æŸ“ä¸ºHTMLã€‚ 1234567891011121314151617181920212223242526272829303132import React, &#123;Component&#125; from 'react'import Editor, &#123; Editable, createEmptyState &#125; from 'ory-editor-core'import slate from 'ory-editor-plugins-slate' // The rich text area pluginimport &#123; Trash, DisplayModeToggle, Toolbar &#125; from 'ory-editor-ui'const EditorPlugins = &#123; content: [slate()], layout: [/* ... */],&#125;;function saveToDatabase(state) &#123; return fetch('/my/save/url', &#123; method: 'POST', body: state &#125;);&#125;class MyEditor extends Component &#123; componentWillMount() &#123; this.editorState = this.props.content || createEmptyState(); this.editor = new Editor(&#123; EditorPlugins, editables: [content] &#125;); &#125; render() &#123; return ( &lt;div className=\"my-editor\"&gt; &lt;toolbar&gt; &lt;button onClick=&#123;() =&gt; saveToDatabase(this.editorState)&#125;&gt;Save&lt;/button&gt; &lt;/toolbar&gt; &lt;Editable editor=&#123;editor&#125; id=&#123;content.id&#125; onChange=&#123;state =&gt; (this.editorState = state)&#125; /&gt; &lt;Trash editor=&#123;editor&#125;/&gt; &lt;DisplayModeToggle editor=&#123;editor&#125;/&gt; &lt;Toolbar editor=&#123;editor&#125;/&gt; &lt;/div&gt; ) &#125;&#125; ç„¶åå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œè·å–å’Œå‘ˆç°çŠ¶æ€: 12345678910111213141516171819202122232425262728import React, &#123;Component&#125; from 'react'import &#123; HTMLRenderer &#125; from 'ory-editor-renderer'import &#123; createEmptyState &#125; from 'ory-editor-core'class MyEditorRenderer extends Component &#123; componentWillMount() &#123; this.plugins = &#123; this.setState(&#123; contents: createEmptyState() &#125;); fetch('/my/save/url').then((savedState) =&gt; &#123; this.setState(&#123; contents: savedState &#125;); &#125;) &#125; render() &#123; return ( &lt;div className=\"my-editor\"&gt; &lt;HTMLRenderer state=&#123;this.state.contents&#125; plugins=&#123;EditorPlugins&#125; /&gt; &lt;/div&gt; ) &#125;&#125;const element = document.getElementById('editable')ReactDOM.render(( &lt;MyEditorRenderer /&gt;), element) å¤„ç†æœ¬åœ°æ‹–åŠ¨äº‹ä»¶ORYç¼–è¾‘å™¨èƒ½å¤Ÿå¤„ç†åŸç”Ÿæ‹–æ”¾äº‹ä»¶ã€‚åŸç”Ÿäº‹ä»¶åŒ…æ‹¬é“¾æ¥ã€æ–‡æœ¬å’Œå›¾åƒçš„æ‹–åŠ¨ã€‚å¯ä»¥é€šè¿‡ç¼–å†™NativePluginå¹¶åœ¨å®ä¾‹åŒ–æœŸé—´ä¼ é€’å®ƒæ¥å¯ç”¨æœ¬æœºæ‹–åŠ¨æ”¯æŒã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é»˜è®¤æ’ä»¶ï¼Œå¹¶åœ¨ç¨åä»‹ç»å¦‚ä½•åˆ›å»ºè‡ªå·±çš„æ’ä»¶ã€‚ 123456789import native from 'ory-editor-plugins-default-native'const editor = new Editor(&#123; plugins: &#123; layout: [], content: [], native &#125;&#125;) å¦‚æœåŸç”Ÿæœªå®šä¹‰æˆ–ä¸ºç©ºï¼Œåˆ™ç¦ç”¨åŸç”Ÿæ‹–åŠ¨ã€‚è¿™æ˜¯é»˜è®¤è®¾ç½®ã€‚ ç¼–å†™æœ¬åœ°æ’ä»¶å°±åƒç¼–å†™å†…å®¹æˆ–å¸ƒå±€æ’ä»¶ä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬çš„æœ¬åœ°æ’ä»¶å¿…é¡»å°è£…åœ¨ä¸€ä¸ªæ¥æ”¶ä¸‰ä¸ªå‚æ•°çš„å·¥å‚ä¸­â€”â€”hover, monitor, componentã€‚æ‚¬åœæ˜¯å½“å‰æ­£åœ¨æ‚¬åœçš„å•å…ƒæ ¼æˆ–è¡Œã€‚Monitoræ˜¯æ¥è‡ªreact-dndçš„DropTargetMonitorï¼Œç»„ä»¶æ˜¯å½“å‰æ‚¬åœçš„å•å…ƒæ ¼æˆ–è¡Œçš„å“åº”ç»„ä»¶ã€‚ æ€»ä¹‹ï¼Œä¸€ä¸ªç¤ºä¾‹æ’ä»¶æ˜¯è¿™æ ·çš„: 123456789import React from 'react'const Native = () =&gt; &lt;div&gt;native&lt;/div&gt;export default (hover, monitor, component) =&gt; (&#123; Component: Native, name: 'my-native-plugin', version: '0.0.1'&#125;) å› ä¸ºè¿™ä¸ªæ’ä»¶è¢«å°è£…åœ¨å·¥å‚ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®æ¥æ”¶åˆ°çš„å±æ€§ä¿®æ”¹å®ƒçš„è¡Œä¸ºã€‚å…¶ä¸­ä¸€ä¸ªä¾‹å­æ˜¯å°†é¡¹ç›®çš„æ•°æ®æ·»åŠ åˆ°åˆå§‹çŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åä½¿ç”¨ã€‚ 123456export default (hover, monitor, component) =&gt; (&#123; // ... createInitialState: () =&gt; (&#123; item: monitor.getItem() &#125;)&#125;) åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¾‘å™¨å‡å®šåˆ é™¤æœ¬åœ°å…ƒç´ ä¼šåˆ›å»ºä¸€ä¸ªå†…å®¹å•å…ƒæ ¼ã€‚è¦æ›´æ”¹æ­¤è¡Œä¸ºï¼Œè¯·ä½¿ç”¨é”®type: 1234export default (hover, monitor, component) =&gt; (&#123; // ... type: 'layout'&#125;)","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"ORYç¼–è¾‘å™¨","slug":"React/ORYç¼–è¾‘å™¨","permalink":"https://jigangduan.github.io/categories/React/ORYç¼–è¾‘å™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"editor","slug":"editor","permalink":"https://jigangduan.github.io/tags/editor/"}]},{"title":"ORYç¼–è¾‘å™¨ (3)UIç»„ä»¶","slug":"ory-editor-ui","date":"2018-12-14T13:48:41.000Z","updated":"2020-07-25T02:57:18.225Z","comments":true,"path":"2018/12/14/ory-editor-ui/","link":"","permalink":"https://jigangduan.github.io/2018/12/14/ory-editor-ui/","excerpt":"","text":"åŒ…ç¼–è¾‘å™¨ç”±å¤šä¸ªåŒ…ç»„æˆã€‚ä¸€ä¸ªå…ƒåŒ…åœ¨ory-editorå¯ç”¨ã€‚ ory-editor-coreè¿™ä¸ªåŒ…æ˜¯ORYç¼–è¾‘å™¨çš„æ ¸å¿ƒã€‚å®ƒåŒ…å«åˆ›å»ºå’Œä¿®æ”¹å¸ƒå±€çš„é€»è¾‘ï¼Œå¹¶è´Ÿè´£å¤„ç†æ’ä»¶ã€‚ ory-editor-uiè¿™ä¸ªå­˜å‚¨åº“åŒ…å«åŸºäºcallemall/material-uiçš„ORY Editor UI Reactç»„ä»¶ã€‚è™½ç„¶æ‚¨ä¸éœ€è¦ä½¿ç”¨å®ƒä»¬ï¼Œä½†æ˜¯å®ƒä»¬æä¾›äº†ä¸€ç§å¼€å§‹ä½¿ç”¨ORYç¼–è¾‘å™¨çš„ç®€å•æ–¹æ³•ã€‚ ory-editor-rendererè¿™ä¸ªåŒ…åŒ…å«ORYç¼–è¾‘å™¨çŠ¶æ€çš„æ¸²æŸ“ç»„ä»¶ã€‚ç›®å‰ï¼Œåªæ”¯æŒHTMLæ¸²æŸ“ã€‚HTMLæ¸²æŸ“ç»„ä»¶è´Ÿè´£è¾“å‡ºé™æ€HTMLå¹¶åœ¨ç”¨æˆ·ä»£ç†ç«¯å®‰è£…åŠ¨æ€æ’ä»¶ã€‚ æ’ä»¶ory-editor-plugins-slateæ–‡æœ¬ç¼–è¾‘å…è®¸æ‚¨åˆ›å»ºå’Œä¿®æ”¹å¯Œæ–‡æœ¬ï¼Œå¹¶ä¼˜åŒ–äº†ä¸ORYç¼–è¾‘å™¨ä¸€èµ·ä½¿ç”¨ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨æˆ‘ä»¬çš„æ–‡æœ¬ç¼–è¾‘è§£å†³æ–¹æ¡ˆã€‚ Slate ory-editor-plugins-imageå›¾åƒæ’ä»¶å…è®¸æ‚¨é€šè¿‡è¾“å…¥å›¾åƒçš„URLå‘å†…å®¹æ·»åŠ å›¾åƒã€‚å›¾åƒæ’ä»¶ä¸æ”¯æŒä¸Šä¼ ã€‚ å›¾åƒæ’ä»¶æ˜¯ä¸å¯é…ç½®çš„ ory-editor-plugins-videoè§†é¢‘æ’ä»¶å…è®¸æ‚¨é€šè¿‡è¾“å…¥è§†é¢‘çš„URLå‘å†…å®¹æ·»åŠ è§†é¢‘ã€‚è§†é¢‘æ’ä»¶ä¸æ”¯æŒä¸Šä¼  è§†é¢‘æ’ä»¶æ˜¯ä¸å¯é…ç½®çš„ ory-editor-plugins-spaceré—´éš”æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªç©ºçš„å›ºå®šé«˜åº¦å•å…ƒæ ¼ã€‚ é—´éš”æ’ä»¶æ˜¯ä¸å¯é…ç½®çš„ ory-editor-plugins-parallax-backgroundè§†å·®èƒŒæ™¯æ’ä»¶æ˜¯ä¸€ä¸ªå¸ƒå±€æ’ä»¶ï¼Œå…è®¸ä½ æ·»åŠ ä¸€ä¸ªè§†å·®èƒŒæ™¯å›¾åƒåˆ°ä½ çš„å†…å®¹ã€‚ è§†å·®èƒŒæ™¯æ’ä»¶æ˜¯ä¸å¯é…ç½®çš„","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"ORYç¼–è¾‘å™¨","slug":"React/ORYç¼–è¾‘å™¨","permalink":"https://jigangduan.github.io/categories/React/ORYç¼–è¾‘å™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"editor","slug":"editor","permalink":"https://jigangduan.github.io/tags/editor/"}]},{"title":"ORYç¼–è¾‘å™¨ (2)ory-editor-core","slug":"ORY-Editor-2","date":"2018-12-14T13:01:14.000Z","updated":"2020-07-25T02:57:18.160Z","comments":true,"path":"2018/12/14/ORY-Editor-2/","link":"","permalink":"https://jigangduan.github.io/2018/12/14/ORY-Editor-2/","excerpt":"","text":"Coreory-editor-core å…¶æ ¸å¿ƒæ˜¯ORYç¼–è¾‘å™¨çš„ä¸»ç³»ç»Ÿã€‚å®ƒåŒ…å«åˆ›å»ºå’Œä¿®æ”¹å¸ƒå±€çš„é€»è¾‘ï¼Œå¹¶è´Ÿè´£å¤„ç†æ’ä»¶ã€‚ å¼€å§‹ORYç¼–è¾‘å™¨ä½¿ç”¨Reduxå­˜å‚¨æ¥ç®¡ç†å†…éƒ¨çŠ¶æ€ã€‚åˆ›å»ºæ–°Editorå®ä¾‹æ—¶ã€‚ 123import Editor from 'ory-editor-core'const editor = new Editor() Redux storeä¹Ÿè¢«åˆ›å»ºã€‚å› æ­¤ï¼Œåœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­åªå®ä¾‹åŒ–Editorä¸€æ¬¡éå¸¸é‡è¦(è¿™ç§°ä¸ºå•ä¾‹æ¨¡å¼)ã€‚ 1234import Editor from 'ory-editor-core'const editor = new Editor()const editor2 = new Editor() // ä¸è¦è¿™æ ·åš. æ·»åŠ æ’ä»¶ç°åœ¨æˆ‘ä»¬çŸ¥é“å¦‚ä½•åˆ›å»ºä¸€ä¸ªç©ºç¼–è¾‘å™¨ã€‚è®©æˆ‘ä»¬ä¹Ÿæ·»åŠ ä¸€äº›æ’ä»¶ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ªORYç¼–è¾‘å™¨å­˜å‚¨åº“çš„æ’ä»¶ã€‚æˆ‘ä»¬ç§°è¿™äº›æ’ä»¶ä¸ºâ€œoryæ’ä»¶â€ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±æˆ‘ä»¬ç¼–å†™å’Œç»´æŠ¤çš„ã€‚ è®©æˆ‘ä»¬æ‹¿ä¸€ä¸ªå›¾åƒæ’ä»¶ä½œä¸ºåˆå­¦è€…ã€‚å›¾åƒæ’ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„å†…å®¹æ’ä»¶ï¼Œå®ƒå…è®¸æ‚¨é€šè¿‡å°†æ’ä»¶æŒ‡å‘å›¾åƒURLæ¥æ·»åŠ å›¾åƒã€‚ç›®å‰ä¸æ”¯æŒä¸Šä¼ å›¾ç‰‡ã€‚ è¦å®‰è£…imageæ’ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨npm: npm install ory-editor-plugins-imageã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒæ·»åŠ åˆ°ç¼–è¾‘å™¨å®ä¾‹ä¸­: 12345678910import Editor from 'ory-editor-core'import image from 'ory-editor-plugins-image'import 'ory-editor-plugins-image/lib/index.css'const editor = new Editor(&#123; plugins: &#123; content: [image], &#125;&#125;) è®©æˆ‘ä»¬ä»å¤´åˆ°å°¾æ¥ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥å›¾åƒæ’ä»¶å’Œæ‰€éœ€çš„CSS: 12import image from 'ory-editor-plugins-image'import 'ory-editor-plugins-image/lib/index.css' æˆ‘ä»¬å‡è®¾æ‚¨æ­£åœ¨è¿è¡Œwebpackï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªèƒ½å¤Ÿå¯¼å…¥CSSçš„æ’ä»¶ã€‚å¦‚æœè¿™è®©ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œå»https://gitter.im/webpack/webpackå¯»æ±‚å¸®åŠ©â€”â€”ä»–ä»¬éå¸¸å¥½ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹å¹¶é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’å›¾åƒå†…å®¹æ’ä»¶ã€‚ 12345const editor = new Editor(&#123; plugins: &#123; content: [image], &#125;&#125;) ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶(å³åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹ä¹‹å)åŒæ—¶add/set/removeå¸ƒå±€å’Œå†…å®¹æ’ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä½¿ç”¨è¿™äº›æ–¹æ³•å°†å¼ºåˆ¶editor re-renderã€‚ 123editor.addContentPlugin(image)editor.removeContentPlugin(image)editor.setContentPlugins([image]) æ¸²æŸ“æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ˜¾ç„¶å¸Œæœ›å‘ˆç°ç¼–è¾‘å™¨ã€‚æ ¸å¿ƒåŒ…å¯¼å‡ºä¸€ä¸ªåä¸ºEditableçš„ååº”ç‰©jsç»„ä»¶ã€‚æˆ‘ä»¬å‡è®¾HTMLæ˜¯è¿™æ ·çš„: 1234567&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;body&gt; &lt;div id=\"editable-1\"&gt;&lt;/div&gt; &lt;div id=\"controls\"&gt;&lt;/div&gt; &lt;/body&gt;&lt;/html&gt; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œjavascriptåº”ç”¨ç¨‹åºçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„: 1234567891011121314151617import React from 'react'import ReactDOM from 'react-dom'import Editor, &#123; Editable &#125; from 'ory-editor-core'import image from 'ory-editor-plugins-image'import 'ory-editor-plugins-image/lib/index.css'const editor = new Editor(&#123; plugins: &#123; content: [image] &#125;&#125;)ReactDOM.render(( &lt;Editable editor=&#123;editor&#125; /&gt;), document.getElementById('editable-1')) æˆ‘ä»¬æ‰€åšçš„å°±æ˜¯ä½¿ç”¨ReactJSå‘ˆç°Editableç»„ä»¶å¹¶ä¼ é€’editorå®ä¾‹ã€‚ç„¶è€Œï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜â€”â€”ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰å¯ç”¨çš„å†…å®¹å¯ä»¥å‘ˆç°ã€‚è®©æˆ‘ä»¬æ”¹å˜! åˆ›å»ºä¸€ä¸ªç©ºçŠ¶æ€ä¸ºäº†åˆ›å»ºä¸€ä¸ªç©ºçŠ¶æ€ï¼Œcoreå¯¼å‡ºäº†ä¸€ä¸ªåä¸ºcreateEmptyStateçš„æ–¹æ³•ã€‚è¿”å›æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæƒŸä¸€çš„idã€‚ 1234import &#123; createEmptyState &#125; from 'ory-editor-core'const editable = createEmptyState()console.log(editable.id) // æä¾›ç±»ä¼¼ \"29fb21c6-6e00-416f-a8e1-2be9fb84801c\" æŠŠè¿™ä¸ªåŠ åˆ°ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°: 1234567891011121314151617181920212223import React from 'react'import ReactDOM from 'react-dom'import Editor, &#123; Editable, createEmptyState &#125; from 'ory-editor-core'import image from 'ory-editor-plugins-image'import 'ory-editor-plugins-image/lib/index.css'const editable = createEmptyState()const editor = new Editor(&#123; plugins: &#123; content: [image] &#125;, editables: [editable],&#125;)ReactDOM.render(( &lt;Editable editor=&#123;editor&#125; id=&#123;editable.id&#125; /&gt;), document.getElementById('editable-1')) æ³¨æ„ï¼Œæˆ‘ä»¬å°†id={editable.id}æ·»åŠ åˆ°&lt;Editable&gt;ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å‘Šè¯‰ç»„ä»¶æˆ‘ä»¬æƒ³è¦åœ¨é‚£é‡Œå‘ˆç°å“ªä¸ªeditableï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·åš: 1234567891011ReactDOM.render(( &lt;div&gt; &lt;div className=\"left\"&gt; &lt;Editable editor=&#123;editor&#125; id=\"1\" /&gt; &lt;/div&gt; &lt;div className=\"right\"&gt; &lt;Editable editor=&#123;editor&#125; id=\"2\" /&gt; &lt;/div&gt; &lt;/div&gt;), document.getElementById('editable-1')) ä¿å­˜å’ŒåŠ è½½æ‚¨æ¥æ”¶åˆ°çš„çŠ¶æ€æ˜¯å†…éƒ¨ç¼–è¾‘å™¨çŠ¶æ€çš„åºåˆ—åŒ–ç‰ˆæœ¬ã€‚å®ƒåªåŒ…å«åŸºæœ¬å€¼(å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€æ˜ å°„)ï¼Œå¯ä»¥å®‰å…¨åœ°åºåˆ—åŒ–ä¸ºJSONã€‚ å‡è®¾æ‚¨æœ‰ä¸€ä¸ªåä¸ºsaveToBackendçš„å‡½æ•°ï¼Œå®ƒå°†å†…å®¹å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ä½ å¯ä»¥ä»onChangeè°ƒç”¨è¿™ä¸ªæ–¹æ³•: 123456789ReactDOM.render(( &lt;Editable editor=&#123;editor&#125; id=\"1\" onChange=&#123;(editable) =&gt; &#123; saveToBackend(editable) &#125;&#125; /&gt;), document.getElementById('editable-1')) è¦åŠ è½½å†…å®¹ï¼Œåªéœ€å°†å…¶ä¼ é€’ç»™æ„é€ å‡½æ•° 12345678const editable = loadFromBackend() // åªæ˜¯ä¸€ä¸ªä¾‹å­const editor = new Editor(&#123; plugins: &#123; content: [image] &#125;, editables: [editable],&#125;) æˆ–è€…ç”¨ trigger API. 12345// const editor = new Editor( ...const editable = loadFromBackend() // åªæ˜¯ä¸€ä¸ªä¾‹å­editor.editable.update(editable) // å¦‚æœè¿˜ä¸å­˜åœ¨ï¼Œupdateå°†æ·»åŠ ä¸€ä¸ªå¯ç¼–è¾‘çš„ï¼Œæˆ–è€…å½“å®ƒå­˜åœ¨äºå­˜å‚¨ä¸­æ—¶æ›´æ–°å®ƒ.","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"ORYç¼–è¾‘å™¨","slug":"React/ORYç¼–è¾‘å™¨","permalink":"https://jigangduan.github.io/categories/React/ORYç¼–è¾‘å™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"editor","slug":"editor","permalink":"https://jigangduan.github.io/tags/editor/"}]},{"title":"ORYç¼–è¾‘å™¨ (1)ä»‹ç»","slug":"ORY-Editor-1","date":"2018-12-14T12:22:03.000Z","updated":"2020-07-25T02:57:18.160Z","comments":true,"path":"2018/12/14/ORY-Editor-1/","link":"","permalink":"https://jigangduan.github.io/2018/12/14/ORY-Editor-1/","excerpt":"","text":"ä»‹ç»æ¬¢è¿æ¥åˆ°ORYç¼–è¾‘å™¨æŒ‡å—ã€‚è¯·æ³¨æ„ï¼ŒORYç¼–è¾‘å™¨éœ€è¦å¤§é‡çš„å…³äºReactJSã€æ„å»ºå·¥å…·(å¦‚webpack)å’ŒES6çš„çŸ¥è¯†ã€‚å¦‚æœä½ ç¼ºä¹è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œè¯·åœ¨æˆ‘ä»¬çš„èŠå¤©ä¸­å¯»æ±‚å¸®åŠ©ã€‚ ç¤ºèŒƒçœ¼è§ä¸ºå®ï¼Œè®©æˆ‘ä»¬ä»ä¸€ä¸ªæ¼”ç¤ºå¼€å§‹! ä¸€ä¸ªå¯ç”¨çš„æ¼”ç¤ºåœ¨editor.ory.shï¼Œæ‰€ä»¥å»è¯•è¯•å®ƒè‡ªå·±! ä¸ºä»€ä¹ˆå®ƒæ˜¯ä¸åŒçš„åœ¨åˆ›å»ºORYä¹‹å‰ï¼Œæˆ‘ä»¬å»ºç«‹äº†ç±»ä¼¼ç»´åŸºç™¾ç§‘çš„ä¸œè¥¿ï¼Œä½†åªæ˜¯ä¸ºäº†å­¦ä¹ ã€‚å†…å®¹æ˜¯ä¼—åŒ…çš„ï¼Œæ¯ä¸ªæœˆæœ‰è¶…è¿‡50ä¸‡äººä½¿ç”¨è¿™ä¸ªå¹³å°ã€‚æˆ‘ä»¬å¿…é¡»è®¤è¯†åˆ°ï¼Œç°æœ‰çš„å¼€æºå†…å®¹ç¼–è¾‘è§£å†³æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªç¼ºé™·ä¹‹ä¸€: åˆ¶ä½œçš„æ ‡è®°éå¸¸å¯æ€•ï¼Œå¿…é¡»è¿›è¡Œè®¸å¤šå®‰å…¨å·¥ä½œï¼ŒXSSæ€»æ˜¯ä¸€ä¸ªå¨èƒã€‚ ä½œè€…å¿…é¡»å­¦ä¹ ç‰¹æ®Šçš„ä¸Šå±‚æ ‡ç­¾ï¼Œå¦‚markdownï¼Œæ‰èƒ½äº§ç”Ÿå†…å®¹ã€‚è¿™äº›åŸºäºæ–‡æœ¬çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ— æ³•æŒ‡å®šå¸ƒå±€ï¼Œè€Œä¸”åƒè¡¨è¿™æ ·çš„å¤æ‚æ•°æ®ç»“æ„å¾ˆéš¾ç¼–è¾‘ã€‚ æœ‰å‰é€”çš„åº“æœ‰å¯èƒ½è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå› ä¸ºå®ƒæœ€åˆæ˜¯ä½œä¸ºä¸€ä¸ªç‰¹æ®Šç”¨ä¾‹æˆ–ç©ºé—²é¡¹ç›®è€Œè¢«ç»´æŠ¤è€…æŠ›å¼ƒçš„ã€‚ æˆ‘ä»¬çš„ç»“è®ºæ˜¯ï¼Œè§£å†³åŠæ³•å¿…é¡»ç¬¦åˆä¸‹åˆ—åŸåˆ™: è¯¥çŠ¶æ€æ˜¯ä¸€ä¸ªè§„èŒƒåŒ–JSONå¯¹è±¡ï¼Œä¸æ¶‰åŠHTMLã€‚ å®ƒæ˜¯ä¸€ä¸ªä¸éœ€è¦ç¼–ç¨‹ç»éªŒæˆ–ç‰¹æ®ŠåŸ¹è®­çš„å¯è§†åŒ–ç¼–è¾‘å™¨ã€‚ å®ƒæ˜¯ç”±ä¸€å®¶å…¬å¸å»ºé€ çš„ï¼Œå‡å°‘äº†è¢«é—å¼ƒçš„å¯èƒ½æ€§ã€‚ åŸºäºå¯é‡ç”¨çš„Reactç»„ä»¶ï¼Œå®ƒä¸ºå¼€å‘äººå‘˜ã€ä½œè€…å’Œè®¾è®¡äººå‘˜æä¾›äº†æ–°çš„åˆä½œæ–¹å¼ï¼Œä»è€Œæ›´å®¹æ˜“åœ°åˆ›å»ºæ›´å¥½æ›´ä¸°å¯Œçš„ä½“éªŒã€‚ å®ƒé€‚ç”¨äºç§»åŠ¨å’Œè§¦æ§è®¾å¤‡ã€‚ å¸¦ç€è¿™äº›åŸåˆ™ï¼Œæˆ‘ä»¬å‡ºå»å®ç°äº†ORYç¼–è¾‘å™¨ï¼Œä¹Ÿå°±æ˜¯æ‚¨ç°åœ¨çœ‹åˆ°çš„ç¼–è¾‘å™¨ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ORYç¼–è¾‘å™¨ä¸»è¦æ˜¯åˆ›å»ºå’Œä¿®æ”¹å¸ƒå±€çš„å·¥å…·ã€‚æ ¸å¿ƒæ˜¯å•å…ƒæ ¼å’Œè¡Œã€‚å¸ƒå±€ç³»ç»Ÿéå¸¸ç±»ä¼¼äºbootstrapç½‘æ ¼ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«è¡Œå’Œåˆ—ã€‚ å¯ç¼–è¾‘(å…¶ä»–ç¼–è¾‘å™¨ç§°ä¹‹ä¸ºâ€œæ–‡æ¡£â€)çš„ç¤ºä¾‹ç»“æ„å¯ä»¥æ˜¯: 12345678910111. Editable+-1. Container cell +-1. Row | +-1. Cell (text) | |-2. Cell (parallax background image) | +-1. Row | +-1. Cell (image) | |-2. Cell (image) |-2. Row | +-1. Cell (image) | |-2. Cell (image) æœ‰å››ç§ä¸åŒçš„æ•°æ®ç±»å‹: Editable (æ ‘ä¸­ 1.) - editableæ˜¯å•å…ƒæ ¼å’Œè¡Œçš„å®¹å™¨ã€‚æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªé¡µé¢ä¸Šæœ‰å¤šä¸ªå¯ç¼–è¾‘çš„å•å…ƒæ ¼ï¼Œå¹¶ä¸”å¯ä»¥å°†å•å…ƒæ ¼ä»ä¸€ä¸ªå¯ç¼–è¾‘çš„å•å…ƒæ ¼æ‹–æ”¾åˆ°å¦ä¸€ä¸ªå¯ç¼–è¾‘çš„å•å…ƒæ ¼ä¸­ã€‚ Container cell (æ ‘ä¸­ 1.1) - å®¹å™¨å•å…ƒæ ¼æ˜¯ä¸€ä¸ªæ²¡æœ‰æ’ä»¶çš„å•å…ƒæ ¼ï¼Œå®ƒä¸ºæ ‘æä¾›äº†ç»“æ„ã€‚è¿™äº›å•å…ƒæ ¼åœ¨éœ€è¦æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œåœ¨ä¸å†éœ€è¦æ—¶è‡ªåŠ¨åˆ é™¤ã€‚ Content cell (æ ‘ä¸­ 1.1.1, 1.2.1, ...) - å†…å®¹å•å…ƒæ ¼å§‹ç»ˆæ˜¯æ ‘ä¸­çš„å¶å­(å®ƒæ²¡æœ‰å­å…ƒç´ )ï¼Œå®ƒçš„è¡Œä¸ºç”±å†…å®¹æ’ä»¶å®šä¹‰(å¯ä»¥ç”±æ‚¨ç¼–å†™æˆ–ä»npmä¸‹è½½)ã€‚å†…å®¹æ’ä»¶é€šå¸¸æ˜¯å¯Œæ–‡æœ¬ã€è§†é¢‘ã€éŸ³é¢‘ã€soundcloudå°éƒ¨ä»¶ç­‰ã€‚ Layout cell å¸ƒå±€å•å…ƒæ ¼åŒ…å«åµŒå¥—å•å…ƒæ ¼å’Œè¡Œ(å®¹å™¨ã€å†…å®¹ã€å¸ƒå±€)çš„åˆ—è¡¨ã€‚å¸ƒå±€å•å…ƒæ ¼çš„æ€æƒ³æ˜¯å®ƒç»™å®ƒçš„å­å•å…ƒæ ¼ä¸€ä¸ªå¸ƒå±€(ä¾‹å¦‚è§†å·®èƒŒæ™¯ï¼Œä¸€ä¸ªæ‰°æµæ¡†ï¼Œä¸€ä¸ªæ‰€æœ‰æ–‡æœ¬éƒ½æ˜¯çº¢è‰²çš„æ¡†)ã€‚å¸ƒå±€æ˜¯ç”±å¸ƒå±€æ’ä»¶å®šä¹‰çš„ã€‚å¸ƒå±€å•å…ƒæ ¼å¿…é¡»æ€»æ˜¯è‡³å°‘æœ‰ä¸€ä¸ªå­å•å…ƒæ ¼ï¼Œå¦åˆ™å®ƒå°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚ ç½‘æ ¼ç³»ç»Ÿè¢«çƒ˜ç„™åˆ°ORYç¼–è¾‘å™¨ä¸­ã€‚å®ƒè´Ÿè´£ä»»ä½•æ‹–æ”¾é€»è¾‘ã€è°ƒæ•´å¤§å°ã€ç„¦ç‚¹æ£€æµ‹ç­‰ç­‰ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨å°†ä¸»è¦ä½¿ç”¨å¸ƒå±€å’Œå†…å®¹æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œç¼–è¾‘å™¨è´Ÿè´£æ•´ä¸ªæ•°æ®æ¨¡å‹ã€‚æ’ä»¶åªæ˜¯ç®€å•çš„ååº”ç‰©jsç»„ä»¶ï¼Œå®ƒä»¬æ¥æ”¶ç¼–è¾‘å™¨æ¥æ”¶çš„å±æ€§å¦‚onChangeã€readOnlyã€stateã€‚åœ¨åé¢çš„éƒ¨åˆ†ä¸­ï¼Œæ‚¨å°†äº†è§£æ’ä»¶çš„å·¥ä½œåŸç†ï¼Œå®ƒä»¬çš„APIæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä»¥åŠå¦‚ä½•ç¼–å†™è‡ªå·±çš„APIã€‚","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"ORYç¼–è¾‘å™¨","slug":"React/ORYç¼–è¾‘å™¨","permalink":"https://jigangduan.github.io/categories/React/ORYç¼–è¾‘å™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"editor","slug":"editor","permalink":"https://jigangduan.github.io/tags/editor/"}]},{"title":"react-jsonschema-form","slug":"react-jsonschema-form","date":"2018-12-12T02:38:08.000Z","updated":"2020-07-25T02:57:18.226Z","comments":true,"path":"2018/12/12/react-jsonschema-form/","link":"","permalink":"https://jigangduan.github.io/2018/12/12/react-jsonschema-form/","excerpt":"","text":"ä½¿ç”¨JSON Schemaæ„å»ºWebè¡¨å•çš„Reactç»„ä»¶ã€‚https://mozilla-services.github.io/react-jsonschema-form ä¸€ä¸ªç®€å•çš„Reactç»„ä»¶ï¼Œèƒ½å¤Ÿä»JSONæ¨¡å¼æ„å»ºHTMLè¡¨å•ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨Bootstrapè¯­ä¹‰ã€‚ ä¸€ä¸ªæ´»åŠ¨çš„æ¸¸ä¹åœºåœ¨gh-pagesä¸Šé¢ã€‚ è®¾è®¡å“²å­¦response-jsonschema-formæ—¨åœ¨åŸºäºJSONæ¨¡å¼è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªresponseè¡¨å•ã€‚å®ƒæ˜¯kinto-adminé¡¹ç›®ä¸­çš„ä¸€ä¸ªä¸»è¦ç»„ä»¶ã€‚å¦‚æœæ‚¨æƒ³ä¸ºä»»ä½•æ•°æ®ç”Ÿæˆä¸€ä¸ªè¡¨å•(çœ‹ä¸è§)ï¼Œåªéœ€ç»™å‡ºä¸€ä¸ªJSONæ¨¡å¼ï¼Œé‚£ä¹ˆresponse-jsonschema-formå¯èƒ½é€‚åˆæ‚¨ã€‚å¦‚æœæ‚¨å¯¹æ•°æ®æœ‰å…ˆå…¥ä¸ºä¸»çš„äº†è§£ï¼Œå¹¶ä¸”å¸Œæœ›æœ‰ä¸€ä¸ªç”¨äºä¸ºå…¶ç”Ÿæˆè¡¨å•çš„å·¥å…·åŒ…ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å¯»æ‰¾ã€‚ response-jsonschema-forméªŒè¯æ•°æ®æ˜¯å¦ç¬¦åˆç»™å®šçš„æ¨¡å¼ï¼Œä½†ä¸é˜»æ­¢ç”¨æˆ·è¾“å…¥ä¸é€‚åˆçš„æ•°æ®(ä¾‹å¦‚ï¼Œä»æ•°å­—å­—æ®µä¸­åˆ é™¤éæ•°å­—ï¼Œæˆ–è€…å‘å·²ç»â€œæ»¡â€çš„æ•°ç»„ä¸­æ·»åŠ å€¼)ã€‚ å®‰è£…éœ€è¦ React 15.0.0+. æ³¨æ„:å­˜å‚¨åº“çš„ä¸»åˆ†æ”¯åæ˜ äº†æ­£åœ¨è¿›è¡Œçš„å¼€å‘ã€‚ç‰ˆæœ¬ä½œä¸ºæ ‡è®°å‘å¸ƒã€‚æ°¸è¿œä¸è¦ç›²ç›®åœ°ä»masterå®‰è£…ï¼Œè€Œåº”è¯¥æ£€æŸ¥å¯ç”¨çš„ç¨³å®šç‰ˆæœ¬ã€‚ ä½œä¸ºä¸€ä¸ªåŸºäºnpmçš„é¡¹ç›®ä¾èµ–é¡¹1npm install react-jsonschema-form --save æ³¨æ„:å½“åº“å‘ˆç°è‡ªå¼•å¯¼HTMLè¯­ä¹‰æ—¶ï¼Œæ‚¨å¿…é¡»è‡ªå·±æ„å»ºå’ŒåŠ è½½Bootstrapæ ·å¼ã€‚ ä½œä¸ºCDNæä¾›çš„è„šæœ¬1&lt;script src=\"https://unpkg.com/react-jsonschema-form/dist/react-jsonschema-form.js\"&gt;&lt;/script&gt; æºæ˜ å°„åœ¨æ­¤urlä¸­å¯ç”¨ æ³¨æ„:CDNç‰ˆæœ¬ä¸åµŒå…¥reactæˆ–react-dom æ‚¨è¿˜éœ€è¦åˆ«åé»˜è®¤å¯¼å‡ºå±æ€§æ¥ä½¿ç”¨è¡¨å•ç»„ä»¶: 123const Form = JSONSchemaForm.default;// orconst &#123;default: Form&#125; = JSONSchemaForm; ä½¿ç”¨1234567891011121314151617181920212223import React, &#123; Component &#125; from \"react\";import &#123; render &#125; from \"react-dom\";import Form from \"react-jsonschema-form\";const schema = &#123; title: \"Todo\", type: \"object\", required: [\"title\"], properties: &#123; title: &#123;type: \"string\", title: \"Title\", default: \"A new task\"&#125;, done: &#123;type: \"boolean\", title: \"Done?\", default: false&#125; &#125;&#125;;const log = (type) =&gt; console.log.bind(console, type);render(( &lt;Form schema=&#123;schema&#125; onChange=&#123;log(\"changed\")&#125; onSubmit=&#123;log(\"submitted\")&#125; onError=&#123;log(\"errors\")&#125; /&gt;), document.getElementById(\"app\")); è¿™ä¼šç”Ÿæˆè¿™æ ·çš„è¡¨å•(å‡è®¾æ‚¨åŠ è½½äº†æ ‡å‡†çš„Bootstrapæ ·å¼è¡¨): è¡¨å•åˆå§‹åŒ–é€šå¸¸éœ€è¦ç”¨ç°æœ‰æ•°æ®é¢„å¡«è¡¨å•;è¿™æ˜¯é€šè¿‡ä¼ é€’ä¸æ¨¡å¼åŒ¹é…çš„formData propå¯¹è±¡æ¥å®ç°çš„: 123456789const formData = &#123; title: \"First task\", done: true&#125;;render(( &lt;Form schema=&#123;schema&#125; formData=&#123;formData&#125; /&gt;), document.getElementById(\"app\")); æ³¨æ„:å¦‚æœè¡¨å•åªæœ‰ä¸€ä¸ªå­—æ®µï¼Œåˆ™å°†ä¸€ä¸ªå€¼ä¼ é€’ç»™formData. ex: formData=â€™Charlieâ€™ è­¦å‘Š:å¦‚æœæ‚¨é‡åˆ°çˆ¶ç»„ä»¶å¯ä»¥é‡æ–°å‘ˆç°çš„æƒ…å†µï¼Œè¯·ç¡®ä¿ä¾¦å¬onChangeäº‹ä»¶å¹¶æ›´æ–°ä¼ é€’ç»™formDataå±æ€§çš„æ•°æ®ã€‚ è¡¨å•äº‹ä»¶å¤„ç†è¡¨å•æäº¤è¡¨å•é”™è¯¯äº‹ä»¶å¤„ç†è¡¨å•æ•°æ®å˜åŒ–è¡¨å•å­—æ®µå¤±ç„¦äº‹ä»¶è¡¨å•å­—æ®µç„¦ç‚¹äº‹ä»¶ä»¥ç¼–ç¨‹æ–¹å¼æäº¤è¡¨å•æ‚¨å¯ä»¥ä½¿ç”¨è¯¥å¼•ç”¨æ¥è·å–è¡¨å•ç»„ä»¶ï¼Œå¹¶è°ƒç”¨submitæ–¹æ³•ä»¥ç¼–ç¨‹æ–¹å¼æäº¤è¡¨å•ï¼Œæ— éœ€æäº¤æŒ‰é’®ã€‚æ­¤æ–¹æ³•å°†åˆ†æ´¾è¡¨å•çš„æäº¤äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ä¼ é€’ç»™onSubmit propsçš„å‡½æ•°ã€‚ 123456789const onSubmit = (&#123;formData&#125;) =&gt; console.log(\"Data submitted: \", formData);let yourForm;render(( &lt;Form schema=&#123;schema&#125; onSubmit=&#123;onSubmit&#125; ref=&#123;(form) =&gt; &#123;yourForm = form;&#125;&#125;/&gt;), document.getElementById(\"app\"));yourForm.submit(); è¡¨å•å®šåˆ¶uiSchemaå¯¹è±¡JSONSchemaåœ¨æè¿°å¦‚ä½•å°†ç»™å®šçš„æ•°æ®ç±»å‹å‘ˆç°ä¸ºè¡¨å•è¾“å…¥ç»„ä»¶æ—¶å—åˆ°é™åˆ¶ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªåº“å¼•å…¥äº†UIæ¨¡å¼çš„æ¦‚å¿µã€‚ UIæ¨¡å¼åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡æ–‡å­—ï¼Œæä¾›äº†å…³äºè¡¨å•åº”è¯¥å¦‚ä½•å‘ˆç°çš„ä¿¡æ¯ï¼Œè€ŒJSONæ¨¡å¼å‘Šè¯‰æˆ‘ä»¬åº”è¯¥å¦‚ä½•å‘ˆç°ã€‚ uiSchemaå¯¹è±¡éµå¾ªè¡¨å•å­—æ®µå±‚æ¬¡ç»“æ„çš„æ ‘å½¢ç»“æ„ï¼Œå¹¶å®šä¹‰å¦‚ä½•å‘ˆç°æ¯ä¸ªå±æ€§: 12345678910111213141516171819202122232425262728293031323334353637383940414243const schema = &#123; type: \"object\", properties: &#123; foo: &#123; type: \"object\", properties: &#123; bar: &#123;type: \"string\"&#125; &#125; &#125;, baz: &#123; type: \"array\", items: &#123; type: \"object\", properties: &#123; description: &#123; \"type\": \"string\" &#125; &#125; &#125; &#125; &#125;&#125;const uiSchema = &#123; foo: &#123; bar: &#123; \"ui:widget\": \"textarea\" &#125;, &#125;, baz: &#123; // note the \"items\" for an array items: &#123; description: &#123; \"ui:widget\": \"textarea\" &#125; &#125; &#125;&#125;render(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; /&gt;), document.getElementById(\"app\")); é€‰æ‹©å°éƒ¨ä»¶uiSchema ui:widgetå±æ€§å‘Šè¯‰è¡¨å•åº”è¯¥ä½¿ç”¨å“ªä¸ªuiå°éƒ¨ä»¶å‘ˆç°å­—æ®µã€‚ ä¾‹å­: 1234567891011const uiSchema = &#123; done: &#123; \"ui:widget\": \"radio\" // could also be \"select\" &#125;&#125;;render(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; formData=&#123;formData&#125; /&gt;), document.getElementById(\"app\")); ä»¥ä¸‹æ˜¯é’ˆå¯¹ä¸åŒJSONSchemaæ•°æ®ç±»å‹æ”¯æŒçš„å¯é€‰å°éƒ¨ä»¶åˆ—è¡¨: boolean å­—æ®µ radio:ä»¥trueã€falseä½œä¸ºå¯é€‰å€¼çš„å•é€‰æŒ‰é’®ç»„; select:ä»¥trueå’Œfalseä½œä¸ºé€‰é¡¹çš„é€‰æ‹©æ¡†; é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¤é€‰æ¡† æ³¨æ„:è¦è®¾ç½®å¸ƒå°”å­—æ®µçš„æ ‡ç­¾ï¼Œå¯ä»¥åœ¨æ¨¡å¼ä¸­è®¾ç½®enumNamesï¼Œè€Œä¸æ˜¯ä½¿ç”¨trueå’Œfalseã€‚æ³¨æ„ï¼ŒenumNameså±äºæ‚¨çš„æ¨¡å¼ï¼Œè€Œä¸æ˜¯uiSchemaï¼Œè€Œä¸”é¡ºåºæ€»æ˜¯[trueã€false]ã€‚ string å­—æ®µ textarea:ä½¿ç”¨textareaå…ƒç´ ; password:ä½¿ç”¨input[type=password]å…ƒç´ ; color:ä½¿ç”¨input[type=color]å…ƒç´ ; é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¸¸è§„input[type=text]å…ƒç´ ã€‚ string æ ¼å¼å†…ç½®çš„stringå­—æ®µè¿˜æ”¯æŒJSONSchema formatå±æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä¸ºä»¥ä¸‹å­—ç¬¦ä¸²æ ¼å¼å‘ˆç°é€‚å½“çš„å°éƒ¨ä»¶: email:ä½¿ç”¨input[type=email]å…ƒç´ ; uri:ä½¿ç”¨input[type=url]å…ƒç´ ; data-url:é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨input[type=file]å…ƒç´ ;å¦‚æœå­—ç¬¦ä¸²æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œå°†è‡ªåŠ¨å¤„ç†å¤šä¸ªæ–‡ä»¶(è¯·å‚é˜…æ–‡ä»¶å°éƒ¨ä»¶)ã€‚ date:é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨input[type=date]å…ƒç´ ; date-time:é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨input[type=datetime-local]å…ƒç´ ã€‚ è¯·æ³¨æ„ï¼Œå°½ç®¡å®ƒä»¬æ˜¯æ ‡å‡†åŒ–çš„ï¼Œä½†æ˜¯Firefoxå’ŒIEè¿˜ä¸æ”¯æŒdate-time-localå’Œdateè¾“å…¥å…ƒç´ ã€‚å¦‚æœæ‚¨æ‰“ç®—é’ˆå¯¹è¿™äº›å¹³å°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ›¿ä»£å°éƒ¨ä»¶: alt-datetime:é€‰æ‹©å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’å…­ä¸ªå…ƒç´ ; alt-date:ä¸‰ä¸ªselectå…ƒç´ ç”¨äºé€‰æ‹©å¹´ä»½ã€æœˆä»½å’Œæ—¥æœŸã€‚ é€šè¿‡å‘uiSchemaä¸­çš„ui:optionsæä¾›yearsRangeå±æ€§ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºåœ¨yearä¸‹æ‹‰èœå•ä¸­çš„yearåˆ—è¡¨ã€‚è¿˜å¯ä»¥ä½¿ç”¨hideNowButtonå’ŒhideClearButtoné€‰é¡¹åˆ é™¤Nowå’ŒClearæŒ‰é’®ã€‚ 123456789101112uiSchema: &#123; a_date: &#123; \"alt-datetime\": &#123; \"ui:widget\": \"alt-datetime\", \"ui:options\": &#123; yearsRange: [1980, 2030], hideNowButton: true, hideClearButton: true, &#125;, &#125;, &#125;,&#125;, numberå’Œintegerå­—æ®µ updown:ä¸€ä¸ªinput[type=number]å‘ä¸Šå‘ä¸‹é€‰æ‹©å™¨; range: input[type=range]æ»‘å—; radio:å¸¦æœ‰æšä¸¾å€¼çš„å•é€‰æŒ‰é’®ç»„ã€‚è¿™åªèƒ½åœ¨ä¸ºè¯¥è¾“å…¥æŒ‡å®šæšä¸¾å€¼æ—¶ä½¿ç”¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¸¸è§„input[type=text]å…ƒç´ ã€‚ æ³¨æ„:å¦‚æœå®šä¹‰äº†JSONSchemaçš„minimumã€maximumå’ŒmultipleOfå€¼ï¼Œåˆ™inputå±æ€§å€¼çš„minã€maxå’Œstepå€¼å°†é‡‡ç”¨è¿™äº›å€¼ã€‚ ç¦ç”¨å­—æ®µui:disabled uiSchemaæŒ‡ä»¤å°†ç¦ç”¨ç»™å®šå­—æ®µä¸­çš„æ‰€æœ‰å­å°éƒ¨ä»¶ã€‚ åªè¯»å­—æ®µui:readonly uiSchemaæŒ‡ä»¤å°†æŒ‡å®šå­—æ®µä¸­çš„æ‰€æœ‰å­éƒ¨ä»¶æ ‡è®°ä¸ºåªè¯»ã€‚ æ³¨æ„:å¦‚æœæ‚¨æƒ³çŸ¥é“ç¦ç”¨å­—æ®µå’Œåªè¯»å­—æ®µä¹‹é—´çš„åŒºåˆ«:å°†å­—æ®µæ ‡è®°ä¸ºåªè¯»å°†ä½¿å…¶å‘ˆç°ç°è‰²ï¼Œä½†æ˜¯å®ƒçš„æ–‡æœ¬å€¼æ˜¯å¯é€‰æ‹©çš„ã€‚ç¦ç”¨å®ƒå°†å®Œå…¨é˜»æ­¢é€‰æ‹©å®ƒçš„å€¼ã€‚ éšè—å°éƒ¨ä»¶é€šè¿‡å°†å…¶ui:widget uiSchemaæŒ‡ä»¤è®¾ç½®ä¸ºhiddenï¼Œå¯ä»¥ä¸ºå­—æ®µä½¿ç”¨éšè—å°éƒ¨ä»¶: 12345678910const schema = &#123; type: \"object\", properties: &#123; foo: &#123;type: \"boolean\"&#125; &#125;&#125;;const uiSchema = &#123; foo: &#123;\"ui:widget\": \"hidden\"&#125;&#125;; ç¬”è®°: éšè—å°éƒ¨ä»¶åªæ”¯æŒå¸ƒå°”ã€å­—ç¬¦ä¸²ã€æ•°å­—å’Œæ•´æ•°æ¨¡å¼ç±»å‹; éšè—çš„å°éƒ¨ä»¶ä»formDataæ”¯æŸ±è·å–å®ƒçš„å€¼ã€‚ æ–‡ä»¶éƒ¨ä»¶Multiple filesFile widget input refå¯¹è±¡å­—æ®µæ’åºå¯¹è±¡itemé€‰é¡¹expandable é€‰é¡¹æ•°ç»„itemé€‰é¡¹orderableé€‰é¡¹addableé€‰é¡¹removableé€‰é¡¹è‡ªå®šä¹‰CSSç±»åæšä¸¾å­—æ®µçš„è‡ªå®šä¹‰æ ‡ç­¾å¦ä¸€ç§å…¼å®¹jsonæ¨¡å¼çš„æ–¹æ³•æšä¸¾å­—æ®µçš„ç¦ç”¨å±æ€§å¤šé¡¹é€‰æ‹©é¢˜åˆ—è¡¨è‡ªåŠ¨ç”Ÿæˆå°éƒ¨ä»¶idsé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåº“å°†ä¸ºæ‰€æœ‰å‘ˆç°çš„å°éƒ¨ä»¶ç”Ÿæˆè¡¨å•ç‰¹æœ‰çš„idã€‚å¦‚æœæ‚¨æ‰“ç®—åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­ä½¿ç”¨è¡¨å•ç»„ä»¶çš„å¤šä¸ªå®ä¾‹ï¼Œæ˜æ™ºçš„åšæ³•æ˜¯ä¸ºè¿™äº›å®ä¾‹å£°æ˜ä¸€ä¸ªæ ¹å‰ç¼€ï¼Œä½¿ç”¨ui:rootFieldId uiSchemaæŒ‡ä»¤: 123const uiSchema = &#123; \"ui:rootFieldId\": \"myform\"&#125;; æ‰€ä»¥æ‰€æœ‰å°éƒ¨ä»¶çš„idéƒ½ä»¥myformä¸ºå‰ç¼€ã€‚ è¡¨å•æ“ä½œæŒ‰é’®å¸®åŠ©æ–‡æœ¬æ ‡é¢˜æ–‡æœ¬æè¿°æ–‡æœ¬è‡ªåŠ¨å¯¹ç„¦æ–‡æœ¬åŒºåŸŸçš„è¡Œé€‰é¡¹å ä½ç¬¦å­—æ®µæ ‡ç­¾HTML5çš„Inputç±»å‹Formå±æ€§Formç»„ä»¶æ”¯æŒä»¥ä¸‹htmlå±æ€§: 1234567891011&lt;Form id=\"edit-form\" className=\"form form-wide\" name=\"awesomeForm\" method=\"post\" target=\"_blank\" action=\"/users/list\" autocomplete=\"off\" enctype=\"multipart/form-data\" acceptcharset=\"ISO-8859-1\" schema=&#123;&#125; /&gt; Formç¦ç”¨é«˜çº§å®šåˆ¶ - è‡ªå®šä¹‰å­—æ®µ è‡ªå®šä¹‰æ¨¡æ¿ è‡ªå®šä¹‰éƒ¨ä»¶ å®ƒæ‰€åšçš„ è¦†ç›–æ‰€æœ‰çš„è¡Œä¸º åªè¦†ç›–å¸ƒå±€ åªè¦†ç›–è¾“å…¥æ¡†(è€Œä¸æ˜¯å¸ƒå±€ã€æ ‡ç­¾ã€å¸®åŠ©æˆ–éªŒè¯) å­—æ®µæ¨¡æ¿è¦æ§åˆ¶æ¯ä¸ªå­—æ®µ(æ¯ä¸ªè¡¨å•è¡Œ)çš„å†…éƒ¨ç»„ç»‡ï¼Œå¯ä»¥ä¸ºè¡¨å•å®šä¹‰ä¸€ä¸ªå­—æ®µæ¨¡æ¿ã€‚ å­—æ®µæ¨¡æ¿åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ­£åœ¨ä¼ é€’ä¸å­—æ®µç›¸å…³çš„é“å…·çš„æ— çŠ¶æ€ç»„ä»¶ï¼Œå…è®¸æ‚¨æŒ‰ç…§è‡ªå·±çš„å–œå¥½æ„é€ è¡¨å•è¡Œã€‚ 1234567891011121314151617function CustomFieldTemplate(props) &#123; const &#123;id, classNames, label, help, required, description, errors, children&#125; = props; return ( &lt;div className=&#123;classNames&#125;&gt; &lt;label htmlFor=&#123;id&#125;&gt;&#123;label&#125;&#123;required ? \"*\" : null&#125;&lt;/label&gt; &#123;description&#125; &#123;children&#125; &#123;errors&#125; &#123;help&#125; &lt;/div&gt; );&#125;render(( &lt;Form schema=&#123;schema&#125; FieldTemplate=&#123;CustomFieldTemplate&#125; /&gt;,), document.getElementById(\"app\")); å¦‚æœæ‚¨æƒ³è‡ªå·±å¤„ç†æ¯ä¸ªå…ƒç´ çš„å‘ˆç°ï¼Œå¯ä»¥ä½¿ç”¨props rawHelpã€rawDescriptionå’ŒrawErrorsã€‚ ä»¥ä¸‹propsä¼ é€’ç»™è‡ªå®šä¹‰å­—æ®µæ¨¡æ¿ç»„ä»¶: id: å±‚æ¬¡ç»“æ„ä¸­å­—æ®µçš„idã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒå‘ˆç°é’ˆå¯¹åŒ…è£…çš„å°éƒ¨ä»¶çš„æ ‡ç­¾ classNames: åŒ…å«åŸºæœ¬Bootstrap CSSç±»çš„å­—ç¬¦ä¸²ï¼Œä¸uiSchemaä¸­å®šä¹‰çš„è‡ªå®šä¹‰ç±»åˆå¹¶ label: è¯¥å­—æ®µçš„è®¡ç®—æ ‡ç­¾ï¼Œä½œä¸ºå­—ç¬¦ä¸² description:å‘ˆç°å­—æ®µæè¿°çš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœå®šä¹‰äº†å­—æ®µæè¿°(è¿™å°†ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰DescriptionFieldå®šä¹‰) rawDescription: åŒ…å«å®šä¹‰çš„ä»»ä½•ui:description uiSchemaæŒ‡ä»¤çš„å­—ç¬¦ä¸² children: è¯¥å­—æ®µè¡Œçš„å­—æ®µæˆ–å°éƒ¨ä»¶ç»„ä»¶å®ä¾‹ errors: ç»„ä»¶å®ä¾‹åˆ—å‡ºè¯¥å­—æ®µé‡åˆ°çš„ä»»ä½•é”™è¯¯. rawErrors: ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œåˆ—å‡ºä»è¯¥å­—æ®µé‡åˆ°çš„é”™è¯¯ä¸­ç”Ÿæˆçš„æ‰€æœ‰é”™è¯¯æ¶ˆæ¯. help: å‘ˆç°ä»»ä½•uiçš„ç»„ä»¶å®ä¾‹:å¸®åŠ©å®šä¹‰çš„uiSchemaæŒ‡ä»¤. rawHelp: åŒ…å«ä»»ä½•uiçš„å­—ç¬¦ä¸²:å¸®åŠ©å®šä¹‰uiSchemaæŒ‡ä»¤ã€‚æ³¨æ„:å¦‚æœä¼ é€’çš„ui:helpæ˜¯ä¸€ä¸ªresponseç»„ä»¶è€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼ŒrawHelpå°†æ˜¯æœªå®šä¹‰çš„. hidden: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå­—æ®µæ˜¯å¦åº”è¯¥éšè—. required: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€è¦å­—æ®µ. readonly: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå­—æ®µæ˜¯å¦åªè¯». disabled:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå­—æ®µæ˜¯å¦ç¦ç”¨. displayLabel: ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ ‡ç­¾æ˜¯å¦åº”è¯¥è¢«å‘ˆç°ã€‚è¿™å¯¹äºä¸æƒ³è®©UIæ··ä¹±çš„æ•°ç»„ä¸­çš„åµŒå¥—å­—æ®µéå¸¸æœ‰ç”¨. fields: åŒ…å«æ‰€æœ‰è¡¨å•å­—æ®µçš„æ•°ç»„ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰å­—æ®µå’Œå†…ç½®å­—æ®µ. schema: è¯¥å­—æ®µçš„æ¨¡å¼å¯¹è±¡. uiSchema: è¯¥é¢†åŸŸçš„uiSchemaå¯¹è±¡. formContext: ä¼ é€’ç»™Formçš„formContextå¯¹è±¡. æ³¨æ„:æ‚¨åªèƒ½ä¸ºè¡¨å•å®šä¹‰ä¸€ä¸ªå­—æ®µæ¨¡æ¿ã€‚å¦‚æœæ‚¨éœ€è¦è®¸å¤šå­—æ®µï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯æ—¶å€™æŸ¥çœ‹è‡ªå®šä¹‰å­—æ®µäº†ã€‚ æ•°ç»„å­—æ®µæ¨¡æ¿ä¸FieldTemplateç±»ä¼¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ArrayFieldTemplateè‡ªå®šä¹‰å¦‚ä½•å‘ˆç°æ•°ç»„ã€‚è¿™å…è®¸æ‚¨è‡ªå®šä¹‰æ•°ç»„å’Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ è¯·å‚è§customArray.jsäº†è§£æ›´å¥½çš„ä¾‹å­ ä¸‹é¢çš„é“å…·è¢«ä¼ é€’åˆ°æ¯ä¸ªArrayFieldTemplate: DescriptionField:æ³¨å†Œè¡¨ä¸­çš„DescriptionField(å¦‚æœæ‚¨æƒ³ä½¿ç”¨å®ƒ) TitleField:æ³¨å†Œè¡¨ä¸­çš„TitleField(å¦‚æœæ‚¨æƒ³ä½¿ç”¨å®ƒ) canAdd:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å¯ä»¥å‘æ•°ç»„ä¸­æ·»åŠ æ–°å…ƒç´  className:ç±»åå­—ç¬¦ä¸² disabled:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ•°ç»„æ˜¯å¦ç¦ç”¨ idSchema:å¯¹è±¡ items:è¡¨ç¤ºæ•°ç»„ä¸­é¡¹ç›®çš„å¯¹è±¡æ•°ç»„ã€‚æ¯ä¸€é¡¹éƒ½ä»£è¡¨ä¸€ä¸ªå­å…ƒç´ ï¼Œå…¶å±æ€§å¦‚ä¸‹æ‰€è¿° onAddClick: (event) =&gt; void:å‘æ•°ç»„ä¸­æ·»åŠ æ–°é¡¹çš„å‡½æ•° readonly:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ•°ç»„æ˜¯å¦åªè¯» required:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€è¦æ•°ç»„ schema:è¯¥æ•°ç»„çš„æ¨¡å¼å¯¹è±¡ uiSchema:è¿™ä¸ªæ•°ç»„å­—æ®µçš„uiSchemaå¯¹è±¡ title:åŒ…å«æ•°ç»„æ ‡é¢˜çš„å­—ç¬¦ä¸²å€¼ formContext:ä¼ é€’ç»™Formçš„formContextå¯¹è±¡ formData:è¯¥æ•°ç»„çš„formData ä»¥ä¸‹ propsæ˜¯itemsä¸­æ¯ä¸ªå…ƒç´ çš„ä¸€éƒ¨åˆ†: children:é¡¹ç›®å†…å®¹çš„html className:ç±»åå­—ç¬¦ä¸² disabled:è¡¨ç¤ºæ•°ç»„é¡¹æ˜¯å¦ç¦ç”¨çš„å¸ƒå°”å€¼ hasMoveDown:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ•°ç»„é¡¹æ˜¯å¦å¯ä»¥å‘ä¸‹ç§»åŠ¨ hasMoveUp:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ•°ç»„é¡¹æ˜¯å¦å¯ä»¥å‘ä¸Šç§»åŠ¨ hasRemove:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å¯ä»¥åˆ é™¤æ•°ç»„é¡¹ hasToolbar:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ•°ç»„é¡¹æ˜¯å¦æœ‰å·¥å…·æ  index:è¡¨ç¤ºæ•°ç»„é¡¹åœ¨é¡¹ä¸­å‡ºç°çš„ç´¢å¼•çš„æ•°å­— onDropIndexClick: (index) =&gt; (event) =&gt; void:è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åˆ é™¤ç´¢å¼•å¤„çš„é¡¹ç›® onReorderClick: (index, newIndex) =&gt; (event) =&gt; void:è¿”å›ä¸€ä¸ªä¸newIndexäº¤æ¢ç´¢å¼•é¡¹çš„å‡½æ•° readonly:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºå£°æ˜æ•°ç»„é¡¹æ˜¯å¦ä¸ºåªè¯» å¯¹è±¡å­—æ®µæ¨¡æ¿ä¸FieldTemplateç±»ä¼¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ObjectFieldTemplateè‡ªå®šä¹‰å¦‚ä½•å‘ˆç°å¯¹è±¡ 1234567891011121314function ObjectFieldTemplate(props) &#123; return ( &lt;div&gt; &#123;props.title&#125; &#123;props.description&#125; &#123;props.properties.map(element =&gt; &lt;div className=\"property-wrapper\"&gt;&#123;element.content&#125;&lt;/div&gt;)&#125; &lt;/div&gt; );&#125;render(( &lt;Form schema=&#123;schema&#125; ObjectFieldTemplate=&#123;ObjectFieldTemplate&#125; /&gt;,), document.getElementById(\"app\")); DescriptionField:æ³¨å†Œè¡¨ä¸­çš„DescriptionField(å¦‚æœæ‚¨æƒ³ä½¿ç”¨å®ƒ) TitleField:æ³¨å†Œè¡¨ä¸­çš„TitleField(å¦‚æœæ‚¨æƒ³ä½¿ç”¨å®ƒ)ã€‚ title:åŒ…å«å¯¹è±¡æ ‡é¢˜çš„å­—ç¬¦ä¸²å€¼ã€‚ description:åŒ…å«å¯¹è±¡æè¿°çš„å­—ç¬¦ä¸²å€¼ã€‚ properties:è¡¨ç¤ºæ•°ç»„ä¸­å±æ€§çš„å¯¹è±¡æ•°ç»„ã€‚æ¯ä¸ªå±æ€§è¡¨ç¤ºä¸€ä¸ªå­å±æ€§ï¼Œå…¶å±æ€§æè¿°å¦‚ä¸‹ã€‚ required:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€è¦å¯¹è±¡ã€‚ schema:æ­¤å¯¹è±¡çš„æ¨¡å¼å¯¹è±¡ã€‚ uiSchema:è¯¥å¯¹è±¡å­—æ®µçš„uiSchemaå¯¹è±¡ã€‚ idSchema:åŒ…å«æ­¤å¯¹è±¡çš„idå’Œå…¶å±æ€§çš„idçš„å¯¹è±¡ã€‚ formData:å¯¹è±¡çš„è¡¨å•æ•°æ®ã€‚ formContext:ä¼ é€’ç»™Formçš„formContextå¯¹è±¡ã€‚ ä»¥ä¸‹propsæ˜¯propertiesä¸­æ¯ä¸ªå…ƒç´ çš„ä¸€éƒ¨åˆ†: content:å±æ€§å†…å®¹çš„htmlã€‚ name:è¡¨ç¤ºå±æ€§åç§°çš„å­—ç¬¦ä¸²ã€‚ disabled:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¯¹è±¡å±æ€§æ˜¯å¦ç¦ç”¨ã€‚ readonly:ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦åªè¯»ã€‚ é”™è¯¯åˆ—è¡¨æ¨¡æ¿Idå‰ç¼€ä¸ºäº†é¿å…ä¸DOMä¸­ç°æœ‰çš„idå†²çªï¼Œå¯ä»¥æ›´æ”¹idsä½¿ç”¨çš„å‰ç¼€(é»˜è®¤æ˜¯root) 1234render(( &lt;Form schema=&#123;schema&#125; idPrefix=&#123;\"rjsf_prefix\"&#125;/&gt;,), document.getElementById(\"app\")); è¿™å°†å‘ˆç°&lt;input id=&quot;rjsf_prefix_key&quot;&gt;ï¼Œè€Œä¸æ˜¯&lt;input id=&quot;root_key&quot;&gt; è‡ªå®šä¹‰å°éƒ¨ä»¶å’Œå­—æ®µAPIå…è®¸æŒ‡å®šæ‚¨è‡ªå·±çš„è‡ªå®šä¹‰éƒ¨ä»¶å’Œå­—æ®µç»„ä»¶: å°éƒ¨ä»¶è¡¨ç¤ºç”¨æˆ·è¾“å…¥æ•°æ®çš„HTMLæ ‡è®°ï¼Œä¾‹å¦‚ã€‚inputã€selectç­‰ã€‚ ä¸€ä¸ªå­—æ®µé€šå¸¸å°è£…ä¸€ä¸ªæˆ–å¤šä¸ªéƒ¨ä»¶ï¼Œé€šå¸¸å¤„ç†å†…éƒ¨å­—æ®µçŠ¶æ€;å¯ä»¥å°†å­—æ®µçœ‹ä½œè¡¨å•è¡Œï¼ŒåŒ…æ‹¬æ ‡ç­¾ã€‚ è‡ªå®šä¹‰å°éƒ¨ä»¶ç»„ä»¶æ‚¨å¯ä»¥ä¸ºä»¥ä¸‹jsonæ•°æ®ç±»å‹å‘uiSchemaæä¾›æ‚¨è‡ªå·±çš„è‡ªå®šä¹‰å°éƒ¨ä»¶: string number integer boolean 1234567891011121314151617181920const schema = &#123; type: \"string\"&#125;;const uiSchema = &#123; \"ui:widget\": (props) =&gt; &#123; return ( &lt;input type=\"text\" className=\"custom\" value=&#123;props.value&#125; required=&#123;props.required&#125; onChange=&#123;(event) =&gt; props.onChange(event.target.value)&#125; /&gt; ); &#125;&#125;;render(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; /&gt;,), document.getElementById(\"app\")); ä»¥ä¸‹propsä¼ é€’ç»™è‡ªå®šä¹‰å°éƒ¨ä»¶ç»„ä»¶: id:è¯¥å­—æ®µç”Ÿæˆçš„id; schema:æ­¤å­—æ®µçš„JSONSchemaå­æ¨¡å¼å¯¹è±¡; value:è¯¥å­—æ®µçš„å½“å‰å€¼; required:è¯¥å­—æ®µçš„æ‰€éœ€çŠ¶æ€; disabled:å¦‚æœå°éƒ¨ä»¶è¢«ç¦ç”¨ï¼Œåˆ™ä¸ºtrue; readonly:å¦‚æœå°éƒ¨ä»¶æ˜¯åªè¯»çš„ï¼Œåˆ™ä¸ºtrue; onChange:å€¼æ›´æ”¹äº‹ä»¶å¤„ç†ç¨‹åº;æ¯æ¬¡å®ƒæ”¹å˜æ—¶ï¼Œç”¨æ–°å€¼è°ƒç”¨å®ƒ; onBlur:è¾“å…¥æ¨¡ç³Šäº‹ä»¶å¤„ç†ç¨‹åº;ä½¿ç”¨å°éƒ¨ä»¶idå’Œå€¼è°ƒç”¨å®ƒ; onFocus:è¾“å…¥ç„¦ç‚¹äº‹ä»¶å¤„ç†ç¨‹åº;ä½¿ç”¨å°éƒ¨ä»¶idå’Œå€¼è°ƒç”¨å®ƒ; options:ä½œä¸ºpropä¼ é€’åˆ°ç»„ä»¶çš„é€‰é¡¹çš„æ˜ å°„(è¯·å‚é˜…è‡ªå®šä¹‰å°éƒ¨ä»¶é€‰é¡¹)ã€‚ formContext:ä¼ é€’ç»™Formçš„formContextå¯¹è±¡ã€‚ æ³¨æ„:åœ¨v0.35.0ä¹‹å‰ï¼Œoptionsé“å…·åŒ…å«æšä¸¾å­—æ®µçš„é€‰é¡¹åˆ—è¡¨(æ ‡ç­¾å’Œå€¼)ã€‚ç”±äºv0.35.0ï¼Œå®ƒç°åœ¨å°†æ­¤åˆ—è¡¨ä½œä¸ºoptionså¯¹è±¡ä¸­çš„enumOptionså±æ€§å…¬å¼€ è‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œæˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å°éƒ¨ä»¶é“å…·ä¼ é€’ç»™è¡¨å•ç»„ä»¶æ¥ä¸€æ¬¡æ€§æ³¨å†Œå®ƒä»¬ï¼Œå¹¶ä»uiSchemaå¼•ç”¨å®ƒä»¬çš„æ ‡è¯†ç¬¦: 123456789101112131415161718192021222324const MyCustomWidget = (props) =&gt; &#123; return ( &lt;input type=\"text\" className=\"custom\" value=&#123;props.value&#125; required=&#123;props.required&#125; onChange=&#123;(event) =&gt; props.onChange(event.target.value)&#125; /&gt; );&#125;;const widgets = &#123; myCustomWidget: MyCustomWidget&#125;;const uiSchema = &#123; \"ui:widget\": \"myCustomWidget\"&#125;render(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; widgets=&#123;widgets&#125; /&gt;), document.getElementById(\"app\")); å¦‚æœæ‚¨å°†uiSchemaå…¬å¼€ä¸ºçº¯JSONï¼Œè¿™å°†éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºJSONä¸èƒ½æºå¸¦å‡½æ•°ã€‚ æ³¨æ„:åœ¨0.40.0ä¹‹å‰ï¼Œå¯ä»¥å°†å°éƒ¨ä»¶æ³¨å†Œä¸ºå¯¹è±¡ï¼Œå½¢çŠ¶{component: MyCustomWidget, options:{â€¦} }ã€‚è¿™ä¸ªæœªæ–‡æ¡£åŒ–çš„APIå·²ç»è¢«åˆ é™¤ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨React defaultPropså±æ€§æ³¨å†Œä¸€ä¸ªå®šåˆ¶å°éƒ¨ä»¶ã€‚defaultPropsã€‚é€‰é¡¹å¯ä»¥æ˜¯åŒ…å«è‡ªå®šä¹‰é€‰é¡¹çš„å¯¹è±¡ã€‚ è‡ªå®šä¹‰å°éƒ¨ä»¶é€‰é¡¹å¦‚æœéœ€è¦å°†é€‰é¡¹ä¼ é€’ç»™å®šåˆ¶å°éƒ¨ä»¶ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªåŒ…å«è¿™äº›å±æ€§çš„ui:optionså¯¹è±¡ã€‚å¦‚æœå°éƒ¨ä»¶æœ‰defaultPropsï¼Œè¿™äº›é€‰é¡¹å°†ä¸defaultPropsçš„(å¯é€‰)optionså¯¹è±¡åˆå¹¶: 12345678910111213141516171819202122232425262728const schema = &#123; type: \"string\"&#125;;function MyCustomWidget(props) &#123; const &#123;options&#125; = props; const &#123;color, backgroundColor&#125; = options; return &lt;input style=&#123;&#123;color, backgroundColor&#125;&#125; /&gt;;&#125;MyCustomWidget.defaultProps = &#123; options: &#123; color: \"red\" &#125;&#125;;const uiSchema = &#123; \"ui:widget\": MyCustomWidget, \"ui:options\": &#123; backgroundColor: \"yellow\" &#125;&#125;;// renders red on yellow inputrender(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; /&gt;), document.getElementById(\"app\")); å®šåˆ¶éƒ¨ä»¶æ–‡æœ¬è¾“å…¥æ‰€æœ‰å‘ˆç°æ–‡æœ¬è¾“å…¥çš„å°éƒ¨ä»¶éƒ½åœ¨å†…éƒ¨ä½¿ç”¨BaseInputç»„ä»¶ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰æ‰€æœ‰æ–‡æœ¬è¾“å…¥ï¼Œè€Œä¸éœ€è¦å•ç‹¬è‡ªå®šä¹‰æ‰€æœ‰å°éƒ¨ä»¶ï¼Œåˆ™å¯ä»¥åœ¨å°éƒ¨ä»¶å±æ€§çš„Formä¸­æä¾›ä¸€ä¸ªåŸºè¾“å…¥ç»„ä»¶(è¯·å‚è§è‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œ)ã€‚ è‡ªå®šä¹‰å­—æ®µç»„ä»¶é€šè¿‡æŒ‡å®šui:fieldå±æ€§ï¼Œæ‚¨å¯ä»¥ä¸ºuiSchemaæä¾›æ‚¨è‡ªå·±çš„å­—æ®µç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶åŸºæœ¬ä¸Šé€‚ç”¨äºä»»ä½•jsonæ¨¡å¼æ•°æ®ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ªå¤„ç†çº¬åº¦å’Œç»åº¦çš„geoç»„ä»¶: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950const schema = &#123; type: \"object\", required: [\"lat\", \"lon\"], properties: &#123; lat: &#123;type: \"number\"&#125;, lon: &#123;type: \"number\"&#125; &#125;&#125;;// Define a custom component for handling the root position objectclass GeoPosition extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123;...props.formData&#125;; &#125; onChange(name) &#123; return (event) =&gt; &#123; this.setState(&#123; [name]: parseFloat(event.target.value) &#125;, () =&gt; this.props.onChange(this.state)); &#125;; &#125; render() &#123; const &#123;lat, lon&#125; = this.state; return ( &lt;div&gt; &lt;input type=\"number\" value=&#123;lat&#125; onChange=&#123;this.onChange(\"lat\")&#125; /&gt; &lt;input type=\"number\" value=&#123;lon&#125; onChange=&#123;this.onChange(\"lon\")&#125; /&gt; &lt;/div&gt; ); &#125;&#125;// Define the custom field component to use for the root objectconst uiSchema = &#123;\"ui:field\": \"geo\"&#125;;// Define the custom field components to register; here our \"geo\"// custom field componentconst fields = &#123;geo: GeoPosition&#125;;// Render the form with all the properties we just defined passed// as propsrender(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; fields=&#123;fields&#125; /&gt;), document.getElementById(\"app\")); æ³¨æ„:æ³¨å†Œçš„å­—æ®µå¯ä»¥è·¨æ•´ä¸ªæ¨¡å¼é‡ç”¨ å­—æ®µ propså­—æ®µç»„ä»¶å°†å§‹ç»ˆä¼ é€’ä»¥ä¸‹props: schema:è¯¥å­—æ®µçš„JSONæ¨¡å¼; uiSchema:è¯¥é¢†åŸŸçš„uiSchema; idSchema:æ¯ä¸ªå­å­—æ®µçš„æƒŸä¸€idæ ‘; formData:è¯¥å­—æ®µçš„æ•°æ®; errorSchema:è¯¥å­—æ®µåŠå…¶å­å­—æ®µçš„é”™è¯¯æ ‘; registry:registryå¯¹è±¡(æ¥ä¸‹æ¥è¯»å–) formContext: formContextå¯¹è±¡(ä¸‹ä¸€ä¸ªè¯») registryå¯¹è±¡registryæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ³¨å†Œçš„è‡ªå®šä¹‰å­—æ®µå’Œå°éƒ¨ä»¶ä»¥åŠæ ¹æ¨¡å¼å®šä¹‰ã€‚ fields:è‡ªå®šä¹‰æ³¨å†Œå­—æ®µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å¯¹è±¡åŒ…å«æ ‡å‡†çš„schemfieldsã€TitleFieldå’ŒDescriptionFieldç»„ä»¶; widgets:è‡ªå®šä¹‰æ³¨å†Œå°éƒ¨ä»¶(å¦‚æœæœ‰); definitions:æ ¹æ¨¡å¼å®šä¹‰(å¦‚æœæœ‰çš„è¯) formContext: formContextå¯¹è±¡ã€‚ registryæ˜¯å‘ä¸‹ä¼ é€’åˆ°ç»„ä»¶æ ‘çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥ä»è‡ªå®šä¹‰å­—æ®µå’ŒSchemaFieldç»„ä»¶è®¿é—®å®ƒã€‚ formContextå¯¹è±¡æ‚¨å¯ä»¥ä¸ºè¡¨å•æä¾›ä¸€ä¸ªformContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼ é€’ç»™æ‰€æœ‰å­—æ®µå’Œå°éƒ¨ä»¶(åŒ…æ‹¬TitleFieldå’ŒDescriptionField)ã€‚ç”¨äºå®ç°ä¸Šä¸‹æ–‡æ„ŸçŸ¥å­—æ®µå’Œå°éƒ¨ä»¶ã€‚ è‡ªå®šä¹‰æ•°ç»„å­—æ®µæŒ‰é’®ArrayFieldç»„ä»¶æä¾›äº†ä¸€ä¸ªç”¨äºæ·»åŠ ã€åˆ é™¤å’Œé‡æ–°æ’åºæ•°ç»„é¡¹çš„UIï¼Œè¿™äº›æŒ‰é’®ä½¿ç”¨Bootstrap glyphiconsã€‚å¦‚æœæ‚¨ä¸ä½¿ç”¨ç¬¦å·å›¾æ ‡ï¼Œä½†ä»ç„¶å¸Œæœ›ä¸ºè¿™äº›æŒ‰é’®æä¾›è‡ªå·±çš„å›¾æ ‡æˆ–æ–‡æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨CSSè½»æ¾åœ°åšåˆ°è¿™ä¸€ç‚¹: 12345i.glyphicon &#123; display: none; &#125;.btn-add::after &#123; content: &apos;Add&apos;; &#125;.array-item-move-up::after &#123; content: &apos;Move Up&apos;; &#125;.array-item-move-down::after &#123; content: &apos;Move Down&apos;; &#125;.array-item-remove::after &#123; content: &apos;Remove&apos;; &#125; è‡ªå®šä¹‰SchemaFieldè­¦å‘Š:è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå› ä¸ºæ‚¨å¯ä»¥è¦†ç›–æ•´ä¸ªè¡¨å•è¡Œä¸ºï¼Œå¹¶å¾ˆå®¹æ˜“å°†å…¶æä¹±ã€‚å°å¿ƒè½»æ”¾ã€‚ æ‚¨å¯ä»¥æä¾›è‡ªå·±çš„SchemaField base Reactç»„ä»¶å®ç°ï¼Œç”¨äºå‘ˆç°ä»»ä½•JSONSchemaå­—æ®µç±»å‹ï¼ŒåŒ…æ‹¬å¯¹è±¡å’Œæ•°ç»„ã€‚å½“æ‚¨å¸Œæœ›ç”¨è¡¥å……å¹‚æ¥æ‰©å……ç»™å®šå­—æ®µç±»å‹æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚ è¦è¿›è¡Œæ­¤æ“ä½œï¼Œè¯·å°†å…·æœ‰SchemaFieldå±æ€§çš„fieldså¯¹è±¡ä¼ é€’ç»™Formç»„ä»¶;ä¸‹é¢æ˜¯åŒ…è£…æ ‡å‡†SchemaField libç»„ä»¶çš„ä¸€ä¸ªç›¸å½“æ„šè ¢çš„ç¤ºä¾‹: 123456789101112131415161718192021import SchemaField from \"react-jsonschema-form/lib/components/fields/SchemaField\";const CustomSchemaField = function(props) &#123; return ( &lt;div id=\"custom\"&gt; &lt;p&gt;Yeah, I'm pretty dumb.&lt;/p&gt; &lt;SchemaField &#123;...props&#125; /&gt; &lt;/div&gt; );&#125;;const fields = &#123; SchemaField: CustomSchemaField&#125;;render(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; formData=&#123;formData&#125; fields=&#123;fields&#125; /&gt;), document.getElementById(\"app\")); å¦‚æœæ‚¨æƒ³çŸ¥é“è¿™æ˜¯å¦‚ä½•æœ‰ç”¨çš„ï¼Œè¯·æŸ¥çœ‹Kinto formbuilderå­˜å‚¨åº“ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨å®ƒä¸ºä»»ä½•è¡¨å•å­—æ®µæä¾›ç¼–è¾‘åŠŸèƒ½ã€‚ ä¼ é€’ç»™å®šåˆ¶æ¨¡å¼çš„é“å…·ä¸ä¼ é€’ç»™å®šåˆ¶å­—æ®µçš„propsæ˜¯ç›¸åŒçš„ã€‚ è‡ªå®šä¹‰é»˜è®¤å­—æ®µå’Œå°éƒ¨ä»¶æ‚¨å¯ä»¥è¦†ç›–ä»»ä½•é»˜è®¤å­—æ®µå’Œå°éƒ¨ä»¶ï¼ŒåŒ…æ‹¬å†…éƒ¨å°éƒ¨ä»¶ï¼Œå¦‚ObjectFieldä¸ºå¸ƒå°”å€¼å‘ˆç°çš„CheckboxWidgetã€‚æ‚¨å¯ä»¥è¦†ç›–ä»»ä½•å­—æ®µå’Œå°éƒ¨ä»¶ï¼Œåªè¦åœ¨å­—æ®µå’Œå°éƒ¨ä»¶é“å…·ä¸­æä¾›å®šåˆ¶çš„å­—æ®µ/å°éƒ¨ä»¶: 123456789101112131415161718const CustomCheckbox = function(props) &#123; return ( &lt;button id=\"custom\" className=&#123;props.value ? \"checked\" : \"unchecked\"&#125; onClick=&#123;() =&gt; props.onChange(!props.value)&#125;&gt; &#123;props.value&#125; &lt;/button&gt; );&#125;;const widgets = &#123; CheckboxWidget: CustomCheckbox&#125;;render(( &lt;Form schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; formData=&#123;formData&#125; widgets=&#123;widgets&#125; /&gt;), document.getElementById(\"app\")); è¿™å…è®¸æ‚¨ä½¿ç”¨è‡ªå®šä¹‰å­—æ®µå’Œå°éƒ¨ä»¶åˆ›å»ºå¯é‡ç”¨çš„è‡ªå®šä¹‰è¡¨å•ç±»: 123456789101112const customFields = &#123;StringField: CustomString&#125;;const customWidgets = &#123;CheckboxWidget: CustomCheckbox&#125;;function MyForm(props) &#123; return &lt;Form fields=&#123;customFields&#125; widgets=&#123;customWidgets&#125; &#123;...props&#125; /&gt;;&#125;render(( &lt;MyForm schema=&#123;schema&#125; uiSchema=&#123;uiSchema&#125; formData=&#123;formData&#125; /&gt;), document.getElementById(\"app\")); è‡ªå®šä¹‰æ ‡é¢˜è‡ªå®šä¹‰æè¿°è¡¨å•æ•°æ®éªŒè¯è¡¨å•æ ·å¼æ¨¡å¼å®šä¹‰å’Œå¼•ç”¨å±æ€§ä¾èµ–æ€§æ¨¡å¼çš„ä¾èµ–å…³ç³»è¿™ä¸ªåº“è¿˜æ”¯æŒåŸºäºè¡¨å•æ•°æ®ä¿®æ”¹æ¨¡å¼çš„æŸäº›éƒ¨åˆ†ã€‚ æ¡ä»¶åŠ¨æ€JSONæ¨¡å¼æ”¯æŒçŠ¶æ€è¯¥ç»„ä»¶éµå¾ªJSONæ¨¡å¼è§„èŒƒã€‚ç”±äºçª—ä½“å°éƒ¨ä»¶çš„å±€é™æ€§ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªä¾‹å¤–: æç¤ºå’ŒæŠ€å·§è´¡çŒ®","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"React/ç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/React/ç¬¬ä¸‰æ–¹åº“/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"}]},{"title":"JavaScript[å†´ç¾½çš„åšå®¢]","slug":"mqyqingfeng-blog","date":"2018-12-06T05:09:27.000Z","updated":"2020-07-25T02:57:18.215Z","comments":true,"path":"2018/12/06/mqyqingfeng-blog/","link":"","permalink":"https://jigangduan.github.io/2018/12/06/mqyqingfeng-blog/","excerpt":"","text":"åŸä½œè€…å‘å¸ƒåœ°å€: github ä¸“æ  æ˜é‡‘ä¸»é¡µ segmentfaultä¸»é¡µ æ–°å¼€äº† çŸ¥ä¹ä¸“æ ï¼Œæ¬¢è¿å…³æ³¨ æ·±å…¥ç³»åˆ—ç›®å½• JavaScirptæ·±å…¥ä¹‹ä»åŸå‹åˆ°åŸå‹é“¾ JavaScriptæ·±å…¥ä¹‹è¯æ³•ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸ JavaScriptæ·±å…¥ä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ JavaScriptæ·±å…¥ä¹‹å˜é‡å¯¹è±¡ JavaScriptæ·±å…¥ä¹‹ä½œç”¨åŸŸé“¾ JavaScriptæ·±å…¥ä¹‹ä»ECMAScriptè§„èŒƒè§£è¯»this JavaScriptæ·±å…¥ä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡ JavaScriptæ·±å…¥ä¹‹é—­åŒ… JavaScriptæ·±å…¥ä¹‹å‚æ•°æŒ‰å€¼ä¼ é€’ JavaScriptæ·±å…¥ä¹‹callå’Œapplyçš„æ¨¡æ‹Ÿå®ç° JavaScriptæ·±å…¥ä¹‹bindçš„æ¨¡æ‹Ÿå®ç° JavaScriptæ·±å…¥ä¹‹newçš„æ¨¡æ‹Ÿå®ç° JavaScriptæ·±å…¥ä¹‹ç±»æ•°ç»„å¯¹è±¡ä¸arguments JavaScriptæ·±å…¥ä¹‹åˆ›å»ºå¯¹è±¡çš„å¤šç§æ–¹å¼ä»¥åŠä¼˜ç¼ºç‚¹ JavaScriptæ·±å…¥ä¹‹ç»§æ‰¿çš„å¤šç§æ–¹å¼ä»¥åŠä¼˜ç¼ºç‚¹ JavaScriptæ·±å…¥ç³»åˆ—15ç¯‡æ­£å¼å®Œç»“ï¼ ä¸“é¢˜ç³»åˆ—ç›®å½• JavaScriptä¸“é¢˜ä¹‹è·Ÿç€underscoreå­¦é˜²æŠ– JavaScriptä¸“é¢˜ä¹‹è·Ÿç€underscoreå­¦èŠ‚æµ JavaScriptä¸“é¢˜ä¹‹æ•°ç»„å»é‡ JavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸Š) JavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸‹) JavaScriptä¸“é¢˜ä¹‹æ·±æµ…æ‹·è´ JavaScriptä¸“é¢˜ä¹‹ä»é›¶å®ç°jQueryçš„extend JavaScriptä¸“é¢˜ä¹‹å¦‚ä½•æ±‚æ•°ç»„çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ JavaScriptä¸“é¢˜ä¹‹æ•°ç»„æ‰å¹³åŒ– JavaScriptä¸“é¢˜ä¹‹å­¦underscoreåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´  JavaScriptä¸“é¢˜ä¹‹jQueryé€šç”¨éå†æ–¹æ³•eachçš„å®ç° JavaScriptä¸“é¢˜ä¹‹å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ JavaScriptä¸“é¢˜ä¹‹å‡½æ•°æŸ¯é‡ŒåŒ– JavaScriptä¸“é¢˜ä¹‹åå‡½æ•° JavaScriptä¸“é¢˜ä¹‹æƒ°æ€§å‡½æ•° JavaScriptä¸“é¢˜ä¹‹å‡½æ•°ç»„åˆ JavaScriptä¸“é¢˜ä¹‹å‡½æ•°è®°å¿† JavaScriptä¸“é¢˜ä¹‹é€’å½’ JavaScriptä¸“é¢˜ä¹‹ä¹±åº JavaScriptä¸“é¢˜ä¹‹è§£è¯» v8 æ’åºæºç  JavaScriptä¸“é¢˜ç³»åˆ—20ç¯‡æ­£å¼å®Œç»“ï¼ underscore ç³»åˆ—ç›®å½• underscore ç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„ underscore underscore ç³»åˆ—ä¹‹é“¾å¼è°ƒç”¨ underscore ç³»åˆ—ä¹‹å†…éƒ¨å‡½æ•° cb å’Œ optimizeCb underscore ç³»åˆ—ä¹‹å†…éƒ¨å‡½æ•° restArgs underscore ç³»åˆ—ä¹‹é˜²å†²çªä¸ Utility Functions underscore ç³»åˆ—ä¹‹å®ç°ä¸€ä¸ªæ¨¡æ¿å¼•æ“(ä¸Š) underscore ç³»åˆ—ä¹‹å®ç°ä¸€ä¸ªæ¨¡æ¿å¼•æ“(ä¸‹) underscore ç³»åˆ—ä¹‹å­—ç¬¦å®ä½“ä¸ _.escape underscore çš„æºç è¯¥å¦‚ä½•é˜…è¯»ï¼Ÿ ES6 ç³»åˆ—ç›®å½• ES6 ç³»åˆ—ä¹‹ let å’Œ const ES6 ç³»åˆ—ä¹‹æ¨¡æ¿å­—ç¬¦ä¸² ES6 ç³»åˆ—ä¹‹ç®­å¤´å‡½æ•° ES6 ç³»åˆ—ä¹‹æ¨¡æ‹Ÿå®ç° Symbol ç±»å‹ ES6 ç³»åˆ—ä¹‹è¿­ä»£å™¨ä¸ for of ES6 ç³»åˆ—ä¹‹æ¨¡æ‹Ÿå®ç°ä¸€ä¸ª Set æ•°æ®ç»“æ„ ES6 ç³»åˆ—ä¹‹ WeakMap ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠ Promise ES6 ç³»åˆ—ä¹‹ Generator çš„è‡ªåŠ¨æ‰§è¡Œ ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠ Async ES6 ç³»åˆ—ä¹‹å¼‚æ­¥å¤„ç†å®æˆ˜ ES6 ç³»åˆ—ä¹‹ Babel å°† Generator ç¼–è¯‘æˆäº†ä»€ä¹ˆæ ·å­ ES6 ç³»åˆ—ä¹‹ Babel å°† Async ç¼–è¯‘æˆäº†ä»€ä¹ˆæ ·å­ ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸Š) ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸‹) ES6 ç³»åˆ—ä¹‹ defineProperty ä¸ proxy ES6 ç³»åˆ—ä¹‹æ¨¡å—åŠ è½½æ–¹æ¡ˆ ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠè£…é¥°å™¨ ES6 ç³»åˆ—ä¹‹ç§æœ‰å˜é‡çš„å®ç° ES6 å®Œå…¨ä½¿ç”¨æ‰‹å†Œ å‹æƒ…é“¾æ¥ å¦‚ä½•è½»æ¾æ‹¿åˆ°æ·˜å®å‰ç«¯ offer æ³¨æ„æ·±å…¥ç³»åˆ—æ–‡ç« éƒ¨åˆ†æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼ŒæŒ‰ç…§ç›®å½•ç»“æ„é¡ºåºé˜…è¯»æ•ˆæœæœ€å¥½ã€‚ å‹˜è¯¯åŠæé—®å¦‚æœæœ‰ç–‘é—®æˆ–è€…å‘ç°é”™è¯¯ï¼Œå¯ä»¥åœ¨ç›¸åº”çš„ issues è¿›è¡Œæé—®æˆ–å‹˜è¯¯ã€‚ å¦‚æœå–œæ¬¢æˆ–è€…æœ‰æ‰€å¯å‘ï¼Œæ¬¢è¿ç»™åŸä½œè€… starã€‚ Licenseæ‰€æœ‰æ–‡ç« é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 3.0 ä¸­å›½å¤§é™†è®¸å¯åè®®è¿›è¡Œè®¸å¯ã€‚","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"GitHubç²¾é€‰","slug":"å‰ç«¯/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/GitHubç²¾é€‰/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"github","slug":"github","permalink":"https://jigangduan.github.io/tags/github/"},{"name":"blog","slug":"blog","permalink":"https://jigangduan.github.io/tags/blog/"}]},{"title":"Minio - ç§æœ‰äº‘å­˜å‚¨","slug":"minio","date":"2018-12-03T03:01:43.000Z","updated":"2020-07-25T02:57:18.215Z","comments":true,"path":"2018/12/03/minio/","link":"","permalink":"https://jigangduan.github.io/2018/12/03/minio/","excerpt":"","text":"Minioæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ï¼Œä¸“ä¸ºå…¶è®¾è®¡å¤§å‹ç§æœ‰äº‘åŸºç¡€è®¾æ–½ã€‚Minioè¢«å¹¿æ³›éƒ¨ç½²åœ¨ç¾å›½ä¸–ç•Œä¸Šæœ‰è¶…è¿‡166.1M+çš„dockeræ‹‰å–ã€‚ Minioæ˜¯ä¸€ä¸ªå¼€æºçš„å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ï¼Œä¸Amazon S3 apiå…¼å®¹:https://minio.io/downloads.html#downlâ€¦ Minioæ˜¯Apache License v2.0ä¸‹å‘å¸ƒçš„å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ã€‚å®ƒä¸Amazon S3äº‘å­˜å‚¨æœåŠ¡å…¼å®¹ã€‚å®ƒæœ€é€‚åˆå­˜å‚¨éç»“æ„åŒ–æ•°æ®ï¼Œå¦‚ç…§ç‰‡ã€è§†é¢‘ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½å’Œå®¹å™¨/ VMæ˜ åƒã€‚å¯¹è±¡çš„å¤§å°ä»å‡ ä¸ªKBsåˆ°æœ€å¤§5TBä¸ç­‰ã€‚ MinioæœåŠ¡å™¨è¶³å¤Ÿè½»ï¼Œå¯ä»¥ä¸åº”ç”¨ç¨‹åºæ ˆç»‘å®šï¼Œç±»ä¼¼äºNodeJSã€Rediså’ŒMySQLã€‚ å°è¯•ä½¿ç”¨Minio BrowserMinioæœåŠ¡å™¨è‡ªå¸¦ä¸€ä¸ªåµŒå…¥å¼çš„åŸºäºwebçš„å¯¹è±¡æµè§ˆå™¨ã€‚å°†webæµè§ˆå™¨æŒ‡å‘http://127.0.0.1:9000ï¼Œç¡®ä¿æœåŠ¡å™¨å·²ç»æˆåŠŸå¯åŠ¨ã€‚ å°è¯•ä½¿ç”¨Minioå®¢æˆ·ç«¯mcmcæä¾›äº†UNIXå‘½ä»¤(å¦‚lsã€catã€cpã€mirrorã€diffç­‰)çš„ç°ä»£æ›¿ä»£å“ã€‚å®ƒæ”¯æŒæ–‡ä»¶ç³»ç»Ÿå’ŒAmazon S3å…¼å®¹çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æŒ‰ç…§Minioå®¢æˆ·ç«¯å¿«é€Ÿå…¥é—¨æŒ‡å—è¿›è¡Œè¿›ä¸€æ­¥çš„æŒ‡å¯¼ã€‚ å·²æœ‰çš„æ•°æ®å½“éƒ¨ç½²åœ¨å•ä¸ªé©±åŠ¨å™¨ä¸Šæ—¶ï¼ŒMinioæœåŠ¡å™¨å…è®¸å®¢æˆ·æœºè®¿é—®æ•°æ®ç›®å½•ä¸­ä»»ä½•å·²å­˜åœ¨çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨å‘½ä»¤Minio server /mnt/dataå¯åŠ¨Minioï¼Œåˆ™å®¢æˆ·ç«¯å¯ä»¥è®¿é—®/mnt/dataç›®å½•ä¸­çš„ä»»ä½•é¢„å…ˆå­˜åœ¨çš„æ•°æ®ã€‚ ä¸Šè¿°è¯­å¥ä¹Ÿé€‚ç”¨äºæ‰€æœ‰ç½‘å…³åç«¯ã€‚ è¿›ä¸€æ­¥æ¢ç´¢ Minio Erasure Codeå¿«é€Ÿå…¥é—¨æŒ‡å— å¯¹MinioæœåŠ¡å™¨ä½¿ç”¨mc å¯¹MinioæœåŠ¡å™¨ä½¿ç”¨aws-cli å¯¹MinioæœåŠ¡å™¨ä½¿ç”¨s3cmd å¯¹MinioæœåŠ¡å™¨ä½¿ç”¨Minio-go SDK Minioæ–‡æ¡£ç½‘ç«™","categories":[{"name":"GitHubç²¾é€‰","slug":"GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/GitHubç²¾é€‰/"}],"tags":[{"name":"oos","slug":"oos","permalink":"https://jigangduan.github.io/tags/oos/"},{"name":"minio","slug":"minio","permalink":"https://jigangduan.github.io/tags/minio/"}]},{"title":"æ•°æ®äºŒåˆ†æ³•ï¼šé‡æ–°æ€è€ƒæˆ‘ä»¬å¯¹å¾…æ•°æ®å’ŒæœåŠ¡çš„æ–¹å¼","slug":"data-dichotomy-rethinking-the-way-we-treat-data-and-services","date":"2018-11-30T13:39:59.000Z","updated":"2020-07-25T02:57:18.197Z","comments":true,"path":"2018/11/30/data-dichotomy-rethinking-the-way-we-treat-data-and-services/","link":"","permalink":"https://jigangduan.github.io/2018/11/30/data-dichotomy-rethinking-the-way-we-treat-data-and-services/","excerpt":"","text":"å¦‚æœä½ å¶ç„¶å‘ç°æ•´ä¸ªå¾®æœåŠ¡çš„äº‹æƒ…ï¼Œæ²¡æœ‰ä»»ä½•å…ˆå‰çš„èƒŒæ™¯ï¼Œä½ ä¼šè®¤ä¸ºå®ƒæœ‰ç‚¹å¥‡æ€ªã€‚å°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºç”±ç½‘ç»œåˆ†éš”çš„ç‰‡æ®µï¼Œä¸å¯é¿å…åœ°æ„å‘³ç€æ³¨å…¥åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤æ‚æ•…éšœæ¨¡å¼ã€‚ ç„¶è€Œï¼Œè™½ç„¶è¯¥æ–¹æ³•è‚¯å®šæ¶‰åŠè®¸å¤šç‹¬ç«‹æœåŠ¡ï¼Œä½†ç›®æ ‡æ¯”ä»…ä»…åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œå®ƒä»¬æ›´å¹¿æ³›ã€‚å®ƒæ˜¯å…³äºé¢å¯¹ä¸€ä¸ªæœ¬èº«å°±æ˜¯å›ºæœ‰åˆ†å¸ƒçš„ä¸–ç•Œã€‚ä¸æ˜¯åœ¨æŸç§ç‹­éš˜çš„æŠ€æœ¯æ„ä¹‰ä¸Šï¼Œè€Œæ˜¯ç”±è®¸å¤šäººï¼Œè®¸å¤šå›¢é˜Ÿå’Œè®¸å¤šç¨‹åºç»„æˆçš„å¹¿æ³›çš„ç”Ÿæ€ç³»ç»Ÿï¼Œæ‰€æœ‰è¿™äº›éƒ½éœ€è¦åœ¨æŸç§ç¨‹åº¦ä¸Šåšè‡ªå·±çš„äº‹æƒ…ã€‚ ä¾‹å¦‚ï¼Œå…¬å¸æ˜¯ä¸åŒç³»ç»Ÿçš„é›†åˆï¼Œè¿™äº›ç³»ç»Ÿå…±åŒè¿›ä¸€æ­¥ä¿ƒè¿›äº†ä¸€äº›å…±åŒç›®æ ‡ã€‚å‡ åå¹´æ¥ï¼Œæˆ‘ä»¬åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¿½ç•¥äº†è¿™ä¸€äº‹å®ï¼Œå°†å®ƒä»¬ä¸FTPæ–‡ä»¶ä¼ è¾“æˆ–ä¼ä¸šé›†æˆå·¥å…·ä¸€èµ·ä¿®è¡¥ï¼ŒåŒæ—¶ä¸“æ³¨äºæˆ‘ä»¬è‡ªå·±çš„ä¸€äº›å­¤ç«‹ä¸»ä¹‰ç›®æ ‡ã€‚ä½†æœåŠ¡æ”¹å˜äº†è¿™ä¸€ç‚¹ã€‚ä»–ä»¬å°†æˆ‘ä»¬çš„å¤´æŠ¬é«˜åˆ°æ æ†ä¹‹ä¸Šï¼Œè¿›å…¥ä¸€ä¸ªåä½œçš„ï¼Œç›¸äº’ä¾å­˜çš„è®¡åˆ’ä¸–ç•Œã€‚ä½†è¦æƒ³åœ¨è¿™æ–¹é¢å–å¾—æˆåŠŸï¼Œæˆ‘ä»¬å¿…é¡»è®¤è¯†å¹¶è®¾è®¡ä¸¤ä¸ªæ ¹æœ¬ä¸åŒçš„ä¸–ç•Œï¼šå¤–éƒ¨ä¸–ç•Œï¼Œæˆ‘ä»¬ç”Ÿæ´»åœ¨è®¸å¤šå…¶ä»–æœåŠ¡çš„ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œä»¥åŠæˆ‘ä»¬ç§äººçš„å†…éƒ¨ä¸–ç•Œï¼Œæˆ‘ä»¬ç‹¬è‡ªç»Ÿæ²»å›½ç‹ã€‚ ä½†æ˜¯è¿™ä¸ªåˆ†å¸ƒå¼çš„ä¸–ç•Œä¸æˆ‘ä»¬é•¿å¤§çš„ä¸–ç•Œç•¥æœ‰ä¸åŒã€‚ä¼ ç»Ÿçš„å•ç‰‡è½¯ä»¶å·¥ç¨‹è§„åˆ™ä¸å†ä»¥åŒæ ·çš„æ–¹å¼å­˜åœ¨æ°´ã€‚å› æ­¤ï¼Œæ­£ç¡®ä½¿ç”¨è¿™æ ·çš„ç³»ç»Ÿä¸ä»…ä»…æ˜¯åœ¨ç™½æ¿ä¸Šç»˜åˆ¶ä¸€ä¸ªå¾ˆé…·çš„è‰å›¾æˆ–è€…æ˜¯ä¸€ä¸ªæ€§æ„Ÿçš„æ¦‚å¿µè¯æ˜ã€‚è¿™æ˜¯ä¸ºäº†è®©è¿™äº›ä¸œè¥¿éšç€æ—¶é—´çš„æ¨ç§»æˆåŠŸè¿ä½œã€‚å¹¸è¿çš„æ˜¯ï¼ŒæœåŠ¡å·²ç»å­˜åœ¨äº†å¾ˆé•¿æ—¶é—´ï¼Œå°½ç®¡æœ‰å‡ ç§ä¸åŒçš„å½¢å¼ã€‚è™½ç„¶æœ€è¿‘æœ‰Dockerï¼ŒKuberneteså’Œä¸€äº›ç¨å¾®è¿‡åº¦ç¬¨æ‹™çš„èƒ¡é¡»ï¼Œä½†SOAçš„æ•™è®­ä»ç„¶å­˜åœ¨ã€‚ æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°†çœ‹çœ‹è§„åˆ™æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥é‡æ–°æ€è€ƒæˆ‘ä»¬çš„æœåŠ¡æ–¹æ³•å’Œå®ƒä»¬å…±äº«çš„æ•°æ®ï¼Œä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸åŒçš„å·¥å…·é›†æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ å°è£…å¹¶ä¸æ€»æ˜¯ä½ çš„æœ‹å‹å¾®æœåŠ¡å¯ç‹¬ç«‹éƒ¨ç½²ã€‚æ­£æ˜¯è¿™ä¸ªå±æ€§æ¯”ä»»ä½•å…¶ä»–å±æ€§æ›´èƒ½èµ‹äºˆå®ƒä»¬ä»·å€¼ã€‚å®ƒå…è®¸ä»–ä»¬æ‰©å±•ã€‚æˆé•¿ã€‚åœ¨æ‰©å±•åˆ°æ•°ä»¥ä¸‡è®¡çš„ç”¨æˆ·æˆ–æ•°PBçš„æ•°æ®æ„ä¹‰ä¸Šï¼ˆå°½ç®¡ä»–ä»¬å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨äººå‘˜æ–¹é¢è¿›è¡Œæ‰©å±•ï¼Œéšç€æ‚¨çš„å›¢é˜Ÿå’Œç»„ç»‡çš„å‘å±•ã€‚ ä½†ç‹¬ç«‹æœ¬èº«å°±æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚è¿™æ„å‘³ç€æœåŠ¡å¯ä»¥å¿«é€Ÿè‡ªç”±åœ°è¿­ä»£ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæœåŠ¡å®ç°äº†éœ€è¦æ›´æ”¹å…¶ä»–æœåŠ¡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æœ€ç»ˆå¿…é¡»åœ¨åŒä¸€æ—¶é—´å¯¹è¿™ä¸¤ä¸ªæœåŠ¡è¿›è¡Œæ›´æ”¹ã€‚è™½ç„¶è¿™åœ¨å•ç‰‡åº”ç”¨ç¨‹åºä¸­å¾ˆå®¹æ˜“ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°è¿›è¡Œæ›´æ”¹å¹¶æ‰§è¡Œå‘å¸ƒï¼Œä½†åœ¨ç‹¬ç«‹æœåŠ¡å¿…é¡»åŒæ­¥çš„æƒ…å†µä¸‹å´æ›´åŠ ç—›è‹¦ã€‚å›¢é˜Ÿå’Œå‘å¸ƒå‘¨æœŸä¹‹é—´çš„åè°ƒä¼šå‰Šå¼±æ•æ·æ€§ã€‚ å…¸å‹çš„æ–¹æ³•æ˜¯é€šè¿‡å¹²å‡€åœ°åˆ†ç¦»æœåŠ¡ä¹‹é—´çš„èŒè´£æ¥ç®€å•åœ°é¿å…è¿™ç§è®¨åŒçš„æ¨ªåˆ‡å˜åŒ–ã€‚å•ç‚¹ç™»å½•æœåŠ¡å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚å®ƒå…·æœ‰æ˜ç¡®å®šä¹‰çš„è§’è‰²ï¼Œå¯ä»¥ä¸å…¶ä»–æœåŠ¡æ‰€æ‰®æ¼”çš„è§’è‰²å®Œå…¨åˆ†å¼€ã€‚è¿™ç§æ¸…æ™°çš„åˆ†ç¦»æ„å‘³ç€ï¼Œå³ä½¿é¢å¯¹å‘¨å›´æœåŠ¡çš„å¿«é€Ÿéœ€æ±‚æµå¤±ï¼ŒSSOæœåŠ¡ä¹Ÿä¸å¤ªå¯èƒ½éœ€è¦æ”¹å˜ã€‚å®ƒå­˜åœ¨äºä¸€ä¸ªç´§å¯†æœ‰ç•Œçš„ç¯å¢ƒä¸­ã€‚ é—®é¢˜åœ¨äºï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå•†ä¸šæœåŠ¡é€šå¸¸ä¸èƒ½ä¿æŒç›¸åŒï¼Œæ¸…æ™°ï¼Œåˆ†ç¦»çš„å…³æ³¨ç‚¹ã€‚ä¾‹å¦‚ï¼Œå•†ä¸šæœåŠ¡ä¸å¯é¿å…åœ°æ›´å¤šåœ°ä¾èµ–å½¼æ­¤çš„æ•°æ®ã€‚å¦‚æœæ‚¨æ˜¯åœ¨çº¿é›¶å”®å•†ï¼Œè®¢å•æµï¼Œäº§å“ç›®å½•æˆ–å®¢æˆ·ä¿¡æ¯å¯èƒ½ä¼šå‘ç°å®ƒå¯ä»¥æ»¡è¶³æ‚¨çš„è®¸å¤šæœåŠ¡éœ€æ±‚ã€‚è¿™äº›æœåŠ¡ä¸­çš„æ¯ä¸€é¡¹éƒ½éœ€è¦å¹¿æ³›è®¿é—®è¿™äº›æ•°æ®é›†æ‰èƒ½å®Œæˆå·¥ä½œã€‚ å¤§å¤šæ•°å•†ä¸šæœåŠ¡å…±äº«ç›¸åŒçš„äº‹å®æµã€‚è¿™ä½¿å¾—ä»–ä»¬çš„æœªæ¥ä¸å¯é¿å…åœ°äº¤ç»‡åœ¨ä¸€èµ·ã€‚ æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é‡ç‚¹ï¼Œè™½ç„¶æœåŠ¡å¯¹äºåŸºç¡€è®¾æ–½ç»„ä»¶å¾ˆæœ‰æ•ˆï¼Œè€Œè¿™äº›ç»„ä»¶çš„ç”Ÿæ´»å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å­¤ç«‹çš„ï¼Œä½†å¤§å¤šæ•°å•†ä¸šæœåŠ¡çš„æœªæ¥éƒ½ç´§å¯†åœ°äº¤ç»‡åœ¨ä¸€èµ·ã€‚ æ•°æ®äºŒåˆ†æ³•åŸºäºæœåŠ¡çš„æ–¹æ³•å¯èƒ½å·²å­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œä½†å®ƒä»¬ä»ç„¶å¯¹å¦‚ä½•åœ¨æœåŠ¡ä¹‹é—´å…±äº«é‡è¦æ•°æ®é›†æä¾›ç›¸å¯¹è¾ƒå°‘çš„è§è§£ã€‚ æ½œåœ¨çš„é—®é¢˜æ˜¯æ•°æ®å’ŒæœåŠ¡ä¸èƒ½å¤ªèåˆåœ¨ä¸€èµ·ã€‚ä¸€æ–¹é¢ï¼Œå°è£…é¼“åŠ±æˆ‘ä»¬éšè—æ•°æ®; å°†æœåŠ¡å½¼æ­¤åˆ†ç¦»ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥ç»§ç»­æ”¹å˜å’Œå‘å±•ã€‚è¿™æ˜¯å…³äºæœªæ¥çš„è§„åˆ’ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦åƒä»»ä½•å…¶ä»–æ•°æ®é›†ä¸€æ ·è‡ªç”±åˆ‡å‰²å’Œåˆ‡å‰²å…±äº«æ•°æ®ã€‚è¿™æ˜¯å…³äºæˆ‘ä»¬ç°åœ¨çš„å·¥ä½œï¼Œä¸å…¶ä»–ä»»ä½•æ•°æ®ç³»ç»Ÿå…·æœ‰ç›¸åŒçš„è‡ªç”±ã€‚ ä½†æ•°æ®ç³»ç»Ÿä¸å°è£…å‡ ä¹æ²¡æœ‰å…³ç³»ã€‚äº‹å®ä¸Šï¼Œæ°æ°ç›¸åã€‚æ•°æ®åº“å°½å…¶æ‰€èƒ½æ¥å…¬å¼€å®ƒä»¬æ‰€æ‹¥æœ‰çš„æ•°æ®ã€‚å®ƒä»¬å…·æœ‰éå¸¸å¼ºå¤§çš„å£°æ˜æ€§ç•Œé¢ï¼Œå¯ä»¥å°†æ•°æ®æ‰­æ›²æˆæ‚¨å¯èƒ½æƒ³è¦çš„ä»»ä½•å½¢çŠ¶ã€‚æ­£æ˜¯ä½ éœ€è¦è¿›è¡Œæ¢ç´¢æ€§è°ƒæŸ¥ï¼Œä½†å¯¹äºç®¡ç†æ–°å…´æœåŠ¡åŒºçš„å¤æ‚æ€§å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½ã€‚ æ‰€ä»¥æˆ‘ä»¬å‘ç°è‡ªå·±é¢ä¸´ç€ä¸€ä¸ªéš¾é¢˜ã€‚çŸ›ç›¾ã€‚äºŒåˆ†æ³•ï¼šæ•°æ®ç³»ç»Ÿæ˜¯å…³äºæš´éœ²æ•°æ®ã€‚æœåŠ¡æ˜¯å…³äºéšè—å®ƒã€‚ è¿™ä¸¤ç§åŠ›é‡æ˜¯æ ¹æœ¬çš„ã€‚å®ƒä»¬æ„æˆäº†æˆ‘ä»¬æ‰€åšçš„å¤§éƒ¨åˆ†å·¥ä½œçš„åŸºç¡€ï¼Œå·§å¦™åœ°åœ¨æˆ‘ä»¬æ„å»ºçš„ç³»ç»Ÿä¸­äº‰å¤ºè‡³é«˜æ— ä¸Šçš„åœ°ä½ã€‚ éšç€æˆ‘ä»¬ä¸æ–­å‘å±•å’Œå‘å±•åŸºäºæœåŠ¡çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ç§æ•°æ®äºŒåˆ†æ³•çš„æ•ˆæœä»¥å‡ ç§ä¸åŒçš„æ–¹å¼å‘æŒ¥ä½œç”¨ã€‚æœåŠ¡æ¥å£å°†å¢é•¿ï¼Œæš´éœ²è¶Šæ¥è¶Šå¤šçš„åŠŸèƒ½ï¼Œä½¿å…¶å¼€å§‹çœ‹èµ·æ¥åƒæŸç§å½¢å¼çš„kookieï¼Œè‡ªè¡Œå¼€å‘çš„æ•°æ®åº“ã€‚æˆ–è€…ï¼ŒæŒ«æŠ˜å°†ä¼šèµ·ä½œç”¨ï¼Œæˆ‘ä»¬ä¼šæ·»åŠ ä¸€äº›ä»æ•´ä¸ªæœåŠ¡åˆ°æœåŠ¡çš„æ•´ä¸ªæ•°æ®é›†çš„æå–å’Œç§»åŠ¨æ–¹å¼ã€‚ ç°åœ¨åˆ›å»ºçœ‹èµ·æ¥åƒkookieçš„ä¸œè¥¿ï¼Œå…±äº«æ•°æ®åº“å¯èƒ½ä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œæ¶‰åŠå…±äº«æ•°æ®åº“çš„å±é™©ï¼Œä½†è¶³ä»¥è¯´å®ƒä»¬ä»£è¡¨äº†å°è¯•å®ƒä»¬çš„å…¬å¸çš„é‡å¤§ä¸”æ˜‚è´µçš„å·¥ç¨‹å’Œè¿è¥æŒ‘æˆ˜ã€‚ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ•°æ®é‡å®é™…ä¸Šæ”¾å¤§äº†è¿™ä¸ªæœåŠ¡è¾¹ç•Œé—®é¢˜ã€‚éšè—åœ¨æœåŠ¡è¾¹ç•Œå†…çš„å…±äº«æ•°æ®è¶Šå¤šï¼Œæ¥å£å¯èƒ½å˜å¾—è¶Šå¤æ‚ï¼Œå¹¶ä¸”è·¨è¶Šä¸åŒæœåŠ¡åŠ å…¥æ•°æ®é›†çš„éš¾åº¦å°±è¶Šå¤§ã€‚ ç„¶è€Œï¼Œæ›¿ä»£æ–¹æ¡ˆ - æå–å’Œç§»åŠ¨æ•´ä¸ªæ•°æ®é›† - ä¹Ÿå­˜åœ¨é—®é¢˜ã€‚ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ç®€å•åœ°æå–å¹¶ä¿å­˜æ•´ä¸ªæ•°æ®é›†ï¼Œç„¶åå°†å…¶å­˜å‚¨åœ¨æ¯ä¸ªæ¶ˆè´¹æœåŠ¡å†…çš„æœ¬åœ°æ•°æ®åº“ä¸­ã€‚ é—®é¢˜æ˜¯ä¸åŒçš„æœåŠ¡å¯¹å®ƒä»¬æ¶ˆè€—çš„æ•°æ®åšå‡ºä¸åŒçš„è§£é‡Šã€‚ä»–ä»¬ä¿ç•™è¿™äº›æ•°æ®ã€‚æ•°æ®åœ¨æœ¬åœ°è¢«æ›´æ”¹å’Œä¿®å¤ã€‚å¾ˆå¿«å®ƒæ ¹æœ¬ä¸ä»£è¡¨æºæ•°æ®é›†ã€‚ å¯å˜æ‹·è´è¶Šå¤šï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ•°æ®å°±ä¼šè¶Šå¤šã€‚ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¸åŒçš„æ•°æ®åœ¨å›é¡¾è¿‡ç¨‹ä¸­å¾ˆéš¾ä¿®å¤ï¼ˆMDMå®é™…ä¸Šæ˜¯ä¸€ä¸ªç²˜æ€§ç‰©è´¨ï¼‰ã€‚å®é™…ä¸Šï¼Œä¼ä¸šé‡åˆ°çš„ä¸€äº›æœ€æ£˜æ‰‹çš„æŠ€æœ¯é—®é¢˜æ¥è‡ªäºä»åº”ç”¨ç¨‹åºåˆ°åº”ç”¨ç¨‹åºçš„ä¸åŒæ•°æ®é›†ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ç¨å¾®ä¸åŒçš„æ–¹å¼è€ƒè™‘å…±äº«æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦å°†å…¶è§†ä¸ºæˆ‘ä»¬æ„å»ºçš„æ¶æ„çš„ä¸€ç­‰å…¬æ°‘ã€‚Pat Hellandç§°è¿™ç§æ•°æ®ä¸ºå†…éƒ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŒºåˆ«ã€‚æˆ‘ä»¬éœ€è¦å°è£…ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šæš´éœ²æœåŠ¡çš„å†…éƒ¨çŠ¶æ€ã€‚ä½†æˆ‘ä»¬éœ€è¦è®©æœåŠ¡è½»æ¾è®¿é—®å…±äº«æ•°æ®ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥ç»§ç»­å·¥ä½œå¹¶å®Œæˆå·¥ä½œã€‚ é—®é¢˜æ˜¯ï¼Œç°åœ¨æ²¡æœ‰ä¸€ç§å¯ç”¨çš„æ–¹æ³•ï¼ŒæœåŠ¡æ¥å£ï¼Œæ¶ˆæ¯ä¼ é€’æˆ–å…±äº«æ•°æ®åº“ï¼Œä¸ºå¤„ç†å¤–éƒ¨æ•°æ®æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚æœåŠ¡æ¥å£ä¸é€‚åˆä»¥ä»»ä½•è§„æ¨¡çº§åˆ«å…±äº«æ•°æ®ã€‚æ¶ˆæ¯ä¼ é€’ç§»åŠ¨æ•°æ®ï¼Œä½†ä¸æä¾›å†å²å‚è€ƒï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®éšæ—¶é—´è€ŒæŸåã€‚å…±äº«æ•°æ®åº“é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ‰¼æ€äº†è¿›æ­¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¯é¿å…åœ°é™·å…¥æ•°æ®ä¸è¶³çš„å¾ªç¯ä¸­ï¼š æ•°æ®ä¸è¶³çš„å¾ªç¯ æµï¼šåˆ†æ•£çš„æ•°æ®å’ŒæœåŠ¡æ–¹æ³•å› æ­¤ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›é‡æ–°è°ƒæ•´æœåŠ¡å¤„ç†å…±äº«æ•°æ®çš„æ–¹å¼ã€‚ç°åœ¨ä»»ä½•è¿™æ ·çš„æ–¹æ³•éƒ½å¿…é¡»é¢å¯¹ä¸Šé¢æåˆ°çš„äºŒåˆ†æ³•ï¼Œæ²¡æœ‰ä»»ä½•æŠ€æœ¯ä¸Šçš„ä»™å°˜æˆ‘ä»¬å¯ä»¥éšæ„æ’’ä¸Šå¹¶å°†å…¶é­”æ³•åŒ–ã€‚ä½†æˆ‘ä»¬å¯ä»¥é‡æ–°å®šä¹‰é—®é¢˜ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªå¾®å¦™çš„ä¸åŒå¦¥åã€‚ è¿™ç§ç‰¹æ®Šçš„å¦¥åæ¶‰åŠä¸€å®šç¨‹åº¦çš„é›†ä¸­åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼æ—¥å¿—ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¿æŒæ€§ï¼Œå¯æ‰©å±•çš„æµã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦æˆ‘ä»¬çš„æœåŠ¡èƒ½å¤ŸåŠ å…¥å’Œæ“ä½œè¿™äº›å…±äº«æµï¼Œä½†æˆ‘ä»¬å¸Œæœ›é¿å…æ‰§è¡Œæ­¤ç±»å¤„ç†çš„å¤æ‚ï¼Œé›†ä¸­çš„â€œä¸Šå¸æœåŠ¡â€ã€‚å› æ­¤ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯å°†æµå¤„ç†åµŒå…¥åˆ°æ¯ä¸ªæ¶ˆè´¹æœåŠ¡ä¸­ã€‚è¿™æ„å‘³ç€æœåŠ¡å¯ä»¥å°†å„ç§å…±äº«æ•°æ®é›†è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶æŒ‰ç…§è‡ªå·±çš„è¿›åº¦è¿­ä»£å®ƒä»¬ã€‚ å®ç°æ­¤ç›®çš„çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æµå¼å¹³å°ã€‚æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šè€ƒè™‘Kafkaï¼Œå› ä¸ºå®ƒä½¿ç”¨æœ‰çŠ¶æ€æµå¤„ç†ä½¿å®ƒç‰¹åˆ«é€‚åˆè¿™ä¸ªé—®é¢˜ã€‚ ä½¿ç”¨åˆ†å¸ƒå¼æ—¥å¿—å°†æˆ‘ä»¬æ¨å‘ä¸€æ¡ç›¸å½“å®Œå–„çš„è·¯å¾„ï¼Œä¸€æ¡ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥å®ç°æœåŠ¡äº‹ä»¶é©±åŠ¨çš„è·¯å¾„ã€‚è¿™äº›æ–¹æ³•é€šå¸¸è¢«è®¤ä¸ºæä¾›äº†æ¯”å…¶è¯·æ±‚ - å“åº”å…„å¼Ÿæ›´å¥½çš„å¯æ‰©å±•æ€§å’Œæ›´å¥½çš„è§£è€¦ï¼Œå› ä¸ºå®ƒä»¬å°†æµæ§åˆ¶ä»å‘é€æ–¹ç§»åŠ¨åˆ°æ¥æ”¶æ–¹ã€‚è¿™å¢åŠ äº†æ¯é¡¹æœåŠ¡çš„è‡ªä¸»æƒã€‚å…¬å¹³åœ°è¯´å®ƒæ˜¯æœ‰ä»£ä»·çš„ï¼šä½ éœ€è¦ä¸€ä¸ªç»çºªäººã€‚ä½†æ˜¯å¯¹äºé‡è¦çš„ç³»ç»Ÿæ¥è¯´ï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªå€¼å¾—åšå‡ºçš„æƒè¡¡ï¼ˆå¯¹äºæ™®é€šçš„Webåº”ç”¨ç¨‹åºæ¥è¯´æ›´å°‘ï¼‰ ç°åœ¨ï¼Œå¦‚æœä»£ç†æ˜¯åˆ†å¸ƒå¼æ—¥å¿—ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œåˆ™å¯ä»¥åˆ©ç”¨ä¸€äº›å…¶ä»–å±æ€§ã€‚ä¼ è¾“å¯ä»¥ä¸åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå¤§è‡´ç›¸åŒçš„æ–¹å¼çº¿æ€§æ‰©å±•ã€‚æ•°æ®ä¹Ÿå¯ä»¥é•¿æœŸä¿ç•™åœ¨æ—¥å¿—ä¸­ã€‚æ‰€ä»¥è¿™æ˜¯æ¶ˆæ¯ï¼Œä½†å®ƒä¹Ÿæ˜¯å­˜å‚¨ã€‚å­˜å‚¨å¯æ‰©å±•ï¼Œæ²¡æœ‰å…±äº«ï¼Œå¯å˜çŠ¶æ€çš„å±é™©ã€‚ ç„¶åï¼ŒçŠ¶æ€æµå¤„ç†å¼•æ“ï¼Œå¯ä»¥ç”¨æ¥åµŒå…¥æ•°æ®åº“çš„å£°æ˜å·¥å…·ï¼Œç›´æ¥åœ¨æ¶ˆè´¹æœåŠ¡ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚è™½ç„¶æ•°æ®å­˜å‚¨åœ¨å…±äº«æµä¸­ï¼Œä½†æ˜¯æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯æœåŠ¡çš„è¿æ¥å’Œå¤„ç†æ˜¯ç§æœ‰çš„ã€‚æ™ºæ…§åœ¨æ¯ä¸ªæœ‰é™çš„ä¸Šä¸‹æ–‡ä¸­è¢«éš”ç¦»ã€‚ é€šè¿‡å…±äº«ä¸å¯å˜çš„çŠ¶æ€æµæ¥è§£å†³æ•°æ®äºŒåˆ†æ³•ã€‚ç„¶åä½¿ç”¨æœ‰çŠ¶æ€æµå¤„ç†å¼•æ“å°†è¯¥åŠŸèƒ½æ¨é€åˆ°æ¯ä¸ªæœåŠ¡ä¸­ã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨çš„æœåŠ¡éœ€è¦åœ¨å…¬å¸çš„è®¢å•ï¼Œäº§å“ç›®å½•æˆ–åº“å­˜ä¸Šè¿è¡Œï¼Œåˆ™å®ƒå…·æœ‰å®Œå…¨è®¿é—®æƒé™ï¼š æ‚¨å†³å®šåº”åˆå¹¶å“ªäº›æ•°æ®é›†ï¼Œæ‚¨å†³å®š æ‰§è¡Œçš„ä½ç½®ï¼Œå¹¶å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•å®ƒã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶æ•°æ®æœ¬èº«æ˜¯å…±äº«çš„ï¼Œä½†å¯¹è¯¥å…±äº«æ•°æ®çš„æ“ä½œæ˜¯å®Œå…¨ åˆ†æ•£çš„ã€‚å®ƒå®Œå…¨ä½äºæ¯ä¸ªæœåŠ¡è¾¹ç•Œå†…ï¼Œåœ¨ä¸€ä¸ªä½ ç‹¬è‡ªç»Ÿæ²»å›½ç‹çš„ä¸–ç•Œé‡Œã€‚ ä»¥ä¸€ç§ä½¿å…¶å¿ å®äºæºçš„æ–¹å¼å…±äº«æ•°æ®ã€‚å°è£…åŠŸèƒ½ï¼Œä¸æ˜¯åœ¨æºå¤´ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ƒçš„æ¯ä¸ªæœåŠ¡ä¸­ã€‚ ç°åœ¨äº‹å®è¯æ˜ï¼Œæœ‰æ—¶æ•°æ®å¿…é¡»é›†ä¸­ç§»åŠ¨ã€‚æœ‰æ—¶ï¼ŒæœåŠ¡éœ€è¦åœ¨ä»–ä»¬é€‰æ‹©çš„æ•°æ®åº“å¼•æ“ä¸­ä½¿ç”¨æœ¬åœ°å†å²æ•°æ®é›†ã€‚è¿™é‡Œçš„æŠ€å·§æ˜¯ç¡®ä¿é€šè¿‡è¿”å›åˆ†å¸ƒå¼æ—¥å¿—ï¼Œå¯ä»¥éšæ„ä»æºé‡æ–°ç”Ÿæˆå‰¯æœ¬ã€‚Kafkaä¸­çš„è¿æ¥å™¨æœ‰åŠ©äºæ­¤ã€‚ å› æ­¤è¿™ç§æ–¹æ³•æœ‰ä¸€äº›ç‰¹å®šçš„ä¼˜ç‚¹ï¼š æ•°æ®ä½œä¸ºæµå…±äº«ï¼Œå¯ä»¥é•¿æœŸé©»ç•™åœ¨æ—¥å¿—ä¸­ï¼Œä½†æ“ä½œå…±äº«æ•°æ®çš„æœºåˆ¶åµŒå…¥åˆ°æ¯ä¸ªæœ‰ç•Œä¸Šä¸‹æ–‡ä¸­ï¼Œä»è€Œå¯ä»¥è½»æ¾å¿«é€Ÿåœ°è‡ªç”±è¿­ä»£ã€‚è¿™å¹³è¡¡äº†æ•°æ®çš„äºŒåˆ†æ³•ã€‚ æ•°æ®é›†å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„æœåŠ¡ä¸­å®æ—¶è¿æ¥ã€‚è¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°ä¸å…±äº«æ•°æ®è¿›è¡Œäº¤äº’ï¼Œä»è€Œæ— éœ€åœ¨æ•°æ®åº“ä¸­ç»´æŠ¤æœ¬åœ°æ•°æ®é›†ã€‚ æœ‰çŠ¶æ€æµå¤„ç†ä»…ç¼“å­˜æ•°æ®ï¼Œâ€œé»„é‡‘æºâ€æ˜¯å…±äº«æ—¥å¿—ï¼Œå› æ­¤æ•°æ®éšæ—¶é—´å‘æ•£çš„é—®é¢˜è¿œæ²¡é‚£ä¹ˆæ™®éã€‚ æœåŠ¡æœ¬è´¨ä¸Šæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œè¿™æ„å‘³ç€éšç€æ•°æ®é›†çš„å¢é•¿ï¼ŒæœåŠ¡ä»ç„¶å¯ä»¥å¯¹ä¸šåŠ¡äº‹ä»¶åšå‡ºå¿«é€Ÿååº”ã€‚ å¯ä¼¸ç¼©æ€§é—®é¢˜ä»æœåŠ¡è½¬ç§»åˆ°ä»£ç†ã€‚è¿™ä½¿å¾—æ„å»ºæ›´ç®€å•çš„æœåŠ¡å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒè§„æ¨¡ã€‚ æ·»åŠ æ–°æœåŠ¡ä¸éœ€è¦æ›´æ”¹ä¸Šæ¸¸æœåŠ¡ã€‚è¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°æ’å…¥æ–°æœåŠ¡ã€‚ æ‰€ä»¥è¿™ä¸ä»…ä»…æ˜¯RESTã€‚å®ƒæ˜¯ä¸€ä¸ªä»¥åˆ†æ•£çš„æ–¹å¼åŒ…å«å…±äº«æ•°æ®çš„å·¥å…·é›†ã€‚ è¿™ç¯‡æ–‡ç« çœŸçš„åªæ˜¯ä¸€ä¸ªå“å°è€…ï¼Œæ©ç›–äº†è®¸å¤šç»†èŠ‚ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦æ·±å…¥ç ”ç©¶å¦‚ä½•å¹³è¡¡è¯·æ±‚ - å“åº”å’Œäº‹ä»¶é©±åŠ¨çš„èŒƒä¾‹ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è¿™æ ·åšã€‚è¿˜æœ‰ä¸€äº›æˆ‘ä»¬éœ€è¦æ›´å¥½ç†è§£çš„ä¸»é¢˜ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆæœ‰çŠ¶æ€æµå¤„ç†å¦‚æ­¤æœ‰ä»·å€¼ã€‚ç¬¬ä¸‰ç¯‡æ–‡ç« å°†ç€çœ¼äºæ­¤ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©è¿™æ¡è·¯å¾„ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„å¼ºå¤§æ„é€ ï¼Œä¾‹å¦‚ç¡®åˆ‡åœ°ä¸€æ¬¡å¤„ç†ã€‚è¿™æ˜¯åˆ†å¸ƒå¼ä¸šåŠ¡ç³»ç»Ÿçš„æ¸¸æˆè§„åˆ™æ”¹å˜è€…ï¼Œå› ä¸ºå®ƒä»¥å¯æ‰©å±•çš„å½¢å¼æä¾›XAçš„äº‹åŠ¡ä¿è¯ã€‚ç¬¬å››ç¯‡æ–‡ç« å°†è¿›å…¥é‚£ä¸ªã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦è´¯å½»æ‰§è¡Œè¿™äº›äº‹æƒ…çš„ç»†èŠ‚ã€‚ ä½†å°±ç›®å‰è€Œè¨€ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ï¼šæ•°æ®äºŒåˆ†æ³•æè¿°äº†æˆ‘ä»¬åœ¨æ„å»ºä¸šåŠ¡æœåŠ¡æ—¶å¿…é¡»é¢å¯¹çš„ç´§å¼ å±€åŠ¿ã€‚æˆ‘ä»¬åº”è¯¥æ³¨æ„è¿™ä¸ªäº‹å®ã€‚è¯€çªæ˜¯æ”¹å˜æ–¹æ³•ï¼šå°†å…±äº«æ•°æ®è§†ä¸ºä¸€ç­‰å…¬æ°‘ã€‚æˆ‘ä»¬è®¾è®¡çš„ä¸œè¥¿ã€‚æœ‰çŠ¶æ€æµå¤„ç†ä¸ºæ­¤æä¾›äº†ç‹¬ç‰¹çš„æŠ˜è¡·æ–¹æ¡ˆã€‚å®ƒé¿å…äº†é€šå¸¸ä¼šæ‰¼æ€è¿›æ­¥çš„æ ¸å¿ƒâ€œä¸Šå¸ç»„æˆéƒ¨åˆ†â€ã€‚è€Œä¸”ï¼Œå®ƒå¸¦æ¥äº†æµæ•°æ®æµæ°´çº¿çš„å³æ—¶æ€§ï¼Œå¯æ‰©å±•æ€§å’Œå®¹é”™æ€§ï¼Œå¹¶å°†å®ƒä»¬åµŒå…¥åˆ°æ¯ä¸ªæœåŠ¡ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸“æ³¨äºæ•´ä½“æ„è¯†æµï¼Œä»»ä½•æœåŠ¡éƒ½å¯ä»¥é€šè¿‡è¿™ç§æ„è¯†æµæ¥åšå‡ºå†³ç­–ã€‚è¿™ä½¿æœåŠ¡æ›´å…·å¯æ‰©å±•æ€§ï¼Œå¯äº’æ¢æ€§å’Œè‡ªä¸»æ€§ã€‚å› æ­¤ï¼Œå®ƒä»¬ä¸ä»…åœ¨ç™½æ¿å’ŒPOCä¸Šçœ‹èµ·æ¥å¾ˆå¥½ï¼Œå®ƒä»¬è¿˜èƒ½ç»§ç»­å­˜æ´»å¹¶å‘å±•æ•°åå¹´ã€‚ åŸæ–‡åœ°å€ç¬¬1éƒ¨åˆ†:æ•°æ®äºŒåˆ†æ³•:é‡æ–°æ€è€ƒæˆ‘ä»¬å¯¹å¾…æ•°æ®å’ŒæœåŠ¡çš„æ–¹å¼ç¬¬2éƒ¨åˆ†:åœ¨äº‹ä»¶çš„ä¸»å¹²ä¸Šæ„å»ºæœåŠ¡ç¬¬3éƒ¨åˆ†:ä½¿ç”¨Apache Kafkaä½œä¸ºå¯ä¼¸ç¼©çš„ã€äº‹ä»¶é©±åŠ¨çš„æœåŠ¡æ¶æ„ä¸»å¹²(è¯·å‚é˜…ä¸‹ä¸€éƒ¨åˆ†)ç¬¬4éƒ¨åˆ†:å…·æœ‰ä¸€æ¬¡ä¿è¯çš„è¿é”æœåŠ¡ç¬¬5éƒ¨åˆ†:ä¿¡æ¯ä½œä¸ºçœŸç†çš„å•ä¸€æ¥æºç¬¬6éƒ¨åˆ†:åˆ©ç”¨æœªç»‘å®šæ•°æ®åº“çš„å¼ºå¤§åŠŸèƒ½ç¬¬7éƒ¨åˆ†:ä½¿ç”¨Kafkaæµå’ŒKSQLæ„å»ºå¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿ","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"},{"name":"Kafkaå¾®æœåŠ¡","slug":"Kafka/Kafkaå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/Kafka/Kafkaå¾®æœåŠ¡/"}],"tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://jigangduan.github.io/tags/ç¿»è¯‘/"},{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"}]},{"title":"åœ¨20åˆ†é’Ÿå†…æ„å»ºå®æ—¶æµETLç®¡é“","slug":"building-real-time-streaming-etl-pipeline-20-minutes","date":"2018-11-28T04:50:29.000Z","updated":"2020-07-25T02:57:18.194Z","comments":true,"path":"2018/11/28/building-real-time-streaming-etl-pipeline-20-minutes/","link":"","permalink":"https://jigangduan.github.io/2018/11/28/building-real-time-streaming-etl-pipeline-20-minutes/","excerpt":"","text":"æœ€è¿‘æœ‰å¾ˆå¤šäººè¯´ä¼ ç»Ÿçš„ETLå·²ç»æ­»äº†ã€‚åœ¨ä¼ ç»Ÿçš„ETLèŒƒå¼ä¸­ï¼Œæ•°æ®ä»“åº“æ˜¯ç‹è€…ï¼ŒETLä½œä¸šæ˜¯æ‰¹å¤„ç†é©±åŠ¨çš„ï¼Œæ‰€æœ‰å†…å®¹éƒ½ä¸å…¶ä»–å†…å®¹è¿›è¡Œé€šä¿¡ï¼Œå¯ä¼¸ç¼©æ€§é™åˆ¶éå¸¸æ™®éã€‚å½“äººä»¬å’•å“ç€è¯´ç”±æ­¤é€ æˆçš„æ··ä¹±æ˜¯â€œåšç”Ÿæ„çš„æˆæœ¬â€æ—¶ï¼Œæ··ä¹±çš„ç®¡é“è¢«å‹‰å¼ºå®¹å¿ã€‚â€œäººä»¬å­¦ä¼šäº†å¿å—è¿™æ ·çš„ä¸€å›¢ç³Ÿ: ç„¶è€Œï¼ŒETLå¹¶æ²¡æœ‰æ­»ã€‚å¼€å‘äººå‘˜è¶Šæ¥è¶Šå–œæ¬¢ä¸€ç§æ–°çš„ETLèŒƒå¼ï¼Œå®ƒå…·æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿå’Œäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ä¸šåŠ¡å¯ä»¥å®æ—¶å’Œå¤§è§„æ¨¡åœ°å¤„ç†æ•°æ®ã€‚ä»ç„¶éœ€è¦â€œæå–â€ã€â€œè½¬æ¢â€å’Œâ€œåŠ è½½â€ï¼Œä½†æ˜¯ç°åœ¨çš„åŒºåˆ«æ˜¯å°†æ•°æ®ä½œä¸ºä¸€ç­‰å…¬æ°‘å¯¹å¾…ã€‚ä¼ä¸šä¸å†å¸Œæœ›å°†æ•°æ®é™çº§ä¸ºæ‰¹å¤„ç†ï¼Œè€Œæ‰¹å¤„ç†é€šå¸¸ä»…é™äºæ¯å¤©ç¦»çº¿å®Œæˆä¸€æ¬¡ã€‚å®ƒä»¬æ‹¥æœ‰æ›´å¤šä¸åŒç±»å‹çš„æ•°æ®æºï¼Œå¹¶ä¸”å¸Œæœ›æ¶ˆé™¤æ··ä¹±çš„ç‚¹åˆ°ç‚¹è¿æ¥ã€‚æˆ‘ä»¬å¯ä»¥å°†æµå¤„ç†ç›´æ¥åµŒå…¥åˆ°æ¯ä¸ªæœåŠ¡ä¸­ï¼Œæ ¸å¿ƒä¸šåŠ¡åº”ç”¨ç¨‹åºå¯ä»¥ä¾èµ–æµå¹³å°æ¥åˆ†å‘å’Œå¤„ç†äº‹ä»¶ã€‚è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹æ˜¯æ¼”ç¤ºåœ¨Apacheå¡å¤«å¡Â®å¦‚ä½•è½»æ¾åœ°å¯ä»¥å®ç°è¿™äº›æµETLç®¡é“ã€‚ Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¹³å°ï¼Œæ˜¯ç°ä»£ä¼ä¸šæ¶æ„çš„æ ¸å¿ƒã€‚å®ƒæä¾›äº†åœ¨Kafka Connectæ¡†æ¶ä¸­è¿è¡Œçš„Kafkaè¿æ¥å™¨ï¼Œå¯ä»¥ä»ä¸åŒçš„æ•°æ®æºæå–æ•°æ®;æä¾›äº†ä¸°å¯Œçš„KafkaæµAPIï¼Œå¯ä»¥ä»æ ¸å¿ƒåº”ç”¨ç¨‹åºä¸­æ‰§è¡Œå¤æ‚çš„è½¬æ¢å’Œåˆ†æ;æ‚¨å¯ä»¥éƒ¨ç½²Confluentæ¨¡å¼æ³¨å†Œä¸­å¿ƒæ¥é›†ä¸­ç®¡ç†æ¨¡å¼ï¼ŒéªŒè¯å…¼å®¹æ€§ï¼Œå¹¶åœ¨æ•°æ®ä¸ç¬¦åˆæ¨¡å¼æ—¶æä¾›è­¦å‘Šã€‚(ä¸æ˜ç™½ä¸ºä»€ä¹ˆéœ€è¦ä¸ºå…³é”®ä»»åŠ¡æ•°æ®å»ºç«‹æ¨¡å¼æ³¨å†Œè¡¨?)é˜…è¯»è¿™ç¯‡åšå®¢æ–‡ç« ã€‚ç«¯åˆ°ç«¯å‚è€ƒä½“ç³»ç»“æ„å¦‚ä¸‹: è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªä½¿ç”¨Kafka Streams APIè¿›è¡Œå®æ—¶æœ‰çŠ¶æ€æµå¤„ç†çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å°†è¿è¡Œç«¯åˆ°ç«¯å‚è€ƒä½“ç³»ç»“æ„çš„ä¸€ä¸ªå…·ä½“ç¤ºä¾‹ï¼Œå¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•: è¿è¡ŒKafkaæºè¿æ¥å™¨ä»å¦ä¸€ä¸ªç³»ç»Ÿ(SQLite3æ•°æ®åº“)è¯»å–æ•°æ®ï¼Œç„¶åä½¿ç”¨å•ä¸ªæ¶ˆæ¯è½¬æ¢(SMTs)ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„æ•°æ®ï¼Œç„¶åå°†å…¶å†™å…¥Kafkaé›†ç¾¤ ä½¿ç”¨Kafka Streams API(ä¾‹å¦‚countå’Œsum)å¤„ç†å’Œä¸°å¯Œæ¥è‡ªJavaåº”ç”¨ç¨‹åºçš„æ•°æ® è¿è¡ŒKafkaæ¥æ”¶å™¨è¿æ¥å™¨å°†æ•°æ®ä»Kafkaé›†ç¾¤å†™åˆ°å¦ä¸€ä¸ªç³»ç»Ÿ(AWS S3) æœ¬ä¾‹çš„å·¥ä½œæµç¨‹å¦‚ä¸‹: å¦‚æœæ‚¨å¸Œæœ›åœ¨æ‚¨çš„ç¯å¢ƒä¸­è¿›è¡Œåç»­æ“ä½œå¹¶è¿›è¡Œå°è¯•ï¼Œè¯·ä½¿ç”¨å¿«é€Ÿå…¥é—¨æŒ‡å—æ¥è®¾ç½®Kafkaé›†ç¾¤å¹¶ä¸‹è½½å®Œæ•´çš„æºä»£ç ã€‚ æå–æ•°æ®åˆ°Kafkaé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•°æ®å¯¼å…¥å®¢æˆ·æœºåº”ç”¨ç¨‹åºã€‚è¦åœ¨Kafkaå’Œå…¶ä»–ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œç”¨æˆ·å¯ä»¥ä»å„ç§ç°æˆçš„è¿æ¥å™¨ä¸­é€‰æ‹©Kafkaè¿æ¥å™¨ã€‚Kafkaæºè¿æ¥å™¨ä»å¦ä¸€ä¸ªç³»ç»Ÿå¯¼å…¥æ•°æ®åˆ°Kafka, Kafkaæ¥æ”¶å™¨è¿æ¥å™¨ä»Kafkaå¯¼å‡ºæ•°æ®åˆ°å¦ä¸€ä¸ªç³»ç»Ÿã€‚ å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä»SQLite3æ•°æ®åº“ä¸­æå–æ•°æ®ï¼Œè¯¥æ•°æ®åº“ä¿å­˜åˆ°/usr/local/lib/retail.dbã€‚æ•°æ®åº“æœ‰ä¸€ä¸ªåä¸ºlocationsçš„è¡¨ï¼Œå®ƒæœ‰ä¸‰ä¸ªåˆ—idã€nameå’Œsaleï¼Œå…¶ä¸­åŒ…å«ç¤ºä¾‹å†…å®¹: locations id name sale 1 Raleigh 300 2 Dusseldorf 100 1 Raleigh 600 3 Moscow 800 4 Sydney 200 2 Dusseldorf 400 5 Chennai 400 â€¦ â€¦ â€¦ æˆ‘ä»¬å¸Œæœ›ä»è¯¥è¡¨åˆ›å»ºä¸€ä¸ªæ•°æ®æµï¼Œå…¶ä¸­æµä¸­çš„æ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯K/Vå¯¹ã€‚ä½ ä¼šé—®ï¼Œkeyæ˜¯ä»€ä¹ˆï¼Œvalueæ˜¯ä»€ä¹ˆ?æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ã€‚ ä¸ºäº†å°†è¡¨æ•°æ®æå–åˆ°Kafkaä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å…è´¹çš„Confluentå¼€æºä¸‹è½½é™„å¸¦çš„JDBCè¿æ¥å™¨ã€‚æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒJDBCè¿æ¥å™¨ä¸ä¼šå‘æ¶ˆæ¯æ·»åŠ é”®ã€‚ç”±äºæ¶ˆæ¯é”®å¯¹äºç»„ç»‡å’Œåˆ†ç»„æ¶ˆæ¯éå¸¸æœ‰ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨smtè®¾ç½®è¯¥é”®ã€‚å¦‚æœä½¿ç”¨é»˜è®¤é…ç½®è®¾ç½®ï¼Œæ•°æ®å°†è¢«å†™å…¥Kafkaä¸»é¢˜ï¼Œé…ç½®å¦‚ä¸‹: é»˜è®¤é…ç½® é…ç½®å é…ç½®å€¼ æºæ•°æ®åº“ test.db Kafka åˆ›å»ºçš„topic test-sqlite-jdbc-locations æ¶ˆæ¯é”®å‘ˆç° æœ‰æ•ˆçš„ç©º (å…·æœ‰nullå€¼çš„JSONæ¨¡å¼) ä¿¡æ¯å€¼æ¨¡å¼ JSON æ•°æ®æ²»ç† None ç›¸åï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹ç›®æ ‡é…ç½®: ç›®æ ‡é…ç½® é…ç½®å é…ç½®å€¼ æºæ•°æ®åº“ /usr/local/lib/retail.db Kafka åˆ›å»ºçš„topic retail-locations æ¶ˆæ¯é”®å‘ˆç° æ˜¯çš„ï¼Œä½¿ç”¨Kafka Connectçš„å•ä¸ªæ¶ˆæ¯è½¬æ¢ç‰¹æ€§æ’å…¥å¯†é’¥ ä¿¡æ¯å€¼æ¨¡å¼ Avro æ•°æ®æ²»ç† æ˜¯çš„ï¼Œä½¿ç”¨æ¨¡å¼æ³¨å†Œè¡¨ ä¸ºäº†å®ç°ç›®æ ‡é…ç½®ï¼Œæˆ‘ä»¬ä¿®æ”¹JDBCæºè¿æ¥å™¨å±æ€§æ–‡ä»¶source-quickstart-sqlite.properties: ç„¶åï¼Œæˆ‘ä»¬å°†è¿™äº›é…ç½®è¡Œæ·»åŠ åˆ°JDBCæºè¿æ¥å™¨å±æ€§æ–‡ä»¶ä¸­ï¼Œä»¥åˆ©ç”¨å•ä¸ªæ¶ˆæ¯è½¬æ¢(SMT)å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨å°†ä»è¡¨è¡Œæå–çš„æ•°æ®å†™åˆ°Kafkaä¸»é¢˜ä¹‹å‰æ“ä½œè¿™äº›æ•°æ®ã€‚æˆ‘ä»¬ä½¿ç”¨ValueToKeyå’ŒExtractField SMTå‡½æ•°å°†nullé”®æ›¿æ¢ä¸ºä»æ¶ˆæ¯å€¼æ´¾ç”Ÿçš„å­—æ®µã€‚ æœ€åï¼Œæˆ‘ä»¬å°†è¿™äº›é…ç½®è¡Œæ·»åŠ åˆ°JDBCæºè¿æ¥å™¨å±æ€§æ–‡ä»¶ä¸­ï¼Œä»¥å°†é”®è½¬æ¢å™¨é…ç½®ä¸ºå­—ç¬¦ä¸²(å¯ä»¥åƒJSONæˆ–Avroé‚£æ ·è½»æ¾åœ°åºåˆ—åŒ–)ï¼Œå°†å€¼è½¬æ¢å™¨é…ç½®ä¸ºæ¨¡å¼çš„Avroã€‚Confluentæ¨¡å¼æ³¨å†Œè¡¨è¿è¡Œåœ¨http://schemaregistry1:8081ã€‚ ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»¥Kafka Connectç‹¬ç«‹æ¨¡å¼è¿è¡ŒJDBCæºè¿æ¥å™¨ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆä½¿ç”¨åˆ†å¸ƒå¼æ¨¡å¼è¿›è¡Œå¯ä¼¸ç¼©æ€§å’Œå®¹é”™ï¼Œå¹¶ä½¿ç”¨åˆæµæ§åˆ¶ä¸­å¿ƒè¿›è¡Œé›†ä¸­ç®¡ç†ã€‚ æ­¤æ—¶ï¼ŒKafka Connectè¿è¡ŒJDBCè¿æ¥å™¨ï¼Œå¹¶å°†è¡¨çš„æ¯ä¸€è¡Œä½œä¸ºé”®/å€¼å¯¹å†™å…¥Kafkaä¸»é¢˜retail-locationsã€‚å¯¹è¯¥è¡¨çš„çŠ¶æ€æ„Ÿå…´è¶£çš„åº”ç”¨ç¨‹åºå°†ä»æœ¬ä¸»é¢˜è¯»å–ã€‚å½“å°†è¡Œæ·»åŠ åˆ°SQLite3æ•°æ®åº“ä¸­çš„æºè¡¨æ—¶ï¼ŒKafka Connectä¼šè‡ªåŠ¨å°†å®ƒä»¬ä½œä¸ºæ¶ˆæ¯å†™å…¥Kafkaä¸»é¢˜ï¼Œç„¶ååœ¨KStreamå¯¹è±¡ä¸­è‡ªåŠ¨æä¾›ç»™å®¢æˆ·æœºåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†æ•°æ®çš„æ— ç•Œã€è¿ç»­çš„å®æ—¶æµã€‚è¿™ä¸ªæ•°æ®æµå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œæµâ€ã€‚ æ¯ä¸ªè¡¨è¡Œè¢«åºåˆ—åŒ–ä¸ºAvroè®°å½•ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸»é¢˜retail-locationsæŸ¥æ‰¾Confluentæ¨¡å¼æ³¨å†Œè¡¨ä¸­æ¶ˆæ¯å€¼çš„æ¨¡å¼ã€‚ ä½¿ç”¨Kafka Streams APIè½¬æ¢æ•°æ®æ—¢ç„¶æºæ•°æ®å·²å†™å…¥Kafkaä¸»é¢˜ï¼Œé‚£ä¹ˆä»»ä½•æ•°é‡çš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä»è¯¥ä¸»é¢˜è¯»å–å¹¶ä½¿ç”¨æ¨¡å¼æ³¨å†Œè¡¨ååºåˆ—åŒ–æ¶ˆæ¯å€¼(å³Avroè®°å½•)ã€‚ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºå¯ä»¥æ˜¯kafka-avro-consol-consumer: ä½†æ˜¯æ§åˆ¶å°ä½¿ç”¨è€…å‘½ä»¤è¡Œå·¥å…·ä¸æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ã€‚æˆ‘ä»¬å¸Œæœ›æ¼”ç¤ºå¦‚ä½•åœ¨å®¢æˆ·æœºåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨Kafka Streams APIæ¥å¤„ç†è¯¥ä¸»é¢˜ä¸­çš„æ•°æ®ã€‚Confluentæä¾›äº†å…³äºå¦‚ä½•ä½¿ç”¨APIå¼€å‘åº”ç”¨ç¨‹åºçš„ä¼˜ç§€æ–‡æ¡£ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å¼ºè°ƒåº”ç”¨ç¨‹åºçš„ä¸¤ä¸ªéƒ¨åˆ†: ä»Kafkaä¸»é¢˜åˆ›å»ºKafkaæµå¯¹è±¡ ä½¿ç”¨Kafkaæµå¤„ç†æ“ä½œæ•°æ®è½¬æ¢ åˆ›å»ºKafkaæµå¯¹è±¡ä»Kafkaä¸»é¢˜åˆ›å»ºKafkaæµå¯¹è±¡æ„å‘³ç€å°†Kafkaä¸­çš„å­—èŠ‚è®°å½•è½¬æ¢ä¸ºå®¢æˆ·æœºåº”ç”¨ç¨‹åºä¸­çš„Javaå¯¹è±¡ã€‚å› ä¸ºæ¶ˆæ¯å€¼æ˜¯Avroè®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åŒ¹é…è¯¥æ¨¡å¼çš„Javaç±»ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºlocation.avscçš„Avroæ¨¡å¼æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·æœºå¯¹æ•°æ®ç»“æ„çš„æœŸæœ›ã€‚å®ƒæ˜¯JSONæ ¼å¼çš„ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªè®°å½•ï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ªå­—æ®µidã€nameå’Œsalesï¼Œè¿™äº›å­—æ®µå¯¹åº”äºè¡¨åˆ— ä¸ºäº†è®©Javaå®¢æˆ·æœºåº”ç”¨ç¨‹åºèƒ½å¤Ÿååºåˆ—åŒ–åœ¨è¿™ä¸ªAvroæ¨¡å¼ä¸­ç¼–å†™çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå¯¹åº”çš„Javaç±»(ä¾‹å¦‚Location)ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç¼–å†™Javaä»£ç !åœ¨æˆ‘ä»¬çš„pom.xml ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Mavenæ’ä»¶avro-maven-pluginï¼Œå®ƒè‡ªåŠ¨ç”Ÿæˆè¿™äº›ç±»çš„Javaä»£ç ã€‚ ç°åœ¨Javaæºä»£ç å·²ç»ä»Avroæ¨¡å¼æ–‡ä»¶ä¸­è‡ªåŠ¨åˆ›å»ºï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥å¯¼å…¥è¯¥åŒ…: ä¸‹ä¸€ä¸ªå…³é”®æ­¥éª¤æ˜¯é…ç½®streamsé…ç½®ï¼Œä»¥ä½¿ç”¨é€‚å½“çš„serialization/deserializationç±»å¹¶æŒ‡å‘æ¨¡å¼æ³¨å†Œä¸­å¿ƒ: æ‚¨ç°åœ¨å¯ä»¥åˆ›å»ºKStreamå¯¹è±¡: è¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„å·¥ä½œæµä¸­çœç•¥äº†ä¸€äº›åŸºæœ¬çš„Kafkaæµè®¾ç½®ï¼Œä½†æ˜¯è¯·è®°ä½æŸ¥çœ‹Streamså¼€å‘äººå‘˜æŒ‡å—ä»¥è·å¾—è¯¦ç»†çš„è¯´æ˜ã€‚ å¤„ç†å’Œä¸°å¯Œæ•°æ®åœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºlocationsStreamçš„KStreamå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ¶ˆæ¯æµï¼Œå…¶ä¸­æ¶ˆæ¯é”®æ˜¯&lt;Long&gt; idï¼Œæ¶ˆæ¯å€¼æ˜¯&lt;Location&gt;è®°å½•ï¼Œå…¶ä¸­åŒ…å«å®ƒçš„idã€nameå’Œsaleå€¼ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æµå¤„ç†å™¨è¿›è¡Œæ•°æ®è½¬æ¢ã€‚æœ‰ä¸€ä¸ªä¸°å¯Œçš„Kafka Streams APIç”¨äºå®æ—¶æµå¤„ç†ï¼Œæ‚¨å¯ä»¥åœ¨æ ¸å¿ƒä¸šåŠ¡åº”ç”¨ç¨‹åºä¸­åˆ©ç”¨å®ƒã€‚æœ‰è®¸å¤šæµå¤„ç†å™¨ï¼Œå®ƒä»¬ä¸€æ¬¡æ¥æ”¶ä¸€æ¡è¾“å…¥è®°å½•ï¼Œå°†å…¶æ“ä½œåº”ç”¨äºè¯¥è®°å½•ï¼Œç„¶åå¯èƒ½å‘å…¶ä¸‹æ¸¸å¤„ç†å™¨ç”Ÿæˆä¸€æ¡æˆ–å¤šæ¡è¾“å‡ºè®°å½•ã€‚è¿™äº›å¤„ç†å™¨å¯ä»¥æ˜¯æ— çŠ¶æ€çš„(ä¾‹å¦‚ä¸€æ¬¡è½¬æ¢ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ–è€…æ ¹æ®æŸäº›æ¡ä»¶è¿‡æ»¤æ‰æ¶ˆæ¯)ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ‰çŠ¶æ€çš„(ä¾‹å¦‚è·¨å¤šä¸ªæ¶ˆæ¯çš„join, aggregate, æˆ– windowæ•°æ®)ã€‚ ä¸ºäº†å¼€å§‹ä½¿ç”¨Kafka Streams APIï¼Œä¸‹é¢æ˜¯ä¸‰ä¸ªç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…å«ç¤ºä¾‹ä»£ç å’Œç›¸åº”çš„å¯è§†åŒ–ç»“æœæµæ•°æ®: å°†æ•°æ®æµè½¬æ¢ä¸ºæ–°ç±»å‹çš„é”®/å€¼å¯¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mapæ–¹æ³•å°†åŸæ¥çš„KStream&lt;Long, Location&gt;è½¬æ¢ä¸ºKStream&lt;Long, Long&gt;çš„key/valueå¯¹ï¼Œå…¶ä¸­keyæ˜¯ç›¸åŒçš„key, valueåªæ˜¯salesçš„å€¼ã€‚ è®¡ç®—ç‰¹å®šé”®çš„å‡ºç°æ¬¡æ•°ï¼Œé¦–å…ˆæ ¹æ®é”®å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç»„ï¼Œç„¶åä½¿ç”¨Countæ–¹æ³•è®¡ç®—å‡ºç°æ¬¡æ•°ã€‚Kafka Streams APIå…·æœ‰æ•è·æµå’Œè¡¨çš„å¯¹é‡æ€§çš„æœ¬åœ°æŠ½è±¡:KStreamè¡¨ç¤ºæ¶ˆæ¯æµï¼Œå…¶ä¸­æ¯ä¸ªæ•°æ®è®°å½•è¡¨ç¤ºæ— ç•Œæ•°æ®é›†ä¸­çš„è‡ªåŒ…å«æ•°æ®ï¼ŒKTableè¡¨ç¤ºchangelogsï¼Œå…¶ä¸­æ¯ä¸ªæ•°æ®è®°å½•è¡¨ç¤ºæ›´æ–°ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºaKTableå‘½åä¸€ä¸ªæœ¬åœ°çŠ¶æ€å­˜å‚¨ï¼Œè¿™å…è®¸æˆ‘ä»¬åƒæŸ¥è¯¢æ™®é€šè¡¨ä¸€æ ·è½»æ¾åœ°æŸ¥è¯¢å®ƒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªé”®å‡ºç°çš„æ¬¡æ•°ã€‚ é€šè¿‡é¦–å…ˆåŸºäºé”®å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç»„ï¼Œç„¶åä½¿ç”¨reduceæ–¹æ³•å¯¹å€¼è¿›è¡Œæ±‚å’Œï¼Œä»è€Œå¯¹ç‰¹å®šé”®çš„å€¼è¿›è¡Œæ±‚å’Œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è·¨æ‰€æœ‰æ¶ˆæ¯å¯¹ç»™å®šé”®çš„é”€å”®é¢è¿›è¡Œæ±‚å’Œï¼Œå¹¶åœ¨æ·»åŠ æ–°é”€å”®é¢æ—¶å¯¹å…¶è¿›è¡Œå®æ—¶æ›´æ–°ã€‚è¿™ä¸ªä¾‹å­è¿˜å±•ç¤ºäº†Kafkaæµå¦‚ä½•å…è®¸æˆ‘ä»¬åœ¨KStreamå’Œktableä¹‹é—´æ¥å›åˆ‡æ¢ã€‚ å°†æ•°æ®åŠ è½½åˆ°å…¶ä»–ç³»ç»Ÿåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ‰€æœ‰ä¸°å¯Œçš„æ•°æ®ä»ç„¶åœ¨æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†å®ƒæµåˆ°å¦ä¸€ä¸ªç³»ç»Ÿä¸­ã€‚äº‹å®ä¸Šï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨è®¸å¤šç›®æ ‡ä¸‹æ¸¸ç³»ç»Ÿä¸­çš„æ•°æ®ä½œä¸ºæ‰‡å‡ºç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªKafkaæ¥æ”¶å™¨è¿æ¥å™¨è¿è¡ŒKafka Connectï¼Œä»¥ä¾¿ä»»ä½•æ•°é‡çš„ç›®æ ‡ä¸‹æ¸¸ç³»ç»Ÿéƒ½å¯ä»¥æ¥æ”¶ç›¸åŒçš„æ•°æ®ã€‚Kafkaæ¥æ”¶å™¨è¿æ¥å™¨å¯ä»¥ä¸Kafkaæºè¿æ¥å™¨å¹¶è¡Œè¿è¡Œã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œç›®æ ‡ç³»ç»Ÿæ˜¯AWS S3 bucketã€‚è¦åœ¨é‚£é‡ŒåŠ è½½æ•°æ®ï¼Œä»Kafkaè·å–æ•°æ®å’Œä»Kafkaè·å–æ•°æ®ä¸€æ ·å®¹æ˜“ã€‚åº”ç”¨ç¨‹åºç”¨è¿™æ¡è¯­å¥å°†theKStreamå†™åˆ°Kafkaä¸»é¢˜ä¸Š: ç„¶åKafkaæ¥æ”¶å™¨è¿æ¥å™¨å¤„ç†è¿›å…¥ä¸‹æ¸¸ç³»ç»Ÿçš„æ‘„å…¥ã€‚æ‚¨å¯ä»¥å°†æ¥æ”¶å™¨è¿æ¥å™¨æŒ‡å‘è¿™ä¸ªKafkaä¸»é¢˜ï¼Œå¹¶ä½¿ç”¨Kafka Connectä»¥ä¸ä¸ºKafkaæºè¿æ¥å™¨è¿è¡ŒKafka Connectç±»ä¼¼çš„æ–¹å¼è¿è¡Œå®ƒã€‚ è¦å°†æ•°æ®åŠ è½½åˆ°AWS S3ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é€‚å½“çš„ä¸»é¢˜åç§°ã€S3åŒºåŸŸå’Œbucketé…ç½®S3è¿æ¥å™¨å±æ€§ï¼Œç„¶åè¿è¡Œè¿æ¥å™¨ã€‚ç°åœ¨æˆ‘ä»¬å°†çœç•¥S3çš„ç²¾ç¡®é…ç½®(å¾ˆå¿«å°±ä¼šæœ‰å¦ä¸€ç¯‡å…³äºæ­¤é…ç½®çš„åšå®¢æ–‡ç« )ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨è¿æ¥å™¨: ç»“è®ºä¹Ÿè®¸åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­æè¿°çš„å·¥ä½œæµå¯¹äºæˆ‘ä»¬è¿™ä¸ªéå¸¸ç®€å•çš„ä¾‹å­æ¥è¯´ä¼¼ä¹å¸¦æ¥äº†å¾ˆå¤šå¼€é”€ã€‚ä½†æ˜¯ï¼Œè€ƒè™‘å…·æœ‰å¤šä¸ªæ•°æ®æºå’Œç›®æ ‡çš„çœŸå®åœºæ™¯ï¼Œè¿™äº›æ•°æ®æºå’Œç›®æ ‡éœ€è¦æ‘„å–æ•°æ®ï¼ŒåŒæ—¶æ”¯æŒéšæ—¶é—´å˜åŒ–çš„å„ç§æ¨¡å¼ã€‚æœ‰å¤šæ­¥éª¤çš„å®æ—¶å·¥ä½œæµï¼Œå…·æœ‰å¤æ‚çš„è½¬æ¢ï¼Œéœ€è¦é«˜è€ä¹…æ€§å’Œå®¹é”™èƒ½åŠ›ã€‚Kafkaä¸ºæ„å»ºæµETLç®¡é“æä¾›äº†ä¸€ä¸ªéå¸¸çµæ´»ã€å¯ä¼¸ç¼©çš„æ¶æ„ã€‚æ‚¨ä¸å¸Œæœ›è¯•å›¾å°†å…¶ä¸ä¼ ç»Ÿçš„ETLèŒƒå¼ç»“åˆåœ¨ä¸€èµ·ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹ä¸å¯é¿å…åœ°ä¼šå˜å¾—æ··ä¹±ã€‚å›é¡¾Kafkaå‚è€ƒä½“ç³»ç»“æ„å›¾ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å®æ—¶çš„ã€å…³é”®ä¸šåŠ¡çš„åº”ç”¨ç¨‹åºå¦‚ä½•ä»Kafkaçš„æµåŒ–ETLåŠŸèƒ½ä¸­è·ç›Š: Kafkaæµåª’ä½“å¹³å°å…è®¸å…³é”®ä»»åŠ¡åº”ç”¨ç¨‹åºå®æ—¶å¤„ç†æ•°æ®: Kafkaè¿æ¥å™¨åœ¨Kafka Connectæ¡†æ¶ä¸­è¿è¡Œï¼Œå¼€å‘äººå‘˜å¯ä»¥ä»ä¸€ä¸ªç³»ç»Ÿä¸­æå–æ•°æ®æˆ–å°†æ•°æ®åŠ è½½åˆ°å¦ä¸€ä¸ªç³»ç»Ÿä¸­ Kafka Streams APIä¸ºåº”ç”¨ç¨‹åºæä¾›äº†æµå¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥ä¸€æ¬¡è½¬æ¢ä¸€æ¡æ¶ˆæ¯æˆ–äº‹ä»¶ã€‚è¿™äº›è½¬æ¢å¯ä»¥åŒ…æ‹¬è¿æ¥å¤šä¸ªæ•°æ®æºã€è¿‡æ»¤æ•°æ®å’Œåœ¨ä¸€æ®µæ—¶é—´å†…èšåˆæ•°æ® Confluentæ¨¡å¼æ³¨å†Œä¸­å¿ƒä½¿ç”¨Avroæ¨¡å¼æä¾›æ•°æ®æ²»ç† æ±‡æµæ§åˆ¶ä¸­å¿ƒæä¾›é›†ä¸­ç®¡ç† ä¸‹è½½Confluentå¼€æ”¾æºä»£ç ï¼Œå¹¶ä»ä½¿ç”¨Kafkaæµã€Kafka Connectã€Avroã€æ¨¡å¼æ³¨å†Œè¡¨çš„ä»£ç ç¤ºä¾‹å¼€å§‹ã€‚å¦‚æœä½ å–œæ¬¢Dockerï¼Œä½ ä¹Ÿå¯ä»¥çœ‹çœ‹Kafkaçš„éŸ³ä¹æ¼”ç¤ºã€‚","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"}]},{"title":"Hello World, Kafkaè¿æ¥å™¨ + Kafkaæµè®¡ç®—","slug":"hello-world-kafka-connect-kafka-streams","date":"2018-11-28T02:37:23.000Z","updated":"2020-07-25T02:57:18.207Z","comments":true,"path":"2018/11/28/hello-world-kafka-connect-kafka-streams/","link":"","permalink":"https://jigangduan.github.io/2018/11/28/hello-world-kafka-connect-kafka-streams/","excerpt":"","text":"é‡è¦æç¤º:æœ¬æ–‡ä¸­çš„ä¿¡æ¯å·²ç»è¿‡æ—¶ã€‚é€šè¿‡æœ€è¿‘çš„Kafkaç‰ˆæœ¬ï¼ŒKafka Connectå’ŒKafkaæµä»¥åŠKSQLä¹‹é—´çš„é›†æˆå˜å¾—æ›´åŠ ç®€å•å’Œå®¹æ˜“ã€‚è¯·å‚é˜… åœ¨20åˆ†é’Ÿå†…æ„å»ºå®æ—¶æµETLç®¡é“å’ŒKSQLå®æˆ˜:ä»Oracleäº‹åŠ¡æ•°æ®ä¸­å®æ—¶æµåŒ–ETL æœ¬æ–‡ç”±å®¢ç±åšå®¢Michal Harisä¸Neha Narkhedeã€Apache Kafka committerã€Confluentè”åˆåˆ›å§‹äººå’ŒCTOåˆä½œæ’°å†™ã€‚Michalåœ¨æ•°å­—åª’ä½“è¡Œä¸šå·¥ä½œï¼Œæ˜¯ä¸€åä¸“ä¸šä»äº‹å®æ—¶å¤§æ•°æ®åŸºç¡€è®¾æ–½å’Œæµå¤„ç†åº”ç”¨æ¦‚å¿µéªŒè¯å®ç°çš„æŠ€æœ¯æ¶æ„å¸ˆã€‚ åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œéšç€Apache Kafkaçš„å¹¿æ³›é‡‡ç”¨ï¼Œæµå¤„ç†å·²ç»èµ°åˆ°äº†å‰å°ã€‚æœ€è¿‘ï¼Œå‡ºç°äº†å‡ ä¸ªä¸Kafkaé›†æˆçš„æµå¤„ç†ç³»ç»Ÿã€‚å…¶ä¸­ä¸€ä¸ªç³»ç»ŸApache Samzaæœ‰ä¸€ä¸ªç‰¹åˆ«æœ‰è¶£çš„â€œhello worldâ€æ•™ç¨‹ï¼Œç”¨äºå¼€å§‹ä½¿ç”¨è¯¥ç³»ç»Ÿ;Hello Samzaä½¿ç”¨ç»´åŸºç™¾ç§‘åœ¨å…¶IRCé¢‘é“ä¸Šå‘å¸ƒçš„å®æ—¶æ›´æ–°ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç›¸åŒçš„æ•™ç¨‹ï¼Œä½†æ˜¯ä½¿ç”¨Apache Kafkaé¡¹ç›®ä¼ä¸‹çš„ä¸¤ä¸ªæ–°æ¨¡å—æ„å»ºï¼Œä¸€ä¸ªæœ€è¿‘å‘å¸ƒï¼Œå¦ä¸€ä¸ªè®¡åˆ’åœ¨å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­å‘å¸ƒã€‚ Kafka Connectæ˜¯Apache Kafka 0.9çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯Apache Kafkaå’Œå…¶ä»–æ•°æ®ç³»ç»Ÿä¹‹é—´å¯ä¼¸ç¼©å’Œå¯é æµæ•°æ®çš„å·¥å…·ã€‚å®ƒæä¾›äº†APIã€è¿è¡Œæ—¶å’ŒRESTæœåŠ¡ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿå®šä¹‰è¿æ¥å™¨ï¼Œä»è€Œå°†å¤§å‹æ•°æ®é›†ç§»å…¥å’Œç§»å‡ºKafkaã€‚å®ƒå…·æœ‰å®¹é”™æ€§å’Œå¼¹æ€§ï¼Œæˆ‘ä»¬å·²ç»ä¹ æƒ¯äº†ï¼Œå¹¶äº§ç”Ÿäºæ•´ä¸ªä¸€ä»£æ‘„é£Ÿå’Œå¸è½½å·¥å…·çš„ç»éªŒã€‚Kafka Connectå¯ä»¥æ‘„å–æ•´ä¸ªæ•°æ®åº“ï¼Œæˆ–è€…ä»æ‰€æœ‰åº”ç”¨æœåŠ¡å™¨æ”¶é›†åº¦é‡æ•°æ®åˆ°Kafkaä¸»é¢˜ä¸­ï¼Œä»è€Œä½¿æ•°æ®èƒ½å¤Ÿä»¥è¾ƒä½çš„å»¶è¿Ÿè¿›è¡Œæµå¤„ç†ã€‚è¿™ç¯‡æ–‡ç« å‘å¸ƒäº†è¯¥ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°é“¾æ¥å’Œæ›´å¤šä¿¡æ¯ã€‚ å¦ä¸€ä¸ªç‰¹æ€§æ˜¯Kafka Streamsâ€”â€”ç”¨äºåˆ›å»ºæµå¤„ç†åº”ç”¨ç¨‹åºçš„è½»é‡çº§åº“ã€‚å°±éƒ¨ç½²è€Œè¨€ï¼Œå®ƒæ˜¯è½»é‡çº§çš„ï¼Œå®é™…ä¸Šåœ¨è¿™æ–¹é¢å®ƒæ˜¯å®Œå…¨â€œå¤±é‡â€çš„ï¼Œä¸åƒå¤§å¤šæ•°(å¦‚æœä¸æ˜¯å…¨éƒ¨çš„è¯)å®ƒçš„å‰è¾ˆå’ŒåŒæ—¶ä»£äººã€‚è¿™ä¸ªåº“ä¹Ÿæ˜¯è½»é‡çº§çš„ï¼Œå› ä¸ºå®ƒæ„å»ºåœ¨Kafkaä¸­é’ˆå¯¹æµå¤„ç†åº”ç”¨ç¨‹åºéœ€è¦å¤„ç†çš„é—®é¢˜(å®¹é”™æ€§ã€åˆ†åŒºã€å¯ä¼¸ç¼©æ€§ã€æ’åºå’Œè´Ÿè½½å¹³è¡¡)æœ¬åœ°æ„å»ºçš„åŸè¯­ä¹‹ä¸Šã€‚å¯¹äºæˆ‘ä»¬è¿™äº›é‡è§†è½¯ä»¶ç®€æ´æ€§çš„äººæ¥è¯´ï¼Œå®ƒæ˜¯é‡é‡çº§å† å†›ï¼Œç”¨ç›¸å¯¹è¾ƒå°‘çš„èµ„æºå®ç°äº†å¦‚æ­¤å¤šçš„æˆå°±ã€‚æ›´å¤šå…³äºèƒŒæ™¯å’Œæ¶æ„:ä»‹ç»Kafkaæµ ä¸ºäº†åˆ›å»ºæˆ‘ä»¬çš„Hello Kafkaæµç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦è¿æ¥Wikipedia IRCé€šé“ï¼Œå°†å®ƒä»¬è½¬æ¢æˆä¸€ä¸ªåˆ†åŒºä¸»é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªä¸»é¢˜æ„å»ºå¤„ç†å™¨æ‹“æ‰‘ã€‚ç›®å‰Kafka Connectè¿˜æ²¡æœ‰å…¬å¼€åµŒå…¥å¼APIï¼Œå°½ç®¡æ‰€æœ‰å¿…è¦çš„æ„å»ºå—éƒ½å·²ç»å°±ç»ª(åœ¨connect-runtimeæ¨¡å—ä¸‹)ã€‚ä½†æ˜¯ï¼Œè¿™é¡¹å·¥ä½œå·²ç»è®¡åˆ’åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¿›è¡Œï¼Œå› æ­¤æˆ‘ä»¬å°†é€šè¿‡åœ¨ConnectEmbedde.javaä¸­åˆ›å»ºè‡ªå·±çš„ä¸´æ—¶æ‰©å±•æ¥åŠ å¿«è¿›åº¦ã€‚ åœ¨æ·±å…¥è®¨è®ºä¹‹å‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è¿è¡Œåˆ°Kafkaçš„è¿æ¥å™¨: ä½œä¸ºä¸€ä¸ªè¿æ¥å™¨åœ¨é›†ç¾¤è¿›ç¨‹ä¸Šï¼Œè¿è¡ŒKafka Connectã€‚ ä½œä¸ºåº”ç”¨ç¨‹åºæµç¨‹ä¸­çš„åµŒå…¥å¼å®ä½“ã€‚ æ‚¨å¯èƒ½æƒ³çŸ¥é“ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­åµŒå…¥è¿æ¥å™¨ä¸åœ¨Kafkaè¿æ¥é›†ç¾¤ä¸­ä½œä¸ºé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ç›¸æ¯”ï¼Œä»€ä¹ˆæ—¶å€™æ›´å¥½ã€‚ è¿æ¥å™¨æ›´å¥½åœ°ä½œä¸ºé•¿æœŸè¿è¡Œçš„Kafkaè¿æ¥æµç¨‹æ¥æ“ä½œï¼Œä»¥ä¾¿åœ¨å…±äº«å’Œæ ‡å‡†æ•°æ®ç³»ç»Ÿä¹‹é—´æ”¯æŒæµETLæµã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨MySQLæºè¿æ¥å™¨å’ŒHDFSæ¥æ”¶å™¨è¿æ¥å™¨ä»MySQLæ•°æ®åº“ä¸­æå–æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°Hadoopä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œåªä¸åº”ç”¨ç¨‹åºç›¸å…³çš„è¿æ¥å™¨æ›´æ–¹ä¾¿åœ°ä½œä¸ºåº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­çš„åµŒå…¥å¼å®ä½“è¿è¡Œã€‚ä¾‹å¦‚ï¼Œæœ¬æ–‡ä¸­æè¿°çš„ä¸€ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä¸ºäº†è¿è¡Œä¸€ä¸ªç®€å•çš„æ¼”ç¤ºåº”ç”¨ç¨‹åºè€Œå•ç‹¬è¿è¡ŒæœåŠ¡å’Œç®¡ç†è¿æ¥å™¨ï¼Œè¿™ä¼šå¢åŠ å¤æ‚æ€§ã€‚æœ‰è¶£çš„æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ç¨‹åºä¸­å¸¸å¸¸æ˜¯è¿™æ ·ï¼Œè€Œä¸ä»…ä»…æ˜¯æ¼”ç¤ºã€‚åœ¨ä¸æ›´æ”¹ä½“ç³»ç»“æ„çš„æƒ…å†µä¸‹é™ä½å¼€å‘çš„å¯ä¼¸ç¼©æ€§æ˜¯å¯ä¼¸ç¼©æ€§çš„ä¸€ä¸ªéå¸¸å®¹æ˜“è¢«å¿½ç•¥çš„æ–¹é¢â€”â€”é€šå¸¸æˆ‘ä»¬åªè€ƒè™‘å°†å¯ä¼¸ç¼©æ€§æé«˜åˆ°æ›´å¤§çš„æ•°æ®é‡æˆ–æ›´é«˜çš„ååé‡ã€‚ å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬ç›´æ¥è¿›å…¥æ„å»ºHello Kafkaæµã€‚ å¦‚æœæ‚¨ç†Ÿæ‚‰è¿™äº›æ¦‚å¿µå’Œapiï¼Œå¯ä»¥è·³è¿‡ä¸‹ä¸€èŠ‚ï¼ŒåªæŸ¥çœ‹GitHubä¸Šçš„æ•´ä¸ªé¡¹ç›®ã€‚ æ³¨æ„:ç”±äºæœ¬æ¼”ç¤ºæ„å»ºåœ¨å³å°†å‘å¸ƒçš„0.10.xç‰ˆæœ¬çš„ç‰¹æ€§ä¹‹ä¸Šï¼Œå› æ­¤æ‚¨è¦ä¹ˆéœ€è¦ä¸Kafkaæµæˆ–Apache Kafkaä¸»å¹²æˆ–æœ¬åœ°å®‰è£…çš„ä»»ä½•0.10.xç‰ˆæœ¬çš„æŠ€æœ¯é¢„è§ˆç›¸ç»“åˆçš„å¹³å° ç»´åŸºç™¾ç§‘å¡å¤«å¡æµæ¼”ç¤º â€”â€” æ­¥éª¤ ä¸Šé¢æ˜¯è¿æ¥å™¨ã€ä¸»é¢˜å’Œå¤„ç†å™¨çš„é›†æˆæ‹“æ‰‘çš„æ¦‚è¿°å›¾ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»é€šç”¨çš„IRCè¿æ¥å™¨ã€‚å®ƒåœ¨è¿™é‡Œç”±3ä¸ªç±»å®ç°ã€‚ä¸»ç±»IRCFeedConnectoræ¥å—IRCä¸»æœºå’Œç«¯å£é…ç½®ã€é€šé“åˆ—è¡¨å’Œè¾“å‡ºä¸»é¢˜ã€‚åœ¨Kafka Connectè®¾è®¡ä¸­ï¼Œè¿æ¥å™¨æ˜¯åºåˆ—åŒ–æ— å…³çš„ã€‚è¿™ä½¿å¾—å®ƒä»¬å¯ä»¥åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¿è¡ŒKafka ConnectæœåŠ¡å¹¶ä½¿ç”¨Avroåºåˆ—åŒ–å™¨è¿›è¡Œé…ç½®ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åƒè¿™æ ·é…ç½®IRCè¿æ¥å™¨ï¼Œæ— éœ€ä¿®æ”¹å³å¯é‡ç”¨å®ƒ: 1234567name=wikipedia-irc-sourceconnector.class=io.amient.kafka.connect.irc.IRCFeedConnectortasks.max=10irc.host=rc.wikimedia.orgirc.port=6667irc.channels=#en.wikipedia,#en.wiktionary,#en.wikinewstopic=wikipedia-raw åœ¨æˆ‘ä»¬çš„ä¸»ç±»WikipediaStreamDemoä¸­ï¼Œæˆ‘ä»¬ç”¨.createWikipediaFeedConnectInstance()æ–¹æ³•ä»¥ç¼–ç¨‹æ–¹å¼æä¾›è¿™ä¸ªé…ç½®ã€‚ç»“æœæ˜¯ä¸€æ ·çš„â€”â€”ä¸ç®¡è¿è¡Œå¤šå°‘ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹ï¼Œæˆ‘ä»¬æœ€å¤šåªèƒ½å¾—åˆ°3ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªé€šé“ä¸€ä¸ªä»»åŠ¡ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨å¯åŠ¨ä¸€ä¸ªåµŒå…¥å¼å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¿…é¡»æä¾›è¾…åŠ©é…ç½®ã€è½¬æ¢å™¨ç­‰ã€‚ä¸ºäº†ä¿æŒæ¼”ç¤ºçš„ç®€æ´ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„org.apache.kafka.connect.json.JsonConverteré™„å¸¦Kafkaï¼Œç”±äºåº•å±‚è®¾è®¡ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ä¸ºä»»ä½•æºæ¨¡å¼å·¥ä½œã€‚ è¿æ¥å®ä¾‹é…ç½®,å‰©ä¸‹æ˜¯è°ƒç”¨æ–¹æ³•.start() ,æˆ‘ä»¬æœ‰æ•ˆåœ°é›†æˆè¿æ¥å™¨ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åº,æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªåè°ƒç»„è¿è¡Œåœ¨å®ƒè‡ªå·±çš„çº¿ç¨‹æ± ,ç¡®ä¿ä¸»é¢˜wikipedia-rawå°†ä¸€è¿ä¸²çš„jsonè¡¨ç¤ºçš„é€šç”¨IRCMessageç»´åŸºç™¾ç§‘æœåŠ¡å™¨ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹.main(â€¦)æ–¹æ³•ä¸­å®šä¹‰çš„é›†æˆæ‹“æ‰‘ï¼Œå®ƒå®é™…ä¸Šæ˜¯ç¨‹åºçš„å”¯ä¸€ä¾‹ç¨‹ï¼Œå…¶ä½™çš„éƒ½æ˜¯å£°æ˜æ€§çš„ã€‚ åœ¨connectå®ä¾‹å¯åŠ¨ä¹‹åï¼Œæµæ‹“æ‰‘å®ä¾‹åŒ–å¹¶å¯åŠ¨ã€‚è¯¥æ–¹æ³•çš„å…¶ä½™éƒ¨åˆ†åªæ˜¯ç¡®ä¿åœ¨å…³é—­æ—¶è¿™ä¸¤ä¸ªæœåŠ¡éƒ½è¢«å¹²å‡€åœ°åœæ­¢ã€‚æœ€åä¸€æ®µä»£ç æ˜¯.createWikipediaStreamsInstance()æ–¹æ³•ï¼Œå®ƒå£°æ˜äº†æµæ‹“æ‰‘ã€‚ åœ¨åˆ›å»ºjson serde helperå®ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å£°æ˜ç¬¬ä¸€ä¸ªKStream&lt;JsonNode, JsonNode&gt; wikipediaRawã€‚é™¤äº†ä»è¿æ¥å™¨ç¦»å¼€çš„åœ°æ–¹å¼€å§‹ã€‚ åœ¨ä¸‹ä¸€æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Java 8çš„æ–¹æ³•å¼•ç”¨æ¥å£°æ˜è¿™ä¸ªwikipedia-rawæ¶ˆæ¯jsonæµä¸Šçš„è½¬æ¢ï¼Œä»¥ä¿æŒç®€æ´ã€‚æ–¹æ³•.parseIRC()æ˜¯ä»Hello Samzaçš„ä½œè€…é‚£é‡Œå€Ÿæ¥çš„ï¼Œç”¨äºæå–å’Œè§£æåŸå§‹ircæ¶ˆæ¯åˆ°WikipediaMessageã€‚æ­¤æ–¹æ³•è¿˜å°†è½¬æ¢åçš„æµçš„é”®æ›´æ”¹ä¸ºæäº¤ç¼–è¾‘çš„ç”¨æˆ·çš„å­—ç¬¦ä¸²ç”¨æˆ·åï¼Œè¿™å¯¹äºæ­£ç¡®çš„æ¯ä¸ªç”¨æˆ·èšåˆæ˜¯å¿…è¦çš„ã€‚è¿‡æ»¤æ‰ä»»ä½•è¡¨ç¤ºè§£æå™¨æ— æ³•ç†è§£çš„æ¶ˆæ¯çš„ç©ºå€¼ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸€ä¸ª&lt;String,WikipediaMessage&gt;æµã€‚ä½¿ç”¨KStreamçš„.through(..)æ–¹æ³•å°†è¿™ä¸ªæµæŒä¹…åŒ–åˆ°ä¸»é¢˜wikipedia-parsedä¸­â€”â€”ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„jsonPOJOSerde&lt;WikipediaMessage&gt;ï¼Œæˆ‘ä»¬è¯´è¿™ä¸ªä¸»é¢˜çš„å†…å®¹ä¹Ÿå°†æ˜¯jsonåºåˆ—åŒ–çš„ã€‚ç”¨äºåˆ†åŒºçš„é”®å°†æ˜¯å‰é¢è½¬æ¢å£°æ˜çš„ä½œè€…çš„ç”¨æˆ·åã€‚ æœ€åä¸€ä¸ªKTable&lt;String, Long&gt;æ˜¯é€šè¿‡è¿‡æ»¤å’Œèšåˆä½¿ç”¨.countByKey()è§£æçš„wikipediaæ¶ˆæ¯æµæ¥å£°æ˜çš„â€”â€”è¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„æœ€ç»ˆè¾“å‡ºï¼Œå®ƒä½¿ç”¨ä½çº§.process()æ–¹æ³•è¿ç»­æ‰“å°æ›´æ–°ã€‚ Key Takeawayså› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå®Œæ•´çš„æµå¤„ç†åº”ç”¨ç¨‹åºï¼Œå®ƒä»å…¬å…±IRCæœåŠ¡å™¨æå–æ•°æ®å¹¶è®¡ç®—ä¸€äº›ä½¿ç”¨åˆ†æã€‚å¦‚æœé‡æ–°å¯åŠ¨å®ƒï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å®ƒè¿˜è®°å¾—æ¯ä¸ªç”¨æˆ·çš„è®¡æ•°çš„æœ€åä¸€ç§çŠ¶æ€â€”â€”KTableä¿å­˜åœ¨ä¸€ä¸ªæ›´æ”¹æ—¥å¿—ä¸»é¢˜ä¸­ï¼Œä¸‹æ¬¡å°†ä»è¯¥ä¸»é¢˜ä¸­æ¢å¤ã€‚ æˆ‘ä»¬å°†è¯´æ˜å…³äºå‰é¢ä¸€ç‚¹çš„é™çº§:æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œhello-kafkaæµçš„ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨IDEä¸­è¿è¡Œç¬¬äºŒä¸ªå®ä¾‹ï¼Œä»¥è°ƒè¯•å®ä¾‹åœ¨ä½œä¸ºç»„çš„ä¸€éƒ¨åˆ†æ—¶çš„è¡Œä¸ºâ€”â€”è¿™åœ¨åƒYARNè¿™æ ·çš„æ¡†æ¶ä¸­é•¿æœŸéš¾ä»¥å®ç°ã€‚ ç”±äºä¸æ¶‰åŠéƒ¨ç½²æ¡†æ¶ï¼Œä¸”æ‰€æœ‰å®ä¾‹éƒ½æ˜¯ç›¸åŒçš„(åŒ…æ‹¬é…ç½®ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œé…ç½®æ˜¯ç›´æ¥çƒ§å…¥ä¸»ç±»çš„)ï¼Œå› æ­¤æ‰€æœ‰éƒ¨ç½²é€‰é¡¹éƒ½æ˜¯å¯ç”¨çš„;æ— è®ºæ‚¨é€‰æ‹©å°†æµå¤„ç†åº”ç”¨ç¨‹åºæ‰“åŒ…åˆ°Dockerä¸­å¹¶åœ¨Mesosä¸Šè¿è¡Œï¼Œè¿˜æ˜¯ä»Chefæ›´æ”¹ä¸ºPuppetè¿›è¡Œé…ç½®ç®¡ç†ï¼Œæµå¤„ç†åº”ç”¨ç¨‹åºéƒ½å°†ä¿æŒä¸å˜ã€‚ éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå½“åº”ç”¨ç¨‹åºè¢«å…³é—­æ—¶ï¼ŒIRCé€šé“æ²¡æœ‰ä»»ä½•å¤„ç†ï¼Œè¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå› ä¸ºæ²¡æœ‰è®¡ç®—ç¼–è¾‘ã€‚æ¯å½“è¿æ¥å™¨ç»„ä¸­çš„å·¥ä½œå‘ç”Ÿé‡æ–°å¹³è¡¡æ—¶ï¼Œéƒ½ä¼šå‘ç”Ÿç›¸åŒçš„æ•°æ®ä¸¢å¤±ï¼Œä½†è¿™åªæ˜¯IRCé€šé“çš„ä¸€ä¸ªç‰¹æ€§â€”å¦‚æœè„±æœºï¼Œå°±ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œå¹¶ä¸”å…¶ä¸­æ²¡æœ‰è¡¥å¿çš„æ¦‚å¿µã€‚å¦‚æœä½ æƒ³è¦æ›´å¤šçš„æ— æŸçš„è¿™ä¸ªæ¼”ç¤ºæœ€å¥½çš„å˜ä½“,ä½ æ‰€èƒ½åšçš„å°±æ˜¯å‡å°‘åº”ç”¨ç¨‹åºåœæœºæ—¶é—´æ˜¯å¦ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜ä¹Ÿè®¸â€”â€”æˆ–è€…ä½¿ç”¨ä¸€ä¸ªæ•°æ®æºæœ‰åç§»çš„æ¦‚å¿µ,è‡³å°‘ä¸€ä¸ªæ—¶é—´æˆ³,å¡å¤«å¡è¿æ¥å°†æ„‰å¿«åœ°åšç®¡ç†çš„å·¥ä½œæœ€åä¸€ä¸ªå¯é åœ°æ¶ˆè€—è¡¥å¿ã€‚ è‡³äºKafkaæµå’ŒKafka Connectçš„é›†æˆï¼Œæœ‰ä¸€ç§æƒ…å†µæ˜¯ä¸¤è€…ä¹‹é—´çš„ä¸€çº§é›†æˆï¼Œè¿™æ ·è¿æ¥å™¨å°±å¯ä»¥ç›´æ¥æ˜ å°„åˆ°KStreamï¼Œä»è€Œå…è®¸åœ¨è¿æ¥å™¨çš„è¾“å‡ºä¸Šç›´æ¥åº”ç”¨ä»»ä½•æµè½¬æ¢ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªwikipediaæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¶ˆé™¤wiki-rawä¸»é¢˜ï¼Œå¹¶ç«‹å³æŒ‰ç”¨æˆ·ååº”ç”¨è§£æå’Œåˆ†åŒºï¼Œåœ¨ä¸ç‰ºç‰²åº”ç”¨ç¨‹åºä»»ä½•æœ‰ç”¨ç‰¹æ€§çš„æƒ…å†µä¸‹æ”¹å–„å»¶è¿Ÿå’Œå­˜å‚¨å ç”¨ã€‚ é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ç§å¯èƒ½çš„å®ç°ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é‡ç”¨äº†å¤§éƒ¨åˆ†ç°æœ‰çš„ä»£ç ï¼Œå¹¶åœ¨æµæ„å»ºå™¨ä¸Šå¼•å…¥äº†ä¸€ä¸ªæ–°çš„é‡è½½æ–¹æ³•.stream(â€¦)ï¼Œè¯¥æ–¹æ³•æ²¡æœ‰å°†ä¸»é¢˜åä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ä¸ªä¸ConnectEmbeddedç±»ä¼¼çš„å®ä¾‹ï¼Œåªä¸è¿‡æˆ‘ä»¬å°†å®ƒç§°ä¸ºEmbeddedConnectSource: ä¸Šé¢ï¼Œæ–¹æ³•æ–¹æ³•createConnectSource()ä½¿ç”¨ä¸æˆ‘ä»¬çš„å·¥ä½œæ¼”ç¤ºè§£å†³æ–¹æ¡ˆçš„æ–¹æ³•createWikipediaFeedConnectInstance()ç›¸åŒçš„é…ç½®ã€‚æˆ‘ä»¬ä½¿ç”¨JsonConverterå°†æºIRCMessageè½¬æ¢ä¸ºåºåˆ—åŒ–çš„jsonã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ç«‹å³å‘Šè¯‰æµæ„å»ºå™¨å°†è¿™äº›åºåˆ—åŒ–çš„æ•°æ®è§£æå›JsonNodeï¼Œè€ŒJsonNodeåˆè¢«è§£æ„ä¸ºWikipediaMessageã€‚å¦‚æœåˆ†æè¿™ä¸ªå®ç°ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°è¿™ä¸ªè½¬æ¢ã€è§£æå’Œè§£æ„å ç”¨äº†æ•´ä¸ªç¨‹åºçš„å¤§éƒ¨åˆ†CPUå‘¨æœŸã€‚ å¦‚æœåªç»™æµæ„å»ºå™¨è¿æ¥å™¨é…ç½®(è€Œä¸æ˜¯å·¥ä½œé…ç½®)å¹¶è¿”å›SchemaAndValueå¯¹è±¡æµï¼Œåˆ™å¯ä»¥é¿å…è½¬æ¢ä¸ºjsonå¹¶éšåè§£æåˆ°JsonNodeçš„æ›´æœ‰æ•ˆç‰ˆæœ¬ã€‚è¿™å°†éœ€è¦å…¬å¼€ä¸€äº›è¿æ¥å™¨å†…éƒ¨ï¼Œè€Œä¸”åœ¨Kafkaç«¯å®ç°èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œä½†æ˜¯å¯ä»¥èŠ‚çœå‘¨æœŸï¼Œè€Œä¸”åœ¨åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–ä»£ç æ–¹é¢ä¹Ÿæ¯”è¾ƒå°‘å™ªéŸ³: ä¸ç®¡æ€æ ·ï¼Œé›†æˆAPIå¾ˆå¿«å°±ä¼šå‡ºç°ã€‚è¯·ç»§ç»­å…³æ³¨! ç»“è®º å»ºåœ¨æ­£ç¡®çš„åŸºç¡€ä¸Š: Apache Kafkaä¸­çš„åŸºæœ¬åŸè¯­å·²ç»è¢«è¯æ˜æ˜¯æˆåŠŸçš„ï¼Œå¹¶ä¸”ä¸ºå®ç°æµå¤„ç†æ“ä½œæä¾›äº†æ­£ç¡®çš„æ„å»ºå—ï¼Œæ— è®ºæ˜¯å®æ—¶æ‘„å–è¿˜æ˜¯æµå¤„ç†ã€‚ç”±æ­¤äº§ç”Ÿçš„ç®€å•æ€§åœ¨åŸºç¡€è®¾æ–½å·¥å…·æ–¹é¢å¤§æœ‰è£¨ç›Šã€‚æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬ä¸ºè®¸å¤šä¸åŒçš„ç³»ç»Ÿæ„å»ºå’Œæ“ä½œæ’ä»¶ï¼Œå› æ­¤ä¸åœ¨æ•°æ®ä¸­å¿ƒä¸­å¿ƒæ‹¥æœ‰ä¸€ä¸ªå¹³å°ç›¸æ¯”ï¼Œå®ƒä»¬çš„å¸å¼•åŠ›è¦å°å¾—å¤šã€‚ æ˜“äºæ¥è¿‘å’Œå¼€å‘äººå‘˜å‹å¥½: ä½¿ç”¨Connectå’ŒStreams(åŒ…æ‹¬åµŒå…¥å¼è¿è¡Œæ—¶æ‰©å±•)ç¼–å†™æ¼”ç¤ºç¨‹åºèŠ±è´¹çš„æ—¶é—´(ä¸€å¤©)ä¸ç†è§£ã€æ‰“åŒ…å’Œåœ¨çœŸå®é›†ç¾¤ä¸Šéƒ¨ç½²Hello Samzaæ‰€ç”¨çš„æ—¶é—´å·®ä¸å¤š ä½ æ‰€éœ€è¦çš„: å°†Kafkaã€Kafka Connectå’ŒKafkaæµä¸€èµ·ä½¿ç”¨ä¸ä»…æ˜¯å¯èƒ½çš„ï¼Œè€Œä¸”å®ƒè¿˜æä¾›äº†ç¼–å†™æµå¤„ç†åº”ç”¨ç¨‹åºçš„å®Œæ•´å·¥å…·ã€‚","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"}]},{"title":"IIoTæ¶ˆæ¯é˜Ÿåˆ—(IoT MQ)é€‰å‹","slug":"things-queue-selection","date":"2018-11-01T02:48:24.000Z","updated":"2020-07-25T02:57:18.230Z","comments":true,"path":"2018/11/01/things-queue-selection/","link":"","permalink":"https://jigangduan.github.io/2018/11/01/things-queue-selection/","excerpt":"","text":"ä¸ºä»€ä¹ˆè¢«éœ€è¦MQï¼ŸIIoTä½œä¸ºè®¾å¤‡æ¥å…¥å’Œä¸šåŠ¡å±‚æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œå…¶æœ€é‡è¦çš„èŒèƒ½åœ¨äºæä¾›ä¸€ä¸ªç»Ÿä¸€æ¥å£: è§£è€¦ä¸Šä¸‹å„ä¸ªä¸åŒç³»ç»Ÿçš„ä¹‹é—´çš„å…³è”æ€§ï¼Œä½¿å®ƒä»¬ä¹‹é—´å¯ä»¥ä¸ç›´æ¥ä¾èµ– åŒæ„ç³»ç»Ÿä¸­æ¯ä¸ªç»“ç‚¹ä¸Šçš„ä¸€è‡´æ€§ï¼Œæ˜¯å„ä¸ªç³»ç»Ÿç›´æ¥å¯ä»¥äº¤æµ çµæ´»åœ°æ·»åŠ ç»„ä»¶æˆ–é€‚é…ç³»ç»Ÿï¼Œä½¿å…¶ç»“æ„çµæ´»ï¼Œæ˜“äºæ‰©å…… ä¸ºäº†è¾¾åˆ°è¿™ä¸‰ä¸ªåŠŸèƒ½ï¼Œé—¨é¢æ¨¡å¼+é€‚é…å™¨+è§‚å¯Ÿè€…æ¨¡å¼ çš„è®¾è®¡æ¨¡å¼éå¸¸é€‚åˆï¼Œé‚£ä¹ˆæ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯æœ€ä½³é€‰æ‹©äº†ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºé—¨é¢ï¼Œä½œä¸ºå„ä¸ªç³»ç»Ÿçš„æ¥å…¥ç‚¹ï¼Œè§£è€¦äº†å®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³è”ï¼›æˆ‘ä»¬è¿˜éœ€è¦åˆ¶å®šä¸€å¥—ç»Ÿä¸€çš„æ¶ˆæ¯æ ‡å‡†ï¼ŒåŒæ„å„ä¸ªç³»ç»Ÿçš„æ¥å…¥æ–¹å¼ï¼›ä¸ºäº†æ»¡è¶³å·²æœ‰çš„åè®®å’Œç³»ç»Ÿï¼Œéœ€è¦ä½¿ç”¨é€‚é…å™¨çš„æ–¹å¼ï¼Œè®©å®ƒä»¬å…¼å®¹åˆ°æ•´ä¸ªçš„ç³»ç»Ÿä¸­æ¥ã€‚ ç‰¹æ€§éœ€æ±‚å„ä¸ªä¸åŒçš„ç³»ç»Ÿå¯èƒ½åŒ…æ‹¬é‡‡å–æœåŠ¡ï¼Œå„ç±»è®¾å¤‡ï¼Œæ•°æ®ä¸­å¿ƒæˆ–SCADAç­‰ï¼Œä¸ºäº†æ»¡è¶³è¿™äº›ä¸åŒçš„ç³»ç»Ÿéœ€è¦æ»¡è¶³å¦‚ä¸‹ç‰¹æ€§ï¼š å®æ—¶æ€§é«˜å¹¶å‘å¯é æ€§å®‰å…¨é˜²æŠ¤å¯æ‰©å±• æ¶ˆæ¯é˜Ÿåˆ—åè®®å¯¹æ¯”ä¸ºäº†æ‰¾åˆ°åˆé€‚çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œé€‰å®šå‡ ä¸ªæ¶ˆæ¯é˜Ÿåˆ—åè®®è¿›è¡Œå¯¹æ¯”æ¥æ‰¾åˆ°åˆé€‚æ–¹å¼ã€‚ MQTTï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰ï¼Œåœ¨ç‰©è”ç½‘ã€å°å‹è®¾å¤‡ã€ç§»åŠ¨åº”ç”¨ç­‰æ–¹é¢æœ‰è¾ƒå¹¿æ³›çš„åº”ç”¨ AMQPï¼ˆçº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†,ä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ Kafka(ä¸æ˜¯åè®®ï¼Œæ˜¯æ¶ˆæ¯ç³»ç»Ÿ)ï¼Œè§£å†³æœ‰ååé‡è¦æ±‚è€Œçš„æ—¥å¿—å’Œæ•°æ®èšåˆä½œç”¨ æ¯”è¾ƒé¡¹ï¼š ä»ä¸Šé¢å„é¡¹æ¯”è¾ƒå¯ä»¥å¾—çŸ¥ï¼ŒMQTTä¼˜åŠ¿æ˜¯å®æ—¶æ€§ï¼ŒKafkaä¼˜åŠ¿æ˜¯æ•°æ®èšåˆï¼ŒAMQPä¼˜åŠ¿æ˜¯åº”å±‚è§£è€¦ æ–¹æ¡ˆå»ºè®®EMQ+KafkaMQTTåè®®åº”ç”¨åœºæ™¯å¤§å¤šæ˜¯åœ¨ç‰©è”ç½‘è®¾å¤‡çš„æ¥å…¥ï¼Œå¯¹çŸ­æ•°æ®æœ‰éå¸¸é€‚åº”çš„å®æ—¶æ€§ç‰¹ç‚¹ï¼ŒKafkaå’ŒAMQPçš„å®æ—¶æ€§éƒ½ä¸åŠMQTTã€‚MQTTä¸“é—¨ä¸ºç‰©è”ç½‘è®¾è®¡ï¼Œå¯ä»¥ç›´æ¥æ¥å…¥æ”¯æŒMQTTåè®®çš„è®¾å¤‡ï¼Œè½¯ä»¶ï¼Œç³»ç»Ÿæˆ–ç§»åŠ¨ç«¯ã€‚ç›®å‰å¤§å¤šçš„ç‰©è”ç½‘å¹³å°çš„åšæ³•æ˜¯ä½¿ç”¨MQTTåšè®¾å¤‡ä¸Šä¼ åè®®ï¼Œå¦‚æœæ˜¯å…¶ä»–é‡‡é›†åè®®ï¼Œå°±ä½¿ç”¨ç½‘å…³åšåè®®è½¬æ¢å™¨ï¼Œå¦‚ä¸‹ï¼š ä½†æˆ‘ä»¬å…¬å¸ä¸ç”¨é€‰æ‹©è®¾å¤‡çš„åŸå› ï¼Œå…¶å»ºè®®åè®®è½¬æ¢åŠŸèƒ½åœ¨é‡‡é›†æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿæ˜¯åšä¸ºåè®®é€‚é…çš„åŠŸæ•ˆï¼Œå…¶é€‚é…å™¨å¯ä»¥å°½é‡çµæ´»éƒ¨ç½²ï¼Œå¯èƒ½æ˜¯æ’ä»¶ï¼ŒæœåŠ¡å™¨åº”ç”¨ï¼Œæ¡Œé¢åº”ç”¨å’ŒLinuxè®¾å¤‡ç­‰ã€‚ MQTTåœ¨å®æ—¶æ€§ä¸Šè¡¨ç°ä¼˜å¼‚ä½†åœ¨æ•°æ®èšåˆæ–¹é¢ä¸Šä¸è¶³ï¼Œæ‰€ä»¥å»ºè®®EMQ+Kafkaçš„æ¨¡å¼ã€‚å¦‚æœæ•°æ®æ˜¯è¾“å‡ºç»™ç±»ä¼¼ETLï¼ˆæ•°å­—ä»“åº“ï¼‰è¿™æ ·çš„ï¼Œéœ€è¦é€šè¿‡Kafkaä½œç¼“å†²å’Œèšåˆï¼›å¦‚æœæ˜¯è¿æ¥åˆ°SCADAè¿™æ ·çš„ç³»ç»Ÿï¼Œç›´æ¥é€šè¿‡EMQå°±å¯ä»¥äº†ã€‚ EMQç®€ä»‹EMQæ˜¯ç™¾ä¸‡çº§åˆ†å¸ƒå¼å¼€æºç‰©è”ç½‘MQTTæ¶ˆæ¯æœåŠ¡å™¨ã€‚åŸºäºé«˜å¹¶å‘çš„Erlang/OTPè¯­è¨€å¹³å°è®¾è®¡ï¼Œæ”¯æŒç™¾ä¸‡çº§è¿æ¥å’Œåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å¼€æºMQTTæ¶ˆæ¯æœåŠ¡å™¨ã€‚å®Œæ•´æ”¯æŒMQTT V3.1/V3.1.1åè®®è§„èŒƒï¼Œæ‰©å±•æ”¯æŒWebSocketã€Stompã€CoAPã€MQTT-SNæˆ–ç§æœ‰TCPåè®®ã€‚ å®˜ç½‘äº†è§£æ›´å¤šï¼š http://emqtt.comhttps://www.emqx.ioGitHub","categories":[{"name":"IoT","slug":"IoT","permalink":"https://jigangduan.github.io/categories/IoT/"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"IoT/æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://jigangduan.github.io/categories/IoT/æ¶ˆæ¯é˜Ÿåˆ—/"}],"tags":[{"name":"iot","slug":"iot","permalink":"https://jigangduan.github.io/tags/iot/"},{"name":"mq","slug":"mq","permalink":"https://jigangduan.github.io/tags/mq/"}]},{"title":"GitHubç²¾é€‰-PaaS","slug":"github-paas","date":"2018-10-30T15:37:18.000Z","updated":"2020-07-25T02:57:18.202Z","comments":true,"path":"2018/10/30/github-paas/","link":"","permalink":"https://jigangduan.github.io/2018/10/30/github-paas/","excerpt":"","text":"Nacos Rainbond Naftis nacos ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°. åŠŸèƒ½æœåŠ¡ç®¡ç†å¼€å‘è€…æˆ–è€…è¿ç»´äººå‘˜å¾€å¾€éœ€è¦åœ¨æœåŠ¡æ³¨å†Œåï¼Œé€šè¿‡å‹å¥½çš„ç•Œé¢æ¥æŸ¥çœ‹æœåŠ¡çš„æ³¨å†Œæƒ…å†µï¼ŒåŒ…æ‹¬å½“å‰ç³»ç»Ÿæ³¨å†Œçš„æ‰€æœ‰æœåŠ¡å’Œæ¯ä¸ªæœåŠ¡çš„è¯¦æƒ…ã€‚å¹¶åœ¨æœ‰æƒé™æ§åˆ¶çš„æƒ…å†µä¸‹ï¼Œè¿›è¡ŒæœåŠ¡çš„ä¸€äº›é…ç½®çš„ç¼–è¾‘æ“ä½œã€‚Nacosåœ¨è¿™ä¸ªç‰ˆæœ¬å¼€æ”¾çš„æ§åˆ¶å°çš„æœåŠ¡å‘ç°éƒ¨åˆ†ï¼Œä¸»è¦å°±æ˜¯æä¾›ç”¨æˆ·ä¸€ä¸ªåŸºæœ¬çš„è¿ç»´é¡µé¢ï¼Œèƒ½å¤ŸæŸ¥çœ‹ã€ç¼–è¾‘å½“å‰æ³¨å†Œçš„æœåŠ¡ã€‚ æœåŠ¡åˆ—è¡¨ç®¡ç†æœåŠ¡åˆ—è¡¨å¸®åŠ©ç”¨æˆ·ä»¥ç»Ÿä¸€çš„è§†å›¾ç®¡ç†å…¶æ‰€æœ‰çš„å¾®æœåŠ¡ä»¥åŠæœåŠ¡å¥åº·çŠ¶æ€ã€‚æ•´ä½“ç•Œé¢å¸ƒå±€æ˜¯å·¦ä¸Šè§’æœ‰æœåŠ¡çš„æœç´¢æ¡†å’Œæœç´¢æŒ‰é’®ï¼Œé¡µé¢ä¸­å¤®æ˜¯æœåŠ¡åˆ—è¡¨çš„å±•ç¤ºã€‚æœåŠ¡åˆ—è¡¨ä¸»è¦å±•ç¤ºæœåŠ¡åã€é›†ç¾¤æ•°ç›®ã€å®ä¾‹æ•°ç›®ã€å¥åº·å®ä¾‹æ•°ç›®å’Œè¯¦æƒ…æŒ‰é’®äº”ä¸ªæ ç›®ã€‚ åœ¨æœåŠ¡åˆ—è¡¨é¡µé¢ç‚¹å‡»è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡çš„è¯¦æƒ…ã€‚å¯ä»¥æŸ¥çœ‹æœåŠ¡ã€é›†ç¾¤å’Œå®ä¾‹çš„åŸºæœ¬ä¿¡æ¯ã€‚ æœåŠ¡æµé‡æƒé‡æ”¯æŒåŠæµé‡ä¿æŠ¤Nacos ä¸ºç”¨æˆ·æä¾›äº†æµé‡æƒé‡æ§åˆ¶çš„èƒ½åŠ›ï¼ŒåŒæ—¶å¼€æ”¾äº†æœåŠ¡æµé‡çš„é˜ˆå€¼ä¿æŠ¤ï¼Œä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„ä¿æŠ¤æœåŠ¡æœåŠ¡æä¾›è€…é›†ç¾¤ä¸è¢«æ„å¤–æ‰“å®ã€‚å¦‚ä¸‹å›¾æ‰€ä»¥ï¼Œå¯ä»¥ç‚¹å‡»å®ä¾‹çš„ç¼–è¾‘æŒ‰é’®ï¼Œä¿®æ”¹å®ä¾‹çš„æƒé‡ã€‚å¦‚æœæƒ³å¢åŠ å®ä¾‹çš„æµé‡ï¼Œå¯ä»¥å°†æƒé‡è°ƒå¤§ï¼Œå¦‚æœä¸æƒ³å®ä¾‹æ¥æ”¶æµé‡ï¼Œåˆ™å¯ä»¥å°†æƒé‡è®¾ä¸º0ã€‚ æœåŠ¡å…ƒæ•°æ®ç®¡ç†Nacosæä¾›å¤šä¸ªç»´åº¦çš„æœåŠ¡å…ƒæ•°æ®çš„æš´éœ²ï¼Œå¸®åŠ©ç”¨æˆ·å­˜å‚¨è‡ªå®šä¹‰çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä»¥K-Vçš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œåœ¨æ§åˆ¶å°ä¸Šï¼Œä¼šä»¥k1=v1,k2=v2è¿™æ ·çš„æ ¼å¼å±•ç¤ºã€‚ç±»ä¼¼çš„ï¼Œç¼–è¾‘å…ƒæ•°æ®å¯ä»¥é€šè¿‡ç›¸åŒçš„æ ¼å¼è¿›è¡Œã€‚ä¾‹å¦‚æœåŠ¡çš„å…ƒæ•°æ®ç¼–è¾‘ï¼Œé¦–å…ˆç‚¹å‡»æœåŠ¡è¯¦æƒ…é¡µå³ä¸Šè§’çš„â€œç¼–è¾‘æœåŠ¡â€æŒ‰é’®ï¼Œç„¶ååœ¨å…ƒæ•°æ®è¾“å…¥æ¡†è¾“å…¥ï¼šversion=1.0,env=prodã€‚ ç‚¹å‡»ç¡®è®¤ï¼Œå°±å¯ä»¥åœ¨æœåŠ¡è¯¦æƒ…é¡µé¢ï¼Œçœ‹åˆ°æœåŠ¡çš„å…ƒæ•°æ®å·²ç»æ›´æ–°äº†ã€‚ æœåŠ¡ä¼˜é›…ä¸Šä¸‹çº¿Nacosè¿˜æä¾›æœåŠ¡å®ä¾‹çš„ä¸Šä¸‹çº¿æ“ä½œï¼Œåœ¨æœåŠ¡è¯¦æƒ…é¡µé¢ï¼Œå¯ä»¥ç‚¹å‡»å®ä¾‹çš„â€œä¸Šçº¿â€æˆ–è€…â€œä¸‹çº¿â€æŒ‰é’®ï¼Œè¢«ä¸‹çº¿çš„å®ä¾‹ï¼Œå°†ä¸ä¼šåŒ…å«åœ¨å¥åº·çš„å®ä¾‹åˆ—è¡¨é‡Œã€‚ é…ç½®ç®¡ç†Nacosæ”¯æŒåŸºäºNamespaceå’ŒGroupçš„é…ç½®åˆ†ç»„ç®¡ç†ï¼Œä»¥ä¾¿ç”¨æˆ·æ›´çµæ´»çš„æ ¹æ®è‡ªå·±çš„éœ€è¦æŒ‰ç…§ç¯å¢ƒæˆ–è€…åº”ç”¨ã€æ¨¡å—ç­‰åˆ†ç»„ç®¡ç†å¾®æœåŠ¡ä»¥åŠSpringçš„å¤§é‡é…ç½®ï¼Œåœ¨é…ç½®ç®¡ç†ä¸­ä¸»è¦æä¾›äº†é…ç½®å†å²ç‰ˆæœ¬ã€å›æ»šã€è®¢é˜…è€…æŸ¥è¯¢ç­‰æ ¸å¿ƒç®¡ç†èƒ½åŠ›ã€‚ å¤šé…ç½®æ ¼å¼ç¼–è¾‘å™¨Nacosæ”¯æŒ YAMLã€Propertiesã€TEXTã€JSONã€XMLã€HTML ç­‰å¸¸è§é…ç½®æ ¼å¼åœ¨çº¿ç¼–è¾‘ã€è¯­æ³•é«˜äº®ã€æ ¼å¼æ ¡éªŒï¼Œå¸®åŠ©ç”¨æˆ·é«˜æ•ˆç¼–è¾‘çš„åŒæ—¶å¤§å¹…é™ä½æ ¼å¼é”™è¯¯å¸¦æ¥çš„é£é™©ã€‚ Nacosæ”¯æŒé…ç½®æ ‡ç­¾çš„èƒ½åŠ›ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½ã€æ›´çµæ´»çš„åšåˆ°åŸºäºæ ‡ç­¾çš„é…ç½®åˆ†ç±»åŠç®¡ç†ã€‚åŒæ—¶æ”¯æŒç”¨æˆ·å¯¹é…ç½®åŠå…¶å˜æ›´è¿›è¡Œæè¿°ï¼Œæ–¹é¢å¤šäººæˆ–è€…è·¨å›¢é˜Ÿåä½œç®¡ç†é…ç½®ã€‚ ç¼–è¾‘DIFFNacosæ”¯æŒç¼–è¾‘DIFFèƒ½åŠ›ï¼Œå¸®åŠ©ç”¨æˆ·æ ¡éªŒä¿®æ”¹å†…å®¹ï¼Œé™ä½æ”¹é”™å¸¦æ¥çš„é£é™© ç¤ºä¾‹ä»£ç Nacosæä¾›ç¤ºä¾‹ä»£ç èƒ½åŠ›ï¼Œèƒ½å¤Ÿè®©æ–°æ‰‹å¿«é€Ÿä½¿ç”¨å®¢æˆ·ç«¯ç¼–ç¨‹æ¶ˆè´¹è¯¥é…ç½®ï¼Œå¤§å¹…é™ä½æ–°æ‰‹ä½¿ç”¨é—¨æ§›ã€‚ ç›‘å¬è€…æŸ¥è¯¢Nacosæä¾›é…ç½®è®¢é˜…è€…å³ç›‘å¬è€…æŸ¥è¯¢èƒ½åŠ›ï¼ŒåŒæ—¶æä¾›å®¢æˆ·ç«¯å½“å‰é…ç½®çš„MD5æ ¡éªŒå€¼ï¼Œä»¥ä¾¿å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„æ£€æŸ¥é…ç½®å˜æ›´æ˜¯å¦æ¨é€åˆ° Client ç«¯ã€‚ é…ç½®çš„ç‰ˆæœ¬åŠä¸€é”®å›æ»šNacosé€šè¿‡æä¾›é…ç½®ç‰ˆæœ¬ç®¡ç†åŠå…¶ä¸€é”®å›æ»šèƒ½åŠ›ï¼Œå¸®åŠ©ç”¨æˆ·æ”¹é”™é…ç½®çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ï¼Œé™ä½å¾®æœåŠ¡ç³»ç»Ÿåœ¨é…ç½®ç®¡ç†ä¸Šçš„ä¸€å®šä¼šé‡åˆ°çš„å¯ç”¨æ€§é£é™©ã€‚ å‘½åç©ºé—´ç®¡ç†Nacos åŸºäºNamespace å¸®åŠ©ç”¨æˆ·é€»è¾‘éš”ç¦»å¤šä¸ªå‘½åç©ºé—´ï¼Œè¿™å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„ç®¡ç†æµ‹è¯•ã€é¢„å‘ã€ç”Ÿäº§ç­‰å¤šç¯å¢ƒæœåŠ¡å’Œé…ç½®ï¼Œè®©æ¯ä¸ªç¯å¢ƒçš„åŒä¸€ä¸ªé…ç½®ï¼ˆå¦‚æ•°æ®åº“æ•°æ®æºï¼‰å¯ä»¥å®šä¹‰ä¸åŒçš„å€¼ã€‚ Rainbond Rainbondæ˜¯ä»¥åº”ç”¨ä¸ºä¸­å¿ƒçš„ PaaSï¼Œé¢†å…ˆçš„ç†å¿µå’Œå®Œæ•´çš„ç”Ÿæ€æºè‡ªäºä¸æ–­çš„éªŒè¯å’Œä¼˜åŒ–ã€‚ Rainbondï¼ˆäº‘å¸®ï¼‰æ˜¯â€ä»¥åº”ç”¨ä¸ºä¸­å¿ƒâ€çš„å¼€æºPaaSï¼Œ æ·±åº¦æ•´åˆåŸºäºKubernetesçš„å®¹å™¨ç®¡ç†ã€ServiceMeshå¾®æœåŠ¡æ¶æ„æœ€ä½³å®è·µã€å¤šç±»å‹CI/CDåº”ç”¨æ„å»ºä¸äº¤ä»˜ã€å¤šæ•°æ®ä¸­å¿ƒèµ„æºç®¡ç†ç­‰æŠ€æœ¯ï¼Œ ä¸ºç”¨æˆ·æä¾›äº‘åŸç”Ÿåº”ç”¨å…¨ç”Ÿå‘½å‘¨æœŸè§£å†³æ–¹æ¡ˆï¼Œæ„å»ºåº”ç”¨ä¸åŸºç¡€è®¾æ–½ã€åº”ç”¨ä¸åº”ç”¨ã€åŸºç¡€è®¾æ–½ä¸åŸºç¡€è®¾æ–½ä¹‹é—´äº’è”äº’é€šçš„ç”Ÿæ€ä½“ç³»ï¼Œ æ»¡è¶³æ”¯æ’‘ä¸šåŠ¡é«˜é€Ÿå‘å±•æ‰€éœ€çš„æ•æ·å¼€å‘ã€é«˜æ•ˆè¿ç»´å’Œç²¾ç›Šç®¡ç†éœ€æ±‚ã€‚ åŠŸèƒ½ç‰¹æ€§åº”ç”¨ç®¡ç† åº”ç”¨çº§ï¼ˆå®Œæ•´ä¸šåŠ¡ç³»ç»Ÿï¼‰ç¼–æ’ é›†æˆ Kubernetes çš„æœåŠ¡ç»„ä»¶çº§ç¼–æ’ä¸è°ƒåº¦ åŸºäºæ‰©å±•å¼ ServiceMesh çš„æœåŠ¡ç½‘æ ¼ç³»ç»Ÿæä¾›åŸç”Ÿå¾®æœåŠ¡æ²»ç†æ”¯æŒï¼ˆæœåŠ¡å‘ç°ã€åŠ¨æ€è·¯ç”±ã€é™æµä¸ç†”æ–­ï¼‰ æ”¯æŒå…¶ä»–å„ç±»(SpringCloudã€Dubboã€API-Gateway)å¾®æœåŠ¡æ¶æ„ æ”¯æŒå¤šç§(HTTPã€Mysql)ç±»å‹åè®®çš„ä¸šåŠ¡çº§åº”ç”¨æ€§èƒ½åˆ†æ æ”¯æŒåŸºäºæºä»£ç ï¼ˆJavaã€PHPã€Pythonã€Golangã€Ruby ç­‰ï¼‰æ„å»ºæœåŠ¡ æ”¯æŒåŸºäºå…¬(ç§)æœ‰Gitã€Svn ä»£ç ä»“åº“ã€é•œåƒä»“åº“æˆ–å¯¹æ¥ç¬¬ä¸‰æ–¹CIç³»ç»Ÿçš„æœåŠ¡æŒç»­æ„å»ºå’Œéƒ¨ç½² æ”¯æŒåŸºäº Docker å®¹å™¨é•œåƒã€Docker-Run å‘½ä»¤ã€DockerCompose æ–‡ä»¶æ™ºèƒ½å¿«æ·æ„å»ºåº”ç”¨ æ”¯æŒåº”ç”¨çº§å…¨é‡å¤‡ä»½ä¸æ¢å¤ï¼Œè·¨ç§Ÿæˆ·æˆ–è·¨æ•°æ®ä¸­å¿ƒè¿ç§»åº”ç”¨ æœåŠ¡æ’ä»¶ä½“ç³»æ”¯æŒï¼Œçµæ´»æ‰©å±•åº”ç”¨é™„å±åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæ—¥å¿—å¤„ç†ã€é˜²ç«å¢™ã€æµé‡åˆ†æç­‰ å…¬ï¼ˆç§ï¼‰æœ‰åº”ç”¨å¸‚åœºæ”¯æŒï¼Œå®Œå–„çš„åº”ç”¨äº¤ä»˜ä½“ç³» èµ„æº/äº‘ç®¡ç† ä½œä¸ºå»ºè®¾äº‘åŸç”Ÿæ•°æ®ä¸­å¿ƒçš„åŸºç¡€ç³»ç»Ÿ æ’ä»¶åŒ–æ”¯æŒéƒ¨ç½²ä¸åŒçš„æœåŠ¡ç½‘å…³(Openrestyã€F5ç­‰)ã€SDN ç½‘ç»œï¼ˆMidonetã€Calicoï¼‰ã€åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼ˆGlusterFSã€Ali-NASã€Cephç­‰ï¼‰ æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ(é›†ç¾¤)ç®¡ç†å’Œåº”ç”¨ç¼–æ’ å¹³å°é«˜å¯ç”¨æ”¯æŒ é›†ç¾¤è‡ªåŠ¨åŒ–ç®¡ç†ä¸è¿ç»´ï¼Œè‡ªåŠ¨åŒ–çš„å¥åº·æ£€æŸ¥æœºåˆ¶ èŠ‚ç‚¹ç‰©ç†ç¡¬ä»¶ä¸ç³»ç»ŸæŒ‡æ ‡çš„è‡ªåŠ¨ç›‘æ§ æœåŠ¡å®ä¾‹å®¹å™¨æŒ‡æ ‡è‡ªåŠ¨ç›‘æ§ æ¶æ„ äº§å“å›¾ç¤º Istio ç®¡ç†é¢æ¿ Naftis å¼€å‘å‚å•†: å°ç±³ Naftis æ˜¯ä¸€ä¸ªåŸºäº web çš„ Istio dashboardï¼Œé€šè¿‡ä»»åŠ¡æ¨¡æ¿çš„æ–¹å¼æ¥å¸®åŠ©ç”¨æˆ·æ›´æ–¹ä¾¿åœ°æ‰§è¡Œ Istio ä»»åŠ¡ã€‚ ç”¨æˆ·å¯ä»¥åœ¨ Naftis ä¸­å®šä¹‰è‡ªå·±çš„ä»»åŠ¡æ¨¡æ¿ï¼Œå¹¶å¡«å……å˜é‡æ¥æ„é€ å•ä¸ªæˆ–å¤šä¸ªæ„é€ ä»»åŠ¡å®ä¾‹ï¼Œä»è€Œå®Œæˆå„ç§æœåŠ¡æ²»ç†åŠŸèƒ½ã€‚ åŠŸèƒ½ å†…éƒ¨é›†æˆäº†ä¸€äº›å¸¸ç”¨ dashboard å¯å®šåˆ¶çš„ä»»åŠ¡æ¨¡æ¿æ”¯æŒ æ”¯æŒå›æ»šæŒ‡å®šä»»åŠ¡ æ”¯æŒæŒ‡å®šæ ¹æœåŠ¡èŠ‚ç‚¹çš„æœåŠ¡æ‹“æ‰‘å›¾ æä¾›æŸ¥çœ‹ Istio çš„ Services å’Œ Pod çš„æ”¯æŒ å¼€ç®±å³ç”¨ï¼Œé€šè¿‡ Kubectl ç›¸å…³æŒ‡ä»¤å³å¯å¿«é€Ÿéƒ¨ç½² æ”¯æŒ Istio 1.0 é¢„è§ˆDashboardDashboard é¡µé¢é›†æˆäº†ä¸€äº›å¸¸ç”¨çš„å›¾è¡¨ï¼Œæ¯”å¦‚è¯·æ±‚æˆåŠŸç‡ã€4XXè¯·æ±‚æ•°é‡ç­‰ã€‚ æœåŠ¡ç®¡ç†æœåŠ¡è¯¦æƒ…æœåŠ¡è¯¦æƒ…é¡µé¢å¯ä»¥æŸ¥çœ‹æŸ¥çœ‹å·²éƒ¨ç½²åˆ° Kubernetes ä¸­æœåŠ¡ä¿¡æ¯ã€‚ æœåŠ¡Podå’Œæ‹“æ‰‘å›¾ç­‰æœåŠ¡è¯¦æƒ…é¡µé¢å¯ä»¥æŸ¥çœ‹æœåŠ¡ Pod å’Œæ‹“æ‰‘å›¾ç­‰ä¿¡æ¯ã€‚","categories":[{"name":"GitHubç²¾é€‰","slug":"GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/GitHubç²¾é€‰/"}],"tags":[{"name":"paas","slug":"paas","permalink":"https://jigangduan.github.io/tags/paas/"},{"name":"github","slug":"github","permalink":"https://jigangduan.github.io/tags/github/"}]},{"title":"å®‰è£…ZSH","slug":"oh-my-zsh-installing-zsh","date":"2018-10-24T16:11:44.000Z","updated":"2020-07-25T02:57:18.223Z","comments":true,"path":"2018/10/25/oh-my-zsh-installing-zsh/","link":"","permalink":"https://jigangduan.github.io/2018/10/25/oh-my-zsh-installing-zsh/","excerpt":"","text":"Zsh?Oh-My-Zshæ˜¯Zshçš„æ¡†æ¶ï¼ŒZ shellã€‚ ä¸ºäº†è®©Oh-My-Zshå·¥ä½œï¼Œå¿…é¡»å®‰è£…Zshã€‚ è¯·è¿è¡Œzsh --versionç¡®è®¤ã€‚ é¢„æœŸç»“æœ:zsh 5.1.1æˆ–æ›´è¿‘æœŸ å¦å¤–ï¼ŒZshåº”è¯¥è¢«è®¾ç½®ä¸ºæ‚¨çš„é»˜è®¤shellã€‚ è¯·ä»ä¸€ä¸ªæ–°çš„ç»ˆç«¯è¿è¡Œecho $SHELLæ¥ç¡®è®¤ã€‚ é¢„æœŸç»“æœ:usr/bin/zshæˆ–ç±»ä¼¼ å®‰è£…å¹¶è®¾ç½®zshä¸ºé»˜è®¤å€¼å¦‚æœ‰å¿…è¦ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®‰è£…Zsh: å®‰è£…Zshæœ‰ä¸¤ç§ä¸»è¦æ–¹æ³• ä½¿ç”¨æ‚¨é€‰æ‹©çš„åŒ…ç®¡ç†å™¨ï¼Œä¾‹å¦‚sudo apt-get install zsh(è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹) æ¥è‡ªsource,ä»¥ä¸‹æ˜¯Zsh FAQä¸­çš„è¯´æ˜ é€šè¿‡è¿è¡Œzsh -versionæ¥éªŒè¯å®‰è£…ã€‚é¢„æœŸç»“æœ:zsh 5.1.1æˆ–æ›´è¿‘æœŸã€‚ è®©å®ƒæˆä¸ºæ‚¨çš„é»˜è®¤shell: chsh -s $(which zsh) æ³¨æ„ï¼Œå¦‚æœZshä¸åœ¨æ‚¨çš„æˆæƒshellåˆ—è¡¨(/etc/shell)ä¸­ï¼Œæˆ–è€…æ‚¨æ²¡æœ‰ä½¿ç”¨chshçš„æƒé™ï¼Œé‚£ä¹ˆè¿™å°†ä¸èµ·ä½œç”¨ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸åŒçš„ç¨‹åº æ³¨é”€å¹¶å†æ¬¡ç™»å½•ä»¥ä½¿ç”¨æ–°çš„é»˜è®¤shellã€‚ æµ‹è¯•å®ƒæ˜¯å¦å·¥ä½œ echo $SHELLã€‚é¢„æœŸç»“æœ:/bin/zshæˆ–ç±»ä¼¼ã€‚ ç”¨ $SHELL --versionæµ‹è¯•ã€‚é¢„æœŸç»“æœ:â€œzsh 5.1.1â€æˆ–ç±»ä¼¼ å¦‚ä½•åœ¨å¤šä¸ªå¹³å°ä¸Šå®‰è£…zshmacOSç”¨Homebrewå®‰è£…ä¹‹å‰å°è¯•zsh --versionã€‚å¦‚æœå®ƒæ¯”4.3.9æ›´æ–°ï¼Œä½ å¯èƒ½å°±æ²¡é—®é¢˜äº†ã€‚æœ€å¥½æ¯”5.0æ›´æ–°æˆ–ç­‰äº5.0 1brew install zsh zsh-completions æˆ– MacPorts 1sudo port install zsh zsh-completions Ubuntu, Debian &amp; derivatives1apt install zsh","categories":[{"name":"shell","slug":"shell","permalink":"https://jigangduan.github.io/categories/shell/"},{"name":"oh-my-zsh","slug":"shell/oh-my-zsh","permalink":"https://jigangduan.github.io/categories/shell/oh-my-zsh/"}],"tags":[{"name":"shell","slug":"shell","permalink":"https://jigangduan.github.io/tags/shell/"}]},{"title":"oh-my-zsh","slug":"oh-my-zsh","date":"2018-10-24T15:53:45.000Z","updated":"2020-07-25T02:57:18.224Z","comments":true,"path":"2018/10/24/oh-my-zsh/","link":"","permalink":"https://jigangduan.github.io/2018/10/24/oh-my-zsh/","excerpt":"","text":"æ¬¢è¿ä½¿ç”¨oh-my-zsh! å¦‚æœæ²¡æœ‰å®‰è£…zshï¼Œè¯·å‚é˜…å®‰è£…zshã€‚ çœ‹çœ‹æˆ‘ä»¬çš„ä¸»é¢˜å’Œæ’ä»¶(è¿™é‡Œæœ‰ä¸€ä¸ªç®€çŸ­çš„æ¦‚è¿°:æ’ä»¶æ¦‚è¿°)ã€‚ æ‚¨å¯ä»¥åœ¨å¤–éƒ¨ä¸»é¢˜å’Œå¤–éƒ¨æ’ä»¶ä¸­æ‰¾åˆ°æ›´å¤šã€‚ äº†è§£å®šåˆ¶ã€‚ æœ‰é—®é¢˜å—?è¯·æŸ¥çœ‹æ•…éšœæ’é™¤é¡µé¢ä»¥è·å¾—æŒ‡ç¤ºã€‚ è¯·é˜…è¯»æˆ‘ä»¬çš„ç”¨æˆ·æ¨èã€‚","categories":[{"name":"shell","slug":"shell","permalink":"https://jigangduan.github.io/categories/shell/"},{"name":"oh-my-zsh","slug":"shell/oh-my-zsh","permalink":"https://jigangduan.github.io/categories/shell/oh-my-zsh/"}],"tags":[{"name":"shell","slug":"shell","permalink":"https://jigangduan.github.io/tags/shell/"}]},{"title":"SQL Server - ä½¿ç”¨Visual Studio Codeåˆ›å»ºå’Œè¿è¡ŒTransact-SQLè„šæœ¬","slug":"mysql-vscode","date":"2018-10-02T01:20:02.000Z","updated":"2020-07-25T02:57:18.223Z","comments":true,"path":"2018/10/02/mysql-vscode/","link":"","permalink":"https://jigangduan.github.io/2018/10/02/mysql-vscode/","excerpt":"","text":"æœ¬æ–‡å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Visual Studio Code(VS Code)çš„mssqlæ‰©å±•æ¥å¼€å‘SQL Serveræ•°æ®åº“ã€‚ Visual Studio Codeæ˜¯ä¸€ä¸ªç”¨äºLinuxã€macOSå’ŒWindowsçš„å›¾å½¢åŒ–ä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒæ‰©å±•ã€‚VS Codeçš„mssqlæ‰©å±•å…è®¸æ‚¨è¿æ¥åˆ°SQLæœåŠ¡å™¨ï¼Œä½¿ç”¨Transact-SQL (T-SQL)æŸ¥è¯¢ï¼Œå¹¶æŸ¥çœ‹ç»“æœã€‚ å®‰è£… VS Code å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£…VS Codeï¼Œè¯·ä¸‹è½½å¹¶å®‰è£…VS Codeã€‚ å¯åŠ¨VS Code å®‰è£…mssqlæ‰©å±•ä»¥ä¸‹æ­¥éª¤è¯´æ˜å¦‚ä½•å®‰è£…mssqlæ‰©å±•: æŒ‰ CTRL+SHIFT+P (æˆ– F1)æ‰“å¼€VS Codeä¸­çš„å‘½ä»¤é¢æ¿ã€‚ é€‰æ‹©Install Extensionå¹¶è¾“å…¥mssqlã€‚ æç¤º å¯¹äºmacOS, CMDé”®ç›¸å½“äºLinuxå’ŒWindowsä¸Šçš„CTRLé”®ã€‚ ç‚¹å‡»å®‰è£…mssql mssqlæ‰©å±• æœ€å¤šéœ€è¦ä¸€åˆ†é’Ÿçš„å®‰è£…æ—¶é—´ã€‚ç­‰å¾…æç¤ºå‘Šè¯‰æ‚¨å®ƒå·²æˆåŠŸå®‰è£…ã€‚ è¯·æ³¨æ„å¯¹äºmacOSï¼Œæ‚¨å¿…é¡»å®‰è£…OpenSSLã€‚è¿™æ˜¯mssqlæ‰©å±•æ‰€ä½¿ç”¨çš„.Net Coreçš„å…ˆå†³æ¡ä»¶ã€‚æŒ‰ç…§.Net Coreè¯´æ˜ä¸­çš„å®‰è£…å¿…å¤‡æ­¥éª¤ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨macOSç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚ 1234brew updatebrew install opensslln -s /usr/local/opt/openssl/lib/libcrypto.1.0.0.dylib /usr/local/lib/ln -s /usr/local/opt/openssl/lib/libssl.1.0.0.dylib /usr/local/lib/ è¯·æ³¨æ„å¯¹äºWindows 8.1ã€Windows Server 2012æˆ–æ›´ä½ç‰ˆæœ¬ï¼Œæ‚¨å¿…é¡»ä¸‹è½½å¹¶å®‰è£…Windows 10 Universal C Runtimeã€‚ä¸‹è½½å¹¶æ‰“å¼€zipæ–‡ä»¶ã€‚ç„¶åè¿è¡Œå®‰è£…ç¨‹åº(. msuæ–‡ä»¶)é’ˆå¯¹æ‚¨å½“å‰çš„æ“ä½œç³»ç»Ÿé…ç½®ã€‚ åˆ›å»ºæˆ–æ‰“å¼€SQLæ–‡ä»¶å½“è¯­è¨€æ¨¡å¼è®¾ç½®ä¸ºSQLæ—¶ï¼Œmssqlæ‰©å±•æ”¯æŒç¼–è¾‘å™¨ä¸­çš„mssqlå‘½ä»¤å’ŒT-SQLæ™ºèƒ½æ„ŸçŸ¥ã€‚ æŒ‰CTRL + Nã€‚Visual Studio Codeé»˜è®¤æ‰“å¼€ä¸€ä¸ªæ–°çš„çº¯æ–‡æœ¬æ–‡ä»¶ã€‚ æŒ‰CTRL+K,Mï¼Œå°†è¯­è¨€æ¨¡å¼æ”¹ä¸ºSQLã€‚ æˆ–è€…ï¼Œä½¿ç”¨.sqlæ–‡ä»¶æ‰©å±•åæ‰“å¼€ç°æœ‰æ–‡ä»¶ã€‚è¯­è¨€æ¨¡å¼ä¸ºå…·æœ‰sqlæ‰©å±•åçš„æ–‡ä»¶è‡ªåŠ¨SQLã€‚ è¿æ¥åˆ°SQL Serverä¸‹é¢çš„æ­¥éª¤å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨VS Codeè¿æ¥åˆ°SQL Serverã€‚ åœ¨VS Codeä¸­ï¼ŒæŒ‰CTRL+SHIFT+P(æˆ–F1)æ‰“å¼€å‘½ä»¤é¢æ¿ã€‚ è¾“å…¥sqlä»¥æ˜¾ç¤ºmssqlå‘½ä»¤ã€‚ é€‰æ‹©MS SQL: Connectå‘½ä»¤ã€‚æ‚¨å¯ä»¥ç®€å•åœ°é”®å…¥sqlconå¹¶æŒ‰ENTERé”®ã€‚ é€‰æ‹©Create Connection Profileã€‚è¿™å°†ä¸ºSQLæœåŠ¡å™¨å®ä¾‹åˆ›å»ºä¸€ä¸ªè¿æ¥æ¦‚è¦æ–‡ä»¶ã€‚ æŒ‰ç…§æç¤ºæŒ‡å®šæ–°è¿æ¥æ¦‚è¦æ–‡ä»¶çš„è¿æ¥å±æ€§ã€‚æŒ‡å®šæ¯ä¸ªå€¼ä¹‹åï¼ŒæŒ‰ENTERé”®ç»§ç»­ã€‚ ä¸‹è¡¨æè¿°è¿æ¥æ¦‚è¦å±æ€§ã€‚ è®¾ç½® æè¿° æœåŠ¡å™¨åç§° SQLæœåŠ¡å™¨å®ä¾‹åã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œä½¿ç”¨localhostè¿æ¥åˆ°æœºå™¨ä¸Šçš„æœ¬åœ°SQLæœåŠ¡å™¨å®ä¾‹ã€‚å¦‚æœè¿æ¥åˆ°è¿œç¨‹SQLæœåŠ¡å™¨ï¼Œè¯·è¾“å…¥ç›®æ ‡SQLæœåŠ¡å™¨æœºå™¨çš„åç§°æˆ–å…¶IPåœ°å€ã€‚å¦‚æœéœ€è¦ä¸ºSQL Serverå®ä¾‹æŒ‡å®šç«¯å£ï¼Œè¯·ä½¿ç”¨é€—å·å°†å…¶ä¸åç§°åˆ†ç¦»ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¿è¡Œåœ¨ç«¯å£1401ä¸Šçš„æœ¬åœ°æœåŠ¡å™¨ï¼Œæ‚¨å°†è¾“å…¥localhost,1401ã€‚ (å¯é€‰çš„)æ•°æ®åº“åç§° æ‚¨æƒ³è¦ä½¿ç”¨çš„æ•°æ®åº“ã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œä¸è¦æŒ‡å®šæ•°æ®åº“å¹¶æŒ‰ENTERé”®ç»§ç»­ã€‚ ç”¨æˆ·å è¾“å…¥è®¿é—®æœåŠ¡å™¨ä¸Šæ•°æ®åº“çš„ç”¨æˆ·åã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œä½¿ç”¨åœ¨SQL Serverè®¾ç½®æœŸé—´åˆ›å»ºçš„é»˜è®¤SAå¸æˆ·ã€‚ å¯†ç (SQLç™»å½•) è¾“å…¥æŒ‡å®šç”¨æˆ·çš„å¯†ç  ä¿å­˜å¯†ç ? è¾“å…¥Yesä»¥ä¿å­˜å¯†ç ã€‚å¦åˆ™ï¼Œæ¯æ¬¡ä½¿ç”¨è¿æ¥é…ç½®æ–‡ä»¶æ—¶éƒ½ä¼šæç¤ºè¾“å…¥Noä»¥è¾“å…¥å¯†ç  [å¯é€‰çš„]ä¸ºè¿™ä¸ªæ¦‚è¦æ–‡ä»¶è¾“å…¥ä¸€ä¸ªåç§° è¿æ¥æ¦‚è¦åç§°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†æ¦‚è¦æ–‡ä»¶å‘½åä¸ºlocalhost profileã€‚ æç¤ºæ‚¨å¯ä»¥åœ¨ç”¨æˆ·è®¾ç½®æ–‡ä»¶(settings.json)ä¸­åˆ›å»ºå’Œç¼–è¾‘è¿æ¥é…ç½®æ–‡ä»¶ã€‚é€šè¿‡åœ¨VS Codeèœå•ä¸­é€‰æ‹©é¦–é€‰é¡¹å’Œç”¨æˆ·è®¾ç½®æ¥æ‰“å¼€è®¾ç½®æ–‡ä»¶ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§manage connectioné…ç½®æ–‡ä»¶ã€‚ æŒ‰ESCé”®å…³é—­é€šçŸ¥åˆ›å»ºå’Œè¿æ¥æ¦‚è¦æ–‡ä»¶çš„infoæ¶ˆæ¯ æç¤ºå¦‚æœè¿æ¥å¤±è´¥ï¼Œé¦–å…ˆå°è¯•ä»VS Codeçš„è¾“å‡ºé¢æ¿ä¸­çš„é”™è¯¯æ¶ˆæ¯è¯Šæ–­é—®é¢˜(åœ¨è§†å›¾èœå•ä¸­é€‰æ‹©Output)ã€‚ç„¶åæ£€æŸ¥è¿æ¥æ•…éšœæ’é™¤å»ºè®®ã€‚ éªŒè¯æ‚¨åœ¨çŠ¶æ€æ ä¸­çš„è¿æ¥ åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œé”®å…¥sqlä»¥æ‰“å¼€å¯ç¼–è¾‘ä»£ç ç‰‡æ®µåˆ—è¡¨ã€‚ é€‰æ‹©sqlCreateDatabase åœ¨ä»£ç ç‰‡æ®µä¸­ï¼Œè¾“å…¥TutorialDBä½œä¸ºæ•°æ®åº“å 123456789USE masterGOIF NOT EXISTS (SELECT nameFROM sys.databasesWHERE name = N'TutorialDB')CREATE DATABASE [TutorialDB]GO æŒ‰CTRL+SHIFT+Eæ‰§è¡ŒTransact-SQLå‘½ä»¤ã€‚åœ¨æŸ¥è¯¢çª—å£ä¸­æŸ¥çœ‹ç»“æœã€‚ æç¤ºæ‚¨å¯ä»¥ä¸ºmssqlæ‰©å±•å‘½ä»¤å®šåˆ¶å¿«æ·é”®ç»‘å®šã€‚çœ‹åˆ°è‡ªå®šä¹‰å¿«æ·é”®ã€‚ åˆ›å»ºè¡¨ åˆ é™¤ç¼–è¾‘å™¨çª—å£çš„å†…å®¹ã€‚ æŒ‰F1ä»¥æ˜¾ç¤ºå‘½ä»¤é¢æ¿ã€‚ åœ¨å‘½ä»¤é¢æ¿ä¸­é”®å…¥sqlå‘½ä»¤æ¥æ˜¾ç¤ºsqlå‘½ä»¤æˆ–é”®å…¥sqluse(ç”¨äºMS sql:Use Databaseå‘½ä»¤)ã€‚ å•å‡»MS SQL:Use Databaseï¼Œå¹¶é€‰æ‹©TutorialDBæ•°æ®åº“ã€‚è¿™å°†æ›´æ”¹ä¸Šä¸€èŠ‚ä¸­åˆ›å»ºçš„æ–°æ•°æ®åº“çš„ä¸Šä¸‹æ–‡ã€‚ åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œé”®å…¥sqlä»¥æ˜¾ç¤ºç‰‡æ®µï¼Œç„¶åé€‰æ‹©sqlCreateTableå¹¶æŒ‰enteré”®ã€‚ åœ¨ä»£ç ç‰‡æ®µä¸­ï¼Œä¸ºè¡¨åè¾“å…¥Employeesã€‚ æŒ‰Tabé”®ï¼Œç„¶åä¸ºæ¨¡å¼åè¾“å…¥dboã€‚ è¯·æ³¨æ„æ·»åŠ ä»£ç ç‰‡æ®µä¹‹åï¼Œæ‚¨å¿…é¡»é”®å…¥è¡¨å’Œæ¨¡å¼åç§°ï¼Œè€Œä¸éœ€è¦å°†ç„¦ç‚¹ä»VS Codeç¼–è¾‘å™¨ç§»å¼€ã€‚ å°†Column1çš„åˆ—åæ›´æ”¹ä¸ºNameï¼Œè€ŒColumn2æ›´æ”¹ä¸ºLocationã€‚ 12345678910111213-- åœ¨æ¨¡å¼`dbo`ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`Employees`çš„æ–°è¡¨-- å¦‚æœè¡¨å·²ç»å­˜åœ¨ï¼Œåˆ™åˆ é™¤å®ƒIF OBJECT_ID('dbo.Employees', 'U') IS NOT NULLDROP TABLE dbo.EmployeesGO-- åœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­åˆ›å»ºè¡¨CREATE TABLE dbo.Employees( EmployeesId INT NOT NULL PRIMARY KEY, -- ä¸»é”®åˆ— Name [NVARCHAR](50) NOT NULL, Location [NVARCHAR](50) NOT NULL);GO æŒ‰CTRL+SHIFT+Eåˆ›å»ºè¡¨ æ’å…¥å’ŒæŸ¥è¯¢ æ·»åŠ ä»¥ä¸‹è¯­å¥ä»¥å‘Employeesè¡¨æ’å…¥4è¡Œã€‚ç„¶åé€‰æ‹©æ‰€æœ‰çš„è¡Œã€‚ 123456789101112131415-- åœ¨`Employees`è¡¨ä¸­æ’å…¥è¡ŒINSERT INTO Employees ([EmployeesId],[Name],[Location])VALUES ( 1, N'Jared', N'Australia'), ( 2, N'Nikita', N'India'), ( 3, N'Tom', N'Germany'), ( 4, N'Jake', N'United States')GO-- æŸ¥è¯¢å‘˜å·¥æ€»æ•°SELECT COUNT(*) as EmployeeCount FROM dbo.Employees;-- æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ä¿¡æ¯SELECT e.EmployeesId, e.Name, e.LocationFROM dbo.Employees as eGO æç¤ºåœ¨é”®å…¥æ—¶ï¼Œä½¿ç”¨T-SQLæ™ºèƒ½æ„ŸçŸ¥çš„å¸®åŠ© æŒ‰CTRL+SHIFT+Eæ‰§è¡Œå‘½ä»¤ã€‚è¿™ä¸¤ä¸ªç»“æœé›†æ˜¾ç¤ºåœ¨ç»“æœçª—å£ä¸­ã€‚ æŸ¥çœ‹å¹¶ä¿å­˜ç»“æœ åœ¨è§†å›¾èœå•ä¸Šï¼Œé€‰æ‹©åˆ‡æ¢ç¼–è¾‘å™¨ç»„å¸ƒå±€åˆ‡æ¢åˆ°å‚ç›´æˆ–æ°´å¹³åˆ†å‰²å¸ƒå±€ã€‚ å•å‡»ç»“æœå’Œæ¶ˆæ¯é¢æ¿æ ‡é¢˜æŠ˜å å¹¶å±•å¼€é¢æ¿ æç¤ºæ‚¨å¯ä»¥å®šåˆ¶mssqlæ‰©å±•çš„é»˜è®¤è¡Œä¸ºã€‚è¯·å‚é˜…è‡ªå®šä¹‰æ‰©å±•é€‰é¡¹ã€‚ å•å‡»ç¬¬äºŒä¸ªç»“æœç½‘æ ¼ä¸Šçš„maximize gridå›¾æ ‡æ¥æ”¾å¤§ è¯·æ³¨æ„å½“T-SQLè„šæœ¬å…·æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªç»“æœç½‘æ ¼æ—¶ï¼Œå°†æ˜¾ç¤ºæœ€å¤§åŒ–å›¾æ ‡ã€‚ åœ¨ç½‘æ ¼ä¸Šç”¨é¼ æ ‡å³é”®æ‰“å¼€ç½‘æ ¼ä¸Šä¸‹æ–‡èœå• é€‰æ‹©Select All æ‰“å¼€gridä¸Šä¸‹æ–‡èœå•å¹¶é€‰æ‹©Save as JSONå°†ç»“æœä¿å­˜åˆ°.jsonæ–‡ä»¶ä¸­ ä¸ºJSONæ–‡ä»¶æŒ‡å®šæ–‡ä»¶åã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œè¾“å…¥employees.json éªŒè¯JSONæ–‡ä»¶æ˜¯å¦ä¿å­˜å¹¶ä»¥VS Codeæ‰“å¼€ ä¸‹ä¸€ä¸ªæ­¥éª¤åœ¨çœŸå®çš„åœºæ™¯ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œæ‚¨éœ€è¦ä¿å­˜å¹¶åœ¨ä»¥åè¿è¡Œå®ƒ(ç”¨äºç®¡ç†æˆ–ä½œä¸ºæ›´å¤§çš„å¼€å‘é¡¹ç›®çš„ä¸€éƒ¨åˆ†)ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨.sqlæ‰©å±•åä¿å­˜è„šæœ¬ã€‚ å¦‚æœæ‚¨å¯¹T-SQLä¸ç†Ÿæ‚‰ï¼Œè¯·å‚é˜…æ•™ç¨‹:ç¼–å†™Transact-SQLè¯­å¥å’ŒTransact-SQLå¼•ç”¨(æ•°æ®åº“å¼•æ“)ã€‚ æœ‰å…³ä½¿ç”¨æˆ–è´¡çŒ®mssqlæ‰©å±•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…mssqlæ‰©å±•é¡¹ç›®wikiã€‚ æœ‰å…³ä½¿ç”¨VS Codeçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Visual Studio Codeæ–‡æ¡£ã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"SQL Server","slug":"VS-Code/SQL-Server","permalink":"https://jigangduan.github.io/categories/VS-Code/SQL-Server/"}],"tags":[{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"},{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"sql-server","slug":"sql-server","permalink":"https://jigangduan.github.io/tags/sql-server/"}]},{"title":"Go å·¥ä¸šçº§ç¼–ç¨‹","slug":"go-for-industrial-programming","date":"2018-09-17T23:49:35.000Z","updated":"2020-07-25T02:57:18.203Z","comments":true,"path":"2018/09/18/go-for-industrial-programming/","link":"","permalink":"https://jigangduan.github.io/2018/09/18/go-for-industrial-programming/","excerpt":"","text":"åŸæ–‡(https://peter.bourgon.org/go-for-industrial-programming/) æˆ‘ä»¬ä¸åº”è¯¥ç›²ç›®åœ°åº”ç”¨æ•™æ¡ä¸»ä¹‰çš„å»ºè®®ï¼Œæ¯æ¬¡æˆ‘ä»¬åº”è¯¥ä½¿ç”¨æˆ‘ä»¬çš„åˆ¤æ–­ã€‚ äº’è”ç½‘ä¸Šçš„ä¸€äº›äººå‘ç°ï¼Œä½ åœ¨ç§‘æŠ€è¡Œä¸šå‘†çš„æ—¶é—´è¶Šé•¿ï¼Œä½ çš„è§‚ç‚¹å°±ä¼šå˜å¾—è¶Šå¥½ï¼Œè¿™è¦çœ‹æƒ…å†µè€Œå®šï¼Œæˆ‘ä¸ç¡®å®šï¼Œè¿™äº›æ˜¯ä¸æ˜¯å¾ˆå¥½ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå¦‚æœä½ å‘ç°éšç€ä½ äº‹ä¸šçš„å‘å±•ï¼Œä½ ä¼šå˜å¾—è¶Šæ¥è¶Šå›ºæ‰§å·±è§ï¼Œé‚£ä¹ˆä½ å¾ˆæœ‰å¯èƒ½é™·å…¥ä¸€ç§çª è‡¼ï¼Œæˆä¸ºä¸€ä¸ªä¸“ä¸šçš„åˆå­¦è€…ã€‚ä¸å¤ªå¥½äº†! æ˜ç¡®å®šä¹‰ä¸€ä¸ªé€‚ç”¨èŒƒå›´ï¼Œå°±èƒ½ç»™è‡ªå·±ç•™å‡ºä¸€ç‚¹ç©ºé—´æ¥å½¢æˆä¸€ä¸ªæ˜ç¡®çš„æ„è§ï¼š åœ¨åˆ›ä¸šæˆ–å…¬å¸ç¯å¢ƒä¸­; åœ¨ä¸€ä¸ªå·¥ç¨‹å¸ˆæ¥æ¥å»å»çš„å›¢é˜Ÿä¸­; æ¯”ä»»ä½•ä¸€ä¸ªå·¥ç¨‹å¸ˆéƒ½é•¿å¯¿çš„ä»£ç ; æœåŠ¡é«˜åº¦å¯å˜çš„ä¸šåŠ¡éœ€æ±‚ã€‚ æ„é€ ä»£ç å’Œå­˜å‚¨åº“æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„ä¸€ä»¶äº‹æ˜¯å¯¹ä¸¥æ ¼çš„é¡¹ç›®ç»“æ„çš„æœŸæœ›ï¼Œé€šå¸¸åœ¨é¡¹ç›®å¼€å§‹æ—¶å°±é¢„å…ˆå†³å®šäº†ã€‚æˆ‘è®¤ä¸ºè¿™é€šå¸¸æ˜¯é—®é¢˜å¤šäºå¸®åŠ©ã€‚è¦ç†è§£åŸå› ï¼Œè¯·è®°ä½å·¥ä¸šç¼–ç¨‹çš„ç¬¬å››ä¸ªç‰¹æ€§ï¼Œæˆ–è®¸ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªç‰¹æ€§: å·¥ä¸šç¼–ç¨‹ â€¦ æä¾›é«˜åº¦å¯å˜çš„ä¸šåŠ¡éœ€æ±‚ æƒŸä¸€ä¸å˜çš„æ˜¯å˜æ›´ï¼ŒæƒŸä¸€çš„ä¸šåŠ¡éœ€æ±‚è§„åˆ™æ˜¯å®ƒä»¬ æ°¸è¿œä¸ä¼šæ”¶æ•›ï¼Œå®ƒä»¬åªä¼š_å‘æ•£ã€å¢é•¿å’Œå˜å¼‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿æˆ‘ä»¬çš„ä»£ç èƒ½å¤Ÿé€‚åº”ç”Ÿæ´»ä¸­çš„è¿™ä¸€äº‹å®ï¼Œè€Œä¸æ˜¯ä¸å¿…è¦åœ°å°†è‡ªå·±é™åˆ¶åœ¨å…¶ä¸­ã€‚æˆ‘ä»¬çš„reposï¼Œæˆ‘ä»¬çš„æŠ½è±¡ï¼Œæˆ‘ä»¬çš„ä»£ç æœ¬èº«åº”è¯¥æ˜“äºç»´æŠ¤ï¼Œæ˜“äºä¿®æ”¹ï¼Œæ˜“äºé€‚åº”ï¼Œæœ€ç»ˆï¼Œæ˜“äºåˆ é™¤ã€‚ æœ‰å‡ ä»¶äº‹é€šå¸¸æ˜¯å¥½ä¸»æ„ã€‚å¦‚æœæ‚¨çš„é¡¹ç›®æœ‰å¤šä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ€å¥½æœ‰ä¸€ä¸ªcmd/å­ç›®å½•æ¥ä¿å­˜å®ƒä»¬ã€‚å¦‚æœæ‚¨çš„é¡¹ç›®å¾ˆå¤§å¹¶ä¸”æœ‰é‡è¦çš„éGoä»£ç ï¼Œæ¯”å¦‚UIèµ„äº§æˆ–å¤æ‚çš„æ„å»ºå·¥å…·ï¼Œé‚£ä¹ˆå°†Goä»£ç éš”ç¦»åœ¨pkg/å­ç›®å½•ä¸­å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å¦‚æœæ‚¨è¦æœ‰å¤šä¸ªåŒ…ï¼Œé‚£ä¹ˆæœ€å¥½å›´ç»•ä¸šåŠ¡é¢†åŸŸæ¥å®šä½å®ƒä»¬ï¼Œè€Œä¸æ˜¯å›´ç»•å®ç°çš„æ„å¤–æƒ…å†µã€‚å³:åŒ…ç”¨æˆ·;è€ŒéåŒ…æ¨¡å‹ã€‚ å½“ç„¶ï¼Œä¸šåŠ¡é¢†åŸŸå’Œå®ç°å¹¶ä¸æ€»æ˜¯ä¸¥æ ¼åˆ†å¼€çš„ã€‚ä¾‹å¦‚ï¼Œå¤§å‹webåº”ç”¨ç¨‹åºå¾€å¾€æ··åˆäº†ä¼ è¾“å’Œæ ¸å¿ƒä¸šåŠ¡å…³æ³¨ç‚¹ã€‚GoBuffaloä¹‹ç±»çš„æ¡†æ¶é¼“åŠ±ä½¿ç”¨è¯¸å¦‚æ“ä½œã€èµ„äº§ã€æ¨¡å‹å’Œæ¨¡æ¿ä¹‹ç±»çš„åŒ…åã€‚å½“æ‚¨çŸ¥é“åªå¤„ç†HTTPæ—¶ï¼Œå°†æ‰€æœ‰ç²¾åŠ›éƒ½æ”¾åœ¨è€¦åˆä¸Šæ˜¯æœ‰å¥½å¤„çš„ã€‚ è¿˜æœ‰å»ºè®®æˆ‘ä»¬æ ¹æ®ä¾èµ–è¾¹ç•Œå¯¹é½åŒ…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºRedisStoreã€MySQLStoreç­‰æä¾›å•ç‹¬çš„åŒ…ï¼Œä»¥é¿å…å¤–éƒ¨æ¶ˆè´¹è€…å¿…é¡»åŒ…å«å’Œç¼–è¯‘å¯¹ä»–ä»¬ä¸éœ€è¦çš„ä¸œè¥¿çš„æ”¯æŒã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå¯¹äºå…·æœ‰å°é—­çš„å¯¼å…¥å™¨é›†çš„åŒ…æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§ä¸åˆé€‚çš„ä¼˜åŒ–ï¼Œä½†æ˜¯å¯¹äºç¬¬ä¸‰æ–¹(å¦‚Kubernetes)å¹¿æ³›å¯¼å…¥çš„åŒ…æ¥è¯´ï¼Œè¿™ç§ä¼˜åŒ–éå¸¸æœ‰æ„ä¹‰ï¼Œå› ä¸ºåœ¨ç¬¬ä¸‰æ–¹ï¼Œç¼–è¯‘å•å…ƒçš„å¤§å°å¯èƒ½æˆä¸ºçœŸæ­£çš„ç“¶é¢ˆã€‚ æ‰€ä»¥æœ‰ä¸€ä¸ªé€‚ç”¨èŒƒå›´ã€‚æˆ‘è®¤ä¸ºæœ€å¥½çš„ä¸€èˆ¬æ€§å»ºè®®æ˜¯ï¼Œä¸€æ—¦ä½ è§‰å¾—æœ‰å¿…è¦ï¼Œå…·ä½“åœ°è¯´ï¼Œåªé€‰æ‹©åŠ å…¥ä¸€ç‚¹ç»“æ„ã€‚æˆ‘çš„å¤§å¤šæ•°é¡¹ç›®ä»ç„¶ä»¥package mainä¸­çš„å‡ ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œå®ƒä»¬æ†ç»‘åœ¨repoçš„æ ¹ç›®å½•ä¸‹ã€‚å®ƒä»¬ä¸€ç›´ä¿æŒè¿™ç§çŠ¶æ€ï¼Œç›´åˆ°å®ƒä»¬å˜æˆè‡³å°‘å‡ åƒè¡Œä»£ç ã€‚æˆ‘çš„è®¸å¤šé¡¹ç›®ï¼Œç”šè‡³å¤§å¤šæ•°é¡¹ç›®ï¼Œéƒ½æ²¡æœ‰èµ°åˆ°è¿™ä¸€æ­¥ã€‚Goçš„ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒèƒ½è®©äººæ„Ÿè§‰å¾ˆè½»;æˆ‘å–œæ¬¢å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¿å­˜å®ƒã€‚ ç¨‹åºé…ç½®Flagsæ˜¯æœ€å¥½çš„æ–¹å¼æ¥é…ç½®æ‚¨çš„é¡¹ç›®,å› ä¸ºå®ƒä»¬è‡ªæˆ‘è®°å½•çš„æ–¹å¼æ¥æè¿°æ‚¨çš„ç¨‹åºåœ¨è¿è¡Œæ—¶çš„é…ç½®ã€‚ è¿™åœ¨å·¥ä¸šä¸Šä¸‹æ–‡ä¸­å°¤å…¶é‡è¦ï¼Œåœ¨å·¥ä¸šä¸Šä¸‹æ–‡ä¸­ï¼Œæ— è®ºè°åœ¨è¿è¡ŒæœåŠ¡ï¼Œéƒ½å¯èƒ½ä¸æ˜¯å…¶åŸå§‹ä½œè€…ã€‚å¦‚æœä½¿ç”¨-hæ ‡å¿—è¿è¡Œç¨‹åºæä¾›äº†æ§åˆ¶å…¶è¡Œä¸ºçš„æ—‹é’®å’Œå¼€å…³çš„å®Œæ•´åˆ—è¡¨ï¼Œé‚£ä¹ˆå¯¹äºéšå«éšåˆ°çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œåœ¨å‘ç”Ÿäº‹ä»¶æ—¶è°ƒæ•´æŸäº›ä¸œè¥¿æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œæˆ–è€…å¯¹äºæ–°å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè®©å®ƒåœ¨ä»–ä»¬çš„å¼€å‘ç¯å¢ƒä¸­è¿è¡Œä¹Ÿæ˜¯éå¸¸å®¹æ˜“çš„ã€‚è¿™æ¯”åœ¨(å¯èƒ½å·²ç»è¿‡æ—¶çš„)æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¸€ç»„ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œæˆ–è€…æ‰¾å‡ºé…ç½®æ–‡ä»¶æ ¼å¼çš„è¯­æ³•å’Œæœ‰æ•ˆé”®åè¦å®¹æ˜“å¾—å¤šã€‚ è¿™å¹¶ä¸æ„å‘³ç€æ°¸è¿œä¸è¦ä½¿ç”¨env varsæˆ–é…ç½®æ–‡ä»¶ã€‚é™¤äº†ä½¿ç”¨æ ‡å¿—ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¥½çš„ç†ç”±ä½¿ç”¨å…¶ä¸­ä¹‹ä¸€æˆ–ä¸¤è€…ã€‚Env varså¯¹äºè¿æ¥å­—ç¬¦ä¸²å’Œéç§˜å¯†çš„authä»¤ç‰Œéå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¼€å‘æœŸé—´ã€‚é…ç½®æ–‡ä»¶å¯¹äºå£°æ˜è¯¦ç»†çš„é…ç½®éå¸¸æœ‰ç”¨ï¼Œè€Œä¸”æ˜¯å°†ç§˜å¯†æ”¾å…¥ç¨‹åºçš„æœ€å®‰å…¨çš„æ–¹æ³•ã€‚(ç³»ç»Ÿçš„å…¶ä»–ç”¨æˆ·å¯ä»¥æ£€æŸ¥æ ‡å¿—ï¼Œenv varså¾ˆå®¹æ˜“è®¾ç½®å’Œé—å¿˜ã€‚)åªè¦ç¡®ä¿æ˜¾å¼å‘½ä»¤è¡Œæ ‡å¿—(å¦‚æœç»™å®š)å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚ 12345678var fs myflag.FlagSetvar ( foo = fs.String(\"foo\", \"x\", \"foo val\") bar = fs.String(\"bar\", \"y\", \"bar val\", myflag.JSON(\"bar\")) baz = fs.String(\"baz\", \"z\", \"baz val\", myflag.JSON(\"baz\"), myflag.Env(\"BAZ\")) cfg = fs.String(\"cfg\", \"\", \"JSON config file\"))fs.Parse(os.Args, myflag.JSONVia(\"cfg\"), myflag.EnvPrefix(\"MYAPP_\")) ç»„ä»¶å›¾å·¥ä¸šç¼–ç¨‹æ„å‘³ç€ä¸€æ¬¡æ€§ç¼–å†™ä»£ç å¹¶æ°¸ä¹…ç»´æŠ¤ä»£ç ã€‚ç»´æŠ¤æ˜¯é˜…è¯»å’Œé‡æ„çš„æŒç»­å®è·µã€‚å› æ­¤ï¼Œå·¥ä¸šç¼–ç¨‹å‹å€’æ€§åœ°å€¾å‘äºè¯»ï¼Œ_åœ¨æ˜“è¯»ä¸æ˜“å†™ä¹‹é—´ï¼Œæˆ‘ä»¬åº”è¯¥å¼ºçƒˆåœ°åå‘äºå‰è€…ã€‚ ä¾èµ–æ³¨å…¥æ˜¯ä¼˜åŒ–é˜…è¯»ç†è§£çš„ä¸€ä¸ªå¼ºå¤§å·¥å…·ã€‚è¿™é‡Œæˆ‘å½“ç„¶ä¸æ˜¯æŒ‡facebook-go/injectæˆ–uber-go/digæ‰€ä½¿ç”¨çš„ä¾èµ–å®¹å™¨æ–¹æ³•ï¼Œè€Œæ˜¯å°†ä¾èµ–å…³ç³»æšä¸¾ä¸ºç±»å‹æˆ–æ„é€ å‡½æ•°çš„å‚æ•°çš„ç®€å•å¾—å¤šçš„å®è·µã€‚ ä¸‹é¢æ˜¯æœ€è¿‘æµè¡Œçš„ä¸€ä¸ªåŸºäºå®¹å™¨çš„ä¾èµ–æ³¨å…¥çš„ä¾‹å­: 123456789101112131415161718func BuildContainer() *dig.Container &#123; container := dig.New() container.Provide(NewConfig) container.Provide(ConnectDatabase) container.Provide(NewPersonRepository) container.Provide(NewPersonService) container.Provide(NewServer) return container&#125;func main() &#123; container := BuildContainer() if err := container.Invoke(func(server *Server) &#123; server.Run() &#125;); err != nil &#123; panic(err) &#125;&#125; ä¸»å‡½æ•°ä½“ç»“æ„ç´§å‡‘ï¼Œæ„å»ºå®¹å™¨å…·æœ‰ç®€æ´ã€åˆ‡ä¸­è¦ç‚¹çš„å¤–è§‚ã€‚ä½†æ˜¯ï¼Œæä¾›æ–¹æ³•éœ€è¦åå°„æ¥è§£é‡Šå®ƒçš„å‚æ•°ï¼Œè€Œè°ƒç”¨æ²¡æœ‰æä¾›å…³äºæœåŠ¡å™¨å®é™…éœ€è¦åšä»€ä¹ˆå·¥ä½œçš„çº¿ç´¢ã€‚æ–°å‘˜å·¥å¿…é¡»åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ä¹‹é—´è·³è½¬ï¼Œä»¥æ„å»ºæ¯ä¸ªä¾èµ–é¡¹çš„å¿ƒç†æ¨¡å‹ã€å®ƒä»¬å¦‚ä½•äº¤äº’ä»¥åŠæœåŠ¡å™¨å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚è¿™ä»£è¡¨äº†è¯»ç†è§£å’Œå†™ç†è§£ä¹‹é—´çš„ä¸€ä¸ªä¸å¥½çš„æƒè¡¡ã€‚ ä¸æœ¬ä¾‹è¦æ”¹è¿›çš„ä»£ç çš„ç¨å¾®ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ç›¸æ¯”: 1234567891011func main() &#123; cfg := GetConfig() db, err := ConnectDatabase(cfg.URN) if err != nil &#123; panic(err) &#125; repo := NewPersonRepository(db) service := NewPersonService(cfg.AccessToken, repo) server := NewServer(cfg.ListenAddr, service) server.Run()&#125; ä¸»å‡½æ•°æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯ä½œä¸ºäº¤æ¢ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ¸…æ™°çš„æ˜ç¡®æ€§ã€‚æ¯ä¸ªç»„ä»¶éƒ½æŒ‰ä¾èµ–é¡ºåºæ„é€ ï¼Œå¹¶å†…è”å¤„ç†é”™è¯¯ã€‚æ¯ä¸ªæ„é€ å‡½æ•°éƒ½å°†å…¶ä¾èµ–é¡¹æšä¸¾ä¸ºå‚æ•°ï¼Œä»è€Œå…è®¸æ–°ä»£ç è¯»å–å™¨å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºç»„ä»¶ä¹‹é—´å…³ç³»å›¾çš„å¿ƒæ™ºæ¨¡å‹ã€‚åœ¨å±‚å±‚çš„é—´æ¥æ€§åé¢ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯æ¨¡ç³Šçš„ã€‚ å¦‚æœé‡æ„è¦æ±‚ç»„ä»¶è·å¾—æ–°çš„ä¾èµ–é¡¹ï¼Œåˆ™åªéœ€å°†å…¶æ·»åŠ åˆ°æ„é€ å‡½æ•°ä¸­å³å¯ã€‚ä¸‹ä¸€ä¸ªç¼–è¯‘å°†è§¦å‘é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å°†ç²¾ç¡®åœ°æ ‡è¯†éœ€è¦æ›´æ–°çš„å‚æ•°åˆ—è¡¨ï¼Œå¹¶ä¸”ç”Ÿæˆçš„PRä¸­çš„å·®å¼‚å°†æ¸…æ¥šåœ°æ˜¾ç¤ºä¾èµ–å…³ç³»çš„æµã€‚ æˆ‘å£°ç§°è¿™ä¸¥æ ¼ä¼˜äºå‰ä¸€ç§æ–¹æ³•ï¼Œåœ¨å‰ä¸€ç§æ–¹æ³•ä¸­ï¼Œä»ç¼–å†™çš„ä»£ç ä¸­æå–å…³ç³»è¦å›°éš¾å¾—å¤šï¼Œè€Œä¸”å¤§éƒ¨åˆ†æ•…éšœæ£€æµ‹å»¶è¿Ÿåˆ°è¿è¡Œæ—¶ã€‚æˆ‘è®¤ä¸ºéšç€ç¨‹åºçš„å¤§å°(ä»¥åŠfunc mainçš„å¤§å°)çš„å¢é•¿ï¼Œä»¥åŠç®€å•è€Œæ˜¾å¼çš„åˆå§‹åŒ–å¤åˆå‡½æ•°çš„å¥½å¤„ï¼Œå®ƒä¼šå˜å¾—è¶Šæ¥è¶Šå¥½ã€‚ å½“æˆ‘ä»¬è°ˆè®ºé˜…è¯»ç†è§£æ—¶ï¼Œæˆ‘å–œæ¬¢æ€è€ƒæˆ‘è®¤ä¸ºGoæœ€é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œé‚£å°±æ˜¯å®ƒæœ¬è´¨ä¸Šæ˜¯éé­”æ³•çš„ã€‚é™¤äº†æå°‘æ•°ä¾‹å¤–ï¼Œå¯¹Goä»£ç çš„ç›´çº¿é˜…è¯»ä¸ä¼šå¯¹å®šä¹‰ã€ä¾èµ–å…³ç³»æˆ–è¿è¡Œæ—¶è¡Œä¸ºäº§ç”Ÿæ­§ä¹‰ã€‚è¿™æ˜¯ä¼Ÿå¤§çš„ã€‚ ä½†æ˜¯æœ‰å‡ ç§æ–¹æ³•å¯ä»¥è®©é­”æ³•æ½œå…¥å…¶ä¸­ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸€ç§éå¸¸å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨å…¨å±€çŠ¶æ€ã€‚åŒ…å…¨å±€å¯¹è±¡å¯ä»¥ç¼–ç å¯¹å¤–éƒ¨è°ƒç”¨è€…éšè—çš„çŠ¶æ€å’Œ/æˆ–è¡Œä¸ºã€‚è°ƒç”¨è¿™äº›å…¨å±€å˜é‡çš„ä»£ç å¯èƒ½ä¼šäº§ç”Ÿä»¤äººæƒŠè®¶çš„å‰¯ä½œç”¨ï¼Œè¿™å°†ç ´åè¯»è€…ç†è§£å¹¶åœ¨å¿ƒé‡Œä¸ºç¨‹åºå»ºæ¨¡çš„èƒ½åŠ› å› æ­¤ï¼Œè€ƒè™‘åˆ°è¯»å–ä¼˜åŒ–å’Œç»´æŠ¤æˆæœ¬ï¼Œæˆ‘è®¤ä¸ºç†æƒ³çš„Goç¨‹åºå‡ ä¹æ²¡æœ‰åŒ…å…¨å±€çŠ¶æ€ï¼Œè€Œæ˜¯æ›´å–œæ¬¢é€šè¿‡æ„é€ å‡½æ•°æ˜¾å¼åœ°æšä¸¾ä¾èµ–å…³ç³»ã€‚ç”±äºfunc initçš„å”¯ä¸€å·¥ä½œå°±æ˜¯åˆå§‹åŒ–åŒ…çš„å…¨å±€çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºæœ€å¥½å°†å…¶ç†è§£ä¸ºå‡ ä¹æ‰€æœ‰ç¨‹åºä¸­çš„ä¸€ä¸ªä¸¥é‡è­¦å‘Šã€‚å¤šå¹´æ¥ï¼Œæˆ‘ä¸€ç›´ç”¨è¿™ç§æ–¹å¼ç¼–å†™ç¨‹åºï¼Œè€Œåœ¨é‚£æ®µæ—¶é—´é‡Œï¼Œæˆ‘åªæ˜¯è¶Šæ¥è¶Šæ¬£èµå’Œæå€¡è¿™ç§åšæ³•ã€‚ æ‰€ä»¥ï¼Œæˆ‘çš„ç°ä»£Goç†è®ºæ˜¯: æ˜¾å¼çš„ä¾èµ–å…³ç³» æ²¡æœ‰åŒ…çº§åˆ«å˜é‡ æ²¡æœ‰å‡½æ•°åˆå§‹åŒ– Goroutineç”Ÿå‘½å‘¨æœŸç®¡ç†æ ¹æ®æˆ‘çš„ç»éªŒï¼Œä¸æ­£ç¡®æˆ–è¿‡äºå¤æ‚çš„å¯åŠ¨ã€åœæ­¢å’Œæ£€æŸ¥goroutinesçš„è®¾è®¡æ˜¯æ–°æ‰‹å’Œä¸­çº§Goç¨‹åºå‘˜é¢ä¸´æŒ«æŠ˜çš„æœ€å¤§åŸå› ã€‚ æˆ‘è®¤ä¸ºé—®é¢˜åœ¨äºgoroutineæœ€ç»ˆæ˜¯ä¸€ä¸ªéå¸¸ä½çº§çš„æ„å»ºå—ï¼Œå¯¹äºå¤§å¤šæ•°äººå¸Œæœ›ä½¿ç”¨å¹¶å‘æ¥å®Œæˆçš„é‚£ç§é«˜é˜¶ä»»åŠ¡å‡ ä¹æ²¡æœ‰å¯ç”¨æ€§ã€‚æˆ‘ä»¬ä¼šè¯´â€œæ°¸è¿œä¸è¦åœ¨ä¸çŸ¥é“å¦‚ä½•åœæ­¢çš„æƒ…å†µä¸‹å¼€å§‹åƒgoroutineâ€ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å…·ä½“çš„æ–¹æ³•ï¼Œè¿™ä¸ªå»ºè®®å°±æœ‰ç‚¹ç©ºæ´äº†ã€‚æˆ‘è®¤ä¸ºè®¸å¤šæ•™ç¨‹å’Œå¤§é‡ç¤ºä¾‹ä»£ç ï¼Œå³ä½¿æ˜¯åœ¨å…¶ä»–å¥½çš„å‚è€ƒèµ„æ–™ä¸­ï¼Œæ¯”å¦‚Goç¼–ç¨‹è¯­è¨€ä¹¦ç±ï¼Œä¹Ÿä¼šç»™æˆ‘ä»¬å¸¦æ¥ä¸åˆ©å½±å“ï¼Œå› ä¸ºå®ƒä»¬æ¼”ç¤ºäº†å¹¶å‘æ¦‚å¿µï¼Œä½¿ç”¨æ³„æ¼çš„å³å‘å³å¼ƒ goroutinesã€å…¨å±€çŠ¶æ€å’Œæ¨¡å¼ï¼Œå³ä½¿æ˜¯åŸºæœ¬çš„ä»£ç æ£€æŸ¥ä¹Ÿä¼šå¤±è´¥ã€‚ æˆ‘çœ‹åˆ°çš„å¤§å¤šæ•°goroutineéƒ½æ˜¯ç”±æˆ‘çš„åŒäº‹å¯åŠ¨çš„ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯å®šä¹‰è‰¯å¥½çš„å¹¶å‘ç®—æ³•çš„é™„å¸¦æ­¥éª¤ã€‚å®ƒä»¬å¾€å¾€æ˜¯ç»“æ„åŒ–çš„ï¼Œç”¨æ¨¡ç³Šçš„ç»ˆæ­¢è¯­ä¹‰ç®¡ç†é•¿æ—¶é—´è¿è¡Œçš„ä¸œè¥¿ï¼Œé€šå¸¸åœ¨ç¨‹åºå¼€å§‹æ—¶å¯åŠ¨ã€‚æˆ‘è®¤ä¸ºè¿™äº›ç”¨ä¾‹éœ€è¦ä½¿ç”¨æ›´å¼ºçš„çº¦å®šã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œgoå…³é”®å­—çš„æ­£å­—æ³•ç•¥æœ‰ä¸åŒã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½å¯åŠ¨goroutineï¼Œè€Œä¸æä¾›ä¸­æ–­æˆ–åœæ­¢å®ƒçš„åŠŸèƒ½ï¼Œé‚£è¯¥æ€ä¹ˆåŠ?å®é™…ä¸Šï¼Œå¼ºåˆ¶æ‰§è¡Œçº¦å®šï¼Œé™¤éæˆ‘ä»¬çŸ¥é“å¦‚ä½•é˜»æ­¢goroutineï¼Œå¦åˆ™ä¸åº”è¯¥å¯åŠ¨å®ƒã€‚ è¿™æ˜¯æˆ‘åœ¨ä½¿ç”¨package runæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå®ƒæ˜¯ä»æˆ‘å»å¹´ä»äº‹çš„ä¸€ä¸ªæ›´å¤§çš„é¡¹ç›®ä¸­æå–å‡ºæ¥çš„ã€‚è¿™é‡Œæ˜¯æœ€é‡è¦çš„æ–¹æ³•ï¼Œæ·»åŠ : 1func (g *Group) Add(execute func() error, interrupt func(error)) æ·»åŠ è¦è¿è¡Œçš„goroutineé˜Ÿåˆ—ï¼Œä½†ä¹Ÿè·Ÿè¸ªä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨éœ€è¦æ€æ­»goroutineæ—¶ä¸­æ–­goroutineã€‚è¿™ä¸ºæ•´ä¸ªgoroutineç»„æä¾›äº†å®šä¹‰è‰¯å¥½çš„ç»ˆæ­¢è¯­ä¹‰ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘æœ‰å¤šä¸ªåº”è¯¥æ°¸è¿œè¿è¡Œçš„æœåŠ¡å™¨ç»„ä»¶æ—¶ï¼Œæˆ‘æœ€å¸¸ä½¿ç”¨å®ƒï¼Œç„¶åæ·»åŠ ä¸€ä¸ªgoroutineæ¥æ•è·ctrl-Cå¹¶é”€æ¯æ‰€æœ‰å†…å®¹ã€‚ 12345678910111213ctx, cancel := context.WithCancel(context.Background())g.Add(func() error &#123; c := make(chan os.Signal, 1) signal.Notify(c, syscall.SIGINT, syscall.SIGTERM) select &#123; case sig := &lt;-c: return fmt.Errorf(\"received signal %s\", sig) case &lt;-ctx.Done(): return ctx.Err() &#125;&#125;, func(error) &#123; cancel()&#125;) å¦‚æœæ‚¨ç†Ÿæ‚‰package errgroupï¼Œé‚£ä¹ˆè¿™åœ¨é«˜å±‚ä¸Šä¸åŒ…errgroupç±»ä¼¼ï¼Œä½†æ›´ç³Ÿç³•çš„æ˜¯:errgroupéšå¼åœ°å‡è®¾æ‰€æœ‰æ‰§è¡Œå‡½æ•°éƒ½å°†å“åº”æä¾›ç»™ç»„çš„çˆ¶ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ä¹‹æ˜¾å¼çš„åŠŸèƒ½ã€‚ æœ€è¿‘æœ‰ä¸€ç¯‡clickbaityåšå®¢æ–‡ç« å£°ç§°â€œgoè¯­å¥è¢«è®¤ä¸ºæ˜¯æœ‰å®³çš„â€ï¼Œå¹¶æå€¡ä½¿ç”¨ä¸€ç§ç§°ä¸ºæ‰˜å„¿æ‰€çš„ç»“æ„ï¼Œå³ç”Ÿå‘½å‘¨æœŸç»‘å®šçº¿ç¨‹ã€‚package runå’Œ æœ€è¿‘æœ‰ä¸€ç¯‡clickbaityåšå®¢æ–‡ç« å£°ç§°â€œgoè¯­å¥è¢«è®¤ä¸ºæ˜¯æœ‰å®³çš„â€ï¼Œå¹¶æå€¡ä½¿ç”¨ä¸€ç§ç§°ä¸ºæ‰˜å„¿æ‰€çš„ç»“æ„ï¼Œå³ç”Ÿå‘½å‘¨æœŸç»‘å®šçº¿ç¨‹ã€‚packageerrgroupéƒ½æ˜¯è¿™ä¸ªæ‰˜å„¿æ‰€æ¦‚å¿µçš„ç¨å¾®ä¸åŒçš„å®ç°è§£é‡Šã€‚ Futuresè¿™æ˜¯é«˜é˜¶ç»“æ„çš„ä¸€ç§å½¢å¼ã€‚ä½†è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„!ä¾‹å¦‚ï¼Œä½ çŸ¥é“Goæœ‰Futureså—?å®ƒåªæ˜¯æ¯”å…¶ä»–è¯­è¨€æ›´å†—é•¿ä¸€äº›ã€‚ 123future := make(chan int, 1)go func() &#123; future &lt;- process() &#125;()result := &lt;-future futureçš„å¦ä¸€ç§å‘éŸ³æ–¹å¼æ˜¯async/ await: 123c := make(chan int, 1)go func() &#123; c &lt;- process() &#125;() // asyncv := &lt;-c // await Scatter-gatheræˆ‘ä»¬ä¹Ÿæœ‰æ•£é›†ï¼Œæˆ‘ä¸€ç›´åœ¨ç”¨å®ƒï¼Œå½“æˆ‘çŸ¥é“æˆ‘éœ€è¦å¤„ç†å¤šå°‘å•ä½çš„å·¥ä½œæ—¶ã€‚ 1234567891011121314151617// Scatterc := make(chan result, 10)for i := 0; i &lt; cap(c); i++ &#123; go func() &#123; val, err := process() c &lt;- result&#123;val, err&#125; &#125;()&#125;// Gathervar total intfor i := 0; i &lt; cap(c); i++ &#123; res := &lt;-c if res.err != nil &#123; total += res.val &#125;&#125; ä¸€ä¸ªä¼˜ç§€çš„Goç¨‹åºå‘˜ä¼šå¯¹è¿™äº›é«˜é˜¶å¹¶å‘æ¨¡å¼ä¸­çš„å‡ ä¸ªæœ‰å¾ˆå¼ºçš„æ§åˆ¶èƒ½åŠ›ã€‚ä¸€ä¸ªä¼˜ç§€çš„Goç¨‹åºå‘˜ä¼šä¸»åŠ¨åœ°å°†è¿™äº›æ¨¡å¼ä¼ æˆç»™ä»–ä»¬çš„åŒäº‹ã€‚ å¯è§‚å¯Ÿæ€§æˆ‘ä»¬æ¥è°ˆè°ˆå¯è§‚å¯Ÿæ€§ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å…³äºå·¥ä¸šç¼–ç¨‹çš„å¦ä¸€ç§å‡è®¾:æˆ‘ä»¬ç¼–å†™çš„ä»£ç å°†è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸ºå®¢æˆ·æä¾›è¯·æ±‚ï¼Œå¹¶ç»å†ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸ä¼šä¸­æ–­è¯¥æœåŠ¡ã€‚è¿™ä¸åŒäºå‹ç¼©åŒ…è£…å¹¶äº¤ä»˜ç»™å®¢æˆ·çš„ä»£ç ï¼Œä¹Ÿä¸åŒäºä½œä¸ºæ‰¹å¤„ç†ä½œä¸šè¿è¡Œä¸”ä¸é¢å‘å®¢æˆ·çš„ä»£ç ã€‚ åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œæˆ‘åŒæ„Charityä¹‹å‰åœ¨èŠ‚ç›®ä¸­å‘Šè¯‰æˆ‘ä»¬çš„ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘åŒæ„æˆ‘ä»¬åˆ†å¸ƒå¼å·¥ä¸šç³»ç»Ÿçš„ä¸€ä¸ªæ ¸å¿ƒä¸å˜ä¹‹å¤„æ˜¯ï¼Œæ ¹æœ¬æ²¡æœ‰æˆæœ¬æ•ˆç›Šé«˜çš„æ–¹æ³•æ¥è¿›è¡Œå…¨é¢é›†æˆæˆ–çƒŸé›¾æµ‹è¯•ã€‚é›†æˆæˆ–æµ‹è¯•ç¯å¢ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸€ç§æµªè´¹;æ›´å¤šçš„ç¯å¢ƒä¸ä¼šè®©äº‹æƒ…å˜å¾—æ›´å®¹æ˜“ã€‚å¯¹äºæˆ‘ä»¬çš„å¤§å¤šæ•°ç³»ç»Ÿæ¥è¯´ï¼Œè‰¯å¥½çš„å¯è§‚å¯Ÿæ€§æ¯”è‰¯å¥½çš„æµ‹è¯•æ›´é‡è¦ï¼Œå› ä¸ºè‰¯å¥½çš„å¯è§‚å¯Ÿæ€§ä½¿æ˜æ™ºçš„ç»„ç»‡èƒ½å¤Ÿä¸“æ³¨äºå¿«é€Ÿéƒ¨ç½²å’Œå›æ»šï¼Œä¼˜åŒ–å¹³å‡æ¢å¤æ—¶é—´(MTTR)ï¼Œè€Œä¸æ˜¯å¹³å‡æ•…éšœé—´éš”æ—¶é—´(MTBF)ã€‚ å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œé—®é¢˜æ˜¯:Goä¸­ä¸€ä¸ªæ°å½“çš„å¯è§‚æµ‹ç³»ç»Ÿæ˜¯ä»€ä¹ˆæ ·å­çš„?æˆ‘æƒ³æ²¡æœ‰ä¸€ä¸ªå•ä¸€çš„ç­”æ¡ˆï¼Œæ²¡æœ‰ä¸€ä¸ªåŒ…æˆ‘å¯ä»¥å‘Šè¯‰ä½ è¿›å£æ¥ä¸€åŠ³æ°¸é€¸åœ°è§£å†³é—®é¢˜ã€‚å¯è§‚å¯Ÿæ€§ç©ºé—´æ˜¯ç ´ç¢çš„ï¼Œè®¸å¤šä¾›åº”å•†ä¸ºäº†ä»–ä»¬ç‹¬ç‰¹çš„ä¸–ç•Œè§‚è€Œç«äº‰ã€‚æœ‰å¾ˆå¤šäº‹æƒ…å€¼å¾—å…´å¥‹ï¼Œä½†èƒœåˆ©è€…è¿˜æ²¡æœ‰å°˜åŸƒè½å®šã€‚åœ¨æˆ‘ä»¬ç­‰å¾…è¿™ä¸€åˆ‡å‘ç”Ÿçš„åŒæ—¶ï¼Œæˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆå‘¢? å¦‚æœæˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸€ä¸ªæ›´å®Œç¾çš„ä¸–ç•Œé‡Œï¼Œè¿™å°±æ— å…³ç´§è¦äº†ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå®Œç¾çš„å¯è§‚æµ‹æ€§æ•°æ®æ”¶é›†ç³»ç»Ÿï¼Œæ‰€æœ‰çš„è§£é‡Šéƒ½å¯ä»¥åœ¨æŸ¥è¯¢æ—¶é—´å†…å®Œæˆï¼Œè€Œä¸”æˆæœ¬ä¸ºé›¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å‘å®ƒå‘å°„åŸå§‹çš„è§‚æµ‹æ•°æ®ï¼Œå¹¶æä¾›æ— é™çš„ç»†èŠ‚ï¼Œç„¶åç”¨å®ƒæ¥å®Œæˆã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªé¢†åŸŸä¹‹æ‰€ä»¥æœ‰è¶£æˆ–å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå½“ç„¶æ˜¯å› ä¸ºæ²¡æœ‰è¿™æ ·çš„æ•°æ®ç³»ç»Ÿå­˜åœ¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸åšå‡ºå·¥ç¨‹å†³ç­–ï¼Œå¦¥åï¼Œèµ‹äºˆç‰¹å®šç±»å‹çš„è§‚å¯Ÿä»¥è¯­ä¹‰æ„ä¹‰ï¼Œä»¥å®ç°ç‰¹å®šçš„å¯è§‚å¯Ÿæ€§å·¥ä½œæµã€‚ åº¦é‡ã€æ—¥å¿—è®°å½•å’Œè·Ÿè¸ªæ˜¯ä½¿ç”¨å¯è§‚å¯Ÿæ€§æ•°æ®çš„ç´§æ€¥æ¨¡å¼ï¼Œå¯è§‚å¯Ÿæ€§æ•°æ®å‘ŠçŸ¥æˆ‘ä»¬ç”Ÿæˆã€å‘é€å’Œå­˜å‚¨ç›¸åº”ä¿¡å·çš„æ–¹å¼ã€‚å®ƒä»¬æ˜¯ä¸€ä¸ªä¼˜åŒ–å‡½æ•°çš„äº§ç‰©ï¼Œä»‹äºè¿è¥å•†å¸Œæœ›å¦‚ä½•å¯¹è‡ªå·±çš„ç³»ç»Ÿè¿›è¡Œåçœï¼Œä»¥åŠæŠ€æœ¯æ˜¯å¦èƒ½å¤Ÿå¤§è§„æ¨¡åœ°æ»¡è¶³è¿™äº›éœ€æ±‚ä¹‹é—´ã€‚æˆ–è®¸è¿˜æœ‰å…¶ä»–å°šæœªè¢«å‘ç°çš„æ¶ˆè´¹æ¨¡å¼ï¼Œå¯èƒ½æ˜¯ç”±æŠ€æœ¯è¿›æ­¥æ¨åŠ¨çš„ï¼Œè¿™å°†å¼€å¯ä¸€ä¸ªæ–°çš„æ—¶ä»£å’Œå¯è§‚å¯Ÿæ€§åˆ†ç±»ã€‚ä½†è¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©æ‰€å¤„çš„ä½ç½®ï¼Œåœ¨å¯é¢„è§çš„æœªæ¥ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨Goä¸­æœ€å¥½åœ°åˆ©ç”¨å®ƒä»¬ã€‚ åº¦é‡åº¦é‡æ˜¯è®¡æ•°å™¨ã€æµ‹é‡å™¨å’Œç›´æ–¹å›¾ï¼Œå®ƒä»¬çš„è§‚å¯Ÿç»“æœåœ¨ç»Ÿè®¡ä¸Šç»“åˆèµ·æ¥ï¼Œå¹¶æŠ¥å‘Šç»™ä¸€ä¸ªå…è®¸å¿«é€Ÿã€å®æ—¶å¯¼å‡ºæ€»ä½“ç³»ç»Ÿè¡Œä¸ºçš„ç³»ç»Ÿã€‚åº¦é‡ç”µæºæŒ‡ç¤ºæ¿å’Œè­¦æŠ¥ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¤§å¤šæ•°åº¦é‡ç³»ç»Ÿéƒ½æä¾›äº†Goå®¢æˆ·æœºåº“ï¼Œå¹¶ä¸”æ ‡å‡†çš„æ˜¾ç¤ºæ ¼å¼(å¦‚StatsD)å·²ç»å¾ˆå¥½åœ°ç†è§£å’Œå®ç°äº†ã€‚å¦‚æœæ‚¨çš„ç»„ç»‡å·²ç»æ‹¥æœ‰äº†å…³äºç»™å®šç³»ç»Ÿçš„åˆ¶åº¦çŸ¥è¯†ï¼Œè¯·å°†å…¶æ ‡å‡†åŒ–;å¦‚æœä½ åªæ˜¯åˆšåˆšå¼€å§‹æˆ–æƒ³è¦é›†ä¸­åœ¨ä¸€ä¸ªç³»ç»Ÿä¸Šï¼ŒPrometheusæ˜¯åŒç±»ä¸­æœ€å¥½çš„ã€‚ ä¸å†è¶³å¤Ÿå¥½çš„æ˜¯åŸºäºä¸»æœºæˆ–æ£€æŸ¥çš„ç³»ç»Ÿï¼Œå¦‚Nagiosã€Icingaæˆ–Gangliaã€‚è¿™äº›ä¼šä½¿æ‚¨é™·å…¥ç›‘è§†èŒƒä¾‹ä¸­ï¼Œè€Œè¿™äº›èŒƒä¾‹åœ¨å¾ˆä¹…ä»¥å‰å°±ä¸å†æœ‰æ„ä¹‰äº†ï¼Œå¹¶ä¸”ä¼šç§¯æåœ°é˜»ç¢ä½¿æ‚¨çš„ç³»ç»Ÿå¯è§ã€‚ æ—¥å¿—è®°å½•æ—¥å¿—æ˜¯å¯¹æ”¶é›†ç³»ç»Ÿå®Œå…¨çœŸå®åœ°æŠ¥å‘Šçš„ç¦»æ•£äº‹ä»¶æµï¼Œç”¨äºç¨åçš„åˆ†æã€æŠ¥å‘Šå’Œè°ƒè¯•ã€‚å¥½çš„æ—¥å¿—æ˜¯ç»“æ„åŒ–çš„ï¼Œå…è®¸çµæ´»çš„äº‹åæ“ä½œã€‚ ç°åœ¨Goä¸­æœ‰å¾ˆå¤šå¾ˆæ£’çš„æ—¥å¿—é€‰é¡¹ã€‚å¥½çš„æ—¥å¿—åº“æ˜¯é¢å‘æ—¥å¿—ç¨‹åºæ¥å£çš„ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ—¥å¿—ç¨‹åºå¯¹è±¡ã€‚å®ƒä»¬å°†æ—¥å¿—è®°å½•å™¨è§†ä¸ºä¾èµ–é¡¹ï¼Œé¿å…äº†åŒ…çš„å…¨å±€çŠ¶æ€ã€‚å¹¶ä¸”åœ¨callsiteä¸Šå¼ºåˆ¶æ‰§è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•ã€‚ æ—¥å¿—æ˜¯æŠ½è±¡çš„æµï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¦é¿å…æ—¥å¿—è®°å½•å™¨åœ¨ç£ç›˜ä¸Šå†™æˆ–æ—‹è½¬æ–‡ä»¶;è¿™æ˜¯å¦ä¸€ä¸ªæµç¨‹æˆ–ç¼–æ’å¹³å°çš„èŒè´£ã€‚è€Œä¸”æ—¥å¿—è®°å½•å¯ä»¥å¿«é€Ÿåœ°æ§åˆ¶ç³»ç»Ÿçš„è¿è¡Œæ—¶æˆæœ¬ï¼Œæ‰€ä»¥åœ¨ç”Ÿæˆå’Œå‘å‡ºæ—¥å¿—æ—¶è¦è°¨æ…å’Œæ˜æ™ºã€‚æ•è·ä¸è¯·æ±‚è·¯å¾„ç›¸å…³çš„æ‰€æœ‰å†…å®¹ï¼Œä½†è¦æ·±æ€ç†Ÿè™‘ï¼Œä½¿ç”¨è£…é¥°å™¨æˆ–ä¸­é—´ä»¶ä¹‹ç±»çš„æ¨¡å¼ã€‚ è·Ÿè¸ªè·Ÿè¸ªå¤„ç†æ‰€æœ‰è¯·æ±‚èŒƒå›´çš„æ€§èƒ½æ•°æ®ï¼Œç‰¹åˆ«æ˜¯å½“è¿™äº›æ•°æ®åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è·¨æµç¨‹å’Œç³»ç»Ÿè¾¹ç•Œæ—¶ã€‚è·Ÿè¸ªç³»ç»Ÿå°†å…ƒæ•°æ®ç»„ç»‡åˆ°æ ‘ç»“æ„ä¸­ï¼Œä»è€Œæ”¯æŒå¯¹ç‰¹å®šå¼‚å¸¸æˆ–äº‹ä»¶è¿›è¡Œæ·±åº¦åˆ†ç±»ã€‚ ç›®å‰çš„è·Ÿè¸ªå®ç°ä¸»è¦å›´ç»•OpenTracingå®ç°ï¼ŒOpenTracingæ˜¯ç”±Zipkinã€Jaegerã€Datadogç­‰å…·ä½“ç³»ç»Ÿå®ç°çš„å®¢æˆ·ç«¯APIæ ‡å‡†ã€‚OpenCensusä¸­ä¹Ÿåšäº†ä¸€äº›æœ‰è¶£çš„å·¥ä½œï¼Œå®ƒæ‰¿è¯ºæä¾›ä¸€ä¸ªæ›´åŠ é›†æˆçš„ç¯å¢ƒã€‚ å¦‚æœè·Ÿè¸ªæ˜¯æœ‰ç”¨çš„ï¼Œé‚£ä¹ˆå®ƒéœ€è¦æ˜¯å…¨é¢çš„ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¯è§‚å¯Ÿæ€§çš„æ”¯æŸ±ä¸­ï¼Œå®ƒæ‹¥æœ‰æœ€ä¸¥æ ¼çš„é¢†åŸŸå¯¹è±¡å’Œè°“è¯é›†ã€‚ç”±äºè¿™äº›åŸå› ï¼Œæ­£ç¡®å®ç°è·Ÿè¸ªçš„æˆæœ¬éå¸¸é«˜ï¼Œåªæœ‰å½“åˆ†å¸ƒå¼ç³»ç»Ÿéå¸¸å¤§(å¯èƒ½è¶…è¿‡å‡ åä¸ªå¾®æœåŠ¡)æ—¶æ‰æœ‰æ„ä¹‰å¼€å§‹å·¥ä½œã€‚ æ¯ä¸ªå¯è§‚å¯Ÿæ€§çš„æ”¯æŸ±éƒ½æœ‰ä¸åŒçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚æˆ‘è®¤ä¸ºæˆ‘ä»¬å¯ä»¥æ²¿ç€ä¸åŒçš„è½´æ¯”è¾ƒå®ƒä»¬:èµ„æœ¬æ”¯å‡ºï¼Œå¼€å§‹æµ‹é‡å’Œæ”¶é›†ä¿¡å·çš„åˆå§‹æˆæœ¬;è¿è¥æˆæœ¬ï¼Œè¿è¥æ”¯æŒåŸºç¡€è®¾æ–½çš„æŒç»­æˆæœ¬;ååº”ï¼Œç³»ç»Ÿåœ¨å‘ç°å’Œè­¦æŠ¥äº‹ä»¶æ–¹é¢æœ‰å¤šå¥½;ä»¥åŠè°ƒæŸ¥ï¼Œç³»ç»Ÿèƒ½åœ¨å¤šå¤§ç¨‹åº¦ä¸Šå¸®åŠ©å¯¹äº‹ä»¶è¿›è¡Œåˆ†ç±»å’Œè°ƒè¯•ã€‚æˆ‘çš„ä¸»è§‚æ„è§å¦‚ä¸‹: Metrics Logging Tracing èµ„æœ¬æ”¯å‡º Medium Low High ç»´æŠ¤æˆæœ¬ Low High Medium ååº”èƒ½åŠ› High Medium Low æ£€æµ‹ Low Medium High å°±èµ„æœ¬æ”¯å‡ºè€Œè¨€ï¼Œæ—¥å¿—ç³»ç»Ÿæ˜¯æœ€å®¹æ˜“å¯åŠ¨çš„ï¼Œåœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—å·¥å…·æ¯”å…¶ä»–æ–¹æ³•æ›´å®¹æ˜“ã€æ›´ç›´è§‚ã€‚åº¦é‡æ ‡å‡†æ¶‰åŠçš„æ›´å¤šï¼Œä½†æ˜¯å¤§å¤šæ•°åº¦é‡æ ‡å‡†æ”¶é›†ç³»ç»Ÿä»ç„¶æ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“éƒ¨ç½²ã€‚ä¸æ­¤ç›¸åï¼Œè·Ÿè¸ªéœ€è¦å¤§é‡æ—¶é—´æ‰èƒ½åœ¨æ•´ä¸ªæœºç¾¤ä¸­å®‰è£…ï¼Œè€Œä¸”è·Ÿè¸ªæ”¶é›†ç³»ç»Ÿé€šå¸¸å¾ˆå¤§ï¼Œéœ€è¦ä¸€äº›ä¸“é—¨çš„æ•°æ®åº“çŸ¥è¯†ã€‚ å°±OpExè€Œè¨€ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œè®©ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿä¿æŒåœ¨çº¿çŠ¶æ€éœ€è¦ä»˜å‡ºä¸æˆæ¯”ä¾‹çš„åŠªåŠ›ï¼Œé€šå¸¸ä¸ç›¸åº”çš„ç”Ÿäº§ç³»ç»Ÿä¸€æ ·å›°éš¾ï¼Œç”šè‡³æ›´å›°éš¾â€”â€”ç”±äºå¤§å¤šæ•°ç»„ç»‡éƒ½å€¾å‘äºä¸åŠ åŒºåˆ«åœ°è¿›è¡Œè¿‡å¤šçš„æ—¥å¿—è®°å½•ï¼Œè¿™ä½¿å…¶æ›´åŠ å›°éš¾ã€‚è·Ÿè¸ªç³»ç»Ÿå¯ä»¥ä»å‰æœŸæˆæœ¬ä¸­è·ç›Šï¼Œå¹¶ä¸”é€šå¸¸å¯ä»¥é¡ºåˆ©åœ°è¿›è¡Œå¤§é‡æŠ½æ ·å’Œå®šæœŸæ•°æ®åº“ç»´æŠ¤ã€‚ç›¸åï¼Œåº¦é‡ç³»ç»Ÿå—ç›Šäºç»Ÿè®¡èšåˆæ‰€äº§ç”Ÿçš„è‡ªç„¶æ•°æ®å‹ç¼©ï¼Œå¹¶ä¸”é€šå¸¸å…·æœ‰éå¸¸ä½çš„ç»´æŠ¤æˆæœ¬ã€‚å½“ç„¶ï¼Œå¦‚æœä½ é€‰æ‹©ä½¿ç”¨ä¾›åº”å•†ï¼Œè¿™äº›æˆæœ¬ä¼šç›´æ¥è½¬åŒ–ä¸ºç¾å…ƒã€‚ å°±ååº”èƒ½åŠ›è€Œè¨€ï¼Œåº¦é‡ç³»ç»Ÿè¢«æ˜¾å¼åœ°è®¾è®¡ä¸ºæœåŠ¡äºdashboardå’Œè­¦æŠ¥ç”¨ä¾‹ï¼Œä»¥åŠexcelã€‚æ—¥å¿—ç³»ç»Ÿç»å¸¸ä½¿ç”¨ä¸€äº›å·¥å…·æ¥æ‰§è¡Œå¯ä»¥é©±åŠ¨ä»ªè¡¨æ¿å’Œè­¦æŠ¥çš„èšåˆæˆ–æ»šåŠ¨ï¼Œåªéœ€è¦åšä¸€ç‚¹å·¥ä½œã€‚è€Œè·Ÿè¸ªç³»ç»Ÿé€šå¸¸æ²¡æœ‰èƒ½åŠ›å®šä¹‰ã€æ£€æµ‹æˆ–å‘å‡ºå¼‚å¸¸ä¿¡å·ã€‚ ç„¶è€Œï¼Œå½“æ¶‰åŠåˆ°è°ƒæŸ¥æ—¶ï¼Œå½¢åŠ¿å‘ç”Ÿäº†é€†è½¬ã€‚å…¬åˆ¶ç³»ç»Ÿåœ¨è®¾è®¡ä¸Šå¤±å»äº†æ•°æ®çš„ä¿çœŸåº¦ï¼Œè€Œä¸”é€šå¸¸åœ¨æ£€æµ‹åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› åï¼Œæ— æ³•æä¾›æ·±å…¥ç ”ç©¶é—®é¢˜æ ¹æºçš„å¥½æ–¹æ³•ã€‚æ—¥å¿—ç³»ç»Ÿåšå¾—æ›´å¥½ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—è®°å½•å’Œå…·æœ‰ä¸°å¯ŒæŸ¥è¯¢è¯­è¨€çš„æ—¥å¿—ç³»ç»Ÿã€‚è·Ÿè¸ªæœ¬è´¨ä¸Šæ˜¯ä¸ºé’ˆå¯¹ç‰¹å®šè¯·æ±‚æˆ–è¯·æ±‚ç±»çš„æ·±å…¥ç ”ç©¶è€Œè®¾è®¡çš„ï¼Œæœ‰æ—¶æ˜¯è¯†åˆ«å¤æ‚çš„ä¸é€‚åº”è¡Œä¸ºçš„å”¯ä¸€æ–¹æ³•ã€‚ è¿™é‡Œçš„æ•™è®­æ˜¯ï¼Œæ²¡æœ‰ä¸€ä¸ªå•ä¸€çš„å¯è§‚å¯Ÿæ€§èŒƒå¼èƒ½å¤Ÿè§£å†³æ‚¨æ‰€æœ‰çš„å¯è§‚å¯Ÿæ€§éœ€æ±‚;å®ƒä»¬éƒ½æ˜¯å®Œæ•´çš„å¯è§‚å¯Ÿæ—©é¤çš„ä¸€éƒ¨åˆ†ã€‚ä»ä»–ä»¬ç‹¬ç‰¹çš„ç‰¹ç‚¹ï¼Œæˆ‘è®¤ä¸ºæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€äº›ä¸€èˆ¬æ€§çš„å»ºè®®: é¦–å…ˆï¼ŒæŠ•èµ„äºåŸºæœ¬çš„ã€å…¨é¢çš„åº¦é‡æ ‡å‡†ï¼Œä¸ºç»„ä»¶æä¾›ä¸€ç»„ç»Ÿä¸€çš„ä»ªè¡¨æ¿å’Œè­¦æŠ¥ã€‚åœ¨å®è·µä¸­ï¼Œè¿™é€šå¸¸è¶³ä»¥å‘ç°å¹¶è§£å†³å¤§é‡çš„é—®é¢˜ã€‚ æ¥ä¸‹æ¥ï¼ŒæŠ•èµ„äºæ·±åº¦ã€é«˜åŸºæ•°ã€ç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿å¯¹æ›´å¤æ‚çš„é—®é¢˜è¿›è¡Œäº‹ä»¶åˆ†ç±»å’Œè°ƒè¯•ã€‚ æœ€åï¼Œå½“æ‚¨æ‹¥æœ‰è¶³å¤Ÿå¤§çš„è§„æ¨¡å’Œå®šä¹‰è‰¯å¥½çš„ç”Ÿäº§å‡†å¤‡æ ‡å‡†æ—¶ï¼Œç ”ç©¶åˆ†å¸ƒå¼è·Ÿè¸ªã€‚ æµ‹è¯•å°½ç®¡å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§‚å¯Ÿæ€§å¯èƒ½ä¼˜äºé›†æˆæµ‹è¯•ï¼Œä½†æ˜¯å•å…ƒå’Œæœ‰é™çš„é›†æˆæµ‹è¯•ä»ç„¶æ˜¯ä»»ä½•è½¯ä»¶é¡¹ç›®çš„åŸºç¡€å’Œå¿…è¦çš„ã€‚ç‰¹åˆ«æ˜¯åœ¨å·¥ä¸šç¯å¢ƒä¸­ï¼Œæˆ‘è®¤ä¸ºå®ƒæœ€å¤§çš„ä»·å€¼æ˜¯ä¸ºæ–°çš„ç»´æŠ¤è€…æä¾›ä¸€ç§å¥åº·æ£€æŸ¥å±‚ï¼Œä½¿ä»–ä»¬çš„æ›´æ”¹å…·æœ‰é¢„æœŸçš„èŒƒå›´å’Œæ•ˆæœã€‚ å› æ­¤ï¼Œæµ‹è¯•åº”è¯¥ä¼˜åŒ–ä¸ºæ˜“ç”¨æ€§ã€‚å¦‚æœåˆçº§å¼€å‘äººå‘˜åœ¨å…‹éš†repoä¹‹åæ— æ³•ç«‹å³è¿è¡Œé¡¹ç›®çš„æµ‹è¯•ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚åœ¨Goä¸­ï¼Œæˆ‘è®¤ä¸ºè¿™æ„å‘³ç€åœ¨æ‚¨çš„é¡¹ç›®ä¸­è¿è¡Œæ™®é€šçš„Goæµ‹è¯•ï¼Œè€Œæ²¡æœ‰é¢å¤–çš„è®¾ç½®å·¥ä½œï¼Œåº”è¯¥æ€»æ˜¯æˆåŠŸçš„ï¼Œä¸ä¼šå‘ç”Ÿæ„å¤–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§å¤šæ•°æµ‹è¯•ä¸åº”è¯¥è¦æ±‚ä»»ä½•ç±»å‹çš„æµ‹è¯•ç¯å¢ƒã€è¿è¡Œæ•°æ®åº“ç­‰æ¥æ­£å¸¸è¿è¡Œå¹¶è¿”å›æˆåŠŸã€‚è¿™äº›æµ‹è¯•æ˜¯é›†æˆæµ‹è¯•ï¼Œå®ƒä»¬åº”è¯¥é€šè¿‡æµ‹è¯•æ ‡å¿—æˆ–ç¯å¢ƒå˜é‡é€‰æ‹©åŠ å…¥: 123456789func TestComplex(t *testing.T) &#123; urn := os.Getenv(\"TEST_DB_URN\") if urn == \"\" &#123; t.Skip(\"set TEST_DB_URN to run this test\") &#125; db, _ := connect(urn) // ...&#125; æµ‹è¯•é‡‘å­—å¡”æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€šç”¨å»ºè®®ï¼Œå»ºè®®æ‚¨åº”è¯¥å°†å¤§éƒ¨åˆ†ç²¾åŠ›é›†ä¸­åœ¨å•å…ƒæµ‹è¯•ä¸Šã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œç†æƒ³çš„æ¯”ç‡ç”šè‡³æ¯”é‡‘å­—å¡”å»ºè®®çš„è¿˜è¦æç«¯:å¦‚æœæ‚¨å…·æœ‰è‰¯å¥½çš„ç”Ÿäº§å¯è§‚å¯Ÿæ€§ï¼Œé‚£ä¹ˆæ‚¨çš„æµ‹è¯•å·¥ä½œçš„80-90%åº”è¯¥é›†ä¸­äºå•å…ƒæµ‹è¯•ã€‚åœ¨Goä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å¥½çš„å•å…ƒæµ‹è¯•æ˜¯è¡¨é©±åŠ¨çš„ï¼Œå¹¶ä¸”åˆ©ç”¨ç»„ä»¶æ¥å—æ¥å£å¹¶è¿”å›ç»“æ„çš„äº‹å®æ¥æä¾›ä¾èµ–å…³ç³»çš„ä¼ªå®ç°æˆ–æ¨¡æ‹Ÿå®ç°ï¼Œå¹¶ä¸”åªæµ‹è¯•è¢«æµ‹è¯•çš„ä¸œè¥¿ã€‚ ç±³åˆ‡å°”æ¡¥æœ¬(Mitchell Hashimoto)å»å¹´åœ¨GopherConä¸Šä½¿ç”¨Goè¿›è¡Œçš„é«˜çº§æµ‹è¯•ï¼Œå¯èƒ½æ˜¯è¿„ä»Šä¸ºæ­¢æˆ‘æ‰€è§è¿‡çš„æœ‰å…³å·¥ä¸šç¯å¢ƒä¸‹çš„ä¼˜ç§€Goç¨‹åºè®¾è®¡çš„æœ€ä½³ä¿¡æ¯æ¥æºã€‚å¦‚æœæ‚¨çš„å›¢é˜Ÿç¼–å†™Goï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯åŸºæœ¬çš„èƒŒæ™¯ææ–™ã€‚ å…³äºè¿™ä¸ªé—®é¢˜æ²¡æœ‰å¤ªå¤šå¯è¯´çš„äº†ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæµ‹è¯•æœ€ä½³å®è·µçš„ç›¸å¯¹ç¨³å®šæ€§æ˜¯ä¸€ä¸ªå—æ¬¢è¿çš„ç¼“åˆ‘ã€‚ä¸€å¦‚æ—¢å¾€åœ°:è¿½æ±‚100%çš„æµ‹è¯•è¦†ç›–ç‡å‡ ä¹è‚¯å®šä¼šé€‚å¾—å…¶åï¼Œä½†50%ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä½æ°´å°;é¿å…å¼•å…¥æµ‹è¯•dslæˆ–â€œå¸®åŠ©åŒ…â€ï¼Œé™¤éæ‚¨çš„å›¢é˜Ÿä»ä¸­è·å¾—æ˜ç¡®çš„ã€å…·ä½“çš„ä»·å€¼ã€‚ æˆ‘éœ€è¦å¤šå°‘æ¥å£? å½“æˆ‘ä»¬è°ˆè®ºæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬è°ˆè®ºé€šè¿‡æ¥å£æ¨¡æ‹Ÿä¾èµ–å…³ç³»ï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸å¹¶æ²¡æœ‰çœŸæ­£æè¿°å®ƒåœ¨å®è·µä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘è®¤ä¸ºå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå›´æ£‹ç³»ç»Ÿä¸æ˜¯æ ‡ç§°çš„ï¼Œè€Œæ˜¯ç»“æ„æ€§çš„ã€‚å°†æ¥å£çœ‹ä½œæ˜¯å¯¹å®ç°è¿›è¡Œåˆ†ç±»çš„ä¸€ç§æ–¹æ³•æ˜¯é”™è¯¯çš„;ç›¸åï¼Œå°†æ¥å£çœ‹ä½œæ˜¯ä¸€ç§è¯†åˆ«æœŸæœ›å…¬å…±è¡Œä¸ºé›†çš„ä»£ç çš„æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œæ¥å£æ˜¯æ¶ˆè´¹è€…å¥‘çº¦ï¼Œè€Œä¸æ˜¯ç”Ÿäº§è€…(å®ç°è€…)å¥‘çº¦â€”â€”å› æ­¤ï¼Œä½œä¸ºä¸€ä¸ªè§„åˆ™ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä½¿ç”¨ä»£ç çš„callsiteä¸­å®šä¹‰æ¥å£ï¼Œè€Œä¸æ˜¯åœ¨æä¾›å®ç°çš„åŒ…ä¸­å®šä¹‰æ¥å£ã€‚ æ‚¨éœ€è¦å¤šå°‘æ¥å£?å—¯ï¼Œæœ‰ä¸€ä¸ªé¢‘è°±ã€‚åœ¨æ‚¨çš„callsiteä¸Šå°½å¯èƒ½çš„æœ‰æ„ä¹‰ï¼Œç‰¹åˆ«æ˜¯ä¸ºäº†å¸®åŠ©æµ‹è¯•ã€‚åœ¨ä¸€ç§æç«¯æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¥æ ¼ä½œç”¨åŸŸçš„æ¥å£å®šä¹‰ä¸ºæ¯ä¸ªå‡½æ•°çš„æ¯ä¸ªä¾èµ–å…³ç³»å»ºæ¨¡ã€‚åœ¨æœ‰é™çš„æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„!ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ç»„ä»¶æ˜¯ç²—ç²’åº¦çš„ã€è‰¯å¥½çš„ï¼Œå¹¶ä¸”å°†æ¥ä¸å¤ªå¯èƒ½æ›´æ”¹ã€‚ ä½†æ˜¯ï¼Œç‰¹åˆ«æ˜¯åœ¨å·¥ä¸šä¸Šä¸‹æ–‡ä¸­ï¼Œæ›´æœ‰å¯èƒ½å‡ºç°æ··åˆçš„æŠ½è±¡ï¼Œè¿™äº›æŠ½è±¡éšæ—¶é—´è€Œå˜åŒ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨æ‚¨çš„è®¾è®¡ä¸­å°è¯•åœ¨â€œæ•…éšœçº¿â€ä¸Šå®šä¹‰æ¥å£ã€‚ä¸¤ä¸ªè‡ªç„¶è¾¹ç•Œç‚¹ä½äºfunc mainå’Œä»£ç å…¶ä½™éƒ¨åˆ†ä¹‹é—´ï¼Œä»¥åŠåŒ…apiä¹‹é—´ã€‚å®šä¹‰ä¾èµ–æ¥å£æœ‰ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹æ¥å¼€å§‹è€ƒè™‘å®šä¹‰å•å…ƒæµ‹è¯•ã€‚ ä¸Šä¸‹æ–‡ä½¿ç”¨å’Œè¯¯ç”¨ Go 1.7ç»™æˆ‘ä»¬å¸¦æ¥äº†åŒ…ä¸Šä¸‹æ–‡ï¼Œä»é‚£æ—¶èµ·ï¼Œå®ƒå°±ä¸€ç›´åœ¨å½±å“æˆ‘ä»¬çš„ä»£ç ã€‚è¿™ä¸æ˜¯ä¸€ä»¶åäº‹!ä¸Šä¸‹æ–‡æ˜¯ç®¡ç†goroutineç”Ÿå‘½å‘¨æœŸçš„ä¸€ç§å¾ˆå¥½ç†è§£ä¸”æ— å¤„ä¸åœ¨çš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§è€Œå›°éš¾çš„é—®é¢˜ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™æ˜¯å®ƒä»¬æœ€é‡è¦çš„åŠŸèƒ½ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç»„ä»¶ç”±äºä»»ä½•åŸå› é˜»å¡â€”é€šå¸¸æ˜¯ç½‘ç»œI/Oï¼Œæœ‰æ—¶æ˜¯ç£ç›˜I/Oï¼Œå¯èƒ½æ˜¯ç”±äºç”¨æˆ·å›è°ƒï¼Œç­‰ç­‰â€”é‚£ä¹ˆå®ƒå¯èƒ½åº”è¯¥å°†ä¸Šä¸‹æ–‡ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ è¿™ç§æ¨¡å¼æ— å¤„ä¸åœ¨ï¼Œæˆ‘ä»ä¸€å¼€å§‹å°±æŠŠå®ƒè®¾è®¡åˆ°æˆ‘çš„æœåŠ¡å™¨ç±»å‹å’Œæ¥å£ä¸­ã€‚ä¸‹é¢æ˜¯æœ€è¿‘ä¸€ä¸ªè¿æ¥åˆ°è°·æ­Œäº‘å­˜å‚¨çš„é¡¹ç›®çš„ä¾‹å­:Go 1.7ç»™æˆ‘ä»¬å¸¦æ¥äº†åŒ…ä¸Šä¸‹æ–‡ï¼Œä»é‚£æ—¶èµ·ï¼Œå®ƒå°±ä¸€ç›´åœ¨å½±å“æˆ‘ä»¬çš„ä»£ç ã€‚è¿™ä¸æ˜¯ä¸€ä»¶åäº‹!ä¸Šä¸‹æ–‡æ˜¯ç®¡ç†goroutineç”Ÿå‘½å‘¨æœŸçš„ä¸€ç§å¾ˆå¥½ç†è§£ä¸”æ— å¤„ä¸åœ¨çš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§è€Œå›°éš¾çš„é—®é¢˜ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™æ˜¯å®ƒä»¬æœ€é‡è¦çš„åŠŸèƒ½ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç»„ä»¶ç”±äºä»»ä½•åŸå› é˜»å¡â€”é€šå¸¸æ˜¯ç½‘ç»œI/Oï¼Œæœ‰æ—¶æ˜¯ç£ç›˜I/Oï¼Œå¯èƒ½æ˜¯ç”±äºç”¨æˆ·å›è°ƒï¼Œç­‰ç­‰â€”é‚£ä¹ˆå®ƒå¯èƒ½åº”è¯¥å°†ä¸Šä¸‹æ–‡ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ è¿™ç§æ¨¡å¼æ— å¤„ä¸åœ¨ï¼Œæˆ‘ä»ä¸€å¼€å§‹å°±æŠŠå®ƒè®¾è®¡åˆ°æˆ‘çš„æœåŠ¡å™¨ç±»å‹å’Œæ¥å£ä¸­ã€‚ä¸‹é¢æ˜¯æœ€è¿‘ä¸€ä¸ªè¿æ¥åˆ°è°·æ­Œäº‘å­˜å‚¨çš„é¡¹ç›®çš„ä¾‹å­: 123456// reportStore is a thin domain abstraction over GCS.type reportStore interface &#123; listTimes(ctx context.Context, from time.Time, n int) ([]time.Time, error) writeFile(ctx context.Context, ts time.Time, name string, r io.Reader) error serveFile(ctx context.Context, ts time.Time, name string, w io.Writer) error&#125; ä¸ºç”Ÿå‘½å‘¨æœŸè¯­ä¹‰ç¼–å†™ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç»„ä»¶å¾ˆç®€å•:åªè¦ç¡®ä¿ä»£ç å“åº”ctx.Doneå³å¯ã€‚äº‹å®è¯æ˜ï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡çš„å€¼ä¼ æ’­ç‰¹æ€§æœ‰ç‚¹æ£˜æ‰‹ã€‚ä¸Šä¸‹æ–‡çš„é—®é¢˜ã€‚å€¼æ˜¯é”®å’Œå€¼æ˜¯æ— ç±»å‹çš„ï¼Œå¹¶ä¸”ä¸èƒ½ä¿è¯å­˜åœ¨ï¼Œè¿™å°†ä½¿ç¨‹åºé¢ä¸´è¿è¡Œæ—¶æˆæœ¬å’Œæ•…éšœæ¨¡å¼ï¼Œå¦åˆ™è¿™äº›é—®é¢˜æ˜¯å¯ä»¥é¿å…çš„ã€‚æˆ‘çš„ç»éªŒæ˜¯å¼€å‘äººå‘˜è¿‡åº¦ä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚å€¼ï¼Œè¿™äº›å€¼å®é™…ä¸Šåº”è¯¥æ˜¯å¸¸è§„ä¾èµ–é¡¹æˆ–å‡½æ•°å‚æ•°ã€‚ æ‰€ä»¥ï¼Œä¸€ä¸ªåŸºæœ¬çš„ç»éªŒæ˜¯:åªä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚æ— æ³•ä»¥ä»»ä½•å…¶ä»–æ–¹å¼é€šè¿‡ç¨‹åºä¼ é€’çš„æ•°æ®çš„å€¼ã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€åªä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚å€¼ï¼Œç”¨äºè¯·æ±‚èŒƒå›´çš„ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚idã€ç”¨æˆ·èº«ä»½éªŒè¯ä»¤ç‰Œç­‰ï¼Œè¿™äº›ä¿¡æ¯ä»…åœ¨è¯·æ±‚æ—¶åˆ›å»ºæˆ–åœ¨è¯·æ±‚æœŸé—´åˆ›å»ºã€‚å¦‚æœè¯¥ä¿¡æ¯åœ¨ç¨‹åºå¯åŠ¨æ—¶å¯ç”¨ï¼Œæ¯”å¦‚æ•°æ®åº“å¥æŸ„æˆ–æ—¥å¿—è®°å½•å™¨ï¼Œåˆ™ä¸åº”é€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’è¯¥ä¿¡æ¯ã€‚ åŒæ ·ï¼Œè¿™ä¸ªå»ºè®®çš„åŸºæœ¬åŸç†å½’ç»“ä¸ºå¯ç»´æŠ¤æ€§ã€‚å¦‚æœä¸€ä¸ªç»„ä»¶ä»¥æ„é€ å‡½æ•°æˆ–å‡½æ•°å‚æ•°çš„å½¢å¼æšä¸¾å®ƒçš„éœ€æ±‚(åœ¨ç¼–è¯‘æ—¶å¯æ£€æŸ¥)ï¼Œè¿™è¦æ¯”ä»ä¸€ä¸ªåªåœ¨è¿è¡Œæ—¶å¯æ£€æŸ¥çš„æ— ç±»å‹ã€ä¸é€æ˜çš„å€¼åŒ…ä¸­æå–ä¿¡æ¯å¥½å¾—å¤šã€‚åè€…ä¸ä»…æ›´åŠ è„†å¼±ï¼Œè€Œä¸”ä½¿ç†è§£å’Œè°ƒæ•´ä»£ç å˜å¾—æ›´åŠ å›°éš¾ã€‚ æ€»ç»“æˆ‘åšè¿™ä¸ªæœ€ä½³å®è·µç³»åˆ—å·²ç»æœ‰å…­å¹´äº†ï¼Œè™½ç„¶æœ‰ä¸€äº›æŠ€å·§æ¥æ¥å»å»ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹æ–°å‡ºç°çš„ä¹ æƒ¯ç”¨æ³•å’Œæ¨¡å¼ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½œä¸ºä¸€ä¸ªæœ‰æ•ˆçš„å›´æ£‹ç¨‹åºå‘˜ï¼Œæ‰€éœ€çš„åŸºç¡€çŸ¥è¯†åœ¨è¿™æ®µæ—¶é—´å†…å‡ ä¹æ²¡æœ‰æ”¹å˜ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸è¿½æ±‚è®¾è®¡è¶‹åŠ¿ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸ç¨³å®šçš„è¯­è¨€å’Œç”Ÿæ€ç³»ç»Ÿï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä¸ä»…ä»…æ˜¯åœ¨ä¸ºè‡ªå·±è¯´è¯ï¼Œå½“æˆ‘è¯´æˆ‘çœŸçš„å¾ˆæ„Ÿæ¿€çš„æ—¶å€™ã€‚ æˆ‘è®¤ä¸ºï¼Œåœ¨è¿™æ ·çš„ä¼šè®®ä¸Šï¼Œæˆ‘ä»¬èƒ½å¤Ÿå½¼æ­¤ç†Ÿæ‚‰ï¼Œè¿™æ˜¯å¾ˆå¥½çš„ã€‚ä½†æˆ‘è®¤ä¸ºæˆ‘ä»¬åœ¨è¿™é‡Œèƒ½åšçš„æœ€å¥½çš„äº‹æƒ…æ˜¯å»ºç«‹å¯¹å½¼æ­¤çš„åŒç†å¿ƒã€‚å¦‚æœæˆ‘ä»¬æŠŠå·¥ä½œåšå¥½ï¼Œéšç€Goç¨‹åºå‘˜æ•°é‡çš„ä¸æ–­å¢é•¿ï¼Œç¤¾åŒºå°†å˜å¾—è¶Šæ¥è¶Šå¤šæ ·åŒ–ï¼Œå…·æœ‰ä¸åŒçš„å·¥ä½œæµã€ä¸Šä¸‹æ–‡å’Œç›®æ ‡ã€‚æˆ‘å¾ˆé«˜å…´å‘å¤§å®¶ä»‹ç»äº†æˆ‘åœ¨Goä¸Šçš„ä¸€äº›ä½“éªŒæŠ¥å‘Šï¼Œæˆ‘ä¹Ÿå¾ˆé«˜å…´èƒ½å¬åˆ°å¹¶ç†è§£å¤§å®¶çš„æ„Ÿå—ã€‚å¤šè°¢!","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-10.å°†Yeomané›†æˆåˆ°å…¶ä»–å·¥å…·ä¸­","slug":"yeoman-authoring10","date":"2018-08-29T16:53:40.000Z","updated":"2020-07-25T02:57:18.232Z","comments":true,"path":"2018/08/30/yeoman-authoring10/","link":"","permalink":"https://jigangduan.github.io/2018/08/30/yeoman-authoring10/","excerpt":"","text":"æ¯æ¬¡è¿è¡Œç”Ÿæˆå™¨æ—¶ï¼Œæ‚¨å®é™…ä¸Šéƒ½åœ¨ä½¿ç”¨yeoman-environmentã€‚ç¯å¢ƒæ˜¯ä¸€ä¸ªä¸ä»»ä½•UIç»„ä»¶åˆ†ç¦»çš„åŸºç¡€ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ä»»ä½•å·¥å…·è¿›è¡ŒæŠ½è±¡ã€‚å½“ä½ è¿è¡Œæ—¶yoï¼Œä½ åŸºæœ¬ä¸Šåªæ˜¯åœ¨æ ¸å¿ƒYeomanç¯å¢ƒä¹‹ä¸Šè¿è¡Œç»ˆç«¯UIå¤–è§‚ã€‚ åŸºç¡€æ‚¨éœ€è¦çŸ¥é“çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç¯å¢ƒç³»ç»ŸåŒ…å«åœ¨yeoman-environmentåŒ…ä¸­ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œæ¥å®‰è£…å®ƒï¼š 1npm install --save yeoman-environment è¯¥æ¨¡å—æä¾›äº†æ£€ç´¢å·²å®‰è£…çš„ç”Ÿæˆå™¨ï¼Œæ³¨å†Œå’Œè¿è¡Œç”Ÿæˆå™¨çš„æ–¹æ³•ã€‚å®ƒè¿˜æä¾›äº†ç”Ÿæˆå™¨æ­£åœ¨ä½¿ç”¨çš„ç”¨æˆ·ç•Œé¢é€‚é…å™¨ã€‚æˆ‘ä»¬æä¾›å®Œæ•´çš„APIæ–‡æ¡£ï¼ˆè¿™æ˜¯å¯ç”¨æ–¹æ³•çš„ç®€æ´åˆ—è¡¨ã€‚ï¼‰ è¿ç”¨ yeoman-environmentä¸€ä¸ªç®€å•çš„ç”¨æ³•ç¤ºä¾‹ åœ¨æˆ‘ä»¬è½¬å‘yeoman-environmentæ›´æ·±å±‚æ¬¡çš„ä¸»é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ç”¨æ³•ç¤ºä¾‹å¼€å§‹ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè®©æˆ‘ä»¬å‡è®¾npmæƒ³è¦npm initä¸ºè„šæ‰‹æ¶æä¾›ä¸€ä¸ªå‘½ä»¤package.jsonã€‚é˜…è¯»æ–‡æ¡£çš„å…¶ä»–é¡µé¢ï¼Œæ‚¨å·²ç»çŸ¥é“å¦‚ä½•åˆ›å»ºç”Ÿæˆå™¨ - æ‰€ä»¥è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†generator-npmã€‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•è°ƒç”¨å®ƒã€‚ ç¬¬ä¸€æ­¥æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„ç¯å¢ƒå®ä¾‹ã€‚ 12var yeoman = require('yeoman-environment');var env = yeoman.createEnv(); ç„¶åï¼Œæˆ‘ä»¬å°†è¦æ³¨å†Œgenerator-npmä»¥ä¾¿ä»¥åä½¿ç”¨ã€‚ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š 12345678// Here we register a generator based on its path. Providing the namespace// is optional.env.register(require.resolve('generator-npm'), 'npm:app');// Or you can provide a generator constructor. Doing so, you need to provide// a namespace manuallyvar GeneratorNPM = generators.Base.extend(/* put your methods in here */);env.registerStub(GeneratorNPM, 'npm:app'); è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ³¨å†Œä»»æ„æ•°é‡çš„ç”Ÿæˆå™¨ã€‚å·²æ³¨å†Œçš„ç”Ÿæˆå™¨ä»…åœ¨æ•´ä¸ªç¯å¢ƒä¸­å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œå…è®¸å¯ç»„åˆæ€§ï¼‰ã€‚ æ­¤æ—¶ï¼Œæ‚¨çš„ç¯å¢ƒå·²å‡†å¤‡å¥½è¿è¡Œnpm:appã€‚ 12345// In its simplest formenv.run('npm:app', done);// Or passing arguments and optionsenv.run('npm:app some-name', &#123; 'skip-install': true &#125;, done); æ‚¨åªéœ€è¦å°†æ­¤ä»£ç æ”¾åœ¨ä¸€ä¸ªbinå¯è¿è¡Œçš„æ–‡ä»¶ä¸­ï¼Œæ‚¨å°±å¯ä»¥åœ¨yoä¸ä½¿ç”¨çš„æƒ…å†µä¸‹è¿è¡ŒYeomanç”Ÿæˆå™¨ã€‚ æŸ¥æ‰¾å®‰è£…çš„ç”Ÿæˆå™¨ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¸Œæœ›æä¾›å¯¹ç”¨æˆ·è®¡ç®—æœºä¸Šå®‰è£…çš„æ¯ä¸ªYeomanç”Ÿæˆå™¨çš„è®¿é—®æƒé™ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿç„¶åï¼Œæ‚¨éœ€è¦æ‰§è¡Œç”¨æˆ·ç£ç›˜çš„æŸ¥æ‰¾ã€‚ 123env.lookup(function () &#123; env.run('angular');&#125;); Environment#lookup()ä¸€æ—¦Yeomanå®Œæˆæœç´¢å·²å®‰è£…çš„ç”Ÿæˆå™¨ï¼Œå°±ä¼šè°ƒç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚æ¯ä¸ªæ‰¾åˆ°çš„ç”Ÿæˆå™¨éƒ½å°†åœ¨ç¯å¢ƒä¸­æ³¨å†Œã€‚ å¦‚æœå‘½åç©ºé—´å†²çªï¼Œæœ¬åœ°ç”Ÿæˆå™¨å°†è¦†ç›–å…¨å±€ç”Ÿæˆå™¨ã€‚ è·å–æœ‰å…³æ³¨å†Œç”Ÿæˆå™¨çš„æ•°æ®è°ƒç”¨Environment#getGeneratorsMeta()å°†è¿”å›æè¿°æŸ¥æ‰¾ä»»åŠ¡æ³¨å†Œçš„å…ƒæ•°æ®çš„å¯¹è±¡ã€‚ æ¯ä¸ªå¯¹è±¡é”®éƒ½æ˜¯ç”Ÿæˆå™¨å‘½åç©ºé—´ï¼Œå€¼å¯¹è±¡åŒ…å«ä»¥ä¸‹é”®ï¼š resolvedï¼šç”Ÿæˆå™¨çš„å·²è§£æè·¯å¾„ namespaceï¼šç”Ÿæˆå™¨çš„å‘½åç©ºé—´ ä¾‹å¦‚ï¼š 123456&#123; \"webapp:app\": &#123; \"resolved\": \"/usr/lib/node_modules/generator-webapp/app/index.js\", \"namespace\": \"webapp:app\" &#125;&#125; æ³¨æ„ï¼šä½¿ç”¨æ³¨å†Œçš„å‘ç”µæœº#registerStub()å°†â€unknownâ€ä½œä¸ºresolvedå€¼ã€‚ æä¾›è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰Yeomanä½¿ç”¨é€‚é…å™¨ä½œä¸ºæŠ½è±¡å±‚ï¼Œå…è®¸IDEï¼Œä»£ç ç¼–è¾‘å™¨ç­‰è½»æ¾æä¾›è¿è¡Œç”Ÿæˆå™¨æ‰€éœ€çš„ç”¨æˆ·ç•Œé¢ã€‚ é€‚é…å™¨æ˜¯è´Ÿè´£å¤„ç†ä¸ç”¨æˆ·çš„æ‰€æœ‰äº¤äº’çš„å¯¹è±¡ã€‚å¦‚æœè¦ä»ç»å…¸å‘½ä»¤è¡Œæä¾›ä¸åŒçš„äº¤äº’æ¨¡å‹ï¼Œåˆ™å¿…é¡»ç¼–å†™è‡ªå·±çš„é€‚é…å™¨ã€‚æ¯ä¸ªä¸ç”¨æˆ·äº¤äº’çš„æ–¹æ³•éƒ½æ˜¯é€šè¿‡è¿™ä¸ªé€‚é…å™¨ï¼ˆä¸»è¦æ˜¯ï¼šæç¤ºï¼Œè®°å½•å’ŒåŒºåˆ†ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒYeomanæä¾›ç»ˆç«¯é€‚é…å™¨ã€‚æˆ‘ä»¬çš„æµ‹è¯•åŠ©æ‰‹æä¾›äº†ä¸€ä¸ªæµ‹è¯•é€‚é…å™¨ï¼Œä»–ä¼šå˜²ç¬‘æç¤ºå¹¶ä½¿è¾“å‡ºé™éŸ³ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬ç”¨ä½œæ‚¨è‡ªå·±å®ç°çš„å‚è€ƒã€‚ é€‚é…å™¨åº”è‡³å°‘æä¾›ä¸‰ç§æ–¹æ³•ã€‚ Adapter#prompt() å®ƒæä¾›äº†é—®ç­”åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå½“æ‚¨å¯åŠ¨æ—¶yoï¼Œä¼šå‘ç”¨æˆ·æç¤ºä¸€ç»„å¯èƒ½çš„æ“ä½œï¼‰ã€‚å®ƒçš„ç­¾åå’Œè¡Œä¸ºéµå¾ªInquirer.jsçš„è¿™äº›ã€‚å½“ç”Ÿæˆå™¨è°ƒç”¨æ—¶this.promptï¼Œè°ƒç”¨æœ€ç»ˆç”±é€‚é…å™¨å¤„ç†ã€‚ Adapter#diff() é‡åˆ°å†²çªæ—¶å†…éƒ¨è°ƒç”¨ï¼Œå¹¶ä¸”ç”¨æˆ·è¦æ±‚æ—§æ–‡ä»¶å’Œæ–°æ–‡ä»¶ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼ˆä¸¤ä¸ªæ–‡ä»¶å†…å®¹éƒ½ä½œä¸ºå‚æ•°ä¼ é€’ï¼‰ã€‚ Adapter#log()å®ƒæ—¢æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç”¨äºé€šç”¨è¾“å‡ºçš„å¯¹è±¡ã€‚æœ‰å…³lib/util/log.jsè¦æä¾›çš„æ–¹æ³•çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…ã€‚ ç¤ºä¾‹å®ç°è¿™æ˜¯ä½¿ç”¨çš„æ¨¡å—/æ’ä»¶/åº”ç”¨ç¨‹åºåˆ—è¡¨yeoman-environmentã€‚ä½ å¯ä»¥ç”¨å®ƒä»¬ä½œä¸ºçµæ„Ÿã€‚ yo yeoman-app","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-9.è°ƒè¯•ç”Ÿæˆå™¨","slug":"yeoman-authoring9","date":"2018-08-29T16:50:40.000Z","updated":"2020-07-25T02:57:18.234Z","comments":true,"path":"2018/08/30/yeoman-authoring9/","link":"","permalink":"https://jigangduan.github.io/2018/08/30/yeoman-authoring9/","excerpt":"","text":"è¦è°ƒè¯•ç”Ÿæˆå™¨ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œå®ƒæ¥ä¼ é€’Node.jsè°ƒè¯•æ ‡å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112# OS X / Linuxnode --inspect `which yo` &lt;generator&gt; [arguments]# Windows# Find the path to the yo binary in Command Promptwhere yo# Or find the path to the yo binary in PowerShellget-command yo# Would be something like C:\\Users\\&lt;USER&gt;\\AppData\\Roaming\\npm\\yo# Use this path to derive yo cli.js file# C:\\Users\\&lt;USER&gt;\\AppData\\Roaming\\npm\\node_modules\\yo\\lib\\cli.jsnode --inspect &lt;path to yo cli.js&gt; &lt;generator&gt; [arguments] ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Chrome Devtoolsæˆ–é¦–é€‰IDEè°ƒè¯•æ‚¨çš„ç”Ÿæˆå™¨ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Nodeè°ƒè¯•æŒ‡å—ã€‚ Yeomanç”Ÿæˆå™¨è¿˜æä¾›è°ƒè¯•æ¨¡å¼æ¥è®°å½•ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸä¿¡æ¯ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†DEBUGç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæ‰€éœ€èŒƒå›´ï¼ˆç”Ÿæˆå™¨ç³»ç»Ÿçš„èŒƒå›´yeoman:generatorï¼‰æ¥æ¿€æ´»å®ƒã€‚ 12345# OS X / LinuxDEBUG=yeoman:generator# Windowsset DEBUG=yeoman:generator","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-8.æµ‹è¯•ç”Ÿæˆå™¨","slug":"yeoman-authoring8","date":"2018-08-29T16:40:40.000Z","updated":"2020-07-25T02:57:18.234Z","comments":true,"path":"2018/08/30/yeoman-authoring8/","link":"","permalink":"https://jigangduan.github.io/2018/08/30/yeoman-authoring8/","excerpt":"","text":"ç»§ç»­é˜…è¯»ä»¥äº†è§£æœ‰å…³Yeomanæ·»åŠ çš„æµ‹è¯•åŠ©æ‰‹çš„æ›´å¤šä¿¡æ¯ï¼Œä»¥å‡è½»å•å…ƒæµ‹è¯•ç”Ÿæˆå™¨çš„ç—›è‹¦ã€‚ ä»¥ä¸‹ç¤ºä¾‹å‡è®¾æ‚¨åœ¨BDDæ¨¡å¼ä¸‹ä½¿ç”¨Mochaã€‚å…¨å±€æ¦‚å¿µåº”è¯¥å¾ˆå®¹æ˜“åº”ç”¨äºæ‚¨é€‰æ‹©çš„å•å…ƒæµ‹è¯•æ¡†æ¶ ç»„ç»‡ä½ çš„æµ‹è¯•ä¿æŒæµ‹è¯•ç®€å•æ˜“äºç¼–è¾‘éå¸¸é‡è¦ã€‚ é€šå¸¸ï¼Œç»„ç»‡æµ‹è¯•çš„æœ€ä½³æ–¹æ³•æ˜¯å°†æ¯ä¸ªç”Ÿæˆå™¨å’Œå­ç”Ÿæˆå™¨åˆ†éš”ä¸ºè‡ªå·±çš„describeå—ã€‚ç„¶åï¼Œdescribeä¸ºæ‚¨çš„ç”Ÿæˆå™¨æ¥å—çš„æ¯ä¸ªé€‰é¡¹æ·»åŠ ä¸€ä¸ªå—ã€‚ç„¶åï¼Œitä¸ºæ¯ä¸ªæ–­è¨€ï¼ˆæˆ–ç›¸å…³æ–­è¨€ï¼‰ä½¿ç”¨ä¸€ä¸ªå—ã€‚ åœ¨ä»£ç ä¸­ï¼Œæ‚¨åº”è¯¥å¾—åˆ°ç±»ä¼¼äºæ­¤çš„ç»“æ„ï¼š 12345678describe('backbone:app', function () &#123; it('generates a project with require.js', function () &#123; // assert the file exist // assert the file uses AMD definition &#125;); it('generates a project with webpack');&#125;); æµ‹è¯•åŠ©æ‰‹Yeomanæä¾›æµ‹è¯•åŠ©æ‰‹æ–¹æ³•ã€‚å®ƒä»¬åŒ…å«åœ¨yeoman-teståŒ…è£…å†…ã€‚ 1var helpers = require('yeoman-test'); æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å®Œæ•´çš„å¸®åŠ©ç¨‹åºAPIã€‚ å•å…ƒæµ‹è¯•ç”Ÿæˆå™¨æ—¶æœ€æœ‰ç”¨çš„æ–¹æ³•æ˜¯helpers.run()ã€‚æ­¤æ–¹æ³•å°†è¿”å›ä¸€ä¸ªRunContextå®ä¾‹ï¼Œæ‚¨å¯ä»¥åœ¨è¯¥å®ä¾‹ä¸Šè°ƒç”¨æ–¹æ³•æ¥è®¾ç½®ç›®å½•ï¼Œæ¨¡æ‹Ÿæç¤ºï¼Œæ¨¡æ‹Ÿå‚æ•°ç­‰ã€‚ 12345678910111213var path = require('path');it('generate a project', function () &#123; // The object returned acts like a promise, so return it to wait until the process is done return helpers.run(path.join(__dirname, '../app')) .withOptions(&#123; foo: 'bar' &#125;) // Mock options passed in .withArguments(['name-x']) // Mock the arguments .withPrompts(&#123; coffee: false &#125;) // Mock the prompt answers .withLocalConfig(&#123; lang: 'en' &#125;) // Mock the local config .then(function() &#123; // assert something about the generator &#125;);&#125;) æœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›ä¸ºç”Ÿæˆå™¨æ„å»ºä¸€ä¸ªæµ‹è¯•åœºæ™¯ï¼Œä»¥ä¾¿ä¸ç›®æ ‡ç›®å½•ä¸­çš„ç°æœ‰å†…å®¹ä¸€èµ·è¿è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥inTmpDir()ä½¿ç”¨å›è°ƒå‡½æ•°è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112var path = require('path');var fs = require('fs-extra');helpers.run(path.join(__dirname, '../app')) .inTmpDir(function (dir) &#123; // `dir` is the path to the new temporary directory fs.copySync(path.join(__dirname, '../templates/common'), dir) &#125;) .withPrompts(&#123; coffee: false &#125;) .then(function () &#123; assert.file('common/file.txt'); &#125;); æ‚¨è¿˜å¯ä»¥åœ¨å›è°ƒä¸­æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼š 123456789var path = require('path');var fs = require('fs-extra');helpers.run(path.join(__dirname, '../app')) .inTmpDir(function (dir) &#123; var done = this.async(); // `this` is the RunContext object. fs.copy(path.join(__dirname, '../templates/common'), dir, done); &#125;) .withPrompts(&#123; coffee: false &#125;); è¿è¡ŒPromiseå°†è§£æè¿è¡Œç”Ÿæˆå™¨çš„ç›®å½•ã€‚å¦‚æœè¦ä½¿ç”¨è¿è¡Œç”Ÿæˆå™¨çš„ä¸´æ—¶ç›®å½•ï¼Œè¿™å°†éå¸¸æœ‰ç”¨ï¼š 123456789helpers.run(path.join(__dirname, '../app')) .inTmpDir(function (dir) &#123; var done = this.async(); // `this` is the RunContext object. fs.copy(path.join(__dirname, '../templates/common'), dir, done); &#125;) .withPrompts(&#123; coffee: false &#125;) .then(function (dir) &#123; // assert something about the stuff in `dir` &#125;); å¦‚æœæ‚¨çš„ç”Ÿæˆå™¨è°ƒç”¨composeWith()ï¼Œæ‚¨å¯èƒ½æƒ³è¦æ¨¡æ‹Ÿé‚£äº›ä¾èµ–ç”Ÿæˆå™¨ã€‚ä½¿ç”¨#withGenerators()ï¼Œä¼ é€’#createDummyGenerator()ç”¨ä½œç¬¬ä¸€é¡¹çš„æ•°ç»„æ•°ç»„å’Œæ¨¡æ‹Ÿç”Ÿæˆå™¨çš„å‘½åç©ºé—´ä½œä¸ºç¬¬äºŒé¡¹ï¼š 1234var deps = [ [helpers.createDummyGenerator(), 'karma:app']];return helpers.run(path.join(__dirname, '../app')).withGenerators(deps); å¦‚æœä½ ä¸å–œæ¬¢Promiseï¼Œä½ å¯ä»¥ä½¿ç”¨â€™readyâ€™ï¼Œâ€™errorâ€™ä»¥åŠâ€™endâ€™äº‹ä»¶å‘å‡ºï¼š 12345678helpers.run(path.join(__dirname, '../app')) .on('error', function (error) &#123; console.log('Oh Noes!', error); &#125;) .on('ready', function (generator) &#123; // This is called right before `generator.run()` is called &#125;) .on('end', done); æ‚¨è¿˜å¯ä»¥è¿è¡Œå°†å…¶ä½œä¸ºæ¨¡å—å¯¼å…¥çš„ç”Ÿæˆå™¨ã€‚å¦‚æœç”Ÿæˆäº†ç”Ÿæˆå™¨çš„æºä»£ç ï¼Œè¿™å°†éå¸¸æœ‰ç”¨ã€‚ æ‚¨éœ€è¦æä¾›ä»¥ä¸‹è®¾ç½®runï¼š resolvedï¼šç”Ÿæˆå™¨çš„è·¯å¾„ï¼Œä¾‹å¦‚ ../src/app/index.js namespaceï¼šç”Ÿæˆå™¨çš„å‘½åç©ºé—´ï¼Œä¾‹å¦‚ mygenerator:app 123456var MyGenerator = require('../src/app');helpers.run(MyGenerator, &#123; resolved: require.resolve(__dirname, '../src/app/index.js'), namespace: 'mygenerator:app'&#125;); æ–­è¨€åŠ©æ‰‹Yeoman ä½¿ç”¨ç”Ÿæˆå™¨ç›¸å…³çš„æ–­è¨€åŠ©æ‰‹æ‰©å±•äº†æœ¬æœºæ–­è¨€æ¨¡å—ã€‚æ‚¨å¯ä»¥åœ¨yeoman-assertå­˜å‚¨åº“ä¸­çœ‹åˆ°æ–­è¨€åŠ©æ‰‹çš„å®Œæ•´åˆ—è¡¨ã€‚ éœ€è¦æ–­è¨€åŠ©æ‰‹ï¼š 1var assert = require('yeoman-assert'); å­˜åœ¨æ–‡ä»¶æ–­è¨€ 1assert.file(['Gruntfile.js', 'app/router.js', 'app/views/main.js']); assert.noFile() æ–­è¨€ç›¸åã€‚ æ–­è¨€æ–‡ä»¶å†…å®¹ 1assert.fileContent('controllers/user.js', /App\\.UserController = Ember\\.ObjectController\\.extend/); assert.noFileContent() æ–­è¨€ç›¸åã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-7.ç®¡ç†é…ç½®","slug":"yeoman-authoring7","date":"2018-08-29T16:23:40.000Z","updated":"2020-07-25T02:57:18.234Z","comments":true,"path":"2018/08/30/yeoman-authoring7/","link":"","permalink":"https://jigangduan.github.io/2018/08/30/yeoman-authoring7/","excerpt":"","text":"å­˜å‚¨ç”¨æˆ·é…ç½®é€‰é¡¹å¹¶åœ¨å­ç”Ÿæˆå™¨ä¹‹é—´å…±äº«å®ƒä»¬æ˜¯ä¸€é¡¹å¸¸è§ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œé€šå¸¸å…±äº«é¦–é€‰é¡¹ï¼Œå¦‚è¯­è¨€ï¼ˆç”¨æˆ·ä½¿ç”¨CoffeeScriptå—ï¼Ÿï¼‰ï¼Œæ ·å¼é€‰é¡¹ï¼ˆç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ç¼©è¿›ï¼‰ç­‰ã€‚ è¿™äº›é…ç½®å¯ä»¥é€šè¿‡Yeoman Storage APIå­˜å‚¨åœ¨.yo-rc.jsonæ–‡ä»¶ä¸­ã€‚å¯ä»¥é€šè¿‡generator.configå¯¹è±¡è®¿é—®æ­¤API ã€‚ ä»¥ä¸‹æ˜¯æ‚¨å°†ä½¿ç”¨çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ã€‚ æ–¹æ³•this.config.save() æ­¤æ–¹æ³•å°†é…ç½®å†™å…¥.yo-rc.jsonæ–‡ä»¶ã€‚å¦‚æœè¯¥æ–‡ä»¶å°šä¸å­˜åœ¨ï¼Œåˆ™è¯¥saveæ–¹æ³•å°†åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ è¯¥.yo-rc.jsonæ–‡ä»¶è¿˜ç¡®å®šé¡¹ç›®çš„æ ¹ç›®å½•ã€‚å› æ­¤ï¼Œå³ä½¿æ‚¨æ²¡æœ‰ä½¿ç”¨ä»»ä½•å­˜å‚¨è®¾å¤‡ï¼Œä¹Ÿå§‹ç»ˆå°†æ‚¨çš„:appç”Ÿæˆå™¨åœ¨å†…éƒ¨è°ƒç”¨saveè§†ä¸ºæœ€ä½³åšæ³•ã€‚ å¦è¯·æ³¨æ„ï¼Œsaveæ¯æ¬¡seté…ç½®é€‰é¡¹æ—¶éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚æ‰€ä»¥ä½ é€šå¸¸ä¸éœ€è¦æ˜ç¡®åœ°è°ƒç”¨å®ƒã€‚ this.config.set() set è¦ä¹ˆè·å–keyå’Œå…³è”å€¼ï¼Œè¦ä¹ˆä½¿ç”¨å¤šä¸ªé”®/å€¼çš„å¯¹è±¡æ•£åˆ—ã€‚ è¯·æ³¨æ„ï¼Œå€¼å¿…é¡»æ˜¯JSONå¯åºåˆ—åŒ–çš„ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•°å­—æˆ–éé€’å½’å¯¹è±¡ï¼‰ã€‚ this.config.get() getå°†Stringkeyä½œä¸ºå‚æ•°å¹¶è¿”å›å…³è”çš„å€¼ã€‚ this.config.getAll() è¿”å›å®Œæ•´å¯ç”¨é…ç½®çš„å¯¹è±¡ã€‚ è¿”å›çš„å¯¹è±¡æŒ‰å€¼ä¼ é€’ï¼Œè€Œä¸æ˜¯å¼•ç”¨ã€‚è¿™æ„å‘³ç€æ‚¨ä»ç„¶éœ€è¦ä½¿ç”¨è¯¥setæ–¹æ³•æ¥æ›´æ–°é…ç½®å­˜å‚¨ã€‚ this.config.delete() åˆ é™¤keyã€‚ this.config.defaults() æ¥å—ç”¨ä½œé»˜è®¤å€¼çš„é€‰é¡¹å“ˆå¸Œå€¼ã€‚å¦‚æœå·²å­˜åœ¨é”®/å€¼å¯¹ï¼Œåˆ™è¯¥å€¼å°†ä¿æŒä¸å˜ã€‚å¦‚æœç¼ºå°‘æŸä¸ªkeyï¼Œåˆ™ä¼šæ·»åŠ è¯¥keyã€‚ yo-rc.json ç»“æ„ä½“è¯¥.yo-rc.jsonæ–‡ä»¶æ˜¯ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œå…¶ä¸­å­˜å‚¨äº†æ¥è‡ªå¤šä¸ªç”Ÿæˆå™¨çš„é…ç½®å¯¹è±¡ã€‚æ¯ä¸ªç”Ÿæˆå™¨é…ç½®éƒ½æ˜¯å‘½åç©ºé—´ï¼Œä»¥ç¡®ä¿ç”Ÿæˆå™¨ä¹‹é—´ä¸ä¼šå‘ç”Ÿå‘½åå†²çªã€‚ è¿™ä¹Ÿæ„å‘³ç€æ¯ä¸ªç”Ÿæˆå™¨é…ç½®éƒ½æ˜¯æ²™ç®±ï¼Œå¹¶ä¸”åªèƒ½åœ¨å­ç”Ÿæˆå™¨ä¹‹é—´å…±äº«ã€‚æ‚¨æ— æ³•ä½¿ç”¨å­˜å‚¨APIåœ¨ä¸åŒçš„ç”Ÿæˆå™¨ä¹‹é—´å…±äº«é…ç½®ã€‚åœ¨è°ƒç”¨æœŸé—´ä½¿ç”¨é€‰é¡¹å’Œå‚æ•°åœ¨ä¸åŒçš„ç”Ÿæˆå™¨ä¹‹é—´å…±äº«æ•°æ®ã€‚ è¿™æ˜¯.yo-rc.jsonæ–‡ä»¶åœ¨å†…éƒ¨çš„æ ·å­ï¼š 123456789&#123; \"generator-backbone\": &#123; \"requirejs\": true, \"coffee\": true &#125;, \"generator-gruntfile\": &#123; \"compass\": false &#125;&#125; è¯¥ç»“æ„å¯¹æ‚¨çš„æœ€ç»ˆç”¨æˆ·æ¥è¯´éå¸¸å…¨é¢ã€‚è¿™æ„å‘³ç€ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨æ­¤æ–‡ä»¶ä¸­å­˜å‚¨é«˜çº§é…ç½®ï¼Œå¹¶è¦æ±‚é«˜çº§ç”¨æˆ·åœ¨æ²¡æœ‰æ„ä¹‰çš„æƒ…å†µä¸‹ç›´æ¥ç¼–è¾‘æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸ºæ¯ä¸ªé€‰é¡¹ä½¿ç”¨æç¤ºã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-6.ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ","slug":"yeoman-authoring6","date":"2018-08-29T16:23:20.000Z","updated":"2020-07-25T02:57:18.233Z","comments":true,"path":"2018/08/30/yeoman-authoring6/","link":"","permalink":"https://jigangduan.github.io/2018/08/30/yeoman-authoring6/","excerpt":"","text":"ä½ç½®ä¸Šä¸‹æ–‡å’Œè·¯å¾„Yeomanæ–‡ä»¶å®ç”¨ç¨‹åºåŸºäºæ‚¨åœ¨ç£ç›˜ä¸Šå§‹ç»ˆæœ‰ä¸¤ä¸ªä½ç½®ä¸Šä¸‹æ–‡çš„æƒ³æ³•ã€‚è¿™äº›ä¸Šä¸‹æ–‡æ˜¯æ‚¨çš„ç”Ÿæˆå™¨æœ€æœ‰å¯èƒ½è¯»å–å’Œå†™å…¥çš„æ–‡ä»¶å¤¹ã€‚ ç›®æ ‡ä¸Šä¸‹æ–‡ç¬¬ä¸€ä¸ªä¸Šä¸‹æ–‡æ˜¯ç›®æ ‡ä¸Šä¸‹æ–‡ã€‚ç›®æ ‡æ˜¯Yeomanå°†è„šæ‰‹æ¶æ–°åº”ç”¨ç¨‹åºçš„æ–‡ä»¶å¤¹ã€‚å®ƒæ˜¯æ‚¨çš„ç”¨æˆ·é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå®ƒæ˜¯æ‚¨ç¼–å†™å¤§éƒ¨åˆ†è„šæ‰‹æ¶çš„åœ°æ–¹ã€‚ ç›®æ ‡ä¸Šä¸‹æ–‡å®šä¹‰ä¸ºå½“å‰å·¥ä½œç›®å½•æˆ–åŒ…å«.yo-rc.jsonæ–‡ä»¶çš„æœ€è¿‘çˆ¶æ–‡ä»¶å¤¹ã€‚è¯¥.yo-rc.jsonæ–‡ä»¶å®šä¹‰äº†Yeomané¡¹ç›®çš„æ ¹ã€‚æ­¤æ–‡ä»¶å…è®¸æ‚¨çš„ç”¨æˆ·åœ¨å­ç›®å½•ä¸­è¿è¡Œå‘½ä»¤å¹¶è®©å®ƒä»¬åœ¨é¡¹ç›®ä¸Šå·¥ä½œã€‚è¿™ç¡®ä¿äº†æœ€ç»ˆç”¨æˆ·çš„ä¸€è‡´è¡Œä¸ºã€‚ ä½ å¯ä»¥å¾—åˆ°çš„ç›®æ ‡è·¯å¾„ä½¿ç”¨this.destinationRoot()æˆ–é€šè¿‡åŠ å…¥ä¸€ä¸ªè·¯å¾„this.destinationPath(&#39;sub/path&#39;)ã€‚ 123456789// Given destination root is ~/projectsclass extends Generator &#123; paths() &#123; this.destinationRoot(); // returns '~/projects' this.destinationPath('index.js'); // returns '~/projects/index.js' &#125; æ‚¨å¯ä»¥ä½¿ç”¨æ‰‹åŠ¨è®¾ç½®å®ƒthis.destinationRoot(&#39;new/path&#39;)ã€‚ä½†ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œæ‚¨å¯èƒ½ä¸åº”è¯¥æ›´æ”¹é»˜è®¤ç›®æ ‡ã€‚ å¦‚æœæ‚¨æƒ³çŸ¥é“ç”¨æˆ·åœ¨å“ªé‡Œè¿è¡Œyoï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è·å–è·¯å¾„this.contextRootã€‚è¿™æ˜¯yoä»ä¸­è°ƒç”¨çš„åŸå§‹è·¯å¾„; åœ¨æˆ‘ä»¬ç¡®å®šé¡¹ç›®æ ¹ç›®å½•ä¹‹å‰.yo-rc.jsonã€‚ æ¨¡æ¿ä¸Šä¸‹æ–‡æ¨¡æ¿ä¸Šä¸‹æ–‡æ˜¯å­˜å‚¨æ¨¡æ¿æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚å®ƒé€šå¸¸æ˜¯æ‚¨å°†ä»ä¸­è¯»å–å’Œå¤åˆ¶çš„æ–‡ä»¶å¤¹ã€‚ æ¨¡æ¿ä¸Šä¸‹æ–‡é»˜è®¤å®šä¹‰ä¸º./templates/ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¦†ç›–æ­¤é»˜è®¤å€¼this.sourceRoot(&#39;new/template/path&#39;)ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨this.sourceRoot()æˆ–é€šè¿‡ä½¿ç”¨åŠ å…¥è·¯å¾„æ¥è·å–è·¯å¾„å€¼this.templatePath(â€˜app/index.jsâ€™)ã€‚ 123456789class extends Generator &#123; paths() &#123; this.sourceRoot(); // returns './templates' this.templatePath('index.js'); // returns './templates/index.js' &#125;&#125;; â€œå†…å­˜â€æ–‡ä»¶ç³»ç»Ÿåœ¨è¦†ç›–ç”¨æˆ·æ–‡ä»¶æ—¶ï¼ŒYeomanéå¸¸å°å¿ƒã€‚åŸºæœ¬ä¸Šï¼Œåœ¨é¢„å…ˆå­˜åœ¨çš„æ–‡ä»¶ä¸Šå‘ç”Ÿçš„æ¯ä¸ªå†™å…¥éƒ½å°†ç»å†å†²çªè§£å†³è¿‡ç¨‹ã€‚æ­¤è¿‡ç¨‹è¦æ±‚ç”¨æˆ·éªŒè¯å°†å†…å®¹è¦†ç›–åˆ°å…¶æ–‡ä»¶çš„æ¯ä¸ªæ–‡ä»¶å†™å…¥ã€‚ æ­¤è¡Œä¸ºå¯é˜²æ­¢å‡ºç°æ„å¤–é”™è¯¯å¹¶é™åˆ¶å‡ºé”™çš„é£é™©ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæ–‡ä»¶éƒ½å¼‚æ­¥å†™å…¥ç£ç›˜ã€‚ ç”±äºå¼‚æ­¥APIæ›´éš¾ä½¿ç”¨ï¼ŒYeomanæä¾›äº†ä¸€ä¸ªåŒæ­¥æ–‡ä»¶ç³»ç»ŸAPIï¼Œå…¶ä¸­æ¯ä¸ªæ–‡ä»¶éƒ½è¢«å†™å…¥å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”åªæœ‰åœ¨Yeomanè¿è¡Œå®Œæ¯•åæ‰ä¼šå†™å…¥ç£ç›˜ä¸€æ¬¡ã€‚ æ­¤å†…å­˜æ–‡ä»¶ç³»ç»Ÿåœ¨æ‰€æœ‰ç»„åˆçš„ç”Ÿæˆå™¨ä¹‹é—´å…±äº«ã€‚ æ–‡ä»¶å·¥å…·ç”Ÿæˆå™¨å…¬å¼€æ‰€æœ‰æ–‡ä»¶æ–¹æ³•this.fsï¼Œè¿™æ˜¯mem-fsç¼–è¾‘å™¨çš„ä¸€ä¸ªå®ä¾‹- ç¡®ä¿æ£€æŸ¥æ‰€æœ‰å¯ç”¨æ–¹æ³•çš„æ¨¡å—æ–‡æ¡£ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶this.fsæš´éœ²commitï¼Œä½†ä½ ä¸åº”è¯¥åœ¨ä½ çš„å‘ç”µæœºä¸­è°ƒç”¨å®ƒã€‚Yeomanåœ¨è¿è¡Œå¾ªç¯çš„å†²çªé˜¶æ®µä¹‹ååœ¨å†…éƒ¨è°ƒç”¨å®ƒã€‚ ç¤ºä¾‹ï¼šå¤åˆ¶æ¨¡æ¿æ–‡ä»¶è¿™æ˜¯æˆ‘ä»¬æƒ³è¦å¤åˆ¶å’Œå¤„ç†æ¨¡æ¿æ–‡ä»¶çš„ç¤ºä¾‹ã€‚ é‰´äºå†…å®¹./templates/index.htmlæ˜¯ï¼š 12345&lt;html&gt; &lt;head&gt; &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt; &lt;/head&gt;&lt;/html&gt; ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥copyTplæ–¹æ³•å¤åˆ¶æ–‡ä»¶ï¼ŒåŒæ—¶å°†å†…å®¹ä½œä¸ºæ¨¡æ¿å¤„ç†ã€‚copyTplæ­£åœ¨ä½¿ç”¨ejsæ¨¡æ¿è¯­æ³•ã€‚ 123456789class extends Generator &#123; writing() &#123; this.fs.copyTpl( this.templatePath('index.html'), this.destinationPath('public/index.html'), &#123; title: 'Templating with Yeoman' &#125; ); &#125;&#125; ä¸€æ—¦ç”Ÿæˆå™¨è¿è¡Œå®Œæ¯•ï¼Œpublic/index.htmlå°†åŒ…å«ï¼š 12345&lt;html&gt; &lt;head&gt; &lt;title&gt;Templating with Yeoman&lt;/title&gt; &lt;/head&gt;&lt;/html&gt; ä¸€ä¸ªéå¸¸å¸¸è§çš„åœºæ™¯æ˜¯åœ¨æç¤ºé˜¶æ®µå­˜å‚¨ä½¿ç”¨ç”¨æˆ·ç­”æ¡ˆå¹¶å°†å…¶ç”¨äºæ¨¡æ¿ï¼š 12345678910111213141516class extends Generator &#123; async prompting() &#123; this.answers = await this.prompt([&#123; type : 'input', name : 'title', message : 'Your project title', &#125;]); &#125; writing() &#123; this.fs.copyTpl( this.templatePath('index.html'), this.destinationPath('public/index.html'), &#123; title: this.answers.title &#125; // user answer `title` used ); &#125; é€šè¿‡æµè½¬æ¢è¾“å‡ºæ–‡ä»¶ç”Ÿæˆå™¨ç³»ç»Ÿå…è®¸æ‚¨åœ¨æ¯ä¸ªæ–‡ä»¶å†™å…¥ä¸Šåº”ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚è‡ªåŠ¨ç¾åŒ–æ–‡ä»¶ï¼Œè§„èŒƒåŒ–ç©ºç™½ç­‰æ˜¯å®Œå…¨å¯èƒ½çš„ã€‚ æ ¹æ®Yeomanè¿›ç¨‹ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªä¿®æ”¹è¿‡çš„æ–‡ä»¶å†™å…¥ç£ç›˜ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡ä¸€ä¸ªvinylå¯¹è±¡æµï¼ˆå°±åƒgulpä¸€æ ·ï¼‰ã€‚ä»»ä½•ç”Ÿæˆå™¨ä½œè€…éƒ½å¯ä»¥æ³¨å†ŒtransformStreamæ¥ä¿®æ”¹æ–‡ä»¶è·¯å¾„å’Œ/æˆ–å†…å®¹ã€‚ é€šè¿‡è¯¥registerTransformStream()æ–¹æ³•æ³¨å†Œæ–°ä¿®æ”¹å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š 12var beautify = require('gulp-beautify');this.registerTransformStream(beautify(&#123;indent_size: 2 &#125;)); è¯·æ³¨æ„ï¼Œä»»ä½•ç±»å‹çš„æ¯ä¸ªæ–‡ä»¶éƒ½å°†é€šè¿‡æ­¤æµä¼ é€’ã€‚ç¡®ä¿ä»»ä½•è½¬æ¢æµéƒ½å°†é€šè¿‡å®ƒä¸æ”¯æŒçš„æ–‡ä»¶ã€‚åƒgulp-ifæˆ–gulp-filterè¿™æ ·çš„å·¥å…·å°†æœ‰åŠ©äºè¿‡æ»¤æ— æ•ˆç±»å‹å¹¶ä¼ é€’å®ƒä»¬ã€‚ æ‚¨åŸºæœ¬ä¸Šå¯ä»¥ä½¿ç”¨ä»»ä½•å¸¦æœ‰Yeomanè½¬æ¢æµçš„gulpæ’ä»¶æ¥å¤„ç†åœ¨å†™å…¥é˜¶æ®µç”Ÿæˆçš„æ–‡ä»¶ã€‚ æç¤ºï¼šæ›´æ–°ç°æœ‰æ–‡ä»¶çš„å†…å®¹æ›´æ–°é¢„å…ˆå­˜åœ¨çš„æ–‡ä»¶å¹¶ä¸æ€»æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ã€‚æœ€å¯é çš„æ–¹æ³•æ˜¯è§£ææ–‡ä»¶ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰å¹¶å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„ä¸»è¦é—®é¢˜æ˜¯ç¼–è¾‘ASTå¯èƒ½å¾ˆå†—é•¿ï¼Œæœ‰ç‚¹éš¾ä»¥æŒæ¡ã€‚ ä¸€äº›æµè¡Œçš„ASTè§£æå™¨æ˜¯ï¼š Cheerioç”¨äºè§£æHTMLã€‚ ç”¨äºè§£æJavaScriptçš„Esprima - æ‚¨å¯èƒ½å¯¹AST-Queryæ„Ÿå…´è¶£ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè¾ƒä½ çº§åˆ«çš„APIæ¥ç¼–è¾‘Esprimaè¯­æ³•æ ‘ã€‚ å¯¹äºJSONæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åŸç”ŸJSONå¯¹è±¡æ–¹æ³•ã€‚ gruntfile-editoråŠ¨æ€ä¿®æ”¹Gruntfileã€‚ ä½¿ç”¨RegExè§£æä»£ç æ–‡ä»¶æ˜¯ä¸€æ¡å±é™©çš„è·¯å¾„ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨åº”è¯¥é˜…è¯»æ­¤CSäººç±»å­¦ç­”æ¡ˆå¹¶æŒæ¡RegExè§£æçš„ç¼ºé™·ã€‚å¦‚æœæ‚¨ç¡®å®é€‰æ‹©ä½¿ç”¨RegExè€Œä¸æ˜¯ASTæ ‘ç¼–è¾‘ç°æœ‰æ–‡ä»¶ï¼Œè¯·æ³¨æ„å¹¶æä¾›å®Œæ•´çš„å•å…ƒæµ‹è¯•ã€‚ - è¯·ï¼Œè¯·ä¸è¦ç ´åç”¨æˆ·çš„ä»£ç ã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-5.ä¾èµ–å…³ç³»ç®¡ç†","slug":"yeoman-authoring5","date":"2018-08-29T16:06:07.000Z","updated":"2020-07-25T02:57:18.233Z","comments":true,"path":"2018/08/30/yeoman-authoring5/","link":"","permalink":"https://jigangduan.github.io/2018/08/30/yeoman-authoring5/","excerpt":"","text":"ä¸€æ—¦è¿è¡Œäº†ç”Ÿæˆå™¨ï¼Œé€šå¸¸éœ€è¦è¿è¡Œnpm(æˆ–Yarn)å’ŒBoweræ¥å®‰è£…ç”Ÿæˆå™¨æ‰€éœ€çš„ä»»ä½•é™„åŠ ä¾èµ–é¡¹ã€‚ ç”±äºè¿™äº›ä»»åŠ¡éå¸¸é¢‘ç¹ï¼ŒYeomanå·²ç»æŠŠå®ƒä»¬æŠ½è±¡å‡ºæ¥äº†ã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç»å¦‚ä½•é€šè¿‡å…¶ä»–å·¥å…·å¯åŠ¨å®‰è£…ã€‚ æ³¨æ„ï¼ŒYeomanæä¾›çš„å®‰è£…åŠ©æ‰‹å°†è‡ªåŠ¨å®‰æ’å®‰è£…ä½œä¸ºinstallé˜Ÿåˆ—çš„ä¸€éƒ¨åˆ†è¿è¡Œä¸€æ¬¡ã€‚å¦‚æœæ‚¨éœ€è¦åœ¨å®ƒä»¬è¿è¡Œä¹‹åè¿è¡Œä»»ä½•ä¸œè¥¿ï¼Œè¯·ä½¿ç”¨endé˜Ÿåˆ—ã€‚ NPMæ‚¨åªéœ€è¦è°ƒç”¨this.npmInstall()å³å¯è¿è¡Œnpmå®‰è£…ã€‚npm installå³ä½¿å¤šä¸ªç”Ÿæˆå™¨å¤šæ¬¡è°ƒç”¨å‘½ä»¤ï¼ŒYeomanä¹Ÿä¼šç¡®ä¿å‘½ä»¤åªè¿è¡Œä¸€æ¬¡ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¸Œæœ›å°†lodashå®‰è£…ä¸ºdevä¾èµ–é¡¹ï¼š 12345class extends Generator &#123; installingLodash() &#123; this.npmInstall(['lodash'], &#123; 'save-dev': true &#125;); &#125;&#125; è¿™ç›¸å½“äºè°ƒç”¨ï¼š 1npm install lodash --save-dev åœ¨é¡¹ç›®çš„å‘½ä»¤è¡Œä¸Šã€‚ ä»¥ç¼–ç¨‹æ–¹å¼ç®¡ç†npmä¾èµ–é¡¹å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨package.jsonæ¨¡æ¿ä½†å¸Œæœ›æ‹¥æœ‰å›ºå®šç‰ˆæœ¬çš„ä¾èµ–é¡¹ï¼Œåˆ™å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºæˆ–æ‰©å±•æ–‡ä»¶ã€‚Yeomansæ–‡ä»¶ç³»ç»Ÿå·¥å…·å¯ä»¥å¸®åŠ©æ‚¨å®Œæˆè¿™é¡¹å·¥ä½œã€‚ å®šä¹‰eslintä¸ºdevä¾èµ–é¡¹å’Œreactä¾èµ–é¡¹çš„ç¤ºä¾‹ï¼š 12345678910111213141516171819class extends Generator &#123; writing() &#123; const pkgJson = &#123; devDependencies: &#123; eslint: '^3.15.0' &#125;, dependencies: &#123; react: '^16.2.0' &#125; &#125;; // Extend or create package.json file in destination path this.fs.extendJSON(this.destinationPath('package.json'), pkgJson); &#125; install() &#123; this.npmInstall(); &#125;&#125;; Yarnæ‚¨åªéœ€è¦è°ƒç”¨this.yarnInstall()å³å¯å¯åŠ¨å®‰è£…ã€‚yarn installå³ä½¿å¤šä¸ªç”Ÿæˆå™¨å¤šæ¬¡è°ƒç”¨å‘½ä»¤ï¼ŒYeomanä¹Ÿä¼šç¡®ä¿å‘½ä»¤åªè¿è¡Œä¸€æ¬¡ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¸Œæœ›å°†lodashå®‰è£…ä¸ºdevä¾èµ–é¡¹ï¼š 12345generators.Base.extend(&#123; installingLodash: function() &#123; this.yarnInstall(['lodash'], &#123; 'dev': true &#125;); &#125;&#125;); è¿™ç›¸å½“äºè°ƒç”¨ï¼š 1yarn add lodash --dev åœ¨é¡¹ç›®çš„å‘½ä»¤è¡Œä¸Šã€‚ Boweræ‚¨åªéœ€è¦è°ƒç”¨this.bowerInstall()å³å¯å¯åŠ¨å®‰è£…ã€‚bower installå³ä½¿å¤šä¸ªç”Ÿæˆå™¨å¤šæ¬¡è°ƒç”¨å‘½ä»¤ï¼ŒYeomanä¹Ÿä¼šç¡®ä¿å‘½ä»¤åªè¿è¡Œä¸€æ¬¡ã€‚ ç»¼åˆä½¿ç”¨é»˜è®¤æƒ…å†µä¸‹ï¼Œthis.installDependencies()è°ƒç”¨è¿è¡Œnpmå’Œbowerã€‚æ‚¨å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªåŒ…ç®¡ç†å™¨ä¼ é€’å¸ƒå°”å€¼æ¥å†³å®šä½¿ç”¨å“ªäº›ã€‚ ä½¿ç”¨Yarnä¸Bowerçš„ä¾‹å­ï¼š 123456789generators.Base.extend(&#123; install: function () &#123; this.installDependencies(&#123; npm: false, bower: true, yarn: true &#125;); &#125;&#125;); ä½¿ç”¨å…¶ä»–å·¥å…·Yeomanæä¾›äº†ä¸€ä¸ªæŠ½è±¡ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨spawnä»»ä½•CLIå‘½ä»¤ã€‚è¿™ç§æŠ½è±¡å°†æ ‡å‡†åŒ–ä¸ºå‘½ä»¤ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨Linuxï¼ŒMacå’ŒWindowsç³»ç»Ÿä¸­æ— ç¼è¿è¡Œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªPHPçˆ±å¥½è€…ï¼Œå¹¶å¸Œæœ›è¿è¡Œcomposerï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š 12345class extends Generator &#123; install() &#123; this.spawnCommand('composer', ['install']); &#125;&#125; ç¡®ä¿è°ƒç”¨é˜Ÿåˆ—ä¸­çš„spawnCommandæ–¹æ³•installã€‚æ‚¨çš„ç”¨æˆ·ä¸å¸Œæœ›ç­‰å¾…å®‰è£…å‘½ä»¤å®Œæˆã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-4.ç»„åˆæ€§","slug":"yeoman-authoring4","date":"2018-08-29T15:32:44.000Z","updated":"2020-07-25T02:57:18.233Z","comments":true,"path":"2018/08/29/yeoman-authoring4/","link":"","permalink":"https://jigangduan.github.io/2018/08/29/yeoman-authoring4/","excerpt":"","text":"ç»„åˆæ€§æ˜¯ä¸€ç§å°†è¾ƒå°çš„éƒ¨ä»¶ç»„åˆåœ¨ä¸€èµ·æ„æˆä¸€ä»¶å¤§äº‹çš„æ–¹æ³•ã€‚æ’åºåƒVoltronÂ® Yeomanä¸ºç”Ÿæˆå™¨æä¾›äº†å¤šç§æ–¹å¼æ¥å»ºç«‹å…±åŒç‚¹ã€‚é‡å†™ç›¸åŒçš„åŠŸèƒ½æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå› æ­¤æä¾›äº†ä¸€ä¸ªAPIæ¥åœ¨å…¶ä»–ç”Ÿæˆå™¨ä¸­ä½¿ç”¨ç”Ÿæˆå™¨ã€‚ åœ¨Yeomanä¸­ï¼Œå¯ç»„åˆæ€§å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å¯åŠ¨ï¼š ç”Ÿæˆå™¨å¯ä»¥å†³å®šä¸å¦ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆä¾‹å¦‚ï¼Œgenerator-backboneä½¿ç”¨generator-mochaï¼‰ç»„åˆã€‚ æœ€ç»ˆç”¨æˆ·ä¹Ÿå¯ä»¥å‘èµ·åˆæˆï¼ˆä¾‹å¦‚ï¼ŒSimonæƒ³è¦ç”Ÿæˆå…·æœ‰SASSå’ŒRailsçš„Backboneé¡¹ç›®ï¼‰ã€‚æ³¨æ„ï¼šæœ€ç»ˆç”¨æˆ·å‘èµ·çš„åˆæˆæ˜¯è®¡åˆ’çš„åŠŸèƒ½ï¼Œç›®å‰ä¸å¯ç”¨ã€‚ this.composeWith()è¯¥composeWithæ–¹æ³•å…è®¸ç”Ÿæˆå™¨ä¸å¦ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆæˆ–å­ç”Ÿæˆå™¨ï¼‰å¹¶æ’è¿è¡Œã€‚è¿™æ ·å®ƒå°±å¯ä»¥ä½¿ç”¨å…¶ä»–å‘ç”Ÿå™¨çš„åŠŸèƒ½ï¼Œè€Œä¸å¿…è‡ªå·±å®Œæˆæ‰€æœ‰åŠŸèƒ½ã€‚ åœ¨ç¼–å†™æ—¶ï¼Œä¸è¦å¿˜è®°è¿è¡Œä¸Šä¸‹æ–‡å’ŒRunLoopã€‚åœ¨ç»™å®šçš„ä¼˜å…ˆçº§ç»„æ‰§è¡Œä¸­ï¼Œæ‰€æœ‰ç»„åˆçš„ç”Ÿæˆå™¨å°†æ‰§è¡Œè¯¥ç»„ä¸­çš„åŠŸèƒ½ã€‚ä¹‹åï¼Œè¿™å°†é‡å¤ä¸‹ä¸€ç»„ã€‚ç”Ÿæˆå™¨ä¹‹é—´çš„æ‰§è¡Œä¸composeWithè°ƒç”¨çš„é¡ºåºç›¸åŒï¼Œè¯·å‚é˜…æ‰§è¡Œç¤ºä¾‹ã€‚ APIcomposeWith æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ generatorPath- æŒ‡å‘è¦ç¼–å†™çš„ç”Ÿæˆå™¨çš„å®Œæ•´è·¯å¾„ï¼ˆé€šå¸¸ä½¿ç”¨require.resolve()ï¼‰ã€‚ options - åŒ…å«é€‰é¡¹çš„å¯¹è±¡ï¼Œä¸€æ—¦è¿è¡Œå°±ä¼ é€’ç»™ç»„åˆç”Ÿæˆå™¨ã€‚ ä¸peerDependenciesç”Ÿæˆå™¨ç»„åˆæ—¶ï¼š 1this.composeWith(require.resolve('generator-bootstrap/generators/app'), &#123;preprocessor: 'sass'&#125;); require.resolve() è¿”å›Node.jsåŠ è½½æä¾›çš„æ¨¡å—çš„è·¯å¾„ã€‚ æ³¨æ„ï¼šå¦‚æœä½ éœ€è¦ä¼ é€’argumentsåˆ°åŸºäºç‰ˆæœ¬çš„ç”Ÿæˆå™¨yeoman-generatorå¹´é¾„å¤§äº1.0ï¼Œä½ å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªåšåˆ°è¿™ä¸€ç‚¹Arrayçš„options.argumentså…³é”®ã€‚ å³ä½¿å®ƒä¸æ˜¯ä¸€ç§é¼“åŠ±çš„åšæ³•ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†ç”Ÿæˆå™¨å‘½åç©ºé—´ä¼ é€’ç»™composeWithã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒYeomanå°†å°è¯•peerDependenciesåœ¨æœ€ç»ˆç”¨æˆ·ç³»ç»Ÿä¸Šæ‰¾åˆ°ä½œä¸ºæˆ–å…¨å±€å®‰è£…çš„ç”Ÿæˆå™¨ã€‚ 1this.composeWith('backbone:route', &#123;rjs: true&#125;); æ‰§è¡Œç¤ºä¾‹ 1234567891011121314151617181920212223242526272829// In my-generator/generators/turbo/index.jsmodule.exports = class extends Generator &#123; prompting() &#123; this.log('prompting - turbo'); &#125; writing() &#123; this.log('writing - turbo'); &#125;&#125;;// In my-generator/generators/electric/index.jsmodule.exports = class extends Generator &#123; prompting() &#123; this.log('prompting - zap'); &#125; writing() &#123; this.log('writing - zap'); &#125;&#125;;// In my-generator/generators/app/index.jsmodule.exports = class extends Generator &#123; initializing() &#123; this.composeWith(require.resolve('../turbo')); this.composeWith(require.resolve('../electric')); &#125;&#125;; è¿è¡Œæ—¶yo my-generatorï¼Œè¿™å°†å¯¼è‡´ï¼š 1234prompting - turboprompting - zapwriting - turbowriting - zap æ‚¨å¯ä»¥é€šè¿‡åè½¬è°ƒç”¨æ¥æ›´æ”¹å‡½æ•°è°ƒç”¨é¡ºåºcomposeWith è¯·è®°ä½ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨npmä¸Šæä¾›çš„å…¶ä»–å…¬å…±ç”Ÿæˆå™¨è¿›è¡Œç»„åˆã€‚ å¯¹äºå¯ç»„åˆçš„æ›´å¤æ‚çš„ä¾‹å­ï¼Œæ£€æŸ¥å‡ºgenerator-generatorï¼Œå®ƒç”±è¢«generator-nodeã€‚ ä¾èµ–é¡¹æˆ–peerDependenciesnpmå…è®¸ä¸‰ç§ç±»å‹çš„ä¾èµ–é¡¹ï¼š dependencieså®‰è£…åœ¨æœ¬åœ°çš„ç”Ÿæˆå™¨ã€‚å®ƒæ˜¯æ§åˆ¶æ‰€ç”¨ä¾èµ–é¡¹ç‰ˆæœ¬çš„æœ€ä½³é€‰æ‹©ã€‚è¿™æ˜¯é¦–é€‰æ–¹æ¡ˆã€‚ peerDependenciesä½œä¸ºå…„å¼Ÿå§å¦¹å®‰è£…åœ¨ç”Ÿæˆå™¨æ—è¾¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœgenerator-backboneå£°æ˜generator-gruntfileä¸ºå¯¹ç­‰ä¾èµ–é¡¹ï¼Œåˆ™æ–‡ä»¶å¤¹æ ‘å°†ä»¥è¿™ç§æ–¹å¼æ˜¾ç¤ºï¼š 12â”œâ”€â”€â”€generator-backbone/â””â”€â”€â”€generator-gruntfile/ devDependenciesç”¨äºæµ‹è¯•å’Œå¼€å‘å®ç”¨ç¨‹åºã€‚è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚ ä½¿ç”¨æ—¶peerDependenciesï¼Œè¯·æ³¨æ„å…¶ä»–æ¨¡å—å¯èƒ½è¿˜éœ€è¦æ‰€è¯·æ±‚çš„æ¨¡å—ã€‚æ³¨æ„ä¸è¦é€šè¿‡è¯·æ±‚ç‰¹å®šç‰ˆæœ¬ï¼ˆæˆ–çª„èŒƒå›´çš„ç‰ˆæœ¬ï¼‰æ¥åˆ›å»ºç‰ˆæœ¬å†²çªã€‚Yeomançš„å»ºè®®peerDependenciesæ˜¯å§‹ç»ˆè¦æ±‚æ›´é«˜æˆ–ç­‰äºï¼ˆ&gt; =ï¼‰æˆ–ä»»ä½•ï¼ˆ*ï¼‰å¯ç”¨ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼š 123456&#123; \"peerDependencies\": &#123; \"generator-gruntfile\": \"*\", \"generator-bootstrap\": \"&gt;=1.0.0\" &#125;&#125; æ³¨æ„ï¼šä»npm @ 3å¼€å§‹ï¼ŒpeerDependenciesä¸å†è‡ªåŠ¨å®‰è£…ã€‚è¦å®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œå¿…é¡»æ‰‹åŠ¨å®‰è£…å®ƒä»¬ï¼šnpm install generator-yourgenerator generator-gruntfile generator-bootstrap@&quot;&gt;=1.0.0&quot;","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-3.ä¸ç”¨æˆ·äº¤äº’","slug":"yeoman-authoring3","date":"2018-08-29T15:00:05.000Z","updated":"2020-07-25T02:57:18.233Z","comments":true,"path":"2018/08/29/yeoman-authoring3/","link":"","permalink":"https://jigangduan.github.io/2018/08/29/yeoman-authoring3/","excerpt":"","text":"æ‚¨çš„ç”Ÿæˆå™¨å°†ä¸æœ€ç»ˆç”¨æˆ·è¿›è¡Œå¤§é‡äº¤äº’ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒYeomanåœ¨ç»ˆç«¯ä¸Šè¿è¡Œï¼Œä½†å®ƒä¹Ÿæ”¯æŒä¸åŒå·¥å…·å¯ä»¥æä¾›çš„è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢Yeomanç”Ÿæˆå™¨åœ¨ç¼–è¾‘å™¨æˆ–ç‹¬ç«‹åº”ç”¨ç¨‹åºä¹‹ç±»çš„å›¾å½¢å·¥å…·ä¸­è¿è¡Œã€‚ ä¸ºäº†å®ç°è¿™ç§çµæ´»æ€§ï¼ŒYeomanæä¾›äº†ä¸€ç»„ç”¨æˆ·ç•Œé¢å…ƒç´ æŠ½è±¡ã€‚ä½œä¸ºä½œè€…ï¼Œæ‚¨æœ‰è´£ä»»åœ¨ä¸æœ€ç»ˆç”¨æˆ·äº¤äº’æ—¶ä»…ä½¿ç”¨è¿™äº›æŠ½è±¡ã€‚ä½¿ç”¨å…¶ä»–æ–¹æ³•å¯èƒ½ä¼šé˜»æ­¢æ‚¨çš„ç”Ÿæˆå™¨åœ¨ä¸åŒçš„Yeomanå·¥å…·ä¸­æ­£ç¡®è¿è¡Œã€‚ ä¾‹å¦‚ï¼Œæ°¸è¿œä¸è¦ä½¿ç”¨console.log()æˆ–process.stdout.write()è¾“å‡ºå†…å®¹å¾ˆé‡è¦ã€‚ä½¿ç”¨å®ƒä»¬ä¼šéšè—ä¸ä½¿ç”¨ç»ˆç«¯çš„ç”¨æˆ·çš„è¾“å‡ºã€‚ç›¸åï¼Œå§‹ç»ˆä¾èµ–äºUIé€šç”¨this.log()æ–¹æ³•ï¼Œå…¶ä¸­thisæ˜¯å½“å‰ç”Ÿæˆå™¨çš„ä¸Šä¸‹æ–‡ã€‚ ç”¨æˆ·äº’åŠ¨æç¤ºæç¤ºæ˜¯ç”Ÿæˆå™¨ä¸ç”¨æˆ·äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚æç¤ºæ¨¡å—ç”±Inquirer.jsæä¾›ï¼Œæ‚¨åº”è¯¥å‚è€ƒå…¶APIä»¥è·å–å¯ç”¨çš„æç¤ºé€‰é¡¹åˆ—è¡¨ã€‚ è¯¥promptæ–¹æ³•æ˜¯å¼‚æ­¥çš„å¹¶è¿”å›ä¸€ä¸ªPromiseã€‚æ‚¨éœ€è¦ä»ä»»åŠ¡ä¸­è¿”å›Promiseï¼Œä»¥ä¾¿åœ¨è¿è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ç­‰å¾…å…¶å®Œæˆã€‚ï¼ˆè¯¦ç»†äº†è§£å¼‚æ­¥ä»»åŠ¡ï¼‰ 1234567891011121314151617module.exports = class extends Generator &#123; async prompting() &#123; const answers = await this.prompt([&#123; type : 'input', name : 'name', message : 'Your project name', default : this.appname // Default to current folder name &#125;, &#123; type : 'confirm', name : 'cool', message : 'Would you like to enable the Cool feature?' &#125;]); this.log('app name', answers.name); this.log('cool feature', answers.cool); &#125;&#125;; è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨promptingé˜Ÿåˆ—æ¥è¯¢é—®ç”¨æˆ·çš„åé¦ˆã€‚ åœ¨ç¨åé˜¶æ®µä½¿ç”¨ç”¨æˆ·answersä¸€ç§éå¸¸å¸¸è§çš„æƒ…å†µæ˜¯åœ¨ç¨åé˜¶æ®µä½¿ç”¨ç”¨æˆ·ç­”æ¡ˆï¼Œä¾‹å¦‚åœ¨writingé˜Ÿåˆ—ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡å°†å®ƒä»¬æ·»åŠ åˆ°thisä¸Šä¸‹æ–‡ä¸­æ¥è½»æ¾å®ç°ï¼š 12345678910111213module.exports = class extends Generator &#123; async prompting() &#123; this.answers = await this.prompt([&#123; type : 'confirm', name : 'cool', message : 'Would you like to enable the Cool feature?' &#125;]); &#125; writing() &#123; this.log('cool feature', this.answers.cool); // user answer `cool` used &#125;&#125;; è®°ä½ç”¨æˆ·é¦–é€‰é¡¹ç”¨æˆ·æ¯æ¬¡è¿è¡Œç”Ÿæˆå™¨æ—¶éƒ½å¯ä»¥å¯¹æŸäº›é—®é¢˜ç»™å‡ºç›¸åŒçš„è¾“å…¥ã€‚å¯¹äºè¿™äº›é—®é¢˜ï¼Œæ‚¨å¯èƒ½æƒ³è¦è®°ä½ç”¨æˆ·ä¹‹å‰å›ç­”çš„å†…å®¹å¹¶å°†è¯¥ç­”æ¡ˆç”¨ä½œæ–°ç­”æ¡ˆdefaultã€‚ Yeomané€šè¿‡å‘é—®é¢˜å¯¹è±¡æ·»åŠ storeå±æ€§æ¥æ‰©å±•Inquirer.js API ã€‚æ­¤å±æ€§å…è®¸æ‚¨æŒ‡å®šå°†æ¥åº”å°†ç”¨æˆ·æä¾›çš„ç­”æ¡ˆç”¨ä½œé»˜è®¤ç­”æ¡ˆã€‚è¿™å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å®Œæˆï¼š 123456this.prompt(&#123; type : 'input', name : 'username', message : 'What\\'s your GitHub username', store : true&#125;); æ³¨æ„ï¼šæä¾›é»˜è®¤å€¼å°†é˜»æ­¢ç”¨æˆ·è¿”å›ä»»ä½•ç©ºç­”æ¡ˆã€‚ å¦‚æœæ‚¨åªæƒ³å­˜å‚¨æ•°æ®è€Œä¸ç›´æ¥ä¸æç¤ºç›¸å…³è”ï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹Yeomanå­˜å‚¨æ–‡æ¡£ã€‚ å‚æ•°å‚æ•°ç›´æ¥ä»å‘½ä»¤è¡Œä¼ é€’ï¼š 1yo webapp my-project åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œmy-projectå°†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ è¦é€šçŸ¥ç³»ç»Ÿæˆ‘ä»¬æœŸæœ›å‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥this.argument()æ–¹æ³•ã€‚æ­¤æ–¹æ³•æ¥å—nameï¼ˆStringï¼‰å’Œå¯é€‰çš„é€‰é¡¹å“ˆå¸Œã€‚ åœ¨nameéšåçš„å‚æ•°å°†ä½œä¸ºï¼šthis.options[name]ã€‚ optionsæ•£åˆ—æ¥å—å¤šä¸ªé”®å€¼å¯¹ï¼š desc å‚æ•°çš„æè¿° requiredå¸ƒå°”å€¼æ˜¯å¦æ˜¯å¿…éœ€çš„ type Stringï¼ŒNumberï¼ŒArrayï¼ˆä¹Ÿå¯ä»¥æ˜¯æ¥æ”¶åŸå§‹å­—ç¬¦ä¸²å€¼å¹¶è§£æå®ƒçš„è‡ªå®šä¹‰å‡½æ•°ï¼‰ default æ­¤å‚æ•°çš„é»˜è®¤å€¼ å¿…é¡»åœ¨constructoræ–¹æ³•å†…è°ƒç”¨æ­¤æ–¹æ³•ã€‚å¦åˆ™ï¼Œå½“ç”¨æˆ·ä½¿ç”¨å¸®åŠ©é€‰é¡¹è°ƒç”¨æ‚¨çš„ç”Ÿæˆå™¨æ—¶ï¼ŒYeomanå°†æ— æ³•è¾“å‡ºç›¸å…³çš„å¸®åŠ©ä¿¡æ¯ï¼šä¾‹å¦‚yo webapp --helpã€‚ è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š 123456789101112module.exports = class extends Generator &#123; // note: arguments and options should be defined in the constructor. constructor(args, opts) &#123; super(args, opts); // This makes `appname` a required argument. this.argument('appname', &#123; type: String, required: true &#125;); // And you can then access it later; e.g. this.log(this.options.appname); &#125;&#125;; ç±»å‹çš„å‚æ•°Arrayå°†åŒ…å«ä¼ é€’ç»™ç”Ÿæˆå™¨çš„æ‰€æœ‰å‰©ä½™å‚æ•°ã€‚ é€‰é¡¹é€‰é¡¹çœ‹èµ·æ¥å¾ˆåƒå‚æ•°ï¼Œä½†å®ƒä»¬è¢«å†™ä¸ºå‘½ä»¤è¡Œæ ‡å¿—ã€‚ 1yo webapp --coffee è¦é€šçŸ¥ç³»ç»Ÿæˆ‘ä»¬æœŸæœ›ä¸€ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥this.option()æ–¹æ³•ã€‚æ­¤æ–¹æ³•æ¥å—nameï¼ˆStringï¼‰å’Œå¯é€‰çš„é€‰é¡¹å“ˆå¸Œã€‚ è¯¥nameå€¼å°†ç”¨äºåœ¨åŒ¹é…é”®å¤„æ£€ç´¢é€‰é¡¹this.options[name]ã€‚ options hashï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰æ¥å—å¤šä¸ªé”®å€¼å¯¹ï¼š desc é€‰é¡¹è¯´æ˜ alias é€‰é¡¹çš„ç®€ç§° type å¸ƒå°”å€¼ï¼Œå­—ç¬¦ä¸²æˆ–æ•°å­—ï¼ˆä¹Ÿå¯ä»¥æ˜¯æ¥æ”¶åŸå§‹å­—ç¬¦ä¸²å€¼å¹¶è§£æå®ƒçš„è‡ªå®šä¹‰å‡½æ•°ï¼‰ default é»˜è®¤å€¼ hide å¸ƒå°”å€¼æ˜¯å¦éšè—å¸®åŠ© è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š 123456789101112module.exports = class extends Generator &#123; // note: arguments and options should be defined in the constructor. constructor(args, opts) &#123; super(args, opts); // This method adds support for a `--coffee` flag this.option('coffee'); // And you can then access it later; e.g. this.scriptSuffix = (this.options.coffee ? \".coffee\": \".js\"); &#125;&#125;; è¾“å‡ºä¿¡æ¯è¾“å‡ºä¿¡æ¯ç”±this.logæ¨¡å—å¤„ç†ã€‚ æ‚¨å°†ä½¿ç”¨çš„ä¸»è¦æ–¹æ³•æ˜¯this.logï¼ˆä¾‹å¦‚this.log(&#39;Hey! Welcome to my awesome generator&#39;)ï¼‰ã€‚å®ƒéœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å…¶è¾“å‡ºç»™ç”¨æˆ·; åŸºæœ¬ä¸Šå®ƒconsole.log()åœ¨ç»ˆç«¯ä¼šè¯ä¸­ä½¿ç”¨æ—¶æ¨¡ä»¿ã€‚æ‚¨å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š 12345module.exports = class extends Generator &#123; myAction() &#123; this.log('Something has gone wrong!'); &#125;&#125;; æ‚¨è¿˜å¯ä»¥åœ¨APIæ–‡æ¡£ä¸­æ‰¾åˆ°å…¶ä»–ä¸€äº›è¾…åŠ©æ–¹æ³•ã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-2.è¿è¡Œæ—¶ä¸Šä¸‹æ–‡","slug":"yeoman-authoring2","date":"2018-08-29T14:30:47.000Z","updated":"2020-07-25T02:57:18.232Z","comments":true,"path":"2018/08/29/yeoman-authoring2/","link":"","permalink":"https://jigangduan.github.io/2018/08/29/yeoman-authoring2/","excerpt":"","text":"ç¼–å†™ç”Ÿæˆå™¨æ—¶è¦æŒæ¡çš„æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€æ˜¯æ–¹æ³•çš„è¿è¡Œæ–¹å¼å’Œä¸Šä¸‹æ–‡ã€‚ åŸå‹æ–¹æ³•ä½œä¸ºåŠ¨ä½œç›´æ¥é™„åŠ åˆ°GeneratoråŸå‹çš„æ¯ä¸ªæ–¹æ³•éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€é¡¹ä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡éƒ½ç”±Yeomanç¯å¢ƒè¿è¡Œå¾ªç¯æŒ‰é¡ºåºè¿è¡Œã€‚ æ¢å¥è¯è¯´ï¼Œè¿”å›çš„å¯¹è±¡ä¸Šçš„æ¯ä¸ªå‡½æ•°Object.getPrototypeOf(Generator)éƒ½å°†è‡ªåŠ¨è¿è¡Œã€‚ è¾…åŠ©æ–¹æ³•å’Œç§æœ‰æ–¹æ³•æ—¢ç„¶æ‚¨çŸ¥é“åŸå‹æ–¹æ³•è¢«è®¤ä¸ºæ˜¯ä¸€é¡¹ä»»åŠ¡ï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“å¦‚ä½•å®šä¹‰ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çš„è¾…åŠ©æ–¹æ³•æˆ–ç§æœ‰æ–¹æ³•ã€‚æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚ æ–¹æ³•åç§°ä¸‹åˆ’çº¿å‰ç¼€ï¼ˆä¾‹å¦‚_private_methodï¼‰ 123456789class extends Generator &#123; method1() &#123; console.log('hey 1'); &#125; _private_method() &#123; console.log('private hey'); &#125;&#125; ä½¿ç”¨å®ä¾‹æ–¹æ³•ï¼š 12345678910class extends Generator &#123; constructor(args, opts) &#123; // Calling the super constructor is important so our generator is correctly set up super(args, opts) this.helperMethod = function () &#123; console.log('won\\'t be called automatically'); &#125;; &#125;&#125; æ‰©å±•çˆ¶ç”Ÿæˆå™¨ï¼š 1234567891011class MyBase extends Generator &#123; helper() &#123; console.log('methods on the parent generator won\\'t be called automatically'); &#125;&#125;module.exports = class extends MyBase &#123; exec() &#123; this.helper(); &#125;&#125;; RunLoopå¦‚æœæœ‰ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œé¡ºåºè¿è¡Œä»»åŠ¡å°±æ²¡é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦ä½ å¼€å§‹ç»„åˆç”Ÿæˆå™¨ï¼Œè¿™è¿˜ä¸å¤Ÿã€‚ è¿™å°±æ˜¯Yeomanä½¿ç”¨RunLoopçš„åŸå› ã€‚ RunLoopæ˜¯å…·æœ‰ä¼˜å…ˆçº§æ”¯æŒçš„é˜Ÿåˆ—ç³»ç»Ÿã€‚æˆ‘ä»¬ä½¿ç”¨Grouped-queueæ¨¡å—æ¥å¤„ç†RunLoopã€‚ ä¼˜å…ˆçº§åœ¨æ‚¨çš„ä»£ç ä¸­å®šä¹‰ä¸ºç‰¹æ®ŠåŸå‹æ–¹æ³•åç§°ã€‚å½“æ–¹æ³•åç§°ä¸ä¼˜å…ˆçº§åç§°ç›¸åŒæ—¶ï¼Œè¿è¡Œå¾ªç¯å°†æ–¹æ³•æ¨å…¥æ­¤ç‰¹æ®Šé˜Ÿåˆ—ã€‚å¦‚æœæ–¹æ³•åç§°ä¸ä¼˜å…ˆçº§ä¸åŒ¹é…ï¼Œåˆ™å°†å…¶æ¨é€åˆ°defaultç»„ä¸­ã€‚ åœ¨ä»£ç ä¸­ï¼Œå®ƒå°†çœ‹èµ·æ¥åƒè¿™æ ·ï¼š 123class extends Generator &#123; priorityName() &#123;&#125;&#125; æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å“ˆå¸Œè€Œä¸æ˜¯å•ä¸ªæ–¹æ³•å°†å¤šä¸ªæ–¹æ³•ç»„åˆåœ¨é˜Ÿåˆ—ä¸­ï¼š 123456Generator.extend(&#123; priorityName: &#123; method() &#123;&#125;, method2() &#123;&#125; &#125;&#125;); ï¼ˆæ³¨æ„ï¼Œæœ€åä¸€ç§æŠ€æœ¯ä¸é€‚åˆJS classå®šä¹‰ï¼‰ å¯ç”¨çš„ä¼˜å…ˆçº§æ˜¯ï¼ˆæŒ‰è¿è¡Œé¡ºåºï¼‰ï¼š initializing - æ‚¨çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆæ£€æŸ¥å½“å‰é¡¹ç›®çŠ¶æ€ï¼Œè·å–é…ç½®ç­‰ï¼‰ prompting - æç¤ºç”¨æˆ·é€‰æ‹©çš„åœ°æ–¹ï¼ˆä½ æ‰“ç”µè¯çš„åœ°æ–¹this.prompt()ï¼‰ configuring- ä¿å­˜é…ç½®å¹¶é…ç½®é¡¹ç›®ï¼ˆåˆ›å»º.editorconfigæ–‡ä»¶å’Œå…¶ä»–å…ƒæ•°æ®æ–‡ä»¶ï¼‰ default - å¦‚æœæ–¹æ³•åç§°ä¸ä¼˜å…ˆçº§ä¸åŒ¹é…ï¼Œåˆ™ä¼šå°†å…¶æ¨é€åˆ°è¯¥ç»„ã€‚ writing- ç¼–å†™ç”Ÿæˆå™¨ç‰¹å®šæ–‡ä»¶ï¼ˆè·¯ç”±ï¼Œæ§åˆ¶å™¨ç­‰ï¼‰çš„ä½ç½® conflicts - å¤„ç†å†²çªçš„åœ°æ–¹ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰ install- å®‰è£…è¿è¡Œçš„åœ°æ–¹ï¼ˆnpmï¼Œyarnï¼‰ end- æœ€åç§°å‘¼ï¼Œæ¸…ç†ï¼Œè¯´å†è§ç­‰ éµå¾ªè¿™äº›ä¼˜å…ˆçº§æŒ‡å—ï¼Œæ‚¨çš„ç”Ÿæˆå™¨å°†ä¸å…¶ä»–äººä¸€èµ·ç©ã€‚ å¼‚æ­¥ä»»åŠ¡æœ‰å¤šç§æ–¹æ³•å¯ä»¥æš‚åœRunLoopï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆå¼‚æ­¥å·¥ä½œã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ªPromiseã€‚ä¸€æ—¦Promiseè§£æï¼Œå¾ªç¯å°†ç»§ç»­ï¼Œæˆ–è€…å®ƒå°†å¼•å‘å¼‚å¸¸å¹¶åœ¨å¤±è´¥æ—¶åœæ­¢ã€‚ å¦‚æœæ‚¨æ‰€ä¾èµ–çš„å¼‚æ­¥APIä¸æ”¯æŒPromiseï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä¾èµ–äºé—ç•™this.async()æ–¹å¼ã€‚this.async()ä¸€æ—¦ä»»åŠ¡å®Œæˆï¼Œè°ƒç”¨å°†è¿”å›ä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š 1234567asyncTask() &#123; var done = this.async(); getUserEmail(function (err, name) &#123; done(err); &#125;);&#125; å¦‚æœdoneä½¿ç”¨errorå‚æ•°è°ƒç”¨è¯¥å‡½æ•°ï¼Œåˆ™è¿è¡Œå¾ªç¯å°†åœæ­¢å¹¶å¼•å‘å¼‚å¸¸ã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨-1.å…¥é—¨","slug":"yeoman-authoring","date":"2018-08-29T12:18:35.000Z","updated":"2020-07-25T02:57:18.232Z","comments":true,"path":"2018/08/29/yeoman-authoring/","link":"","permalink":"https://jigangduan.github.io/2018/08/29/yeoman-authoring/","excerpt":"","text":"Generators(ç”Ÿæˆå™¨)æ˜¯Yeomanç”Ÿæ€ç³»ç»Ÿçš„åŸºçŸ³ã€‚å®ƒä»¬æ˜¯yoä¸ºæœ€ç»ˆç”¨æˆ·ç”Ÿæˆæ–‡ä»¶æ‰€è¿è¡Œçš„æ’ä»¶ã€‚ é˜…è¯»æœ¬èŠ‚ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºå’Œåˆ†å‘è‡ªå·±çš„å†…å®¹ã€‚ æ³¨æ„ï¼šæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç”Ÿæˆå™¨ - Generatorï¼Œä»¥å¸®åŠ©ç”¨æˆ·å¼€å§‹ä½¿ç”¨è‡ªå·±çš„ç”Ÿæˆå™¨ã€‚ä¸€æ—¦ç†è§£äº†ä»¥ä¸‹æ¦‚å¿µï¼Œè¯·éšæ„ä½¿ç”¨å®ƒæ¥å¼•å¯¼æ‚¨è‡ªå·±çš„ç”Ÿæˆå™¨ã€‚ ç»„ç»‡ä½ çš„ç”Ÿæˆå™¨è®¾ç½®ä¸ºNode Moduleç”Ÿæˆå™¨çš„æ ¸å¿ƒæ˜¯Node.jsæ¨¡å— é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­ç¼–å†™æ‚¨çš„ç”Ÿæˆå™¨ã€‚æ–‡ä»¶å¤¹å¿…é¡»å‘½ågenerator-nameï¼ˆnameæ‚¨çš„ç”Ÿæˆå™¨çš„åç§°ï¼‰ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºYeomanä¾èµ–æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾å¯ç”¨çš„ç”Ÿæˆå™¨ã€‚ è¿›å…¥ç”Ÿæˆå™¨æ–‡ä»¶å¤¹åï¼Œåˆ›å»ºä¸€ä¸ªpackage.jsonæ–‡ä»¶ã€‚æ­¤æ–‡ä»¶æ˜¯Node.jsæ¨¡å—æ¸…å•ã€‚æ‚¨å¯ä»¥ä»é€šè¿‡å‘½ä»¤è¡Œnpm initè¿è¡Œæ¥ç”Ÿæˆæ­¤æ–‡ä»¶æˆ–æ‰‹åŠ¨è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š 123456789101112&#123; \"name\": \"generator-name\", \"version\": \"0.1.0\", \"description\": \"\", \"files\": [ \"generators\" ], \"keywords\": [\"yeoman-generator\"], \"dependencies\": &#123; \"yeoman-generator\": \"^1.0.0\" &#125;&#125; è¯¥nameå¿…é¡»ä»¥generator-ä¸ºå‰ç¼€ã€‚è¯¥keywordså±æ€§å¿…é¡»åŒ…å«&quot;yeoman-generator&quot;ï¼Œå¹¶ä¸”repoå¿…é¡»å…·æœ‰ç”±æˆ‘ä»¬çš„ç”Ÿæˆå™¨é¡µé¢ç´¢å¼•çš„æè¿°ã€‚ æ‚¨åº”è¯¥ç¡®ä¿å°†ä¾èµ–é¡¹yeoman-generatorè®¾ç½®ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œï¼šnpm install --save yeoman-generatorã€‚ è¯¥fileså±æ€§å¿…é¡»æ˜¯ç”Ÿæˆå™¨ä½¿ç”¨çš„æ–‡ä»¶å’Œç›®å½•æ•°ç»„ã€‚ æ ¹æ®éœ€è¦æ·»åŠ å…¶ä»–package.jsonå±æ€§ã€‚ ç›®å½•ç»“æ„Yeomançš„åŠŸèƒ½å–å†³äºæ‚¨å¦‚ä½•æ„å»ºç›®å½•ç»“æ„ã€‚æ¯ä¸ªå­ç”Ÿæˆå™¨éƒ½åŒ…å«åœ¨è‡ªå·±çš„æ–‡ä»¶å¤¹ä¸­ã€‚ è°ƒç”¨æ—¶ä½¿ç”¨çš„é»˜è®¤ç”Ÿæˆå™¨yo nameæ˜¯appç”Ÿæˆå™¨ã€‚è¿™å¿…é¡»åŒ…å«åœ¨app/ç›®å½•ä¸­ã€‚ åœ¨ç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œç›®å½•ç»“æ„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š 123456â”œâ”€â”€â”€package.jsonâ””â”€â”€â”€generators/ â”œâ”€â”€â”€app/ â”‚ â””â”€â”€â”€index.js â””â”€â”€â”€router/ â””â”€â”€â”€index.js è¿™ä¸ªç”Ÿæˆå™¨å°†å…¬å¼€yo nameå’Œyo name:routerå‘½ä»¤ã€‚ Yeomanå…è®¸ä¸¤ç§ä¸åŒçš„ç›®å½•ç»“æ„ã€‚å®ƒä¼šæŸ¥çœ‹./å’Œgenerators/æ³¨å†Œå¯ç”¨çš„ç”Ÿæˆå™¨ã€‚ å‰é¢çš„ä¾‹å­ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹ï¼š 12345â”œâ”€â”€â”€package.jsonâ”œâ”€â”€â”€app/â”‚ â””â”€â”€â”€index.jsâ””â”€â”€â”€router/ â””â”€â”€â”€index.js å¦‚æœä½¿ç”¨è¿™é‡Œçš„ç¬¬äºŒä¸ªç›®å½•ç»“æ„ï¼Œè¯·ç¡®ä¿å°†package.jsonçš„fileså±æ€§æŒ‡å‘æ‰€æœ‰ç”Ÿæˆå™¨æ–‡ä»¶å¤¹ã€‚ 123456&#123; \"files\": [ \"app\", \"router\" ]&#125; æ‰©å±•ç”Ÿæˆå™¨ä¸€æ—¦ä½ æœ‰äº†è¿™ä¸ªç»“æ„ï¼Œå°±å¯ä»¥ç¼–å†™å®é™…çš„ç”Ÿæˆå™¨äº†ã€‚ Yeomanæä¾›äº†ä¸€ä¸ªåŸºæœ¬ç”Ÿæˆå™¨ï¼Œæ‚¨å¯ä»¥æ‰©å±•å®ƒä»¥å®ç°è‡ªå·±çš„è¡Œä¸ºã€‚è¿™ä¸ªåŸºç¡€ç”Ÿæˆå™¨æ·»åŠ äº†æ‚¨å¸Œæœ›å‡è½»ä»»åŠ¡çš„å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚ åœ¨ç”Ÿæˆå™¨çš„index.jsæ–‡ä»¶ä¸­ï¼Œä»¥ä¸‹æ˜¯æ‰©å±•åŸºæœ¬ç”Ÿæˆå™¨çš„æ–¹æ³•ï¼š 123var Generator = require('yeoman-generator');module.exports = class extends Generator &#123;&#125;; æˆ‘ä»¬ä»¥module.exportsåˆ†é…æ‰©å±•ç”Ÿæˆå™¨ä½¿å…¶å¯ç”¨äºç”Ÿæ€ç³»ç»Ÿã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨Node.jsä¸­å¯¼å‡ºæ¨¡å—çš„æ–¹å¼ã€‚ è¦†ç›–æ„é€ å‡½æ•°æŸäº›ç”Ÿæˆå™¨æ–¹æ³•åªèƒ½åœ¨constructorå‡½æ•°å†…éƒ¨è°ƒç”¨ã€‚è¿™äº›ç‰¹æ®Šæ–¹æ³•å¯èƒ½ä¼šæ‰§è¡Œè¯¸å¦‚è®¾ç½®é‡è¦çŠ¶æ€æ§ä»¶ä¹‹ç±»çš„æ“ä½œï¼Œå¹¶ä¸”å¯èƒ½æ— æ³•åœ¨æ„é€ å‡½æ•°ä¹‹å¤–è¿è¡Œã€‚ è¦è¦†ç›–ç”Ÿæˆå™¨æ„é€ å‡½æ•°ï¼Œè¯·æ·»åŠ å¦‚ä¸‹æ„é€ å‡½æ•°æ–¹æ³•ï¼š 12345678910module.exports = class extends Generator &#123; // The name `constructor` is important here constructor(args, opts) &#123; // Calling the super constructor is important so our generator is correctly set up super(args, opts); // Next, add your custom code this.option('babel'); // This method adds support for a `--babel` flag &#125;&#125;; æ·»åŠ è‡ªå·±çš„å‡½æ•°æ·»åŠ åˆ°åŸå‹çš„æ¯ä¸ªæ–¹æ³•éƒ½ä¼šåœ¨è°ƒç”¨ç”Ÿæˆå™¨åè¿è¡Œ - é€šå¸¸æŒ‰é¡ºåºè¿è¡Œã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°çš„ï¼Œä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•åç§°å°†è§¦å‘ç‰¹å®šçš„è¿è¡Œé¡ºåºã€‚ è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æ–¹æ³•ï¼š 123456789module.exports = class extends Generator &#123; method1() &#123; this.log('method 1 just ran'); &#125; method2() &#123; this.log('method 2 just ran'); &#125;&#125;; å½“æˆ‘ä»¬ç¨åè¿è¡Œç”Ÿæˆå™¨æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°è¿™äº›åˆ°æ§åˆ¶å°çš„è¡Œè®°å½•ã€‚ è¿è¡Œç”Ÿæˆå™¨æ­¤æ—¶ï¼Œä½ æœ‰ä¸€ä¸ªå¯ä»¥å·¥ä½œçš„ç”Ÿæˆå™¨ã€‚ä¸‹ä¸€ä¸ªåˆä¹é€»è¾‘çš„æ­¥éª¤æ˜¯è¿è¡Œå®ƒå¹¶æŸ¥çœ‹å®ƒæ˜¯å¦æœ‰æ•ˆã€‚ ç”±äºæ‚¨åœ¨æœ¬åœ°å¼€å‘ç”Ÿæˆå™¨ï¼Œå› æ­¤å®ƒå°šæœªä½œä¸ºå…¨å±€npmæ¨¡å—æä¾›ã€‚å¯ä»¥ä½¿ç”¨npmåˆ›å»ºå…¨å±€æ¨¡å—å¹¶å°†å…¶ç¬¦å·é“¾æ¥åˆ°æœ¬åœ°â€‹â€‹æ¨¡å—ã€‚è¿™æ˜¯ä½ æƒ³è¦åšçš„ï¼š åœ¨å‘½ä»¤è¡Œä¸Šï¼Œä»ç”Ÿæˆå™¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆåœ¨generator-name/æ–‡ä»¶å¤¹ä¸­ï¼‰ä¸­é”®å…¥ï¼š 1npm link è¿™å°†å®‰è£…æ‚¨çš„é¡¹ç›®ä¾èµ–é¡¹å’Œç¬¦å·é“¾æ¥å…¨å±€æ¨¡å—åˆ°æ‚¨çš„æœ¬åœ°æ–‡ä»¶ã€‚å®Œæˆnpmåï¼Œæ‚¨å°†èƒ½å¤Ÿè°ƒç”¨yo nameï¼Œæ‚¨åº”è¯¥çœ‹åˆ°åœ¨ç»ˆç«¯ä¸­å‘ˆç°å‰é¢this.logå®šä¹‰çš„çš„å†…å®¹ã€‚æ­å–œä½ ï¼Œä½ åˆšåˆšå»ºé€ äº†ä½ çš„ç¬¬ä¸€å°ç”Ÿæˆå™¨ï¼ æ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•åœ¨è¿è¡Œç”Ÿæˆå™¨æ—¶ï¼ŒYeomanå°†å°è¯•æ ¹æ®å…¶è¿è¡Œçš„æ–‡ä»¶å¤¹çš„ä¸Šä¸‹æ–‡æ¥è®¡ç®—å‡ºä¸€äº›å†…å®¹ã€‚ æœ€é‡è¦çš„æ˜¯ï¼ŒYeomanåœ¨ç›®å½•æ ‘ä¸­æœç´¢.yo-rc.jsonæ–‡ä»¶ã€‚å¦‚æœæ‰¾åˆ°ï¼Œå®ƒä¼šå°†æ–‡ä»¶çš„ä½ç½®è§†ä¸ºé¡¹ç›®çš„æ ¹ã€‚åœ¨å¹•åï¼ŒYeomanä¼šå°†å½“å‰ç›®å½•æ›´æ”¹ä¸º.yo-rc.jsonæ–‡ä»¶ä½ç½®å¹¶åœ¨é‚£é‡Œè¿è¡Œè¯·æ±‚çš„ç”Ÿæˆå™¨ã€‚ å­˜å‚¨æ¨¡å—åˆ›å»º.yo-rc.jsonæ–‡ä»¶ã€‚this.config.save()é¦–æ¬¡ä»ç”Ÿæˆå™¨è°ƒç”¨å°†åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨çš„ç”Ÿæˆå™¨æœªåœ¨å½“å‰å·¥ä½œç›®å½•ä¸­è¿è¡Œï¼Œè¯·ç¡®ä¿æ‚¨ç›®å½•æ ‘ä¸­çš„æŸä¸ªä½ç½®æ²¡æœ‰.yo-rc.jsonã€‚","categories":[{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"}]},{"title":"VSCode Webview API","slug":"vscode-extensions-5","date":"2018-08-11T09:54:45.000Z","updated":"2020-07-25T02:57:18.231Z","comments":true,"path":"2018/08/11/vscode-extensions-5/","link":"","permalink":"https://jigangduan.github.io/2018/08/11/vscode-extensions-5/","excerpt":"","text":"webview APIå…è®¸æ‰©å±•åœ¨Visual Studio Codeä¸­åˆ›å»ºå®Œå…¨å¯å®šåˆ¶çš„è§†å›¾ã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„Markdownæ‰©å±•ä½¿ç”¨webviewæ¥å‘ˆç°Markdowné¢„è§ˆã€‚é™¤äº†VS Codeçš„åŸç”Ÿapiæ”¯æŒä¹‹å¤–ï¼Œwebviewè¿˜å¯ä»¥ç”¨æ¥æ„å»ºå¤æ‚çš„ç”¨æˆ·ç•Œé¢ã€‚ å¯ä»¥å°†webviewçœ‹ä½œæ˜¯æ‚¨çš„æ‰©å±•æ§åˆ¶çš„VS Codeä¸­çš„iframeã€‚ä¸€ä¸ªwebviewå¯ä»¥å‘ˆç°è¿™ä¸ªæ¡†æ¶ä¸­å‡ ä¹æ‰€æœ‰çš„HTMLå†…å®¹ï¼Œå®ƒé€šè¿‡æ¶ˆæ¯ä¼ é€’ä¸æ‰©å±•é€šä¿¡ã€‚è¿™ç§è‡ªç”±ä½¿webviewå˜å¾—éå¸¸å¼ºå¤§ï¼Œå¹¶æ‰“å¼€äº†ä¸€ä¸ªå…¨æ–°çš„æ‰©å±•èŒƒå›´ã€‚ æˆ‘åº”è¯¥ä½¿ç”¨webviewå—?Webviewsæ˜¯ç›¸å½“æƒŠäººçš„ï¼Œä½†ä»–ä»¬ä¹Ÿåº”è¯¥è¢«è°¨æ…ä½¿ç”¨ï¼Œåªæœ‰å½“VS Codeçš„æœ¬æœºAPIæ˜¯ä¸å¤Ÿçš„ã€‚webviewå ç”¨å¤§é‡çš„èµ„æºï¼Œè¿è¡Œåœ¨ä¸æ™®é€šæ‰©å±•ä¸åŒçš„ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­ã€‚ä¸€ä¸ªè®¾è®¡ä¸ä½³çš„webviewä¹Ÿå¾ˆå®¹æ˜“åœ¨VS Codeä¸­æ„Ÿè§‰æ ¼æ ¼ä¸å…¥ã€‚ åœ¨ä½¿ç”¨webviewä¹‹å‰ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹: è¿™ä¸ªåŠŸèƒ½çœŸçš„éœ€è¦å­˜åœ¨äºVSä»£ç ä¸­å—?ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ä¼šæ›´å¥½å—? webviewæ˜¯å®ç°ä½ çš„åŠŸèƒ½çš„å”¯ä¸€æ–¹æ³•å—?å¯ä»¥ä½¿ç”¨å¸¸è§„VSä»£ç apiå—? ä½ çš„webviewä¼šå¢åŠ è¶³å¤Ÿçš„ç”¨æˆ·ä»·å€¼æ¥è¯æ˜å®ƒçš„é«˜èµ„æºæˆæœ¬å—? è®°ä½:ä»…ä»…å› ä¸ºä½ å¯ä»¥ç”¨webviewsåšä¸€äº›äº‹æƒ…ï¼Œå¹¶ä¸æ„å‘³ç€ä½ åº”è¯¥è¿™æ ·åšã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ç¡®ä¿¡éœ€è¦ä½¿ç”¨webviewsï¼Œé‚£ä¹ˆæœ¬æ–‡å°†æä¾›å¸®åŠ©ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ webview APIåŸºç¡€çŸ¥è¯†ä¸ºäº†è§£é‡Šwebview APIï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„æ‰©å±•åä¸ºCatç¼–ç ã€‚è¿™ä¸ªæ‰©å±•å°†ä½¿ç”¨webviewæ¥æ˜¾ç¤ºçŒ«å†™ä»£ç çš„gif(å¤§æ¦‚æ˜¯VS Code)ã€‚åœ¨æˆ‘ä»¬å¤„ç†APIçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‘æ‰©å±•æ·»åŠ åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè·Ÿè¸ªcatç¼–å†™çš„æºä»£ç è¡Œæ•°ï¼Œä»¥åŠå½“catå¼•å…¥é”™è¯¯æ—¶é€šçŸ¥ç”¨æˆ·çš„é€šçŸ¥ã€‚ ä¸‹é¢æ˜¯Catç¼–ç æ‰©å±•çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„package.jsonã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„å®Œæ•´ä»£ç ã€‚æˆ‘ä»¬æ‰©å±•çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªåä¸ºcatCoding.startçš„å‘½ä»¤ã€‚å½“ç”¨æˆ·è°ƒç”¨æ­¤å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„å¸¦æœ‰catçš„webviewã€‚ç”¨æˆ·å°†èƒ½å¤Ÿä»å‘½ä»¤è°ƒè‰²æ¿ä¸­è°ƒç”¨è¿™ä¸ªå‘½ä»¤ä½œä¸ºCatç¼–ç :å¯åŠ¨æ–°çš„Catç¼–ç ä¼šè¯ï¼Œå¦‚æœä»–ä»¬æ„¿æ„ï¼Œç”šè‡³å¯ä»¥ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªé”®ç»‘å®šã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"}]},{"title":"ä¾‹å­â€”â€”è¯­è¨€æœåŠ¡å™¨","slug":"vscode-extensions-4","date":"2018-08-11T08:01:10.000Z","updated":"2020-07-25T02:57:18.231Z","comments":true,"path":"2018/08/11/vscode-extensions-4/","link":"","permalink":"https://jigangduan.github.io/2018/08/11/vscode-extensions-4/","excerpt":"","text":"ç®€è¦æ¦‚è¿°è¯­è¨€æœåŠ¡å™¨å’Œè¯­è¨€æœåŠ¡å™¨åè®®è¯­è¨€æœåŠ¡å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ‰©å±•ï¼Œæ”¯æŒVSä»£ç ä¸­è®¸å¤šç¼–ç¨‹è¯­è¨€çš„ç¼–è¾‘ä½“éªŒã€‚ä½¿ç”¨è¯­è¨€æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å®ç°VSä»£ç ä¸­æ”¯æŒçš„è‡ªåŠ¨å®Œæˆã€é”™è¯¯æ£€æŸ¥(è¯Šæ–­)ã€å¿«é€Ÿå®šä¹‰å’Œè®¸å¤šå…¶ä»–è¯­è¨€ç‰¹æ€§ã€‚ ç„¶è€Œï¼Œåœ¨VSä»£ç ä¸­å®ç°å¯¹è¯­è¨€ç‰¹æ€§çš„æ”¯æŒæ—¶ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸‰ä¸ªå¸¸è§é—®é¢˜: é¦–å…ˆï¼Œè¯­è¨€æœåŠ¡å™¨é€šå¸¸æ˜¯ç”¨å®ƒä»¬çš„æœ¬åœ°ç¼–ç¨‹è¯­è¨€å®ç°çš„ï¼Œè¿™åœ¨å°†å®ƒä»¬ä¸å…·æœ‰èŠ‚ç‚¹çš„VSä»£ç é›†æˆæ–¹é¢æå‡ºäº†æŒ‘æˆ˜ã€‚jsè¿è¡Œæ—¶ã€‚ æ­¤å¤–ï¼Œè¯­è¨€ç‰¹æ€§å¯èƒ½æ˜¯èµ„æºå¯†é›†å‹çš„ã€‚ä¾‹å¦‚ï¼Œè¦æ­£ç¡®åœ°éªŒè¯ä¸€ä¸ªæ–‡ä»¶ï¼ŒLanguage Serveréœ€è¦è§£æå¤§é‡æ–‡ä»¶ï¼Œä¸ºå®ƒä»¬æ„å»ºæŠ½è±¡è¯­æ³•æ ‘å¹¶æ‰§è¡Œé™æ€ç¨‹åºåˆ†æã€‚è¿™äº›æ“ä½œå¯èƒ½å¯¼è‡´å¤§é‡çš„CPUå’Œå†…å­˜ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿VSä»£ç çš„æ€§èƒ½ä¸å—å½±å“ã€‚ æœ€åï¼Œå°†å¤šç§è¯­è¨€å·¥å…·ä¸å¤šç§ä»£ç ç¼–è¾‘å™¨é›†æˆå¯èƒ½éœ€è¦å¤§é‡çš„å·¥ä½œã€‚ä»è¯­è¨€å·¥å…·çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»¬éœ€è¦é€‚åº”å…·æœ‰ä¸åŒapiçš„ä»£ç ç¼–è¾‘å™¨ã€‚ä»ä»£ç ç¼–è¾‘çš„è§’åº¦æ¥çœ‹ï¼Œä»–ä»¬ä¸èƒ½æœŸæœ›è¯­è¨€å·¥å…·æä¾›ç»Ÿä¸€çš„APIã€‚è¿™ä½¿å¾—åœ¨Nä¸ªä»£ç ç¼–è¾‘å™¨ä¸­å®ç°å¯¹Mè¯­è¨€çš„æ”¯æŒæˆä¸ºM * Nçš„å·¥ä½œã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¾®è½¯æŒ‡å®šäº†è¯­è¨€æœåŠ¡å™¨åè®®ï¼Œè§„èŒƒäº†è¯­è¨€å·¥å…·å’Œä»£ç ç¼–è¾‘å™¨ä¹‹é—´çš„é€šä¿¡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè¯­è¨€æœåŠ¡å™¨å¯ä»¥åœ¨ä»»ä½•è¯­è¨€ä¸­å®ç°ï¼Œå¹¶åœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œä»¥é¿å…æ€§èƒ½æˆæœ¬ï¼Œå› ä¸ºå®ƒä»¬é€šè¿‡è¯­è¨€æœåŠ¡å™¨åè®®ä¸ä»£ç ç¼–è¾‘å™¨é€šä¿¡ã€‚æ­¤å¤–ï¼Œä»»ä½•ç¬¦åˆlspçš„è¯­è¨€å·¥å…·éƒ½å¯ä»¥ä¸å¤šä¸ªç¬¦åˆlspçš„ä»£ç ç¼–è¾‘å™¨é›†æˆï¼Œä»»ä½•ç¬¦åˆlspçš„ä»£ç ç¼–è¾‘å™¨éƒ½å¯ä»¥è½»æ¾åœ°è·å–å¤šä¸ªç¬¦åˆlspçš„è¯­è¨€å·¥å…·ã€‚LSPæ˜¯è¯­è¨€å·¥å…·æä¾›å•†å’Œä»£ç ç¼–è¾‘å™¨ä¾›åº”å•†çš„åŒèµ¢! åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†: è¯´æ˜å¦‚ä½•ä½¿ç”¨æä¾›çš„Node SDKåœ¨VSä»£ç ä¸­æ„å»ºè¯­è¨€æœåŠ¡å™¨æ‰©å±•ã€‚ è§£é‡Šå¦‚ä½•è¿è¡Œã€è°ƒè¯•ã€è®°å½•å’Œæµ‹è¯•è¯­è¨€æœåŠ¡å™¨æ‰©å±•ã€‚ ä¸ºæ‚¨ä»‹ç»ä¸€äº›è¯­è¨€æœåŠ¡å™¨ä¸Šçš„é«˜çº§ä¸»é¢˜ã€‚ å®ç°è¯­è¨€çš„æœåŠ¡å™¨æ¦‚è¿°åœ¨VS Codeä¸­ï¼Œè¯­è¨€æœåŠ¡å™¨æœ‰ä¸¤éƒ¨åˆ†: è¯­è¨€å®¢æˆ·ç«¯:ç”¨JavaScript / TypeScriptç¼–å†™çš„æ™®é€šVSä»£ç æ‰©å±•ã€‚è¿™ä¸ªæ‰©å±•å¯ä»¥è®¿é—®æ‰€æœ‰VS Codeå‘½åç©ºé—´APIã€‚ è¯­è¨€æœåŠ¡å™¨:åœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­è¿è¡Œçš„è¯­è¨€åˆ†æå·¥å…·ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œè¯­è¨€æœåŠ¡å™¨æœ‰ä¸¤ä¸ªå¥½å¤„: åˆ†æå·¥å…·å¯ä»¥ç”¨ä»»ä½•è¯­è¨€å®ç°ï¼Œåªè¦å®ƒèƒ½å¤ŸæŒ‰ç…§è¯­è¨€æœåŠ¡å™¨åè®®ä¸è¯­è¨€å®¢æˆ·æœºé€šä¿¡ã€‚ ç”±äºè¯­è¨€åˆ†æå·¥å…·é€šå¸¸å ç”¨å¤§é‡CPUå’Œå†…å­˜ï¼Œå› æ­¤åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œå®ƒä»¬å¯ä»¥é¿å…æ€§èƒ½å¼€é”€ã€‚ ä¸‹é¢æ˜¯VSä»£ç è¿è¡Œä¸¤ä¸ªè¯­è¨€æœåŠ¡å™¨æ‰©å±•çš„ç¤ºä¾‹ã€‚HTMLè¯­è¨€å®¢æˆ·ç«¯å’ŒPHPè¯­è¨€å®¢æˆ·ç«¯æ˜¯ç”¨TypeScriptç¼–å†™çš„æ™®é€šVSä»£ç æ‰©å±•ã€‚å®ƒä»¬ä¸­çš„æ¯ä¸ªå®ä¾‹åŒ–ä¸€ä¸ªç›¸åº”çš„è¯­è¨€æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡LSPä¸å®ƒä»¬é€šä¿¡ã€‚è™½ç„¶PHPè¯­è¨€æœåŠ¡å™¨æ˜¯ç”¨PHPç¼–å†™çš„ï¼Œä½†å®ƒä»ç„¶å¯ä»¥é€šè¿‡LSPä¸PHPè¯­è¨€å®¢æˆ·ç«¯é€šä¿¡ã€‚ æœ¬æŒ‡å—å°†æ•™ä½ å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„Node SDKæ„å»ºè¯­è¨€å®¢æˆ·æœº/æœåŠ¡å™¨ã€‚å‰©ä¸‹çš„æ–‡æ¡£å‡è®¾æ‚¨ç†Ÿæ‚‰VS Codeçš„æ­£å¸¸æ‰©å±•å¼€å‘ã€‚ lspç¤ºä¾‹ - ä¸€ä¸ªç®€å•çš„è¯­è¨€æœåŠ¡å™¨çº¯æ–‡æœ¬æ–‡ä»¶è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„è¯­è¨€æœåŠ¡å™¨æ‰©å±•ï¼Œä¸ºçº¯æ–‡æœ¬æ–‡ä»¶å®ç°è‡ªåŠ¨å®Œæˆå’Œè¯Šæ–­ã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç»å®¢æˆ·æœº/æœåŠ¡å™¨ä¹‹é—´é…ç½®çš„åŒæ­¥ã€‚ å¦‚æœä½ å–œæ¬¢ç›´æ¥è¿›å…¥ä»£ç : lspç¤ºä¾‹:æœ¬æŒ‡å—çš„å¤§é‡æ–‡æ¡£åŒ–æºä»£ç ã€‚lsp-multiserver-sample:å¤§é‡æ–‡æ¡£åŒ–çš„lsp-sampleé«˜çº§ç‰ˆæœ¬ï¼Œæ¯ä¸ªå·¥ä½œåŒºæ–‡ä»¶å¤¹å¯åŠ¨ä¸€ä¸ªä¸åŒçš„æœåŠ¡å™¨å®ä¾‹ï¼Œä»¥æ”¯æŒVSä»£ç ä¸­çš„å¤šæ ¹å·¥ä½œåŒºç‰¹æ€§ã€‚å…‹éš†å­˜å‚¨åº“Microsoft/vscode-extension-sampleså¹¶æ‰“å¼€ç¤ºä¾‹: 12345&gt; git clone https://github.com/Microsoft/vscode-extension-samples.git&gt; cd vscode-extension-samples/lsp-sample&gt; npm install&gt; npm run compile&gt; code . ä¸Šé¢çš„æ­¥éª¤å°†å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå¹¶æ‰“å¼€åŒ…å«å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä»£ç çš„lspç¤ºä¾‹å·¥ä½œåŒºã€‚ä¸‹é¢æ˜¯lsp-sampleç»“æ„çš„ç²—ç•¥æ¦‚è¿°: 123456789.â”œâ”€â”€ client // Language Clientâ”‚ â”œâ”€â”€ srcâ”‚ â”‚ â”œâ”€â”€ test // End to End tests for Language Client / Serverâ”‚ â”‚ â””â”€â”€ extension.ts // Language Client entry pointâ”œâ”€â”€ package.json // The extension manifestâ””â”€â”€ server // Language Server â””â”€â”€ src â””â”€â”€ server.ts // Language Server entry point è§£é‡Šâ€œè¯­è¨€å®¢æˆ·ç«¯â€è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹/package.jsonï¼Œå®ƒæè¿°äº†è¯­è¨€å®¢æˆ·æœºçš„åŠŸèƒ½ã€‚æœ‰ä¸‰ä¸ªæœ‰è¶£çš„éƒ¨åˆ†: é¦–å…ˆçœ‹activationEvents: 123\"activationEvents\": [ \"onLanguage:plaintext\"] æœ¬èŠ‚å‘Šè¯‰VSä»£ç åœ¨æ‰“å¼€çº¯æ–‡æœ¬æ–‡ä»¶(ä¾‹å¦‚å¸¦æœ‰æ‰©å±•å.txtçš„æ–‡ä»¶)æ—¶ç«‹å³æ¿€æ´»æ‰©å±•åã€‚ æ¥ä¸‹æ¥çœ‹é…ç½®éƒ¨åˆ†: 123456789101112\"configuration\": &#123; \"type\": \"object\", \"title\": \"Example configuration\", \"properties\": &#123; \"languageServerExample.maxNumberOfProblems\": &#123; \"scope\": \"resource\", \"type\": \"number\", \"default\": 100, \"description\": \"Controls the maximum number of problems produced by the server.\" &#125; &#125;&#125; æœ¬èŠ‚ä¸ºVSä»£ç æä¾›é…ç½®è®¾ç½®ã€‚è¿™ä¸ªç¤ºä¾‹å°†è§£é‡Šè¿™äº›è®¾ç½®å¦‚ä½•åœ¨å¯åŠ¨æ—¶å’Œæ¯æ¬¡æ›´æ”¹è®¾ç½®æ—¶å‘é€åˆ°è¯­è¨€æœåŠ¡å™¨ã€‚ å®é™…çš„è¯­è¨€å®¢æˆ·ç«¯ä»£ç å’Œç›¸åº”çš„åŒ…ã€‚jsonåœ¨/clientæ–‡ä»¶å¤¹ä¸­ã€‚åŒ…è£…ä¸­æœ‰è¶£çš„éƒ¨åˆ†ã€‚jsonæ–‡ä»¶æ˜¯å®ƒæ·»åŠ äº†ä¸€ä¸ªä¾èµ–äºvscodeæ‰©å±•ä¸»æœºAPIå’Œvscode-languageclientåº“: 1234\"dependencies\": &#123; \"vscode\": \"^1.1.18\", \"vscode-languageclient\": \"^4.1.4\"&#125; å¦‚å‰æ‰€è¿°ï¼Œå®¢æˆ·ç«¯æ˜¯ä½œä¸ºä¸€ä¸ªæ™®é€šçš„VSä»£ç æ‰©å±•æ¥å®ç°çš„ï¼Œå®ƒå¯ä»¥è®¿é—®æ‰€æœ‰VS Codeå‘½åç©ºé—´APIã€‚ ä¸‹é¢æ˜¯å¯¹åº”çš„extension.tsæ–‡ä»¶çš„å†…å®¹ï¼Œæ˜¯lsp-sample extensionçš„æ¡ç›®: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import * as path from 'path';import &#123; workspace, ExtensionContext &#125; from 'vscode';import &#123; LanguageClient, LanguageClientOptions, ServerOptions, TransportKind&#125; from 'vscode-languageclient';let client: LanguageClient;export function activate(context: ExtensionContext) &#123; // The server is implemented in node let serverModule = context.asAbsolutePath( path.join('server', 'out', 'server.js') ); // The debug options for the server // --inspect=6009: runs the server in Node's Inspector mode so VS Code can attach to the server for debugging let debugOptions = &#123; execArgv: ['--nolazy', '--inspect=6009'] &#125;; // If the extension is launched in debug mode then the debug server options are used // Otherwise the run options are used let serverOptions: ServerOptions = &#123; run: &#123; module: serverModule, transport: TransportKind.ipc &#125;, debug: &#123; module: serverModule, transport: TransportKind.ipc, options: debugOptions &#125; &#125;; // Options to control the language client let clientOptions: LanguageClientOptions = &#123; // Register the server for plain text documents documentSelector: [&#123; scheme: 'file', language: 'plaintext' &#125;], synchronize: &#123; // Notify the server about file changes to '.clientrc files contained in the workspace fileEvents: workspace.createFileSystemWatcher('**/.clientrc') &#125; &#125;; // Create the language client and start the client. client = new LanguageClient( 'languageServerExample', 'Language Server Example', serverOptions, clientOptions ); // Start the client. This will also launch the server client.start();&#125;export function deactivate(): Thenable&lt;void&gt; &#123; if (!client) &#123; return undefined; &#125; return client.stop();&#125; è§£é‡Šè¯­è¨€æœåŠ¡å™¨ æ³¨æ„:ä»GitHubå­˜å‚¨åº“å…‹éš†å‡ºæ¥çš„â€œæœåŠ¡å™¨â€å®ç°æœ‰æœ€ç»ˆçš„æ¼”ç»ƒå®ç°ã€‚è¦æ‰§è¡Œæ¼”ç»ƒï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„server.ts æˆ–ä¿®æ”¹å…‹éš†ç‰ˆæœ¬çš„å†…å®¹ã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨ä¹Ÿåœ¨TypeScriptå®ç°ï¼Œå¹¶ä½¿ç”¨Node.jsæ‰§è¡Œã€‚å› ä¸ºVSä»£ç å·²ç»é™„å¸¦äº†ä¸€ä¸ªNode.jsè¿è¡Œæ—¶ï¼Œæ²¡æœ‰å¿…è¦æä¾›ä½ è‡ªå·±çš„ï¼Œé™¤éä½ æœ‰éå¸¸å…·ä½“çš„è¦æ±‚è¿è¡Œæ—¶ã€‚ è¯­è¨€æœåŠ¡å™¨çš„æºä»£ç åœ¨/serverã€‚æœåŠ¡å™¨çš„package.jsonæ–‡ä»¶ä¸­æœ‰è¶£çš„éƒ¨åˆ†æ˜¯: 123\"dependencies\": &#123; \"vscode-languageserver\": \"^4.1.3\"&#125; è¿™å°±å¼•å…¥äº†vscode-languageserveråº“ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæœåŠ¡å™¨å®ç°ï¼Œå®ƒä½¿ç”¨æä¾›çš„ç®€å•æ–‡æœ¬æ–‡æ¡£ç®¡ç†å™¨æ¥åŒæ­¥æ–‡æœ¬æ–‡æ¡£ï¼Œæ–¹æ³•æ˜¯å§‹ç»ˆå°†æ–‡ä»¶çš„å®Œæ•´å†…å®¹ä»VS Codeå‘é€åˆ°æœåŠ¡å™¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235import &#123; createConnection, TextDocuments, TextDocument, Diagnostic, DiagnosticSeverity, ProposedFeatures, InitializeParams, DidChangeConfigurationNotification, CompletionItem, CompletionItemKind, TextDocumentPositionParams&#125; from 'vscode-languageserver';// Create a connection for the server. The connection uses Node's IPC as a transport.// Also include all preview / proposed LSP features.let connection = createConnection(ProposedFeatures.all);// Create a simple text document manager. The text document manager// supports full document sync onlylet documents: TextDocuments = new TextDocuments();let hasConfigurationCapability: boolean = false;let hasWorkspaceFolderCapability: boolean = false;let hasDiagnosticRelatedInformationCapability: boolean = false;connection.onInitialize((params: InitializeParams) =&gt; &#123; let capabilities = params.capabilities; // Does the client support the `workspace/configuration` request? // If not, we will fall back using global settings hasConfigurationCapability = capabilities.workspace &amp;&amp; !!capabilities.workspace.configuration; hasWorkspaceFolderCapability = capabilities.workspace &amp;&amp; !!capabilities.workspace.workspaceFolders; hasDiagnosticRelatedInformationCapability = capabilities.textDocument &amp;&amp; capabilities.textDocument.publishDiagnostics &amp;&amp; capabilities.textDocument.publishDiagnostics.relatedInformation; return &#123; capabilities: &#123; textDocumentSync: documents.syncKind, // Tell the client that the server supports code completion completionProvider: &#123; resolveProvider: true &#125; &#125; &#125;;&#125;);connection.onInitialized(() =&gt; &#123; if (hasConfigurationCapability) &#123; // Register for all configuration changes. connection.client.register( DidChangeConfigurationNotification.type, undefined ); &#125; if (hasWorkspaceFolderCapability) &#123; connection.workspace.onDidChangeWorkspaceFolders(_event =&gt; &#123; connection.console.log('Workspace folder change event received.'); &#125;); &#125;&#125;);// The example settingsinterface ExampleSettings &#123; maxNumberOfProblems: number;&#125;// The global settings, used when the `workspace/configuration` request is not supported by the client.// Please note that this is not the case when using this server with the client provided in this example// but could happen with other clients.const defaultSettings: ExampleSettings = &#123; maxNumberOfProblems: 1000 &#125;;let globalSettings: ExampleSettings = defaultSettings;// Cache the settings of all open documentslet documentSettings: Map&lt;string, Thenable&lt;ExampleSettings&gt;&gt; = new Map();connection.onDidChangeConfiguration(change =&gt; &#123; if (hasConfigurationCapability) &#123; // Reset all cached document settings documentSettings.clear(); &#125; else &#123; globalSettings = &lt;ExampleSettings&gt;( (change.settings.languageServerExample || defaultSettings) ); &#125; // Revalidate all open text documents documents.all().forEach(validateTextDocument);&#125;);function getDocumentSettings(resource: string): Thenable&lt;ExampleSettings&gt; &#123; if (!hasConfigurationCapability) &#123; return Promise.resolve(globalSettings); &#125; let result = documentSettings.get(resource); if (!result) &#123; result = connection.workspace.getConfiguration(&#123; scopeUri: resource, section: 'languageServerExample' &#125;); documentSettings.set(resource, result); &#125; return result;&#125;// Only keep settings for open documentsdocuments.onDidClose(e =&gt; &#123; documentSettings.delete(e.document.uri);&#125;);// The content of a text document has changed. This event is emitted// when the text document first opened or when its content has changed.documents.onDidChangeContent(change =&gt; &#123; validateTextDocument(change.document);&#125;);async function validateTextDocument(textDocument: TextDocument): Promise&lt;void&gt; &#123; // In this simple example we get the settings for every validate run. let settings = await getDocumentSettings(textDocument.uri); // The validator creates diagnostics for all uppercase words length 2 and more let text = textDocument.getText(); let pattern = /\\b[A-Z]&#123;2,&#125;\\b/g; let m: RegExpExecArray; let problems = 0; let diagnostics: Diagnostic[] = []; while ((m = pattern.exec(text)) &amp;&amp; problems &lt; settings.maxNumberOfProblems) &#123; problems++; let diagnostic: Diagnostic = &#123; severity: DiagnosticSeverity.Warning, range: &#123; start: textDocument.positionAt(m.index), end: textDocument.positionAt(m.index + m[0].length) &#125;, message: `$&#123;m[0]&#125; is all uppercase.`, source: 'ex' &#125;; if (hasDiagnosticRelatedInformationCapability) &#123; diagnostic.relatedInformation = [ &#123; location: &#123; uri: textDocument.uri, range: Object.assign(&#123;&#125;, diagnostic.range) &#125;, message: 'Spelling matters' &#125;, &#123; location: &#123; uri: textDocument.uri, range: Object.assign(&#123;&#125;, diagnostic.range) &#125;, message: 'Particularly for names' &#125; ]; &#125; diagnostics.push(diagnostic); &#125; // Send the computed diagnostics to VSCode. connection.sendDiagnostics(&#123; uri: textDocument.uri, diagnostics &#125;);&#125;connection.onDidChangeWatchedFiles(_change =&gt; &#123; // Monitored files have change in VSCode connection.console.log('We received an file change event');&#125;);// This handler provides the initial list of the completion items.connection.onCompletion( (_textDocumentPosition: TextDocumentPositionParams): CompletionItem[] =&gt; &#123; // The pass parameter contains the position of the text document in // which code complete got requested. For the example we ignore this // info and always provide the same completion items. return [ &#123; label: 'TypeScript', kind: CompletionItemKind.Text, data: 1 &#125;, &#123; label: 'JavaScript', kind: CompletionItemKind.Text, data: 2 &#125; ]; &#125;);// This handler resolves additional information for the item selected in// the completion list.connection.onCompletionResolve( (item: CompletionItem): CompletionItem =&gt; &#123; if (item.data === 1) &#123; item.detail = 'TypeScript details'; item.documentation = 'TypeScript documentation'; &#125; else if (item.data === 2) &#123; item.detail = 'JavaScript details'; item.documentation = 'JavaScript documentation'; &#125; return item; &#125;);/*connection.onDidOpenTextDocument((params) =&gt; &#123; // A text document got opened in VSCode. // params.uri uniquely identifies the document. For documents store on disk this is a file URI. // params.text the initial full content of the document. connection.console.log(`$&#123;params.textDocument.uri&#125; opened.`);&#125;);connection.onDidChangeTextDocument((params) =&gt; &#123; // The content of a text document did change in VSCode. // params.uri uniquely identifies the document. // params.contentChanges describe the content changes to the document. connection.console.log(`$&#123;params.textDocument.uri&#125; changed: $&#123;JSON.stringify(params.contentChanges)&#125;`);&#125;);connection.onDidCloseTextDocument((params) =&gt; &#123; // A text document got closed in VSCode. // params.uri uniquely identifies the document. connection.console.log(`$&#123;params.textDocument.uri&#125; closed.`);&#125;);*/// Make the text document manager listen on the connection// for open, change and close text document eventsdocuments.listen(connection);// Listen on the connectionconnection.listen(); æ·»åŠ ä¸€ä¸ªç®€å•çš„éªŒè¯è¦å‘æœåŠ¡å™¨æ·»åŠ æ–‡æ¡£éªŒè¯ï¼Œæˆ‘ä»¬å‘æ–‡æœ¬æ–‡æ¡£ç®¡ç†å™¨æ·»åŠ ä¸€ä¸ªä¾¦å¬å™¨ï¼Œå½“æ–‡æœ¬æ–‡æ¡£çš„å†…å®¹å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œè¯¥ä¾¦å¬å™¨å°±ä¼šè¢«è°ƒç”¨ã€‚ç„¶åç”±æœåŠ¡å™¨å†³å®šä½•æ—¶éªŒè¯æ–‡æ¡£çš„æœ€ä½³æ—¶é—´ã€‚åœ¨ç¤ºä¾‹å®ç°ä¸­ï¼ŒæœåŠ¡å™¨éªŒè¯çº¯æ–‡æœ¬æ–‡æ¡£å¹¶æ ‡è®°ä½¿ç”¨æ‰€æœ‰å¤§å†™å­—æ¯çš„æ‰€æœ‰å‡ºç°çš„å•è¯ã€‚å¯¹åº”çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// The content of a text document has changed. This event is emitted// when the text document first opened or when its content has changed.documents.onDidChangeContent(async (change) =&gt; &#123; // In this simple example we get the settings for every validate run. let settings = await getDocumentSettings(textDocument.uri); // The validator creates diagnostics for all uppercase words length 2 and more let text = textDocument.getText(); let pattern = /\\b[A-Z]&#123;2,&#125;\\b/g; let m: RegExpExecArray; let problems = 0; let diagnostics: Diagnostic[] = []; while ((m = pattern.exec(text))) &#123; problems++; let diagnostic: Diagnostic = &#123; severity: DiagnosticSeverity.Warning, range: &#123; start: textDocument.positionAt(m.index), end: textDocument.positionAt(m.index + m[0].length) &#125;, message: `$&#123;m[0]&#125; is all uppercase.`, source: 'ex' &#125;; if (hasDiagnosticRelatedInformationCapability) &#123; diagnostic.relatedInformation = [ &#123; location: &#123; uri: textDocument.uri, range: Object.assign(&#123;&#125;, diagnostic.range) &#125;, message: 'Spelling matters' &#125;, &#123; location: &#123; uri: textDocument.uri, range: Object.assign(&#123;&#125;, diagnostic.range) &#125;, message: 'Particularly for names' &#125; ]; &#125; diagnostics.push(diagnostic); &#125; // Send the computed diagnostics to VSCode. connection.sendDiagnostics(&#123; uri: textDocument.uri, diagnostics &#125;);&#125; è¯Šæ–­æç¤ºå’ŒæŠ€å·§ å¦‚æœèµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ç›¸åŒï¼ŒVS Codeå°†åœ¨è¯¥ä½ç½®ç”¨ä¸€ä¸ªå¼¯æ›²çš„å•è¯ä¸‹åˆ’çº¿ã€‚ å¦‚æœæ‚¨æƒ³åœ¨ä¸€è¡Œçš„æœ«å°¾å¤„ç”¨æ³¢æµªçº¿è¿›è¡Œä¸‹åˆ’çº¿ï¼Œé‚£ä¹ˆè¯·å°†ç»“æŸä½ç½®çš„å­—ç¬¦è®¾ç½®ä¸ºNumber.MAX_VALUEã€‚ è¦è¿è¡Œè¯­è¨€æœåŠ¡å™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ: æŒ‰â‡§âŒ˜Bå¼€å§‹æ„å»ºä»»åŠ¡ã€‚ä»»åŠ¡åŒæ—¶ç¼–è¯‘å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ã€‚ æ‰“å¼€debug viewletï¼Œé€‰æ‹©Launch Client Launch configurationå¹¶æŒ‰ä¸‹Start debugæŒ‰é’®æ¥å¯åŠ¨VSä»£ç çš„é™„åŠ æ‰©å±•å¼€å‘ä¸»æœºå®ä¾‹ï¼Œè¯¥å®ä¾‹æ‰§è¡Œæ‰©å±•ä»£ç ã€‚ åˆ›å»ºä¸€ä¸ªtest.txtæ–‡ä»¶åœ¨æ ¹æ–‡ä»¶å¤¹ä¸­ç²˜è´´å¦‚ä¸‹å†…å®¹: 123TypeScript lets you write JavaScript the way you really want to.TypeScript is a typed superset of JavaScript that compiles to plain JavaScript.ANY browser. ANY host. ANY OS. Open Source. æ‰©å±•å¼€å‘ä¸»æœºå®ä¾‹å°†å¦‚ä¸‹æ‰€ç¤º: è°ƒè¯•å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è°ƒè¯•å®¢æˆ·æœºä»£ç ä¸è°ƒè¯•æ™®é€šæ‰©å±•ä¸€æ ·å®¹æ˜“ã€‚åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è®¾ç½®æ–­ç‚¹å¹¶æŒ‰F5è°ƒè¯•æ‰©å±•ã€‚æœ‰å…³å¯åŠ¨å’Œè°ƒè¯•æ‰©å±•çš„è¯¦ç»†æè¿°ï¼Œè¯·å‚é˜…å¼€å‘æ‰©å±•ã€‚ ç”±äºæœåŠ¡å™¨æ˜¯ç”±æ‰©å±•(å®¢æˆ·æœº)ä¸­è¿è¡Œçš„LanguageClientå¯åŠ¨çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†è°ƒè¯•å™¨é™„åŠ åˆ°è¿è¡Œçš„æœåŠ¡å™¨ä¸Šã€‚ä¸ºæ­¤ï¼Œåˆ‡æ¢åˆ°Debugè§†å›¾å¹¶é€‰æ‹©æœåŠ¡å™¨çš„å¯åŠ¨é…ç½®å¹¶æŒ‰F5ã€‚è¿™å°†æŠŠè°ƒè¯•å™¨é™„åŠ åˆ°æœåŠ¡å™¨ã€‚ å¯¹è¯­è¨€æœåŠ¡å™¨çš„æ—¥å¿—è®°å½•æ”¯æŒå¦‚æœä½¿ç”¨vscode-languageclientå®ç°å®¢æˆ·æœºï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªè®¾ç½®[langId].trace.serverã€‚æŒ‡ç¤ºå®¢æˆ·æœºå°†è¯­è¨€å®¢æˆ·æœº/æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è®°å½•åˆ°è¯­è¨€å®¢æˆ·æœºåç§°çš„é€šé“çš„æœåŠ¡å™¨ã€‚ å¯¹äºlsp-sampleï¼Œæ‚¨å¯ä»¥è®¾ç½®æ­¤è®¾ç½®:&quot;languageServerExample.trace.server&quot;: &quot;verbose&quot;ã€‚ç°åœ¨è½¬åˆ°é¢‘é“â€œè¯­è¨€æœåŠ¡å™¨ç¤ºä¾‹â€ã€‚æ‚¨åº”è¯¥çœ‹åˆ°æ—¥å¿—: ç”±äºè¯­è¨€æœåŠ¡å™¨å¯èƒ½å¾ˆå¥è°ˆ(å®é™…ä½¿ç”¨çš„5ç§’é’Ÿå¯ä»¥äº§ç”Ÿ5000è¡Œæ—¥å¿—)ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä¸€ä¸ªå·¥å…·æ¥å¯è§†åŒ–å’Œè¿‡æ»¤è¯­è¨€å®¢æˆ·æœº/æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚æ‚¨å¯ä»¥å°†é€šé“ä¸­çš„æ‰€æœ‰æ—¥å¿—ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨è¯­è¨€æœåŠ¡å™¨åè®®æ£€æŸ¥å™¨[(https://github.com/microsoft/languageserver-protocol-inspector)åŠ è½½è¯¥æ–‡ä»¶ï¼Œç½‘å€æ˜¯https://microsoft.github.io/languageserver-protocol/inspector)ã€‚ ä½¿ç”¨æœåŠ¡å™¨ä¸­çš„é…ç½®è®¾ç½®åœ¨ç¼–å†™æ‰©å±•çš„å®¢æˆ·ç«¯éƒ¨åˆ†æ—¶ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€ä¸ªè®¾ç½®æ¥æ§åˆ¶æŠ¥å‘Šçš„æœ€å¤§é—®é¢˜æ•°é‡ã€‚æˆ‘ä»¬è¿˜åœ¨æœåŠ¡å™¨ç«¯ç¼–å†™ä»£ç ä»å®¢æˆ·ç«¯è¯»å–è¿™äº›è®¾ç½®: 1234567891011121314function getDocumentSettings(resource: string): Thenable&lt;ExampleSettings&gt; &#123; if (!hasConfigurationCapability) &#123; return Promise.resolve(globalSettings); &#125; let result = documentSettings.get(resource); if (!result) &#123; result = connection.workspace.getConfiguration(&#123; scopeUri: resource, section: 'languageServerExample' &#125;); documentSettings.set(resource, result); &#125; return result;&#125; æˆ‘ä»¬ç°åœ¨éœ€è¦åšçš„å”¯ä¸€ä¸€ä»¶äº‹å°±æ˜¯ç›‘å¬æœåŠ¡å™¨ç«¯çš„é…ç½®æ›´æ”¹ï¼Œå¦‚æœè®¾ç½®æ›´æ”¹ï¼Œåˆ™é‡æ–°éªŒè¯æ‰“å¼€çš„æ–‡æœ¬æ–‡æ¡£ã€‚ä¸ºäº†èƒ½å¤Ÿé‡ç”¨æ–‡æ¡£æ›´æ”¹äº‹ä»¶å¤„ç†çš„éªŒè¯é€»è¾‘ï¼Œæˆ‘ä»¬å°†ä»£ç æå–åˆ°validateTextDocumentå‡½æ•°ä¸­ï¼Œå¹¶ä¿®æ”¹ä»£ç ä»¥æ”¯æŒmaxNumberOfProblemså˜é‡: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546async function validateTextDocument(textDocument: TextDocument): Promise&lt;void&gt; &#123; // In this simple example we get the settings for every validate run. let settings = await getDocumentSettings(textDocument.uri); // The validator creates diagnostics for all uppercase words length 2 and more let text = textDocument.getText(); let pattern = /\\b[A-Z]&#123;2,&#125;\\b/g; let m: RegExpExecArray; let problems = 0; let diagnostics: Diagnostic[] = []; while ((m = pattern.exec(text)) &amp;&amp; problems &lt; settings.maxNumberOfProblems) &#123; problems++; let diagnostic: Diagnostic = &#123; severity: DiagnosticSeverity.Warning, range: &#123; start: textDocument.positionAt(m.index), end: textDocument.positionAt(m.index + m[0].length) &#125;, message: `$&#123;m[0]&#125; is all uppercase.`, source: 'ex' &#125;; if (hasDiagnosticRelatedInformationCapability) &#123; diagnostic.relatedInformation = [ &#123; location: &#123; uri: textDocument.uri, range: Object.assign(&#123;&#125;, diagnostic.range) &#125;, message: 'Spelling matters' &#125;, &#123; location: &#123; uri: textDocument.uri, range: Object.assign(&#123;&#125;, diagnostic.range) &#125;, message: 'Particularly for names' &#125; ]; &#125; diagnostics.push(diagnostic); &#125; // Send the computed diagnostics to VSCode. connection.sendDiagnostics(&#123; uri: textDocument.uri, diagnostics &#125;);&#125; é€šè¿‡å‘è¿æ¥æ·»åŠ é…ç½®æ›´æ”¹çš„é€šçŸ¥å¤„ç†ç¨‹åºï¼Œå¯ä»¥å®Œæˆé…ç½®æ›´æ”¹çš„å¤„ç†ã€‚å¯¹åº”çš„ä»£ç å¦‚ä¸‹: 12345678910111213connection.onDidChangeConfiguration(change =&gt; &#123; if (hasConfigurationCapability) &#123; // Reset all cached document settings documentSettings.clear(); &#125; else &#123; globalSettings = &lt;ExampleSettings&gt;( (change.settings.languageServerExample || defaultSettings) ); &#125; // Revalidate all open text documents documents.all().forEach(validateTextDocument);&#125;); å†æ¬¡å¯åŠ¨å®¢æˆ·ç«¯ï¼Œå¹¶å°†è®¾ç½®æ›´æ”¹ä¸ºæœ€å¤§æŠ¥è¡¨1ï¼Œå°†å¯¼è‡´ä»¥ä¸‹éªŒè¯: æ·»åŠ é¢å¤–çš„è¯­è¨€ç‰¹æ€§è¯­è¨€æœåŠ¡å™¨é€šå¸¸å®ç°çš„ç¬¬ä¸€ä¸ªæœ‰è¶£ç‰¹æ€§æ˜¯æ–‡æ¡£éªŒè¯ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œç”šè‡³è¿æ£‰ç»’éƒ½å¯ä»¥ç®—ä½œè¯­è¨€æœåŠ¡å™¨ï¼Œè€Œåœ¨VSä¸­ï¼Œä»£ç æ£‰ç»’é€šå¸¸è¢«å®ç°ä¸ºè¯­è¨€æœåŠ¡å™¨(è¯·å‚é˜…eslintå’Œjshintç¤ºä¾‹)ã€‚ä½†æ˜¯è¯­è¨€æœåŠ¡å™¨è¿˜æœ‰æ›´å¤šçš„åŠŸèƒ½ã€‚å®ƒä»¬å¯ä»¥æä¾›ä»£ç å®Œæˆã€æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨æˆ–è½¬åˆ°Definitionã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å°†ä»£ç å®Œæˆæ·»åŠ åˆ°æœåŠ¡å™¨ã€‚å®ƒæå‡ºäº†ä¸¤ä¸ªè¯â€œTypeScriptâ€å’Œâ€œJavaScriptâ€ã€‚ 1234567891011121314151617181920212223242526272829303132333435// This handler provides the initial list of the completion items.connection.onCompletion( (_textDocumentPosition: TextDocumentPositionParams): CompletionItem[] =&gt; &#123; // The pass parameter contains the position of the text document in // which code complete got requested. For the example we ignore this // info and always provide the same completion items. return [ &#123; label: 'TypeScript', kind: CompletionItemKind.Text, data: 1 &#125;, &#123; label: 'JavaScript', kind: CompletionItemKind.Text, data: 2 &#125; ]; &#125;);// This handler resolve additional information for the item selected in// the completion list.connection.onCompletionResolve( (item: CompletionItem): CompletionItem =&gt; &#123; if (item.data === 1) &#123; (item.detail = 'TypeScript details'), (item.documentation = 'TypeScript documentation'); &#125; else if (item.data === 2) &#123; (item.detail = 'JavaScript details'), (item.documentation = 'JavaScript documentation'); &#125; return item; &#125;); dataå­—æ®µç”¨äºæƒŸä¸€åœ°æ ‡è¯†è§£æå¤„ç†ç¨‹åºä¸­çš„å®Œæˆé¡¹ã€‚æ•°æ®å±æ€§å¯¹åè®®æ˜¯é€æ˜çš„ã€‚ç”±äºåº•å±‚æ¶ˆæ¯ä¼ é€’åè®®æ˜¯åŸºäºJSONçš„ï¼Œå› æ­¤æ•°æ®å­—æ®µåº”è¯¥åªä¿å­˜å¯åºåˆ—åŒ–çš„JSONå’Œå¯åºåˆ—åŒ–çš„JSONæ•°æ®ã€‚ æ‰€ç¼ºå°‘çš„å°±æ˜¯å‘Šè¯‰VS CodeæœåŠ¡å™¨æ”¯æŒä»£ç å®Œæˆè¯·æ±‚ã€‚ä¸ºæ­¤ï¼Œåœ¨initializeå¤„ç†å™¨ä¸­æ ‡è®°ç›¸åº”çš„åŠŸèƒ½: 123456789101112connection.onInitialize((params): InitializeResult =&gt; &#123; ... return &#123; capabilities: &#123; ... // Tell the client that the server supports code completion completionProvider: &#123; resolveProvider: true &#125; &#125; &#125;;&#125;); ä¸‹é¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºäº†è¿è¡Œåœ¨çº¯æ–‡æœ¬æ–‡ä»¶ä¸Šçš„å®Œæ•´ä»£ç : è¯­è¨€æµ‹è¯•æœåŠ¡å™¨è¦åˆ›å»ºé«˜è´¨é‡çš„è¯­è¨€æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªè¦†ç›–å…¶åŠŸèƒ½çš„è‰¯å¥½æµ‹è¯•å¥—ä»¶ã€‚æœ‰ä¸¤ç§æµ‹è¯•è¯­è¨€æœåŠ¡å™¨çš„å¸¸è§æ–¹æ³•: å•å…ƒæµ‹è¯•:å¦‚æœæ‚¨æƒ³é€šè¿‡æ¨¡æ‹Ÿå‘é€ç»™è¯­è¨€æœåŠ¡å™¨çš„æ‰€æœ‰ä¿¡æ¯æ¥æµ‹è¯•è¯­è¨€æœåŠ¡å™¨ä¸­çš„ç‰¹å®šåŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚VSä»£ç çš„HTML / CSS / JSONè¯­è¨€æœåŠ¡å™¨é‡‡ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚LSP npmæ¨¡å—æœ¬èº«ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚æœ‰å…³ä½¿ç”¨npmåè®®æ¨¡å—ç¼–å†™çš„å•å…ƒæµ‹è¯•ï¼Œè¯·å‚é˜…æ­¤å¤„ã€‚ ç«¯åˆ°ç«¯æµ‹è¯•:è¿™ç±»ä¼¼äºVS Codeæ‰©å±•æµ‹è¯•ã€‚è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œå®ƒé€šè¿‡ä½¿ç”¨å·¥ä½œåŒºå®ä¾‹åŒ–VSä»£ç å®ä¾‹ã€æ‰“å¼€æ–‡ä»¶ã€æ¿€æ´»è¯­è¨€å®¢æˆ·æœº/æœåŠ¡å™¨å’Œè¿è¡ŒVS Codeå‘½ä»¤æ¥è¿è¡Œæµ‹è¯•ã€‚å¦‚æœæ‚¨æœ‰å¾ˆéš¾æˆ–ä¸å¯èƒ½æ¨¡æ‹Ÿçš„æ–‡ä»¶ã€è®¾ç½®æˆ–ä¾èµ–é¡¹(å¦‚node_modules)ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•ä¼šæ›´å¥½ã€‚æµè¡Œçš„Pythonæ‰©å±•é‡‡ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚ å¯ä»¥åœ¨æ‚¨é€‰æ‹©çš„ä»»ä½•æµ‹è¯•æ¡†æ¶ä¸­è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æè¿°äº†å¦‚ä½•å¯¹è¯­è¨€æœåŠ¡å™¨æ‰©å±•è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚ æ‰“å¼€ .vscode/launch.jsonï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°E2Eæµ‹è¯•ç›®æ ‡: 1234567891011121314&#123; \"name\": \"Language Server E2E Test\", \"type\": \"extensionHost\", \"request\": \"launch\", \"runtimeExecutable\": \"$&#123;execPath&#125;\", \"args\": [ \"--extensionDevelopmentPath=$&#123;workspaceRoot&#125;\", \"--extensionTestsPath=$&#123;workspaceRoot&#125;/client/out/test\", \"$&#123;workspaceRoot&#125;/client/testFixture\" ], \"stopOnEntry\": false, \"sourceMaps\": true, \"outFiles\": [\"$&#123;workspaceRoot&#125;/client/out/test/**/*.js\"]&#125; å¦‚æœæ‚¨è¿è¡Œè¿™ä¸ªè°ƒè¯•ç›®æ ‡ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªVSä»£ç å®ä¾‹ï¼Œclient/testFixtureä½œä¸ºæ´»åŠ¨å·¥ä½œåŒºã€‚VSä»£ç å°†ç»§ç»­æ‰§è¡Œ client/src/testä¸­çš„æ‰€æœ‰æµ‹è¯•ã€‚ä½œä¸ºä¸€ä¸ªè°ƒè¯•æŠ€å·§ï¼Œæ‚¨å¯ä»¥åœ¨client/src/testä¸­çš„TypeScriptæ–‡ä»¶ä¸­è®¾ç½®æ–­ç‚¹ï¼Œå®ƒä»¬å°†è¢«å‘½ä¸­ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹completion.test.tsæ–‡ä»¶: 1234567891011121314151617181920212223242526272829303132333435363738import * as vscode from 'vscode';import * as assert from 'assert';import &#123; getDocUri, activate &#125; from './helper';describe('Should do completion', () =&gt; &#123; const docUri = getDocUri('completion.txt'); it('Completes JS/TS in txt file', async () =&gt; &#123; await testCompletion(docUri, new vscode.Position(0, 0), &#123; items: [ &#123; label: 'JavaScript', kind: vscode.CompletionItemKind.Text &#125;, &#123; label: 'TypeScript', kind: vscode.CompletionItemKind.Text &#125; ] &#125;); &#125;);&#125;);async function testCompletion( docUri: vscode.Uri, position: vscode.Position, expectedCompletionList: vscode.CompletionList) &#123; await activate(docUri); // Executing the command `vscode.executeCompletionItemProvider` to simulate triggering completion const actualCompletionList = (await vscode.commands.executeCommand( 'vscode.executeCompletionItemProvider', docUri, position )) as vscode.CompletionList; assert.equal(actualCompletionList.items.length, expectedCompletionList.items.length); expectedCompletionList.items.forEach((expectedItem, i) =&gt; &#123; const actualItem = actualCompletionList.items[i]; assert.equal(actualItem.label, expectedItem.label); assert.equal(actualItem.kind, expectedItem.kind); &#125;);&#125; åœ¨è¿™ä¸ªæµ‹è¯•ä¸­,æˆ‘ä»¬: æ¿€æ´»æ‰©å±•ã€‚ ä½¿ç”¨URIå’Œä½ç½®è¿è¡Œå‘½ä»¤vscode.executeCompletionItemProviderï¼Œä»¥æ¨¡æ‹Ÿå®Œæˆè§¦å‘å™¨ã€‚ å¯¹æˆ‘ä»¬æœŸæœ›çš„å®Œæˆé¡¹æ–­è¨€è¿”å›çš„å®Œæˆé¡¹ã€‚ è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹activate(docURI)å‡½æ•°ã€‚å®¢æˆ·ç«¯/src/test/helper.ts: 123456789101112131415161718192021222324252627import * as vscode from 'vscode';import * as path from 'path';export let doc: vscode.TextDocument;export let editor: vscode.TextEditor;export let documentEol: string;export let platformEol: string;/** * Activates the vscode.lsp-sample extension */export async function activate(docUri: vscode.Uri) &#123; // The extensionId is `publisher.name` from package.json const ext = vscode.extensions.getExtension('vscode.lsp-sample'); await ext.activate(); try &#123; doc = await vscode.workspace.openTextDocument(docUri); editor = await vscode.window.showTextDocument(doc); await sleep(2000); // Wait for server activation &#125; catch (e) &#123; console.error(e); &#125;&#125;async function sleep(ms: number) &#123; return new Promise(resolve =&gt; setTimeout(resolve, ms));&#125; åœ¨æ¿€æ´»éƒ¨åˆ†ï¼Œæˆ‘ä»¬: ä½¿ç”¨package.jsonä¸­å®šä¹‰çš„{publisher.name}.{extensionId}è·å¾—æ‰©å±•ã€‚ æ‰“å¼€æŒ‡å®šçš„æ–‡æ¡£ï¼Œå¹¶åœ¨æ´»åŠ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºå®ƒã€‚ ä¼‘çœ 2ç§’é’Ÿï¼Œå› æ­¤æˆ‘ä»¬ç¡®ä¿¡è¯­è¨€æœåŠ¡å™¨å·²å®ä¾‹åŒ–ã€‚ åœ¨å‡†å¤‡ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸æ¯ç§è¯­è¨€ç‰¹æ€§å¯¹åº”çš„VSä»£ç å‘½ä»¤ï¼Œå¹¶å¯¹è¿”å›çš„ç»“æœè¿›è¡Œæ–­è¨€ã€‚ è¿˜æœ‰ä¸€ä¸ªæµ‹è¯•æ¶µç›–äº†æˆ‘ä»¬åˆšåˆšå®ç°çš„è¯Šæ–­ç‰¹æ€§ã€‚åœ¨client/src/test/diagnostics.test.tsä¸­æŸ¥çœ‹ã€‚ é«˜çº§çš„ä¸»é¢˜åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ¬æŒ‡å—åŒ…æ‹¬: ç®€è¦æ¦‚è¿°è¯­è¨€æœåŠ¡å™¨å’Œè¯­è¨€æœåŠ¡å™¨åè®®ã€‚ VS Codeä¸­è¯­è¨€æœåŠ¡å™¨æ‰©å±•çš„ä½“ç³»ç»“æ„ lspç¤ºä¾‹æ‰©å±•ï¼Œä»¥åŠå¦‚ä½•å¼€å‘/è°ƒè¯•/æ£€æŸ¥/æµ‹è¯•å®ƒã€‚ è¿˜æœ‰ä¸€äº›æ›´é«˜çº§çš„è¯é¢˜ï¼Œæˆ‘ä»¬æ— æ³•é€‚åº”è¿™ä¸ªæŒ‡å—ã€‚æˆ‘ä»¬å°†åŒ…æ‹¬è¿™äº›èµ„æºçš„é“¾æ¥ï¼Œä»¥è¿›ä¸€æ­¥ç ”ç©¶è¯­è¨€æœåŠ¡å™¨å¼€å‘ã€‚ å…¶ä»–è¯­è¨€çš„æœåŠ¡å™¨åŠŸèƒ½è¯­è¨€æœåŠ¡å™¨ç›®å‰æ”¯æŒä»¥ä¸‹è¯­è¨€ç‰¹æ€§ä»¥åŠä»£ç å®Œæˆ: æ–‡æ¡£é«˜äº®æ˜¾ç¤º:é«˜äº®æ˜¾ç¤ºæ–‡æœ¬æ–‡æ¡£ä¸­æ‰€æœ‰â€œç›¸ç­‰â€çš„ç¬¦å·ã€‚ æ‚¬åœ:ä¸ºæ–‡æœ¬æ–‡æ¡£ä¸­é€‰æ‹©çš„ç¬¦å·æä¾›æ‚¬åœä¿¡æ¯ã€‚ ç­¾åå¸®åŠ©:ä¸ºæ–‡æœ¬æ–‡æ¡£ä¸­é€‰æ‹©çš„ç¬¦å·æä¾›ç­¾åå¸®åŠ©ã€‚ G-otoå®šä¹‰:ä¸ºæ–‡æœ¬æ–‡æ¡£ä¸­é€‰æ‹©çš„ç¬¦å·æä¾›go - toå®šä¹‰æ”¯æŒã€‚ è½¬åˆ°ç±»å‹å®šä¹‰:ä¸ºæ–‡æœ¬æ–‡æ¡£ä¸­é€‰æ‹©çš„ç¬¦å·æä¾›è½¬åˆ°ç±»å‹/æ¥å£å®šä¹‰æ”¯æŒã€‚ Gotoå®ç°:ä¸ºæ–‡æœ¬æ–‡æ¡£ä¸­é€‰æ‹©çš„ç¬¦å·æä¾›go toå®ç°å®šä¹‰æ”¯æŒã€‚ æŸ¥æ‰¾å¼•ç”¨:æŸ¥æ‰¾æ–‡æœ¬æ–‡æ¡£ä¸­æ‰€é€‰ç¬¦å·çš„æ‰€æœ‰é¡¹ç›®èŒƒå›´çš„å¼•ç”¨ã€‚ åˆ—å‡ºæ–‡æ¡£ç¬¦å·:åˆ—å‡ºæ–‡æœ¬æ–‡æ¡£ä¸­å®šä¹‰çš„æ‰€æœ‰ç¬¦å·ã€‚ åˆ—è¡¨å·¥ä½œåŒºç¬¦å·:åˆ—å‡ºæ‰€æœ‰é¡¹ç›®èŒƒå›´çš„ç¬¦å·ã€‚ ä»£ç æ“ä½œ:ä¸ºç»™å®šçš„æ–‡æœ¬æ–‡æ¡£å’ŒèŒƒå›´è¿è¡Œè®¡ç®—å‘½ä»¤(é€šå¸¸æ˜¯ç¾åŒ–/é‡æ„)ã€‚ CodeLens:è®¡ç®—ç»™å®šæ–‡æœ¬æ–‡æ¡£çš„CodeLensç»Ÿè®¡æ•°æ®ã€‚ æ–‡æ¡£æ ¼å¼:è¿™åŒ…æ‹¬å¯¹æ•´ä¸ªæ–‡æ¡£çš„æ ¼å¼ã€æ–‡æ¡£èŒƒå›´å’Œç±»å‹çš„æ ¼å¼ã€‚ é‡å‘½å:é¡¹ç›®èŒƒå›´å†…çš„ç¬¦å·é‡å‘½åã€‚ æ–‡æ¡£é“¾æ¥:è®¡ç®—å’Œè§£ææ–‡æ¡£ä¸­çš„é“¾æ¥ã€‚ æ–‡æ¡£é¢œè‰²:åœ¨æ–‡æ¡£ä¸­è®¡ç®—å’Œè§£æé¢œè‰²ï¼Œä»¥ä¾¿åœ¨ç¼–è¾‘å™¨ä¸­æä¾›é¢œè‰²é€‰æ‹©å™¨ã€‚ è¯­è¨€æ‰©å±•æŒ‡å—ä¸»é¢˜æè¿°äº†ä¸Šé¢çš„æ¯ç§è¯­è¨€ç‰¹æ€§ï¼Œå¹¶æä¾›äº†å…³äºå¦‚ä½•é€šè¿‡è¯­è¨€æœåŠ¡å™¨åè®®æˆ–ç›´æ¥ä½¿ç”¨æ‰©å±•çš„å¯æ‰©å±•æ€§APIæ¥å®ç°å®ƒä»¬çš„æŒ‡å¯¼ã€‚ å¢é‡æ–‡æœ¬æ–‡æ¡£åŒæ­¥è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨vscode-languageserveræ¨¡å—æä¾›çš„ç®€å•æ–‡æœ¬æ–‡æ¡£ç®¡ç†å™¨æ¥åŒæ­¥VSä»£ç å’Œè¯­è¨€æœåŠ¡å™¨ä¹‹é—´çš„æ–‡æ¡£ã€‚ è¿™æœ‰ä¸¤ä¸ªç¼ºç‚¹: ç”±äºæ–‡æœ¬æ–‡æ¡£çš„å…¨éƒ¨å†…å®¹è¢«åå¤å‘é€åˆ°æœåŠ¡å™¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¤§é‡çš„æ•°æ®ä¼ è¾“ã€‚ å¦‚æœä½¿ç”¨ç°æœ‰çš„è¯­è¨€åº“ï¼Œè¿™äº›åº“é€šå¸¸æ”¯æŒå¢é‡æ–‡æ¡£æ›´æ–°ï¼Œä»¥é¿å…ä¸å¿…è¦çš„è§£æå’ŒæŠ½è±¡è¯­æ³•æ ‘åˆ›å»ºã€‚ å› æ­¤ï¼Œåè®®ä¹Ÿæ”¯æŒå¢é‡æ–‡æ¡£åŒæ­¥ã€‚ è¦ä½¿ç”¨å¢é‡æ–‡æ¡£åŒæ­¥ï¼ŒæœåŠ¡å™¨éœ€è¦å®‰è£…ä¸‰ä¸ªé€šçŸ¥å¤„ç†ç¨‹åº: onDidOpenTextDocument:åœ¨VSä»£ç ä¸­æ‰“å¼€æ–‡æœ¬æ–‡æ¡£æ—¶è°ƒç”¨ã€‚ onDidChangeTextDocument:åœ¨VSä»£ç ä¸­æ–‡æœ¬æ–‡æ¡£çš„å†…å®¹å‘ç”Ÿæ›´æ”¹æ—¶è°ƒç”¨ã€‚ onDidCloseTextDocument:å½“VSä»£ç ä¸­å…³é—­æ–‡æœ¬æ–‡æ¡£æ—¶è°ƒç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä»£ç ç‰‡æ®µï¼Œæ¼”ç¤ºäº†å¦‚ä½•å°†è¿™äº›é€šçŸ¥å¤„ç†ç¨‹åºä¸è¿æ¥æŒ‚é’©ï¼Œä»¥åŠå¦‚ä½•åœ¨initializeä¸Šè¿”å›æ­£ç¡®çš„åŠŸèƒ½: 123456789101112131415161718192021222324252627connection.onInitialize((params): InitializeResult =&gt; &#123; ... return &#123; capabilities: &#123; // Enable incremental document sync textDocumentSync: TextDocumentSyncKind.Incremental, ... &#125; &#125;;&#125;);connection.onDidOpenTextDocument((params) =&gt; &#123; // A text document was opened in VS Code. // params.uri uniquely identifies the document. For documents stored on disk, this is a file URI. // params.text the initial full content of the document.&#125;);connection.onDidChangeTextDocument((params) =&gt; &#123; // The content of a text document has change in VS Code. // params.uri uniquely identifies the document. // params.contentChanges describe the content changes to the document.&#125;);connection.onDidCloseTextDocument((params) =&gt; &#123; // A text document was closed in VS Code. // params.uri uniquely identifies the document.&#125;); ç›´æ¥ä½¿ç”¨VSä»£ç APIå®ç°è¯­è¨€ç‰¹æ€§è™½ç„¶è¯­è¨€æœåŠ¡å™¨æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯æ‰©å±•VSä»£ç ç¼–è¾‘åŠŸèƒ½çš„å”¯ä¸€é€‰æ‹©ã€‚å¦‚æœæ‚¨æƒ³ä¸ºä¸€ç§æ–‡æ¡£ç±»å‹æ·»åŠ ä¸€äº›ç®€å•çš„è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨vscode.languages.register[LANGUAGE_FEATURE]Providerä½œä¸ºé€‰é¡¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨vscode.languagesçš„å®Œæ•´ç¤ºä¾‹ã€‚registerCompletionItemProvideræ·»åŠ ä¸€äº›ç‰‡æ®µä½œä¸ºçº¯æ–‡æœ¬æ–‡ä»¶çš„è¡¥å……ã€‚ æ›´å¤šè¯´æ˜VSä»£ç APIç”¨æ³•çš„ç¤ºä¾‹å¯ä»¥åœ¨https://github.com/Microsoft/vscode-extension-samplesæ‰¾åˆ°ã€‚ è¯­è¨€æœåŠ¡å™¨çš„å®¹é”™è§£æå™¨å¤§å¤šæ•°æ—¶å€™ï¼Œç¼–è¾‘å™¨ä¸­çš„ä»£ç æ˜¯ä¸å®Œæ•´çš„ï¼Œåœ¨è¯­æ³•ä¸Šæ˜¯ä¸æ­£ç¡®çš„ï¼Œä½†æ˜¯å¼€å‘äººå‘˜ä»ç„¶å¸Œæœ›è‡ªåŠ¨å®Œæˆå’Œå…¶ä»–è¯­è¨€ç‰¹æ€§èƒ½å¤Ÿå·¥ä½œã€‚å› æ­¤ï¼Œè¯­è¨€æœåŠ¡å™¨éœ€è¦ä¸€ä¸ªå®¹é”™è§£æå™¨:è§£æå™¨ä»éƒ¨åˆ†å®Œæ•´çš„ä»£ç ç”Ÿæˆæœ‰æ„ä¹‰çš„ASTï¼Œè¯­è¨€æœåŠ¡å™¨æ ¹æ®ASTæä¾›è¯­è¨€ç‰¹æ€§ã€‚ å½“æˆ‘ä»¬åœ¨VSä»£ç ä¸­æ”¹è¿›PHPæ”¯æŒæ—¶ï¼Œæˆ‘ä»¬æ„è¯†åˆ°å®˜æ–¹PHPè§£æå™¨ä¸èƒ½å®¹å¿é”™è¯¯ï¼Œä¸èƒ½åœ¨è¯­è¨€æœåŠ¡å™¨ä¸­ç›´æ¥é‡ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç ”ç©¶äº†Microsoft/ tolerance -phpè§£æå™¨ï¼Œå¹¶ç•™ä¸‹äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œè¿™äº›æ³¨é‡Šå¯èƒ½æœ‰åŠ©äºéœ€è¦å®ç°å®¹é”™è§£æå™¨çš„è¯­è¨€æœåŠ¡å™¨ä½œè€…ã€‚ å¸¸è§é—®é¢˜å½“æˆ‘è¯•å›¾è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘å¾—åˆ°â€œä¸èƒ½è¿æ¥åˆ°è¿è¡Œæ—¶è¿›ç¨‹(5000æ¯«ç§’åè¶…æ—¶)â€? å¦‚æœè¯•å›¾é™„åŠ è°ƒè¯•å™¨æ—¶æœåŠ¡å™¨æ²¡æœ‰è¿è¡Œï¼Œæ‚¨å°†çœ‹åˆ°è¿™ä¸ªè¶…æ—¶é”™è¯¯ã€‚å®¢æˆ·ç«¯å¯åŠ¨è¯­è¨€æœåŠ¡å™¨ï¼Œæ‰€ä»¥ç¡®ä¿æ‚¨å·²ç»å¯åŠ¨äº†å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿æ‹¥æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ã€‚å¦‚æœå®¢æˆ·ç«¯æ–­ç‚¹å¹²æ‰°å¯åŠ¨æœåŠ¡å™¨ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦ç¦ç”¨å®ƒä»¬ã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"}]},{"title":"ä¾‹å­â€”â€”å•è¯è®¡æ•°","slug":"vscode-extensions-3","date":"2018-08-11T07:08:46.000Z","updated":"2020-07-25T02:57:18.230Z","comments":true,"path":"2018/08/11/vscode-extensions-3/","link":"","permalink":"https://jigangduan.github.io/2018/08/11/vscode-extensions-3/","excerpt":"","text":"æœ¬æ–‡æ¡£å‡è®¾æ‚¨å·²ç»é˜…è¯»äº†ç¬¬ä¸€ä¸ªæ‰©å±•ï¼Œå®ƒæ¶µç›–äº†VS Codeå¯æ‰©å±•æ€§çš„åŸºç¡€çŸ¥è¯†ã€‚ å•è¯è®¡æ•°æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯æ•™ç¨‹ï¼Œå‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ‰©å±•æ¥å¸®åŠ©Markdownåˆ›ä½œã€‚åœ¨æˆ‘ä»¬æ·±å…¥äº†è§£æ‰€æœ‰è¿™äº›å·¥ä½œåŸç†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¿«é€Ÿæ¼”ç¤ºä¸€ä¸‹æ‚¨å°†è¦æ„å»ºçš„æ ¸å¿ƒç‰¹æ€§ï¼Œè¿™æ ·æ‚¨å°±çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆäº†ã€‚ æ— è®ºä½•æ—¶ç¼–è¾‘æ ‡è®°æ–‡ä»¶ï¼Œéƒ½ä¼šæ·»åŠ çŠ¶æ€æ æ¶ˆæ¯ã€‚è¯¥æ¶ˆæ¯åŒ…æ‹¬å½“å‰çš„å­—æ•°å’Œæ›´æ–°ï¼Œå½“æ‚¨é”®å…¥å’Œç§»åŠ¨åˆ°æ–‡ä»¶: æç¤º:å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ä»GitHubå­˜å‚¨åº“ä¸­è·å¾—å®Œæˆçš„ç¤ºä¾‹ã€‚ æ¦‚è¿°è¿™ä¸ªç¤ºä¾‹æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå°†å¸¦æ‚¨äº†è§£ä¸€ç³»åˆ—ç›¸å…³æ¦‚å¿µ: æ›´æ–°çŠ¶æ€æ -åœ¨VSä»£ç çŠ¶æ€æ ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰æ–‡æœ¬è®¢é˜…äº‹ä»¶â€”â€”æ ¹æ®ç¼–è¾‘äº‹ä»¶æ›´æ–°çŠ¶æ€æ é…ç½®æ‰©å±•èµ„æºâ€”â€”é‡Šæ”¾äº‹ä»¶è®¢é˜…æˆ–UIå¥æŸ„ç­‰èµ„æº é¦–å…ˆç¡®ä¿å®‰è£…äº†æœ€æ–°çš„VS Codeæ‰©å±•ç”Ÿæˆå™¨ï¼Œç„¶åè¿è¡Œå®ƒ: 12npm install -g yo generator-codeyo code è¿™å°†æ‰“å¼€æ‰©å±•ç”Ÿæˆå™¨â€”â€”æˆ‘ä»¬å°†ä»¥TypeScript Newæ‰©å±•é€‰é¡¹ä¸ºåŸºç¡€ã€‚ç°åœ¨ï¼ŒæŒ‰ç…§æ‚¨åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°çš„æ–¹æ³•å¡«å†™å­—æ®µ(ä½¿ç”¨â€™WordCountâ€™ä½œä¸ºæ‰©å±•åï¼Œæ‚¨è‡ªå·±çš„åå­—ä½œä¸ºå‘å¸ƒè€…)ã€‚ ä½ ç°åœ¨å¯ä»¥æ‰“å¼€VS Codeåœ¨ç”Ÿæˆå™¨è¾“å‡ºæè¿°: 12cd WordCountcode . è¿è¡Œæ‰©å±•åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‰F5æ¥è¿è¡Œæ‰©å±•ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚æ­£å¦‚æ‚¨åœ¨å‰é¢çš„â€œHello Worldâ€æ¼”ç»ƒä¸­çœ‹åˆ°çš„ï¼ŒVSä»£ç æ‰“å¼€äº†å¦ä¸€ä¸ªçª—å£([æ‰©å±•å¼€å‘ä¸»æœº]çª—å£)ï¼Œåœ¨è¿™ä¸ªçª—å£ä¸­æ‚¨çš„æ‰©å±•å°†è¢«åŠ è½½ã€‚ä½ åº”è¯¥æ‰¾â€œHello Worldâ€å‘½ä»¤åœ¨å‘½ä»¤é¢æ¿ä¸­(æŒ‰â‡§âŒ˜P),å½“ä½ é€‰æ‹©å®ƒ,æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªé€šçŸ¥åœ¨çª—å£çš„å³ä¸‹è§’è¯´â€œHello World !â€ã€‚ æ—¢ç„¶æ‚¨å·²ç»ç¡®è®¤äº†æ‰©å±•æ­£åœ¨æ­£ç¡®åœ°è¿è¡Œï¼Œé‚£ä¹ˆå¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨å¯ä»¥ç»§ç»­æ‰“å¼€æ‰©å±•å¼€å‘çª—å£ã€‚è¦æµ‹è¯•æ‚¨å¯¹æ‰©å±•æ‰€åšçš„ä»»ä½•æ›´æ”¹ï¼Œæ‚¨å¯ä»¥åœ¨å¼€å‘çª—å£ä¸­å†æ¬¡æŒ‰F5ï¼Œæˆ–è€…é€šè¿‡æŒ‰Ctrl+R (macOS: Cmd+R)é‡æ–°åŠ è½½æ‰©å±•å¼€å‘çª—å£ã€‚ æ›´æ–°çŠ¶æ€æ ç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢ç”Ÿæˆçš„extension.tsæ–‡ä»¶çš„å†…å®¹ã€‚å®ƒå£°æ˜å¹¶å®ä¾‹åŒ–ä¸€ä¸ªWordCounterç±»ï¼Œè¯¥ç±»å¯ä»¥è®¡æ•°å•è¯ï¼Œå¹¶åœ¨VSä»£ç çŠ¶æ€æ ä¸­æ˜¾ç¤ºå®ƒä»¬ã€‚â€œHello Wordâ€å‘½ä»¤åœ¨è°ƒç”¨æ—¶å°†è°ƒç”¨updateWordCountã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970// The module 'vscode' contains the VS Code extensibility API// Import the necessary extensibility types to use in your code belowimport &#123;window, commands, Disposable, ExtensionContext, StatusBarAlignment, StatusBarItem, TextDocument&#125; from 'vscode';// This method is called when your extension is activated. Activation is// controlled by the activation events defined in package.json.export function activate(context: ExtensionContext) &#123; // Use the console to output diagnostic information (console.log) and errors (console.error). // This line of code will only be executed once when your extension is activated. console.log('Congratulations, your extension \"WordCount\" is now active!'); // create a new word counter let wordCounter = new WordCounter(); let disposable = commands.registerCommand('extension.sayHello', () =&gt; &#123; wordCounter.updateWordCount(); &#125;); // Add to a list of disposables which are disposed when this extension is deactivated. context.subscriptions.push(wordCounter); context.subscriptions.push(disposable);&#125;class WordCounter &#123; private _statusBarItem: StatusBarItem = window.createStatusBarItem(StatusBarAlignment.Left); public updateWordCount() &#123; // Get the current text editor let editor = window.activeTextEditor; if (!editor) &#123; this._statusBarItem.hide(); return; &#125; let doc = editor.document; // Only update status if an Markdown file if (doc.languageId === \"markdown\") &#123; let wordCount = this._getWordCount(doc); // Update the status bar this._statusBarItem.text = wordCount !== 1 ? `$&#123;wordCount&#125; Words` : '1 Word'; this._statusBarItem.show(); &#125; else &#123; this._statusBarItem.hide(); &#125; &#125; public _getWordCount(doc: TextDocument): number &#123; let docContent = doc.getText(); // Parse out unwanted whitespace so the split is accurate docContent = docContent.replace(/(&lt; ([^&gt;]+)&lt;)/g, '').replace(/\\s+/g, ' '); docContent = docContent.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, ''); let wordCount = 0; if (docContent !== \"\") &#123; wordCount = docContent.split(\" \").length; &#125; return wordCount; &#125; dispose() &#123; this._statusBarItem.dispose(); &#125;&#125; ç°åœ¨è®©æˆ‘ä»¬å°è¯•å¯¹æ‰©å±•çš„æ›´æ–°ã€‚ æˆ‘ä»¬å°†TypeScriptæ–‡ä»¶çš„ç¼–è¯‘è®¾ç½®åœ¨ä¸€ä¸ªæ‰‹è¡¨ä¸Š(æ‰©å±•åæ˜¯.vscode\\tasks.jsonæ–‡ä»¶)ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡æ–°æ„å»ºã€‚åœ¨[æ‰©å±•å¼€å‘ä¸»æœº]çª—å£ä¸­æŒ‰Ctrl+Ré”®ï¼Œæ‚¨çš„ä»£ç æ­£åœ¨è¿è¡Œï¼Œæ‰©å±•å°†é‡æ–°åŠ è½½(æ‚¨ä¹Ÿå¯ä»¥ä»æ‚¨çš„ä¸»å¼€å‘çª—å£F5)ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦åƒä»¥å‰ä¸€æ ·ä½¿ç”¨â€œHello Worldâ€å‘½ä»¤æ¿€æ´»ä»£ç ã€‚å‡è®¾æ‚¨åœ¨ä¸€ä¸ªæ ‡è®°æ–‡ä»¶ä¸­ï¼Œæ‚¨çš„çŠ¶æ€æ å°†æ˜¾ç¤ºå•è¯è®¡æ•°ã€‚ è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ï¼Œä½†å¦‚æœè®¡æ•°éšç€æ–‡ä»¶çš„æ›´æ”¹è€Œæ›´æ–°ï¼Œä¼šæ›´é…·ã€‚ è®¢é˜…äº‹ä»¶è®©æˆ‘ä»¬å°†åŠ©æ‰‹ç±»ä¸ä¸€ç»„äº‹ä»¶æŒ‚é’©ã€‚ onDidChangeTextEditorSelection -å½“æ¸¸æ ‡ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶å°†å¼•å‘äº‹ä»¶ onDidChangeActiveTextEditorâ€”å½“æ´»åŠ¨ç¼–è¾‘å™¨æ›´æ”¹æ—¶å¼•å‘äº‹ä»¶ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨extension.tsæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°ç±»ã€‚å®ƒå°†è®¾ç½®è¿™äº›äº‹ä»¶çš„è®¢é˜…ï¼Œå¹¶è¦æ±‚WordCounteræ›´æ–°å•è¯è®¡æ•°ã€‚è¿˜è¦æ³¨æ„è¿™ä¸ªç±»å¦‚ä½•å°†è®¢é˜…ç®¡ç†ä¸ºå¯ä¸¢å¼ƒçš„ï¼Œä»¥åŠå¦‚ä½•åœ¨è‡ªè¡Œå¤„ç†æ—¶åœæ­¢åˆ—å‡ºã€‚ å°†ä¸‹é¢æ‰€ç¤ºçš„WordCounterControlleræ·»åŠ åˆ°extension.tsæ–‡ä»¶çš„åº•éƒ¨ã€‚ 12345678910111213141516171819202122232425262728class WordCounterController &#123; private _wordCounter: WordCounter; private _disposable: Disposable; constructor(wordCounter: WordCounter) &#123; this._wordCounter = wordCounter; // subscribe to selection change and editor activation events let subscriptions: Disposable[] = []; window.onDidChangeTextEditorSelection(this._onEvent, this, subscriptions); window.onDidChangeActiveTextEditor(this._onEvent, this, subscriptions); // update the counter for the current file this._wordCounter.updateWordCount(); // create a combined disposable from both event subscriptions this._disposable = Disposable.from(...subscriptions); &#125; dispose() &#123; this._disposable.dispose(); &#125; private _onEvent() &#123; this._wordCounter.updateWordCount(); &#125;&#125; æˆ‘ä»¬ä¸å†å¸Œæœ›åœ¨è°ƒç”¨å‘½ä»¤æ—¶åŠ è½½å•è¯è®¡æ•°æ‰©å±•åï¼Œè€Œæ˜¯å¸Œæœ›æ¯ä¸ªæ ‡è®°æ–‡ä»¶éƒ½å¯ç”¨ã€‚ é¦–å…ˆï¼Œå°†æ¿€æ´»åŠŸèƒ½çš„ä¸»ä½“æ›¿æ¢ä¸º: 1234567891011// Use the console to output diagnostic information (console.log) and errors (console.error).// This line of code will only be executed once when your extension is activated.console.log('Congratulations, your extension \"WordCount\" is now active!');// create a new word counterlet wordCounter = new WordCounter();let controller = new WordCounterController(wordCounter);// Add to a list of disposables which are disposed when this extension is deactivated.context.subscriptions.push(controller);context.subscriptions.push(wordCounter); å…¶æ¬¡ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿åœ¨æ‰“å¼€æ ‡è®°æ–‡ä»¶æ—¶æ¿€æ´»æ‰©å±•åã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹package.jsonæ–‡ä»¶ã€‚ä¹‹å‰ï¼Œæ‰©å±•æ˜¯é€šè¿‡extension.sayHelloå‘½ä»¤æ¿€æ´»çš„ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»package.jsonåˆ é™¤æ•´ä¸ªè´¡çŒ®å±æ€§: 12345678\"contributes\": &#123; \"commands\": [&#123; \"command\": \"extension.sayHello\", \"title\": \"Hello World\" &#125; ] &#125;, ç°åœ¨æ›´æ”¹æ‚¨çš„æ‰©å±•åï¼Œä»¥ä¾¿åœ¨æ‰“å¼€æ ‡è®°æ–‡ä»¶æ—¶æ¿€æ´»å®ƒï¼Œæ–¹æ³•æ˜¯æ›´æ–°activationEventså±æ€§: 123\"activationEvents\": [ \"onLanguage:markdown\" ] onLanguage:${language}äº‹ä»¶æ¥å—è¯­è¨€id(åœ¨æœ¬ä¾‹ä¸­ä¸ºâ€œmarkdownâ€)ï¼Œå¹¶ä¸”åœ¨æ‰“å¼€è¯¥è¯­è¨€çš„æ–‡ä»¶æ—¶å°†å¼•å‘è¯¥äº‹ä»¶ã€‚ é€šè¿‡çª—å£é‡è½½Ctrl+Ræˆ–ä½¿ç”¨F5è¿è¡Œæ‰©å±•ï¼Œç„¶åå¼€å§‹ç¼–è¾‘ä¸€ä¸ªæ ‡è®°æ–‡ä»¶ã€‚ç°åœ¨åº”è¯¥æœ‰ä¸€ä¸ªå®æ—¶æ›´æ–°çš„å•è¯è®¡æ•°ã€‚ å¦‚æœæ‚¨åœ¨activateå‡½æ•°ä¸Šè®¾ç½®äº†æ–­ç‚¹ï¼Œé‚£ä¹ˆæ‚¨ä¼šæ³¨æ„åˆ°ï¼Œå½“æ‰“å¼€ç¬¬ä¸€ä¸ªæ ‡è®°æ–‡ä»¶æ—¶ï¼Œå®ƒåªè°ƒç”¨ä¸€æ¬¡ã€‚WordCountControlleræ„é€ å‡½æ•°è¿è¡Œå¹¶è®¢é˜…ç¼–è¾‘å™¨äº‹ä»¶ï¼Œè¿™æ ·updateWordCountå‡½æ•°å°±è¢«ç§°ä¸ºâ€œæ ‡è®°æ–‡ä»¶â€(Markdown)ï¼Œå®ƒä»¬çš„æ–‡æœ¬ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚ å®šåˆ¶çŠ¶æ€æ  æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•åœ¨çŠ¶æ€æ ä¸Šæ˜¾ç¤ºæ ¼å¼åŒ–æ–‡æœ¬ã€‚VSä»£ç å…è®¸æ‚¨å®šåˆ¶æ‚¨çš„çŠ¶æ€æ æ·»åŠ è¿›ä¸€æ­¥ä¸é¢œè‰²ï¼Œå›¾æ ‡ï¼Œå·¥å…·æç¤ºç­‰ã€‚ä½¿ç”¨æ™ºèƒ½æ„ŸçŸ¥ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å„ç§StatusBarItemå­—æ®µã€‚å­¦ä¹ VSä»£ç å¯æ‰©å±•æ€§apiçš„å¦ä¸€ä¸ªå¾ˆå¥½çš„èµ„æºæ˜¯ç”Ÿæˆçš„æ‰©å±•é¡¹ç›®ä¸­åŒ…å«çš„node_modules\\vscode\\vscode.d.tsç±»å‹å£°æ˜æ–‡ä»¶ã€‚åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€vscode.d.tsï¼Œæ‚¨å°†çœ‹åˆ°å¸¦æœ‰æ³¨é‡Šçš„å®Œæ•´VSä»£ç å¯æ‰©å±•æ€§APIã€‚ å°†StatusBarItemæ›´æ–°ä»£ç æ›¿æ¢ä¸º: 123// Update the status bar this._statusBarItem.text = wordCount !== 1 ? `$(pencil) $&#123;wordCount&#125; Words` : '$(pencil) 1 Word'; this._statusBarItem.show(); åœ¨è®¡ç®—å­—æ•°çš„å·¦è¾¹æ˜¾ç¤ºä¸€ä¸ªGitHub Octiconé“…ç¬”å›¾æ ‡ã€‚ å¤„ç†æ‰©å±•èµ„æºç°åœ¨ï¼Œæˆ‘ä»¬å°†æ›´æ·±å…¥åœ°äº†è§£æ‰©å±•å¦‚ä½•é€šè¿‡å¯ä¸¢å¼ƒä»¶å¤„ç†VSä»£ç èµ„æºã€‚ å½“ä¸€ä¸ªæ‰©å±•è¢«æ¿€æ´»æ—¶ï¼Œå®ƒä¼šè¢«ä¼ é€’ä¸€ä¸ªExtensionContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰ä¸€ä¸ªå¯ä¸¢å¼ƒçš„å¯è®¢é˜…é›†åˆã€‚æ‰©å±•å¯ä»¥å°†å®ƒä»¬çš„ä¸€æ¬¡æ€§å¯¹è±¡æ·»åŠ åˆ°è¿™ä¸ªé›†åˆä¸­ï¼ŒVSä»£ç å°†åœ¨æ‰©å±•åœç”¨æ—¶å¤„ç†è¿™äº›å¯¹è±¡ã€‚ è®¸å¤šåˆ›å»ºå·¥ä½œåŒºæˆ–UIå¯¹è±¡(ä¾‹å¦‚registerCommand)çš„VSä»£ç apiè¿”å›ä¸€ä¸ªä¸€æ¬¡æ€§çš„ï¼Œæ‰©å±•å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨å®ƒä»¬çš„disposeæ–¹æ³•ä»VSä»£ç ä¸­åˆ é™¤è¿™äº›å…ƒç´ ã€‚ äº‹ä»¶æ˜¯onDid*äº‹ä»¶è®¢é˜…æ–¹æ–¹æ³•è¿”å›ä¸€æ¬¡æ€§æ¶ˆæ¯çš„å¦ä¸€ä¸ªä¾‹å­ã€‚é€šè¿‡å¤„ç†äº‹ä»¶çš„å¯ä¸¢å¼ƒæ€§ï¼Œå–æ¶ˆè®¢é˜…äº‹ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒWordCountControlleré€šè¿‡ä¿ç•™è‡ªå·±çš„ä¸€æ¬¡æ€§é›†åˆ(åœ¨åœç”¨æ—¶æ¸…é™¤)ç›´æ¥å¤„ç†äº‹ä»¶è®¢é˜…å¯ä¸¢å¼ƒé¡¹ã€‚ 1234567// subscribe to selection change and editor activation events let subscriptions: Disposable[] = []; window.onDidChangeTextEditorSelection(this._onEvent, this, subscriptions); window.onDidChangeActiveTextEditor(this._onEvent, this, subscriptions); // create a combined disposable from both event subscriptions this._disposable = Disposable.from(...subscriptions); åœ¨æœ¬åœ°å®‰è£…æ‚¨çš„æ‰©å±•åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨ç¼–å†™çš„æ‰©å±•åªåœ¨VSä»£ç çš„ä¸€ä¸ªç‰¹æ®Šå®ä¾‹ä¸­è¿è¡Œï¼Œå³æ‰©å±•å¼€å‘ä¸»æœºå®ä¾‹ã€‚è¦ä½¿æ‚¨çš„æ‰©å±•å¯ä»¥ç”¨äºæ‰€æœ‰VSä»£ç å®ä¾‹ï¼Œè¯·å°†æ‰©å±•æ–‡ä»¶å¤¹å†…å®¹å¤åˆ¶åˆ°.vscode/extensionsæ–‡ä»¶å¤¹ä¸‹çš„æ–°æ–‡ä»¶å¤¹ä¸­ å‘å¸ƒæ‚¨çš„æ‰©å±•é˜…è¯»å¦‚ä½•å…±äº«æ‰©å±•ã€‚ ä¸‹ä¸€ä¸ªæ­¥éª¤ç»§ç»­å¾€ä¸‹è¯»ï¼Œä½ ä¼šå‘ç°: æ‰©å±•ç”Ÿæˆå™¨-äº†è§£Yoä»£ç æ‰©å±•ç”Ÿæˆå™¨ä¸­çš„å…¶ä»–é€‰é¡¹ã€‚æ‰©å±•API - è·å¾—æ‰©å±•APIçš„æ¦‚è¿°ã€‚å‘å¸ƒå·¥å…·-å­¦ä¹ å¦‚ä½•å‘å¸ƒä¸€ä¸ªæ‰©å±•åˆ°å…¬å…±å¸‚åœºã€‚ç¼–è¾‘å™¨API -å­¦ä¹ æ›´å¤šå…³äºæ–‡æœ¬æ–‡æ¡£ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨å’Œç¼–è¾‘æ–‡æœ¬ã€‚å…¶ä»–æ‰©å±•ç¤ºä¾‹â€”æŸ¥çœ‹æˆ‘ä»¬çš„ç¤ºä¾‹æ‰©å±•é¡¹ç›®åˆ—è¡¨ã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"}]},{"title":"æ‰©å±• - Hello World","slug":"vscode-extensions-2","date":"2018-08-11T04:16:04.000Z","updated":"2020-07-25T02:57:18.230Z","comments":true,"path":"2018/08/11/vscode-extensions-2/","link":"","permalink":"https://jigangduan.github.io/2018/08/11/vscode-extensions-2/","excerpt":"","text":"ä½ çš„ç¬¬ä¸€ä¸ªæ‰©å±•æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨åˆ›å»ºç¬¬ä¸€ä¸ªVS Codeæ‰©å±•(â€œHello Worldâ€)ï¼Œå¹¶è§£é‡ŠVS Codeå¯æ‰©å±•æ€§çš„åŸºæœ¬æ¦‚å¿µã€‚ åœ¨æœ¬æ¼”ç»ƒä¸­ï¼Œæ‚¨å°†å‘VS Codeæ·»åŠ ä¸€ä¸ªæ–°å‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„â€œHello Worldâ€æ¶ˆæ¯ã€‚åœ¨éšåçš„æ¼”ç»ƒä¸­ï¼Œæ‚¨å°†ä¸VS Codeç¼–è¾‘å™¨äº¤äº’ï¼Œå¹¶æŸ¥è¯¢ç”¨æˆ·å½“å‰é€‰æ‹©çš„æ–‡æœ¬ã€‚ å…ˆå†³æ¡ä»¶ä½ éœ€è¦çš„èŠ‚ç‚¹ã€‚åœ¨æ‚¨çš„$PATHä¸­å®‰è£…å¹¶å¯ç”¨jsã€‚Node.jså®‰è£…åŒ…æ‹¬npm, Node.jsåŒ…ç®¡ç†å™¨ï¼Œå®ƒå°†ç”¨äºå®‰è£…æ‰©å±•ç”Ÿæˆå™¨ã€‚ ç”Ÿæˆä¸€ä¸ªæ–°çš„æ‰©å±•å‘VS Codeä¸­æ·»åŠ è‡ªå·±çš„åŠŸèƒ½çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ªå‘½ä»¤ã€‚å‘½ä»¤æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥ä»å‘½ä»¤è°ƒè‰²æ¿è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é”®ç»‘å®šè°ƒç”¨ã€‚ æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªYeomanç”Ÿæˆå™¨æ¥å¸®åŠ©æ‚¨å¼€å§‹ã€‚å®‰è£…Yeomanå’ŒYeoman VSCodeæ‰©å±•ç”Ÿæˆå™¨å’Œè„šæ‰‹æ¶ä¸€ä¸ªæ–°çš„æ‰©å±•: 12npm install -g yo generator-codeyo code å¯¹äºhello worldæ‰©å±•ï¼Œæ‚¨å¯ä»¥åˆ›å»ºTypeScriptæ‰©å±•æˆ–JavaScriptæ‰©å±•ã€‚å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªTypeScriptæ‰©å±•ã€‚ è¿è¡Œæ‚¨çš„æ‰©å±• å¯åŠ¨VS Codeï¼Œé€‰æ‹©æ–‡ä»¶&gt;æ‰“å¼€æ–‡ä»¶å¤¹å¹¶é€‰æ‹©ç”Ÿæˆçš„æ–‡ä»¶å¤¹ã€‚ æŒ‰F5æˆ–å•å‡»è°ƒè¯•å›¾æ ‡å¹¶å•å‡»Startã€‚ VS Codeçš„ä¸€ä¸ªæ–°å®ä¾‹å°†ä»¥ç‰¹æ®Šæ¨¡å¼(æ‰©å±•å¼€å‘ä¸»æœº)å¯åŠ¨ï¼Œè¿™ä¸ªæ–°å®ä¾‹ç°åœ¨çŸ¥é“æ‚¨çš„æ‰©å±•äº†ã€‚ æŒ‰é”®â‡§âŒ˜På’Œè¿è¡Œè¯¥å‘½ä»¤å‘½åä¸ºHello Worldã€‚ æ­å–œä½ !æ‚¨åˆšåˆšåˆ›å»ºå¹¶æ‰§è¡Œäº†ç¬¬ä¸€ä¸ªVSä»£ç å‘½ä»¤! æ‰©å±•çš„ç»“æ„è¿è¡Œåç”Ÿæˆçš„æ‰©å±•åº”è¯¥å…·æœ‰ä»¥ä¸‹ç»“æ„: 123456789101112131415161718192021222324252627.â”œâ”€â”€ .gitignoreâ”œâ”€â”€ .vscode // VS Code integrationâ”‚ â”œâ”€â”€ launch.jsonâ”‚ â”œâ”€â”€ settings.jsonâ”‚ â””â”€â”€ tasks.jsonâ”œâ”€â”€ .vscodeignore // files ignored when publishing extensionâ”œâ”€â”€ README.mdâ”œâ”€â”€ srcâ”‚ â””â”€â”€ extension.ts // the source of the extension entry pointâ”œâ”€â”€ test // test folderâ”‚ â”œâ”€â”€ extension.test.ts // extension.test.js, in case of JavaScript extensionâ”‚ â””â”€â”€ index.ts // index.js, in case of JavaScript extensionâ”œâ”€â”€ node_modulesâ”‚ â”œâ”€â”€ vscode // include vscode type definition file for extension developmentâ”‚ â””â”€â”€ typescript // compiler for typescript (TypeScript only)â”œâ”€â”€ out // compilation output (TypeScript only)â”‚ â”œâ”€â”€ extension.js // the extension entry pointâ”‚ â”œâ”€â”€ extension.js.mapâ”‚ â””â”€â”€ testâ”‚ â”œâ”€â”€ extension.test.jsâ”‚ â”œâ”€â”€ extension.test.js.mapâ”‚ â”œâ”€â”€ index.jsâ”‚ â””â”€â”€ index.js.mapâ”œâ”€â”€ package.json // extension's manifestâ”œâ”€â”€ tsconfig.json // jsconfig.json, in case of JavaScript extensionâ””â”€â”€ vsc-extension-quickstart.md // extension development quick start è®©æˆ‘ä»¬çœ‹çœ‹æ‰€æœ‰è¿™äº›æ–‡ä»¶çš„ç”¨é€”ï¼Œå¹¶è§£é‡Šå®ƒä»¬çš„ç”¨é€”: æ‰©å±•æ¸…å•:package.json æ¯ä¸ªVS Codeæ‰©å±•å¿…é¡»æœ‰ä¸€ä¸ªpackage.jsonæ–‡ä»¶æè¿°å®ƒå’Œå®ƒçš„åŠŸèƒ½ã€‚ VS Codeåœ¨å¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œå¹¶ç«‹å³å¯¹æ¯ä¸ªæŠ•ç¨¿éƒ¨åˆ†ä½œå‡ºååº”ã€‚ è¯·é˜…è¯»package.jsonæ‰©å±•æ¸…å•å‚è€ƒã€‚ æ›´å¤šå…³äºpackage.jsonè´¡çŒ®ç‚¹çš„ä¿¡æ¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435&#123; \"name\": \"myFirstExtension\", \"description\": \"\", \"version\": \"0.0.1\", \"publisher\": \"\", \"engines\": &#123; \"vscode\": \"^1.5.0\" &#125;, \"categories\": [ \"Other\" ], \"activationEvents\": [ \"onCommand:extension.sayHello\" ], \"main\": \"./out/extension\", \"contributes\": &#123; \"commands\": [&#123; \"command\": \"extension.sayHello\", \"title\": \"Hello World\" &#125;] &#125;, \"scripts\": &#123; \"vscode:prepublish\": \"tsc -p ./\", \"compile\": \"tsc -watch -p ./\", \"postinstall\": \"node ./node_modules/vscode/bin/install\", \"test\": \"node ./node_modules/vscode/bin/test\" &#125;, \"devDependencies\": &#123; \"typescript\": \"^2.0.3\", \"vscode\": \"^1.5.0\", \"mocha\": \"^2.3.3\", \"@types/node\": \"^6.0.40\", \"@types/mocha\": \"^2.2.32\" &#125;&#125; æ³¨æ„:JavaScriptæ‰©å±•ä¸éœ€è¦scriptså­—æ®µï¼Œå› ä¸ºä¸éœ€è¦ç¼–è¯‘ã€‚ è¿™ä¸ªå…·ä½“çš„package.jsonæè¿°äº†ä¸€ä¸ªæ‰©å±•: ä¸€ä¸ªæ¡ç›®æœ‰åŠ©äºå‘½ä»¤é¢æ¿(â‡§âŒ˜P)çš„æ ‡ç­¾â€œHello worldâ€å°†è°ƒç”¨å‘½ä»¤â€œextension.sayHelloâ€ã€‚ å½“å‘½ä»¤â€œextension.sayHelloâ€è¢«è°ƒç”¨æ—¶ï¼Œè¯·æ±‚åŠ è½½(activationEvents)ã€‚ å®ƒçš„ä¸»è¦JavaScriptä»£ç åœ¨ä¸€ä¸ªåä¸ºâ€œ./out/extension.jsâ€çš„æ–‡ä»¶ä¸­ã€‚ æ³¨æ„:VSä»£ç åœ¨å¯åŠ¨æ—¶å¹¶ä¸æ€¥äºåŠ è½½æ‰©å±•çš„ä»£ç ã€‚æ‰©å±•å¿…é¡»é€šè¿‡activationEventså±æ€§æè¿°å®ƒåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹åº”è¯¥è¢«æ¿€æ´»(åŠ è½½)ã€‚ ç”Ÿæˆçš„ä»£ç ç”Ÿæˆçš„æ‰©å±•ä»£ç ä¸ºextension.ts(æˆ–JavaScriptæ‰©å±•ä¸ºextension.js): 123456789101112131415161718192021222324// The module 'vscode' contains the VS Code extensibility API// Import the module and reference it with the alias vscode in your code belowimport * as vscode from 'vscode';// this method is called when your extension is activated// your extension is activated the very first time the command is executedexport function activate(context: vscode.ExtensionContext) &#123; // Use the console to output diagnostic information (console.log) and errors (console.error) // This line of code will only be executed once when your extension is activated console.log('Congratulations, your extension \"my-first-extension\" is now active!'); // The command has been defined in the package.json file // Now provide the implementation of the command with registerCommand // The commandId parameter must match the command field in package.json let disposable = vscode.commands.registerCommand('extension.sayHello', () =&gt; &#123; // The code you place here will be executed every time your command is executed // Display a message box to the user vscode.window.showInformationMessage('Hello World!'); &#125;); context.subscriptions.push(disposable);&#125; æ¯ä¸ªæ‰©å±•éƒ½åº”è¯¥ä»å®ƒçš„ä¸»æ–‡ä»¶å¯¼å‡ºä¸€ä¸ªåä¸ºactivate()çš„å‡½æ•°ï¼Œå½“package.jsonæ–‡ä»¶ä¸­æè¿°çš„ä»»ä½•activationEventså‘ç”Ÿæ—¶ï¼ŒVS Codeåªè°ƒç”¨ä¸€æ¬¡ã€‚ å¦‚æœæ‰©å±•ä½¿ç”¨OSèµ„æº(ä¾‹å¦‚spawnsè¿›ç¨‹)ï¼Œæ‰©å±•å¯ä»¥ä»ä¸»æ–‡ä»¶å¯¼å‡ºä¸€ä¸ªåä¸ºdeactivate()çš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œå®ƒå¯ä»¥è¿›è¡Œæ¸…ç†å·¥ä½œï¼ŒVS Codeå°†åœ¨å…³æœºæ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚ è¿™ä¸ªç‰¹å®šçš„æ‰©å±•å¯¼å…¥vscode APIï¼Œç„¶åæ³¨å†Œä¸€ä¸ªå‘½ä»¤ï¼Œåœ¨è°ƒç”¨å‘½ä»¤â€œextension.sayHelloâ€æ—¶å…³è”è¦è°ƒç”¨çš„å‡½æ•°ã€‚å‘½ä»¤çš„å®ç°åœ¨VSä»£ç ä¸­æ˜¾ç¤ºâ€œHello worldâ€æ¶ˆæ¯ã€‚ æ³¨æ„:package.jsonçš„è´¡çŒ®éƒ¨åˆ†å‘å‘½ä»¤è°ƒè‰²æ¿æ·»åŠ äº†ä¸€ä¸ªæ¡ç›®ã€‚extension.ts/.jsä¸­çš„ä»£ç å®šä¹‰äº†â€œextension.sayHelloâ€çš„å®ç°ã€‚æ³¨æ„:å¯¹äºTypeScriptæ‰©å±•ï¼Œç”Ÿæˆçš„æ–‡ä»¶out/extension.jså°†åœ¨è¿è¡Œæ—¶åŠ è½½å¹¶ç”±VSä»£ç æ‰§è¡Œã€‚ å…¶ä»–æ–‡ä»¶çš„ .vscode/launch.jsonåœ¨æ‰©å±•å¼€å‘æ¨¡å¼ä¸­å®šä¹‰äº†å¯åŠ¨VSä»£ç ã€‚å®ƒè¿˜å°†é¢„å¯åŠ¨ä»»åŠ¡æŒ‡å‘è¿è¡ŒTypeScriptç¼–è¯‘å™¨çš„.vscode/tasks.jsonä¸­å®šä¹‰çš„ä»»åŠ¡ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ.vscode/settings.jsonä¸åŒ…æ‹¬outæ–‡ä»¶å¤¹ã€‚å¯ä»¥ä¿®æ”¹è¦éšè—çš„æ–‡ä»¶ç±»å‹ã€‚ .gitignore - å‘Šè¯‰Gitç‰ˆæœ¬æ§åˆ¶è¦å¿½ç•¥å“ªäº›æ¨¡å¼ .vscodeignore -å‘Šè¯‰æ‰“åŒ…å·¥å…·åœ¨å‘å¸ƒæ‰©å±•åæ—¶å¿½ç•¥å“ªäº›æ–‡ä»¶ã€‚ README.md - æè¿°VS codeç”¨æˆ·æ‰©å±•çš„READMEæ–‡ä»¶ã€‚ vsc-extension-quickstart.md -ä¸€ä¸ªå¿«é€Ÿå¼€å§‹æŒ‡å¯¼ä½ ã€‚ test/extension.test.ts - ä½ å¯ä»¥æŠŠä½ çš„æ‰©å±•å•å…ƒæµ‹è¯•æ”¾åœ¨è¿™é‡Œï¼Œç„¶åæ ¹æ®VSCode APIè¿è¡Œä½ çš„æµ‹è¯•(å‚è§æµ‹è¯•ä½ çš„æ‰©å±•) æ‰©å±•activationç°åœ¨ï¼Œæ‰©å±•ä¸­åŒ…å«çš„æ–‡ä»¶çš„è§’è‰²å·²ç»æ˜ç¡®ï¼Œä¸‹é¢æ˜¯å¦‚ä½•æ¿€æ´»æ‰©å±•çš„: æ‰©å±•å¼€å‘å®ä¾‹å‘ç°æ‰©å±•å¹¶è¯»å–å…¶package.jsonæ–‡ä»¶ã€‚ ä»¥åå½“ä½ æŒ‰â‡§âŒ˜P: æ³¨å†Œçš„å‘½ä»¤æ˜¾ç¤ºåœ¨å‘½ä»¤è°ƒè‰²æ¿ä¸­ã€‚ åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ¡ç›®â€œHello worldâ€åœ¨package.jsonä¸­å®šä¹‰ã€‚ é€‰æ‹©â€œHello worldâ€å‘½ä»¤: è°ƒç”¨å‘½ä»¤â€œextension.sayHelloâ€: åˆ›å»ºä¸€ä¸ªæ¿€æ´»äº‹ä»¶â€œonCommand:extension.sayHelloâ€ã€‚ åœ¨activationEventsä¸­åˆ—å‡ºæ­¤æ¿€æ´»äº‹ä»¶çš„æ‰€æœ‰æ‰©å±•éƒ½è¢«æ¿€æ´»ã€‚ ./out/extension.jså¤„çš„æ–‡ä»¶è¢«åŠ è½½åˆ°JavaScript VMä¸­ã€‚ VS codeå¯»æ‰¾ä¸€ä¸ªå¯¼å‡ºå‡½æ•°æ¿€æ´»å¹¶è°ƒç”¨å®ƒã€‚ å·²ç»æ³¨å†Œäº†å‘½ä»¤â€œextension.sayHelloâ€ï¼Œç°åœ¨å·²ç»å®šä¹‰äº†å®ƒçš„å®ç°ã€‚ è°ƒç”¨å‘½ä»¤â€œextension.sayHelloâ€å®ç°å‡½æ•°ã€‚ å‘½ä»¤å®ç°æ˜¾ç¤ºâ€œHello Worldâ€æ¶ˆæ¯ã€‚ è°ƒè¯•æ‚¨çš„æ‰©å±•è®¾ç½®æ–­ç‚¹ï¼Œä¾‹å¦‚åœ¨å·²æ³¨å†Œçš„å‘½ä»¤ä¸­ï¼Œå¹¶åœ¨æ‰©å±•å¼€å‘VSä»£ç å®ä¾‹ä¸­è¿è¡Œâ€œHello worldâ€å‘½ä»¤ã€‚ æ³¨æ„:å¯¹äºTypeScriptæ‰©å±•ï¼Œå³ä½¿VS CodeåŠ è½½å¹¶æ‰§è¡Œout/extension.jsï¼Œç”±äºç”Ÿæˆçš„æºä»£ç æ˜ å°„out/extension.js.mapï¼Œæ‚¨å®é™…ä¸Šèƒ½å¤Ÿè°ƒè¯•åˆå§‹çš„TypeScriptä»£ç ã€‚mapå’ŒVS Codeå¯¹æºä»£ç æ˜ å°„çš„è°ƒè¯•å™¨æ”¯æŒã€‚æç¤º:è°ƒè¯•æ§åˆ¶å°å°†æ˜¾ç¤ºæ‚¨ç™»å½•åˆ°æ§åˆ¶å°çš„æ‰€æœ‰æ¶ˆæ¯ã€‚ äº†è§£æ›´å¤šå…³äºæ‰©å±•å¼€å‘ç¯å¢ƒçš„ä¿¡æ¯ã€‚ ä¸€ä¸ªç®€å•çš„æ”¹å˜åœ¨extension.ts(æˆ–extension.jsï¼Œåœ¨JavaScriptæ‰©å±•ä¸­)ä¸­ï¼Œå°è¯•æ›¿æ¢extension.sayHelloå‘½ä»¤å®ç°ï¼Œä»¥æ˜¾ç¤ºç¼–è¾‘å™¨ä¸­é€‰æ‹©çš„å­—ç¬¦æ•°: 1234567891011121314let disposable = vscode.commands.registerCommand('extension.sayHello', () =&gt; &#123; // The code you place here will be executed every time your command is executed let editor = vscode.window.activeTextEditor; if (!editor) &#123; return; // No open text editor &#125; let selection = editor.selection; let text = editor.document.getText(selection); // Display a message box to the user vscode.window.showInformationMessage('Selected characters: ' + text.length); &#125;); æç¤º:ä¸€æ—¦å¯¹æ‰©å±•æºä»£ç è¿›è¡Œäº†æ›´æ”¹ï¼Œå°±éœ€è¦é‡æ–°å¯åŠ¨VS Codeçš„æ‰©å±•å¼€å‘ä¸»æœºå®ä¾‹ã€‚æ‚¨å¯ä»¥åœ¨æ‰©å±•å¼€å‘ä¸»æœºå®ä¾‹ä¸­ä½¿ç”¨Ctrl+R (macOS: Cmd+R)ï¼Œæˆ–è€…å•å‡»ä¸»VS Codeå®ä¾‹é¡¶éƒ¨çš„RestartæŒ‰é’®ã€‚ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶(æ–‡ä»¶&gt;æ–°æ–‡ä»¶)ï¼Œè¾“å…¥ä¸€äº›æ–‡æœ¬å¹¶é€‰æ‹©å®ƒã€‚åœ¨è¿è¡ŒHello Worldå‘½ä»¤æ—¶ï¼Œç°åœ¨åº”è¯¥ä¼šçœ‹åˆ°æ‰€é€‰å­—ç¬¦çš„è®¡æ•°ã€‚ åœ¨æœ¬åœ°å®‰è£…æ‚¨çš„æ‰©å±•åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨ç¼–å†™çš„æ‰©å±•åªåœ¨VSCodeçš„ä¸€ä¸ªç‰¹æ®Šå®ä¾‹ä¸­è¿è¡Œï¼Œå³æ‰©å±•å¼€å‘å®ä¾‹ã€‚è¦ä½¿æ‚¨çš„æ‰©å±•åœ¨VSCodeçš„æ‰€æœ‰å®ä¾‹ä¸­è¿è¡Œï¼Œæ‚¨éœ€è¦å°†å…¶å¤åˆ¶åˆ°æœ¬åœ°æ‰©å±•æ–‡ä»¶å¤¹ä¸‹çš„æ–°æ–‡ä»¶å¤¹ä¸­: Windows: %USERPROFILE%.vscode\\extensions macOS/Linux: $HOME/.vscode/extensions å‘å¸ƒæ‚¨çš„æ‰©å±•é˜…è¯»å¦‚ä½•å…±äº«æ‰©å±•ã€‚ ä¸‹ä¸€ä¸ªæ­¥éª¤åœ¨æœ¬æ¼”ç»ƒä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ‰©å±•ã€‚æœ‰å…³æ›´è¯¦ç»†çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…å•è¯è®¡æ•°ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä»¥ç‰¹å®šè¯­è¨€ä¸ºç›®æ ‡(æ ‡è®°)ï¼Œå¹¶ä¾¦å¬ç¼–è¾‘å™¨çš„æ–‡æ¡£æ›´æ”¹äº‹ä»¶ã€‚ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºæ‰©å±•apiçš„å†…å®¹ï¼Œè¯·å°è¯•ä»¥ä¸‹ä¸»é¢˜: æ‰©å±•APIæ¦‚è¿°-äº†è§£VSä»£ç å¯æ‰©å±•æ€§çš„å®Œæ•´æ¨¡å‹ã€‚ APIåŸåˆ™å’Œæ¨¡å¼â€”â€”VSä»£ç å¯æ‰©å±•æ€§åŸºäºå‡ ä¸ªæŒ‡å¯¼åŸåˆ™å’Œæ¨¡å¼ã€‚ è´¡çŒ®ç‚¹â€”â€”å…³äºVSä»£ç è´¡çŒ®ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚ æ¿€æ´»äº‹ä»¶- VSä»£ç æ¿€æ´»äº‹ä»¶å¼•ç”¨ å…¶ä»–æ‰©å±•ç¤ºä¾‹â€”æŸ¥çœ‹æˆ‘ä»¬çš„ç¤ºä¾‹æ‰©å±•é¡¹ç›®åˆ—è¡¨ã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"}]},{"title":"Yo Code - æ‰©å±•ç”Ÿæˆå™¨","slug":"vscode-extensions-1","date":"2018-08-11T02:32:19.000Z","updated":"2020-07-25T02:57:18.230Z","comments":true,"path":"2018/08/11/vscode-extensions-1/","link":"","permalink":"https://jigangduan.github.io/2018/08/11/vscode-extensions-1/","excerpt":"","text":"æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªYeoman ç”Ÿæˆå™¨æ¥å¸®åŠ©æ‚¨å¼€å§‹ã€‚ å…ˆå†³æ¡ä»¶ä½ éœ€è¦çš„èŠ‚ç‚¹ã€‚åœ¨æ‚¨çš„$PATHä¸­å®‰è£…å¹¶å¯ç”¨jsã€‚Node.jså®‰è£…åŒ…æ‹¬npm, Node.jsåŒ…ç®¡ç†å™¨ï¼Œå®ƒå°†ç”¨äºå®‰è£…æ‰©å±•ç”Ÿæˆå™¨ã€‚ å®‰è£…ç”Ÿæˆå™¨ä»å‘½ä»¤æç¤ºç¬¦å®‰è£…Yeomanå’ŒVS Codeæ‰©å±•ç”Ÿæˆå™¨: 1npm install -g yo generator-code è¿è¡Œä½ ä»£ç Yeomanç”Ÿæˆå™¨å°†æŒ‡å¯¼æ‚¨å®Œæˆåˆ›å»ºè‡ªå®šä¹‰æˆ–æ‰©å±•æ‰€éœ€çš„æ­¥éª¤ï¼Œå¹¶æç¤ºæ‚¨è¾“å…¥æ‰€éœ€çš„ä¿¡æ¯ã€‚ è¦å¯åŠ¨ç”Ÿæˆå™¨ï¼Œåœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤: 1yo code ç”Ÿæˆå™¨çš„é€‰æ‹©ç”Ÿæˆå™¨å¯ä»¥ä¸ºæ–°æ‰©å±•åˆ›å»ºæ‰©å±•æ¡†æ¶ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ç°æœ‰çš„TextMateå®šä¹‰æ–‡ä»¶ä¸ºè¯­è¨€ã€ä¸»é¢˜æˆ–ç‰‡æ®µåˆ›å»ºç°æˆçš„æ‰©å±•ã€‚ æ–°å»ºæ‰©å±•(TypeScript)åˆ›å»ºä¸€ä¸ªå®ç°â€œhello worldâ€å‘½ä»¤çš„æ‰©å±•æ¡†æ¶ã€‚å°†æ­¤ä½œä¸ºæ‚¨è‡ªå·±çš„æ‰©å±•çš„èµ·ç‚¹ã€‚ æç¤ºè¾“å…¥æ‰©å±•æ ‡è¯†ç¬¦ï¼Œå¹¶å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºè¯¥åç§°çš„æ–‡ä»¶å¤¹ã€‚ åˆ›å»ºå¸¦æœ‰æºã€æµ‹è¯•å’Œè¾“å‡ºæ–‡ä»¶å¤¹çš„åŸºæœ¬æ–‡ä»¶å¤¹ç»“æ„ã€‚ æ¨¡æ¿è¾“å‡ºpackage.jsonæ–‡ä»¶å’Œæ‰©å±•åä¸»æ–‡ä»¶ã€‚ è®¾ç½®launch.jsonå’Œtasks.jsonï¼Œä»¥ä¾¿F5ç¼–è¯‘å’Œè¿è¡Œæ‚¨çš„æ‰©å±•å¹¶é™„åŠ è°ƒè¯•å™¨ã€‚ å¯ä»¥é€‰æ‹©è®¾ç½®Gitå­˜å‚¨åº“ã€‚ åˆ›å»ºä¹‹åï¼Œåœ¨åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸Šæ‰“å¼€VSä»£ç ã€‚è¯¥æ–‡ä»¶å¤¹åŒ…å«ä¸€ä¸ªæ–‡ä»¶vsc-extension-quickstart.mdï¼Œä½œä¸ºæ¥ä¸‹æ¥æ­¥éª¤çš„å¿«é€ŸæŒ‡å—ã€‚è¿™ä¸ªæ‰©å±•çš„è®¾ç½®æ˜¯ä¸ºäº†è®©ä½ å¾—åˆ°æ‰©å±•APIçš„æ™ºèƒ½æ„ŸçŸ¥ã€‚ æ–°å»ºæ‰©å±•(JavaScript)ä¸æ–°å»ºæ‰©å±•(TypeScript)ç›¸åŒï¼Œä½†æ˜¯JavaScriptã€‚è¿™ä¸ªæ‰©å±•çš„è®¾ç½®æ˜¯ä¸ºäº†è®©ä½ å¾—åˆ°æ‰©å±•APIçš„æ™ºèƒ½æ„ŸçŸ¥ã€‚ æ–°å»ºé¢œè‰²ä¸»é¢˜åˆ›å»ºä¸€ä¸ªèƒ½æä¾›æ–°é¢œè‰²ä¸»é¢˜çš„æ‰©å±•ã€‚æ‚¨å¯ä»¥åŸºäºç°æœ‰çš„TextMateé¢œè‰²ä¸»é¢˜åˆ›å»ºä¸»é¢˜ï¼Œæˆ–è€…ä»å¤´åˆ›å»ºæ–°ä¸»é¢˜ã€‚ å¦‚æœæ‚¨è®¡åˆ’ä½¿ç”¨ Developer: Generate Color Theme From Current Settings å‘½ä»¤åœ¨æ‚¨çš„è®¾ç½®ä¸­ä½¿ç”¨è‡ªå®šä¹‰é¢œè‰²åˆ›å»ºä¸»é¢˜(æ¨è)ï¼Œé‚£ä¹ˆä»æ–°çš„æ‰©å±•å¼€å§‹ã€‚ ä»¥TextMateé¢œè‰²ä¸»é¢˜å¼€å§‹ï¼Œä»¥ç°æœ‰çš„ä¸»é¢˜(å¦‚.tmtheme)å¼€å§‹ã€‚ ç”Ÿæˆå™¨å°†: æç¤ºè¾“å…¥é¢œè‰²ä¸»é¢˜åç§°ä»¥åŠé¢œè‰²åŸºç¡€ä¸»é¢˜(äº®æˆ–æš—)ã€‚ æç¤ºè¾“å…¥æ‰©å±•æ ‡è¯†ç¬¦ï¼Œå¹¶å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºè¯¥åç§°çš„æ–‡ä»¶å¤¹ã€‚ åˆ›å»ºä¹‹åï¼Œåœ¨åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸Šæ‰“å¼€VS Codeå¹¶è¿è¡Œæ‰©å±•æ¥æµ‹è¯•æ–°ä¸»é¢˜ã€‚æŸ¥çœ‹vsc-extension-quickstart.mdã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¿«é€ŸæŒ‡å—ã€‚ æ–°è¯­è¨€æ”¯æŒåˆ›å»ºä¸€ä¸ªæ‰©å±•ï¼Œè¯¥æ‰©å±•ä½¿ç”¨ç€è‰²å™¨æä¾›è¯­è¨€ã€‚ æç¤ºè¾“å…¥ç°æœ‰TextMateè¯­è¨€æ–‡ä»¶(.tmLanguage, .plist or .json)çš„ä½ç½®(URLæˆ–æ–‡ä»¶è·¯å¾„)ã€‚æ­¤æ–‡ä»¶å°†å¯¼å…¥æ–°æ‰©å±•åã€‚è¦å¼€å§‹ä¸€ä¸ªæ–°çš„è¯­æ³•ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªç©ºçš„åç§°æ¥è·³è¿‡è¿™ä¸ªã€‚ æç¤ºè¾“å…¥æ‰©å±•æ ‡è¯†ç¬¦ï¼Œå¹¶å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºè¯¥åç§°çš„æ–‡ä»¶å¤¹ã€‚ åˆ›å»ºå¥½åï¼Œåœ¨åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸Šæ‰“å¼€VSä»£ç å¹¶è¿è¡Œæ‰©å±•æ¥æµ‹è¯•ç€è‰²ã€‚æŸ¥çœ‹vsc-extension-quickstart.mdä»¥äº†è§£æ¥ä¸‹æ¥çš„æ­¥éª¤ã€‚æŸ¥çœ‹å·²ç»åˆ›å»ºçš„è¯­è¨€é…ç½®æ–‡ä»¶ï¼Œå¹¶å®šä¹‰é…ç½®é€‰é¡¹ï¼Œæ¯”å¦‚è¯­è¨€ä½¿ç”¨çš„æ³¨é‡Šå’Œæ‹¬å·ã€‚ æ–°å»ºä»£ç ç‰‡æ®µåˆ›å»ºæä¾›æ–°ä»£ç ç‰‡æ®µçš„æ‰©å±•ã€‚ æç¤ºè¾“å…¥åŒ…å«TextMateç‰‡æ®µ(.tmsnippet)æˆ–Sublimeç‰‡æ®µ(.sublime-snippet)çš„æ–‡ä»¶å¤¹ä½ç½®ã€‚è¿™äº›æ–‡ä»¶è¢«è½¬æ¢ä¸ºVS Codeç‰‡æ®µæ–‡ä»¶ã€‚ æç¤ºè¾“å…¥è¿™äº›ç‰‡æ®µå°†è¢«æ¿€æ´»çš„è¯­è¨€ã€‚ æç¤ºè¾“å…¥æ‰©å±•æ ‡è¯†ç¬¦ï¼Œå¹¶å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºè¯¥åç§°çš„æ–‡ä»¶å¤¹ã€‚ åˆ›å»ºä¹‹åï¼Œåœ¨åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸Šæ‰“å¼€VS Codeå¹¶è¿è¡Œæ‰©å±•æ¥æµ‹è¯•ä»£ç ç‰‡æ®µã€‚æŸ¥çœ‹vsc-extension-quickstart.mdã€‚æ¥ä¸‹æ¥çš„æ­¥éª¤ã€‚ æ–°å»ºæ‰©å±•åŒ…åˆ›å»ºä¸€ä¸ªæ‰©å±•ï¼Œè¯¥æ‰©å±•ä½¿ç”¨æ‚¨æœ€å–œæ¬¢çš„æ‰©å±•æä¾›ä¸€ä¸ªæ–°çš„æ‰©å±•åŒ…ã€‚ æç¤ºå°†å·²å®‰è£…çš„æ‰©å±•æ·»åŠ åˆ°æ‰©å±•åŒ…ã€‚ æç¤ºè¾“å…¥æ‰©å±•æ ‡è¯†ç¬¦ï¼Œå¹¶å°†åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºè¯¥åç§°çš„æ–‡ä»¶å¤¹ã€‚ æ£€æŸ¥åŒ…ä¸­çš„æ‰©å±•ä¾èµ–å…³ç³»ã€‚å‘å¸ƒæ‰©å±•åŒ…ä¹‹å‰çš„jsonæ–‡ä»¶ã€‚ åˆ›å»ºå¥½åï¼Œåœ¨åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸Šæ‰“å¼€VSä»£ç å¹¶è¿è¡Œæ‰©å±•æ¥æµ‹è¯•æ‰©å±•åŒ…ã€‚æŸ¥çœ‹vsc-extension-quickstart.mdæ¥ä¸‹æ¥çš„æ­¥éª¤ã€‚ ä½ çš„æ‰©å±•æ–‡ä»¶å¤¹è¦åŠ è½½æ‰©å±•ï¼Œéœ€è¦å°†æ–‡ä»¶å¤åˆ¶åˆ°VS Codeæ‰©å±•æ–‡ä»¶å¤¹.vscode/extensionsã€‚æ ¹æ®å¹³å°çš„ä¸åŒï¼Œå®ƒä½äºä»¥ä¸‹æ–‡ä»¶å¤¹ä¸­: Windows %USERPROFILE%\\.vscode\\extensions macOS ~/.vscode/extensions Linux ~/.vscode/extensions å¦‚æœæ¯æ¬¡VS Codeè¿è¡Œæ—¶éƒ½è¦åŠ è½½æ‰©å±•åï¼Œè¯·å°†é¡¹ç›®å¤åˆ¶åˆ°.vscode/extensionsä¸‹çš„æ–°æ–‡ä»¶å¤¹ä¸­(â€œä¾§åŠ è½½â€)ã€‚ä¾‹å¦‚:~/.vscode/extensions/myextensionã€‚ ä¸‹ä¸€ä¸ªæ­¥éª¤å‘å¸ƒå·¥å…·-å­¦ä¹ å¦‚ä½•å‘å¸ƒä½ çš„æ‰©å±•åˆ°VS Codeå¸‚åœºã€‚Hello Worldâ€”å°è¯•â€œHello Worldâ€æ¼”ç»ƒæ¥æ„å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ‰©å±•ã€‚å…¶ä»–æ‰©å±•ç¤ºä¾‹â€”æŸ¥çœ‹æˆ‘ä»¬çš„ç¤ºä¾‹æ‰©å±•é¡¹ç›®åˆ—è¡¨ã€‚ å¸¸è§é—®é¢˜yoä»£ç ç”Ÿæˆå™¨ä¸å“åº”Windows 10ä¸Šçš„ç®­å¤´é”®å°è¯•ç”¨yoå¯åŠ¨Yeomanç”Ÿæˆå™¨ï¼Œç„¶åé€‰æ‹©ä»£ç ç”Ÿæˆå™¨ã€‚ å¦‚æœç®­å¤´é”®ä»ç„¶æ²¡æœ‰å“åº”ï¼Œè¯•ç€ä»ä¸€ä¸ªå‡é«˜çš„å¤–å£³å¯åŠ¨Yeomanã€‚ä¸ºæ­¤ï¼Œå³é”®å•å‡»shellå¹¶é€‰æ‹©Run as administratorã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"}]},{"title":"SentryæœåŠ¡æ­å»º","slug":"Sentry","date":"2018-08-11T01:08:32.000Z","updated":"2020-07-25T02:57:18.164Z","comments":true,"path":"2018/08/11/Sentry/","link":"","permalink":"https://jigangduan.github.io/2018/08/11/Sentry/","excerpt":"","text":"å®˜æ–¹å¼•å¯¼è¿è¡Œæ‚¨è‡ªå·±çš„ Sentry ä½¿ç”¨ Docker. éœ€æ±‚ Docker 1.10.0+ Compose 1.6.0+ (å¯é€‰) å¯åŠ¨å’Œè¿è¡Œå‡è®¾æ‚¨åˆšåˆšå…‹éš†äº†è¿™ä¸ªå­˜å‚¨åº“ï¼Œä¸‹é¢çš„æ­¥éª¤å°†ç«‹å³å¯åŠ¨å¹¶è¿è¡Œ! å¯èƒ½éœ€è¦å¯¹åŒ…å«çš„docker-compose.ymlæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥é€‚åº”æ‚¨çš„éœ€è¦æˆ–ç¯å¢ƒã€‚è¿™äº›æŒ‡å¯¼æ–¹é’ˆæ˜¯ä½ åº”è¯¥åšçš„äº‹æƒ…ã€‚ mkdir -p data/{sentry,postgres} - ä½¿æˆ‘ä»¬çš„æœ¬åœ°æ•°æ®åº“å’Œå“¨å…µé…ç½®ç›®å½•ã€‚è¿™ä¸ªç›®å½•æ˜¯ç”¨postgresç»‘å®šå®‰è£…çš„ï¼Œæ‰€ä»¥ä¸ä¼šä¸¢å¤±çŠ¶æ€! docker-compose build - æ„å»ºå’Œæ ‡è®°DockeræœåŠ¡ docker-compose run --rm web config generate-secret-key - ç”Ÿæˆä¸€ä¸ªå¯†é’¥. å°†å…¶æ·»åŠ åˆ° docker-compose.yml in base as SENTRY_SECRET_KEY. docker-compose run --rm web upgrade - å»ºç«‹æ•°æ®åº“. ä½¿ç”¨äº¤äº’å¼æç¤ºåˆ›å»ºç”¨æˆ·å¸æˆ·. docker-compose up -d - è§£é™¤æ‰€æœ‰æœåŠ¡(åˆ†ç¦»/åå°æ¨¡å¼)ã€‚ è®¿é—®æ‚¨çš„å®ä¾‹ localhost:9000! æ³¨æ„ï¼Œåªè¦å®‰è£…äº†æ•°æ®åº“ç»‘å®šï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°åœæ­¢å’Œåˆ é™¤å®¹å™¨ï¼Œè€Œä¸ç”¨æ‹…å¿ƒã€‚ ç¡®ä¿Sentry ä½¿ç”¨ SSL/TLSå¦‚æœæ‚¨æƒ³ç”¨SSL/TLSä¿æŠ¤æ‚¨çš„Sentryå®‰è£…ï¼Œé‚£ä¹ˆæœ‰ä¸€äº›å¾ˆæ£’çš„SSL/TLSä»£ç†ï¼Œæ¯”å¦‚HAProxyå’ŒNginxã€‚ \bå‡çº§Sentryä½¿ç”¨æ’°å†™æ¥æ›´æ–°å²—å“¨ç›¸å¯¹ç®€å•ã€‚åªéœ€ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ›´æ–°ã€‚ç¡®ä¿åœ¨Dockerfileä¸­è®¾ç½®äº†æœ€æ–°çš„ç‰ˆæœ¬ã€‚æˆ–è€…ä½¿ç”¨è¿™ä¸ªå­˜å‚¨åº“çš„æœ€æ–°ç‰ˆæœ¬ã€‚ æ›´æ–°æ­¤å­˜å‚¨åº“æˆ–Dockerfileåï¼Œä½¿ç”¨ä»¥ä¸‹æ­¥éª¤: 123docker-compose build # æ›´æ–°åé‡æ–°æ„å»ºæœåŠ¡docker-compose run --rm web upgrade # è¿è¡Œæ–°çš„è¿ç§»docker-compose up -d # é‡æ–°åˆ›å»ºæœåŠ¡ èµ„æº æ–‡æ¡£ Bugè¿½è¸ª è®ºå› IRC (chat.freenode.net, #sentry)","categories":[],"tags":[]},{"title":"æ‰©å±• VS Code","slug":"vscode-extensions","date":"2018-08-10T13:33:34.000Z","updated":"2020-07-25T02:57:18.231Z","comments":true,"path":"2018/08/10/vscode-extensions/","link":"","permalink":"https://jigangduan.github.io/2018/08/10/vscode-extensions/","excerpt":"","text":"å¦‚æœæ‚¨å¯¹æ‰©å±•VS Codeæ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆæ‚¨çš„ä½ç½®å°±å¯¹äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ¦‚è¿°VSä»£ç å¯æ‰©å±•æ€§æ–‡æ¡£ï¼Œä»¥åŠå¦‚ä½•å¿«é€Ÿæ„å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªVSä»£ç æ‰©å±•ã€‚å¦‚æœæ‚¨å¯¹VSä»£ç çš„å¯æ‰©å±•æ€§çš„è®¾è®¡æ–¹æ³•æ„Ÿåˆ°å¥½å¥‡ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ã€‚ å¦‚æœæ‚¨åªæƒ³ä½¿ç”¨ç°æœ‰çš„æ‰©å±•ï¼Œè¯·å‚é˜…æ‰©å±•å¸‚åœºä¸»é¢˜ï¼Œåœ¨è¯¥ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä»VSCodeå¸‚åœºä¸­æŸ¥æ‰¾å’Œå®‰è£…æ‰©å±•ã€‚ æ‰€æœ‰VS Codeæ‰©å±•éƒ½å…±äº«ä¸€ä¸ªå…¬å…±çš„è´¡çŒ®(æ³¨å†Œ)ã€æ¿€æ´»(åŠ è½½)å’Œè®¿é—®VS Codeå¯æ‰©å±•æ€§APIçš„æ¨¡å‹ã€‚ä½†æ˜¯VS Codeæ‰©å±•æœ‰ä¸¤ç§ç‰¹æ®Šçš„é£æ ¼ï¼Œè¯­è¨€æœåŠ¡å™¨å’Œè°ƒè¯•å™¨ï¼Œå®ƒä»¬æœ‰è‡ªå·±çš„é™„åŠ åè®®ï¼Œå¹¶åœ¨å„è‡ªçš„æ–‡æ¡£éƒ¨åˆ†ä¸­ä»‹ç»ã€‚ æ‰©å±•â€”â€”åŸºæœ¬æ„å»ºå— è¯­è¨€æœåŠ¡å™¨-é€šè¿‡è¯­è¨€æœåŠ¡å™¨åè®®å¢å¼ºç¼–è¾‘ä½“éªŒçš„æ‰©å±• è°ƒè¯•å™¨â€”é€šè¿‡è°ƒè¯•é€‚é…å™¨è¿æ¥å¤–éƒ¨è°ƒè¯•å™¨ æ‰©å±•æ¿€æ´»æ—¶ï¼Œæ‰€æœ‰æ‰©å±•åœ¨æˆ‘ä»¬çš„å…±äº«æ‰©å±•ä¸»æœº(extension host)è¿›ç¨‹ä¸­è¿è¡Œã€‚è¿™ä¸ªå•ç‹¬çš„æ‰©å±•è¿‡ç¨‹ç¡®ä¿VS Codeå§‹ç»ˆä¿æŒå“åº”ã€‚ æ‰©å±•åŒ…æ‹¬æ”¯æŒ: æ¿€æ´» â€”â€” å½“æ£€æµ‹åˆ°ç‰¹å®šæ–‡ä»¶ç±»å‹æ—¶ï¼Œå½“ç‰¹å®šæ–‡ä»¶å­˜åœ¨æ—¶ï¼Œæˆ–è€…é€šè¿‡å‘½ä»¤è°ƒè‰²æ¿æˆ–é”®ç»„åˆé€‰æ‹©å‘½ä»¤æ—¶ï¼ŒåŠ è½½æ‰©å±•åç¼–è¾‘å™¨ â€”â€” ä½¿ç”¨ç¼–è¾‘å™¨çš„å†…å®¹â€”é˜…è¯»å’Œæ“ä½œæ–‡æœ¬ï¼Œåˆ©ç”¨é€‰æ‹©å·¥ä½œåŒº â€”â€” è®¿é—®å¼€æ”¾ç¼–è¾‘å™¨ã€çŠ¶æ€æ ã€ä¿¡æ¯æ¶ˆæ¯ç­‰äº‹ä»¶ â€”â€” è¿æ¥åˆ°ç¼–è¾‘å™¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä¾‹å¦‚:æ‰“å¼€ã€å…³é—­ã€æ›´æ”¹ç­‰ç­‰è¿›åŒ–çš„ç¼–è¾‘-åˆ›å»ºä¸°å¯Œçš„è¯­è¨€æ”¯æŒçš„æä¾›è€…ï¼ŒåŒ…æ‹¬æ™ºèƒ½æ„ŸçŸ¥ï¼ŒPeekï¼Œæ‚¬æµ®ï¼Œè¯Šæ–­å’Œæ›´å¤š æˆ‘ä»¬æœ‰ä¸¤ä¸ªç«¯åˆ°ç«¯çš„æ•™ç¨‹æ¥è®©ä½ å­¦ä¹ æ‰©å±•åŸºç¡€çŸ¥è¯†: Hello Worldâ€”â€”ç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„æ‰©å±•ï¼Œäº†è§£ä¸€ä¸ªæ‰©å±•çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œæ‰©å±•æ¸…å•ï¼Œå­¦ä¹ æ¿€æ´»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿è¡Œå’Œè°ƒè¯•ä½ çš„æ‰©å±•å¹¶åœ¨æœ¬åœ°å®‰è£…å®ƒã€‚ å•è¯è®¡æ•°-æ ¹æ®ç‰¹å®šçš„æ–‡ä»¶ç±»å‹æ¿€æ´»ï¼Œæ›´æ–°çŠ¶æ€æ ï¼Œå“åº”æ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„æ›´æ”¹ï¼Œåœ¨ç§»å‡ºæ–‡ä»¶æ—¶å¤„ç†æ‰©å±•åã€‚ åŒæ ·æœ‰ç”¨çš„è¿˜æœ‰å¯æ‰©å±•æ€§åŸåˆ™å’Œæ¨¡å¼ï¼Œå®ƒä»¬æè¿°äº†è´¯ç©¿å¯æ‰©å±•æ€§APIçš„å…±äº«ç¼–ç¨‹æ¨¡å¼ã€‚ è¯­è¨€çš„æœåŠ¡å™¨è¯­è¨€æœåŠ¡å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ‰©å±•ï¼Œæ”¯æŒVSä»£ç ä¸­å¤šç§è¯­è¨€çš„ç¼–è¾‘ä½“éªŒã€‚ä½¿ç”¨è¯­è¨€æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å®ç°å¯¹å®šä¹‰çš„è·³è½¬ã€è‡ªåŠ¨å®Œæˆã€é”™è¯¯æ£€æŸ¥ä»¥åŠVS Codeä¸­æ”¯æŒçš„è®¸å¤šå…¶ä»–è¯­è¨€ç‰¹æ€§ã€‚ äº†è§£æ›´å¤šå…³äºè¯­è¨€æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ è°ƒè¯•é€‚é…å™¨VS Codeå®ç°äº†é€šç”¨è°ƒè¯•å™¨UIï¼Œå¹¶ä¾èµ–äºè°ƒè¯•å™¨æ‰©å±•å’Œæ‰€è°“çš„â€œè°ƒè¯•é€‚é…å™¨â€å°†è°ƒè¯•UIè¿æ¥åˆ°çœŸæ­£çš„è°ƒè¯•å™¨æˆ–è¿è¡Œæ—¶ã€‚è°ƒè¯•é€‚é…å™¨æ˜¯é€šè¿‡VS Codeè°ƒè¯•åè®®ä¸VS Codeé€šä¿¡çš„ä¸“ç”¨è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨ä»»ä½•è¯­è¨€å®ç°ã€‚ äº†è§£æœ‰å…³åˆ›å»ºè°ƒè¯•å™¨æ‰©å±•çš„æ›´å¤šä¿¡æ¯ã€‚ æŸ¥çœ‹VS Codeæ‰©å±•çš„æœ€ç®€å•æ–¹æ³•æ˜¯é€šè¿‡æ‰©å±•å¸‚åœºã€‚æ‚¨å¯ä»¥æµè§ˆæœ‰ç”¨çš„æ‰©å±•ï¼Œå®‰è£…å®ƒä»¬ä»¥è¯•ç”¨å®ƒä»¬ï¼Œå¹¶äº†è§£å¦‚ä½•ä¸ºè‡ªå·±çš„å¼€å‘åœºæ™¯æ‰©å±•VS Codeã€‚ è¯­è¨€æ‰©å±•å‡†åˆ™è¯­è¨€æ‰©å±•æŒ‡å—ä¸»é¢˜å¯ä»¥å¸®åŠ©æ‚¨å†³å®šåœ¨æ‰©å±•ä¸­æ”¯æŒå“ªäº›è¯­è¨€ç‰¹æ€§ã€‚å®ƒå±•ç¤ºäº†VS Codeä¸­å¯ç”¨çš„å„ç§è¯­è¨€ç‰¹æ€§(ä¾‹å¦‚ï¼Œä»£ç å»ºè®®å’Œæ“ä½œã€æ ¼å¼åŒ–ã€é‡å‘½å)ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡è¯­è¨€æœåŠ¡å™¨åè®®æˆ–é€šè¿‡ç›´æ¥ä½¿ç”¨æ‰©å±•APIæ¥å®ç°å®ƒä»¬ã€‚ ä¸»é¢˜ã€ç‰‡æ®µå’Œç€è‰²å™¨é€šè¿‡è¯­æ³•é«˜äº®æ˜¾ç¤ºã€æœ‰ç”¨çš„ä»£ç ç‰‡æ®µå’Œç²¾å¿ƒè®¾è®¡çš„é¢œè‰²ä¸»é¢˜ï¼Œæ‚¨å¯ä»¥å¯¹æ‚¨çš„ç¼–ç¨‹è¯­è¨€æœ‰å¾ˆå¥½çš„ç¼–è¾‘ä½“éªŒã€‚TextMateå®šåˆ¶æ–‡ä»¶æä¾›äº†è¿™ç§æ”¯æŒï¼ŒVSä»£ç å…è®¸æ‚¨è½»æ¾åœ°æ‰“åŒ…å’Œé‡ç”¨è¿™äº›æ–‡ä»¶ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç›´æ¥åœ¨æ‰©å±•åä¸­ä½¿ç”¨.tmTheme, .tmSnippetså’Œ.tmlanguageæ–‡ä»¶ã€‚æˆ‘ä»¬çš„ä¸»é¢˜ã€ç‰‡æ®µå’Œç€è‰²å™¨ä¸»é¢˜å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•åŒ…å«TextMateæ–‡ä»¶ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºè‡ªå·±çš„ä¸»é¢˜ã€ç‰‡æ®µå’Œè¯­è¨€ç€è‰²å™¨ã€‚ ç¼–å†™æ‰©å±•æœ‰ä¸€ä¸ªYeomanæ‰©å±•ç”Ÿæˆå™¨ï¼Œå®ƒä½¿åˆ›å»ºç®€å•çš„æ‰©å±•é¡¹ç›®å˜å¾—éå¸¸å®¹æ˜“ã€‚è¿™äº›éƒ½æ˜¯å¾ˆå¥½çš„å¼€å§‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰¾åˆ°ç°æœ‰çš„æ‰©å±•ç¤ºä¾‹ã€‚ æ‰©å±•å¯ä»¥ç”¨TypeScriptæˆ–JavaScriptç¼–å†™ã€‚VS Codeæä¾›äº†ä¸€æµçš„æ‰©å±•å¼€å‘ä½“éªŒï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å¼€å‘ã€æ„å»ºã€è¿è¡Œã€æµ‹è¯•å’Œè°ƒè¯•VS Codeæœ¬èº«ã€‚ æµ‹è¯•æ‰©å±•æˆ‘ä»¬è¿˜éå¸¸æ”¯æŒä¸ºæ‚¨çš„æ‰©å±•ç¼–å†™å’Œè¿è¡Œæµ‹è¯•ã€‚æ‚¨å¯ä»¥è½»æ¾åœ°åˆ›å»ºé›†æˆæµ‹è¯•ï¼Œè¿™äº›æµ‹è¯•è°ƒç”¨VS code apiï¼Œå¹¶åœ¨è¿è¡ŒVS Codeå®ä¾‹ä¸­æµ‹è¯•æ‚¨çš„ä»£ç ã€‚ æ‰©å±•çš„æƒ³æ³•è®¸å¤šå…³äºVS Codeç‰¹æ€§çš„ä¼˜ç§€ç¤¾åŒºæƒ³æ³•éƒ½æ˜¯ä½œä¸ºæ‰©å±•è€Œä¸æ˜¯ä½œä¸ºæ ¸å¿ƒäº§å“çš„ä¸€éƒ¨åˆ†æ›´å¥½åœ°å®ç°çš„ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®‰è£…æ­£ç¡®çš„æ‰©å±•é›†è½»æ¾åœ°é€‰æ‹©ä»–ä»¬æƒ³è¦çš„åŠŸèƒ½ã€‚VS Codeå›¢é˜Ÿè·Ÿè¸ªvscodeå­˜å‚¨åº“ä¸­æ ‡è®°ä¸º*extension-candidateçš„GitHubé—®é¢˜å¯èƒ½çš„æ‰©å±•ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªå¾ˆå¥½çš„æ‰©å±•æ¥æ„å»ºï¼Œè¯·æŸ¥çœ‹*extension-candidateé—®é¢˜ã€‚ ä¸‹ä¸€ä¸ªæ­¥éª¤æ‚¨çš„ç¬¬ä¸€ä¸ªæ‰©å±• â€”â€” å°è¯•åˆ›å»ºä¸€ä¸ªç®€å•çš„Hello Worldæ‰©å±•ã€‚æ‰©å±•API â€”â€” å­¦ä¹ VSä»£ç å¯æ‰©å±•æ€§APIã€‚æ‰©å±•ç¤ºä¾‹ â€”â€” æ‚¨å¯ä»¥æ£€æŸ¥å’Œæ„å»ºçš„æ‰©å±•ç¤ºä¾‹åˆ—è¡¨ã€‚","categories":[{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"}]},{"title":"Spring MVC","slug":"Spring-5-Recipes-3","date":"2018-08-01T13:19:03.000Z","updated":"2020-07-25T02:57:18.165Z","comments":true,"path":"2018/08/01/Spring-5-Recipes-3/","link":"","permalink":"https://jigangduan.github.io/2018/08/01/Spring-5-Recipes-3/","excerpt":"","text":"MVCæ˜¯Springæ¡†æ¶ä¸­æœ€é‡è¦çš„æ¨¡å—ä¹‹ä¸€ã€‚å®ƒæ„å»ºåœ¨å¼ºå¤§çš„Spring IoCå®¹å™¨ä¸Šï¼Œå¹¶å¹¿æ³›ä½¿ç”¨å®¹å™¨ç‰¹æ€§æ¥ç®€åŒ–å…¶é…ç½®ã€‚ æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨(MVC)æ˜¯UIè®¾è®¡ä¸­å¸¸è§çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒå°†æ¨¡å‹ã€è§†å›¾å’Œæ§åˆ¶å™¨çš„è§’è‰²åˆ†ç¦»åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œå°†ä¸šåŠ¡é€»è¾‘ä¸uiåˆ†ç¦»å¼€æ¥ã€‚æ¨¡å‹è´Ÿè´£ä¸ºè¦æ˜¾ç¤ºçš„è§†å›¾å°è£…åº”ç”¨ç¨‹åºæ•°æ®ã€‚è§†å›¾åº”è¯¥åªæ˜¾ç¤ºæ­¤æ•°æ®ï¼Œè€Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚æ§åˆ¶å™¨è´Ÿè´£æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶è°ƒç”¨åç«¯æœåŠ¡è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚å¤„ç†åï¼Œåç«¯æœåŠ¡å¯ä»¥è¿”å›ä¸€äº›æ•°æ®ä»¥ä¾›è§†å›¾æ˜¾ç¤ºã€‚æ§åˆ¶å™¨æ”¶é›†è¿™äº›æ•°æ®å¹¶ä¸ºè§†å›¾å‡†å¤‡æ¨¡å‹ã€‚MVCæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸šåŠ¡é€»è¾‘ä¸uiåˆ†ç¦»å¼€æ¥ï¼Œä½¿å…¶èƒ½å¤Ÿç‹¬ç«‹åœ°è¿›è¡Œæ›´æ”¹ï¼Œè€Œä¸ä¼šç›¸äº’å½±å“ã€‚ åœ¨Spring MVCåº”ç”¨ç¨‹åºä¸­ï¼Œæ¨¡å‹é€šå¸¸ç”±åŸŸå¯¹è±¡ç»„æˆï¼Œè¿™äº›åŸŸå¯¹è±¡ç”±æœåŠ¡å±‚å¤„ç†å¹¶ç”±æŒä¹…åŒ–å±‚ä¿å­˜ã€‚è§†å›¾é€šå¸¸æ˜¯ç”¨Javaæ ‡å‡†æ ‡è®°åº“(JSTL)ç¼–å†™çš„JSPæ¨¡æ¿ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥å°†è§†å›¾å®šä¹‰ä¸ºPDFæ–‡ä»¶ã€Excelæ–‡ä»¶ã€RESTful webæœåŠ¡ï¼Œç”šè‡³æ˜¯Flexæ¥å£ï¼Œåè€…é€šå¸¸è¢«ç§°ä¸ºå¯ŒInternetåº”ç”¨ç¨‹åº(ria)ã€‚å®Œæˆæœ¬ç« åï¼Œæ‚¨å°†èƒ½å¤Ÿä½¿ç”¨Spring MVCå¼€å‘Java webåº”ç”¨ç¨‹åºã€‚æ‚¨è¿˜å°†äº†è§£Spring MVCçš„é€šç”¨æ§åˆ¶å™¨å’Œè§†å›¾ç±»å‹ï¼Œå…¶ä¸­åŒ…æ‹¬è‡ªSpring 3.0å‘å¸ƒä»¥æ¥ç”¨äºåˆ›å»ºæ§åˆ¶å™¨çš„æ³¨è§£ã€‚æ­¤å¤–ï¼Œæ‚¨å°†äº†è§£Spring MVCçš„åŸºæœ¬åŸåˆ™ï¼Œå®ƒå°†ä½œä¸ºåç»­ç« èŠ‚ä¸­æ›´é«˜çº§ä¸»é¢˜çš„åŸºç¡€ã€‚ ä½¿ç”¨Spring MVCå¼€å‘ä¸€ä¸ªç®€å•çš„Webåº”ç”¨ç¨‹åºé—®é¢˜ æ‚¨å¸Œæœ›ä½¿ç”¨Spring MVCå¼€å‘ä¸€ä¸ªç®€å•çš„webåº”ç”¨ç¨‹åºï¼Œä»¥äº†è§£è¿™ä¸ªæ¡†æ¶çš„åŸºæœ¬æ¦‚å¿µå’Œé…ç½®ã€‚ è§£å†³æ–¹æ¡ˆ Spring MVCçš„ä¸­å¿ƒç»„ä»¶æ˜¯å‰ç«¯æ§åˆ¶å™¨ã€‚åœ¨æœ€ç®€å•çš„Spring MVCåº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ä¸ªæ§åˆ¶å™¨æ˜¯æƒŸä¸€éœ€è¦åœ¨Java webéƒ¨ç½²æè¿°ç¬¦(å³web.xmlæ–‡ä»¶æˆ–ServletContainerInitializer)ä¸­é…ç½®çš„servletã€‚Spring MVCæ§åˆ¶å™¨(é€šå¸¸ç§°ä¸ºdispatcher servlet)å®ç°äº†Sunçš„æ ¸å¿ƒJava EEè®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œç§°ä¸ºFront Controllerã€‚å®ƒå……å½“Spring MVCæ¡†æ¶çš„å‰ç«¯æ§åˆ¶å™¨ï¼Œæ¯ä¸ªwebè¯·æ±‚éƒ½å¿…é¡»ç»è¿‡å®ƒï¼Œä»¥ä¾¿èƒ½å¤Ÿç®¡ç†æ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ã€‚ å½“webè¯·æ±‚è¢«å‘é€åˆ°Spring MVCåº”ç”¨ç¨‹åºæ—¶ï¼Œæ§åˆ¶å™¨é¦–å…ˆæ¥æ”¶è¯·æ±‚ã€‚ç„¶åï¼Œå®ƒå°†ç»„ç»‡åœ¨Springçš„webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­é…ç½®çš„ä¸åŒç»„ä»¶æˆ–æ§åˆ¶å™¨æœ¬èº«ä¸­å­˜åœ¨çš„æ³¨é‡Šï¼Œè¿™äº›éƒ½æ˜¯å¤„ç†è¯·æ±‚æ‰€éœ€çš„ã€‚å›¾3-1æ˜¾ç¤ºäº†Spring MVCä¸­è¯·æ±‚å¤„ç†çš„ä¸»è¦æµç¨‹ã€‚ è¦åœ¨Springä¸­å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ç±»ï¼Œå¿…é¡»ç”¨@Controlleræˆ–@RestControlleræ³¨é‡Šæ ‡è®°ä¸€ä¸ªç±»ã€‚å½“@Controllerå¸¦æ³¨é‡Šçš„ç±»(å³controllerç±»)æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå¯»æ‰¾åˆé€‚çš„å¤„ç†ç¨‹åºæ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚è¿™è¦æ±‚æ§åˆ¶å™¨ç±»é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†ç¨‹åºæ˜ å°„å°†æ¯ä¸ªè¯·æ±‚æ˜ å°„åˆ°å¤„ç†ç¨‹åºæ–¹æ³•ã€‚ä¸ºæ­¤ï¼Œä½¿ç”¨@RequestMappingæ³¨é‡Šä¿®é¥°controllerç±»çš„æ–¹æ³•ï¼Œä½¿å®ƒä»¬æˆä¸ºå¤„ç†ç¨‹åºæ–¹æ³•ã€‚è¿™äº›å¤„ç†ç¨‹åºæ–¹æ³•çš„ç­¾å(æ‚¨å¯ä»¥ä»ä»»ä½•æ ‡å‡†ç±»ä¸­çœ‹åˆ°)æ˜¯å¼€æ”¾çš„ã€‚å¯ä»¥ä¸ºå¤„ç†ç¨‹åºæ–¹æ³•æŒ‡å®šä»»æ„åç§°ï¼Œå¹¶å®šä¹‰å„ç§æ–¹æ³•å‚æ•°ã€‚åŒæ ·ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•å¯ä»¥è¿”å›ä¸€ç³»åˆ—å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ª(ä¾‹å¦‚ï¼ŒStringæˆ–void)ï¼Œè¿™å–å†³äºå®ƒæ‰§è¡Œçš„åº”ç”¨ç¨‹åºé€»è¾‘ã€‚éšç€è¿™æœ¬ä¹¦çš„æ·±å…¥ï¼Œæ‚¨å°†ä¼šé‡åˆ°å„ç§æ–¹æ³•å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ä»¥ä½¿ç”¨@RequestMappingæ³¨é‡Šåœ¨å¤„ç†ç¨‹åºæ–¹æ³•ä¸­ä½¿ç”¨ã€‚ä¸‹é¢åªæ˜¯æœ‰æ•ˆå‚æ•°ç±»å‹çš„éƒ¨åˆ†åˆ—è¡¨ï¼Œä»…ä¾›æ‚¨äº†è§£ã€‚ HttpServletRequestæˆ–HttpServleResponse è¯·æ±‚ä»»æ„ç±»å‹çš„å‚æ•°ï¼Œç”¨@RequestParamæ³¨é‡Š ä»»æ„ç±»å‹çš„æ¨¡å‹å±æ€§ï¼Œç”¨@ModelAttributeæ ‡æ³¨ã€‚ åœ¨ä¼ å…¥è¯·æ±‚ä¸­åŒ…å«çš„Cookieå€¼ï¼Œç”¨@CookieValueæ ‡æ³¨ã€‚ æ˜ å°„æˆ–ModelMapï¼Œç”¨äºå¤„ç†æ–¹æ³•å‘æ¨¡å‹æ·»åŠ å±æ€§ã€‚ å¤„ç†ç¨‹åºæ–¹æ³•è®¿é—®å‘½ä»¤å¯¹è±¡çš„ç»‘å®šå’ŒéªŒè¯ç»“æœçš„é”™è¯¯æˆ–BindingResult SessionStatusï¼Œç”¨æ¥é€šçŸ¥å¤„ç†ç¨‹åºæ–¹æ³•å®Œæˆä¼šè¯å¤„ç† ä¸€æ—¦æ§åˆ¶å™¨ç±»é€‰æ‹©äº†ä¸€ä¸ªé€‚å½“çš„å¤„ç†ç¨‹åºæ–¹æ³•ï¼Œå®ƒå°†è°ƒç”¨å¤„ç†ç¨‹åºæ–¹æ³•çš„é€»è¾‘ä¸è¯·æ±‚ã€‚é€šå¸¸ï¼Œæ§åˆ¶å™¨çš„é€»è¾‘è°ƒç”¨åç«¯æœåŠ¡æ¥å¤„ç†è¯·æ±‚ã€‚æ­¤å¤–ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•çš„é€»è¾‘å¯èƒ½ä¼šä»ä¼—å¤šè¾“å…¥å‚æ•°(ä¾‹å¦‚HttpServletRequestã€Mapã€Errorsæˆ–SessionStatus)ä¸­æ·»åŠ æˆ–åˆ é™¤ä¿¡æ¯ï¼Œè¿™äº›å‚æ•°å°†æ„æˆæ­£åœ¨è¿›è¡Œçš„Spring MVCæµçš„ä¸€éƒ¨åˆ†ã€‚å¤„ç†å®Œè¯·æ±‚åï¼Œå®ƒå°†æ§ä»¶å§”æ‰˜ç»™ä¸€ä¸ªè§†å›¾ï¼Œè¯¥è§†å›¾è¢«è¡¨ç¤ºä¸ºå¤„ç†ç¨‹åºæ–¹æ³•çš„è¿”å›å€¼ã€‚è¦æä¾›ä¸€ç§çµæ´»çš„æ–¹æ³•ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•çš„è¿”å›å€¼å¹¶ä¸è¡¨ç¤ºè§†å›¾çš„å®ç°(ä¾‹å¦‚ï¼Œuser.jsp report.pdf)ã€‚è€Œæ˜¯é€»è¾‘è§†å›¾(ä¾‹å¦‚ï¼Œuseræˆ–report)â€”â€”æ³¨æ„æ–‡ä»¶æ‰©å±•çš„ç¼ºä¹ã€‚å¤„ç†ç¨‹åºæ–¹æ³•çš„è¿”å›å€¼å¯ä»¥æ˜¯è¡¨ç¤ºé€»è¾‘è§†å›¾åçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯voidï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤é€»è¾‘è§†å›¾åæ˜¯æ ¹æ®å¤„ç†ç¨‹åºæ–¹æ³•æˆ–æ§åˆ¶å™¨çš„åç§°ç¡®å®šçš„ã€‚è¦å°†ä¿¡æ¯ä»æ§åˆ¶å™¨ä¼ é€’åˆ°è§†å›¾ï¼Œå¤„ç†ç¨‹åºçš„æ–¹æ³•è¿”å›é€»è¾‘è§†å›¾åç§°å­—ç¬¦ä¸²æˆ–voipæ˜¯ä¸ç›¸å…³çš„ï¼Œå› ä¸ºå¤„ç†ç¨‹åºæ–¹æ³•çš„è¾“å…¥å‚æ•°å°†å¯¹è§†å›¾å¯ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤„ç†ç¨‹åºæ–¹æ³•ä»¥Mapå’ŒSessionStatuså¯¹è±¡ä½œä¸ºè¾“å…¥å‚æ•°â€”â€”åœ¨å¤„ç†ç¨‹åºæ–¹æ³•çš„é€»è¾‘ä¸­ä¿®æ”¹å®ƒä»¬çš„å†…å®¹â€”â€”è¿™äº›ç›¸åŒçš„å¯¹è±¡å°†è¢«å¤„ç†ç¨‹åºæ–¹æ³•è¿”å›çš„è§†å›¾è®¿é—®ã€‚å½“æ§åˆ¶å™¨ç±»æ¥æ”¶åˆ°ä¸€ä¸ªè§†å›¾æ—¶ï¼Œå®ƒå°†é€»è¾‘è§†å›¾åè§£æä¸ºä¸€ä¸ªç‰¹å®šçš„è§†å›¾å®ç°(ä¾‹å¦‚ï¼Œuser)ã€‚é€šè¿‡è§†å›¾è§£æå™¨æ¥å®ç°jspæˆ–report.pdfã€‚è§†å›¾è§£æå™¨æ˜¯åœ¨å®ç°ViewResolveræ¥å£çš„webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­é…ç½®çš„beanã€‚å®ƒçš„èŒè´£æ˜¯ä¸ºé€»è¾‘è§†å›¾åè¿”å›ç‰¹å®šçš„è§†å›¾å®ç°(HTMLã€JSPã€PDFæˆ–å…¶ä»–)ã€‚ä¸€æ—¦æ§åˆ¶å™¨ç±»å°†è§†å›¾åè§£æä¸ºè§†å›¾å®ç°ï¼Œæ ¹æ®è§†å›¾å®ç°çš„è®¾è®¡ï¼Œå®ƒå°†å‘ˆç°æ§åˆ¶å™¨å¤„ç†ç¨‹åºæ–¹æ³•ä¼ é€’çš„å¯¹è±¡(ä¾‹å¦‚HttpServletRequestã€Mapã€Errorsæˆ–SessionStatus)ã€‚è§†å›¾çš„èŒè´£æ˜¯å‘ç”¨æˆ·æ˜¾ç¤ºåœ¨å¤„ç†ç¨‹åºæ–¹æ³•çš„é€»è¾‘ä¸­æ·»åŠ çš„å¯¹è±¡ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å‡è®¾ä½ è¦ä¸ºä¸€ä¸ªä½“è‚²ä¸­å¿ƒå¼€å‘ä¸€ä¸ªæ³•åº­é¢„çº¦ç³»ç»Ÿã€‚æ­¤åº”ç”¨ç¨‹åºçš„uiæ˜¯åŸºäºwebçš„ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥é€šè¿‡Internetåœ¨çº¿é¢„è®¢ã€‚æ‚¨å¸Œæœ›ä½¿ç”¨Spring MVCå¼€å‘è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚é¦–å…ˆï¼Œåœ¨åŸŸå­åŒ…ä¸­åˆ›å»ºä»¥ä¸‹åŸŸç±»: 12345678910111213141516171819202122232425262728package com.apress.springrecipes.court.domain;public class Reservation &#123; private String courtName; private Date date; private int hour; private Player player; private SportType sportType; // Constructors, Getters and Setters ...&#125;package com.apress.springrecipes.court.domain;public class Player &#123; private String name; private String phone; // Constructors, Getters and Setters ...&#125;package com.apress.springrecipes.court.domain;public class SportType &#123; private int id; private String name; // Constructors, Getters and Setters ...&#125; ç„¶åï¼Œåœ¨æœåŠ¡å­åŒ…ä¸­å®šä¹‰ä»¥ä¸‹æœåŠ¡æ¥å£ï¼Œä¸ºè¡¨ç¤ºå±‚æä¾›é¢„è®¢æœåŠ¡: 12345678package com.apress.springrecipes.court.service;import com.apress.springrecipes.court.domain.Reservation;import java.util.List;public interface ReservationService &#123; public List&lt;Reservation&gt; query(String courtName);&#125; åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ï¼Œåº”è¯¥ä½¿ç”¨æ•°æ®åº“æŒä¹…æ€§å®ç°è¿™ä¸ªæ¥å£ã€‚ä½†æ˜¯ä¸ºäº†ç®€å•èµ·è§ï¼Œæ‚¨å¯ä»¥å°†é¢„è®¢è®°å½•å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå¹¶ä¸ºæµ‹è¯•ç›®çš„ç¡¬ç¼–ç å¤šä¸ªé¢„è®¢ã€‚ 123456789101112131415161718192021222324252627282930package com.apress.springrecipes.court.service;import com.apress.springrecipes.court.domain.Player;import com.apress.springrecipes.court.domain.Reservation;import com.apress.springrecipes.court.domain.SportType;import org.springframework.stereotype.Service;import java.time.LocalDate;import java.util.ArrayList;import java.util.List;import java.util.Objects;import java.util.stream.Collectors;@Servicepublic class ReservationServiceImpl implements ReservationService &#123; public static final SportType TENNIS = new SportType(1, \"Tennis\"); public static final SportType SOCCER = new SportType(2, \"Soccer\"); private final List&lt;Reservation&gt; reservations = new ArrayList&lt;&gt;(); public ReservationServiceImpl() &#123; reservations.add(new Reservation(\"Tennis #1\", LocalDate.of(2008, 1, 14), 16, new Player(\"Roger\", \"N/A\"), TENNIS)); reservations.add(new Reservation(\"Tennis #2\", LocalDate.of(2008, 1, 14), 20, new Player(\"James\", \"N/A\"), TENNIS)); &#125; @Override public List&lt;Reservation&gt; query(String courtName) &#123; return this.reservations.stream() .filter(reservation -&gt; Objects.equals(reservation.getCourtName(), courtName)).collect(Collectors.toList()); &#125;&#125; è®¾ç½®ä¸€ä¸ªSpring MVCåº”ç”¨ç¨‹åºæ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªSpring MVCåº”ç”¨ç¨‹åºå¸ƒå±€ã€‚é€šå¸¸ï¼Œä½¿ç”¨Spring MVCå¼€å‘çš„webåº”ç”¨ç¨‹åºçš„è®¾ç½®æ–¹å¼ä¸æ ‡å‡†Java webåº”ç”¨ç¨‹åºç›¸åŒï¼Œåªæ˜¯éœ€è¦æ·»åŠ ä¸€äº›é…ç½®æ–‡ä»¶å’Œç‰¹å®šäºSpring MVCçš„å¿…éœ€åº“ã€‚Java EEè§„èŒƒå®šä¹‰äº†ç”±web archive (WARæ–‡ä»¶)ç»„æˆçš„Java webåº”ç”¨ç¨‹åºçš„æœ‰æ•ˆç›®å½•ç»“æ„ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¿…é¡»æä¾›ä¸€ä¸ªwebéƒ¨ç½²æè¿°ç¬¦(å³:åœ¨WEB-INFæ ¹æˆ–ä¸€ä¸ªæˆ–å¤šä¸ªå®ç°ServletContainerInitializerçš„ç±»ä¸­ã€‚è¿™ä¸ªwebåº”ç”¨ç¨‹åºçš„ç±»æ–‡ä»¶å’ŒJARæ–‡ä»¶åº”è¯¥åˆ†åˆ«æ”¾åœ¨WEB-INF/classes å’Œ WEB-INF/libç›®å½•ä¸­ã€‚å¯¹äºæ‚¨çš„æ³•åº­é¢„è®¢ç³»ç»Ÿï¼Œæ‚¨å°†åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ã€‚æ³¨æ„ï¼Œçªå‡ºæ˜¾ç¤ºçš„æ–‡ä»¶æ˜¯springç‰¹å®šçš„é…ç½®æ–‡ä»¶ã€‚ æ³¨æ„ï¼Œè¦ä½¿ç”¨Spring MVCå¼€å‘webåº”ç”¨ç¨‹åºï¼Œæ‚¨å¿…é¡»å°†æ‰€æœ‰æ™®é€šçš„Springä¾èµ–é¡¹(æ›´å¤šä¿¡æ¯è¯·å‚é˜…ç¬¬1ç« )ä»¥åŠSpring webå’ŒSpring MVCä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„ç±»è·¯å¾„ä¸­ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨Mavenï¼Œè¯·å‘æ‚¨çš„Mavené¡¹ç›®æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹: 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;&lt;/dependency&gt; å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯gradleï¼Œè¯·æ·»åŠ ä»¥ä¸‹å†…å®¹: 123dependencies &#123; compile \"org.springframework:spring-webmvc:$springVersion\"&#125; WEB-INFç›®å½•ä¹‹å¤–çš„æ–‡ä»¶å¯ä»¥é€šè¿‡urlç›´æ¥è®¿é—®ï¼Œå› æ­¤CSSæ–‡ä»¶å’Œå›¾åƒæ–‡ä»¶å¿…é¡»æ”¾åœ¨é‚£é‡Œã€‚åœ¨ä½¿ç”¨Spring MVCæ—¶ï¼ŒJSPæ–‡ä»¶å……å½“æ¨¡æ¿ã€‚å®ƒä»¬è¢«ç”¨äºç”ŸæˆåŠ¨æ€å†…å®¹çš„æ¡†æ¶è¯»å–ï¼Œå› æ­¤åº”è¯¥å°†JSPæ–‡ä»¶æ”¾åˆ°WEB-INFç›®å½•ä¸­ï¼Œä»¥é˜²æ­¢ç›´æ¥è®¿é—®å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œæœ‰äº›åº”ç”¨æœåŠ¡å™¨ä¸å…è®¸WEB-INFå†…éƒ¨çš„æ–‡ä»¶è¢«webåº”ç”¨ç¨‹åºå†…éƒ¨è¯»å–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªèƒ½å°†å®ƒä»¬æ”¾åœ¨WEB-INFç›®å½•ä¹‹å¤–ã€‚ åˆ›å»ºé…ç½®æ–‡ä»¶webéƒ¨ç½²æè¿°ç¬¦(web.xmlæˆ–ServletContainerInitializeræ˜¯Java webåº”ç”¨ç¨‹åºçš„åŸºæœ¬é…ç½®æ–‡ä»¶)ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå®šä¹‰åº”ç”¨ç¨‹åºçš„servletä»¥åŠwebè¯·æ±‚å¦‚ä½•æ˜ å°„åˆ°å®ƒä»¬ã€‚å¯¹äºSpring MVCåº”ç”¨ç¨‹åºï¼Œæ‚¨å¿…é¡»åªå®šä¹‰ä¸€ä¸ªå•ç‹¬çš„DispatcherServletå®ä¾‹ï¼Œå®ƒå……å½“Spring MVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼Œå°½ç®¡æ‚¨å¯ä»¥åœ¨éœ€è¦æ—¶å®šä¹‰å¤šä¸ªã€‚åœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨å¤šä¸ªDispatcherServletå®ä¾‹ã€‚è¿™å…è®¸å°†DispatcherServletå®ä¾‹æŒ‡å®šä¸ºç‰¹å®šçš„urlï¼Œä»è€Œä½¿ä»£ç ç®¡ç†æ›´åŠ å®¹æ˜“ï¼Œå¹¶å…è®¸å„ä¸ªå›¢é˜Ÿæˆå‘˜åœ¨ä¸å¦¨ç¢å½¼æ­¤çš„æƒ…å†µä¸‹å¤„ç†åº”ç”¨ç¨‹åºçš„é€»è¾‘ã€‚ 12345678910111213141516171819202122package com.apress.springrecipes.court.web;import com.apress.springrecipes.court.config.CourtConfiguration;import org.springframework.web.context.support.AnnotationConfigWebApplicationContext;import org.springframework.web.servlet.DispatcherServlet;import javax.servlet.ServletContainerInitializer;import javax.servlet.ServletContext;import javax.servlet.ServletException;import javax.servlet.ServletRegistration;import java.util.Set;public class CourtServletContainerInitializer implements ServletContainerInitializer &#123; @Override public void onStartup(Set&lt;Class&lt;?&gt;&gt; c, ServletContext ctx) throws ServletException &#123; AnnotationConfigWebApplicationContext applicationContext = new AnnotationConfigWebApplicationContext(); applicationContext.register(CourtConfiguration.class); DispatcherServlet dispatcherServlet = new DispatcherServlet(applicationContext); ServletRegistration.Dynamic courtRegistration = ctx.addServlet(\"court\", dispatcherServlet); courtRegistration.setLoadOnStartup(1); courtRegistration.addMapping(\"/\"); &#125;&#125; åœ¨è¿™ä¸ªCourtServletContainerInitializerï¼Œæ‚¨å®šä¹‰ä¸€ä¸ªç±»å‹ä¸ºDispatcherServletçš„servletã€‚è¿™æ˜¯Spring MVCä¸­çš„æ ¸å¿ƒservletç±»ï¼Œå®ƒæ¥æ”¶webè¯·æ±‚å¹¶å°†å®ƒä»¬åˆ†æ´¾ç»™é€‚å½“çš„å¤„ç†ç¨‹åºã€‚æ‚¨å°†æ­¤servletçš„åç§°è®¾ç½®ä¸ºcourtï¼Œå¹¶ä½¿ç”¨æ–œæ (/)æ˜ å°„æ‰€æœ‰urlï¼Œæ–œæ è¡¨ç¤ºæ ¹ç›®å½•ã€‚æ³¨æ„ï¼Œå¯ä»¥å°†URLæ¨¡å¼è®¾ç½®ä¸ºæ›´ç»†ç²’åº¦çš„æ¨¡å¼ã€‚åœ¨è¾ƒå¤§çš„åº”ç”¨ç¨‹åº,åœ¨å„ç§servletä¹‹é—´å§”æ‰˜æ¨¡å¼å¯èƒ½æ›´æœ‰æ„ä¹‰ï¼Œä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰urléƒ½å§”æ‰˜ç»™å•ä¸ªæ³•åº­servletã€‚è¦æ£€æµ‹åˆ°CourtServletContainerInitializerï¼Œè¿˜å¿…é¡»åœ¨META-INF/servicesç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªåä¸ºjavax.servlet.ServletContainerInitializerçš„æ–‡ä»¶ã€‚æ–‡ä»¶çš„å†…å®¹åº”è¯¥æ˜¯CourtServletContainerInitializerçš„å…¨åã€‚æ­¤æ–‡ä»¶ç”±servletå®¹å™¨åŠ è½½ï¼Œç”¨äºå¼•å¯¼åº”ç”¨ç¨‹åºã€‚ 1com.apress.springrecipes.court.web.CourtServletContainerInitializer æœ€åï¼Œæ·»åŠ CourtConfigurationç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„@Configurationç±»ã€‚ 12345678package com.apress.springrecipes.court.config;import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Configuration;@Configuration@ComponentScan(\"com.apress.springrecipes.court\")public class CourtConfiguration &#123;&#125; è¿™å®šä¹‰äº†ä¸€ä¸ª@ComponentScanæ³¨é‡Šï¼Œå®ƒå°†æ‰«æcom.apress.springrecipes.courtåŒ…(å’Œå­åŒ…)å¹¶æ³¨å†Œæ‰€æœ‰æ£€æµ‹åˆ°çš„bean(åœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯ReservationServiceImplå’Œå°šæœªåˆ›å»ºçš„@Controllerå¸¦æ³¨é‡Šç±»)ã€‚ åˆ›å»ºSpring MVCæ§åˆ¶å™¨åŸºäºæ³¨è§£çš„æ§åˆ¶å™¨ç±»å¯ä»¥æ˜¯ä¸€ä¸ªä¸å®ç°ç‰¹å®šæ¥å£æˆ–æ‰©å±•ç‰¹å®šåŸºç±»çš„ä»»æ„ç±»ã€‚æ‚¨å¯ä»¥ä½¿ç”¨@Controlleræ³¨é‡Šå®ƒã€‚å¯ä»¥åœ¨æ§åˆ¶å™¨ä¸­å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†ç¨‹åºæ–¹æ³•æ¥å¤„ç†å•ä¸ªæˆ–å¤šä¸ªæ“ä½œã€‚å¤„ç†ç¨‹åºæ–¹æ³•çš„ç­¾åè¶³å¤Ÿçµæ´»ï¼Œå¯ä»¥æ¥å—ä¸€ç³»åˆ—å‚æ•°ã€‚@RequestMappingæ³¨é‡Šå¯ä»¥åº”ç”¨åˆ°ç±»çº§åˆ«æˆ–æ–¹æ³•çº§åˆ«ã€‚ç¬¬ä¸€ä¸ªæ˜ å°„ç­–ç•¥æ˜¯å°†ç‰¹å®šçš„URLæ¨¡å¼æ˜ å°„åˆ°æ§åˆ¶å™¨ç±»ï¼Œç„¶åå°†ç‰¹å®šçš„HTTPæ–¹æ³•æ˜ å°„åˆ°æ¯ä¸ªå¤„ç†ç¨‹åºæ–¹æ³•ã€‚ 123456789101112131415161718192021package com.apress.springrecipes.court.web;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import java.util.Date;@Controller@RequestMapping(\"/welcome\")public class WelcomeController &#123; @RequestMapping(method = RequestMethod.GET) public String welcome(Model model) &#123; Date today = new Date(); model.addAttribute(\"today\", today); return \"welcome\"; &#125;&#125; è¯¥æ§åˆ¶å™¨åˆ›å»ºä¸€ä¸ªjava.util.Dateå¯¹è±¡æ¥æ£€ç´¢å½“å‰æ—¥æœŸï¼Œç„¶åå°†å…¶ä½œä¸ºå±æ€§æ·»åŠ åˆ°è¾“å…¥æ¨¡å‹å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿ç›®æ ‡è§†å›¾å¯ä»¥æ˜¾ç¤ºå®ƒã€‚ç”±äºæ‚¨å·²ç»æ¿€æ´»äº†å¯¹com.apress.springrecipes.court åŒ…çš„æ³¨é‡Šæ‰«æï¼Œå› æ­¤åœ¨éƒ¨ç½²æ—¶å°†æ£€æµ‹æ§åˆ¶å™¨ç±»çš„æ³¨é‡Šã€‚@Controlleræ³¨é‡Šå°†ç±»å®šä¹‰ä¸ºSpring MVCæ§åˆ¶å™¨ã€‚@RequestMappingæ³¨é‡Šæ›´æœ‰è¶£ï¼Œå› ä¸ºå®ƒåŒ…å«å±æ€§ï¼Œå¯ä»¥åœ¨ç±»æˆ–å¤„ç†ç¨‹åºæ–¹æ³•çº§åˆ«å£°æ˜ã€‚è¿™ä¸ªç±»ä¸­ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªå€¼â€”(â€œ/welcomeâ€)â€”ç”¨äºæŒ‡å®šæ§åˆ¶å™¨å¯æ“ä½œçš„URLï¼Œè¿™æ„å‘³ç€/welcome URLä¸Šæ”¶åˆ°çš„ä»»ä½•è¯·æ±‚éƒ½ç”±WelcomeControllerç±»å¤„ç†ã€‚ä¸€æ—¦æ§åˆ¶å™¨ç±»å¤„ç†äº†è¯·æ±‚ï¼Œå®ƒå°†è°ƒç”¨å§”æ‰˜ç»™æ§åˆ¶å™¨ä¸­å£°æ˜çš„é»˜è®¤HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•ã€‚è¿™ç§è¡Œä¸ºçš„åŸå› æ˜¯URLä¸Šçš„æ¯ä¸ªåˆå§‹è¯·æ±‚éƒ½å±äºHTTP GETç±»å‹ã€‚å› æ­¤ï¼Œå½“æ§åˆ¶å™¨å¤„ç†/welcome URLä¸Šçš„è¯·æ±‚æ—¶ï¼Œå®ƒéšåå§”æ‰˜ç»™é»˜è®¤çš„HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚æ³¨é‡Š@RequestMapping(method = RequestMethod.GET)ç”¨äºå°†welcomeæ–¹æ³•ä¿®é¥°ä¸ºæ§åˆ¶å™¨çš„é»˜è®¤HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰å£°æ˜é»˜è®¤çš„HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡ºServletExceptionã€‚å› æ­¤ï¼Œå¯¹äºSpring MVCæ§åˆ¶å™¨æ¥è¯´ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªURLè·¯ç”±å’Œé»˜è®¤çš„HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™ç§æ–¹æ³•çš„å¦ä¸€ç§å˜ä½“æ˜¯åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨çš„@RequestMappingæ³¨é‡Šä¸­å£°æ˜value - urlè·¯ç”±å’Œé»˜è®¤çš„HTTP GETå¤„ç†ç¨‹åºã€‚ä¸‹é¢è¯´æ˜æœ¬å£°æ˜: 12345@Controllerpublic class WelcomeController &#123; @RequestMapping(value = \"/welcome\", method=RequestMethod.GET) public String welcome(Model model) &#123; ... &#125;&#125; è¿™ä¸ªå£°æ˜ä¸å‰é¢çš„å£°æ˜æ˜¯ç­‰ä»·çš„ã€‚å€¼å±æ€§æŒ‡ç¤ºåˆ°å…¶ä¸­çš„URLå¤„ç†ç¨‹åºæ–¹æ³•è¢«æ˜ å°„ï¼Œæ–¹æ³•å±æ€§å®šä¹‰å¤„ç†ç¨‹åºæ–¹æ³•ä½œä¸ºæ§åˆ¶å™¨çš„é»˜è®¤HTTP GETæ–¹æ³•ã€‚æœ€åï¼Œè¿˜æœ‰ä¸€äº›æ–¹ä¾¿çš„æ³¨é‡Šï¼Œå¦‚@GetMappingã€@PostMappingç­‰ç­‰ï¼Œä»¥æœ€å°åŒ–é…ç½®ã€‚ä¸‹é¢çš„æ˜ å°„å°†ä¸å‰é¢æåˆ°çš„å£°æ˜ä¸€æ ·: 12345@Controllerpublic class WelcomeController &#123; @GetMapping(\"/welcome\") public String welcome(Model model) &#123; ... &#125;&#125; @GetMappingæ³¨é‡Šä½¿ç±»æ›´çŸ­ï¼Œå¯èƒ½æ›´å®¹æ˜“é˜…è¯»ã€‚æœ€åä¸€ä¸ªæ§åˆ¶å™¨æ¼”ç¤ºäº†Spring MVCçš„åŸºæœ¬åŸç†ã€‚ä½†æ˜¯ï¼Œå…¸å‹çš„æ§åˆ¶å™¨å¯èƒ½è°ƒç”¨åç«¯æœåŠ¡è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨æ¥æŸ¥è¯¢æŸä¸€æ³•é™¢çš„ä¿ç•™å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536package com.apress.springrecipes.court.web;import com.apress.springrecipes.court.domain.Reservation;import com.apress.springrecipes.court.service.ReservationService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RequestParam;import java.util.List;@Controller@RequestMapping(\"/reservationQuery\")public class ReservationQueryController &#123; private final ReservationService reservationService; public ReservationQueryController(ReservationService reservationService) &#123; this.reservationService = reservationService; &#125; @GetMapping public void setupForm() &#123;&#125; @PostMapping public String sumbitForm(@RequestParam(\"courtName\") String courtName, Model model) &#123; List&lt;Reservation&gt; reservations = java.util.Collections.emptyList(); if (courtName != null) &#123; reservations = reservationService.query(courtName); &#125; model.addAttribute(\"reservations\", reservations); return \"reservationQuery\"; &#125;&#125; å¦‚å‰æ‰€è¿°ï¼Œæ§åˆ¶å™¨ç„¶åæŸ¥æ‰¾é»˜è®¤çš„HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•ã€‚ç”±äºå…¬å…±void setupForm()æ–¹æ³•ä¸ºæ­¤åˆ†é…äº†å¿…è¦çš„@RequestMappingæ³¨é‡Šï¼Œå› æ­¤å®ƒè¢«ç§°ä¸ºnextã€‚ä¸å‰é¢çš„é»˜è®¤HTTP GETå¤„ç†ç¨‹åºæ–¹æ³•ä¸åŒï¼Œè¯·æ³¨æ„ï¼Œè¯¥æ–¹æ³•æ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œæ²¡æœ‰é€»è¾‘ï¼Œå¹¶ä¸”å…·æœ‰ä¸€ä¸ªç©ºè¿”å›å€¼ã€‚è¿™æ„å‘³ç€ä¸¤ä»¶äº‹ã€‚ç”±äºæ²¡æœ‰è¾“å…¥å‚æ•°å’Œé€»è¾‘ï¼Œè§†å›¾åªæ˜¾ç¤ºå®ç°æ¨¡æ¿(ä¾‹å¦‚JSP)ä¸­ç¡¬ç¼–ç çš„æ•°æ®ï¼Œå› ä¸ºæ²¡æœ‰æ§åˆ¶å™¨æ­£åœ¨æ·»åŠ æ•°æ®ã€‚å¦‚æœè¿”å›å€¼ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åŸºäºè¯·æ±‚URLçš„é»˜è®¤è§†å›¾å;å› æ­¤ï¼Œç”±äºè¯·æ±‚URLæ˜¯/reservationæŸ¥è¯¢ï¼Œå› æ­¤å‡è®¾æœ‰ä¸€ä¸ªåä¸ºreservationQueryçš„è¿”å›è§†å›¾ã€‚ å…¶ä½™çš„å¤„ç†ç¨‹åºæ–¹æ³•ä½¿ç”¨@PostMappingæ³¨é‡Šè¿›è¡Œä¿®é¥°ã€‚ä¹ä¸€çœ‹ï¼Œåªæœ‰ç±»çº§/reservationæŸ¥è¯¢URLè¯­å¥çš„ä¸¤ä¸ªå¤„ç†ç¨‹åºæ–¹æ³•å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼Œä½†å®é™…ä¸Šéå¸¸ç®€å•ã€‚å½“åœ¨/reservationæŸ¥è¯¢URLä¸Šå‘å‡ºHTTP GETè¯·æ±‚æ—¶ï¼Œå°†è°ƒç”¨ä¸€ä¸ªæ–¹æ³•;å½“HTTP POSTè¯·æ±‚åœ¨åŒä¸€ä¸ªURLä¸Šè¿›è¡Œæ—¶ï¼Œè°ƒç”¨å¦ä¸€ä¸ªã€‚webåº”ç”¨ç¨‹åºä¸­çš„å¤§å¤šæ•°è¯·æ±‚éƒ½æ˜¯HTTP GETç±»å‹ï¼Œè€ŒHTTP POSTç±»å‹çš„è¯·æ±‚é€šå¸¸æ˜¯åœ¨ç”¨æˆ·æäº¤HTMLè¡¨å•æ—¶å‘å‡ºçš„ã€‚å› æ­¤ï¼Œæ­ç¤ºæ›´å¤šåº”ç”¨ç¨‹åºçš„è§†å›¾(æˆ‘ä»¬å°†å¾ˆå¿«æè¿°å®ƒ)ï¼Œåœ¨åˆå§‹åŠ è½½HTMLè¡¨å•æ—¶è°ƒç”¨ä¸€ä¸ªæ–¹æ³•(å³:ï¼Œè€Œå¦ä¸€ä¸ªåœ¨æäº¤HTMLè¡¨å•æ—¶è¢«è°ƒç”¨(ä¾‹å¦‚ã€‚HTTP POST)ã€‚ä»”ç»†æŸ¥çœ‹HTTP POSTé»˜è®¤å¤„ç†ç¨‹åºæ–¹æ³•ï¼Œè¯·æ³¨æ„è¿™ä¸¤ä¸ªè¾“å…¥å‚æ•°ã€‚é¦–å…ˆæ³¨æ„@RequestParam(â€œcourtNameâ€)å­—ç¬¦ä¸²courtNameå£°æ˜ï¼Œç”¨äºæå–åä¸ºcourtNameçš„è¯·æ±‚å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHTTP POSTè¯·æ±‚ä»¥è¡¨å•/reservationæŸ¥è¯¢çš„å½¢å¼å‡ºç°?courtName = &lt;ä»·å€¼&gt;;æ­¤å£°æ˜ä½¿æ–¹æ³•ä¸­çš„å˜é‡courtNameä¸‹çš„å€¼å¯ç”¨ã€‚å…¶æ¬¡ï¼Œè¯·æ³¨æ„æ¨¡å‹å£°æ˜ï¼Œå®ƒç”¨äºå®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿å°†æ•°æ®ä¼ é€’åˆ°è¿”å›çš„è§†å›¾ã€‚å¤„ç†ç¨‹åºæ–¹æ³•æ‰§è¡Œçš„é€»è¾‘åŒ…æ‹¬ä½¿ç”¨æ§åˆ¶å™¨çš„é¢„è®¢æœåŠ¡æ¥ä½¿ç”¨courtNameå˜é‡æ‰§è¡ŒæŸ¥è¯¢ã€‚ä»è¯¥æŸ¥è¯¢è·å¾—çš„ç»“æœè¢«åˆ†é…ç»™æ¨¡å‹å¯¹è±¡ï¼Œæ¨¡å‹å¯¹è±¡ç¨åå°†å¯ç”¨äºæ˜¾ç¤ºçš„è¿”å›è§†å›¾ã€‚æœ€åï¼Œæ³¨æ„è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªåä¸ºreservationQueryçš„è§†å›¾ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥è¿”å›voidï¼Œå°±åƒé»˜è®¤çš„HTTP GETä¸€æ ·ï¼Œå¹¶ä¸”ç”±äºè¯·æ±‚URLè€Œè¢«åˆ†é…ç»™ç›¸åŒçš„reservationQueryé»˜è®¤è§†å›¾ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯ç›¸åŒçš„ã€‚ç°åœ¨æ‚¨å·²ç»äº†è§£äº†Spring MVCæ§åˆ¶å™¨æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œç°åœ¨æ˜¯æ—¶å€™æ¢ç´¢æ§åˆ¶å™¨çš„å¤„ç†ç¨‹åºæ–¹æ³•å°†å…¶ç»“æœå§”æ‰˜ç»™å“ªäº›è§†å›¾äº†ã€‚ åˆ›å»ºJSPè§†å›¾Spring MVCä¸ºä¸åŒçš„è¡¨ç¤ºæŠ€æœ¯æ”¯æŒå¤šç§ç±»å‹çš„è§†å›¾ã€‚å®ƒä»¬åŒ…æ‹¬jspã€HTMLã€PDFã€Excelå·¥ä½œè¡¨(XLS)ã€XMLã€JSONã€Atomå’ŒRSSæè¦ã€JasperReportså’Œå…¶ä»–ç¬¬ä¸‰æ–¹è§†å›¾å®ç°ã€‚åœ¨Spring MVCåº”ç”¨ç¨‹åºä¸­ï¼Œè§†å›¾é€šå¸¸æ˜¯ç”¨JSTLç¼–å†™çš„JSPæ¨¡æ¿ã€‚å½“åº”ç”¨ç¨‹åºçš„web.xmlæ–‡ä»¶ä¸­å®šä¹‰çš„dispatcherservletæ¥æ”¶å¤„ç†ç¨‹åºè¿”å›çš„è§†å›¾åç§°æ—¶ï¼Œå®ƒå°†é€»è¾‘è§†å›¾åç§°è§£æä¸ºè§†å›¾å®ç°ä»¥è¿›è¡Œå‘ˆç°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„CourtConfigurationä¸­é…ç½®InternalResourceViewResolver beanï¼Œä»¥ä¾¿å°†è§†å›¾åè§£æä¸º/WEB-INF/jsp/ç›®å½•ä¸­çš„JSPæ–‡ä»¶ã€‚ 1234567@Beanpublic InternalResourceViewResolver internalResourceViewResolver() &#123; InternalResourceViewResolver viewResolver = new InternalResourceViewResolver(); viewResolver.setPrefix(\"/WEB-INF/jsp/\"); viewResolver.setSuffix(\".jsp\"); return viewResolver;&#125; é€šè¿‡ä½¿ç”¨æœ€åçš„é…ç½®ï¼Œä¸€ä¸ªåä¸ºreservationQueryçš„é€»è¾‘è§†å›¾è¢«å§”æ‰˜ç»™ä½äº/WEB-INF/jsp/reservationQuery.jspçš„è§†å›¾å®ç°ã€‚äº†è§£äº†è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥ä¸ºwelcomeæ§åˆ¶å™¨åˆ›å»ºä»¥ä¸‹JSPæ¨¡æ¿ï¼Œå¹¶å°†å…¶å‘½åä¸ºwelcome.jspå¹¶å°†å…¶æ”¾åœ¨/WEB-INF/ jsp/ç›®å½•ä¸­: 1234567891011&lt;%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Welcome&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;Welcome to Court Reservation System&lt;/h2&gt;Today is &lt;fmt:formatDate value=\"$&#123;today&#125;\" pattern=\"yyyy-MM-dd\" /&gt;. &lt;/body&gt;&lt;/html&gt; åœ¨è¿™ä¸ªJSPæ¨¡æ¿ä¸­ï¼Œæ‚¨ä½¿ç”¨JSTLä¸­çš„fmtæ ‡è®°åº“å°†todayæ¨¡å‹å±æ€§æ ¼å¼åŒ–ä¸ºyyyy-MM-ddæ¨¡å¼ã€‚ä¸è¦å¿˜è®°åœ¨è¿™ä¸ªJSPæ¨¡æ¿çš„é¡¶éƒ¨åŒ…å«fmtæ ‡è®°åº“å®šä¹‰ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥ä¸ºé¢„è®¢æŸ¥è¯¢æ§åˆ¶å™¨åˆ›å»ºå¦ä¸€ä¸ªJSPæ¨¡æ¿ï¼Œå¹¶å°†å…¶å‘½åä¸ºreservationQuery.jspä»¥åŒ¹é…è§†å›¾åç§°ã€‚ 123456789101112131415161718192021222324252627282930313233&lt;%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %&gt;&lt;%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Reservation Query&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form method=\"post\"&gt;Court Name&lt;input type=\"text\" name=\"courtName\" value=\"$&#123;courtName&#125;\" /&gt;&lt;input type=\"submit\" value=\"Query\" /&gt;&lt;/form&gt;&lt;table border=\"1\"&gt; &lt;tr&gt; &lt;th&gt;Court Name&lt;/th&gt; &lt;th&gt;Date&lt;/th&gt; &lt;th&gt;Hour&lt;/th&gt; &lt;th&gt;Player&lt;/th&gt; &lt;/tr&gt; &lt;c:forEach items=\"$&#123;reservations&#125;\" var=\"reservation\"&gt; &lt;tr&gt; &lt;td&gt;$&#123;reservation.courtName&#125;&lt;/td&gt; &lt;td&gt;&lt;fmt:formatDate value=\"$&#123;reservation.date&#125;\" pattern=\"yyyy-MM-dd\" /&gt;&lt;/td&gt; &lt;td&gt;$&#123;reservation.hour&#125;&lt;/td&gt; &lt;td&gt;$&#123;reservation.player.name&#125;&lt;/td&gt; &lt;/tr&gt; &lt;/c:forEach&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt; åœ¨è¿™ä¸ªJSPæ¨¡æ¿ä¸­ï¼Œæ‚¨åŒ…å«äº†ä¸€ä¸ªè¡¨å•ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ä»–ä»¬æƒ³æŸ¥è¯¢çš„æ³•é™¢åç§°ï¼Œç„¶åä½¿ç”¨&lt;c:forEach&gt;æ ‡è®°æ¥å¾ªç¯é¢„è®¢çš„æ¨¡å‹å±æ€§æ¥ç”Ÿæˆç»“æœè¡¨ã€‚ éƒ¨ç½²Webåº”ç”¨ç¨‹åºåœ¨webåº”ç”¨ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®å®‰è£…æœ¬åœ°Java EEåº”ç”¨æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨é™„å¸¦ç”¨äºæµ‹è¯•å’Œè°ƒè¯•çš„webå®¹å™¨ã€‚ä¸ºäº†ä¾¿äºé…ç½®å’Œéƒ¨ç½²ï¼Œæˆ‘ä»¬é€‰æ‹©äº†Apache Tomcat 8.5ã€‚xä½œä¸ºwebå®¹å™¨ã€‚è¿™ä¸ªwebå®¹å™¨çš„éƒ¨ç½²ç›®å½•ä½äºwebappsç›®å½•ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTomcatç›‘å¬ç«¯å£8080ï¼Œå¹¶å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°åº”ç”¨ç¨‹åºWARçš„åŒåä¸Šä¸‹æ–‡ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å°†åº”ç”¨ç¨‹åºæ‰“åŒ…åˆ°ä¸€ä¸ªåä¸ºcourtçš„WARä¸­ã€‚warã€æ¬¢è¿æ§åˆ¶å™¨å’Œé¢„è®¢æŸ¥è¯¢æ§åˆ¶å™¨å¯ä»¥é€šè¿‡ä»¥ä¸‹urlè®¿é—®: 12http://localhost:8080/court/welcomehttp://localhost:8080/court/reservationQuery æç¤ºé¡¹ç›®è¿˜å¯ä»¥ä½¿ç”¨app. run ../gradlew buildDockeråˆ›å»ºä¸€ä¸ªDockerå®¹å™¨ï¼Œä»¥è·å¾—ä¸€ä¸ªåŒ…å«tomcatå’Œåº”ç”¨ç¨‹åºçš„å®¹å™¨ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥å¯åŠ¨ä¸€ä¸ªDockerå®¹å™¨æ¥æµ‹è¯•åº”ç”¨ç¨‹åº(docker run -p 8080:8080 spring-recipes-4th/court-web). 1234567891011121314151617181920package com.apress.springrecipes.court.web;import com.apress.springrecipes.court.config.CourtConfiguration;import org.springframework.web.servlet.support. AbstractAnnotationConfigDispatcherServletInitializer;public class CourtWebApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer &#123; @Override protected Class&lt;?&gt;[] getRootConfigClasses() &#123; return null; &#125; @Override protected Class&lt;?&gt;[] getServletConfigClasses() &#123; return new Class[] &#123;CourtConfiguration.class&#125;; &#125; @Override protected String[] getServletMappings() &#123; return new String[] &#123; \"/\"&#125;; &#125;&#125;","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","slug":"Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","permalink":"https://jigangduan.github.io/categories/Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"}]},{"title":"Spring æ ¸å¿ƒä»»åŠ¡","slug":"Spring-5-Recipes-2","date":"2018-07-29T10:05:28.000Z","updated":"2020-07-25T02:57:18.165Z","comments":true,"path":"2018/07/29/Spring-5-Recipes-2/","link":"","permalink":"https://jigangduan.github.io/2018/07/29/Spring-5-Recipes-2/","excerpt":"","text":"åœ¨æœ¬ç« ä¸­ï¼Œæ‚¨å°†äº†è§£ä¸Springç›¸å…³çš„æ ¸å¿ƒä»»åŠ¡ã€‚Springæ¡†æ¶çš„æ ¸å¿ƒæ˜¯Springæ§åˆ¶åè½¬(Io0043)å®¹å™¨ã€‚IoCå®¹å™¨ç”¨äºç®¡ç†å’Œé…ç½®æ™®é€šçš„æ—§Javaå¯¹è±¡(POJOs)ã€‚å› ä¸ºSpringæ¡†æ¶çš„ä¸»è¦è¯‰æ±‚ä¹‹ä¸€æ˜¯ä½¿ç”¨pojoæ„å»ºJavaåº”ç”¨ç¨‹åºï¼ŒSpringçš„è®¸å¤šæ ¸å¿ƒä»»åŠ¡éƒ½æ¶‰åŠåˆ°åœ¨IoCå®¹å™¨ä¸­ç®¡ç†å’Œé…ç½®POJOsã€‚ å› æ­¤ï¼Œæ— è®ºæ‚¨æ‰“ç®—åœ¨webåº”ç”¨ç¨‹åºã€ä¼ä¸šé›†æˆæˆ–å…¶ä»–ç±»å‹çš„é¡¹ç›®ä¸­ä½¿ç”¨Springæ¡†æ¶ï¼Œä½¿ç”¨pojoå’ŒIoCå®¹å™¨æ˜¯æ‚¨éœ€è¦é‡‡å–çš„ç¬¬ä¸€æ­¥ã€‚æœ¬ç« çš„å¤§éƒ¨åˆ†é£Ÿè°±æ¶µç›–äº†æ‚¨å°†åœ¨æœ¬ä¹¦ä¸­ä½¿ç”¨çš„ä»»åŠ¡ï¼Œå¹¶åœ¨æ—¥å¸¸åŸºç¡€ä¸Šå¼€å‘Springåº”ç”¨ç¨‹åºã€‚ â– æ³¨æ„æœ¯è¯­ä½¿ç”¨POJO beanäº¤æ›¿ä½¿ç”¨å®ä¾‹åœ¨æ˜¥å¤©åœ¨è¿™æœ¬ä¹¦å’Œæ–‡æ¡£ã€‚ä¸¤è€…éƒ½å¼•ç”¨ä»Javaç±»åˆ›å»ºçš„å¯¹è±¡å®ä¾‹ã€‚æ­¤å¤–ï¼Œåœ¨æœ¬ä¹¦å’ŒSpringæ–‡æ¡£ä¸­ï¼Œæœ¯è¯­ç»„ä»¶å¯ä¸POJOç±»äº’æ¢ä½¿ç”¨ã€‚ä¸¤è€…éƒ½å¼•ç”¨åˆ›å»ºå¯¹è±¡å®ä¾‹çš„å®é™…Javaç±»ã€‚â– æç¤ºä¸‹è½½çš„æºä»£ç ç»„ç»‡ä½¿ç”¨Gradle(é€šè¿‡GradleåŒ…è£…å™¨)æ¥æ„å»ºèœè°±åº”ç”¨ç¨‹åºã€‚Gradleå°†è´Ÿè´£åŠ è½½æ‰€æœ‰å¿…éœ€çš„Javaç±»å’Œä¾èµ–é¡¹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œçš„JARæ–‡ä»¶ã€‚ç¬¬1ç« æè¿°äº†å¦‚ä½•è®¾ç½®æ¸å˜å·¥å…·ã€‚æ­¤å¤–ï¼Œå¦‚æœä¸€ä¸ªèœè°±æ¼”ç¤ºäº†ä¸æ­¢ä¸€ç§æ–¹æ³•ï¼Œé‚£ä¹ˆæºä»£ç å°†ä½¿ç”¨ç½—é©¬å­—æ¯(ä¾‹å¦‚Recipe_2_1_iã€Recipe_2_1_iiã€Recipe_2_1_iiiç­‰)è¿›è¡Œåˆ†ç±»ã€‚ è¦æ„å»ºæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯·è¿›å…¥Recipeç›®å½•(ä¾‹å¦‚Ch2/Recipe_2_1_i/)å¹¶æ‰§è¡Œ./gradlewæ„å»ºå‘½ä»¤æ¥ç¼–è¯‘æºä»£ç ã€‚ç¼–è¯‘æºä»£ç ä¹‹åï¼Œå°†ä½¿ç”¨åº”ç”¨ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶åˆ›å»ºä¸€ä¸ªbuild/libså­ç›®å½•ã€‚ç„¶åå¯ä»¥ä»å‘½ä»¤è¡Œè¿è¡Œåº”ç”¨ç¨‹åºJAR(ä¾‹å¦‚ï¼Œjava -jar Recipe_2_1_i-4.0.0.jar)ã€‚ ä½¿ç”¨Javaé…ç½®æ¥é…ç½®POJOsé—®é¢˜æ‚¨å¸Œæœ›ä½¿ç”¨Springçš„IoCå®¹å™¨ç®¡ç†å¸¦æœ‰æ³¨é‡Šçš„POJOsã€‚ è§£å†³æ–¹æ¡ˆè®¾è®¡ä¸€ä¸ªPOJOç±»ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨@Configurationå’Œ@Beanæ³¨é‡Šåˆ›å»ºä¸€ä¸ªJavaé…ç½®ç±»ï¼Œä»¥é…ç½®POJOå®ä¾‹å€¼ï¼Œæˆ–è€…ä½¿ç”¨@Componentã€@Repositoryã€@Serviceæˆ–@Controlleræ³¨é‡Šè®¾ç½®Javaç»„ä»¶ï¼Œä»¥ç¨ååˆ›å»ºPOJOå®ä¾‹å€¼ã€‚æ¥ä¸‹æ¥ï¼Œå®ä¾‹åŒ–Spring IoCå®¹å™¨ï¼Œä»¥ä½¿ç”¨æ³¨é‡Šæ‰«æJavaç±»ã€‚ç„¶åå¯ä»¥è®¿é—®POJOå®ä¾‹æˆ–beanå®ä¾‹ï¼Œå°†å®ƒä»¬ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‡è®¾æ‚¨è¦å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥ç”Ÿæˆåºåˆ—å·ï¼Œå¹¶ä¸”éœ€è¦è®¸å¤šç³»åˆ—çš„åºåˆ—å·æ¥æ»¡è¶³ä¸åŒçš„ç”¨é€”ã€‚æ¯ä¸ªåºåˆ—éƒ½æœ‰è‡ªå·±çš„å‰ç¼€ã€åç¼€å’Œåˆå§‹å€¼ã€‚å› æ­¤ï¼Œæ‚¨å¿…é¡»ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºå’Œç»´æŠ¤å¤šä¸ªç”Ÿæˆå™¨å®ä¾‹ã€‚åˆ›å»ºä¸€ä¸ªPOJOç±»æ¥ä½¿ç”¨Javaé…ç½®åˆ›å»ºbeanã€‚ æŒ‰ç…§è¦æ±‚ï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå±æ€§çš„SequenceGeneratorç±»:å‰ç¼€ã€åç¼€å’Œinitialã€‚æ‚¨è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªç§æœ‰å­—æ®µè®¡æ•°å™¨æ¥å­˜å‚¨æ¯ä¸ªç”Ÿæˆå™¨çš„æ•°å€¼ã€‚æ¯æ¬¡åœ¨ç”Ÿæˆå™¨å®ä¾‹ä¸Šè°ƒç”¨getSequence()æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šå¾—åˆ°æœ€åä¸€ä¸ªåºåˆ—å·ï¼Œå…¶ä¸­åŒ…å«å‰ç¼€å’Œåç¼€ã€‚ 12345678910111213141516171819202122232425262728293031323334package com.apress.springrecipes.sequence;import java.util.concurrent.atomic.AtomicInteger;public class SequenceGenerator &#123; private String prefix; private String suffix; private int initial; private final AtomicInteger counter = new AtomicInteger(); public SequenceGenerator() &#123; &#125; public void setPrefix(String prefix) &#123; this.prefix = prefix; &#125; public void setSuffix(String suffix) &#123; this.suffix = suffix; &#125; public void setInitial(int initial) &#123; this.initial = initial; &#125; public String getSequence() &#123; StringBuilder builder = new StringBuilder(); builder.append(prefix) .append(initial) .append(counter.getAndIncrement()) .append(suffix); return builder.toString(); &#125;&#125; ä½¿ç”¨@Configurationå’Œ@Beanåˆ›å»ºä¸€ä¸ªJavaé…ç½®æ¥åˆ›å»ºPOJOsè¦åœ¨Spring IoCå®¹å™¨ä¸­å®šä¹‰POJOç±»çš„å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨å®ä¾‹åŒ–å€¼åˆ›å»ºä¸€ä¸ªJavaé…ç½®ç±»ã€‚å¸¦æœ‰POJOæˆ–beanå®šä¹‰çš„Javaé…ç½®ç±»å¦‚ä¸‹: 1234567891011121314151617package com.apress.springrecipes.sequence.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import com.apress.springrecipes.sequence.SequenceGenerator;@Configurationpublic class SequenceGeneratorConfiguration &#123; @Bean public SequenceGenerator sequenceGenerator() &#123; SequenceGenerator seqgen = new SequenceGenerator(); seqgen.setPrefix(\"30\"); seqgen.setSuffix(\"A\"); seqgen.setInitial(\"100000\"); return seqgen; &#125;&#125; æ³¨æ„ï¼ŒSequenceGeneratorConfigurationç±»è¢«@Configurationæ³¨é‡Šä¿®é¥°;è¿™å‘Šè¯‰Springå®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚å½“Springé‡åˆ°å¸¦æœ‰@Configurationæ³¨é‡Šçš„ç±»æ—¶ï¼Œå®ƒä¼šåœ¨ç±»ä¸­æŸ¥æ‰¾beanå®ä¾‹å®šä¹‰ï¼Œè¿™æ˜¯ç”¨@Beanæ³¨é‡Šä¿®é¥°çš„Javaæ–¹æ³•ã€‚Javaæ–¹æ³•åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªbeanå®ä¾‹ã€‚ ä½¿ç”¨@Beanæ³¨é‡Šä¿®é¥°çš„ä»»ä½•æ–¹æ³•å®šä¹‰éƒ½ä¼šåŸºäºæ–¹æ³•åç”Ÿæˆä¸€ä¸ªbeanåã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨nameå±æ€§æ˜¾å¼åœ°åœ¨@Beanæ³¨é‡Šä¸­æŒ‡å®šbeanåç§°ã€‚ä¾‹å¦‚ï¼Œ@Bean(name=â€mys1â€)ä½¿beanå¯ç”¨ä½œmys1ã€‚ â– æ³¨æ„å¦‚æœæ‚¨æ˜¾å¼åœ°æŒ‡å®šbeanåç§°,æ–¹æ³•åè¢«å¿½ç•¥çš„beanåˆ›å»ºã€‚ å®ä¾‹åŒ–Spring IoCå®¹å™¨ä»¥æ‰«ææ³¨é‡Šæ‚¨å¿…é¡»å®ä¾‹åŒ–Spring IoCå®¹å™¨æ¥æ‰«æåŒ…å«æ³¨é‡Šçš„Javaç±»ã€‚è¿™æ ·ï¼ŒSpringå°†æ£€æµ‹@Configurationå’Œ@Beanæ³¨é‡Šï¼Œä»¥ä¾¿ä»¥åå¯ä»¥ä»IoCå®¹å™¨æœ¬èº«è·å¾—beanå®ä¾‹ã€‚ Springæä¾›äº†ä¸¤ç§ç±»å‹çš„IoCå®¹å™¨å®ç°ã€‚æœ€åŸºæœ¬çš„ä¸€ä¸ªå«åšbean factoryã€‚æ›´é«˜çº§çš„ç§°ä¸ºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå®ƒä¸beanå·¥å‚å…¼å®¹ã€‚æ³¨æ„ï¼Œè¿™ä¸¤ç§IoCå®¹å™¨çš„é…ç½®æ–‡ä»¶æ˜¯ç›¸åŒçš„ã€‚ åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æä¾›æ¯”beanå·¥å‚æ›´é«˜çº§çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¿æŒåŸºæœ¬ç‰¹æ€§çš„å…¼å®¹æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œé™¤éåº”ç”¨ç¨‹åºçš„èµ„æºå—åˆ°é™åˆ¶(ä¾‹å¦‚ï¼Œå½“ä¸ºä¸€ä¸ªappletè¿è¡ŒSpringæ—¶ï¼Œæˆ–è€…ç§»åŠ¨è®¾å¤‡)ã€‚beanå·¥å‚çš„æ¥å£å’Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆ†åˆ«æ˜¯BeanFactoryå’ŒApplicationContextã€‚ApplicationContextæ¥å£æ˜¯BeanFactoryçš„ä¸€ä¸ªå­æ¥å£ï¼Œç”¨äºç»´æŠ¤å…¼å®¹æ€§ã€‚ ç”±äºApplicationContextæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‚¨å¿…é¡»å®ä¾‹åŒ–ä¸€ä¸ªå®ç°å®ƒã€‚Springæœ‰å‡ ä¸ªåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å®ç°;æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨AnnotationConfigApplicationContextï¼Œè¿™æ˜¯æœ€æ–°ä¸”æœ€çµæ´»çš„å®ç°ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œæ‚¨å¯ä»¥åŠ è½½Javaé…ç½®æ–‡ä»¶ã€‚ 12ApplicationContext context = new AnnotationConfigApplicationContext (SequenceGeneratorConfiguration.class); ä¸€æ—¦å®ä¾‹åŒ–äº†åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå¯¹è±¡å¼•ç”¨(åœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸Šä¸‹æ–‡)æä¾›äº†è®¿é—®POJOå®ä¾‹æˆ–beançš„å…¥å£ç‚¹ã€‚ ä»IoCå®¹å™¨è·å–POJOå®ä¾‹æˆ–beanè¦ä»beanå·¥å‚æˆ–åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è·å–å·²å£°æ˜çš„beanï¼Œåªéœ€è°ƒç”¨getBean()æ–¹æ³•å¹¶ä¼ å…¥æƒŸä¸€çš„beanåç§°ã€‚getBean()æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯java.lang.Objectï¼Œå› æ­¤å¿…é¡»åœ¨ä½¿ç”¨å®ƒä¹‹å‰å°†å®ƒè½¬æ¢ä¸ºå®ƒçš„å®é™…ç±»å‹ã€‚ 12SequenceGenerator generator = (SequenceGenerator) context.getBean(\"sequenceGenerator\"); getBean()æ–¹æ³•è¿˜æ”¯æŒå¦ä¸€ç§å˜ä½“ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æä¾›beanç±»åï¼Œä»¥é¿å…å¼ºåˆ¶è½¬æ¢ã€‚ 1SequenceGenerator generator = context.getBean(\"sequenceGenerator\",SequenceGenerator.class); å¦‚æœåªæœ‰ä¸€ä¸ªbeanï¼Œåˆ™å¯ä»¥çœç•¥è¯¥beançš„åç§°ã€‚ 1SequenceGenerator generator = context.getBean(SequenceGenerator.class); ä¸€æ—¦æ‚¨è¾¾åˆ°è¿™ä¸ªæ­¥éª¤ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨POJOæˆ–beanï¼Œå°±åƒåœ¨Springä¹‹å¤–ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºçš„ä»»ä½•å¯¹è±¡ä¸€æ ·ã€‚è¿è¡Œåºåˆ—ç”Ÿæˆå™¨åº”ç”¨ç¨‹åºçš„ä¸»ç±»å¦‚ä¸‹æ‰€ç¤º: 123456789101112131415package com.apress.springrecipes.sequence;import com.apress.springrecipes.sequence.config.SequenceGeneratorConfiguration;import org.springframework.context.ApplicationContext;import org.springframework.context.annotation.AnnotationConfigApplicationContext;public class Main &#123; public static void main(String[] args) &#123; ApplicationContext context = new AnnotationConfigApplicationContext(SequenceGeneratorConfiguration.class); SequenceGenerator generator = context.getBean(SequenceGenerator.class); System.out.println(generator.getSequence()); System.out.println(generator.getSequence()); &#125;&#125; å¦‚æœJavaç±»è·¯å¾„ä¸­æ‰€æœ‰å†…å®¹éƒ½å¯ç”¨(SequenceGenerator POJOç±»å’ŒSpring JAR)æ‚¨åº”è¯¥çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œä»¥åŠä¸€äº›æ—¥å¿—æ¶ˆæ¯: 1230100000A30100001A ä½¿ç”¨@Componentæ³¨é‡Šåˆ›å»ºPOJOç±»ï¼Œä»¥ä½¿ç”¨DAOåˆ›å»ºBeansåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒSpring beanå®ä¾‹åŒ–æ˜¯é€šè¿‡ç¡¬ç¼–ç Javaé…ç½®ç±»ä¸­çš„å€¼æ¥å®Œæˆçš„ã€‚è¿™æ˜¯ç®€åŒ–Springç¤ºä¾‹çš„é¦–é€‰æ–¹æ³•ã€‚ ç„¶è€Œï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºçš„POJOå®ä¾‹åŒ–è¿‡ç¨‹éƒ½æ˜¯é€šè¿‡æ•°æ®åº“æˆ–ç”¨æˆ·è¾“å…¥å®Œæˆçš„ã€‚æ‰€ä»¥ï¼Œç°åœ¨æ˜¯æ—¶å€™å‘å‰è¿ˆè¿›ï¼Œä½¿ç”¨æ›´çœŸå®çš„åœºæ™¯äº†ã€‚å¯¹äºæœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸŸç±»å’Œæ•°æ®è®¿é—®å¯¹è±¡(DAO)ç±»æ¥åˆ›å»ºpojoã€‚æ‚¨ä»ç„¶ä¸éœ€è¦è®¾ç½®æ•°æ®åº“â€”å®é™…ä¸Šï¼Œæ‚¨å°†åœ¨DAOç±»ä¸­ç¡¬ç¼–ç å€¼â€”ä½†æ˜¯ç†Ÿæ‚‰è¿™ç§ç±»å‹çš„åº”ç”¨ç¨‹åºç»“æ„éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒæ˜¯å¤§å¤šæ•°çœŸå®åº”ç”¨ç¨‹åºå’Œæœªæ¥èœè°±çš„åŸºç¡€ã€‚ å‡è®¾æ‚¨è¢«è¦æ±‚å¼€å‘ä¸€ä¸ªåºåˆ—ç”Ÿæˆå™¨åº”ç”¨ç¨‹åºï¼Œå°±åƒæ‚¨åœ¨å‰ä¸€èŠ‚ä¸­æ‰€åšçš„é‚£æ ·ã€‚æ‚¨éœ€è¦ç¨å¾®ä¿®æ”¹ç±»ç»“æ„ä»¥é€‚åº”åŸŸç±»å’ŒDAOæ¨¡å¼ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºSequenceçš„åŸŸç±»ï¼Œå…¶ä¸­åŒ…å«idã€å‰ç¼€å’Œåç¼€å±æ€§ã€‚ 1234567891011121314151617181920212223package com.apress.springrecipes.sequence;public class Sequence &#123; private final String id; private final String prefix; private final String suffix; public Sequence(String id, String prefix, String suffix) &#123; this.id = id; this.prefix = prefix; this.suffix = suffix; &#125; public String getId() &#123; return id; &#125; public String getPrefix() &#123; return prefix; &#125; public String getSuffix() &#123; return suffix; &#125;&#125; ç„¶åï¼Œä¸ºDAOåˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£è´Ÿè´£ä»æ•°æ®åº“è®¿é—®æ•°æ®ã€‚getSequence()æ–¹æ³•é€šè¿‡IDä»æ•°æ®åº“è¡¨ä¸­åŠ è½½POJOæˆ–Sequenceå¯¹è±¡ï¼Œè€ŒgetNextValue()æ–¹æ³•æ£€ç´¢ç‰¹å®šæ•°æ®åº“åºåˆ—çš„ä¸‹ä¸€ä¸ªå€¼ã€‚ 123456package com.apress.springrecipes.sequence;public interface SequenceDao &#123; public Sequence getSequence(String sequenceId); public int getNextValue(String sequenceId);&#125; åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å°†å®ç°è¿™ä¸ªDAOæ¥å£æ¥ä½¿ç”¨æ•°æ®è®¿é—®æŠ€æœ¯ã€‚ä½†æ˜¯ä¸ºäº†ç®€åŒ–è¿™ä¸ªç¤ºä¾‹ï¼Œæ‚¨å°†åœ¨æ˜ å°„ä¸­å®ç°ä¸€ä¸ªå¸¦æœ‰ç¡¬ç¼–ç å€¼çš„DAOæ¥å­˜å‚¨åºåˆ—å®ä¾‹å’Œå€¼ã€‚ 1234567891011121314151617181920212223242526package com.apress.springrecipes.sequence;import org.springframework.stereotype.Component;import java.util.HashMap;import java.util.Map;import java.util.concurrent.atomic.AtomicInteger;@Component(\"sequenceDao\")public class SequenceDaoImpl implements SequenceDao &#123; private final Map&lt;String, Sequence&gt; sequences = new HashMap&lt;&gt;(); private final Map&lt;String, AtomicInteger&gt; values = new HashMap&lt;&gt;(); public SequenceDaoImpl() &#123; sequences.put(\"IT\", new Sequence(\"IT\", \"30\", \"A\")); values.put(\"IT\", new AtomicInteger(10000)); &#125; public Sequence getSequence(String sequenceId) &#123; return sequences.get(sequenceId); &#125; public int getNextValue(String sequenceId) &#123; AtomicInteger value = values.get(sequenceId); return value.getAndIncrement(); &#125;&#125; è§‚å¯ŸSequenceDaoImplç±»æ˜¯å¦‚ä½•ç”¨@Component(â€œsequenceDaoâ€)æ³¨é‡Šæ¥ä¿®é¥°çš„ã€‚è¿™å°†æ ‡è®°ç±»ï¼Œä»¥ä¾¿Springå¯ä»¥ä»ä¸­åˆ›å»ºPOJOsã€‚@Componentæ³¨é‡Šå†…çš„å€¼å®šä¹‰äº†beanå®ä¾‹IDï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸ºsequenceDaoã€‚å¦‚æœ@Componentæ³¨é‡Šä¸­æ²¡æœ‰æä¾›beanå€¼åï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œbeanåè¢«æŒ‡å®šä¸ºå¤§å†™çš„éé™å®šç±»åã€‚ä¾‹å¦‚ï¼Œå¯¹äºSequenceDaoImplç±»ï¼Œé»˜è®¤çš„beanåç§°æ˜¯SequenceDaoImplã€‚å¯¹getSequenceæ–¹æ³•çš„è°ƒç”¨è¿”å›ç»™å®šsequenceIDçš„å€¼ã€‚å¯¹getNextValueæ–¹æ³•çš„è°ƒç”¨åŸºäºç»™å®šçš„sequenceIDçš„å€¼åˆ›å»ºä¸€ä¸ªæ–°å€¼ï¼Œå¹¶è¿”å›æ–°å€¼ã€‚ POJOsåœ¨åº”ç”¨ç¨‹åºå±‚ä¸­è¢«åˆ†ç±»ã€‚åœ¨Springä¸­ï¼Œæœ‰ä¸‰ä¸ªå±‚:persistence, service, å’Œ presentationã€‚@Componentæ˜¯ä¸€ä¸ªé€šç”¨çš„æ³¨é‡Šï¼Œç”¨äºè£…é¥°ç”¨äºSpringæ£€æµ‹çš„POJOsï¼Œè€Œ@Repositoryã€@Serviceå’Œ@Controlleræ˜¯@Componentçš„ä¸“é—¨åŒ–ï¼Œç”¨äºå¤„ç†ä¸æŒä¹…æ€§ã€æœåŠ¡å’Œè¡¨ç¤ºå±‚ç›¸å…³çš„pojoçš„æ›´å…·ä½“çš„æƒ…å†µã€‚ å¦‚æœæ‚¨ä¸ç¡®å®šPOJOçš„ç”¨é€”ï¼Œå¯ä»¥ä½¿ç”¨@Componentæ³¨é‡Šæ¥ä¿®é¥°å®ƒã€‚ä½†æ˜¯ï¼Œæœ€å¥½å°½å¯èƒ½åœ°ä½¿ç”¨ä¸“é—¨åŒ–æ³¨é‡Šï¼Œå› ä¸ºè¿™äº›æ³¨é‡Šæä¾›äº†åŸºäºPOJOç›®çš„çš„é¢å¤–åŠŸèƒ½(ä¾‹å¦‚ï¼Œ@Repositoryå°†å¼‚å¸¸åŒ…è£…ä¸ºDataAccessExceptionsï¼Œè¿™ä½¿è°ƒè¯•æ›´å®¹æ˜“)ã€‚ ç”¨è¿‡æ»¤å™¨å®ä¾‹åŒ–Spring IoCå®¹å™¨ï¼Œä»¥æ‰«ææ³¨é‡Šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringæ£€æµ‹æ‰€æœ‰ä½¿ç”¨@Configurationã€@Beanã€@Componentã€@Repositoryã€@Serviceå’Œ@Controlleræ³¨é‡Šçš„ç±»ï¼Œä»¥åŠå…¶ä»–ã€‚æ‚¨å¯ä»¥è‡ªå®šä¹‰æ‰«æè¿‡ç¨‹ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«/æ’é™¤è¿‡æ»¤å™¨ã€‚å½“JavaåŒ…æœ‰å‡ åæˆ–å‡ ç™¾ä¸ªç±»æ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚å¯¹äºæŸäº›Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå¯èƒ½éœ€è¦æ’é™¤æˆ–åŒ…å«å¸¦æœ‰ç‰¹å®šæ³¨é‡Šçš„pojoã€‚ â– è­¦å‘Šæ‰«ææ¯ä¸ªåŒ…éƒ½å¯ä»¥é™ä½ä¸å¿…è¦çš„å¯åŠ¨è¿‡ç¨‹ã€‚ Springæ”¯æŒå››ç§ç±»å‹çš„è¿‡æ»¤å™¨è¡¨è¾¾å¼ã€‚æ³¨é‡Šå’Œå¯åˆ†é…çš„ç±»å‹æ˜¯æŒ‡å®šä¸€ä¸ªæ³¨é‡Šç±»å‹å’Œä¸€ä¸ªç”¨äºè¿‡æ»¤çš„ç±»/æ¥å£ã€‚regexå’Œaspectjç±»å‹å…è®¸æ‚¨æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼å’Œaspectjåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥åŒ¹é…ç±»ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨use-default-filterså±æ€§ç¦ç”¨é»˜è®¤è¿‡æ»¤å™¨ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç»„ä»¶æ‰«æåŒ…æ‹¬com.apress.springrecipeä¸­çš„æ‰€æœ‰ç±»ã€‚åºåˆ—ï¼Œå…¶åç§°åŒ…å«å•è¯Daoæˆ–æœåŠ¡ï¼Œå¹¶æ’é™¤å¸¦æœ‰@Controlleræ³¨é‡Šçš„ç±»: 123456789101112@ComponentScan( includeFilters = &#123; @ComponentScan.Filter( type = FilterType.REGEX, pattern = &#123;\"com.apress.springrecipes.sequence.*Dao\", \"com.apress.springrecipes.sequence.*Service\"&#125;) &#125;, excludeFilters = &#123; @ComponentScan.Filter( type = FilterType.ANNOTATION, classes = &#123;org.springframework.stereotype.Controller.class&#125;) &#125;) å½“åº”ç”¨åŒ…å«è¿‡æ»¤å™¨æ—¶ï¼Œå¯ä»¥æ£€æµ‹æ‰€æœ‰åç§°åŒ…å«â€œDaoâ€æˆ–â€œæœåŠ¡â€çš„ç±»ã€‚æ²¡æœ‰æ³¨é‡Šçš„ç±»è¢«è‡ªåŠ¨æ£€æµ‹ã€‚ ä»IoCå®¹å™¨è·å–POJOå®ä¾‹æˆ–beanç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸»è¦ç±»æ¥æµ‹è¯•å‰é¢çš„ç»„ä»¶: 1234567891011121314package com.apress.springrecipes.sequence;import org.springframework.context.ApplicationContext;import org.springframework.context.annotation.AnnotationConfigApplicationContext;public class Main &#123; public static void main(String[] args) &#123; ApplicationContext context = new AnnotationConfigApplicationContext(\"com.apress.springrecipes.sequence\"); SequenceDao sequenceDao = context.getBean(SequenceDao.class); System.out.println(sequenceDao.getNextValue(\"IT\")); System.out.println(sequenceDao.getNextValue(\"IT\")); &#125;&#125; é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºPOJOsé—®é¢˜ æ‚¨å¸Œæœ›é€šè¿‡è°ƒç”¨å…¶æ„é€ å‡½æ•°åœ¨Spring IoCå®¹å™¨ä¸­åˆ›å»ºPOJOå®ä¾‹æˆ–beanï¼Œè¿™æ˜¯åˆ›å»ºbeançš„æœ€å¸¸è§å’Œæœ€ç›´æ¥çš„æ–¹å¼ã€‚è¿™ç›¸å½“äºä½¿ç”¨æ–°çš„æ“ä½œç¬¦åœ¨Javaä¸­åˆ›å»ºå¯¹è±¡ã€‚ è§£å†³æ–¹æ¡ˆ ä½¿ç”¨æ„é€ å‡½æ•°æˆ–æ„é€ å‡½æ•°å®šä¹‰POJOç±»ã€‚æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªJavaé…ç½®ç±»ï¼Œç”¨æ„é€ å‡½æ•°ä¸ºSpring IoCå®¹å™¨é…ç½®POJOå®ä¾‹å€¼ã€‚æ¥ä¸‹æ¥ï¼Œå®ä¾‹åŒ–Spring IoCå®¹å™¨ï¼Œä»¥ä½¿ç”¨æ³¨é‡Šæ‰«æJavaç±»ã€‚POJOå®ä¾‹æˆ–beanå®ä¾‹å¯ä»¥ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å‡è®¾æ‚¨è¦å¼€å‘ä¸€ä¸ªå•†åº—åº”ç”¨ç¨‹åºæ¥åœ¨çº¿é”€å”®äº§å“ã€‚é¦–å…ˆï¼Œåˆ›å»ºProduct POJOç±»ï¼Œå®ƒæœ‰å‡ ä¸ªå±æ€§ï¼Œæ¯”å¦‚äº§å“åç§°å’Œä»·æ ¼ã€‚ç”±äºæ‚¨çš„å•†åº—ä¸­æœ‰è®¸å¤šç±»å‹çš„äº§å“ï¼Œæ‰€ä»¥æ‚¨å°†äº§å“ç±»æŠ½è±¡ä¸ºä¸åŒçš„äº§å“å­ç±»æ‰©å±•å®ƒã€‚ 123456789101112131415161718package com.apress.springrecipes.shop;public abstract class Product &#123; private String name; private double price; public Product() &#123;&#125; public Product(String name, double price) &#123; this.name = name; this.price = price; &#125; // Getters and Setters ... public String toString() &#123; return name + \" \" + price; &#125;&#125; ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºPOJOç±»ç„¶ååˆ›å»ºä¸¤ä¸ªäº§å“å­ç±»:ç”µæ± å’Œç£ç›˜ã€‚å®ƒä»¬æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„å±æ€§ã€‚ 12345678910111213141516171819202122232425package com.apress.springrecipes.shop;public class Battery extends Product &#123; private boolean rechargeable; public Battery() &#123; super(); &#125; public Battery(String name, double price) &#123; super(name, price); &#125; // Getters and Setters ...&#125;package com.apress.springrecipes.shop;public class Disc extends Product &#123; private int capacity; public Disc() &#123; super(); &#125; public Disc(String name, double price) &#123; super(name, price); &#125; // Getters and Setters ...&#125; ä¸ºPOJOåˆ›å»ºä¸€ä¸ªJavaé…ç½®è¦åœ¨Spring IoCå®¹å™¨ä¸­å®šä¹‰POJOç±»çš„å®ä¾‹ï¼Œå¿…é¡»åˆ›å»ºå…·æœ‰å®ä¾‹åŒ–å€¼çš„Javaé…ç½®ç±»ã€‚é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°ç”Ÿæˆå…·æœ‰POJOæˆ–beanå®šä¹‰çš„Javaé…ç½®ç±»åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: 1234567891011121314151617181920212223package com.apress.springrecipes.shop.config;import com.apress.springrecipes.shop.Battery;import com.apress.springrecipes.shop.Disc;import com.apress.springrecipes.shop.Product;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class ShopConfiguration &#123; @Bean public Product aaa() &#123; Battery p1 = new Battery(\"AAA\", 2.5); p1.setRechargeable(true); return p1; &#125; @Bean public Product cdrw() &#123; Disc p2 = new Disc(\"CD-RW\", 1.5); p2.setCapacity(700); return p2; &#125;&#125; æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä»Spring IoCå®¹å™¨ä¸­æ£€ç´¢äº§å“ï¼Œæ‚¨å¯ä»¥ç¼–å†™ä»¥ä¸‹ä¸»è¦ç±»æ¥æµ‹è¯•äº§å“: 123456789101112131415package com.apress.springrecipes.shop;import com.apress.springrecipes.shop.config.ShopConfiguration;import org.springframework.context.ApplicationContext;import org.springframework.context.annotation.AnnotationConfigApplicationContext;public class Main &#123; public static void main(String[] args) throws Exception &#123; ApplicationContext context = new AnnotationConfigApplicationContext(ShopConfiguration.class); Product aaa = context.getBean(\"aaa\", Product.class); Product cdrw = context.getBean(\"cdrw\", Product.class); System.out.println(aaa); System.out.println(cdrw); &#125;&#125; ä½¿ç”¨POJOå¼•ç”¨å’Œè‡ªåŠ¨è¿æ¥ä¸å…¶ä»–POJOäº¤äº’é—®é¢˜ ç»„æˆåº”ç”¨ç¨‹åºçš„POJOå®ä¾‹æˆ–beané€šå¸¸éœ€è¦ç›¸äº’åä½œæ‰èƒ½å®Œæˆåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚æ‚¨å¸Œæœ›ä½¿ç”¨æ³¨é‡Šæ¥ä½¿ç”¨POJOå¼•ç”¨å’Œè‡ªåŠ¨è¿æ¥ã€‚ è§£å†³æ–¹æ¡ˆ å¯¹äºJavaé…ç½®ç±»ä¸­å®šä¹‰çš„POJOå®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†Javaä»£ç åœ¨beanä¹‹é—´åˆ›å»ºå¼•ç”¨ã€‚è¦è‡ªåŠ¨è¿æ¥POJOå¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨@Autowiredæ³¨é‡Šæ ‡è®°å­—æ®µã€setteræ–¹æ³•ã€æ„é€ å‡½æ•°ï¼Œç”šè‡³ä»»æ„æ–¹æ³•ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä»‹ç»ä½¿ç”¨æ„é€ å‡½æ•°ã€å­—æ®µå’Œå±æ€§çš„ä¸åŒçš„è‡ªåŠ¨é…çº¿æ–¹æ³•ã€‚æœ€åï¼Œæ‚¨å°†äº†è§£å¦‚ä½•è§£å†³è‡ªåŠ¨è£…é…ä¸­çš„é—®é¢˜ã€‚ åœ¨Javaé…ç½®ç±»ä¸­å¼•ç”¨POJOså½“POJOå®ä¾‹åœ¨Javaé…ç½®ç±»ä¸­å®šä¹‰æ—¶(å¦‚2-1å’Œ2- POJOå¼•ç”¨ä¸­æ‰€ç¤º)ï¼Œä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œå› ä¸ºä¸€åˆ‡éƒ½æ˜¯Javaä»£ç ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œbeanå±æ€§å¼•ç”¨å¦ä¸€ä¸ªbean: 123456789101112131415161718192021222324package com.apress.springrecipes.sequence.config;import com.apress.springrecipes.sequence.DatePrefixGenerator;import com.apress.springrecipes.sequence.SequenceGenerator;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class SequenceConfiguration &#123; @Bean public DatePrefixGenerator datePrefixGenerator() &#123; DatePrefixGenerator dpg = new DatePrefixGenerator(); dpg.setPattern(\"yyyyMMdd\"); return dpg; &#125; @Bean public SequenceGenerator sequenceGenerator() &#123; SequenceGenerator sequence = new SequenceGenerator(); sequence.setInitial(100000); sequence.setSuffix(\"A\"); sequence.setPrefixGenerator(datePrefixGenerator()); return sequence; &#125;&#125; SequenceGeneratorç±»çš„å‰ç¼€ç”Ÿæˆå™¨å±æ€§æ˜¯DatePrefixGenerator beançš„å®ä¾‹ã€‚ç¬¬ä¸€ä¸ªbeanå£°æ˜åˆ›å»ºä¸€ä¸ªDatePrefixGenerator POJOã€‚æŒ‰ç…§çº¦å®šï¼Œbeanå¯ä»¥é€šè¿‡beanåç§°datePrefixGenerator(ä¾‹å¦‚ã€‚æ–¹æ³•å)ã€‚ä½†æ˜¯ç”±äºbeanå®ä¾‹åŒ–é€»è¾‘ä¹Ÿæ˜¯ä¸€ç§æ ‡å‡†çš„Javaæ–¹æ³•ï¼Œå› æ­¤é€šè¿‡è¿›è¡Œæ ‡å‡†Javaè°ƒç”¨ä¹Ÿå¯ä»¥è®¿é—®beanã€‚å½“prefixGeneratorå±æ€§è¢«æ”¾ç½®åˆ°ç¬¬äºŒä¸ªbeanä¸­æ—¶ï¼Œé€šè¿‡setteraå¯¹datePrefixGenerator()æ–¹æ³•è¿›è¡Œæ ‡å‡†çš„Javaè°ƒç”¨ï¼Œä»¥å¼•ç”¨beanã€‚ ä½¿ç”¨@Autowiredæ³¨é‡Šè‡ªåŠ¨è¿æ¥POJOå­—æ®µæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åœ¨2-1çš„ç¬¬äºŒéƒ¨åˆ†ä»‹ç»çš„DAO SequenceDaoImplç±»çš„SequenceDaoå­—æ®µä¸Šä½¿ç”¨è‡ªåŠ¨å¸ƒçº¿ã€‚æ‚¨å°†å‘åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªæœåŠ¡ç±»ï¼Œä»¥è¯´æ˜ä¸DAOç±»çš„è‡ªåŠ¨è¿æ¥ã€‚ä¸€ä¸ªæœåŠ¡ç±»ç”ŸæˆæœåŠ¡å¯¹è±¡æ˜¯å¦ä¸€ä¸ªçœŸå®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºçš„æœ€ä½³å®è·µ,å……å½“facÌ§æ­£é¢ç›´æ¥è®¿é—®DAOs-insteadè®¿é—®DAOsã€‚åœ¨å†…éƒ¨ï¼ŒæœåŠ¡å¯¹è±¡ä¸DAOäº¤äº’ä»¥å¤„ç†åºåˆ—ç”Ÿæˆè¯·æ±‚ã€‚ 1234567891011121314151617181920package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;@Componentpublic class SequenceService &#123; @Autowired private SequenceDao sequenceDao; public void setSequenceDao(SequenceDao sequenceDao) &#123; this.sequenceDao = sequenceDao; &#125; public String generate(String sequenceId) &#123; Sequence sequence = sequenceDao.getSequence(sequenceId); int value = sequenceDao.getNextValue(sequenceId); return sequence.getPrefix() + value + sequence.getSuffix(); &#125;&#125; SequenceServiceç±»ä½¿ç”¨@Componentæ³¨é‡Šè¿›è¡Œä¿®é¥°ã€‚è¿™å…è®¸Springæ£€æµ‹POJOã€‚å› ä¸º@Componentæ³¨é‡Šæ²¡æœ‰åç§°ï¼Œæ‰€ä»¥é»˜è®¤çš„beanåç§°æ˜¯sequenceServiceï¼Œå®ƒåŸºäºç±»åã€‚ SequenceServiceç±»çš„sequenceDaoå±æ€§ä½¿ç”¨@Autowiredæ³¨é‡Šè¿›è¡Œä¿®é¥°ã€‚è¿™å…è®¸Springä½¿ç”¨sequenceDao bean(å³SequenceDaoImplç±»)ã€‚ @Autowiredæ³¨è§£è¿˜å¯ä»¥åº”ç”¨äºæ•°ç»„ç±»å‹çš„å±æ€§ï¼Œä½¿Springè‡ªåŠ¨è¿æ¥æ‰€æœ‰åŒ¹é…çš„beanã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨@Autowiredå¯¹å‰ç¼€ç”Ÿæˆå™¨[]å±æ€§è¿›è¡Œæ³¨é‡Šã€‚ç„¶åï¼ŒSpringå°†ä¸€æ¬¡è‡ªåŠ¨è¿æ¥æ‰€æœ‰ç±»å‹ä¸å‰ç¼€ç”Ÿæˆå™¨å…¼å®¹çš„beanã€‚ 123456789package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;public class SequenceGenerator &#123; @Autowired private PrefixGenerator[] prefixGenerators; ...&#125; å¦‚æœæœ‰å¤šä¸ªbeançš„ç±»å‹ä¸IoCå®¹å™¨ä¸­å®šä¹‰çš„å‰ç¼€ç”Ÿæˆå™¨å…¼å®¹ï¼Œå®ƒä»¬å°†è‡ªåŠ¨æ·»åŠ åˆ°å‰ç¼€ç”Ÿæˆå™¨æ•°ç»„ä¸­ã€‚ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥å°†@Autowiredæ³¨é‡Šåº”ç”¨äºç±»å‹å®‰å…¨çš„é›†åˆã€‚Springå¯ä»¥è¯»å–æ­¤é›†åˆçš„ç±»å‹ä¿¡æ¯ï¼Œå¹¶è‡ªåŠ¨è¿æ¥ç±»å‹å…¼å®¹çš„æ‰€æœ‰beanã€‚ 123456789package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;public class SequenceGenerator &#123; @Autowired private List&lt;PrefixGenerator&gt; prefixGenerators; ...&#125; å¦‚æœSpringæ³¨æ„åˆ°@Autowiredæ³¨é‡Šè¢«åº”ç”¨åˆ°ç±»å‹å®‰å…¨çš„ java.util.Mapï¼Œå­—ç¬¦ä¸²ä¸ºé”®ï¼Œå®ƒå°†æŠŠå…¼å®¹ç±»å‹çš„æ‰€æœ‰bean(ä»¥beanåç§°ä½œä¸ºé”®)æ·»åŠ åˆ°è¿™ä¸ªmapä¸­ã€‚ 12345678package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;public class SequenceGenerator &#123; @Autowired private Map&lt;String, PrefixGenerator&gt; prefixGenerators; ...&#125; ä½¿ç”¨@Autowiredæ³¨è§£çš„Autowire POJOæ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼Œå¹¶å¯é€‰æ‹©è‡ªåŠ¨é…çº¿@Autowiredæ³¨è§£ä¹Ÿå¯ä»¥ç›´æ¥åº”ç”¨äºPOJOçš„setteræ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨@Autowiredå¯¹prefixGeneratorå±æ€§çš„setteræ–¹æ³•è¿›è¡Œæ³¨é‡Šã€‚ç„¶åï¼ŒSpringå°è¯•è¿æ¥ç±»å‹ä¸å‰ç¼€ç”Ÿæˆå™¨å…¼å®¹çš„beanã€‚ 123456789101112package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;public class SequenceGenerator &#123; ... @Autowired public void setPrefixGenerator(PrefixGenerator prefixGenerator) &#123; this.prefixGenerator = prefixGenerator; &#125;&#125; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å¸¦æœ‰@Autowiredçš„å±æ€§éƒ½æ˜¯å¿…éœ€çš„ã€‚å½“Springæ— æ³•æ‰¾åˆ°åŒ¹é…çš„beanæ—¶ï¼Œå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœæ‚¨å¸Œæœ›æŸä¸ªå±æ€§æ˜¯å¯é€‰çš„ï¼Œé‚£ä¹ˆå°†@Autowiredçš„requiredå±æ€§è®¾ç½®ä¸ºfalseã€‚ç„¶åï¼Œå½“Springæ— æ³•æ‰¾åˆ°åŒ¹é…çš„beanæ—¶ï¼Œå®ƒå°†ä¿ç•™æ­¤å±æ€§æœªè®¾ç½®ã€‚ 1234567891011package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;public class SequenceGenerator &#123; ... @Autowired(required=false) public void setPrefixGenerator(PrefixGenerator prefixGenerator) &#123; this.prefixGenerator = prefixGenerator; &#125;&#125; æ‚¨è¿˜å¯ä»¥å°†@Autowiredæ³¨é‡Šåº”ç”¨äºå…·æœ‰ä»»æ„åç§°å’Œä»»æ„æ•°é‡å‚æ•°çš„æ–¹æ³•;åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSpringå°è¯•ç”¨å…¼å®¹çš„ç±»å‹ä¸ºæ¯ä¸€ä¸ªæ–¹æ³•å‚æ•°è¿æ¥ä¸€ä¸ªbeanã€‚ 12345678910package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;public class SequenceGenerator &#123; ... @Autowired public void myOwnCustomInjectionName(PrefixGenerator prefixGenerator) &#123; this.prefixGenerator = prefixGenerator; &#125;&#125; æœ€åï¼Œè¿˜å¯ä»¥å°†@Autowiredæ³¨é‡Šåº”ç”¨åˆ°å¸Œæœ›ç”¨äºè‡ªåŠ¨è¿æ¥çš„æ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å‚æ•°ï¼ŒSpringå°†å°è¯•ä¸ºæ¯ä¸ªæ„é€ å‡½æ•°å‚æ•°è¿æ¥å…·æœ‰å…¼å®¹ç±»å‹çš„beanã€‚ 123456789101112131415@Servicepublic class SequenceService &#123; private final SequenceDao sequenceDao; @Autowired public SequenceService(SequenceDao sequenceDao) &#123; this.sequenceDao=sequenceDao; &#125; public String generate(String sequenceId) &#123; Sequence sequence = sequenceDao.getSequence(sequenceId); int value = sequenceDao.getNextValue(sequenceId); return sequence.getPrefix() + value + sequence.getSuffix(); &#125;&#125; ç”¨æ³¨é‡Šè§£å†³è‡ªåŠ¨è¿æ¥çš„æ¨¡ç³Šæ€§é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“IoCå®¹å™¨ä¸­æœ‰å¤šä¸ªå…·æœ‰å…¼å®¹ç±»å‹çš„beanï¼Œå¹¶ä¸”å±æ€§ä¸æ˜¯ç»„ç±»å‹(å¦‚æ•°ç»„ã€åˆ—è¡¨ã€æ˜ å°„)æ—¶ï¼ŒæŒ‰ç±»å‹è‡ªåŠ¨è¿æ¥å°†ä¸èµ·ä½œç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªç›¸åŒç±»å‹çš„bean: @Primaryæ³¨é‡Šå’Œ@Qualifieræ³¨é‡Šï¼Œåˆ™æœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®ç±»å‹è‡ªåŠ¨è¿æ¥ã€‚ ç”¨@Primaryæ³¨é‡Šè§£å†³è‡ªåŠ¨è¿æ¥çš„æ­§ä¹‰Springå…è®¸æ‚¨é€šè¿‡ä½¿ç”¨@Primaryæ³¨é‡Šè£…é¥°å€™é€‰beanï¼ŒæŒ‰ç±»å‹æŒ‡å®šå€™é€‰beanã€‚@Primaryæ³¨é‡Šåœ¨å¤šä¸ªå€™é€‰å¯¹è±¡ç¬¦åˆè‡ªåŠ¨è¿æ¥å•å€¼ä¾èµ–é¡¹çš„æ¡ä»¶æ—¶ï¼Œä¸ºbeanæä¾›ä¼˜å…ˆçº§ã€‚ 1234567891011121314package com.apress.springrecipes.sequence;...import org.springframework.stereotype.Component;import org.springframework.context.annotation.Primary;@Component@Primarypublic class DatePrefixGenerator implements PrefixGenerator &#123; public String getPrefix() &#123; DateFormat formatter = new SimpleDateFormat(\"yyyyMMdd\"); return formatter.format(new Date()); &#125;&#125; æ³¨æ„ï¼Œå‰é¢çš„POJOå®ç°äº†PrefixGeneratoræ¥å£ï¼Œå¹¶ä½¿ç”¨@Primaryæ³¨é‡Šè¿›è¡Œä¿®é¥°ã€‚å¦‚æœæ‚¨å°è¯•ä½¿ç”¨PrefixGeneratorç±»å‹è‡ªåŠ¨è¿æ¥ä¸€ä¸ªbeanï¼Œå³ä½¿Springæœ‰å¤šä¸ªå…·æœ‰ç›¸åŒPrefixGeneratorç±»å‹çš„beanå®ä¾‹ï¼ŒSpringä¹Ÿä¼šè‡ªåŠ¨è¿æ¥DatePrefixGeneratorï¼Œå› ä¸ºå®ƒä½¿ç”¨@Primaryæ³¨é‡Šè¿›è¡Œæ ‡è®°ã€‚ ç”¨@Qualifieræ³¨è§£è§£å†³è‡ªåŠ¨è¿æ¥çš„æ­§ä¹‰Springè¿˜å…è®¸æ‚¨é€šè¿‡åœ¨@Qualifieræ³¨é‡Šä¸­æä¾›å…¶åç§°æ¥æŒ‰ç±»å‹æŒ‡å®šå€™é€‰beanã€‚ 1234567891011package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Qualifier;public class SequenceGenerator &#123; @Autowired @Qualifier(\"datePrefixGenerator\") private PrefixGenerator prefixGenerator; ...&#125; å®Œæˆæ­¤æ“ä½œä¹‹åï¼ŒSpringå°è¯•åœ¨IoCå®¹å™¨ä¸­æŸ¥æ‰¾å…·æœ‰è¯¥åç§°çš„beanï¼Œå¹¶å°†å…¶è¿æ¥åˆ°å±æ€§ä¸­ã€‚@Qualifieræ³¨é‡Šä¹Ÿå¯ä»¥åº”ç”¨äºè‡ªåŠ¨è¿æ¥çš„æ–¹æ³•å‚æ•°ã€‚ 12345678910111213package com.apress.springrecipes.sequence;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Qualifier;public class SequenceGenerator &#123; ... @Autowired public void myOwnCustomInjectionName( @Qualifier(\"datePrefixGenerator\") PrefixGenerator prefixGenerator) &#123; this.prefixGenerator = prefixGenerator; &#125;&#125; å¦‚æœå¸Œæœ›æŒ‰åç§°è‡ªåŠ¨è¿æ¥beanå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ªèœè°±ä¸­æè¿°çš„JSR-250 @Resourceæ³¨é‡Šä¸€ä¸ªsetteræ–¹æ³•ã€æ„é€ å‡½æ•°æˆ–å­—æ®µã€‚ è§£ææ¥è‡ªå¤šä¸ªä½ç½®çš„POJOå¼•ç”¨éšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼Œåœ¨å•ä¸ªJavaé…ç½®ç±»ä¸­ç®¡ç†æ¯ä¸ªPOJOä¼šå˜å¾—å¾ˆå›°éš¾ã€‚ ä¸€ä¸ªå¸¸è§çš„å®è·µæ˜¯ï¼Œæ ¹æ®pojoçš„åŠŸèƒ½å°†å®ƒä»¬åˆ†æˆå¤šä¸ªJavaé…ç½®ç±»ã€‚å½“æ‚¨åˆ›å»ºå¤šä¸ªJavaé…ç½®ç±»æ—¶ï¼Œè·å–åœ¨ä¸åŒç±»ä¸­å®šä¹‰çš„å¼•ç”¨å’Œè‡ªåŠ¨è¿æ¥pojoå¹¶ä¸åƒåœ¨å•ä¸ªJavaé…ç½®ç±»ä¸­ä¸€æ ·ç®€å•ã€‚ ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æ¯ä¸ªJavaé…ç½®ç±»çš„ä½ç½®åˆå§‹åŒ–åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¯ä¸ªJavaé…ç½®ç±»çš„pojoéƒ½è¢«åŠ è½½åˆ°ä¸Šä¸‹æ–‡å’Œå¼•ç”¨ä¸­ï¼Œpojoä¹‹é—´çš„è‡ªåŠ¨è¿æ¥æ˜¯å¯èƒ½çš„ã€‚ 12AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext (PrefixConfiguration.class, SequenceGeneratorConfiguration.class); å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨@Importæ³¨é‡Šï¼Œå› æ­¤Springä½¿æ¥è‡ªä¸€ä¸ªé…ç½®æ–‡ä»¶çš„pojoåœ¨å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å¯ç”¨ã€‚ 12345678910111213141516171819202122package com.apress.springrecipes.sequence.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Import;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Configuration;import com.apress.springrecipes.sequence.SequenceGenerator;import com.apress.springrecipes.sequence.PrefixGenerator;@Configuration @Import(PrefixConfiguration.class)public class SequenceConfiguration &#123; @Value(\"#&#123;datePrefixGenerator&#125;\") private PrefixGenerator prefixGenerator; @Bean public SequenceGenerator sequenceGenerator() &#123; SequenceGenerator sequence= new SequenceGenerator(); sequence.setInitial(100000); sequence.setSuffix(\"A\"); sequence.setPrefixGenerator(prefixGenerator); return sequence; &#125;&#125; sequenceGenerator beanè¦æ±‚æ‚¨è®¾ç½®ä¸€ä¸ªprefixGenerator beanã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼ŒJavaé…ç½®ç±»ä¸­æ²¡æœ‰å®šä¹‰å‰ç¼€ç”Ÿæˆå™¨beanã€‚prefixGenerator beanåœ¨ä¸€ä¸ªåä¸ºPrefixConfigurationçš„å•ç‹¬Javaé…ç½®ç±»ä¸­å®šä¹‰ã€‚ä½¿ç”¨@Import(PrefixConfiguration.class)æ³¨é‡Šï¼ŒSpringå°†Javaé…ç½®ç±»ä¸­çš„æ‰€æœ‰pojoéƒ½å¸¦åˆ°å½“å‰é…ç½®ç±»çš„èŒƒå›´ä¸­ã€‚åœ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨æ¥è‡ªPrefixConfigurationçš„pojoï¼Œæ‚¨å¯ä»¥ä½¿ç”¨@Valueæ³¨é‡Šå’ŒSpELå°†åä¸ºdatePrefixGeneratorçš„beanæ³¨å…¥åˆ°prefixGeneratorå­—æ®µä¸­ã€‚æ³¨å…¥beanä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å®ƒä¸ºsequenceGenerator beanè®¾ç½®ä¸€ä¸ªprefixGenerator beanã€‚ ä½¿ç”¨@Resourceå’Œ@Injectæ³¨è§£æ¥è¿æ¥POJOsé—®é¢˜ æ‚¨å¸Œæœ›ä½¿ç”¨Javaæ ‡å‡†@Resourceå’Œ@Injectæ³¨è§£æ¥é€šè¿‡è‡ªåŠ¨è¿æ¥å¼•ç”¨pojoï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç‰¹å®šäºspringçš„@Autowiredæ³¨è§£ã€‚ è§£å†³æ–¹æ¡ˆ JSR-250ï¼Œæˆ–Javaå¹³å°çš„é€šç”¨æ³¨é‡Šï¼Œå®šä¹‰äº†@Resourceæ³¨é‡Šï¼Œä»¥åç§°è‡ªåŠ¨è¿æ¥POJOå¼•ç”¨ã€‚JSR-330ï¼Œæˆ–ç”¨äºæ³¨å…¥çš„æ ‡å‡†æ³¨è§£ï¼Œå®šä¹‰äº†@Injectæ³¨è§£ï¼ŒæŒ‰ç±»å‹æ¥è¿æ¥POJOå¼•ç”¨ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å‰é¢çš„èœè°±ä¸­æè¿°çš„@Autowiredæ³¨é‡Šå±äºSpringæ¡†æ¶ï¼Œå…·ä½“åˆ°org.springframework.beans.factoryã€‚æ³¨é‡ŠåŒ…ã€‚è¿™æ„å‘³ç€å®ƒåªèƒ½åœ¨Springæ¡†æ¶çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚åœ¨Springæ·»åŠ äº†å¯¹@Autowiredæ³¨é‡Šçš„æ”¯æŒä¹‹åï¼ŒJavaè¯­è¨€æ ‡å‡†åŒ–äº†å„ç§æ³¨é‡Šï¼Œä»¥å®ç°@Autowiredæ³¨é‡Šçš„ç›¸åŒç›®çš„ã€‚è¿™äº›æ³¨é‡Šæ˜¯@Resourceï¼Œå±äºjavaxã€‚æ³¨é‡ŠåŒ…å’Œ@Injectï¼Œå±äºjavax.inject packageã€‚ ä½¿ç”¨@Resourceæ³¨é‡Šè‡ªåŠ¨è¿æ¥POJOsé»˜è®¤æƒ…å†µä¸‹ï¼Œ@Resourceæ³¨é‡Šçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºSpringçš„@Autowiredæ³¨é‡Šï¼Œå¹¶å°è¯•é€šè¿‡ç±»å‹æ¥è‡ªåŠ¨è¿æ¥ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„POJOå±æ€§è¢«ä¿®é¥°ä¸º@Resourceæ³¨é‡Šï¼Œå› æ­¤Springå°è¯•å®šä½åŒ¹é…PrefixGeneratorç±»å‹çš„POJOã€‚ 123456789package com.apress.springrecipes.sequence;import javax.annotation.Resource;public class SequenceGenerator &#123; @Resource private PrefixGenerator prefixGenerator; ...&#125; ä½†æ˜¯ï¼Œä¸@Autowiredæ³¨é‡Šä¸åŒï¼Œå®ƒéœ€è¦@Qualifieræ³¨é‡Šæ¥æŒ‰åç§°è‡ªåŠ¨è¿æ¥POJOï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„POJOç±»å‹ï¼Œåˆ™å¯ä»¥æ¶ˆé™¤@Resourceæ­§ä¹‰ã€‚æœ¬è´¨ä¸Šï¼Œ@Resourceæ³¨é‡Šæä¾›äº†ä¸å°†@Autowiredæ³¨é‡Šå’Œ@Qualifieræ³¨é‡Šæ”¾åœ¨ä¸€èµ·ç›¸åŒçš„åŠŸèƒ½ã€‚ ä½¿ç”¨@Injectæ³¨é‡Šçš„Autowire POJOså¦å¤–ï¼Œ@Injectæ³¨é‡Šå°è¯•æŒ‰ç±»å‹è‡ªåŠ¨è¿æ¥ï¼Œæ¯”å¦‚@Resourceå’Œ@Autowiredæ³¨é‡Šã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„POJOå±æ€§è¢«ä¿®é¥°ä¸º@Injectæ³¨é‡Šï¼Œå› æ­¤Springå°è¯•å®šä½ä¸PrefixGeneratorç±»å‹åŒ¹é…çš„POJO: 123456789package com.apress.springrecipes.sequence;import javax.inject.Inject;public class SequenceGenerator &#123; @Inject private PrefixGenerator prefixGenerator; ...&#125; ä½†æ˜¯ï¼Œå°±åƒ@Resourceå’Œ@Autowiredæ³¨è§£ä¸€æ ·ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„POJOç±»å‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¸åŒçš„æ–¹æ³•æ¥åŒ¹é…POJOçš„åç§°æˆ–é¿å…æ­§ä¹‰ã€‚ä½¿ç”¨@Injectæ³¨é‡Šè¿›è¡Œåç§°è‡ªåŠ¨è¿æ¥çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºè‡ªå®šä¹‰æ³¨é‡Šï¼Œä»¥æ ‡è¯†POJOæ³¨å…¥ç±»å’ŒPOJOæ³¨å…¥ç‚¹ã€‚ 123456789101112131415package com.apress.springrecipes.sequence;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;import javax.inject.Qualifier;@Qualifier@Target(&#123;ElementType.TYPE, ElementType.FIELD, ElementType.PARAMETER&#125;)@Documented@Retention(RetentionPolicy.RUNTIME)public @interface DatePrefixAnnotation &#123;&#125; æ³¨æ„ï¼Œè‡ªå®šä¹‰æ³¨é‡Šä½¿ç”¨äº†@Qualifieræ³¨é‡Šã€‚è¿™ä¸ªæ³¨é‡Šä¸Springçš„@Qualifieræ³¨é‡Šä½¿ç”¨çš„æ³¨é‡Šä¸åŒï¼Œå› ä¸ºæœ€åä¸€ä¸ªç±»ä¸@Injectæ³¨é‡Šå±äºåŒä¸€ä¸ªJavaåŒ…ã€‚(javax.inject)ã€‚ ä¸€æ—¦å®Œæˆäº†è‡ªå®šä¹‰æ³¨é‡Šï¼Œå°±éœ€è¦è£…é¥°ç”Ÿæˆbeanå®ä¾‹çš„POJOæ³¨å…¥ç±»ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯DatePrefixGeneratorç±»ã€‚ 123456package com.apress.springrecipes.sequence;...@DatePrefixAnnotationpublic class DatePrefixGenerator implements PrefixGenerator &#123; ...&#125; æœ€åï¼ŒPOJOå±æ€§æˆ–æ³¨å…¥ç‚¹ä½¿ç”¨ç›¸åŒçš„è‡ªå®šä¹‰æ³¨é‡Šæ¥é™å®šPOJOå¹¶æ¶ˆé™¤ä»»ä½•æ­§ä¹‰ã€‚ 123456789package com.apress.springrecipes.sequence;import javax.inject.Inject;public class SequenceGenerator &#123; @Inject @DataPrefixAnnotation private PrefixGenerator prefixGenerator; ...&#125; æ­£å¦‚æ‚¨åœ¨èœè°±2-3å’Œ2-4ä¸­çœ‹åˆ°çš„ï¼Œ@Autowiredã€@Resourceå’Œ@Injectè¿™ä¸‰ä¸ªæ³¨è§£å¯ä»¥å®ç°ç›¸åŒçš„ç»“æœã€‚@Autowiredæ³¨é‡Šæ˜¯åŸºäºspringçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œ@Resourceå’Œ@Injectæ³¨é‡Šæ˜¯Javaæ ‡å‡†(å³:JSR)è§£å†³æ–¹æ¡ˆã€‚å¦‚æœè¦è¿›è¡ŒåŸºäºåç§°çš„è‡ªåŠ¨è¿æ¥ï¼Œ@Resourceæ³¨é‡Šæä¾›äº†æœ€ç®€å•çš„è¯­æ³•ã€‚å¯¹äºæŒ‰ç±»ç±»å‹è‡ªåŠ¨è¿æ¥ï¼Œè¿™ä¸‰ä¸ªæ³¨é‡Šéƒ½å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¸‰ä¸ªæ³¨é‡Šéƒ½éœ€è¦ä¸€ä¸ªæ³¨é‡Šã€‚ ä½¿ç”¨@Scopeæ³¨é‡Šè®¾ç½®POJOçš„èŒƒå›´é—®é¢˜ å½“æ‚¨ä½¿ç”¨åƒ@Componentè¿™æ ·çš„æ³¨é‡Šå£°æ˜POJOå®ä¾‹æ—¶ï¼Œæ‚¨å®é™…ä¸Šæ˜¯åœ¨ä¸ºbeanåˆ›å»ºå®šä¹‰ä¸€ä¸ªæ¨¡æ¿ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®é™…çš„beanå®ä¾‹ã€‚å½“getBean()æ–¹æ³•è¯·æ±‚beanæˆ–ä»å…¶ä»–beanå¼•ç”¨æ—¶ï¼ŒSpringæ ¹æ®beanä½œç”¨åŸŸå†³å®šåº”è¯¥è¿”å›å“ªä¸ªbeanå®ä¾‹ã€‚æœ‰æ—¶ï¼Œæ‚¨å¿…é¡»ä¸ºbeanè®¾ç½®é€‚å½“çš„èŒƒå›´ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„èŒƒå›´ã€‚ è§£å†³æ–¹æ¡ˆ ä½¿ç”¨@Scopeæ³¨é‡Šè®¾ç½®beançš„èŒƒå›´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringä¸ºIoCå®¹å™¨ä¸­å£°æ˜çš„æ¯ä¸ªbeanåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹åœ¨æ•´ä¸ªIoCå®¹å™¨çš„èŒƒå›´å†…å…±äº«ã€‚å¯¹äºæ‰€æœ‰åç»­çš„getBean()è°ƒç”¨å’Œbeanå¼•ç”¨ï¼Œå°†è¿”å›è¿™ä¸ªæƒŸä¸€çš„beanå®ä¾‹ã€‚è¿™ä¸ªèŒƒå›´ç§°ä¸ºsingletonï¼Œå®ƒæ˜¯æ‰€æœ‰beançš„é»˜è®¤èŒƒå›´ã€‚è¡¨2-1åˆ—å‡ºäº†Springä¸­æ‰€æœ‰æœ‰æ•ˆçš„beanä½œç”¨åŸŸã€‚ Scope æè¿° singleton æ¯ä¸ªSpring IoCå®¹å™¨åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ prototype æ¯æ¬¡è¯·æ±‚æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ request æ¯ä¸ªHTTPè¯·æ±‚åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹;ä»…åœ¨webåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆ session æ¯ä¸ªHTTPä¼šè¯åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„beanå®ä¾‹;ä»…åœ¨webåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆ globalSession æ¯ä¸ªå…¨å±€HTTPä¼šè¯åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹;ä»…åœ¨é—¨æˆ·åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ ä¸ºäº†æ¼”ç¤ºbeanä½œç”¨åŸŸçš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬è€ƒè™‘è´­ç‰©åº”ç”¨ç¨‹åºä¸­çš„è´­ç‰©è½¦ç¤ºä¾‹ã€‚é¦–å…ˆï¼Œåˆ›å»ºShoppingCartç±»å¦‚ä¸‹: 12345678910111213package com.apress.springrecipes.shop;...@Componentpublic class ShoppingCart &#123; private List&lt;Product&gt; items = new ArrayList&lt;&gt;(); public void addItem(Product item) &#123; items.add(item); &#125; public List&lt;Product&gt; getItems() &#123; return items; &#125;&#125; ç„¶åï¼Œåœ¨Javaé…ç½®æ–‡ä»¶ä¸­å£°æ˜ä¸€äº›äº§å“beanï¼Œä»¥ä¾¿ç¨åå°†å®ƒä»¬æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233package com.apress.springrecipes.shop.config;import com.apress.springrecipes.shop.Battery;import com.apress.springrecipes.shop.Disc;import com.apress.springrecipes.shop.Product;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Configuration;@Configuration@ComponentScan(\"com.apress.springrecipes.shop\")public class ShopConfiguration &#123; @Bean public Product aaa() &#123; Battery p1 = new Battery(); p1.setName(\"AAA\"); p1.setPrice(2.5); p1.setRechargeable(true); return p1; &#125; @Bean public Product cdrw() &#123; Disc p2 = new Disc(\"CD-RW\", 1.5); p2.setCapacity(700); return p2; &#125; @Bean public Product dvdrw() &#123; Disc p2 = new Disc(\"DVD-RW\", 3.0); p2.setCapacity(700); return p2; &#125;&#125; ä¸€æ—¦æ‚¨è¿™æ ·åšäº†ï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡æ·»åŠ ä¸€äº›äº§å“æ¥å®šä¹‰ä¸€ä¸ªä¸»ç±»æ¥æµ‹è¯•è´­ç‰©è½¦ã€‚å‡è®¾æœ‰ä¸¤ä¸ªå®¢æˆ·åŒæ—¶åœ¨æ‚¨çš„å•†åº—ä¸­å¯¼èˆªã€‚ç¬¬ä¸€ä¸ªé€šè¿‡getBean()æ–¹æ³•è·å¾—è´­ç‰©è½¦å¹¶å‘å…¶ä¸­æ·»åŠ ä¸¤ä¸ªäº§å“ã€‚ç„¶åï¼Œç¬¬äºŒä¸ªå®¢æˆ·è¿˜é€šè¿‡getBean()æ–¹æ³•è·å¾—ä¸€ä¸ªè´­ç‰©è½¦ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ å¦ä¸€ä¸ªäº§å“ã€‚ 12345678910111213141516171819202122package com.apress.springrecipes.shop;import com.apress.springrecipes.shop.config.ShopConfiguration;import org.springframework.context.ApplicationContext;import org.springframework.context.annotation.AnnotationConfigApplicationContext;public class Main &#123; public static void main(String[] args) throws Exception &#123; ApplicationContext context = new AnnotationConfigApplicationContext(ShopConfiguration.class); Product aaa = context.getBean(\"aaa\", Product.class); Product cdrw = context.getBean(\"cdrw\", Product.class); Product dvdrw = context.getBean(\"dvdrw\", Product.class); ShoppingCart cart1 = context.getBean(\"shoppingCart\", ShoppingCart.class); cart1.addItem(aaa); cart1.addItem(cdrw); System.out.println(\"Shopping cart 1 contains \" + cart1.getItems()); ShoppingCart cart2 = context.getBean(\"shoppingCart\", ShoppingCart.class); cart2.addItem(dvdrw); System.out.println(\"Shopping cart 2 contains \" + cart2.getItems()); &#125;&#125; ç”±äºå‰é¢çš„beanå£°æ˜ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¢æˆ·è·å¾—äº†ç›¸åŒçš„è´­ç‰©è½¦å®ä¾‹ã€‚ 12Shopping cart 1 contains [AAA 2.5, CD-RW 1.5]Shopping cart 2 contains [AAA 2.5, CD-RW 1.5, DVD-RW 3.0] è¿™æ˜¯å› ä¸ºSpringçš„é»˜è®¤beanä½œç”¨åŸŸæ˜¯å•ä¾‹çš„ï¼Œè¿™æ„å‘³ç€Springæ¯ä¸ªIoCå®¹å™¨åªåˆ›å»ºä¸€ä¸ªè´­ç‰©è½¦å®ä¾‹ã€‚åœ¨æ‚¨çš„shopåº”ç”¨ç¨‹åºä¸­ï¼Œå½“è°ƒç”¨getBean()æ–¹æ³•æ—¶ï¼Œæ‚¨å¸Œæœ›æ¯ä¸ªå®¢æˆ·è·å¾—ä¸åŒçš„è´­ç‰©è½¦å®ä¾‹ã€‚ä¸ºäº†ç¡®ä¿è¿™ç§è¡Œä¸ºï¼Œéœ€è¦å°†shoppingCart beançš„èŒƒå›´è®¾ç½®ä¸ºprototypeã€‚ç„¶åSpringä¸ºæ¯ä¸ªgetBean()æ–¹æ³•è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚ 1234567package com.apress.springrecipes.shop;...import org.springframework.stereotype.Component;import org.springframework.context.annotation.Scope;@Component@Scope(\"prototype\")public class ShoppingCart &#123; ... &#125; ç°åœ¨ï¼Œå¦‚æœæ‚¨å†æ¬¡è¿è¡ŒMainç±»ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¢æˆ·è·å¾—ä¸åŒçš„è´­ç‰©è½¦å®ä¾‹ã€‚ 12Shopping cart 1 contains [AAA 2.5, CD-RW 1.5]Shopping cart 2 contains [DVD-RW 3.0] ä½¿ç”¨æ¥è‡ªå¤–éƒ¨èµ„æºçš„æ•°æ®(æ–‡æœ¬æ–‡ä»¶ã€XMLæ–‡ä»¶ã€å±æ€§æ–‡ä»¶æˆ–å›¾åƒæ–‡ä»¶)é—®é¢˜ æœ‰æ—¶åº”ç”¨ç¨‹åºéœ€è¦ä»ä¸åŒçš„ä½ç½®(ä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿã€ç±»è·¯å¾„æˆ–URL)è¯»å–å¤–éƒ¨èµ„æº(ä¾‹å¦‚ï¼Œæ–‡æœ¬æ–‡ä»¶ã€XMLæ–‡ä»¶ã€å±æ€§æ–‡ä»¶æˆ–å›¾åƒæ–‡ä»¶)ã€‚é€šå¸¸ï¼Œæ‚¨å¿…é¡»å¤„ç†ä»ä¸åŒä½ç½®åŠ è½½èµ„æºçš„ä¸åŒapiã€‚ è§£å†³æ–¹æ¡ˆ Springæä¾›äº†@PropertySourceæ³¨é‡Šä½œä¸ºåŠ è½½.propertiesæ–‡ä»¶å†…å®¹çš„å·¥å…·(ä¾‹å¦‚ï¼Œé”®-å€¼å¯¹)æ¥è®¾ç½®beanå±æ€§ã€‚Springè¿˜æœ‰ä¸€ä¸ªèµ„æºåŠ è½½å™¨æœºåˆ¶ï¼Œè¯¥æœºåˆ¶æä¾›ä¸€ä¸ªç»Ÿä¸€çš„èµ„æºæ¥å£ï¼Œç”¨äºé€šè¿‡èµ„æºè·¯å¾„æ£€ç´¢ä»»ä½•ç±»å‹çš„å¤–éƒ¨èµ„æºã€‚å¯ä»¥ä¸ºè¯¥è·¯å¾„æŒ‡å®šä¸åŒçš„å‰ç¼€ï¼Œä»¥ä¾¿ä½¿ç”¨@Valueæ³¨é‡Šä»ä¸åŒä½ç½®åŠ è½½èµ„æºã€‚è¦ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½èµ„æºï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶å‰ç¼€ã€‚è¦ä»ç±»è·¯å¾„ä¸­åŠ è½½èµ„æºï¼Œå¯ä»¥ä½¿ç”¨ç±»è·¯å¾„å‰ç¼€ã€‚è¿˜å¯ä»¥åœ¨èµ„æºè·¯å¾„ä¸­æŒ‡å®šURLã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ è¯»å–å±æ€§æ–‡ä»¶çš„å†…å®¹(ä¾‹å¦‚è¦è®¾ç½®beanå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰PropertySourcesPlaceholderConfigurerçš„Springçš„@PropertySourceæ³¨é‡Šã€‚å¦‚æœå¸Œæœ›è¯»å–ä»»ä½•æ–‡ä»¶çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ç”¨@Valueæ³¨é‡Šä¿®é¥°çš„Springçš„èµ„æºæœºåˆ¶ã€‚ ä½¿ç”¨å±æ€§æ–‡ä»¶æ•°æ®è®¾ç½®POJOå®ä¾‹åŒ–å€¼è®©æˆ‘ä»¬å‡è®¾æ‚¨å¸Œæœ›åœ¨å±æ€§æ–‡ä»¶ä¸­è®¿é—®ä¸€ç³»åˆ—å€¼æ¥è®¾ç½®beanå±æ€§ã€‚é€šå¸¸ï¼Œè¿™å¯ä»¥æ˜¯æ•°æ®åº“çš„é…ç½®å±æ€§æˆ–ç”±é”®å€¼ç»„æˆçš„å…¶ä»–åº”ç”¨ç¨‹åºå€¼ã€‚ä¾‹å¦‚ï¼Œå–å­˜å‚¨åœ¨åä¸ºdiscounts.propertiesæ–‡ä»¶ä¸­çš„ä¸‹åˆ—å…³é”®å€¼: 123specialcustomer.discount=0.1summer.discount=0.15endofyear.discount=0.2 è¦é˜…è¯»å›½é™…åŒ–(i18n)ç›®çš„çš„å±æ€§æ–‡ä»¶ï¼Œè¯·å‚é˜…ä¸‹ä¸€ä¸ªèœè°±ã€‚æä¾›æŠ˜æ‰£çš„å†…å®¹ã€‚å±æ€§æ–‡ä»¶å¯ç”¨äºè®¾ç½®å…¶ä»–beanï¼Œæ‚¨å¯ä»¥ä½¿ç”¨@PropertySourceæ³¨é‡Šå°†é”®å€¼è½¬æ¢ä¸ºJavaé…ç½®ç±»ä¸­çš„beanã€‚ 123456789101112131415161718192021222324252627282930package com.apress.springrecipes.shop.config;import com.apress.springrecipes.shop.Battery;import com.apress.springrecipes.shop.Disc;import com.apress.springrecipes.shop.Product;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.PropertySource;import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;@Configuration @PropertySource(\"classpath:discounts.properties\")@ComponentScan(\"com.apress.springrecipes.shop\")public class ShopConfiguration &#123; @Value(\"$&#123;endofyear.discount:0&#125;\") private double specialEndofyearDiscountField; @Bean public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() &#123; return new PropertySourcesPlaceholderConfigurer(); &#125; @Bean public Product dvdrw() &#123; Disc p2 = new Disc(\"DVD-RW\", 3.0, specialEndofyearDiscountField); p2.setCapacity(700); return p2; &#125;&#125; æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªå¸¦æœ‰ç±»è·¯å¾„å€¼:æŠ˜æ‰£çš„@PropertySourceæ³¨é‡Šã€‚å±æ€§æ¥ä¿®é¥°Javaé…ç½®ç±»ã€‚ç±»è·¯å¾„:å‰ç¼€å‘Šè¯‰SpringæŸ¥æ‰¾æŠ˜æ‰£ã€‚Javaç±»è·¯å¾„ä¸­çš„å±æ€§æ–‡ä»¶ã€‚å®šä¹‰äº†@PropertySourceæ³¨é‡Šä»¥åŠ è½½å±æ€§æ–‡ä»¶ä¹‹åï¼Œè¿˜éœ€è¦ä½¿ç”¨@Beanæ³¨é‡Šå®šä¹‰PropertySourcePlaceholderConfigurer beanã€‚Springä¼šè‡ªåŠ¨è¿æ¥@PropertySourceæŠ˜æ‰£ã€‚å±æ€§æ–‡ä»¶ï¼Œä½¿å…¶å±æ€§å¯ä½œä¸ºbeanå±æ€§è®¿é—®ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å®šä¹‰Javaå˜é‡ï¼Œä»¥ä¾¿ä»æŠ˜æ‰£æŠ˜æ‰£ä¸­è·å–å€¼ã€‚å±æ€§æ–‡ä»¶ã€‚è¦ä½¿ç”¨è¿™äº›å€¼å®šä¹‰Javaå˜é‡å€¼ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰å ä½ç¬¦è¡¨è¾¾å¼çš„@Valueæ³¨é‡Šã€‚è¯­æ³•æ˜¯@Value(&quot;${key:default_value}&quot;)ã€‚æœç´¢æ‰€æœ‰åŠ è½½çš„åº”ç”¨ç¨‹åºå±æ€§ä¸­çš„é”®å€¼ã€‚å¦‚æœåœ¨å±æ€§æ–‡ä»¶ä¸­æ‰¾åˆ°äº†åŒ¹é…çš„é”®=å€¼ï¼Œåˆ™å°†ç›¸åº”çš„å€¼åˆ†é…ç»™beanå±æ€§ã€‚å¦‚æœåŠ è½½çš„åº”ç”¨ç¨‹åºå±æ€§ä¸­æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„key=valueï¼Œé‚£ä¹ˆdefault_value(å³ï¼Œåœ¨${key:)ä¹‹ååˆ†é…ç»™beanå±æ€§ã€‚åœ¨ç”¨æŠ˜æ‰£å€¼è®¾ç½®Javaå˜é‡ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä¸ºbeançš„æŠ˜æ‰£å±æ€§è®¾ç½®beanå®ä¾‹ã€‚å¦‚æœæ‚¨å¸Œæœ›å°†å±æ€§æ–‡ä»¶æ•°æ®ç”¨äºä¸è®¾ç½®beanå±æ€§ä¸åŒçš„ç›®çš„ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä½¿ç”¨Springçš„èµ„æºæœºåˆ¶ï¼Œåé¢å°†å¯¹æ­¤è¿›è¡Œæè¿°ã€‚ åœ¨POJOä¸­ä½¿ç”¨æ¥è‡ªä»»ä½•å¤–éƒ¨èµ„æºæ–‡ä»¶çš„æ•°æ®å‡è®¾æ‚¨æƒ³åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªæ¨ªå¹…ã€‚bannerç”±ä»¥ä¸‹å­—ç¬¦ç»„æˆï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºbanner.txtçš„æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥æ”¾åœ¨åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­ã€‚ 123************************** Welcome to My Shop! ************************** æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªBannerLoader POJOç±»æ¥åŠ è½½æ¨ªå¹…å¹¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ 123456789101112131415161718192021222324package com.apress.springrecipes.shop;import org.springframework.core.io.Resource;...import javax.annotation.PostConstruct;public class BannerLoader &#123; private Resource banner; public void setBanner(Resource banner) &#123; this.banner = banner; &#125; @PostConstruct public void showBanner() throws IOException &#123; InputStream in = banner.getInputStream(); BufferedReader reader = new BufferedReader(new InputStreamReader(in)); while (true) &#123; String line = reader.readLine(); if (line == null) break; System.out.println(line); &#125; reader.close(); &#125;&#125; æ³¨æ„ï¼ŒPOJO bannerå­—æ®µæ˜¯ä¸€ä¸ªSpringèµ„æºç±»å‹ã€‚å½“åˆ›å»ºbeanå®ä¾‹æ—¶ï¼Œå°†é€šè¿‡setteræ³¨å…¥å¡«å……å­—æ®µå€¼â€”â€”ç¨åè¿›è¡Œè§£é‡Šã€‚showBanner()æ–¹æ³•è°ƒç”¨getInputStream()æ–¹æ³•æ¥ä»èµ„æºå­—æ®µæ£€ç´¢è¾“å…¥æµã€‚ä¸€æ—¦æœ‰äº†InputStreamï¼Œå°±å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„Javaæ–‡ä»¶æ“ä½œç±»ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ–‡ä»¶å†…å®¹æ˜¯é€è¡Œè¯»å–çš„ï¼Œå¸¦æœ‰BufferedReaderå’Œè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ è¿˜è¯·æ³¨æ„showBanner()æ–¹æ³•ä½¿ç”¨@PostConstructæ³¨é‡Šè¿›è¡Œè£…é¥°ã€‚å› ä¸ºæ‚¨å¸Œæœ›åœ¨å¯åŠ¨æ—¶æ˜¾ç¤ºbannerï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨é‡Šå‘Šè¯‰Springåœ¨åˆ›å»ºåè‡ªåŠ¨è°ƒç”¨æ–¹æ³•ã€‚è¿™ä¿è¯äº†showBanner()æ–¹æ³•æ˜¯åº”ç”¨ç¨‹åºè¿è¡Œçš„ç¬¬ä¸€ä¸ªæ–¹æ³•ä¹‹ä¸€ï¼Œå› æ­¤ç¡®ä¿äº†æ¨ªå¹…å‡ºç°åœ¨å¼€å§‹ã€‚æ¥ä¸‹æ¥ï¼Œéœ€è¦å°†POJO BannerLoaderåˆå§‹åŒ–ä¸ºå®ä¾‹ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨å…¥BannerLoaderçš„bannerå­—æ®µã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ä¸ºè¿™äº›ä»»åŠ¡åˆ›å»ºä¸€ä¸ªJavaé…ç½®ç±»ã€‚ 123456789101112131415161718@Configuration @PropertySource(\"classpath:discounts.properties\")@ComponentScan(\"com.apress.springrecipes.shop\")public class ShopConfiguration &#123; @Value(\"classpath:banner.txt\") private Resource banner; @Bean public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() &#123; return new PropertySourcesPlaceholderConfigurer(); &#125; @Bean public BannerLoader bannerLoader() &#123; BannerLoader bl = new BannerLoader(); bl.setBanner(banner); return bl; &#125;&#125; æŸ¥çœ‹å¦‚ä½•ä½¿ç”¨@Value(â€œclasspath:banner.txtâ€)æ³¨é‡Šä¿®é¥°bannerå±æ€§ã€‚è¿™å‘Šè¯‰æ˜¥å¤©å»æœç´¢æ¨ªå¹…ã€‚åœ¨ç±»è·¯å¾„ä¸­æ’å…¥txtæ–‡ä»¶ã€‚Springä½¿ç”¨é¢„å…ˆæ³¨å†Œçš„å±æ€§ç¼–è¾‘å™¨ResourceEditorå°†æ–‡ä»¶å®šä¹‰è½¬æ¢ä¸ºèµ„æºå¯¹è±¡ï¼Œç„¶åå°†å…¶æ³¨å…¥åˆ°beanä¸­ã€‚æ³¨å…¥bannerå±æ€§åï¼Œé€šè¿‡setteræ³¨å…¥å°†å…¶åˆ†é…ç»™BannerLoader beanå®ä¾‹ã€‚ç”±äºbanneræ–‡ä»¶ä½äºJavaç±»è·¯å¾„ä¸­ï¼Œèµ„æºè·¯å¾„ä»classpath: prefixå¼€å§‹ã€‚å‰é¢çš„èµ„æºè·¯å¾„æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„ç›¸å¯¹è·¯å¾„ä¸­çš„èµ„æºã€‚ä¹Ÿå¯ä»¥æŒ‡å®šç»å¯¹è·¯å¾„ã€‚ file:c:/shop/banner.txt å½“èµ„æºä½äºJavaçš„ç±»è·¯å¾„ä¸­æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ç±»è·¯å¾„å‰ç¼€ã€‚å¦‚æœæ²¡æœ‰æ˜¾ç¤ºè·¯å¾„ä¿¡æ¯ï¼Œå®ƒå°†ä»ç±»è·¯å¾„çš„æ ¹åŠ è½½ã€‚ classpath:banner.txt å¦‚æœèµ„æºä½äºç‰¹å®šçš„åŒ…ä¸­ï¼Œæ‚¨å¯ä»¥æŒ‡å®šæ¥è‡ªç±»è·¯å¾„æ ¹çš„ç»å¯¹è·¯å¾„ã€‚ classpath:com/apress/springrecipes/shop/banner.txt é™¤äº†æ”¯æŒä»æ–‡ä»¶ç³»ç»Ÿè·¯å¾„æˆ–ç±»è·¯å¾„åŠ è½½å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šURLæ¥åŠ è½½èµ„æºã€‚ http://springrecipes.apress.com/shop/banner.txt ç”±äºbeanç±»åœ¨showBanner()æ–¹æ³•ä¸Šä½¿ç”¨@PostConstructæ³¨é‡Šï¼Œæ‰€ä»¥banneråœ¨IoCå®¹å™¨å»ºç«‹æ—¶è¢«å‘é€åˆ°è¾“å‡ºã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œæ²¡æœ‰å¿…è¦å»ä¿®è¡¥åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡æˆ–æ˜¾å¼è°ƒç”¨beanæ¥è¾“å‡ºæ¨ªå¹…ã€‚ç„¶è€Œï¼Œæœ‰æ—¶éœ€è¦è®¿é—®å¤–éƒ¨èµ„æºæ¥ä¸åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡è¿›è¡Œäº¤äº’ã€‚ç°åœ¨ï¼Œå‡è®¾æ‚¨å¸Œæœ›åœ¨åº”ç”¨ç¨‹åºçš„æœ«å°¾æ˜¾ç¤ºä¸€ä¸ªå›¾ä¾‹ã€‚å›¾ä¾‹åŒ…å«äº†æŠ˜æ‰£ä¸­å…ˆå‰æè¿°çš„æŠ˜æ‰£ã€‚å±æ€§æ–‡ä»¶ã€‚è¦è®¿é—®å±æ€§æ–‡ä»¶çš„å†…å®¹ï¼Œè¿˜å¯ä»¥åˆ©ç”¨Springçš„èµ„æºæœºåˆ¶ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨Springçš„èµ„æºæœºåˆ¶ï¼Œä½†è¿™ä¸€æ¬¡æ˜¯ç›´æ¥åœ¨åº”ç”¨ç¨‹åºçš„ä¸»ç±»ä¸­ï¼Œåœ¨åº”ç”¨ç¨‹åºå®Œæˆæ—¶è¾“å‡ºä¸€ä¸ªå›¾ä¾‹ã€‚ 12345678910111213import org.springframework.core.io.ClassPathResource;import org.springframework.core.io.support.PropertiesLoaderUtils;......public class Main &#123; public static void main(String[] args) throws Exception &#123; ... Resource resource = new ClassPathResource(\"discounts.properties\"); Properties props = PropertiesLoaderUtils.loadProperties(resource); System.out.println(\"And don't forget our discounts!\"); System.out.println(props); &#125;&#125; Springçš„ClassPathResourceç±»ç”¨äºè®¿é—®discounts.propertiesæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†æ–‡ä»¶çš„å†…å®¹è½¬æ¢ä¸ºèµ„æºå¯¹è±¡ã€‚æ¥ä¸‹æ¥ï¼Œèµ„æºå¯¹è±¡è¢«å¤„ç†æˆå…·æœ‰Springçš„PropertiesLoaderUtilsç±»çš„å±æ€§å¯¹è±¡ã€‚æœ€åï¼Œå±æ€§å¯¹è±¡çš„å†…å®¹ä½œä¸ºåº”ç”¨ç¨‹åºçš„æœ€ç»ˆè¾“å‡ºå‘é€åˆ°æ§åˆ¶å°ã€‚å› ä¸ºå›¾ä¾‹æ–‡ä»¶(å³åœ¨Javaç±»è·¯å¾„ä¸­ï¼Œèµ„æºé€šè¿‡Springçš„ClassPathResourceç±»æ¥è®¿é—®ã€‚å¦‚æœå¤–éƒ¨èµ„æºä½äºæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸­ï¼Œåˆ™èµ„æºå°†è¢«åŠ è½½åˆ°Springçš„æ–‡ä»¶ç³»ç»Ÿèµ„æºä¸­ã€‚ 1Resource resource = new FileSystemResource(\"c:/shop/banner.txt\") å¦‚æœå¤–éƒ¨èµ„æºä½äºURLä¸­ï¼Œåˆ™èµ„æºå°†è¢«åŠ è½½åˆ°Springçš„UrlResourceä¸­ã€‚ 1Resource resource = new UrlResource(\"http://www.apress.com/\") è§£æå±æ€§æ–‡ä»¶ä¸­ä¸åŒåœ°åŒºçš„I18Næ–‡æœ¬æ¶ˆæ¯é—®é¢˜ æ‚¨å¸Œæœ›åº”ç”¨ç¨‹åºé€šè¿‡æ³¨é‡Šæ”¯æŒå›½é™…åŒ–ã€‚ è§£å†³æ–¹æ¡ˆ MessageSourceæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†ç”¨äºè§£æèµ„æºåŒ…ä¸­çš„æ¶ˆæ¯çš„å‡ ç§æ–¹æ³•ã€‚ResourceBundleMessageSourceæ˜¯æœ€å¸¸è§çš„MessageSourceå®ç°ï¼Œå®ƒä»ä¸åŒçš„åœ°åŒºè§£å†³æ¥è‡ªèµ„æºåŒ…çš„æ¶ˆæ¯ã€‚åœ¨å®ç°ResourceBundleMessageSource POJOä¹‹åï¼Œæ‚¨å¯ä»¥åœ¨Javaé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨@Beanæ³¨é‡Šï¼Œä»¥ä½¿åº”ç”¨ç¨‹åºä¸­çš„i18næ•°æ®å¯ç”¨ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ ä¾‹å¦‚ï¼Œåœ¨ç¾å›½ä¸ºè‹±è¯­åˆ›å»ºä¸€ä¸ªåä¸ºmessages_en_US.propertiesçš„èµ„æºåŒ…ã€‚èµ„æºåŒ…æ˜¯ä»ç±»è·¯å¾„çš„æ ¹åŠ è½½çš„ï¼Œæ‰€ä»¥è¦ç¡®ä¿å®ƒåœ¨Javaç±»è·¯å¾„ä¸­å¯ç”¨ã€‚åœ¨æ–‡ä»¶ä¸­æ”¾ç½®ä»¥ä¸‹é”®å€¼: 12alert.checkout=A shopping cart has been checked out.alert.inventory.checkout=A shopping cart with &#123;0&#125; has been checked out at &#123;1&#125;. ä¸ºäº†è§£æèµ„æºåŒ…ä¸­çš„æ¶ˆæ¯ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ReloadableResourceBundleMessageSource beançš„å®ä¾‹åˆ›å»ºä¸€ä¸ªJavaé…ç½®æ–‡ä»¶ã€‚ 12345678910111213141516package com.apress.springrecipes.shop.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.context.support.ReloadableResourceBundleMessageSource;@Configurationpublic class ShopConfiguration &#123; @Bean public ReloadableResourceBundleMessageSource messageSource() &#123; ReloadableResourceBundleMessageSource messageSource = new ReloadableResourceBundleMessageSource(); messageSource.setBasenames(\"classpath:messages\"); messageSource.setCacheSeconds(1); return messageSource; &#125;&#125; beanå®ä¾‹å¿…é¡»æœ‰åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„åç§°messageSourceæ¥æ£€æµ‹å®ƒã€‚åœ¨beanå®šä¹‰ä¸­ï¼Œæ‚¨é€šè¿‡setBasenamesæ–¹æ³•å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œä»¥ä¾¿ä¸ºResourceBundleMessageSourceå®šä½bundleã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªéœ€æŒ‡å®šé»˜è®¤çº¦å®šæ¥æŸ¥æ‰¾ä½äºä»¥æ¶ˆæ¯å¼€å¤´çš„Javaç±»è·¯å¾„ä¸­çš„æ–‡ä»¶ã€‚æ­¤å¤–ï¼ŒsetCacheSecondsæ–¹æ³•å°†ç¼“å­˜è®¾ç½®ä¸º1ç§’ï¼Œä»¥é¿å…è¯»å–è¿‡æ—¶çš„æ¶ˆæ¯ã€‚æ³¨æ„ï¼Œåˆ·æ–°å°è¯•åœ¨é‡æ–°åŠ è½½å±æ€§æ–‡ä»¶ä¹‹å‰é¦–å…ˆæ£€æŸ¥å±æ€§æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´æˆ³ï¼Œå› æ­¤å¦‚æœæ–‡ä»¶æ²¡æœ‰æ›´æ”¹ï¼Œåˆ™å¯ä»¥å°†setCacheSecondsé—´éš”è®¾ç½®å¾—ç›¸å½“ä½ï¼Œå› ä¸ºåˆ·æ–°å°è¯•å®é™…ä¸Šå¹¶æ²¡æœ‰é‡æ–°åŠ è½½ã€‚å¯¹äºè¿™ä¸ªMessageSourceå®šä¹‰ï¼Œå¦‚æœæ‚¨æŸ¥æ‰¾ç¾å›½è¯­è¨€ç¯å¢ƒçš„æ–‡æœ¬æ¶ˆæ¯(å…¶é¦–é€‰è¯­è¨€æ˜¯è‹±è¯­)ï¼Œåˆ™æŸ¥æ‰¾messages_en_USèµ„æºåŒ…ã€‚å±æ€§è¢«è®¤ä¸ºæ˜¯ç¬¬ä¸€ä¸ªã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„èµ„æºæŸï¼Œæˆ–è€…æ— æ³•æ‰¾åˆ°æ¶ˆæ¯ï¼Œé‚£ä¹ˆmessages_enã€‚è€ƒè™‘ä¸è¯­è¨€åŒ¹é…çš„å±æ€§æ–‡ä»¶ã€‚å¦‚æœä»ç„¶æ‰¾ä¸åˆ°èµ„æºåŒ…ï¼Œåˆ™é»˜è®¤æ¶ˆæ¯ã€‚å±æ€§é€‰æ‹©æ‰€æœ‰åœ°åŒºã€‚æœ‰å…³èµ„æºåŒ…åŠ è½½çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒjava.util.ResourceBundleç±»çš„Javadocã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥é…ç½®åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¥ä½¿ç”¨getMessage()æ–¹æ³•è§£ææ¶ˆæ¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯å¯¹åº”çš„é”®ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç›®æ ‡è¯­è¨€ç¯å¢ƒã€‚ 123456789101112131415161718package com.apress.springrecipes.shop;import com.apress.springrecipes.shop.config.ShopConfiguration;import org.springframework.context.ApplicationContext;import org.springframework.context.annotation.AnnotationConfigApplicationContext;import java.util.Date;import java.util.Locale;public class Main &#123; public static void main(String[] args) throws Exception &#123; ApplicationContext context = new AnnotationConfigApplicationContext(ShopConfiguration.class); String alert = context.getMessage(\"alert.checkout\", null, Locale.US); String alert_inventory = context.getMessage(\"alert.inventory.checkout\", new Object[] &#123;\"[DVD-RW 3.0]\", new Date()&#125;, Locale.US); System.out.println(\"The I18N message for alert.checkout is: \" + alert); System.out.println(\"The I18N message for alert.inventory.checkout is: \" + alert_inventory); &#125;&#125; getMessage()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¶ˆæ¯å‚æ•°æ•°ç»„ã€‚åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²è¯­å¥ä¸­ï¼Œå€¼ä¸ºnullï¼Œåœ¨ç¬¬äºŒä¸ªå­—ç¬¦ä¸²è¯­å¥ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ•°ç»„æ¥å¡«å……æ¶ˆæ¯å‚æ•°ã€‚åœ¨Mainç±»ä¸­ï¼Œå¯ä»¥è§£ææ–‡æœ¬æ¶ˆæ¯ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥è®¿é—®åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯è¦è®©beanè§£ææ–‡æœ¬æ¶ˆæ¯ï¼Œæ‚¨å¿…é¡»å°†MessageSourceå®ç°æ³¨å…¥åˆ°éœ€è¦è§£ææ–‡æœ¬æ¶ˆæ¯çš„beanä¸­ã€‚è®©æˆ‘ä»¬ä¸ºè´­ç‰©åº”ç”¨ç¨‹åºå®ç°ä¸€ä¸ªå‡ºçº³å‘˜ç±»ï¼Œå®ƒæ¼”ç¤ºäº†å¦‚ä½•è§£ææ¶ˆæ¯ã€‚ 123456789101112131415161718package com.apress.springrecipes.shop;...@Componentpublic class Cashier &#123; @Autowired private MessageSource messageSource; public void setMessageSource(MessageSource messageSource) &#123; this.messageSource = messageSource; &#125; public void checkout(ShoppingCart cart) throws IOException &#123; String alert = messageSource.getMessage(\"alert.inventory.checkout\", new Object[] &#123; cart.getItems(), new Date() &#125;, Locale.US); System.out.println(alert); &#125;&#125; æ³¨æ„ï¼ŒPOJO messageSourceå­—æ®µæ˜¯Spring messageSourceç±»å‹ã€‚å­—æ®µå€¼ç”¨@Autowiredæ³¨é‡Šä¿®é¥°ï¼Œå› æ­¤åœ¨åˆ›å»ºbeanå®ä¾‹æ—¶é€šè¿‡æ³¨å…¥å¡«å……ã€‚ç„¶åï¼Œcheckoutæ–¹æ³•å¯ä»¥è®¿é—®messageSourceå­—æ®µï¼Œè¯¥å­—æ®µå…è®¸beanè®¿é—®getMessageæ–¹æ³•ï¼Œä»¥ä¾¿åŸºäºi18næ ‡å‡†è®¿é—®æ–‡æœ¬æ¶ˆæ¯ã€‚ ä½¿ç”¨æ³¨é‡Šå®šåˆ¶POJOåˆå§‹åŒ–å’Œé”€æ¯é—®é¢˜ æœ‰äº›pojoåœ¨ä½¿ç”¨å‰å¿…é¡»æ‰§è¡ŒæŸäº›ç±»å‹çš„åˆå§‹åŒ–ä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡å¯ä»¥åŒ…æ‹¬æ‰“å¼€æ–‡ä»¶ã€æ‰“å¼€ç½‘ç»œ/æ•°æ®åº“è¿æ¥ã€åˆ†é…å†…å­˜ç­‰ã€‚æ­¤å¤–ï¼Œè¿™äº›pojoå¿…é¡»åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶æ‰§è¡Œç›¸åº”çš„é”€æ¯ä»»åŠ¡ã€‚å› æ­¤ï¼Œæœ‰æ—¶éœ€è¦åœ¨Spring IoCå®¹å™¨ä¸­å®šåˆ¶beançš„åˆå§‹åŒ–å’Œé”€æ¯ã€‚ è§£å†³æ–¹æ¡ˆ Springå¯ä»¥é€šè¿‡åœ¨Javaé…ç½®ç±»ä¸­è®¾ç½®@Beanå®šä¹‰çš„initMethodå’Œé©±é€èˆ°æ–¹æ³•å±æ€§æ¥è¯†åˆ«åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ã€‚æˆ–è€…ï¼Œå¦‚æœPOJOæ–¹æ³•åˆ†åˆ«ç”¨@PostConstructå’Œ@PreDestroyæ³¨è§£ä¿®é¥°ï¼ŒSpringä¹Ÿå¯ä»¥è¯†åˆ«åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ã€‚Springè¿˜å¯ä»¥ä½¿ç”¨@Lazyæ³¨é‡Šå°†beançš„åˆ›å»ºå»¶è¿Ÿåˆ°éœ€è¦çš„æ—¶å€™(ä¸€ä¸ªç§°ä¸ºæƒ°æ€§åˆå§‹åŒ–çš„è¿‡ç¨‹)ã€‚Springè¿˜å¯ä»¥ä½¿ç”¨@DependsOnæ³¨é‡Šç¡®ä¿æŸäº›beançš„åˆå§‹åŒ–ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å®šä¹‰åœ¨ä½¿ç”¨@Beanåˆå§‹åŒ–å’Œé”€æ¯POJOä¹‹å‰è¦è¿è¡Œçš„æ–¹æ³•ã€‚è®©æˆ‘ä»¬ä»¥è´­ç‰©åº”ç”¨ç¨‹åºä¸ºä¾‹ï¼Œè€ƒè™‘ä¸€ä¸ªæ¶‰åŠcheckoutå‡½æ•°çš„ç¤ºä¾‹ã€‚è®©æˆ‘ä»¬ä¿®æ”¹å‡ºçº³å‘˜ç±»ï¼Œå°†è´­ç‰©è½¦çš„äº§å“å’Œç»“å¸æ—¶é—´è®°å½•åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839package com.apress.springrecipes.shop;import java.io.*;import java.util.Date;public class Cashier &#123; private String fileName; private String path; private BufferedWriter writer; public void setFileName(String fileName) &#123; this.fileName = fileName; &#125; public void setPath(String path) &#123; this.path = path; &#125; public void openFile() throws IOException &#123; File targetDir = new File(path); if (!targetDir.exists()) &#123; targetDir.mkdir(); &#125; File checkoutFile = new File(path, fileName + \".txt\"); if (!checkoutFile.exists()) &#123; checkoutFile.createNewFile(); &#125; writer = new BufferedWriter(new OutputStreamWriter( new FileOutputStream(checkoutFile, true))); &#125; public void checkout(ShoppingCart cart) throws IOException &#123; writer.write(new Date() + \"\\t\" + cart.getItems() + \"\\r\\n\"); writer.flush(); &#125; public void closeFile() throws IOException &#123; writer.close(); &#125;&#125; åœ¨å‡ºçº³å‘˜ç±»ä¸­ï¼ŒopenFile()æ–¹æ³•é¦–å…ˆéªŒè¯è¦å†™å…¥æ•°æ®çš„ç›®æ ‡ç›®å½•å’Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ç„¶ååœ¨æŒ‡å®šçš„ç³»ç»Ÿè·¯å¾„ä¸­æ‰“å¼€æ–‡æœ¬æ–‡ä»¶å¹¶å°†å…¶åˆ†é…ç»™writerå­—æ®µã€‚ç„¶åæ¯æ¬¡è°ƒç”¨checkout()æ–¹æ³•æ—¶ï¼Œå°†æ—¥æœŸå’Œè´­ç‰©è½¦é¡¹ç›®é™„åŠ åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚æœ€åï¼ŒcloseFile()æ–¹æ³•å…³é—­æ–‡ä»¶ï¼Œé‡Šæ”¾å…¶ç³»ç»Ÿèµ„æºã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç ”ç©¶å¦‚ä½•åœ¨Java configç±»ä¸­è®¾ç½®è¿™ä¸ªbeanå®šä¹‰ï¼Œä»¥ä¾¿åœ¨åˆ›å»ºbeanä¹‹å‰æ‰§è¡ŒopenFile()æ–¹æ³•ï¼Œåœ¨é”€æ¯beanä¹‹å‰æ‰§è¡ŒcloseFile()æ–¹æ³•ã€‚ 1234567891011@Configurationpublic class ShopConfiguration &#123; @Bean(initMethod = \"openFile\", destroyMethod = \"closeFile\") public Cashier cashier() &#123; String path = System.getProperty(\"java.io.tmpdir\") + \"/cashier\"; Cashier c1 = new Cashier(); c1.setFileName(\"checkout\"); c1.setPath(path); return c1; &#125;&#125; æ³¨æ„ï¼ŒPOJOçš„åˆå§‹åŒ–å’Œé”€æ¯ä»»åŠ¡æ˜¯ä½¿ç”¨@Beanæ³¨é‡Šçš„initMethodå’Œé©±é€èˆ°æ–¹æ³•å±æ€§å®šä¹‰çš„ã€‚é€šè¿‡åœ¨beanå£°æ˜ä¸­è®¾ç½®è¿™ä¸¤ä¸ªå±æ€§ï¼Œå½“åˆ›å»ºå‡ºçº³ç±»æ—¶ï¼Œå®ƒé¦–å…ˆè§¦å‘openFile()æ–¹æ³•ï¼ŒéªŒè¯ç›®æ ‡ç›®å½•å’Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠæ‰“å¼€æ–‡ä»¶ä»¥æ·»åŠ è®°å½•ã€‚å½“beanè¢«é”€æ¯æ—¶ï¼Œå®ƒè§¦å‘closeFile()æ–¹æ³•ï¼Œç¡®ä¿å…³é—­æ–‡ä»¶å¼•ç”¨ä»¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚ å®šä¹‰ä½¿ç”¨@PostConstructå’Œ@PreDestroyåœ¨POJOåˆå§‹åŒ–å’Œé”€æ¯ä¹‹å‰è¿è¡Œçš„æ–¹æ³•å¦‚æœåœ¨Javaé…ç½®ç±»ä¹‹å¤–å®šä¹‰POJOå®ä¾‹(ä¾‹å¦‚ï¼Œä½¿ç”¨@Componentæ³¨é‡Š)ï¼Œå¦ä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯ç›´æ¥åœ¨POJOç±»ä¸­ä½¿ç”¨@PostConstructå’Œ@PreDestroyæ³¨è§£ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839@Componentpublic class Cashier &#123; @Value(\"checkout\") private String fileName; @Value(\"c:/Windows/Temp/cashier\") private String path; private BufferedWriter writer; public void setFileName(String fileName) &#123; this.fileName = fileName; &#125; public void setPath(String path) &#123; this.path = path; &#125; @PostConstruct public void openFile() throws IOException &#123; File targetDir = new File(path); if (!targetDir.exists()) &#123; targetDir.mkdir(); &#125; File checkoutFile = new File(path, fileName + \".txt\"); if(!checkoutFile.exists()) &#123; checkoutFile.createNewFile(); &#125; writer = new BufferedWriter(new OutputStreamWriter( new FileOutputStream(checkoutFile, true))); &#125; public void checkout(ShoppingCart cart) throws IOException &#123; writer.write(new Date() + \"\\t\" +cart.getItems() + \"\\r\\n\"); writer.flush(); &#125; @PreDestroy public void closeFile() throws IOException &#123; writer.close(); &#125;&#125; @Componentæ³¨é‡Šå‘Šè¯‰Springç®¡ç†POJOï¼Œå°±åƒåœ¨ä»¥å‰çš„èœè°±ä¸­ä½¿ç”¨çš„é‚£æ ·ã€‚POJOå­—æ®µçš„ä¸¤ä¸ªå€¼ç”¨@Valueæ³¨é‡Šè®¾ç½®ï¼Œåœ¨ä¹‹å‰çš„èœè°±ä¸­ä¹Ÿè®¨è®ºäº†è¿™ä¸ªæ¦‚å¿µã€‚openFile()æ–¹æ³•ç”±@PostConstructæ³¨é‡Šä¿®é¥°ï¼Œè¯¥æ³¨é‡Šå‘Šè¯‰Springåœ¨æ„é€ beanä¹‹åç«‹å³æ‰§è¡Œè¯¥æ–¹æ³•ã€‚closeFile()æ–¹æ³•è¢«ä¿®é¥°ä¸º@PreDestroyæ³¨é‡Šï¼Œå®ƒå‘Šè¯‰Springåœ¨é”€æ¯beanä¹‹å‰æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚ ä½¿ç”¨@Lazyä¸ºpojoå®šä¹‰å»¶è¿Ÿåˆå§‹åŒ–é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringå¯¹æ‰€æœ‰pojoæ‰§è¡Œçƒ­åˆ‡åˆå§‹åŒ–ã€‚è¿™æ„å‘³ç€pojoåœ¨å¯åŠ¨æ—¶åˆå§‹åŒ–ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†POJOåˆå§‹åŒ–è¿‡ç¨‹å»¶è¿Ÿåˆ°éœ€è¦beanæ—¶ã€‚å»¶è¿Ÿåˆå§‹åŒ–ç§°ä¸ºå»¶è¿Ÿåˆå§‹åŒ–ã€‚å»¶è¿Ÿåˆå§‹åŒ–æœ‰åŠ©äºé™åˆ¶å¯åŠ¨æ—¶çš„èµ„æºæ¶ˆè€—å³°å€¼ï¼Œå¹¶ä¿å­˜æ•´ä¸ªç³»ç»Ÿèµ„æºã€‚å»¶è¿Ÿåˆå§‹åŒ–å¯¹äºæ‰§è¡Œé‡é‡çº§æ“ä½œ(ä¾‹å¦‚ï¼Œç½‘ç»œè¿æ¥ã€æ–‡ä»¶æ“ä½œ)çš„pojoå°¤å…¶ç›¸å…³ã€‚è¦ä½¿ç”¨æƒ°æ€§åˆå§‹åŒ–æ ‡è®°beanï¼Œæ‚¨å¯ä»¥ä½¿ç”¨@Lazyæ³¨é‡Šæ¥ä¿®é¥°beanã€‚ 123456789101112131415161718package com.apress.springrecipes.shop;...import org.springframework.stereotype.Component;import org.springframework.context.annotation.Scope;import org.springframework.context.annotation.Lazy;@Component @Scope(\"prototype\")@Lazypublic class ShoppingCart &#123; private List&lt;Product&gt; items = new ArrayList&lt;&gt;(); public void addItem(Product item) &#123; items.add(item); &#125; public List&lt;Product&gt; getItems() &#123; return items; &#125;&#125; åœ¨å‰é¢çš„å£°æ˜ä¸­ï¼Œç”±äºPOJOè¢«@Lazyæ³¨é‡Šä¿®é¥°ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä»ä¸éœ€è¦POJOæˆ–è¢«å¦ä¸€ä¸ªPOJOå¼•ç”¨ï¼Œå®ƒå°±ä¸ä¼šå®ä¾‹åŒ–ã€‚ åœ¨ä½¿ç”¨@DependsOnçš„å…¶ä»–pojoä¹‹å‰å®šä¹‰pojoçš„åˆå§‹åŒ–ä½œä¸ºåº”ç”¨ç¨‹åºçš„POJOå¢é•¿ï¼ŒPOJOåˆå§‹åŒ–çš„æ•°é‡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦‚æœpojoç›¸äº’å¼•ç”¨ï¼Œå¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒçš„Javaé…ç½®ç±»ä¸­ï¼Œåˆ™å¯ä»¥åˆ›å»ºç«äº‰æ¡ä»¶ã€‚å¦‚æœbean Céœ€è¦bean Bå’Œbean Fçš„é€»è¾‘ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢?å¦‚æœé¦–å…ˆæ£€æµ‹åˆ°bean Cï¼Œè€ŒSpringæ²¡æœ‰åˆå§‹åŒ–bean Bå’Œbean Fï¼Œæ‚¨å°†ä¼šå¾—åˆ°ä¸€ä¸ªå¾ˆéš¾æ£€æµ‹åˆ°çš„é”™è¯¯ã€‚ä¸ºäº†ç¡®ä¿åœ¨å…¶ä»–pojoä¹‹å‰å¯¹æŸäº›pojoè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶åœ¨åˆå§‹åŒ–è¿‡ç¨‹å¤±è´¥æ—¶è·å¾—æ›´å…·æè¿°æ€§çš„é”™è¯¯ï¼ŒSpringæä¾›äº†@DependsOnæ³¨é‡Šã€‚@DependsOnæ³¨é‡Šç¡®ä¿ç»™å®šçš„beanåœ¨å¦ä¸€ä¸ªbeanä¹‹å‰è¢«åˆå§‹åŒ–ã€‚ 1234567891011121314151617181920package com.apress.springrecipes.sequence.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.DependsOn;import org.springframework.context.annotation.Configuration;import com.apress.springrecipes.sequence.DatePrefixGenerator;import com.apress.springrecipes.sequence.NumberPrefixGenerator;import com.apress.springrecipes.sequence.SequenceGenerator;@Configurationpublic class SequenceConfiguration &#123; @Bean @DependsOn(\"datePrefixGenerator\") public SequenceGenerator sequenceGenerator() &#123; SequenceGenerator sequence= new SequenceGenerator(); sequence.setInitial(100000); sequence.setSuffix(\"A\"); return sequence; &#125;&#125; åˆ›å»ºPost-Processorsä»¥éªŒè¯å’Œä¿®æ”¹POJOsé—®é¢˜ æ‚¨å¸Œæœ›åœ¨æ„å»ºæœŸé—´å°†ä»»åŠ¡åº”ç”¨åˆ°æ‰€æœ‰beanå®ä¾‹æˆ–ç‰¹å®šç±»å‹çš„å®ä¾‹ï¼Œä»¥æ ¹æ®ç‰¹å®šçš„æ ‡å‡†éªŒè¯æˆ–ä¿®æ”¹beanå±æ€§ã€‚ è§£å†³æ–¹æ¡ˆ beanåå¤„ç†å™¨å…è®¸åœ¨åˆå§‹åŒ–å›è°ƒæ–¹æ³•ä¹‹å‰å’Œä¹‹åè¿›è¡Œbeanå¤„ç†(i.e. åˆ†é…ç»™@Beanæ³¨é‡Šçš„initMethodå±æ€§æˆ–ç”¨@PostConstructæ³¨é‡Šä¿®é¥°çš„æ–¹æ³•çš„å±æ€§)ã€‚beanåå¤„ç†å™¨çš„ä¸»è¦ç‰¹æ€§æ˜¯å®ƒå¤„ç†IoCå®¹å™¨ä¸­çš„æ‰€æœ‰beanå®ä¾‹ï¼Œè€Œä¸åªæ˜¯å•ä¸ªbeanå®ä¾‹ã€‚é€šå¸¸ï¼Œbeanåå¤„ç†å™¨ç”¨äºæ£€æŸ¥beanå±æ€§çš„æœ‰æ•ˆæ€§ï¼Œæ ¹æ®ç‰¹å®šçš„æ ‡å‡†ä¿®æ”¹beanå±æ€§ï¼Œæˆ–è€…å°†æŸäº›ä»»åŠ¡åº”ç”¨åˆ°æ‰€æœ‰beanå®ä¾‹ã€‚Springè¿˜æ”¯æŒ@Requiredæ³¨é‡Šï¼Œå®ƒç”±å†…ç½®çš„Spring post-processor RequiredAnnotationBeanPostProcessoræ”¯æŒã€‚RequiredAnnotationBeanPostProcessor beanäº‹åå¤„ç†å™¨æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†æ‰€æœ‰å¸¦æœ‰@Requiredæ³¨é‡Šçš„beanå±æ€§ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å‡è®¾æ‚¨å¸Œæœ›å®¡è®¡æ¯ä¸ªbeançš„åˆ›å»ºã€‚æ‚¨å¯èƒ½å¸Œæœ›è¿™æ ·åšæ¥è°ƒè¯•åº”ç”¨ç¨‹åºã€éªŒè¯æ¯ä¸ªbeançš„å±æ€§ï¼Œæˆ–è€…åœ¨å…¶ä»–åœºæ™¯ä¸­ã€‚beanåå¤„ç†å™¨æ˜¯å®ç°è¿™ä¸ªç‰¹æ€§çš„ç†æƒ³é€‰æ‹©ï¼Œå› ä¸ºæ‚¨ä¸å¿…ä¿®æ”¹ä»»ä½•ç°æœ‰çš„POJOä»£ç ã€‚ åˆ›å»ºPOJOæ¥å¤„ç†æ¯ä¸ªBeanå®ä¾‹ä½¿ç”¨å·¥å‚(é™æ€æ–¹æ³•ã€å®ä¾‹æ–¹æ³•ã€Springçš„FactoryBean)åˆ›å»ºPOJOsä½¿ç”¨Springç¯å¢ƒå’ŒProfilesåŠ è½½ä¸åŒçš„POJOsé›†è®©POJOsäº†è§£Springçš„IoCå®¹å™¨èµ„æºä½¿ç”¨é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å’Œæ³¨é‡Šè®¿é—®è¿æ¥ç‚¹ä¿¡æ¯ç”¨@Orderæ³¨é‡ŠæŒ‡å®šåˆ‡é¢çš„ä¼˜å…ˆçº§é‡ç”¨æ–¹é¢åˆ‡å…¥ç‚¹å®šä¹‰å†™AspectJåˆ‡å…¥ç‚¹è¡¨è¾¾å¼å°†AOPç”¨äºPOJOsçš„ä»‹ç»ç”¨AOPå‘POJOså¼•å…¥çŠ¶æ€åœ¨Springä½¿ç”¨Load-Timeç¼–ç»‡AspectJåˆ‡é¢åœ¨Springä¸­é…ç½®AspectJåˆ‡é¢ç”¨AOPå°†POJOsæ³¨å…¥åŸŸå¯¹è±¡ä½¿ç”¨Springå’ŒTaskExecutorsåº”ç”¨å¹¶å‘åœ¨POJOsä¹‹é—´é€šä¿¡åº”ç”¨ç¨‹åºäº‹ä»¶","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","slug":"Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","permalink":"https://jigangduan.github.io/categories/Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"}]},{"title":"Spring 5 å¼€å‘å·¥å…·","slug":"Spring-5-Recipes-1","date":"2018-07-29T07:42:17.000Z","updated":"2020-07-25T02:57:18.164Z","comments":true,"path":"2018/07/29/Spring-5-Recipes-1/","link":"","permalink":"https://jigangduan.github.io/2018/07/29/Spring-5-Recipes-1/","excerpt":"","text":"åœ¨æœ¬ç« ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•è®¾ç½®å’Œä½¿ç”¨æœ€æµè¡Œçš„å¼€å‘å·¥å…·æ¥åˆ›å»ºSpringåº”ç”¨ç¨‹åºã€‚ä¸è®¸å¤šå…¶ä»–è½¯ä»¶æ¡†æ¶ä¸€æ ·ï¼ŒSpringä¹Ÿæœ‰å¤§é‡çš„å¼€å‘å·¥å…·å¯ä¾›é€‰æ‹©ï¼Œä»ç®€å•çš„å‘½ä»¤è¡Œå·¥å…·åˆ°å¤æ‚çš„å›¾å½¢åŒ–å·¥å…·ï¼Œç§°ä¸ºé›†æˆå¼€å‘ç¯å¢ƒ(IDE)ã€‚ æ— è®ºæ‚¨æ˜¯å·²ç»ä½¿ç”¨äº†æŸäº›Javaå¼€å‘å·¥å…·ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨Javaå¼€å‘å·¥å…·ï¼Œä»¥ä¸‹é£Ÿè°±å°†æŒ‡å¯¼æ‚¨å¦‚ä½•è®¾ç½®ä¸åŒçš„å·¥å…·ç®±ï¼Œä»¥ä¾¿åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­è¿›è¡Œç»ƒä¹ ï¼Œä»¥åŠå¼€å‘ä»»ä½•Springåº”ç”¨ç¨‹åºã€‚ ä»¥ä¸‹æ˜¯å¯åŠ¨Springåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸‰ä¸ªå·¥å…·ç®±å’Œç›¸åº”çš„ç« èŠ‚: Springå·¥å…·å¥—ä»¶: ç« èŠ‚1-1 IntelliJ IDE:ç« èŠ‚1-2(ä»¥åŠMavenå‘½ä»¤è¡Œæ¥å£çš„ç« èŠ‚1-3å’Œ1-4;ç”¨äºGradleå‘½ä»¤è¡Œç•Œé¢çš„ç« èŠ‚1-5å’Œ1-6) Text editor:Mavenå‘½ä»¤è¡Œç•Œé¢çš„ç« èŠ‚1-3å’Œ1-4;ç”¨äºlevelå‘½ä»¤è¡Œæ¥å£çš„ç« èŠ‚1-5å’Œ1-6 Springå·¥å…·å¥—ä»¶ä½¿ç”¨IntelliJ IDEæ„å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºé—®é¢˜æ‚¨å¸Œæœ›ä½¿ç”¨IntelliJ IDEæ¥æ„å»ºSpringåº”ç”¨ç¨‹åºã€‚ è§£å†³æ–¹æ¡ˆè¦åœ¨IntelliJ Quick startçª—å£ä¸­å¯åŠ¨ä¸€ä¸ªæ–°çš„Springåº”ç”¨ç¨‹åºï¼Œè¯·å•å‡»Create new Projecté“¾æ¥ã€‚åœ¨ä¸‹ä¸€ä¸ªçª—å£ä¸­ï¼Œä¸ºé¡¹ç›®åˆ†é…ä¸€ä¸ªåç§°ï¼Œé€‰æ‹©ä¸€ä¸ªè¿è¡Œæ—¶JDKï¼Œå¹¶é€‰æ‹©Javaæ¨¡å—é€‰é¡¹ã€‚åœ¨ä¸‹ä¸€ä¸ªçª—å£ä¸­ï¼Œå•å‡»å„ç§Springå¤é€‰æ¡†ï¼Œä»¥ä¾¿IntelliJä¸‹è½½é¡¹ç›®æ‰€éœ€çš„Springä¾èµ–é¡¹ã€‚ è¦æ‰“å¼€ä¸€ä¸ªä½¿ç”¨Mavençš„Springåº”ç”¨ç¨‹åºï¼Œæ‚¨é¦–å…ˆéœ€è¦å®‰è£…Mavenä»¥ä»å‘½ä»¤è¡Œæ¥å£å·¥ä½œ(è¯·å‚é˜…é…æ–¹1-4)ã€‚ä»IntelliJé¡¶çº§æ–‡ä»¶èœå•ä¸­ï¼Œé€‰æ‹©Import Projecté€‰é¡¹ã€‚æ¥ä¸‹æ¥ï¼Œä»æ‚¨çš„å·¥ä½œç«™ä¸ŠåŸºäºMavené€‰æ‹©Springåº”ç”¨ç¨‹åºã€‚åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸Šï¼Œé€‰æ‹©â€œä»å¤–éƒ¨æ¨¡å‹å¯¼å…¥é¡¹ç›®â€é€‰é¡¹å¹¶é€‰æ‹©Mavenç±»å‹ã€‚ è¦æ‰“å¼€ä½¿ç”¨Gradleçš„Springåº”ç”¨ç¨‹åºï¼Œé¦–å…ˆéœ€è¦ä»å‘½ä»¤è¡Œç•Œé¢å®‰è£…Gradle(å‚è§èœè°±1-5)ã€‚åœ¨IntelliJé¡¶çº§æ–‡ä»¶èœå•ä¸­ï¼Œé€‰æ‹©Import Projecté€‰é¡¹ã€‚æ¥ä¸‹æ¥ï¼Œæ ¹æ®æ‚¨çš„å·¥ä½œç«™ä¸Šçš„Gradleé€‰æ‹©Springåº”ç”¨ç¨‹åºã€‚åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸­ï¼Œé€‰æ‹©â€œä»å¤–éƒ¨æ¨¡å‹å¯¼å…¥é¡¹ç›®â€é€‰é¡¹å¹¶é€‰æ‹©ä¸€ä¸ªGradleç±»å‹ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„IntelliJæ˜¯å¸‚åœºä¸Šæœ€å—æ¬¢è¿çš„å•†ä¸šideä¹‹ä¸€ã€‚ä¸å…¶ä»–ç”±åŸºé‡‘ä¼š(å¦‚Eclipse)æˆ–æ”¯æŒå…¬å¸æ——èˆ°è½¯ä»¶(å¦‚Springæ¡†æ¶çš„STS)ç”Ÿæˆçš„ideä¸åŒï¼ŒIntelliJæ˜¯ç”±JetBrainså…¬å¸(JetBrains)ç”Ÿäº§çš„ï¼Œè¯¥å…¬å¸çš„å”¯ä¸€ä¸šåŠ¡æ˜¯å°†å¼€å‘å·¥å…·å•†ä¸šåŒ–ã€‚æ­£æ˜¯è¿™ç§å…³æ³¨ï¼Œä½¿å¾—IntelliJåœ¨ä¼ä¸šç¯å¢ƒä¸­ç‰¹åˆ«å—ä¸“ä¸šå¼€å‘äººå‘˜çš„æ¬¢è¿ã€‚ å¯¹äºè¿™ä¸ªé£Ÿè°±ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨å·²ç»å®‰è£…äº†IntelliJ Ultimate editionï¼Œå¹¶ä¸”åªéœ€è¦å¯åŠ¨å’Œè¿è¡ŒSpringåº”ç”¨ç¨‹åºã€‚ â– è­¦å‘ŠintelliJæœ€ç»ˆæœ‰ä¸€ä¸ªå…è´¹çš„ç¤¾åŒºç‰ˆå’Œä¸€ä¸ª30å¤©å…è´¹è¯•ç”¨ç‰ˆã€‚å°½ç®¡å…è´¹ç¤¾åŒºç‰ˆä¸ºåº”ç”¨ç¨‹åºå¼€å‘æä¾›äº†è‰¯å¥½çš„ä»·å€¼ï¼Œä½†æ˜¯Community editionå¹¶ä¸åŒ…æ‹¬å¯¹Springåº”ç”¨ç¨‹åºçš„æ”¯æŒã€‚ä¸‹é¢çš„æŒ‡ä»¤æ˜¯åŸºäºå‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨intelliJç»ˆæç‰ˆæœ¬çš„ã€‚ åˆ›å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºè¦å¯åŠ¨Springåº”ç”¨ç¨‹åºï¼Œè¯·åœ¨IntelliJ Quick startçª—å£ä¸­å•å‡»Create New Projecté“¾æ¥ã€‚åœ¨æ–°é¡¹ç›®çª—å£ä¸­ï¼Œé€‰æ‹©Springé€‰é¡¹å¹¶å•å‡»å„ç§Springå¤é€‰æ¡†ï¼Œå¦‚å›¾1-8æ‰€ç¤ºã€‚ å¯¼å…¥å¹¶æ„å»ºMavené¡¹ç›®æ¯”ä»å¤´åˆ›å»ºSpringåº”ç”¨ç¨‹åºæ›´å¸¸è§çš„æƒ…å†µæ˜¯ç»§ç»­å¼€å‘ç°æœ‰çš„Springåº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è€…é€šå¸¸ä½¿ç”¨æ„å»ºè„šæœ¬åˆ†å‘åº”ç”¨ç¨‹åºçš„æºä»£ç ï¼Œä»¥ä¿ƒè¿›å…¶æ­£åœ¨è¿›è¡Œçš„å¼€å‘ã€‚å¤§å¤šæ•°Javaåº”ç”¨ç¨‹åºé€‰æ‹©çš„æ„å»ºè„šæœ¬æ˜¯pomã€‚å›´ç»•Mavenæ„å»ºå·¥å…·æˆ–æœ€è¿‘çš„æ„å»ºè®¾è®¡çš„xmlæ–‡ä»¶ã€‚å›´ç»•æ¸å˜å·¥å…·è®¾è®¡çš„æ¸å˜æ–‡ä»¶ã€‚è¿™æœ¬ä¹¦çš„æºä»£ç åŠå…¶åº”ç”¨ç¨‹åºæä¾›äº†æ¸å˜æ„å»ºæ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªå¸¦æœ‰Mavenæ„å»ºæ–‡ä»¶çš„åº”ç”¨ç¨‹åºã€‚ä¸‹è½½äº†è¯¥ä¹¦çš„æºä»£ç å¹¶å°†å…¶è§£å‹ç¼©åˆ°æœ¬åœ°ç›®å½•åï¼Œå•å‡»IntelliJé¡¶çº§æ–‡ä»¶èœå•å¹¶é€‰æ‹©Import Projecté€‰é¡¹ã€‚å¼¹å‡ºçª—å£ï¼Œå¦‚å›¾1-9æ‰€ç¤ºã€‚ åœ¨æ­¤çª—å£ä¸­ï¼Œåœ¨ç›®å½•æ ‘ä¸­å‘ä¸‹å±•å¼€ï¼Œç›´åˆ°æ‚¨åˆ°è¾¾ch01ä¸­å›¾ä¹¦æºä»£ç çš„ç›®å½•ï¼Œç„¶åé€‰æ‹©springintro_mvnã€‚ç‚¹å‡»æ‰“å¼€æŒ‰é’®ã€‚åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸­ï¼Œé€‰æ‹©â€œä»å¤–éƒ¨æ¨¡å‹å¯¼å…¥é¡¹ç›®â€é€‰é¡¹å¹¶é€‰æ‹©Mavenç±»å‹ï¼Œå¦‚å›¾1-10æ‰€ç¤ºã€‚ åœ¨ä¸‹ä¸€ä¸ªçª—å£ä¸­(å‚è§å›¾1-11)ï¼Œæ‚¨å¯ä»¥å¯¹ä¸€äº›Mavené¡¹ç›®è®¾ç½®è¿›è¡Œå¾®è°ƒï¼Œä¾‹å¦‚è‡ªåŠ¨å°†æ›´æ”¹å¯¼å…¥åˆ°pom.xmlï¼Œä¸‹è½½ä¾èµ–æºï¼Œç­‰ç­‰ã€‚å½“æ»¡è¶³è®¾ç½®æ—¶ï¼Œå•å‡»Next ç¡®ä¿é€‰ä¸­äº†é¡¹ç›®å¤é€‰æ¡†ï¼Œå¦‚å›¾1-12æ‰€ç¤ºï¼Œå¹¶å•å‡»NextæŒ‰é’®å¯¼å…¥é¡¹ç›®ã€‚ æ¥ä¸‹æ¥ï¼Œä¸ºé¡¹ç›®é€‰æ‹©SDKç‰ˆæœ¬ã€‚ç¡®è®¤é¡¹ç›®åç§°å’Œä½ç½®å¹¶å•å‡»FinishæŒ‰é’®ã€‚IntelliJä¸­çš„æ‰€æœ‰é¡¹ç›®éƒ½è¢«åŠ è½½åˆ°é¡¹ç›®çª—å£çš„å·¦è¾¹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œé¡¹ç›®ä»¥åç§°springintro_mvnå‡ºç°ã€‚å¦‚æœæ‚¨å•å‡»é¡¹ç›®å›¾æ ‡ï¼Œæ‚¨å°†èƒ½å¤Ÿçœ‹åˆ°é¡¹ç›®ç»“æ„(å³Javaç±»ã€ä¾èµ–é¡¹ã€é…ç½®æ–‡ä»¶ç­‰)ã€‚å¦‚æœåŒå‡»é¡¹ç›®çª—å£ä¸­çš„ä»»ä½•ä¸€ä¸ªé¡¹ç›®æ–‡ä»¶ï¼Œæ–‡ä»¶å°†åœ¨ä¸­å¿ƒçª—å£çš„ä¸€ä¸ªå•ç‹¬çš„é€‰é¡¹å¡ä¸­æ‰“å¼€ã€‚æ‚¨å¯ä»¥æ£€æŸ¥æ–‡ä»¶çš„å†…å®¹ï¼Œä»¥åŠç¼–è¾‘æˆ–åˆ é™¤å®ƒçš„å†…å®¹ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦è®¾ç½®Mavenæ¥ä½¿ç”¨IntelliJã€‚æŒ‰ç…§é£Ÿè°±1-3ä¸­çš„è¯´æ˜ï¼Œä»å‘½ä»¤è¡Œå®‰è£…Mavenã€‚è¿™æ ·åšä¹‹åï¼Œæ‚¨å°±å¯ä»¥è®¾ç½®IntelliJæ¥ä¸Mavenä¸€èµ·å·¥ä½œäº†ã€‚ å•å‡»IntelliJé¡¶çº§æ–‡ä»¶èœå•å¹¶é€‰æ‹©Settingsé€‰é¡¹ã€‚å‡ºç°ä¸€ä¸ªå¼¹å‡ºçª—å£æ¥é…ç½®IntelliJè®¾ç½®ã€‚å•å‡»Mavené€‰é¡¹ï¼Œåœ¨Mavenä¸»ç›®å½•ä¸­ä»‹ç»åŸºäºç³»ç»Ÿçš„Mavenå®‰è£…ç›®å½•ï¼Œå¦‚å›¾1-13æ‰€ç¤ºã€‚å•å‡»ApplyæŒ‰é’®ï¼Œç„¶åå•å‡»OKæŒ‰é’®ã€‚ æ¥ä¸‹æ¥ï¼Œåœ¨IntelliJçš„å³ä¾§ï¼Œå•å‡»å‚ç›´é€‰é¡¹å¡Mavené¡¹ç›®æ¥æ˜¾ç¤ºMavené¡¹ç›®çª—æ ¼ï¼Œå¦‚å›¾1-14æ‰€ç¤ºã€‚ åœ¨Maven Projectsçª—æ ¼ä¸­é€‰æ‹©é¡¹ç›®çš„â€œSpring lineç®€ä»‹â€ï¼Œç„¶åå³é”®å•å‡»ä»¥æ‰“å¼€åŒ…å«é¡¹ç›®å„ç§å‘½ä»¤çš„ä¸Šä¸‹æ–‡èœå•ã€‚é€‰æ‹©Run Mavenæ„å»ºé€‰é¡¹ã€‚åœ¨IntelliJçš„åº•éƒ¨ä¸­å¿ƒï¼Œä½ ä¼šçœ‹åˆ°Runçª—å£å‡ºç°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRunçª—å£å°†æ˜¾ç¤ºMavenç”Ÿæˆçš„ä¸€ç³»åˆ—æ„å»ºæ¶ˆæ¯ï¼Œä»¥åŠåœ¨æ„å»ºè¿‡ç¨‹å¤±è´¥æ—¶å¯èƒ½å‡ºç°çš„ä»»ä½•é”™è¯¯ã€‚ è­¦å‘Šå¦‚æœæ‚¨çœ‹åˆ°é”™è¯¯æ¶ˆæ¯â€œæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„mavenå®‰è£…ã€‚è¦ä¹ˆåœ¨é…ç½®å¯¹è¯æ¡†ä¸­è®¾ç½®ä¸»ç›®å½•ï¼Œè¦ä¹ˆåœ¨ç³»ç»Ÿä¸Šè®¾ç½®m2_homeç¯å¢ƒå˜é‡ã€‚éªŒè¯mavençš„å®‰è£…å’Œé…ç½®è¿‡ç¨‹ã€‚ æ‚¨åˆšåˆšæ„å»ºäº†åº”ç”¨ç¨‹åºï¼Œç¥è´ºæ‚¨!ç°åœ¨,è®©æˆ‘ä»¬æ¥è¿è¡Œå®ƒã€‚å¦‚æœæ²¡æœ‰çœ‹åˆ°ç›®æ ‡ç›®å½•ï¼Œè¯·æŒ‰Ctrl+Alt+Yç»„åˆé”®æ¥åŒæ­¥é¡¹ç›®ã€‚é€šè¿‡å•å‡»å±•å¼€ç›®æ ‡ç›®å½•å®ƒçš„å›¾æ ‡ã€‚æ¥ä¸‹æ¥ï¼Œå³é”®å•å‡»æ–‡ä»¶springintro_mvn-4.0.0-SNAPSHOT.jarï¼Œå¦‚å›¾1-15æ‰€ç¤ºï¼Œå¹¶é€‰æ‹©Runé€‰é¡¹ã€‚ åœ¨è¿è¡Œçª—å£IntelliJçš„åº•éƒ¨ä¸­å¿ƒï¼Œæ‚¨å°†çœ‹åˆ°åº”ç”¨ç¨‹åºæ—¥å¿—æ¶ˆæ¯ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå®šä¹‰çš„é—®å€™è¯­æ¶ˆæ¯ã€‚ å¯¼å…¥å’Œå»ºè®¾Gradleé¡¹ç›®ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨IntelliJæ„å»ºä¸€ä¸ªGradleåº”ç”¨ç¨‹åºã€‚é¦–å…ˆä½ éœ€è¦å®‰è£…ç­‰çº§ã€‚æŒ‰ç…§é…æ–¹1-4ä¸­çš„è¯´æ˜ä»å‘½ä»¤è¡Œå®‰è£…Gradleã€‚ä¸€æ—¦æ‚¨è¿™æ ·åšäº†ï¼Œæ‚¨å°±å¯ä»¥è®¾ç½®IntelliJæ¥å¤„ç†Gradleã€‚å•å‡»IntelliJé¡¶çº§æ–‡ä»¶èœå•å¹¶é€‰æ‹©Import Projecté€‰é¡¹ã€‚å¼¹å‡ºçª—å£ï¼Œå¦‚å›¾1-9æ‰€ç¤ºã€‚åœ¨å¼¹å‡ºçª—å£ä¸­å‘ä¸‹æŒ–æ˜ç›®å½•æ ‘ï¼Œç›´åˆ°æ‚¨å¯ä»¥é€‰æ‹©æ–‡ä»¶æ„å»ºã€‚åœ¨ch01/springintroç›®å½•çš„ä¹¦çš„æºä»£ç ã€‚ç‚¹å‡»æ‰“å¼€æŒ‰é’®ã€‚åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸Šï¼Œé€‰æ‹©â€œä»å¤–éƒ¨æ¨¡å‹å¯¼å…¥é¡¹ç›®â€é€‰é¡¹å¹¶é€‰æ‹©Gradleã€‚åœ¨ä¸‹ä¸€ä¸ªå±å¹•ä¸Šï¼Œæ ¹æ®ç³»ç»Ÿçš„Gradleå®‰è£…ï¼Œåœ¨â€œGradle homeâ€æ¡†ä¸­è¾“å…¥Gradle homeç›®å½•ï¼Œå¦‚å›¾1-16æ‰€ç¤ºã€‚ å•å‡»FinishæŒ‰é’®ç¡®è®¤å¯¼å…¥è¿‡ç¨‹ï¼Œç„¶åå•å‡»FinishæŒ‰é’®å®Œæˆå¯¼å…¥è¿‡ç¨‹ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®çª—å£ä¸­ï¼Œå³é”®å•å‡»buildã€‚æ¸å˜å¹¶é€‰æ‹©è¿è¡Œæ„å»ºã€‚æ‚¨åˆšåˆšæ„å»ºäº†åº”ç”¨ç¨‹åºã€‚ç°åœ¨,è®©æˆ‘ä»¬æ¥è¿è¡Œå®ƒã€‚åœ¨é¡¹ç›®çª—å£ä¸­ï¼Œå±•å¼€æ„å»ºç›®å½•å¹¶è¿›å…¥libsç›®å½•ã€‚æ‰¾åˆ°springintro-all.jarï¼Œå¦‚å›¾1-17æ‰€ç¤ºã€‚ æ³¨æ„ï¼Œbuild.gradleæ–‡ä»¶è¢«é…ç½®ä¸ºç”Ÿæˆä¸€ä¸ªå½±å­Jarï¼Œè¿™æ„å‘³ç€å®ƒåŒ…å«è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ç±»å’Œä¾èµ–é¡¹ã€‚ ç°åœ¨å³é”®å•å‡»springintro-all.jar æ–‡ä»¶å¹¶é€‰æ‹©Runé€‰é¡¹ã€‚åœ¨è¿è¡Œçª—å£IntelliJçš„åº•éƒ¨ä¸­å¿ƒï¼Œæ‚¨å°†çœ‹åˆ°åº”ç”¨ç¨‹åºæ—¥å¿—æ¶ˆæ¯ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå®šä¹‰çš„é—®å€™è¯­æ¶ˆæ¯ã€‚ ä½¿ç”¨Mavenå‘½ä»¤è¡Œæ¥å£æ„å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºé—®é¢˜æ‚¨å¸Œæœ›ä½¿ç”¨å‘½ä»¤è¡Œä¸­çš„Mavenæ„å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºã€‚ è§£å†³æ–¹æ¡ˆä»http://maven.apache.org/download.cgiä¸‹è½½Mavenã€‚ç¡®ä¿å°†JAVA_HOMEç¯å¢ƒå˜é‡è®¾ç½®ä¸ºJavaçš„SDKä¸»ç›®å½•ã€‚ä¿®æ”¹PATHç¯å¢ƒå˜é‡ä»¥åŒ…å«Mavençš„binç›®å½•ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„Mavenæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤è¡Œæ¥å£å·¥å…·ã€‚è¿™å…è®¸ä»å„ç§å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨Mavenã€‚ä¾‹å¦‚,å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨å¦‚emacsæˆ–viç¼–è¾‘åº”ç”¨ç¨‹åºçš„ä»£ç ,å°±åŸºæœ¬èƒ½å¤Ÿè®¿é—®Mavenè¿™æ ·çš„æ„å»ºå·¥å…·æ¥è‡ªåŠ¨åŒ–çš„ç¹é‡å·¥ä½œ(ä¾‹å¦‚,å¤åˆ¶æ–‡ä»¶,ä¸€æ­¥ç¼–è¯‘)é€šå¸¸ä¸Javaåº”ç”¨ç¨‹åºçš„æ„å»ºè¿‡ç¨‹ç›¸å…³è”ã€‚ å¯ä»¥ä»http://maven.apache.org/download.cgiå…è´¹ä¸‹è½½Mavenã€‚Mavenå¯ä»¥åœ¨æºä»£ç å’ŒäºŒè¿›åˆ¶ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚ç”±äºJavaå·¥å…·æ˜¯è·¨å¹³å°çš„ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä¸‹è½½äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œä»¥é¿å…é¢å¤–çš„ç¼–è¯‘æ­¥éª¤ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒMavençš„æœ€æ–°ç¨³å®šç‰ˆæœ¬æ˜¯3.5.0ç‰ˆæœ¬ã€‚ ä¸‹è½½Mavenä¹‹åï¼Œç¡®ä¿åœ¨ç³»ç»Ÿä¸Šå®‰è£…äº†Java SDKï¼Œå› ä¸ºMavenåœ¨è¿è¡Œæ—¶éœ€è¦å®ƒã€‚é€šè¿‡è§£å‹Mavenå¹¶å®šä¹‰JAVA_HOMEå’ŒPATHç¯å¢ƒå˜é‡ï¼Œç»§ç»­å®‰è£…Mavenã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤è§£å‹: 1www@ubuntu:~$ tar -xzvf apache-maven-3.5.0-bin.tar.gz ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ JAVA_HOMEå˜é‡: 1www@ubuntu:~$ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk/ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†Mavenå¯æ‰§è¡Œæ–‡ä»¶æ·»åŠ åˆ°PATHå˜é‡: 1www@ubuntu:~$ export PATH=$PATH:/home/www/apache-maven-3.5.0/bin/ â– æç¤ºå¦‚æœä½ å£°æ˜JAVA_HOMEå˜é‡å’Œè·¯å¾„è¯´æ˜ä¹‹å‰,ä½ éœ€è¦åšè¿™ä¸ªè¿‡ç¨‹ä½ æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°çš„shellä¼šè¯ä½¿ç”¨mavenã€‚åœ¨Unix/linuxç³»ç»Ÿä¸Šï¼Œæ‚¨å¯ä»¥åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­æ‰“å¼€.bashrcæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ç›¸åŒçš„å¯¼å‡ºè¡Œï¼Œä»¥é¿å…åœ¨æ¯ä¸ªä¼šè¯ä¸­å£°æ˜ç¯å¢ƒå˜é‡ã€‚åœ¨Windowsç³»ç»Ÿä¸Šï¼Œæ‚¨å¯ä»¥é€šè¿‡é€‰æ‹©æˆ‘çš„è®¡ç®—æœºå›¾æ ‡ï¼Œå³é”®å•å‡»ï¼Œç„¶åé€‰æ‹©propertiesé€‰é¡¹æ¥æ°¸ä¹…è®¾ç½®ç¯å¢ƒå˜é‡ã€‚åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œé€‰æ‹©advancedé€‰é¡¹å¡å¹¶å•å‡»â€œç¯å¢ƒå˜é‡â€æŒ‰é’®ã€‚ Mavenå¯æ‰§è¡Œæ–‡ä»¶é€šè¿‡mvnå‘½ä»¤å¯ç”¨ã€‚å¦‚æœæ‚¨æŒ‰ç…§å‰é¢çš„æè¿°æ­£ç¡®åœ°è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä»ç³»ç»Ÿä¸Šçš„ä»»ä½•ç›®å½•è¾“å…¥mvnå°†è°ƒç”¨Mavenã€‚æè¿°å…³äºMavenæ‰§è¡Œçš„æ›´å¤šç»†èŠ‚å°†è¶…å‡ºæ­¤èœè°±çš„èŒƒå›´ã€‚ç„¶è€Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æè¿°å¦‚ä½•ä½¿ç”¨Mavenä»è¯¥ä¹¦çš„æºä»£ç æ„å»ºSpringåº”ç”¨ç¨‹åºã€‚ä¸€æ—¦ä¸‹è½½äº†è¯¥ä¹¦çš„æºä»£ç å¹¶å°†å…¶è§£å‹åˆ°æœ¬åœ°ç›®å½•ï¼Œè¯·è½¬åˆ°åä¸ºch01/springintro_mvnçš„ç›®å½•ã€‚é”®å…¥mvnè°ƒç”¨Mavenï¼Œå¹¶åœ¨springintro_mvnä¸‹æ„å»ºåº”ç”¨ç¨‹åºã€‚è¾“å‡ºåº”è¯¥å¦‚å›¾1-18æ‰€ç¤ºã€‚ æ‚¨åˆšåˆšæ„å»ºäº†åº”ç”¨ç¨‹åºï¼Œç¥è´ºæ‚¨!ç°åœ¨,è®©æˆ‘ä»¬æ¥è¿è¡Œå®ƒã€‚æ·±å…¥åˆ°ç”±Mavenåœ¨ch01/springintro_mvnç›®å½•ä¸‹åˆ›å»ºçš„åä¸ºtargetçš„ç›®å½•ä¸­ã€‚æ‚¨å°†çœ‹åˆ°æ–‡ä»¶springintro_mvn- 4.0.0-SNAPSHOT.jarï¼Œå®ƒæ˜¯æ„å»ºçš„åº”ç”¨ç¨‹åºã€‚æ‰§è¡Œå‘½ä»¤java -jar springintro_mvn- 1-0.SNAPSHOT.jaræ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚æ‚¨å°†çœ‹åˆ°åº”ç”¨ç¨‹åºæ—¥å¿—æ¶ˆæ¯ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå®šä¹‰çš„é—®å€™æ¶ˆæ¯ã€‚ ä½¿ç”¨Gradleå‘½ä»¤è¡Œç•Œé¢æ„å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºé—®é¢˜æ‚¨å¸Œæœ›ä½¿ç”¨å‘½ä»¤è¡Œä¸­çš„Gradleæ„å»ºSpringåº”ç”¨ç¨‹åºã€‚ è§£å†³æ–¹æ¡ˆä»www.gradle.org/downloadsä¸‹è½½å®ƒã€‚ç¡®ä¿å°†JAVA_HOMEç¯å¢ƒå˜é‡è®¾ç½®ä¸ºã€‚Java SDKä¸»è¦ç›®å½•ã€‚ä¿®æ”¹PATHç¯å¢ƒå˜é‡ä»¥åŒ…å«Gradleçš„binç›®å½•ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„Gradleæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤è¡Œå·¥å…·ã€‚è¿™å…è®¸ä»å¹¿æ³›çš„å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨Gradleã€‚ä¾‹å¦‚,å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨å¦‚emacsæˆ–viç¼–è¾‘åº”ç”¨ç¨‹åºçš„ä»£ç ,å°±åŸºæœ¬èƒ½å¤Ÿè®¿é—®åƒGradleè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ç¹é‡å·¥ä½œ(ä¾‹å¦‚,å¤åˆ¶æ–‡ä»¶,ä¸€æ­¥ç¼–è¯‘)é€šå¸¸ä¸Javaåº”ç”¨ç¨‹åºçš„æ„å»ºè¿‡ç¨‹ç›¸å…³è”ã€‚Gradleå¯ä»¥é€šè¿‡www.gradle.org/downloadså…è´¹ä¸‹è½½ã€‚Gradleå¯ä»¥åœ¨æºä»£ç å’ŒäºŒè¿›åˆ¶ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚ç”±äºJavaå·¥å…·æ˜¯è·¨å¹³å°çš„ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä¸‹è½½äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œä»¥é¿å…é¢å¤–çš„ç¼–è¯‘æ­¥éª¤ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒGradleçš„æœ€æ–°ç¨³å®šç‰ˆæœ¬æ˜¯3.5ç‰ˆæœ¬ã€‚ä¸€æ—¦æ‚¨ä¸‹è½½äº†Gradleï¼Œç¡®ä¿åœ¨ç³»ç»Ÿä¸Šå®‰è£…äº†Java SDKï¼Œå› ä¸ºGradleåœ¨è¿è¡Œæ—¶éœ€è¦å®ƒã€‚é€šè¿‡è§£å‹å¹¶å®šä¹‰JAVA_HOMEå’ŒPATHç¯å¢ƒå˜é‡ï¼Œç»§ç»­å®‰è£…Gradleã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤è§£å‹: 1www@ubuntu:~$ unzip gradle-3.5-bin.zip ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ JAVA_HOMEå˜é‡: 1www@ubuntu:~$ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk/ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å¯æ‰§è¡Œç­‰çº§æ·»åŠ åˆ°è·¯å¾„å˜é‡: 1www@ubuntu:~$ export PATH=$PATH:/home/www/gradle-3.5/bin/ å°½ç®¡Gradle(å‚è§1-3)ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤è¡Œå·¥å…·å¯ç”¨ï¼Œä½†æ˜¯å¾ˆå¤š(å¼€æº)é¡¹ç›®ä½¿ç”¨MavenåŒ…è£…å™¨æ¥è®¿é—®Mavenã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯åº”ç”¨ç¨‹åºå®Œå…¨æ˜¯è‡ªæä¾›çš„ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨ä¸éœ€è¦å®‰è£…Mavenï¼Œå› ä¸ºMavenåŒ…è£…å™¨å°†ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„Mavenæ¥æ„å»ºé¡¹ç›®ã€‚ æç¤º:å¦‚æœæ‚¨å¦‚å‰é¢æ‰€ç¤ºå£°æ˜äº†å˜é‡JAVA_HOMEå’ŒPATHï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°çš„shellä¼šè¯ä½¿ç”¨gradleæ—¶ï¼Œæ‚¨éƒ½éœ€è¦æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ã€‚åœ¨Unix/linuxç³»ç»Ÿä¸Šï¼Œæ‚¨å¯ä»¥åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­æ‰“å¼€.bashrcæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ç›¸åŒçš„å¯¼å‡ºè¡Œï¼Œä»¥é¿å…åœ¨æ¯ä¸ªä¼šè¯ä¸­å£°æ˜ç¯å¢ƒå˜é‡ã€‚åœ¨Windowsç³»ç»Ÿä¸Šï¼Œæ‚¨å¯ä»¥é€šè¿‡é€‰æ‹©æˆ‘çš„è®¡ç®—æœºå›¾æ ‡ï¼Œå³é”®å•å‡»ï¼Œç„¶åé€‰æ‹©propertiesé€‰é¡¹æ¥æ°¸ä¹…è®¾ç½®ç¯å¢ƒå˜é‡ã€‚åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œé€‰æ‹©advancedé€‰é¡¹å¡å¹¶å•å‡»â€œç¯å¢ƒå˜é‡â€æŒ‰é’®ã€‚ Gradleå¯æ‰§è¡Œæ–‡ä»¶é€šè¿‡gradleå‘½ä»¤å¯ç”¨ã€‚å¦‚æœæ‚¨æŒ‰ç…§å‰é¢æè¿°çš„é‚£æ ·æ­£ç¡®åœ°è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä»ç³»ç»Ÿä¸Šçš„ä»»ä½•ç›®å½•è¾“å…¥gradleå°†è°ƒç”¨gradleã€‚æè¿°æ›´å¤šå…³äºç­‰çº§æ‰§è¡Œçš„ç»†èŠ‚å°†è¶…å‡ºè¿™ä¸ªé£Ÿè°±çš„èŒƒå›´ã€‚ç„¶è€Œï¼Œç”±äºæœ¬ä¹¦çš„æºä»£ç ä¸­æœ‰è®¸å¤šä½¿ç”¨Gradleçš„Springåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†æè¿°å¦‚ä½•ä½¿ç”¨Gradleæ¥æ„å»ºè¿™äº›Springåº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªã€‚ ä¸€æ—¦ä¸‹è½½äº†è¯¥ä¹¦çš„æºä»£ç å¹¶å°†å…¶è§£å‹ç¼©åˆ°æœ¬åœ°ç›®å½•ï¼Œè¯·è½¬åˆ°åä¸ºch01/springintroçš„ç›®å½•ã€‚ç±»å‹gradleè°ƒç”¨gradleå¹¶åœ¨springintroä¸‹æ„å»ºåº”ç”¨ç¨‹åºã€‚è¾“å‡ºåº”è¯¥å¦‚å›¾1-20æ‰€ç¤ºã€‚ æ‚¨åˆšåˆšæ„å»ºäº†åº”ç”¨ç¨‹åºï¼Œç¥è´ºæ‚¨!ç°åœ¨,è®©æˆ‘ä»¬æ¥è¿è¡Œå®ƒã€‚æ·±å…¥åˆ°ch01/springintroç›®å½•ä¸‹çš„Gradleåˆ›å»ºçš„åä¸ºlibsçš„ç›®å½•ä¸­ã€‚æ‚¨å°†çœ‹åˆ°æ–‡ä»¶springintro-all.jarï¼Œå®ƒæ˜¯æ„å»ºçš„åº”ç”¨ç¨‹åºã€‚æ‰§è¡Œå‘½ä»¤java -jar springintro-all.jar toruntheåº”ç”¨ç¨‹åºã€‚æ‚¨å°†çœ‹åˆ°åº”ç”¨ç¨‹åºæ—¥å¿—æ¶ˆæ¯ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå®šä¹‰çš„é—®å€™æ¶ˆæ¯ã€‚ ä½¿ç”¨GradleåŒ…è£…å™¨æ„å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºé—®é¢˜æ‚¨å¸Œæœ›ä½¿ç”¨å‘½ä»¤è¡Œä¸­çš„GradleåŒ…è£…å™¨æ„å»ºä¸€ä¸ªSpringåº”ç”¨ç¨‹åºã€‚ è§£å†³æ–¹æ¡ˆä»å‘½ä»¤è¡Œè¿è¡Œgradlewè„šæœ¬ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å°½ç®¡Gradle(å‚è§ç§˜è¯€1-5)å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†æ˜¯å¾ˆå¤š(å¼€æºçš„)é¡¹ç›®éƒ½ä½¿ç”¨GradleåŒ…è£…å™¨æ¥æä¾›å¯¹Gradleçš„è®¿é—®ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯åº”ç”¨ç¨‹åºå®Œå…¨æ˜¯è‡ªæä¾›çš„ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨ä¸éœ€è¦å®‰è£…Gradleï¼Œå› ä¸ºGradleåŒ…è£…å™¨å°†ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„Gradleæ¥æ„å»ºé¡¹ç›®ã€‚ä¸€æ—¦æ‚¨æœ‰äº†ä¸€ä¸ªä½¿ç”¨GradleåŒ…è£…å™¨çš„é¡¹ç›®ï¼Œæ‚¨å°±å¯ä»¥ç®€å•åœ°åœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥./gradlewæ„å»ºï¼Œè¿™æ ·Gradleå°±å¯ä»¥è‡ªåŠ¨ä¸‹è½½å¹¶è¿è¡Œæ„å»ºã€‚æƒŸä¸€çš„å…ˆå†³æ¡ä»¶æ˜¯å®‰è£…Java SDKï¼Œå› ä¸ºGradleåœ¨è¿è¡Œæ—¶éœ€è¦å®ƒï¼Œè€ŒGradleåŒ…è£…å™¨éœ€è¦å®ƒè¿è¡Œã€‚ ä¸‹è½½è¿™æœ¬ä¹¦çš„æºä»£ç å¹¶å°†å…¶è§£å‹åˆ°æœ¬åœ°ç›®å½•ä¹‹åï¼Œè½¬åˆ°åä¸ºch01/Recipe_1_6çš„ç›®å½•ã€‚é”®å…¥./gradlewä»¥è°ƒç”¨GradleåŒ…è£…å™¨ï¼Œå¹¶åœ¨Recipe_1_6ä¸‹è‡ªåŠ¨æ„å»ºåº”ç”¨ç¨‹åºã€‚è¾“å‡ºå°†å¦‚å›¾1-21æ‰€ç¤ºã€‚ â– æç¤ºä¹¦çš„æºä»£ç å¯ä»¥ç”¨çº¯gradleæˆ–gradleåŒ…è£…ã€‚åè€…æ›´å¯å–ï¼Œå› ä¸ºåœ¨å¼€å‘ç¤ºä¾‹æ—¶ï¼Œä»£ç å°†ä½¿ç”¨ç›¸åŒçš„çº§åˆ«ç‰ˆæœ¬æ„å»ºã€‚ æ€»ç»“åœ¨æœ¬ç« ä¸­ï¼Œæ‚¨äº†è§£äº†å¦‚ä½•è®¾ç½®æœ€æµè¡Œçš„å¼€å‘å·¥å…·æ¥åˆ›å»ºSpringåº”ç”¨ç¨‹åºã€‚æ‚¨äº†è§£äº†å¦‚ä½•ä½¿ç”¨å››ä¸ªå·¥å…·ç®±æ„å»ºå’Œè¿è¡ŒSpringåº”ç”¨ç¨‹åºã€‚ä¸¤ä¸ªå·¥å…·ç®±ç”±ä½¿ç”¨IDEç»„æˆ:Springæ¡†æ¶åˆ›å»ºè€…åˆ†å‘çš„Springå·¥å…·å¥—ä»¶å’ŒJetBrainsåˆ†å‘çš„IntelliJ IDEã€‚å¦å¤–ä¸¤ä¸ªå·¥å…·ç®±åŒ…æ‹¬ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·:Mavenæ„å»ºå·¥å…·å’Œæ›´æ–°çš„Gradleæ„å»ºå·¥å…·ï¼Œå®ƒä»¬æ¯”Mavenæ„å»ºå·¥å…·æ›´å—æ¬¢è¿","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","slug":"Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","permalink":"https://jigangduan.github.io/categories/Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"}]},{"title":"Spring 5 å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","slug":"Spring-5-Recipes","date":"2018-07-29T07:16:04.000Z","updated":"2020-07-25T02:57:18.166Z","comments":true,"path":"2018/07/29/Spring-5-Recipes/","link":"","permalink":"https://jigangduan.github.io/2018/07/29/Spring-5-Recipes/","excerpt":"","text":"ä»‹ç»Springæ¡†æ¶æ­£åœ¨å¢é•¿ã€‚å…³äºé€‰æ‹©ã€‚Java EEä¸“æ³¨äºä¸€äº›æŠ€æœ¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†æŸå®³æ›¿ä»£çš„ã€æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚å½“Springæ¡†æ¶åˆæ¬¡äº®ç›¸æ—¶ï¼Œå¾ˆå°‘æœ‰äººä¼šè®¤ä¸ºJava EEä»£è¡¨äº†å½“ä»Šæœ€å¥½çš„ä½“ç³»ç»“æ„ã€‚Springé¦–æ¬¡å¤§å¼ æ——é¼“åœ°äº®ç›¸ï¼Œæ˜¯å› ä¸ºå®ƒå¯»æ±‚ç®€åŒ–Java EEã€‚æ­¤åçš„æ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½æ ‡è®°äº†æ–°ç‰¹æ€§çš„å¼•å…¥ï¼Œè¿™äº›æ–°ç‰¹æ€§æ—¢ç®€åŒ–äº†è§£å†³æ–¹æ¡ˆï¼Œåˆç®€åŒ–äº†è§£å†³æ–¹æ¡ˆã€‚ éšç€ç‰ˆæœ¬2.0å’Œæ›´æ–°ï¼ŒSpringæ¡†æ¶å¼€å§‹é’ˆå¯¹å¤šä¸ªå¹³å°ã€‚æ¡†æ¶ä¸€å¦‚æ—¢å¾€åœ°åœ¨ç°æœ‰å¹³å°ä¹‹ä¸Šæä¾›æœåŠ¡ï¼Œä½†å°½å¯èƒ½åœ°ä¸åº•å±‚å¹³å°åˆ†ç¦»ã€‚Java EEä»ç„¶æ˜¯ä¸€ä¸ªä¸»è¦çš„å‚è€ƒç‚¹ï¼Œä½†å®ƒä¸æ˜¯å”¯ä¸€çš„ç›®æ ‡ã€‚æ­¤å¤–ï¼ŒSpringæ¡†æ¶åœ¨ä¸åŒçš„äº‘ç¯å¢ƒä¸­è¿è¡Œã€‚æ„å»ºäºSpringä¹‹ä¸Šçš„æ¡†æ¶å·²ç»å‡ºç°ï¼Œä»¥æ”¯æŒåº”ç”¨ç¨‹åºé›†æˆã€æ‰¹å¤„ç†ã€æ¶ˆæ¯ä¼ é€’ç­‰ç­‰ã€‚Springæ¡†æ¶çš„ç‰ˆæœ¬5æ˜¯ä¸€ä¸ªä¸»è¦çš„å‡çº§ï¼ŒåŸºçº¿è¢«æå‡åˆ°Java 8ï¼Œå¢åŠ äº†å¯¹åŸºäºæ³¨é‡Šçš„é…ç½®çš„æ›´å¤šæ”¯æŒï¼Œå¹¶å¼•å…¥äº†å¯¹jUnit 5çš„æ”¯æŒã€‚æ–°å¢åŠ çš„åŠŸèƒ½æ˜¯æ”¯æŒåœ¨Spring WebFluxçš„å½¢å¼ä¸­è¿›è¡Œçš„ å“åº”æ€§ç¼–ç¨‹ã€‚ è¿™æ˜¯è¿™æœ¬æå¥½çš„é£Ÿè°±ä¹¦çš„ç¬¬å››ç‰ˆï¼Œå®ƒæ¶µç›–äº†æ›´æ–°åçš„æ¡†æ¶ï¼Œæè¿°äº†æ–°ç‰¹æ€§å¹¶è§£é‡Šäº†ä¸åŒçš„é…ç½®é€‰é¡¹ã€‚ è¦æè¿°Springç”Ÿæ€ç³»ç»Ÿä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å†³å®šè¦ä¿ç•™ä»€ä¹ˆï¼Œæ·»åŠ ä»€ä¹ˆï¼Œä»¥åŠæ›´æ–°ä»€ä¹ˆã€‚è¿™æ˜¯ä¸€ä¸ªè‰°éš¾çš„å†³å®šï¼Œä½†æˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬å·²ç»åŒ…å«äº†æœ€é‡è¦çš„å†…å®¹ã€‚ ç»“æ„ ç¬¬1ç« â€œSpringå¼€å‘å·¥å…·â€æ¦‚è¿°äº†æ”¯æŒSpringæ¡†æ¶çš„å·¥å…·ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚ ç¬¬2ç« â€œSpringæ ¸å¿ƒä»»åŠ¡â€ç»™å‡ºäº†Springæ¡†æ¶çš„æ¦‚è¿°ï¼ŒåŒ…æ‹¬å¦‚ä½•è®¾ç½®å®ƒã€å®ƒæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚ ç¬¬3ç« â€œSpring MVCâ€ä»‹ç»äº†ä½¿ç”¨Spring Web MVCæ¡†æ¶è¿›è¡ŒåŸºäºWebçš„åº”ç”¨ç¨‹åºå¼€å‘ã€‚ ç¬¬4ç« â€œSpring RESTâ€ä»‹ç»äº†Springå¯¹RESTful webæœåŠ¡çš„æ”¯æŒã€‚ ç¬¬5ç« â€œSpring MVC: Asyncå¤„ç†â€ä»‹ç»äº†ä½¿ç”¨Spring MVCçš„å¼‚æ­¥å¤„ç†ã€‚ ç¬¬6ç« ï¼Œâ€œSpring Socialâ€ï¼Œä»‹ç»äº†Spring Socialï¼Œå®ƒå¯ä»¥è®©ä½ è½»æ¾åœ°èå…¥åˆ°ç¤¾äº¤ç½‘ç»œä¸­ã€‚ ç¬¬7ç« â€œSpring Securityâ€æä¾›äº†Spring Securityé¡¹ç›®çš„æ¦‚è¿°ï¼Œä»¥å¸®åŠ©æ‚¨æ›´å¥½åœ°ä¿æŠ¤åº”ç”¨ç¨‹åºã€‚ ç¬¬å…«ç« â€œSpring Mobileâ€ä»‹ç»äº†Spring Mobileï¼Œå®ƒå…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­é›†æˆç§»åŠ¨è®¾å¤‡æ£€æµ‹å’Œä½¿ç”¨ã€‚ ç¬¬9ç« â€œæ•°æ®è®¿é—®â€è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨Springä½¿ç”¨JDBCã€Hibernateå’ŒJPAç­‰apiä¸æ•°æ®å­˜å‚¨å¯¹è¯ã€‚ ç¬¬10ç« â€œSpringäº‹åŠ¡ç®¡ç†â€ä»‹ç»äº†Springå¥å£®çš„äº‹åŠ¡ç®¡ç†åŠŸèƒ½èƒŒåçš„æ¦‚å¿µã€‚ ç¬¬11ç« â€œSpring Batchâ€ä»‹ç»äº†Spring Batchæ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§ä¸ºä¼ ç»Ÿä¸Šè¢«è®¤ä¸ºæ˜¯å¤§å‹æœºé¢†åŸŸçš„è§£å†³æ–¹æ¡ˆå»ºæ¨¡çš„æ–¹æ³•ã€‚ ç¬¬12ç« â€œå¸¦NoSQLçš„Springâ€ä»‹ç»äº†å¤šä¸ªSpringæ•°æ®ç»„åˆé¡¹ç›®ï¼Œæ¶µç›–äº†ä¸åŒçš„NoSQLæŠ€æœ¯å’Œä½¿ç”¨Hadoopçš„å¤§æ•°æ®ã€‚ ç¬¬13ç« ï¼Œâ€œSpring Javaä¼ä¸šæœåŠ¡å’Œè¿œç¨‹æŠ€æœ¯â€ï¼Œå‘æ‚¨ä»‹ç»äº†JMXæ”¯æŒã€è°ƒåº¦ã€ç”µå­é‚®ä»¶æ”¯æŒä»¥åŠRPCçš„å„ç§è®¾æ–½ï¼ŒåŒ…æ‹¬Spring WebæœåŠ¡é¡¹ç›®ã€‚ ç¬¬14ç« â€œSpringæ¶ˆæ¯ä¼ é€’â€è®¨è®ºäº†é€šè¿‡JMSå’ŒRabbitMQä½¿ç”¨Springå’Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼Œä»¥åŠç®€åŒ–SpringæŠ½è±¡ã€‚ ç¬¬15ç« â€œSpringé›†æˆâ€è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨Springé›†æˆæ¡†æ¶é›†æˆä¸åŒçš„æœåŠ¡å’Œæ•°æ®ã€‚ ç¬¬16ç« â€œSpringæµ‹è¯•â€è®¨è®ºäº†ä½¿ç”¨Springæ¡†æ¶çš„å•å…ƒæµ‹è¯•ã€‚ ç¬¬17ç« â€œGrailsâ€è®¨è®ºäº†Grailsæ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥æé«˜ç”Ÿäº§ç‡,æœ€å¥½çš„ç‰‡æ®µå¹¶ä¸Groovyä»£ç ç»‘å®šåœ¨ä¸€èµ·ã€‚ å…ˆå†³æ¡ä»¶å› ä¸ºJavaç¼–ç¨‹è¯­è¨€æ˜¯å¹³å°ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥è‡ªç”±åœ°é€‰æ‹©ä»»ä½•å—æ”¯æŒçš„æ“ä½œç³»ç»Ÿã€‚ç„¶è€Œï¼Œæœ¬ä¹¦ä¸­çš„ä¸€äº›ä¾‹å­ä½¿ç”¨äº†ç‰¹å®šäºå¹³å°çš„è·¯å¾„ã€‚åœ¨è¾“å…¥ç¤ºä¾‹ä¹‹å‰ï¼Œå¿…é¡»å°†å®ƒä»¬ç¿»è¯‘æˆæ“ä½œç³»ç»Ÿçš„æ ¼å¼ã€‚ è¦å……åˆ†åˆ©ç”¨è¿™æœ¬ä¹¦ï¼Œè¯·å®‰è£…JDK 1.8æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ‚¨åº”è¯¥å®‰è£…ä¸€ä¸ªJava IDEä»¥ç®€åŒ–å¼€å‘ã€‚å¯¹äºæœ¬ä¹¦ï¼Œç¤ºä¾‹ä»£ç æ˜¯åŸºäºå±‚æ¬¡çš„ã€‚å¦‚æœæ‚¨æ­£åœ¨è¿è¡ŒEclipseå¹¶å®‰è£…Gradleæ’ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨Eclipseä¸­æ‰“å¼€ç›¸åŒçš„ä»£ç ï¼Œå¹¶ä¸”ç±»è·¯å¾„å’Œä¾èµ–é¡¹å°†ç”±Gradleå…ƒæ•°æ®å¡«å……ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨Eclipseï¼Œæ‚¨å¯èƒ½æ›´å–œæ¬¢SpringSourceå·¥å…·å¥—ä»¶(STS)ï¼Œå› ä¸ºå®ƒé¢„è£…äº†åœ¨Eclipseä¸­ä½¿ç”¨Springæ¡†æ¶æ‰€éœ€çš„æ’ä»¶ã€‚å¦‚æœæ‚¨ä½¿ç”¨IntelliJ IDEAï¼Œæ‚¨éœ€è¦å¯ç”¨Gradle(å’ŒGroovy)æ’ä»¶ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","slug":"Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","permalink":"https://jigangduan.github.io/categories/Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"}]},{"title":"CASä¼ä¸šå•ç‚¹ç™»å½•-å®‰è£…(Maven)","slug":"cas-Maven-Overlay-Installation","date":"2018-07-13T02:03:13.000Z","updated":"2020-07-25T02:57:18.195Z","comments":true,"path":"2018/07/13/cas-Maven-Overlay-Installation/","link":"","permalink":"https://jigangduan.github.io/2018/07/13/cas-Maven-Overlay-Installation/","excerpt":"","text":"CASå®‰è£…åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªé¢å‘æºçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ¨èä¸€ä¸ªWAR overlay(1)é¡¹ç›®æ¥ç»„ç»‡å®šåˆ¶ï¼Œæ¯”å¦‚ç»„ä»¶é…ç½®å’ŒUIè®¾è®¡ã€‚WARè¦†ç›–æ„å»ºçš„è¾“å‡ºæ˜¯casã€‚å¯ä»¥éƒ¨ç½²åˆ°servletå®¹å™¨(å¦‚Apache Tomcat)çš„waræ–‡ä»¶ã€‚ éœ€æ±‚å‚è§æœ¬æŒ‡å—äº†è§£æ›´å¤šä¿¡æ¯ã€‚ ä»€ä¹ˆæ˜¯WARè¦†ç›–è¦†ç›–æ˜¯ä¸€ç§å¯¹æŠ—é‡å¤ä»£ç å’Œ/æˆ–èµ„æºçš„ç­–ç•¥ã€‚è¦†ç›–å…è®¸æ‚¨ä¸‹è½½ç”±é¡¹ç›®æœ¬èº«æä¾›çš„é¢„æ„å»ºçš„æ™®é€šCAS webåº”ç”¨æœåŠ¡å™¨ï¼Œå¹¶è¦†ç›–/æ’å…¥ç‰¹å®šçš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯ä»æºä»£ç ä¸‹è½½CASä»£ç åº“å’Œæ„å»ºã€‚åœ¨æ„å»ºæ—¶ï¼ŒMaven/Gradleå®‰è£…è¿‡ç¨‹å°†é¦–å…ˆå°è¯•ä¸‹è½½æä¾›çš„äºŒè¿›åˆ¶å·¥ä»¶ã€‚ç„¶åï¼Œè¯¥å·¥å…·å°†å®šä½æ‚¨åœ¨åŒä¸€é¡¹ç›®ç›®å½•ä¸­å¯ç”¨çš„é…ç½®æ–‡ä»¶å’Œè®¾ç½®ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶åˆ°ä¸‹è½½çš„å·¥ä»¶ä¸­ï¼Œä»¥ä¾¿ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„å­˜æ¡£(ä¾‹å¦‚ï¼Œcas.war)ã€‚è¦†ç›–çš„å·¥ä»¶å¯èƒ½åŒ…æ‹¬èµ„æºã€javaç±»ã€å›¾åƒã€CSSå’Œjavascriptæ–‡ä»¶ã€‚ä¸ºäº†æˆåŠŸåœ°æ‰§è¡Œåˆå¹¶è¿›ç¨‹ï¼Œåœ¨æœ¬åœ°è¢«è¦†ç›–çš„å·¥ä»¶çš„ä½ç½®å’Œåç§°å¿…é¡»ä¸æœ€åˆä¸‹è½½çš„å½’æ¡£æ–‡ä»¶ä¸­é¡¹ç›®æä¾›çš„ä½ç½®å’Œåç§°å®Œå…¨åŒ¹é…ã€‚ æ¯«æ— ç–‘é—®ï¼Œå°½ç®¡å‰æœŸå‡†å¤‡é˜¶æ®µå¯èƒ½ä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿: ä¸éœ€è¦ä»æºä»£ç ä¸‹è½½/æ„å»ºã€‚ é€šè¿‡ç®€å•åœ°è°ƒæ•´æ„å»ºè„šæœ¬ä»¥ä¸‹è½½æ›´æ–°çš„CASç‰ˆæœ¬ï¼Œå‡çº§åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½éå¸¸å®¹æ˜“ã€‚ ä¸æ‰˜ç®¡æ•´ä¸ªè½¯ä»¶æºä»£ç ä¸åŒï¼Œä½œä¸ºéƒ¨ç½²äººå‘˜ï¼Œæ‚¨åªä¿ç•™æ‚¨è‡ªå·±çš„æœ¬åœ°è‡ªå®šä¹‰ï¼Œè¿™ä½¿å¾—æ›´æ”¹è·Ÿè¸ªæ›´åŠ å®¹æ˜“ã€‚ è·Ÿè¸ªæºä»£ç æ§åˆ¶å­˜å‚¨åº“ä¸­çš„æ›´æ”¹æ˜¯éå¸¸è½»é‡çº§çš„ï¼Œè¿™åŒæ ·æ˜¯å› ä¸ºåªç®¡ç†ç›¸å…³çš„æ›´æ”¹(è€Œä¸æ˜¯æ•´ä¸ªè½¯ä»¶)ã€‚ ç®¡ç†è¦†ç›–CASçš„æ¯ä¸ªæ–¹é¢éƒ½å¯ä»¥é€šè¿‡å åŠ ä¸­æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹æ–‡ä»¶è¿›è¡Œæ§åˆ¶;é€šè¿‡æ·»åŠ ç¬¬ä¸‰æ–¹ç»„ä»¶(å°†CAS apiå®ç°ä¸ºJavaæºæ–‡ä»¶æˆ–ä¾èµ–é¡¹å¼•ç”¨)æ¥å®šåˆ¶CASçš„è¡Œä¸ºä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œä¹Ÿæ˜¯å¸¸è§çš„ã€‚ ä½¿ç”¨è¦†ç›–å±‚çš„è¿‡ç¨‹ï¼Œä¸ç®¡æ˜¯Mavenè¿˜æ˜¯Gradleï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ€»ç»“: å¼€å§‹å¹¶æ„å»ºæä¾›çš„åŸºæœ¬æ„å»º/éƒ¨ç½²ã€‚ ä»ç”Ÿæˆçš„æ„å»ºä¸­è¯†åˆ«éœ€è¦æ›´æ”¹çš„æ„ä»¶ã€‚è¿™äº›æ„ä»¶é€šå¸¸ç”±ç›®æ ‡æˆ–Mavenæˆ–Gradleçš„æ„å»ºç›®å½•ä¸­ç”Ÿæˆã€‚ å°†ä¸Šè¿°ç›®å½•ä¸­æ ‡è¯†çš„æ„ä»¶å¤åˆ¶åˆ°srcç›®å½•ä¸­ã€‚ åˆ›å»ºsrcç›®å½•åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒä»¬è¿˜ä¸å­˜åœ¨çš„è¯ã€‚ å¤åˆ¶çš„è·¯å¾„å’Œæ–‡ä»¶åå¿…é¡»ä¸æ„å»ºç‰ˆæœ¬å®Œå…¨åŒ¹é…ï¼Œå¦åˆ™æ›´æ”¹ä¸ä¼šç”Ÿæ•ˆã€‚è¯·å‚é˜…ä¸‹é¢çš„è¡¨æ ¼ï¼Œäº†è§£å¦‚ä½•å°†æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ä»æ„å»ºæ˜ å°„åˆ°srcã€‚ æ›´æ”¹ä¹‹åï¼Œå°½å¯èƒ½å¤šåœ°é‡æ–°æ„å»ºå’Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ åœ¨æ„å»ºçš„äºŒè¿›åˆ¶å·¥ä»¶ä¸­å†æ¬¡æ£€æŸ¥æ‚¨çš„æ›´æ”¹ï¼Œä»¥ç¡®ä¿è¦†ç›–è¿‡ç¨‹æ­£åœ¨å·¥ä½œã€‚ æ˜¯å‡†ç¡®çš„ä¸è¦å¤åˆ¶æ„å»ºç”Ÿæˆçš„æ‰€æœ‰å†…å®¹ã€‚å°è¯•å°†æ›´æ”¹å’Œè‡ªå®šä¹‰ä¿æŒåˆ°æœ€å°ï¼Œåªè·å–å®é™…éœ€è¦çš„å†…å®¹ã€‚ç¡®ä¿éƒ¨ç½²ç¯å¢ƒä¿æŒå¹²å‡€å’Œç²¾ç¡®ï¼Œå¦åˆ™æ‚¨å°†é¢ä¸´ä¸¥é‡å‡çº§é—®é¢˜å’Œä»¤äººå¤´ç—›çš„é£é™©ã€‚ CAS WARè¦†ç›–æä¾›CAS WARè¦†ç›–é¡¹ç›®ä¾›å‚è€ƒå’Œç ”ç©¶ã€‚ å®¡æŸ¥åˆ†æ”¯!ä¸‹é¢çš„å­˜å‚¨åº“æŒ‡å‘å®ƒä»¬çš„ä¸»åˆ†æ”¯ã€‚æ‚¨åº”è¯¥å§‹ç»ˆç¡®ä¿æ‚¨æ‰€åœ¨çš„åˆ†æ”¯ä¸æ‚¨å¸Œæœ›é…ç½®å’Œéƒ¨ç½²çš„CASç‰ˆæœ¬åŒ¹é…ã€‚ä¸»åˆ†æ”¯é€šå¸¸æŒ‡å‘CASæœåŠ¡å™¨çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚æ£€æŸ¥æ„å»ºé…ç½®ï¼Œå¦‚æœä¸åˆé€‚ï¼Œä½¿ç”¨gitåˆ†æ”¯aæŸ¥çœ‹å¯ç”¨çš„åˆ†æ”¯ï¼Œç„¶ågitç­¾å‡º[branch-name]ä»¥åœ¨å¿…è¦æ—¶è¿›è¡Œåˆ‡æ¢ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"Spring/CASä¼ä¸šå•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/categories/Spring/CASä¼ä¸šå•ç‚¹ç™»å½•/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"å•ç‚¹ç™»å½•","slug":"å•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/tags/å•ç‚¹ç™»å½•/"}]},{"title":"CASä¼ä¸šå•ç‚¹ç™»å½•-å®‰è£…è¦æ±‚","slug":"cas-Installation-Requirements","date":"2018-07-13T01:21:07.000Z","updated":"2020-07-25T02:57:18.195Z","comments":true,"path":"2018/07/13/cas-Installation-Requirements/","link":"","permalink":"https://jigangduan.github.io/2018/07/13/cas-Installation-Requirements/","excerpt":"","text":"æ ¹æ®é…ç½®ç»„ä»¶çš„é€‰æ‹©ï¼Œå¯èƒ½ä¼šæœ‰å…¶ä»–éœ€æ±‚ï¼Œå¦‚LDAPç›®å½•ã€æ•°æ®åº“å’Œç¼“å­˜åŸºç¡€è®¾æ–½ã€‚ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹äºé€‰æ‹©å…·æœ‰æ˜ç¡®ç¡¬ä»¶å’Œè½¯ä»¶ä¾èµ–å…³ç³»çš„ç»„ä»¶çš„éƒ¨ç½²äººå‘˜æ¥è¯´ï¼Œéœ€æ±‚åº”è¯¥æ˜¯ä¸è¨€è€Œå–»çš„ã€‚åœ¨ä»»ä½•å…¶ä»–éœ€æ±‚ä¸æ˜æ˜¾çš„æƒ…å†µä¸‹ï¼Œç»„ä»¶é…ç½®çš„è®¨è®ºéƒ½åº”è¯¥æåˆ°ç³»ç»Ÿã€è½¯ä»¶ã€ç¡¬ä»¶å’Œå…¶ä»–éœ€æ±‚ã€‚ JavaCASçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåŸºäºjavaçš„webåº”ç”¨ç¨‹åºã€‚åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œéœ€è¦å®‰è£…JDK v1.8 Servletå®¹å™¨æ²¡æœ‰å®˜æ–¹æ”¯æŒçš„CASçš„servletå®¹å™¨ï¼Œä½†æ˜¯Apache Tomcatæ˜¯æœ€å¸¸ç”¨çš„ã€‚å¯¹ç‰¹å®šservletå®¹å™¨çš„æ”¯æŒå–å†³äºç¤¾åŒºæˆå‘˜çš„ä¸“ä¸šçŸ¥è¯†ã€‚ æ›´å¤šä¿¡æ¯è¯·å‚è§æœ¬æŒ‡å—ã€‚ æ„å»ºå·¥å…·æä¾›äº†Mavenæˆ–Gradleè¦†ç›–ï¼Œä»¥æ”¯æŒç®€å•è€Œçµæ´»çš„éƒ¨ç½²è§£å†³æ–¹æ¡ˆã€‚è¯šç„¶ï¼Œå®ƒéœ€è¦é«˜æ˜‚çš„å‰æœŸå­¦ä¹ æˆæœ¬ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œå®ƒèƒ½å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚ å°‘åšä¸€äº›åœ¨å®‰è£…ä¹‹å‰ï¼Œæ‚¨ä¸éœ€è¦å®‰è£…Mavenæˆ–Gradleã€‚å®ƒä»¬æ˜¯è‡ªåŠ¨æä¾›ç»™æ‚¨çš„ã€‚ Git(å¯é€‰)è™½ç„¶ä¸æ˜¯ä¸¥æ ¼çš„è¦æ±‚ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®æ‚¨ä¸ºæ‚¨çš„CASéƒ¨ç½²å®‰è£…Gitï¼Œå¹¶ç®¡ç†æ‰€æœ‰CASæ„ä»¶ã€é…ç½®æ–‡ä»¶ã€æ„å»ºè„šæœ¬å’Œæºä»£ç æ§åˆ¶å­˜å‚¨åº“ä¸­çš„è®¾ç½®ã€‚ æ“ä½œç³»ç»Ÿè™½ç„¶åŸºäºlinuxçš„å®‰è£…é€šå¸¸æ¯”Windowsæ›´å¸¸è§ï¼Œä½†åœ¨æ“ä½œç³»ç»Ÿä¸Šæ²¡æœ‰ç‰¹åˆ«çš„åå¥½ã€‚ ç½‘ç»œè¿æ¥Internetè¿æ¥é€šå¸¸ç”¨äºä»»ä½•åŸºäºMaven/Gradleçš„é¡¹ç›®çš„æ„å»ºé˜¶æ®µï¼ŒåŒ…æ‹¬ç”¨äºå®‰è£…CASçš„æ¨èWARè¦†ç›–ã€‚æ„å»ºè¿‡ç¨‹é€šè¿‡æœç´¢åŒ…å«åœ¨æœ¬åœ°ä¸‹è½½å’Œå®‰è£…çš„å·¥ä»¶(å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯jaræ–‡ä»¶)çš„åœ¨çº¿å­˜å‚¨åº“æ¥è§£å†³ä¾èµ–å…³ç³»ã€‚ ç¡¬ä»¶åŠé—´è¯æ®ä¼¼ä¹è¡¨æ˜ï¼Œåœ¨å…·æœ‰8GBå†…å­˜çš„åŒæ ¸3.00Ghzå¤„ç†å™¨ä¸Šï¼ŒCASéƒ¨ç½²è‡³å°‘å¯ä»¥æ‰§è¡Œå¾—å¾ˆå¥½ã€‚å¦‚æœæ—¥å¿—ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆè¿˜éœ€è¦è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´(æœ€å¥½æ˜¯SSD)æ¥å­˜æ”¾ç”±casasç”Ÿæˆçš„æ—¥å¿—ã€‚ è®°ä½ï¼Œä¸Šé¢çš„è¦æ±‚åªæ˜¯å»ºè®®ã€‚æ ¹æ®æ‚¨çš„éƒ¨ç½²å’Œè¯·æ±‚é‡çš„ä¸åŒï¼Œæ‚¨æˆ–å¤šæˆ–å°‘éƒ½å¯ä»¥å¾—åˆ°å®Œç¾çš„ç»“æœã€‚ä»æœ€ä½é™åº¦å¼€å§‹ï¼Œå‡†å¤‡æ ¹æ®éœ€è¦è°ƒæ•´å’ŒåŠ å¼ºèƒ½åŠ›ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"Spring/CASä¼ä¸šå•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/categories/Spring/CASä¼ä¸šå•ç‚¹ç™»å½•/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"å•ç‚¹ç™»å½•","slug":"å•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/tags/å•ç‚¹ç™»å½•/"}]},{"title":"CASä¼ä¸šå•ç‚¹ç™»å½•-å…¥é—¨æŒ‡å—","slug":"cas-Getting-Started","date":"2018-07-12T14:33:48.000Z","updated":"2020-07-25T02:57:18.194Z","comments":true,"path":"2018/07/12/cas-Getting-Started/","link":"","permalink":"https://jigangduan.github.io/2018/07/12/cas-Getting-Started/","excerpt":"","text":"æœ¬æ–‡æ¡£æä¾›äº†å…³äºå¦‚ä½•å¼€å§‹ä½¿ç”¨CASæœåŠ¡å™¨éƒ¨ç½²çš„é«˜çº§æŒ‡å—ã€‚è¯¥æŒ‡å—çš„å”¯ä¸€é‡ç‚¹æ˜¯æè¿°CASéƒ¨ç½²äººå‘˜å¿…é¡»éµå¾ªå’Œé‡‡ç”¨çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿è·å¾—æˆåŠŸå’Œå¯æŒç»­çš„ä½“ç³»ç»“æ„å’Œéƒ¨ç½²ã€‚ æ”¶é›†ç”¨ä¾‹åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œè®°å½•ã€ç¼–ç›®å’Œåˆ†ææ‰€éœ€çš„ç”¨ä¾‹å’Œéœ€æ±‚æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€æ—¦æ‚¨æœ‰äº†ä¸€äº›æƒ³æ³•ï¼Œè¯·ä¸CASç¤¾åŒºè®¨è®ºå¹¶åˆ†äº«é‚£äº›å¯èƒ½å·²ç»è§£å†³äº†æ‚¨ä»Šå¤©é¢ä¸´çš„ç›¸åŒé—®é¢˜çš„å…±åŒè¶‹åŠ¿ã€å®è·µå’Œæ¨¡å¼ã€‚ å­¦ä¹ æ¶æ„äº†è§£ä»€ä¹ˆæ˜¯CASï¼Œå¯ä»¥åšä»€ä¹ˆã€‚è¿™å°†å¸®åŠ©æ‚¨å¼€å‘ä¸€ä¸ªåŸºç¡€ï¼Œä»¥å®ç°æ‚¨çš„å“ªäº›ç”¨ä¾‹å’Œéœ€æ±‚åœ¨CASä¸­å¯èƒ½å·²ç»æ˜¯å¯èƒ½çš„ã€‚çœ‹ä¸€ä¸‹CASæ¶æ„çš„åŸºæœ¬åŸç†ï¼Œçœ‹çœ‹éƒ¨ç½²å’Œåº”ç”¨ç¨‹åºé›†æˆå¯èƒ½æœ‰å“ªäº›é€‰é¡¹å’Œé€‰æ‹©ã€‚ åŒæ ·ï¼Œç ”ç©¶CASæ”¯æŒçš„åè®®å’Œè§„èŒƒåˆ—è¡¨ä¹ŸåŒæ ·é‡è¦ã€‚ è¯„è®ºåšå®¢æœ‰æ—¶ï¼Œå½“ä½ åœ¨è€ƒè™‘éœ€æ±‚å’Œè¯„ä¼°ç‰¹æ€§æ—¶ï¼Œåšå®¢æ–‡ç« ä¼šå‡ºç°åœ¨Apereoåšå®¢ä¸Šã€‚ä¸€èˆ¬å»ºè®®æ‚¨å…³æ³¨è¿™ä¸ªåšå®¢ï¼Œå°½å¯èƒ½å…³æ³¨é¡¹ç›®æ–°é—»å’Œå…¬å‘Šï¼Œåœ¨æ•´ä¸ªCASéƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œä¸è¦ç¾äºæ’°å†™å’Œå‘å¸ƒæ‚¨è‡ªå·±çš„åšå®¢æ–‡ç« ã€ç»éªŒå’Œæ›´æ–°ã€‚ å‡†å¤‡ç¯å¢ƒå¾ˆç®€å•ï¼Œç ”ç©¶éƒ¨ç½²ç¯å¢ƒçš„å®‰è£…éœ€æ±‚ã€‚ éƒ¨ç½²CASå»ºè®®ä½¿ç”¨WAR Overlayæ–¹æ³•åœ¨æœ¬åœ°æ„å»ºå’Œéƒ¨ç½²CASã€‚è¿™ç§æ–¹æ³•ä¸éœ€è¦é‡‡ç”¨è€…æ˜¾å¼åœ°ä¸‹è½½ä»»ä½•ç‰ˆæœ¬çš„CASï¼Œè€Œæ˜¯åˆ©ç”¨è¦†ç›–æœºåˆ¶å°†CASåŸå§‹æ„ä»¶å’Œæœ¬åœ°è‡ªå®šä¹‰ç»“åˆèµ·æ¥ï¼Œä»¥è¿›ä¸€æ­¥ç®€åŒ–æœªæ¥çš„å‡çº§å’Œç»´æŠ¤ã€‚ æ³¨æ„:ä¸è¦ç›´æ¥å…‹éš†æˆ–ä¸‹è½½CASä»£ç åŸºã€‚åªæœ‰å½“æ‚¨å¸Œæœ›ä¸ºé¡¹ç›®çš„å¼€å‘åšå‡ºè´¡çŒ®æ—¶ï¼Œæ‰éœ€è¦è¿™æ ·åšã€‚ åœ¨åšä»»ä½•å…¶ä»–äº‹æƒ…ä¹‹å‰ï¼Œæ‚¨éƒ½åº”è¯¥å…ˆå»ºç«‹ä¸€ä¸ªåŠŸèƒ½åŸºçº¿ã€‚é¿å…ç«‹å³è¿›è¡Œä¸´æ—¶æ›´æ”¹ä»¥å®šåˆ¶éƒ¨ç½²ã€‚åšæŒä½¿ç”¨cas-æä¾›çš„é»˜è®¤è®¾ç½®å’Œè®¾ç½®ï¼Œå¹¶ä¸€æ¬¡æ”¹å˜ä¸€ä¸ªæ­¥éª¤ã€‚è·Ÿè¸ªè¿›ç¨‹å’Œåœ¨æºä»£ç æ§åˆ¶å’Œæ ‡è®°æ›´æ”¹ä¸­åº”ç”¨çš„æ›´æ”¹ã€‚ å®šåˆ¶è¿™å°±æ˜¯ç”¨ä¾‹è¢«æ˜ å°„åˆ°CASç‰¹æ€§çš„åœ°æ–¹ã€‚æµè§ˆæ–‡æ¡£ä»¥æ‰¾åˆ°æœ€æ¥è¿‘çš„åŒ¹é…å¹¶åº”ç”¨ã€‚åŒæ ·ï¼Œé‡è¦çš„æ˜¯å°½å¯èƒ½åšæŒCASåŸºçº¿: é¿å…å¯¹è½¯ä»¶å†…éƒ¨è¿›è¡Œç‰¹åˆ«çš„æ›´æ”¹ã€‚ é¿å…æ‰‹å·¥æ›´æ”¹æ ¸å¿ƒé…ç½®ç»„ä»¶ï¼Œå¦‚Springå’ŒSpring Webflowã€‚ å¦‚æœé‡åˆ°é—®é¢˜ï¼Œé¿å…å¯¹éƒ¨ç½²è¿›è¡Œä¸€æ¬¡æ€§çš„é”™è¯¯ä¿®å¤ã€‚ å¦‚å‰æ‰€è¿°ï¼Œæ‰€æœ‰è¿™äº›ç­–ç•¥éƒ½ä¼šå¯¼è‡´å¤´ç—›å’Œæˆæœ¬ã€‚ ç›¸åï¼Œè¯•ç€å‡†å¤‡ä»¥ä¸‹å»ºè®®: é”™è¯¯ä¿®å¤å’Œå°çš„æ”¹è¿›å±äºæ ¸å¿ƒçš„CASè½¯ä»¶ã€‚ä¸æ˜¯ä½ çš„éƒ¨ç½²ã€‚å°½ä¸€åˆ‡åŠªåŠ›æŠ¥å‘Šé—®é¢˜ï¼Œæä¾›ä¿®å¤å’Œè¡¥ä¸ï¼Œå¹¶ä¸CASç¤¾åŒºä¸€èµ·å½»åº•è§£å†³é—®é¢˜ã€‚ æŸäº›å†…éƒ¨CASç»„ä»¶å¾ˆéš¾å¢åŠ å’Œä¿®æ”¹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•çš„ç›®çš„æ˜¯è®©æ‚¨è¿œç¦»å±é™©å’Œä¸å¿…è¦çš„å¤æ‚å˜åŒ–ã€‚å¦‚æœæ‚¨é‡åˆ°ä¸€ä¸ªéœ€è¦å’Œæœ‰ä¸€ä¸ªç‰¹æ€§æˆ–ç”¨ä¾‹çš„é…ç½®å’Œå®ç°éœ€è¦ä¿®æ”¹çš„æ ¸å¿ƒå†…éƒ¨è½¯ä»¶,ä¸ä¸­ç§‘é™¢ç¤¾åŒºè®¨è®º,å¹¶å°è¯•å¢å¼ºç›´æ¥æ„å»ºåˆ°CASè½¯ä»¶,è€Œä¸æ˜¯æŠŠå®ƒä½œä¸ºä¸€ä¸ªé›ªèŠ±ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œåªæœ‰å½“éƒ¨ç½²é…ç½®çœŸæ­£å’Œå®Œå…¨ç‰¹å®šäºæ‚¨çš„éœ€æ±‚æ—¶ï¼Œæ‰å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚å¦åˆ™ï¼Œè¯•ç€å»å½’çº³å’Œå›é¦ˆä»¥é™ä½ç»´æŠ¤æˆæœ¬ã€‚åå¤åœ°ï¼Œä¸éµå®ˆè¿™ä¸€ç­–ç•¥å°†å¯èƒ½å¯¼è‡´é•¿æœŸçš„ç¾éš¾æ€§åæœã€‚ æ•…éšœæ’é™¤æ•…éšœæ’é™¤æŒ‡å—å¯èƒ½å¯¹æ‚¨å¯èƒ½é‡åˆ°çš„é—®é¢˜æœ‰ä¸€äº›ç­”æ¡ˆï¼Œå®ƒé€šå¸¸è¯•å›¾æè¿°ä¸€ç§å¯¹æ•…éšœæ’é™¤å’Œè¯Šæ–­æœ‰ç”¨çš„ç­–ç•¥ã€‚ä½ ä¹Ÿå¯ä»¥å‘CASç¤¾åŒºå¯»æ±‚å¸®åŠ©ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"Spring/CASä¼ä¸šå•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/categories/Spring/CASä¼ä¸šå•ç‚¹ç™»å½•/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"å•ç‚¹ç™»å½•","slug":"å•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/tags/å•ç‚¹ç™»å½•/"}]},{"title":"CASä¼ä¸šå•ç‚¹ç™»å½•-æ¶æ„","slug":"cas-architecture","date":"2018-07-12T14:00:17.000Z","updated":"2020-07-25T02:57:18.195Z","comments":true,"path":"2018/07/12/cas-architecture/","link":"","permalink":"https://jigangduan.github.io/2018/07/12/cas-architecture/","excerpt":"","text":"ç³»ç»Ÿç»„ä»¶CASæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åŒ…å«CASç³»ç»Ÿä½“ç³»ç»“æ„çš„ä¸¤ä¸ªç‰©ç†ç»„ä»¶ï¼Œé€šè¿‡å„ç§åè®®è¿›è¡Œé€šä¿¡ã€‚ CASæœåŠ¡å™¨CASæœåŠ¡å™¨æ˜¯æ„å»ºåœ¨Springæ¡†æ¶ä¸Šçš„Java servletï¼Œå…¶ä¸»è¦èŒè´£æ˜¯é€šè¿‡å‘å‡ºå’ŒéªŒè¯ç¥¨æ®ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å¹¶æˆäºˆå¯¹å¯ç”¨äº†casasçš„æœåŠ¡(é€šå¸¸ç§°ä¸ºCASå®¢æˆ·æœº)çš„è®¿é—®æƒã€‚å½“æœåŠ¡å™¨åœ¨æˆåŠŸç™»å½•æ—¶å‘ç”¨æˆ·å‘å‡ºé€šçŸ¥ç¥¨(TGT)æ—¶ï¼Œå°†åˆ›å»ºSSOä¼šè¯ã€‚æœåŠ¡ç¥¨è¯(ST)æ˜¯é€šè¿‡æµè§ˆå™¨é‡å®šå‘ä½¿ç”¨TGTä½œä¸ºä»¤ç‰Œæ¥å‘é€ç»™æœåŠ¡çš„ã€‚STéšåé€šè¿‡åé€šé“é€šä¿¡åœ¨CASæœåŠ¡å™¨ä¸Šè¿›è¡ŒéªŒè¯ã€‚åœ¨CASåè®®æ–‡æ¡£ä¸­è¯¦ç»†æè¿°äº†è¿™äº›äº¤äº’ã€‚ CASå®¢æˆ·ç«¯æœ¯è¯­â€œCASå®¢æˆ·ç«¯â€åœ¨å…¶å¸¸ç”¨ä¸­æœ‰ä¸¤ä¸ªä¸åŒçš„å«ä¹‰ã€‚CASå®¢æˆ·ç«¯æ˜¯ä»»ä½•æ”¯æŒcasaçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é€šè¿‡å—æ”¯æŒçš„åè®®ä¸æœåŠ¡å™¨é€šä¿¡ã€‚CASå®¢æˆ·æœºä¹Ÿæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œå¯ä»¥ä¸å„ç§è½¯ä»¶å¹³å°å’Œåº”ç”¨ç¨‹åºé›†æˆï¼Œä»¥ä¾¿é€šè¿‡ä¸€äº›èº«ä»½éªŒè¯åè®®(ä¾‹å¦‚CASã€SAMLã€OAuth)ä¸CASæœåŠ¡å™¨é€šä¿¡ã€‚æ”¯æŒå¤šç§è½¯ä»¶å¹³å°å’Œäº§å“çš„CASå®¢æˆ·ç«¯å·²ç»å¼€å‘å‡ºæ¥ã€‚ å¹³å°: Apache httpdæœåŠ¡å™¨(mod_auth_casæ¨¡å—) Java(Java CASå®¢æˆ·ç«¯) .NET(.NETCASå®¢æˆ·ç«¯) PHP(phpCAS) Perl(PerlCAS) Python(pycas) Ruby(rubycas-client) Applications: Canvas Atlassian Confluence Atlassian JIRA Drupal Liferay uPortal â€¦ å½“â€œCASå®¢æˆ·ç«¯â€ä¸€è¯åœ¨æœ¬æ‰‹å†Œä¸­å‡ºç°æ—¶ï¼Œå®ƒæŒ‡çš„æ˜¯é›†æˆç»„ä»¶ï¼Œå¦‚Java CASå®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ä¾èµ–äº(CASæœåŠ¡å™¨çš„å®¢æˆ·ç«¯)çš„åº”ç”¨ç¨‹åºã€‚ æ”¯æŒçš„åè®®å®¢æˆ·ç«¯é€šè¿‡ä»»ä½•æ”¯æŒçš„åè®®ä¸æœåŠ¡å™¨é€šä¿¡ã€‚æ‰€æœ‰å—æ”¯æŒçš„åè®®åœ¨æ¦‚å¿µä¸Šéƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯æœ‰äº›åè®®çš„ç‰¹æ€§æˆ–ç‰¹å¾ä½¿å®ƒä»¬é€‚åˆäºç‰¹å®šçš„åº”ç”¨ç¨‹åºæˆ–ç”¨ä¾‹ã€‚ä¾‹å¦‚ï¼ŒCASåè®®æ”¯æŒå§”æ‰˜(ä»£ç†)èº«ä»½éªŒè¯ï¼ŒSAMLåè®®æ”¯æŒå±æ€§é‡Šæ”¾å’Œå•ç‚¹é€€å‡ºã€‚ æ”¯æŒçš„åè®®: CAS (versions 1, 2, and 3) SAML 1.1 and 2 OpenID Connect OpenID OAuth 2.0 WS Federation è½¯ä»¶ç»„ä»¶å°†CASæœåŠ¡å™¨æè¿°ä¸ºä¸‰å±‚å­ç³»ç»Ÿæ˜¯æœ‰å¸®åŠ©çš„: ç½‘ç»œ(Spring MVC / Spring Webflow)ç¥¨åŠ¡èº«ä»½éªŒè¯ å‡ ä¹æ‰€æœ‰çš„éƒ¨ç½²è€ƒè™‘äº‹é¡¹å’Œç»„ä»¶é…ç½®éƒ½æ¶‰åŠè¿™ä¸‰ä¸ªå­ç³»ç»Ÿã€‚Webå±‚æ˜¯ä¸åŒ…æ‹¬CASå®¢æˆ·ç«¯åœ¨å†…çš„æ‰€æœ‰å¤–éƒ¨ç³»ç»Ÿé€šä¿¡çš„ç«¯ç‚¹ã€‚Webå±‚å§”æ‰˜ç¥¨åŠ¡å­ç³»ç»Ÿä¸ºCASå®¢æˆ·ç«¯è®¿é—®ç”Ÿæˆç¥¨è¯ã€‚SSOä¼šè¯å¼€å§‹äºåœ¨æˆåŠŸçš„èº«ä»½éªŒè¯æ—¶å‘å‡ºä¸€å¼ ç¥¨æ®ï¼Œå› æ­¤ç¥¨åŠ¡å­ç³»ç»Ÿç»å¸¸å§”æ‰˜ç»™èº«ä»½éªŒè¯å­ç³»ç»Ÿã€‚ èº«ä»½éªŒè¯ç³»ç»Ÿé€šå¸¸åªåœ¨SSOä¼šè¯å¼€å§‹æ—¶å¤„ç†è¯·æ±‚ï¼Œä½†ä¹Ÿæœ‰å…¶ä»–å¯ä»¥è°ƒç”¨å®ƒçš„æƒ…å†µ(ä¾‹å¦‚å¼ºåˆ¶èº«ä»½éªŒè¯)ã€‚ Spring FrameworkCASä½¿ç”¨Springæ¡†æ¶çš„è®¸å¤šæ–¹é¢;æœ€å€¼å¾—æ³¨æ„çš„æ˜¯Spring MVCå’ŒSpring Webflowã€‚Springä¸ºæ ¸å¿ƒCASä»£ç åº“ä»¥åŠéƒ¨ç½²äººå‘˜æä¾›äº†å®Œæ•´çš„å¯æ‰©å±•æ¡†æ¶;é€šè¿‡è¿æ¥CASå’ŒSpring APIæ‰©å±•ç‚¹æ¥å®šåˆ¶æˆ–æ‰©å±•CASè¡Œä¸ºéå¸¸ç®€å•ã€‚Springçš„ä¸€èˆ¬çŸ¥è¯†æœ‰åŠ©äºç†è§£æŸäº›æ¡†æ¶ç»„ä»¶ä¹‹é—´çš„ç›¸äº’ä½œç”¨ï¼Œä½†å¹¶ä¸æ˜¯ä¸¥æ ¼è¦æ±‚çš„ã€‚ Spring BootCASä¹Ÿå¾ˆå¤§ç¨‹åº¦ä¸ŠåŸºäºSpring Bootï¼Œå®ƒå…è®¸ä½¿ç”¨Springå¹³å°å’Œç¬¬ä¸‰æ–¹åº“çš„å›ºæ‰§è§‚ç‚¹æ¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„webåº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€è¿›è¡Œå°½å¯èƒ½å¤šçš„XMLé…ç½®ã€‚Spring Bootå…è®¸CASéšè—å…¶ç»„ä»¶åŠå…¶é…ç½®çš„å†…éƒ¨å¤æ‚æ€§ï¼Œè€Œæ˜¯æä¾›è‡ªåŠ¨é…ç½®æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯ä»¥ç®€å•è€Œè‡ªåŠ¨åœ°é…ç½®æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä¸éœ€è¦å¤ªå¤šäººå·¥å¹²é¢„ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"Spring/CASä¼ä¸šå•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/categories/Spring/CASä¼ä¸šå•ç‚¹ç™»å½•/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"å•ç‚¹ç™»å½•","slug":"å•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/tags/å•ç‚¹ç™»å½•/"}]},{"title":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"cas","date":"2018-07-12T12:37:09.000Z","updated":"2020-07-25T02:57:18.196Z","comments":true,"path":"2018/07/12/cas/","link":"","permalink":"https://jigangduan.github.io/2018/07/12/cas/","excerpt":"","text":"ä»‹ç» Spring Webflow/Spring Boot JavaæœåŠ¡å™¨ç»„ä»¶ã€‚ å¯æ’è®¤è¯æ”¯æŒ(LDAPã€æ•°æ®åº“ã€X.509ã€SPNEGOã€JAASã€JWTã€RADIUSã€MongoDbç­‰) æ”¯æŒå¤šç§åè®®(CASã€SAMLã€WS-Federationã€OAuth2ã€OpenIDã€OpenIDè¿æ¥ã€REST) é€šè¿‡å„ç§æä¾›è€…æ”¯æŒå¤šå› ç´ èº«ä»½éªŒè¯(Duo Securityã€FIDO U2Fã€YubiKeyã€è°·æ­Œèº«ä»½éªŒè¯å™¨ã€Microsoft Azureã€Authyç­‰) æ”¯æŒå°†èº«ä»½éªŒè¯å§”æ‰˜ç»™å¤–éƒ¨æä¾›è€…ï¼Œå¦‚ADFSã€Facebookã€Twitterã€SAML2 IdPsç­‰ã€‚ å†…ç½®å¯¹å¯†ç ç®¡ç†ã€é€šçŸ¥ã€ä½¿ç”¨æ¡æ¬¾å’Œæ¨¡æ‹Ÿçš„æ”¯æŒã€‚ æ”¯æŒå±æ€§å‘å¸ƒï¼ŒåŒ…æ‹¬ç”¨æˆ·åŒæ„ã€‚ å®æ—¶ç›‘æ§å’Œè·Ÿè¸ªåº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€ç»Ÿè®¡æ•°æ®å’Œæ—¥å¿—ã€‚ ä½¿ç”¨ç‰¹å®šçš„èº«ä»½éªŒè¯ç­–ç•¥ç®¡ç†å’Œæ³¨å†Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚ è·¨å¹³å°å®¢æˆ·ç«¯æ”¯æŒ(Javaã€. netã€PHPã€Perlã€Apacheç­‰)ã€‚ ä¸InCommonã€Boxã€Office365ã€ServiceNowã€Salesforceã€Workdayã€WebAdvisorã€Drupalã€Blackboardã€Moodleã€è°·æ­Œåº”ç”¨ç­‰é›†æˆã€‚ è´¡çŒ®è¦äº†è§£å¦‚ä½•ä¸ºé¡¹ç›®åšå‡ºè´¡çŒ®ï¼Œè¯·å‚é˜…æœ¬æŒ‡å—ã€‚ å…¥é—¨æŒ‡å—æˆ‘ä»¬å»ºè®®é˜…è¯»ä»¥ä¸‹æ–‡æ¡£ï¼Œä»¥ä¾¿è®¡åˆ’å’Œæ‰§è¡ŒCASéƒ¨ç½²ã€‚ ä½“ç³»ç»“æ„ å…¥é—¨æŒ‡å— å®‰è£…è¦æ±‚ å®‰è£… Demos ä½¿ç”¨è­¦å‘Š!è¯·æ³¨æ„ï¼Œè¿™äº›æ˜¯å…¬å…±æ¼”ç¤ºç«™ç‚¹ï¼Œç”¨äºåŸºæœ¬å±•ç¤ºå’Œé›†æˆæµ‹è¯•é¡¹ç›®ã€‚å®ƒä»¬ä¸æ˜¯ä¸ºå†…éƒ¨æ¼”ç¤ºè€Œè®¾ç½®çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨é¡¹ç›®éœ€è¦æ—¶ä¸Šä¸‹æ³¢åŠ¨ï¼Œè€Œæ— éœ€é€šçŸ¥ã€‚ Apereo CASé¡¹ç›®æä¾›äº†ä»¥ä¸‹æ¼”ç¤º: è¯é¢˜ æºåˆ†æ”¯ ä½ç½® CASè¦†ç›–é¡¹ç›®initializr heroku-casinitializr é“¾æ¥ CAS Webåº”ç”¨æœåŠ¡å™¨ heroku-caswebapp é“¾æ¥ CASæœåŠ¡ç®¡ç†æœåŠ¡å™¨ heroku-mgmtwebapp é“¾æ¥ CAS Boot Administration Server heroku-bootadminserver é“¾æ¥ CAS Zipkin æœåŠ¡å™¨ heroku-zipkinserver é“¾æ¥ CASæœåŠ¡å‘ç°æœåŠ¡å™¨ heroku-discoveryserver é“¾æ¥ CASé…ç½®æœåŠ¡å™¨ heroku-casconfigserver é“¾æ¥ åœ¨éœ€è¦æ—¶ï¼Œç”¨äºä¸Šè¿°æ¼”ç¤ºçš„å‡­è¯æ˜¯:casuser / Mellon é©±åŠ¨CASå¼€å‘ç”±ä»¥ä¸‹å·¥å…·ã€é¡¹ç›®å’ŒæœåŠ¡é©±åŠ¨:","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"Spring/CASä¼ä¸šå•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/categories/Spring/CASä¼ä¸šå•ç‚¹ç™»å½•/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"å•ç‚¹ç™»å½•","slug":"å•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/tags/å•ç‚¹ç™»å½•/"}]},{"title":"Hexi","slug":"Hexi","date":"2018-07-04T12:11:28.000Z","updated":"2020-07-25T02:57:18.156Z","comments":true,"path":"2018/07/04/Hexi/","link":"","permalink":"https://jigangduan.github.io/2018/07/04/Hexi/","excerpt":"Hexiæ˜¯ä¸€ç§æœ‰è¶£è€Œç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨çº¯JavaScriptä»£ç åˆ¶ä½œHTML5æ¸¸æˆæˆ–ä»»ä½•å…¶ä»–ç±»å‹çš„äº¤äº’åª’ä½“ã€‚çœ‹çœ‹å¼€å§‹çš„ç‰¹æ€§åˆ—è¡¨å’Œç¤ºä¾‹æ–‡ä»¶å¤¹ã€‚ç»§ç»­æ»šåŠ¨ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªå®Œæ•´çš„å¿«é€Ÿå…¥é—¨æŒ‡å—å’Œåˆå­¦è€…æŒ‡å—ã€‚å¦‚æœä½ ä»¥å‰ä»æ¥æ²¡æœ‰åšè¿‡æ¸¸æˆï¼Œæ•™ç¨‹æ˜¯æœ€å¥½çš„å¼€å§‹ã€‚ Hexiæœ‰ä»€ä¹ˆ?æ‚¨å¯ä»¥ä½¿ç”¨streamlined APIè·å¾—WebGLå‘ˆç°çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¯¥APIå…è®¸æ‚¨ä»¥æç®€çš„ã€å£°æ˜æ€§çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚å®ƒä½¿å¾—ç¼–å†™ä¸€æ¬¾æ¸¸æˆåƒå†™è¯—æˆ–ç”»ä¸€æ ·ç®€å•æœ‰è¶£ã€‚è¯•ä¸€è¯•!å¦‚æœæ‚¨éœ€è¦ä»»ä½•å¸®åŠ©æˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨æ­¤å­˜å‚¨åº“çš„é—®é¢˜ä¸­å‘å¸ƒä¸€äº›å†…å®¹ã€‚é—®é¢˜é¡µé¢æ˜¯Hexiå‹å¥½çš„èŠå¤©å®¤â€”â€”ä¸è¦å®³æ€•å¯»æ±‚å¸®åŠ©:) ä½¿ç”¨Hexi: hexi.min.jsåªéœ€è¦ä»è¿™ä¸ªå­˜å‚¨åº“ä¸­è·å–ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ˜¯æ‰€æœ‰!ç”¨&lt;script&gt;æ ‡ç­¾é“¾æ¥åˆ°æ‚¨çš„HTMLæ–‡æ¡£ï¼Œç„¶åå¼€å§‹!Hexiæ˜¯åœ¨æœ€æ–°ç‰ˆæœ¬çš„JavaScript (ES6/7, 2005 /6)ä¸­ä»å¤´å¼€å§‹ç¼–å†™çš„ï¼Œä½†æ˜¯å®ƒè¢«ç¼–è¯‘æˆES5(ä½¿ç”¨Babel)ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚åœ¨å¼€å§‹ä½¿ç”¨æ²³è¥¿ä¹‹å‰ï¼Œä½ éœ€è¦çŸ¥é“ä»€ä¹ˆ?æ‚¨åº”è¯¥å¯¹HTMLå’ŒJavaScriptæœ‰åˆç†çš„ç†è§£ã€‚ä½ ä¸å¿…æ˜¯ä¸€ä¸ªä¸“å®¶ï¼Œåªæ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒçš„åˆå­¦è€…å’Œä¸€ä¸ªæ¸´æœ›å­¦ä¹ çš„äººã€‚å¦‚æœä½ ä¸çŸ¥é“HTMLå’ŒJavaScriptï¼Œæœ€å¥½çš„å¼€å§‹å­¦ä¹ å®ƒçš„åœ°æ–¹æ˜¯è¿™æœ¬ä¹¦: åŸºäºHTML5å’ŒJavaScriptçš„åŸºç¡€æ¸¸æˆè®¾è®¡ Pixiæ•™ç¨‹ å¥½å§,æ˜ç™½äº†å—?æ‚¨çŸ¥é“JavaScriptå˜é‡ã€å‡½æ•°ã€æ•°ç»„å’Œå¯¹è±¡æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬å—?æ‚¨çŸ¥é“JSONæ•°æ®æ–‡ä»¶æ˜¯ä»€ä¹ˆå—?ä½ ä½¿ç”¨è¿‡Canvasç»˜å›¾APIå—?ç„¶åä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨Hexiäº†! å½“ç„¶ï¼Œæ²³è¥¿æ˜¯å®Œå…¨å…è´¹ä½¿ç”¨:ä¸ºä»»ä½•äº‹ï¼Œæ°¸è¿œ!å®ƒçš„ä½œè€…æ˜¯åŠ æ‹¿å¤§(å¤šä¼¦å¤šï¼Œå“ˆå¯†é¡¿)ï¼Œå°åº¦(Kullu Valley, Ladakh)ï¼Œå°¼æ³Šå°”(åŠ å¾·æ»¡éƒ½ï¼ŒPokhara, Annapurnaå¤§æœ¬è¥)ï¼Œæ³°å›½(Ko Phangan, Ko Tao)å’Œå—é(å¼€æ™®æ•¦)ï¼Œè¿™æ˜¯15å¹´æ¥å¯¹æ¸¸æˆè®¾è®¡çš„APIå¯ç”¨æ€§ç ”ç©¶çš„ç»“æœã€‚â€Hexiâ€ è¿™ä¸ªåå­—æ¥æºäºâ€Hexâ€ + â€œPixiâ€ã€‚å®ƒç»å¯¹æ²¡æœ‰å…¶ä»–æ„ä¹‰ã€‚","text":"Hexiæ˜¯ä¸€ç§æœ‰è¶£è€Œç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨çº¯JavaScriptä»£ç åˆ¶ä½œHTML5æ¸¸æˆæˆ–ä»»ä½•å…¶ä»–ç±»å‹çš„äº¤äº’åª’ä½“ã€‚çœ‹çœ‹å¼€å§‹çš„ç‰¹æ€§åˆ—è¡¨å’Œç¤ºä¾‹æ–‡ä»¶å¤¹ã€‚ç»§ç»­æ»šåŠ¨ï¼Œä½ ä¼šæ‰¾åˆ°ä¸€ä¸ªå®Œæ•´çš„å¿«é€Ÿå…¥é—¨æŒ‡å—å’Œåˆå­¦è€…æŒ‡å—ã€‚å¦‚æœä½ ä»¥å‰ä»æ¥æ²¡æœ‰åšè¿‡æ¸¸æˆï¼Œæ•™ç¨‹æ˜¯æœ€å¥½çš„å¼€å§‹ã€‚ Hexiæœ‰ä»€ä¹ˆ?æ‚¨å¯ä»¥ä½¿ç”¨streamlined APIè·å¾—WebGLå‘ˆç°çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¯¥APIå…è®¸æ‚¨ä»¥æç®€çš„ã€å£°æ˜æ€§çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚å®ƒä½¿å¾—ç¼–å†™ä¸€æ¬¾æ¸¸æˆåƒå†™è¯—æˆ–ç”»ä¸€æ ·ç®€å•æœ‰è¶£ã€‚è¯•ä¸€è¯•!å¦‚æœæ‚¨éœ€è¦ä»»ä½•å¸®åŠ©æˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨æ­¤å­˜å‚¨åº“çš„é—®é¢˜ä¸­å‘å¸ƒä¸€äº›å†…å®¹ã€‚é—®é¢˜é¡µé¢æ˜¯Hexiå‹å¥½çš„èŠå¤©å®¤â€”â€”ä¸è¦å®³æ€•å¯»æ±‚å¸®åŠ©:) ä½¿ç”¨Hexi: hexi.min.jsåªéœ€è¦ä»è¿™ä¸ªå­˜å‚¨åº“ä¸­è·å–ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ˜¯æ‰€æœ‰!ç”¨&lt;script&gt;æ ‡ç­¾é“¾æ¥åˆ°æ‚¨çš„HTMLæ–‡æ¡£ï¼Œç„¶åå¼€å§‹!Hexiæ˜¯åœ¨æœ€æ–°ç‰ˆæœ¬çš„JavaScript (ES6/7, 2005 /6)ä¸­ä»å¤´å¼€å§‹ç¼–å†™çš„ï¼Œä½†æ˜¯å®ƒè¢«ç¼–è¯‘æˆES5(ä½¿ç”¨Babel)ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚åœ¨å¼€å§‹ä½¿ç”¨æ²³è¥¿ä¹‹å‰ï¼Œä½ éœ€è¦çŸ¥é“ä»€ä¹ˆ?æ‚¨åº”è¯¥å¯¹HTMLå’ŒJavaScriptæœ‰åˆç†çš„ç†è§£ã€‚ä½ ä¸å¿…æ˜¯ä¸€ä¸ªä¸“å®¶ï¼Œåªæ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒçš„åˆå­¦è€…å’Œä¸€ä¸ªæ¸´æœ›å­¦ä¹ çš„äººã€‚å¦‚æœä½ ä¸çŸ¥é“HTMLå’ŒJavaScriptï¼Œæœ€å¥½çš„å¼€å§‹å­¦ä¹ å®ƒçš„åœ°æ–¹æ˜¯è¿™æœ¬ä¹¦: åŸºäºHTML5å’ŒJavaScriptçš„åŸºç¡€æ¸¸æˆè®¾è®¡ Pixiæ•™ç¨‹ å¥½å§,æ˜ç™½äº†å—?æ‚¨çŸ¥é“JavaScriptå˜é‡ã€å‡½æ•°ã€æ•°ç»„å’Œå¯¹è±¡æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬å—?æ‚¨çŸ¥é“JSONæ•°æ®æ–‡ä»¶æ˜¯ä»€ä¹ˆå—?ä½ ä½¿ç”¨è¿‡Canvasç»˜å›¾APIå—?ç„¶åä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨Hexiäº†! å½“ç„¶ï¼Œæ²³è¥¿æ˜¯å®Œå…¨å…è´¹ä½¿ç”¨:ä¸ºä»»ä½•äº‹ï¼Œæ°¸è¿œ!å®ƒçš„ä½œè€…æ˜¯åŠ æ‹¿å¤§(å¤šä¼¦å¤šï¼Œå“ˆå¯†é¡¿)ï¼Œå°åº¦(Kullu Valley, Ladakh)ï¼Œå°¼æ³Šå°”(åŠ å¾·æ»¡éƒ½ï¼ŒPokhara, Annapurnaå¤§æœ¬è¥)ï¼Œæ³°å›½(Ko Phangan, Ko Tao)å’Œå—é(å¼€æ™®æ•¦)ï¼Œè¿™æ˜¯15å¹´æ¥å¯¹æ¸¸æˆè®¾è®¡çš„APIå¯ç”¨æ€§ç ”ç©¶çš„ç»“æœã€‚â€Hexiâ€ è¿™ä¸ªåå­—æ¥æºäºâ€Hexâ€ + â€œPixiâ€ã€‚å®ƒç»å¯¹æ²¡æœ‰å…¶ä»–æ„ä¹‰ã€‚ ç‰¹æ€§ä»¥ä¸‹æ˜¯Hexiçš„æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨: ä½ éœ€è¦çš„æ‰€æœ‰æœ€é‡è¦çš„ç²¾çµ:çŸ©å½¢ã€åœ†åœˆã€çº¿æ¡ã€æ–‡æœ¬ã€å›¾åƒç²¾çµå’ŒåŠ¨ç”»â€œMovieClipâ€æ ·å¼ç²¾çµã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸€è¡Œä»£ç æ¥åˆ›å»ºè¿™äº›ç²¾çµä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚æ‚¨è¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„å®šåˆ¶ç²¾çµç±»å‹ã€‚ å®Œæ•´çš„åœºæ™¯å›¾ï¼ŒåŒ…å«åµŒå¥—çš„å­-çˆ¶å±‚æ¬¡ç»“æ„(åŒ…æ‹¬stageå’ŒaddChild/removeChildæ–¹æ³•)ã€æœ¬åœ°å’Œå…¨å±€åæ ‡ã€æ·±åº¦å±‚å’Œæ—‹è½¬æ”¯ç‚¹ã€‚ å°†ç²¾çµåˆ†ç»„åœ¨ä¸€èµ·åˆ¶ä½œæ¸¸æˆåœºæ™¯ã€‚ å…·æœ‰ç”¨æˆ·å¯å®šä¹‰çš„fpså’Œå®Œå…¨å¯å®šåˆ¶å’Œå®Œå…¨å¯åˆ é™¤çš„ç®€å•æ¸¸æˆçŠ¶æ€ç®¡ç†å™¨çš„æ¸¸æˆå¾ªç¯ã€‚æš‚åœå¹¶æ¢å¤åœ¨ä»»ä½•æ—¶å€™æ¸¸æˆå¾ªç¯ã€‚ Tileset (spritesheet)æ”¯æŒä½¿ç”¨frameå’Œfilmstripæ–¹æ³•æ¥ä½¿ç”¨Tilesetæ¡†æ¶åˆ¶ä½œç²¾çµã€‚ å†…ç½®çº¹ç†å›¾é›†æ”¯æŒæµè¡Œçš„çº¹ç†åŒ…è£…æ ¼å¼ã€‚ ç²¾çµçš„å…³é”®å¸§åŠ¨ç”»å’ŒçŠ¶æ€ç®¡ç†å™¨ã€‚ä½¿ç”¨showæ˜¾ç¤ºç²¾çµçš„å›¾åƒçŠ¶æ€ã€‚ä½¿ç”¨playAnimationæ¥æ’­æ”¾ä¸€ç³»åˆ—çš„å¸§(å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥åœ¨å¾ªç¯ä¸­)ã€‚ä½¿ç”¨showæ˜¾ç¤ºç‰¹å®šçš„å¸§å·ã€‚ä½¿ç”¨fpsè®¾ç½®ç²¾çµåŠ¨ç”»çš„å¸§é€Ÿç‡ä¸æ¸¸æˆçš„å¸§é€Ÿç‡æ— å…³ã€‚ äº¤äº’æŒ‰é’®ç²¾çµæœ‰up,overå’Œdownçš„çŠ¶æ€ å¯ä»¥å°†ä»»ä½•ç²¾çµè®¾ç½®ä¸ºäº¤äº’ä»¥æ¥æ”¶é¼ æ ‡å’Œè§¦æ‘¸æ“ä½œã€‚ä¸ºæŒ‰é’®å’Œäº¤äº’ç²¾çµæä¾›ç›´è§‚çš„press, release, over, outå’Œtapæ–¹æ³• æ˜“äºä½¿ç”¨çš„é”®ç›˜é”®ç»‘å®šã€‚ä½¿ç”¨keyboardæ–¹æ³•è½»æ¾å®šä¹‰æ‚¨è‡ªå·±çš„ ä¸€ä¸ªå†…ç½®çš„é€šç”¨æŒ‡é’ˆï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨é¼ æ ‡å’Œè§¦æ‘¸ã€‚åˆ†é…æ‚¨è‡ªå·±çš„è‡ªå®šä¹‰press, releaseå’Œtapæ–¹æ³•æˆ–ä½¿ç”¨ä»»ä½•æŒ‡é’ˆçš„å†…ç½®å±æ€§:isUpã€isDownã€tapã€xå’Œyã€‚(å®ƒä¹Ÿé€‚ç”¨äºç­‰è·åœ°å›¾!) ä½¿ç”¨putTop, putRight, putBottom, putLeftå’ŒputCenterï¼Œæ–¹ä¾¿åœ°æ”¾ç½®ä¸å…¶ä»–ç²¾çµç›¸å¯¹çš„ä½ç½®ã€‚ä½¿ç”¨flowRightã€flowLeftã€flowUpæˆ–flowå°†ç²¾çµæ°´å¹³æˆ–å‚ç›´å¯¹é½ã€‚ ç”¨äºé¢„åŠ è½½å›¾åƒã€å­—ä½“ã€å£°éŸ³å’ŒJSONæ•°æ®æ–‡ä»¶çš„é€šç”¨èµ„äº§åŠ è½½ç¨‹åºã€‚æ”¯æŒæ‰€æœ‰æµè¡Œçš„æ–‡ä»¶æ ¼å¼ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å°†æ–°èµ„äº§åŠ è½½åˆ°æ¸¸æˆä¸­ã€‚ å¯é€‰çš„åŠ è½½çŠ¶æ€ï¼Œå…è®¸æ‚¨åœ¨åŠ è½½èµ„äº§æ—¶è¿è¡Œæ“ä½œã€‚å¯ä»¥ä½¿ç”¨loadçŠ¶æ€æ·»åŠ åŠ è½½è¿›åº¦æ¡ã€‚ åŸºäºpixiçš„å¿«é€Ÿèšç„¦æ¸²æŸ“å¼•æ“ã€‚å¦‚æœPixièƒ½åšåˆ°ï¼Œé‚£ä¹ˆHexiä¹Ÿèƒ½åšåˆ°! Hexiåªæ˜¯ä½äºPixiä¹‹ä¸Šçš„ä¸€å±‚è–„è–„çš„ä»£ç ã€‚æ‚¨å¯ä»¥éšæ—¶è®¿é—®å…¨å±€PIXIå¯¹è±¡ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥ç›´æ¥ç¼–å†™çº¯PIXIä»£ç ã€‚HexiåŒ…æ‹¬æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„Pixi v3.0è‡ªåŠ¨ç»‘å®šã€‚ ä¸€ä¸ªå¤æ‚çš„æ¸¸æˆå¾ªç¯ï¼Œä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„æ—¶é—´æ­¥é•¿ï¼Œå…·æœ‰å¯å˜æ¸²æŸ“å’Œç²¾çµæ’å€¼ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä»»ä½•å¸§ä¸­è·å¾—å…‰æ»‘çš„ç²¾çµåŠ¨ç”»ã€‚ ä¸€ä¸ªç´§å‡‘è€Œå¼ºå¤§çš„â€œä¿³å¥â€é£æ ¼çš„APIï¼Œå…¶æ ¸å¿ƒæ˜¯æµ…æ˜¾çš„ã€å¯ç»„åˆçš„ç»„ä»¶ã€‚å¤šåšç‚¹äº‹æƒ…ï¼Œå°‘å†™ç‚¹ä»£ç ã€‚ ä½¿ç”¨å†…ç½®çš„WebAudio APIå£°éŸ³ç®¡ç†å™¨å¯¼å…¥å’Œæ’­æ”¾å£°éŸ³ã€‚ç”¨playã€pauseã€stopã€restartã€playFromã€fadeInå’ŒfadeOutæ–¹æ³•æ§åˆ¶å£°éŸ³ã€‚æ”¹å˜å£°éŸ³çš„volumeå’Œpanã€‚ ä½¿ç”¨é€šç”¨çš„soundEffectæ–¹æ³•ä»çº¯ä»£ç ç”Ÿæˆæ‚¨è‡ªå·±çš„è‡ªå®šä¹‰å£°éŸ³æ•ˆæœã€‚ ä½¿ç”¨shakeæ‘‡åŠ¨ç²¾çµæˆ–åœºæ™¯ã€‚ ç²¾çµå’Œåœºæ™¯è½¬æ¢çš„è¡¥é—´åŠŸèƒ½: slideã€fadeInã€fadeOutã€pulseã€breatheã€wobbleã€strobeå’Œä¸€äº›æœ‰ç”¨çš„ä½çº§è¡¥é—´æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åˆ›å»ºè‡ªå®šä¹‰è¡¥é—´ã€‚ æŒ‰ç…§walkPathå’ŒwalkCurveçš„è¿æ¥è·¯å¾„ç‚¹åºåˆ—åˆ›å»ºä¸€ä¸ªç²¾çµã€‚ ä¸€äº›æœ‰ç”¨çš„æ–¹ä¾¿å‡½æ•°:followEase, followConstant, angle, distance, rotateAroundSprite, rotateAroundPoint, wait, randomInt, randomFloat, containså’ŒoutsideBoundsã€‚ ä¸€ç§å¿«é€Ÿã€é€šç”¨çš„hitæ–¹æ³•æ¥å¤„ç†æ‰€æœ‰ç±»å‹çš„ç²¾çµçš„ç¢°æ’æµ‹è¯•å’Œååº”(æ‹¦æˆªå’Œåå¼¹)ã€‚å¯¹æ‰€æœ‰çš„ä¸œè¥¿éƒ½ä½¿ç”¨ä¸€ç§ç¢°æ’æ–¹æ³•:çŸ©å½¢ã€åœ†å½¢ã€ç‚¹å’Œç²¾çµçš„æ•°ç»„ã€‚ç®€å•! ä¸€å¥—è½»é‡çº§çš„ã€ä½çº§çš„2Då‡ ä½•ç¢°æ’æ–¹æ³•ã€‚ æ¸¸æˆèµ„äº§çš„åŠ è½½è¿›åº¦æ¡ã€‚ è®©ç²¾çµç”¨shootæ‹æ‘„ä¸œè¥¿ å¾ˆå®¹æ˜“ç”¨gridç»˜åˆ¶ç½‘æ ¼ä¸­çš„ç²¾çµ ä½¿ç”¨tilingSpriteè½»æ¾åˆ›å»ºæ— ç¼æ»šåŠ¨èƒŒæ™¯ createParticleså‡½æ•°ï¼Œç”¨äºä¸ºæ¸¸æˆåˆ›å»ºå„ç§ç²’å­æ•ˆæœã€‚ä½¿ç”¨particleEmitterå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ’å®šçš„ç²’å­æµ ä½¿ç”¨scaleToWindowä½¿æ¸¸æˆè‡ªåŠ¨ç¼©æ”¾åˆ°å®ƒçš„æœ€å¤§å°ºå¯¸ï¼Œå¹¶ä½¿å…¶ä¸æµè§ˆå™¨çª—å£å†…çš„æœ€ä½³åŒ¹é… ä½¿ç”¨makeTiledWorldå¯¹ç¼–è¾‘å™¨çš„æ”¯æŒã€‚åœ¨å¹³é“ºç¼–è¾‘å™¨ä¸­è®¾è®¡æ¸¸æˆï¼Œå¹¶ç›´æ¥è®¿é—®æ¸¸æˆä»£ç ä¸­çš„æ‰€æœ‰ç²¾çµã€å±‚å’Œå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£ï¼Œå¿«é€Ÿå’Œå®¹æ˜“çš„æ–¹æ³•æ¥åˆ¶ä½œæ¸¸æˆã€‚ ä¸€ä¸ªé€šç”¨çš„hitTestTileæ–¹æ³•ï¼Œç”¨äºå¤„ç†åŸºäºç“·ç –çš„æ¸¸æˆæ‰€éœ€çš„æ‰€æœ‰ç¢°æ’æ£€æŸ¥ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨å¯ä»¥å°†å®ƒä¸ä»»ä½•äºŒç»´å‡ ä½•ç¢°æ’æ–¹æ³•ç»“åˆä½¿ç”¨ï¼Œä»¥ä¼˜åŒ–å¤§ç›¸ä½/çª„ç›¸ä½ç¢°æ’æ£€æŸ¥ã€‚ ä½¿ç”¨updateMapä¿æŒåŸºäºç“·ç –çš„ä¸–ç•Œåœ°å›¾æ•°æ®æ•°ç»„ä¸ç§»åŠ¨ç²¾çµæœ€æ–° åˆ›å»ºä¸€ä¸ªåœ¨æ»šåŠ¨æ¸¸æˆä¸–ç•Œä¸­è·Ÿéšç²¾çµçš„worldCameraã€‚ ä¸€ä¸ªlineOfSightå‡½æ•°ï¼Œå‘Šè¯‰æ‚¨ä¸€ä¸ªç²¾çµå¯¹å¦ä¸€ä¸ªç²¾çµæ˜¯å¦å¯è§ ä¸HTMLå’ŒCSSå…ƒç´ çš„æ— ç¼é›†æˆï¼Œä»¥åˆ›å»ºä¸°å¯Œçš„ç”¨æˆ·ç•Œé¢ã€‚ä½¿ç”¨Hexiä¹Ÿé€‚ç”¨äºAngular, Reactå’ŒElm! ä¸€å¥—å®Œæ•´çš„å·¥å…·ï¼Œæ˜“äºåˆ›å»ºç­‰è·æ¸¸æˆä¸–ç•Œï¼ŒåŒ…æ‹¬:ç­‰è·é¼ æ ‡/è§¦æ‘¸æŒ‡é’ˆï¼Œä½¿ç”¨hitTestIsoTileçš„ç­‰è·ç“·ç –ç¢°æ’ï¼Œå’Œä½¿ç”¨makeIsoTiledWorldçš„å…¨å¹³é“ºç¼–è¾‘å™¨ç­‰è·åœ°å›¾æ”¯æŒã€‚ shortestPathå‡½æ•°ï¼Œç”¨äºé€šè¿‡ç±»ä¼¼è¿·å®«è¿™æ ·çš„åŸºäºç“·ç –çš„ç¯å¢ƒè¿›è¡ŒA-starå¯»è·¯ï¼ŒtileBasedLineOfSightå‡½æ•°å‘Šè¯‰ä½ è¿·å®«æ¸¸æˆç¯å¢ƒä¸­çš„ç²¾çµæ˜¯å¦å¯ä»¥çœ‹åˆ°å½¼æ­¤ã€‚ æ˜¯çš„ï¼Œç”±äºPixiæ¸²æŸ“å™¨æä¾›çš„å¯è®¿é—®å±æ€§(yay Pixi!)ï¼Œ Hexiåº”ç”¨ç¨‹åºç¬¦åˆW3Cçš„å¯è®¿é—®æ€§æŒ‡å— Hexiçš„æ¨¡å—HexiåŒ…å«äº†ä¸€ä¸ªæœ‰ç”¨çš„æ¨¡å—é›†åˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å—çš„ä»»ä½•å±æ€§æˆ–æ–¹æ³•åœ¨æ‚¨çš„é«˜çº§Hexiä»£ç ä¸­ã€‚ Pixi:ä¸–ç•Œä¸Šæœ€å¿«çš„2D WebGLå’Œcanvasæ¸²æŸ“å™¨ Bump:ä¸€å¥—å®Œæ•´çš„2Dæ¸¸æˆç¢°æ’åŠŸèƒ½ã€‚ Tink:æ‹–æ”¾ã€æŒ‰é’®ã€é€šç”¨æŒ‡é’ˆå’Œå…¶ä»–æœ‰ç”¨çš„äº¤äº’æ€§å·¥å…·ã€‚ Charm: ç®€å•æ˜“ç”¨çš„Pixiç²¾çµåŠ¨ç”»æ•ˆæœ Dust:ç”¨äºåˆ¶é€ çˆ†ç‚¸ã€ç«ç„°å’Œé­”æ³•çš„ç²’å­æ•ˆåº” Sprite Utilities:æ›´ç®€å•ã€æ›´ç›´è§‚çš„æ–¹æ³•æ¥åˆ›å»ºå’Œä½¿ç”¨Pixiç²¾çµï¼Œå¹¶æ·»åŠ çŠ¶æ€æœºå’ŒåŠ¨ç”»æ’­æ”¾å™¨ Game Utilities: ä¸ºæ¸¸æˆæ”¶é›†çš„æœ‰ç”¨æ–¹æ³•. Tile Utilities: ä¸€ç»„æœ‰ç”¨çš„æ–¹æ³•ï¼Œç”¨äºåˆ¶ä½œä»¥Tiled Editorä¸ºåŸºç¡€çš„æ¸¸æˆä¸–ç•Œã€‚åŒ…æ‹¬ä¸€å¥—å®Œæ•´çš„ç­‰è·åœ°å›¾å®ç”¨ç¨‹åºã€‚ Sound.js: ç”¨äºåŠ è½½ã€æ§åˆ¶å’Œç”Ÿæˆå£°éŸ³å’ŒéŸ³ä¹æ•ˆæœçš„å¾®å‹åº“ã€‚ä¸ºæ¸¸æˆæ·»åŠ å£°éŸ³æ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚ Smoothie: è¶…å…‰æ»‘çš„ç²¾çµåŠ¨ç”»ä½¿ç”¨çœŸæ­£çš„ä¸‰è§’æ—¶é—´æ’å€¼ã€‚å®ƒè¿˜å…è®¸æ‚¨æŒ‡å®šæ¸¸æˆæˆ–åº”ç”¨ç¨‹åºè¿è¡Œçš„fps(æ¯ç§’å¸§æ•°)ï¼Œå¹¶å°†ç²¾çµå‘ˆç°å¾ªç¯ä¸åº”ç”¨ç¨‹åºé€»è¾‘å¾ªç¯å®Œå…¨åˆ†å¼€ã€‚ é˜…è¯»æ¯ä¸ªæ¨¡å—çš„ä»£ç åº“ä¸­çš„æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å› ä¸ºå®ƒä»¬éƒ½å†…ç½®åœ¨Hexiä¸­ï¼Œä½ ä¸éœ€è¦è‡ªå·±å®‰è£…å®ƒä»¬â€”â€”å®ƒä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Hexiå…è®¸æ‚¨ä½œä¸ºé¡¶çº§å¯¹è±¡è®¿é—®è¿™äº›æ¨¡å—æ–¹æ³•å’Œå±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³ä»Bump collision moduleè®¿é—®hitæ–¹æ³•ï¼Œæ‚¨å¯ä»¥è¿™æ ·åš: 1g.hit(spriteOne, spriteTwo); ä½†å¦‚æœéœ€è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®Bumpæ¨¡å—ï¼Œæ¯”å¦‚: 1g.bump.hit(spriteOne, spriteTwo); (å‡è®¾ä½ çš„Hexiå®ä¾‹è¢«ç§°ä¸ºg); åªéœ€ä½¿ç”¨lowerCamelCaseå¼•ç”¨æ¨¡å—åã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨smoothieå’ŒSpriteå®ç”¨ç¨‹åºæ¨¡å—ä½œä¸ºspriteUtilitiesæ¥è®¿é—®Smoothieæ¨¡å—ã€‚ æœ¬å…¬çº¦æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚æ‚¨å¯ä»¥ç›´æ¥è®¿é—®Pixiå…¨å±€å¯¹è±¡ä½œä¸ºPixiã€‚æ­¤å¤–ï¼ŒSound.jsæ¨¡å—ä¸­çš„å‡½æ•°ä¹Ÿåªèƒ½ä½œä¸ºé¡¶çº§å…¨å±€å¯¹è±¡è®¿é—®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç®€åŒ–è¿™äº›æ¨¡å—ä¸Hexié›†æˆçš„æ–¹å¼ï¼Œå¹¶ä¿æŒå°½å¯èƒ½å¹¿æ³›çš„è·¨å¹³å°å…¼å®¹æ€§ã€‚ å¦‚æœæ‚¨æ˜¯ä¸€åå¼€å‘äººå‘˜ï¼Œå¹¶ä¸”å¸Œæœ›ä¸ºHexiåšè´¡çŒ®ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ä¸ºè¿™äº›æ¨¡å—æä¾›æ–°çš„å’Œæ”¹è¿›çš„ç‰¹æ€§ã€‚æˆ–è€…ï¼Œå¦‚æœä½ çœŸçš„å¾ˆæœ‰é‡å¿ƒï¼Œå‘Hexiå¼€å‘å›¢é˜Ÿæå‡ºä¸€ä¸ªæ–°çš„æ¨¡å—(åœ¨è¿™ä¸ªrepoçš„é—®é¢˜ä¸­ï¼Œä¹Ÿè®¸æˆ‘ä»¬ä¼šæŠŠå®ƒæ·»åŠ åˆ°Hexiçš„æ ¸å¿ƒä¸­!) Hexi å¿«é€Ÿå¯åŠ¨è¦å¿«é€Ÿå¼€å§‹ä½¿ç”¨Hexiï¼Œè¯·æŸ¥çœ‹Hexiç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­çš„Quick starté¡¹ç›®ã€‚è¿™é‡Œæ˜¯HTMLå®¹å™¨é¡µé¢ï¼Œè¿™é‡Œæ˜¯JavaScriptæºæ–‡ä»¶ã€‚æºä»£ç å¾—åˆ°äº†å®Œæ•´çš„æ³¨é‡Šå¹¶è§£é‡Šäº†æ‰€æœ‰çš„å·¥ä½œåŸç†ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³è¿™æ ·åšï¼Œæ‚¨å¯ä»¥ç›´æ¥è·³è½¬åˆ°è¯¥æ–‡ä»¶å¹¶é˜…è¯»å®ƒã€‚(æ‚¨å°†åœ¨binæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å·²ç¼–è¯‘çš„ES5 JavaScriptæ–‡ä»¶ç‰ˆæœ¬ã€‚) å¿«é€Ÿå¯åŠ¨é¡¹ç›®æ˜¯å¯¹æ‰€æœ‰Hexiçš„ä¸»è¦ç‰¹æ€§çš„è®¿é—®ï¼Œæ‚¨å¯ä»¥å°†å®ƒç”¨ä½œåˆ›å»ºæ‚¨è‡ªå·±çš„æ–°Hexiåº”ç”¨ç¨‹åºçš„æ¨¡æ¿ã€‚ç‚¹å‡»è¿™é‡Œå°è¯•ä¸€ä¸ªå·¥ä½œä¾‹å­: æ‚¨å°†é¦–å…ˆçœ‹åˆ°ä¸€ä¸ªåŠ è½½æ ï¼Œå®ƒæ˜¾ç¤ºæ­£åœ¨åŠ è½½çš„æ–‡ä»¶(å£°éŸ³å’Œå›¾åƒ)çš„ç™¾åˆ†æ¯”ã€‚ç„¶åï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªæ—‹è½¬æ¶ˆæ¯ï¼Œè¦æ±‚æ‚¨åœ¨å±å¹•ä¸Šå•å‡»ä»¥åˆ›å»ºçŒ«ã€‚å½“éŸ³ä¹åœ¨èƒŒæ™¯ä¸­æ’­æ”¾æ—¶ï¼Œåªè¦ä½ ç‚¹å‡»é¼ æ ‡ï¼ŒçŒ«å°±ä¼šå‡ºç°åœ¨å±å¹•ä¸Šã€‚(å™¢,å¯¹ä¸èµ·!æˆ‘å¿˜è®°è­¦å‘Šä½ éŸ³ä¹äº†!æ–‡æœ¬å­—æ®µä¼šæ—‹è½¬å¹¶è®¡ç®—æ‚¨åˆ›å»ºçš„çŒ«çš„æ•°é‡ã€‚è¿™äº›çŒ«è‡ªå·±åœ¨å±å¹•ä¸Šæ¥å›ç§»åŠ¨å’Œåå¼¹ï¼ŒåŒæ—¶åœ¨å¤§å°ä¸Šè¿›è¡Œç¼©æ”¾ï¼Œå¹¶æ‘†åŠ¨å®ƒä»¬çš„é€æ˜åº¦ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä½ å°†çœ‹åˆ°çš„ä¾‹å­: ä¸ºä»€ä¹ˆæ˜¯çŒ«?å› ä¸ºã€‚ å¦‚æœæ‚¨çŸ¥é“è¿™ä¸ªå¿«é€Ÿå¯åŠ¨åº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•å¼€å‘çš„ï¼Œé‚£ä¹ˆæ‚¨å°±å¯ä»¥å¿«é€Ÿåœ°ä½¿ç”¨Hexiæ¥æé«˜æ•ˆç‡äº†â€”â€”è®©æˆ‘ä»¬æ¥çœ‹çœ‹å§! (æ³¨æ„: å¦‚æœä½ æ˜¯æ¸¸æˆç¼–ç¨‹æ–°æ‰‹ï¼Œè§‰å¾—éœ€è¦ä¸€ä¸ªæ›´æ¸©å’Œã€æ›´æœ‰æ¡ç†çš„Hexiå…¥é—¨ï¼Œè¯·æŸ¥çœ‹å‰é¢çš„æ•™ç¨‹éƒ¨åˆ†ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•ä»å¤´å¼€å§‹åˆ¶ä½œ3ä¸ªå®Œæ•´çš„æ¸¸æˆï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªæ¸¸æˆé€æ¸å»ºç«‹åœ¨ä½ åœ¨ä¹‹å‰çš„æ¸¸æˆä¸­å­¦åˆ°çš„æŠ€èƒ½ä¸Šã€‚ HTMLå®¹å™¨æƒŸä¸€éœ€è¦å¼€å§‹ä½¿ç”¨Hexiçš„æ–‡ä»¶æ˜¯hexi.min.jsã€‚å®ƒæœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„â€œå®‰è£…â€:åªéœ€å°†å®ƒé“¾æ¥åˆ°å¸¦æœ‰&lt;script&gt;æ ‡è®°çš„HTMLé¡µé¢ã€‚ç„¶åé“¾æ¥åŒ…å«æ¸¸æˆæˆ–åº”ç”¨ç¨‹åºä»£ç çš„ä¸»JavaScriptæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„Hexi HTMLå®¹å™¨é¡µé¢: 1234567&lt;!doctype html&gt;&lt;meta charset=\"utf-8\"&gt;&lt;title&gt;Hexi&lt;/title&gt;&lt;body&gt;&lt;script src=\"hexi.min.js\"&gt;&lt;/script&gt;&lt;script src=\"main.js\"&gt;&lt;/script&gt;&lt;/body&gt; å½“ç„¶ï¼Œæ‚¨å¯ä»¥åŠ è½½æ¸¸æˆæ‰€éœ€çš„æ‰€æœ‰å¤–éƒ¨è„šæœ¬æ–‡ä»¶ã€‚ å¦‚æœæ‚¨éœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„æ–‡ä»¶æ¥åŠ è½½æ²³è¥¿:Pixiæ¸²æŸ“å™¨ã€Hexiæ¨¡å—å’ŒHexi core.jsæ–‡ä»¶ã€‚ 12345678910111213&lt;!doctype html&gt;&lt;meta charset=\"utf-8\"&gt;&lt;title&gt;Hexi&lt;/title&gt;&lt;body&gt;&lt;!-- Pixi renderer, Hexi's modules, and Hexi's core --&gt;&lt;script src=\"pixi.js\"&gt;&lt;/script&gt;&lt;script src=\"modules.js\"&gt;&lt;/script&gt;&lt;script src=\"core.js\"&gt;&lt;/script&gt;&lt;!-- Main application file --&gt;&lt;script src=\"bin/quickStart.js\"&gt;&lt;/script&gt;&lt;/body&gt; è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨è‡ªå·±çš„è‡ªå®šä¹‰Pixiæ„å»ºï¼Œæˆ–è€…æ‚¨å¸Œæœ›ä½¿ç”¨çš„ç‰¹å®šç‰ˆæœ¬çš„Pixiæ¥äº¤æ¢Hexiçš„å†…éƒ¨ç‰ˆæœ¬ã€‚æˆ–è€…ä½ å¯¹Hexiçš„æ¨¡å—åšäº†ä¸€äº›ç–¯ç‹‚çš„ä¿®æ”¹ï¼Œä½ æƒ³å°è¯•ä¸€ä¸‹ã€‚ä½†é€šå¸¸ï¼Œä½ å¯èƒ½æ°¸è¿œéƒ½ä¸éœ€è¦è¿™æ ·åšã€‚ Hexi æ¶æ„æ‰€æœ‰çš„ä¹è¶£éƒ½å‘ç”Ÿåœ¨æ‚¨çš„ä¸»JavaScriptæ–‡ä»¶ä¸­ã€‚Hexiåº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªéå¸¸ç®€å•ä½†çµæ´»çš„æ¶æ„ï¼Œæ‚¨å¯ä»¥æ‰©å±•åˆ°ä»»ä½•æ‚¨éœ€è¦çš„å¤§å°ã€‚å°æ¸¸æˆç”¨å‡ ç™¾è¡Œä»£ç æˆ–å¤§æ¸¸æˆç”¨å‡ ç™¾ä¸ªæ–‡ä»¶-æ²³è¥¿å¯ä»¥åšåˆ°!è¿™æ˜¯å…¸å‹çš„Hexiåº”ç”¨çš„ç»“æ„: å¯åŠ¨Hexi loadå‡½æ•°ï¼Œåœ¨æ–‡ä»¶åŠ è½½æ—¶è¿è¡Œ setupå‡½æ•°ï¼Œåˆå§‹åŒ–ä½ çš„æ¸¸æˆå¯¹è±¡ï¼Œå˜é‡å’Œç²¾çµã€‚ playå‡½æ•°ï¼Œå®ƒæ˜¯åœ¨å¾ªç¯ä¸­è¿è¡Œçš„æ¸¸æˆæˆ–åº”ç”¨ç¨‹åºé€»è¾‘ã€‚ è¿™æ˜¯çœŸå®ä»£ç çš„æ ·å­: 123456789101112131415161718192021222324252627282930313233//1. Setting up and starting Hexi//An array of files you want to loadlet thingsToLoad = [\"anyFiles\", \"youWant\", \"toLoad\"];//Initialize and start Hexilet g = hexi(canvasWidth, canvasHeight, setup, thingsToLoad, load);g.start();//2. The `load` function that will run while your files are loadingfunction load()&#123; //Display an optional loading bar g.loadingBar();&#125;//3. The `setup` function, which initializes your game objects, variables and spritesfunction setup() &#123; //Create your game objects here //Set the game state to `play` to start the game loop g.state = play;&#125;//4. The `play` function, which is your game or application logic that runs in a loopfunction play()&#123; //This is your game loop, where you can move sprites and add your //game logic&#125; åˆ›å»ºä»»ä½•ç±»å‹çš„æ¸¸æˆæˆ–åº”ç”¨ç¨‹åºéƒ½éœ€è¦è¿™ä¸ªç®€å•çš„æ¨¡å‹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºæ‚¨è‡ªå·±çš„é¡¹ç›®çš„å¯åŠ¨æ¨¡æ¿ï¼ŒåŒæ ·çš„åŸºæœ¬æ¨¡å‹å¯ä»¥æ‰©å±•åˆ°ä»»ä½•å¤§å°ã€‚ è®©æˆ‘ä»¬äº†è§£å¦‚ä½•ä½¿ç”¨è¿™ä¸ªä½“ç³»ç»“æ„æ¨¡å‹æ¥æ„å»ºå¿«é€Ÿå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ å»ºç«‹å’Œå¯åŠ¨Hexié¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œåˆ—å‡ºè¦åŠ è½½çš„æ‰€æœ‰æ–‡ä»¶ã€‚å¿«é€Ÿå¯åŠ¨é¡¹ç›®åŠ è½½ä¸€ä¸ªå›¾åƒæ–‡ä»¶ã€ä¸€ä¸ªå­—ä½“æ–‡ä»¶å’Œä¸€ä¸ªéŸ³ä¹æ–‡ä»¶ã€‚ 12345let thingsToLoad = [ \"images/cat.png\", \"fonts/puzzler.otf\", \"sounds/music.wav\"]; å¦‚æœæ²¡æœ‰è¦åŠ è½½çš„æ–‡ä»¶ï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚ æ¥ä¸‹æ¥ï¼Œç”¨hexiå‡½æ•°åˆå§‹åŒ–Hexiã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•åˆå§‹åŒ–å±å¹•å¤§å°ä¸º512x512åƒç´ çš„Hexiåº”ç”¨ç¨‹åºã€‚å®ƒå‘Šè¯‰Hexiåœ¨thingsToLoadæ•°ç»„ä¸­åŠ è½½æ–‡ä»¶ï¼Œåœ¨åŠ è½½æ—¶è¿è¡Œä¸€ä¸ªåä¸ºloadçš„å‡½æ•°ï¼Œç„¶ååœ¨ä¸€åˆ‡å‡†å¤‡å°±ç»ªæ—¶è¿è¡Œä¸€ä¸ªåä¸ºsetupçš„å‡½æ•°ã€‚ 1let g = hexi(512, 512, setup, thingsToLoad, load); ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸€ä¸ªåä¸ºgçš„å¯¹è±¡è®¿é—®åº”ç”¨ç¨‹åºä¸­çš„Hexiå®ä¾‹(ä¸è¿‡ï¼Œæ‚¨å¯ä»¥ç»™å®ƒå–ä»»ä½•åç§°ã€‚æˆ‘å–œæ¬¢ç”¨â€œgâ€ï¼Œå› ä¸ºå®ƒä»£è¡¨â€œgameâ€ï¼Œè€Œä¸”æ‰“å­—å¾ˆçŸ­ã€‚ hexiå‡½æ•°æœ‰5ä¸ªå‚æ•°ï¼Œå°½ç®¡åªéœ€è¦å‰3ä¸ªå‚æ•°ã€‚ ç”»å¸ƒå®½åº¦ ç”»å¸ƒé«˜åº¦ setupå‡½æ•° ä½ åœ¨ä¸Šé¢å®šä¹‰çš„thingsToLoadæ•°ç»„ã€‚å¯é€‰ loadå‡½æ•°ã€‚å¯é€‰ å¦‚æœæ‚¨è·³è¿‡æœ€åä¸¤ä¸ªå‚æ•°ï¼ŒHexiå°†è·³è¿‡åŠ è½½è¿‡ç¨‹å¹¶ç›´æ¥è·³è½¬åˆ°setupå‡½æ•°ã€‚ å¯é€‰åœ°è®¾ç½®æ¸¸æˆé€»è¾‘å¾ªç¯åº”è¯¥è¿è¡Œçš„æ¯ç§’å¸§æ•°ã€‚(ç²¾çµå°†è¢«ç‹¬ç«‹åœ°å‘ˆç°ï¼Œå¹¶è¿›è¡Œæ’å€¼ï¼Œè¾¾åˆ°60 fps)å¦‚æœä¸è®¾ç½®fps, Hexiå°†é»˜è®¤ä¸º60 fpsã€‚ 1g.fps = 30; è®¾ç½®ä¸€ä¸ªä½äº60çš„fpsä¼šç»™ä½ å¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€ï¼Œä½ çš„æ¸¸æˆä¹Ÿä¼šçœ‹èµ·æ¥å¾ˆæ£’ã€‚ æ‚¨è¿˜å¯ä»¥é€‰æ‹©æ·»åŠ è¾¹æ¡†å¹¶è®¾ç½®èƒŒæ™¯é¢œè‰²ã€‚ 12g.border = \"2px red dashed\";g.backgroundColor = 0x000000; å¦‚æœä½ æƒ³è¦ç¼©æ”¾å’Œå¯¹é½æ¸¸æˆå±å¹•åˆ°æœ€å¤§çš„æµè§ˆå™¨çª—å£å¤§å°ï¼Œä½ å¯ä»¥ä½¿ç”¨scaleToWindowæ–¹æ³•ã€‚ 1g.scaleToWindow(); æœ€åï¼Œè°ƒç”¨startæ–¹æ³•ä½¿Hexiè¿è¡Œ 1g.start(); è¿™æ˜¯å¾ˆé‡è¦çš„!å¦‚æœä¸è°ƒç”¨startæ–¹æ³•ï¼ŒHexiå°†ä¸ä¼šå¯åŠ¨! loadå‡½æ•°ï¼Œåœ¨åŠ è½½æ—¶è¿è¡Œå¦‚æœæ‚¨åœ¨åˆå§‹åŒ–æ—¶æä¾›äº†ä¸€ä¸ªåä¸ºloadçš„å‡½æ•°ï¼Œæ‚¨å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªåŠ è½½æ å¹¶åŠ è½½è¿›åº¦ä¿¡æ¯ã€‚åªéœ€åˆ›å»ºä¸€ä¸ªåä¸ºloadçš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1234567891011function load()&#123; //æ˜¾ç¤ºå½“å‰æ­£åœ¨åŠ è½½çš„æ–‡ä»¶ console.log(`loading: $&#123;g.loadingFile&#125;`); //æ˜¾ç¤ºå½“å‰åŠ è½½çš„æ–‡ä»¶çš„ç™¾åˆ†æ¯” console.log(`progress: $&#123;g.loadingProgress&#125;`); //æ·»åŠ å¯é€‰çš„åŠ è½½æ¡ g.loadingBar();&#125; setupå‡½æ•°ï¼Œåˆå§‹åŒ–å¹¶åˆ›å»ºæ¸¸æˆå¯¹è±¡ç°åœ¨æ‚¨å·²ç»å¯åŠ¨äº†Hexiï¼Œå¹¶åŠ è½½äº†æ‰€æœ‰çš„æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å¼€å§‹åˆ¶ä½œä¸œè¥¿äº†!è¿™åœ¨setupå‡½æ•°ä¸­å‘ç”Ÿã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•å¯¹è±¡æˆ–å˜é‡è¦è·¨å¤šä¸ªå‡½æ•°ä½¿ç”¨ï¼Œè¯·åœ¨setupå‡½æ•°ä¹‹å¤–å®šä¹‰å®ƒä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤º: 12345678//These things will be used in more than one functionlet cats, message;//Use the `setup` function to create thingsfunction setup()&#123; //... create things here! ...&#125; è®©æˆ‘ä»¬çœ‹çœ‹å®‰è£…å‡½æ•°ä¸­çš„ä»£ç æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬è¦åšçŒ«â€”â€”å¾ˆå¤šçš„çŒ«!-æ‰€ä»¥åˆ›å»ºä¸€ä¸ªå«catsçš„åˆ†ç»„æ¥æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ 1cats = g.group(); åœ¨å¿«é€Ÿå¯åŠ¨é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥ç”¨é¼ æ ‡(æˆ–è§¦æ‘¸)è½»å‡»å±å¹•æ¥åˆ¶ä½œä¸€ä¸ªæ–°çš„çŒ«ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½ä¸ºæˆ‘ä»¬äº§ç”Ÿæ–°çš„çŒ«ç²¾çµçš„å‡½æ•°ã€‚(ç²¾çµæ˜¯äº¤äº’å›¾å½¢ï¼Œä½ å¯ä»¥åœ¨å±å¹•ä¸Šè¿›è¡ŒåŠ¨ç”»å’Œç§»åŠ¨ã€‚)Hexiå…è®¸æ‚¨ä½¿ç”¨spriteæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„ç²¾çµã€‚åªè¦ä¸ºç²¾çµæä¾›æ‚¨æƒ³è¦ä½¿ç”¨çš„æ–‡ä»¶åã€‚åº”è¯¥ä½¿ç”¨addChildæ–¹æ³•å°†åˆ›å»ºçš„æ¯ä¸ªæ–°çš„catç²¾çµå®šä½å¹¶æ·»åŠ åˆ°catsç»„ä¸­ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›çŒ«ç”¨å‘¼å¸æ³•ä½¿å®ƒçš„é³ç‰‡åŠ¨èµ·æ¥ï¼Œç”¨breatheæ–¹æ³•ä½¿å®ƒçš„é€æ˜åº¦åŠ¨èµ·æ¥ã€‚ä¸€ä¸ªå«åšmakeCatsçš„å‡½æ•°å¯ä»¥åšåˆ°è¿™ä¸€åˆ‡ã€‚makeCatsæœ‰ä¸¤ä¸ªå‚æ•°:xå’Œyçš„ä½ç½®ï¼Œç›¸å¯¹äºå±å¹•å·¦ä¸Šè§’ï¼Œä½ å¸Œæœ›çŒ«å‡ºç°çš„ä½ç½®ã€‚ 123456789101112131415161718192021222324252627let makeCat = (x, y) =&gt; &#123; //Create the cat sprite. Supply the `sprite` method with //the name of the loaded image that should be displayed let cat = g.sprite(\"images/cat.png\"); //Set the cat's position cat.setPosition(x, y); //You can alternatively set the position my modifying the sprite's `x` and //`y` properties directly, like this //cat.x = x; //cat.y = y; //Add some optional tween animation effects from the Hexi's //built-in tween library (called Charm). `breathe` makes the //sprite scale in and out. `pulse` oscillates its transparency g.breathe(cat, 2, 2, 20); g.pulse(cat, 10, 0.5); //Set the cat's velocity to a random number between -10 and 10 cat.vx = g.randomInt(-10, 10); cat.vy = g.randomInt(-10, 10); //Add the cat to the `cats` group cats.addChild(cat);&#125;; (åœ¨ç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­çš„tweeningç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥äº†è§£æ›´å¤šå…³äºbreatheå’Œpulseæ–¹æ³•å¦‚ä½•å·¥ä½œä»¥ä½¿catå…·æœ‰åŠ¨ç”»æ•ˆæœçš„ä¿¡æ¯ã€‚) æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡æœ¬ç²¾çµæ¥æ˜¾ç¤ºâ€Tap for cats!â€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Hexiçš„textæ–¹æ³•ã€‚ 1message = g.text(\"Tap for cats!\", \"38px puzzler\", \"red\"); textæ–¹æ³•çš„å‚æ•°æ˜¯æ‚¨æƒ³è¦æ˜¾ç¤ºçš„æ–‡æœ¬ã€å­—ä½“å¤§å°å’Œå®¶æ—ä»¥åŠé¢œè‰²(æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•HTML/CSSé¢œè‰²å­—ç¬¦ä¸²å€¼ã€RGBAæˆ–HSLAå€¼)ã€‚ ä½¿ç”¨Hexiçš„putCenteræ–¹æ³•å°†æ–‡æœ¬å±…ä¸­ stageæ˜¯ä»€ä¹ˆ?å®ƒæ˜¯æ‰€æœ‰Hexiç²¾çµåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶éƒ½å±äºçš„æ ¹å®¹å™¨ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨putLeftã€putRightã€putTopæˆ–putBottomæ–¹æ³•æ¥å¸®åŠ©æ‚¨å¯¹é½ç›¸å¯¹äºå…¶ä»–å¯¹è±¡çš„å¯¹è±¡ã€‚è¿™äº›æ–¹æ³•çš„å¯é€‰çš„ç¬¬2å’Œç¬¬3ä¸ªå‚æ•°å®šä¹‰xå’Œyåç§»é‡ï¼Œè¿™æœ‰åŠ©äºæ‚¨å¾®è°ƒå®šä½ã€‚ å› ä¸ºæˆ‘ä»¬å¸Œæœ›æ–‡æœ¬æ¶ˆæ¯å›´ç»•ä¸­å¿ƒç‚¹æ—‹è½¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å°†å…¶pivotXå’ŒpivotYå€¼è®¾ç½®ä¸º0.5ã€‚ 12message.pivotX = 0.5;message.pivotY = 0.5; 0.5è¡¨ç¤ºâ€œç²¾çµçš„ä¸­å¿ƒâ€ æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æ›¿ä»£è¯­æ³•æ¥è®¾ç½®è½´å¿ƒç‚¹: 1message.setPivot(0.5, 0.5); æˆ‘ä»¬éœ€è¦ä¸€äº›æ–¹æ³•æ¥å‘Šè¯‰Hexiï¼Œå½“å±å¹•è¢«ç‚¹å‡»æˆ–ç‚¹å‡»æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„çŒ«ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›æ–‡æœ¬ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬å½“å‰å±å¹•ä¸Šæœ‰å¤šå°‘åªçŒ«ã€‚Hexiæœ‰ä¸€ä¸ªå†…å»ºçš„æŒ‡é’ˆå¯¹è±¡å’Œä¸€ä¸ªtapæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹æ¥å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ 12345678g.pointer.tap = () =&gt; &#123; //Supply `makeCat` with the pointer's `x` and `y` coordinates. makeCat(g.pointer.x, g.pointer.y); //Make the `message.content` display the number of cats message.content = `$&#123;cats.children.length&#125;`;&#125;; æˆ‘ä»¬è¿˜æƒ³è¦åŠ è½½çš„éŸ³ä¹æ–‡ä»¶å¼€å§‹æ’­æ”¾ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Hexiçš„å£°éŸ³æ–¹æ³•è®¿é—®éŸ³ä¹å£°éŸ³å¯¹è±¡ã€‚ä½¿ç”¨å£°éŸ³å¯¹è±¡çš„å¾ªç¯æ–¹æ³•ä½¿å…¶è¿ç»­å¾ªç¯ï¼Œå¹¶ä½¿ç”¨playç«‹å³å¼€å§‹æ’­æ”¾ã€‚ 123let music = g.sound(\"sounds/music.wav\");music.loop = true;music.play(); æˆ‘ä»¬ç°åœ¨å·²ç»æŠŠä¸€åˆ‡éƒ½å®‰æ’å¥½äº†!è¿™æ„å‘³ç€æˆ‘ä»¬å·²ç»å®Œæˆäº†åº”ç”¨ç¨‹åºçš„è®¾ç½®çŠ¶æ€ï¼Œç°åœ¨å¯ä»¥åˆ‡æ¢åˆ°playã€‚å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹: 1g.state = play; playçŠ¶æ€æ˜¯ä¸€ä¸ªåœ¨å¾ªç¯ä¸­è¿è¡Œçš„å‡½æ•°ï¼Œå®ƒæ˜¯æˆ‘ä»¬æ‰€æœ‰åº”ç”¨ç¨‹åºé€»è¾‘çš„æ‰€åœ¨ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ playå‡½æ•°:å¾ªç¯åº”ç”¨ç¨‹åºé€»è¾‘Hexiåº”ç”¨ç¨‹åºä¸­æœ€åéœ€è¦çš„å°±æ˜¯ä¸€ä¸ªplayå‡½æ•°ã€‚ 1234function play() &#123; //All this code will run in a loop&#125; playå‡½æ•°åœ¨ä¸€ä¸ªè¿ç»­å¾ªç¯ä¸­è¢«è°ƒç”¨ï¼Œæ— è®ºæ‚¨è®¾ç½®ä»€ä¹ˆfps(æ¯ç§’å¸§æ•°)å€¼ã€‚è¿™æ˜¯æ‚¨çš„æ¸¸æˆé€»è¾‘å¾ªç¯ã€‚(æ¸²æŸ“å¾ªç¯å°†ç”±Hexiåœ¨åå°è¿è¡Œï¼Œåœ¨æ‚¨çš„ç³»ç»Ÿå¯ä»¥å¤„ç†çš„æœ€å¤§fpsä¸­ã€‚)æ‚¨å¯ä»¥ä½¿ç”¨pauseæ–¹æ³•éšæ—¶æš‚åœHexiçš„æ¸¸æˆå¾ªç¯ï¼Œå¹¶ä½¿ç”¨resumeæ–¹æ³•é‡æ–°å¯åŠ¨å®ƒã€‚(æŸ¥çœ‹Flappy Fairy é¡¹ç›®ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨pauseå’Œresumeæ¥ç®¡ç†çŠ¶æ€å¤æ‚çš„åº”ç”¨ç¨‹åºã€‚) Quick Starté¡¹ç›®çš„playåŠŸèƒ½åªåšä¸¤ä»¶äº‹:å®ƒä½¿æ–‡æœ¬æ—‹è½¬ï¼Œå¹¶åœ¨å±å¹•ä¸Šç§»åŠ¨å’Œåå¼¹çŒ«ã€‚è¿™æ˜¯æ•´ä¸ªplayå‡½æ•°ã€‚ 12345678910111213141516function play() &#123; //Rotate the text message.rotation += 0.1; //Loop through all of the cats to make them move and bounce off the //edges of the stage cats.children.forEach(cat =&gt; &#123; //è®©çŒ«ä»å±å¹•è¾¹ç¼˜åå¼¹ let collision = g.contain(cat, g.stage, true); //Move the cat g.move(cat); &#125;);&#125; è¿™æ˜¯æ‰€æœ‰!ä¸æˆ‘ä»¬åœ¨è®¾ç½®å‡½æ•°ä¸­æ‰€åšçš„æ‰€æœ‰å·¥ä½œç›¸æ¯”ï¼Œplayå‡½æ•°å®é™…ä¸Šä»€ä¹ˆéƒ½ä¸åš!ä½†æ˜¯å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢? å®ƒé¦–å…ˆé€šè¿‡å°†æ¶ˆæ¯æ–‡æœ¬ç²¾çµçš„rotation(æ—‹è½¬)å±æ€§æ›´æ–°0.1å¼§åº¦ï¼Œä½¿æ–‡æœ¬å›´ç»•ä¸­å¿ƒæ—‹è½¬ã€‚ 1message.rotation += 0.1; ç”±äºè¿™ä¸ªæ–°çš„æ—‹è½¬å€¼è¢«åº”ç”¨åˆ°ä¸€ä¸ªè¿ç»­å¾ªç¯å†…çš„æ—§æ—‹è½¬å€¼ä¸­ï¼Œå®ƒé€æ¸å¢åŠ äº†å€¼å¹¶ä½¿æ–‡æœ¬æ—‹è½¬ã€‚ æ¥ä¸‹æ¥ï¼Œä»£ç å°†éå†catç»„çš„å­æ•°ç»„ä¸­çš„æ‰€æœ‰ç²¾çµã€‚ 123cats.children.forEach(cat =&gt; &#123; //Loop through each `cat` sprite in the `chidren` array&#125;); æ‰€æœ‰çš„Hexiç»„éƒ½æœ‰ä¸€ä¸ªåä¸ºchildrençš„æ•°ç»„ï¼Œå®ƒå‘Šè¯‰ä½ å®ƒä»¬åŒ…å«å“ªäº›ç²¾çµã€‚æ— è®ºä½•æ—¶ä½¿ç”¨addChildæ–¹æ³•å‘ç»„æ·»åŠ ç²¾çµï¼Œç²¾çµéƒ½ä¼šè¢«æ·»åŠ åˆ°ç»„çš„å­æ•°ç»„ä¸­ã€‚Hexiçš„æ ¹å®¹å™¨ï¼Œå«åšstageï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­æ•°ç»„ï¼Œå®ƒåŒ…å«äº†ä½ çš„Hexiåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç²¾çµå’Œç»„ã€‚å³ä½¿spriteå¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªå­æ•°ç»„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨addChildä¸å…¶ä»–ç²¾çµåˆ†ç»„æ¥åˆ›å»ºå¤æ‚çš„æ¸¸æˆå¯¹è±¡ã€‚ å½“ä»£ç å¾ªç¯éå†æ¯åªçŒ«æ—¶ï¼Œå®ƒé¦–å…ˆæ£€æŸ¥çŒ«æ˜¯å¦è§¦ç¢°äº†å±å¹•çš„è¾¹ç¼˜ï¼Œå¦‚æœè§¦ç¢°äº†ï¼Œå®ƒä¼šæœç›¸åçš„æ–¹å‘åå¼¹ã€‚Hexi containæ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ã€‚ 1let collision = g.contain(cat, g.stage, true); å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºtrueæ˜¯å¯¼è‡´çŒ«åå¼¹çš„åŸå›  çŒ«åœ¨moveæ–¹æ³•çš„å¸®åŠ©ä¸‹åœ¨å±å¹•ä¸Šç§»åŠ¨ã€‚ 1g.move(cat); moveæ–¹æ³•é€šè¿‡å…¶vxå’Œvyé€Ÿåº¦å€¼æ›´æ–°ç²¾çµçš„ä½ç½®ã€‚(æ‰€æœ‰çš„Hexiç²¾çµéƒ½æœ‰vxå’Œvyå€¼ï¼Œåˆå§‹åŒ–ä¸º0)ã€‚é€šè¿‡å‘moveæä¾›ä¸€ä¸ªç”±é€—å·åˆ†éš”çš„ç²¾çµåˆ—è¡¨ï¼Œæ‚¨å¯ä»¥ä¸€æ¬¡ç§»åŠ¨å¤šä¸ªç²¾çµã€‚æ‚¨ç”šè‡³å¯ä»¥ä¸ºå®ƒæä¾›åŒ…å«æ‚¨æƒ³è¦ç§»åŠ¨çš„æ‰€æœ‰ç²¾çµçš„æ•°ç»„ã€‚ä»¥ä¸‹æ˜¯ç§»åŠ¨å®é™…ä¸Šåœ¨å¹•åæ‰€åšçš„: 12cat.x += cat.vx;cat.y += cat.vy; è¿™å°±æ˜¯ä¸€åˆ‡!è¿™å°±æ˜¯å…³äºQuick Startåº”ç”¨ç¨‹åºçš„æ‰€æœ‰çŸ¥è¯†ï¼Œä»¥åŠå…³äºHexiæ‰€éœ€çš„å‡ ä¹æ‰€æœ‰çŸ¥è¯†! æŠŠå®ƒè¿›ä¸€æ­¥ä½¿ç”¨è¿™ä¸ªåŸºæœ¬çš„Hexiæ¶æ„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä»»ä½•ä¸œè¥¿ã€‚åªéœ€å°†Hexiçš„çŠ¶æ€å±æ€§è®¾ç½®ä¸ºä»»ä½•å…¶ä»–å‡½æ•°ï¼Œä»¥åˆ‡æ¢åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚æ–¹æ³•å¦‚ä¸‹: 1g.state = anyStateFunction; çŠ¶æ€åªæ˜¯æ™®é€šçš„æ—§JavaScriptå‡½æ•°!å¾ˆç®€å•! æ ¹æ®éœ€è¦ç¼–å†™å°½å¯èƒ½å¤šçš„çŠ¶æ€å‡½æ•°ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå°é¡¹ç›®ï¼Œæ‚¨å¯ä»¥å°†æ‰€æœ‰è¿™äº›åŠŸèƒ½ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå¤§é¡¹ç›®ï¼Œåœ¨éœ€è¦æ—¶ä»å¤–éƒ¨JSæ–‡ä»¶åŠ è½½å‡½æ•°ã€‚ä½¿ç”¨æ‚¨å–œæ¬¢çš„ä»»ä½•æ¨¡å—ç³»ç»Ÿï¼Œå¦‚ES6æ¨¡å—ã€CommonJSã€AMDæˆ–æ—§çš„HTML &lt;script&gt;æ ‡ç­¾ã€‚è¿™ä¸ªç®€å•çš„æ¶æ„æ¨¡å‹å¯ä»¥æ‰©å±•åˆ°ä»»ä½•å¤§å°ï¼Œå¹¶ä¸”æ˜¯æ‚¨éœ€è¦çŸ¥é“çš„å”¯ä¸€çš„ä½“ç³»ç»“æ„æ¨¡å‹ã€‚ä¿æŒç®€å•ï¼Œä¿æŒå¿«ä¹! ç°åœ¨æ‚¨å·²ç»å¤§è‡´äº†è§£äº†Hexiæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¯·é˜…è¯»æ•™ç¨‹æ¥æ·±å…¥äº†è§£ç»†èŠ‚ã€‚ æ•™ç¨‹æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä¸ªæ¸¸æˆæ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡æ”¶é›†å’Œæ•Œäººèº²é¿æ¸¸æˆå«åšå¯»å®çŒäººã€‚åœ¨webæµè§ˆå™¨ä¸­æ‰“å¼€æ–‡ä»¶01_treasurehunter.htmlã€‚(æ‚¨å¯ä»¥åœ¨Hexiçš„æ•™ç¨‹æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å®ƒï¼Œæ‚¨éœ€è¦åœ¨webserverä¸­è¿è¡Œå®ƒ)ã€‚å¦‚æœæ‚¨ä¸æƒ³è´¹äº‹è®¾ç½®ä¸€ä¸ªwebserverï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ¯”å¦‚æ–¹æ‹¬å·ï¼Œå®ƒå°†è‡ªåŠ¨ä¸ºæ‚¨å¯åŠ¨ä¸€ä¸ªæ–¹æ‹¬å·(è¯·å‚é˜…æ–¹æ‹¬å·çš„æ–‡æ¡£)ã€‚ æ¸¸æˆå…¥å£ (æŒ‰ç…§ä¸Šé¢çš„é“¾æ¥æ¥ç©è¿™ä¸ªæ¸¸æˆã€‚)ä½¿ç”¨é”®ç›˜ç§»åŠ¨èµ„æºç®¡ç†å™¨(è“è‰²æ–¹å—)ï¼Œæ”¶é›†å®è—(é»„è‰²æ–¹å—)ï¼Œé¿å¼€æ€ªç‰©(çº¢è‰²æ–¹å—)ï¼Œåˆ°è¾¾å‡ºå£(ç»¿è‰²æ–¹å—)ã€‚æ˜¯çš„ï¼Œä½ ç°åœ¨å¿…é¡»å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›ã€‚ ä»¥ä¸‹æ˜¯å®Œæ•´çš„JavaScriptæºä»£ç : !å¯»å®çŒäººæºç  ä¸è¦è¢«å®ƒè¡¨é¢ä¸Šçš„ç®€å•æ‰€è¿·æƒ‘ã€‚å¯»å®è€…åŒ…å«äº†æ¸¸æˆæ‰€éœ€çš„ä¸€åˆ‡: äº¤äº’æ€§ ç¢°æ’ ç²¾çµ æ¸¸æˆå¾ªç¯ åœºæ™¯ æ¸¸æˆé€»è¾‘ â€œJuiceâ€ (ä»¥å£°éŸ³çš„å½¢å¼) (ä»€ä¹ˆæœæ±?è¯·è§‚çœ‹æœ¬è§†é¢‘å¹¶é˜…è¯»æœ¬æ–‡ï¼Œä»¥äº†è§£è¿™ä¸€æ¸¸æˆè®¾è®¡è¦ç´ ã€‚ å¦‚æœä½ èƒ½åšä¸€ä¸ªç®€å•çš„æ¸¸æˆï¼Œå¦‚å¯»å®æ¸¸æˆï¼Œä½ å‡ ä¹å¯ä»¥åšä»»ä½•å…¶ä»–ç±»å‹çš„æ¸¸æˆã€‚æ˜¯çš„,çœŸçš„!ä»å¯»å®äººåˆ°Skyrimæˆ–å¡å°”è¾¾åªæ˜¯å¾ˆå¤šå°æ­¥éª¤çš„äº‹æƒ…;æ·»åŠ æ›´å¤šçš„ç»†èŠ‚ã€‚ä½ æƒ³è¦åŠ å¤šå°‘ç»†èŠ‚å–å†³äºä½ è‡ªå·±ã€‚ åœ¨æœ¬æ•™ç¨‹çš„ç¬¬ä¸€é˜¶æ®µï¼Œæ‚¨å°†äº†è§£å¦‚ä½•åˆ¶ä½œåŸºæœ¬çš„å¯»å®æ¸¸æˆï¼Œç„¶åæˆ‘ä»¬å°†æ·»åŠ ä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ï¼Œå¦‚å›¾åƒå’Œå­—ç¬¦åŠ¨ç”»ï¼Œè¿™å°†ä½¿æ‚¨å…¨é¢äº†è§£Hexiå¦‚ä½•å·¥ä½œã€‚ å¦‚æœä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„æ¸¸æˆç¨‹åºå‘˜å’Œå¿«é€Ÿçš„è‡ªæˆ‘å¯åŠ¨è€…ï¼Œä½ å¯èƒ½ä¼šå‘ç°åœ¨Hexiçš„ä¾‹å­æ–‡ä»¶å¤¹é‡Œçš„ä»£ç æ˜¯ä¸€ä¸ªæ›´æœ‰æ•ˆç‡çš„å¼€å§‹å­¦ä¹ çš„åœ°æ–¹â€”â€”çœ‹çœ‹å®ƒã€‚ç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­çš„å®Œæ•´æ³¨é‡Šä»£ç è¿˜è¯¦ç»†è¯´æ˜äº†è¿™äº›æ•™ç¨‹ä¸­æ²¡æœ‰æ¶‰åŠçš„ç‰¹æ€§çš„å…·ä½“å’Œé«˜çº§ç”¨æ³•ã€‚å½“æ‚¨å®Œæˆè¿™äº›æ•™ç¨‹çš„å­¦ä¹ åï¼Œè¿™äº›ç¤ºä¾‹å°†å¸¦æ‚¨è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚ è®¾ç½®HTMLå®¹å™¨é¡µé¢åœ¨å¼€å§‹ä½¿ç”¨JavaScriptç¼–ç¨‹ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªæœ€å°çš„HTMLå®¹å™¨é¡µé¢ã€‚HTMLé¡µé¢åŠ è½½hexi.min.jsæ˜¯å”¯ä¸€éœ€è¦ä½¿ç”¨Hexiæ‰€æœ‰ç‰¹æ€§çš„æ–‡ä»¶ã€‚å®ƒè¿˜è£…è½½äº†treasureHunter.jsæ–‡ä»¶ï¼Œå³åŒ…å«æ‰€æœ‰æ¸¸æˆä»£ç çš„JavaScriptæ–‡ä»¶ã€‚ 12345678910&lt;!doctype html&gt;&lt;meta charset=\"utf-8\"&gt;&lt;title&gt;Treasure hunter&lt;/title&gt;&lt;body&gt;&lt;!-- Hexi --&gt;&lt;script src=\"../bin/hexi.min.js\"&gt;&lt;/script&gt;&lt;!-- Main application file --&gt;&lt;script src=\"bin/treasureHunter.js\"&gt;&lt;/script&gt;&lt;/body&gt; è¿™æ˜¯æœ‰æ•ˆçš„HTML5æ–‡æ¡£æ‰€éœ€çš„HTMLä»£ç çš„æœ€å°æ•°é‡ã€‚ æ–‡ä»¶è·¯å¾„åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå¯èƒ½ä¸åŒï¼Œè¿™å–å†³äºæ‚¨å¦‚ä½•è®¾ç½®é¡¹ç›®æ–‡ä»¶ç»“æ„ã€‚ åˆå§‹åŒ–Hexiä¸‹ä¸€æ­¥æ˜¯ç¼–å†™ä¸€äº›JavaScriptä»£ç ï¼Œæ ¹æ®æŒ‡å®šçš„ä¸€äº›å‚æ•°åˆå§‹åŒ–å’Œå¯åŠ¨Hexiã€‚ä¸‹é¢è¿™æ®µä»£ç åˆå§‹åŒ–äº†ä¸€ä¸ªå±å¹•å¤§å°ä¸º512Ã—512åƒç´ çš„æ¸¸æˆã€‚å®ƒè¿˜ä»soundsæ–‡ä»¶å¤¹é¢„å…ˆåŠ è½½chimes.wavå£°éŸ³æ–‡ä»¶ã€‚ 12345678//Initialize Hexi and load the chimes sound filelet g = hexi(512, 512, setup, [\"sounds/chimes.wav\"]);//Scale the game canvas to the maximum size in the browserg.scaleToWindow();//Start the Hexi engine.g.start(); ä½ å¯ä»¥çœ‹åˆ°ï¼Œhexiå‡½æ•°çš„ç»“æœè¢«åˆ†é…ç»™ä¸€ä¸ªå«åšgçš„å˜é‡ã€‚ 1let g = hexi(//... ç°åœ¨ï¼Œæ— è®ºä½•æ—¶ä½ æƒ³åœ¨æ¸¸æˆä¸­ä½¿ç”¨Hexiçš„ä»»ä½•è‡ªå®šä¹‰æ–¹æ³•æˆ–å¯¹è±¡ï¼Œåªè¦åœ¨å…¶å‰é¢åŠ ä¸Šgã€‚(gå¾ˆå¥½ï¼Œå¾ˆçŸ­ï¼Œå¾ˆå®¹æ˜“è®°ä½;g = â€œgameâ€) åœ¨æœ¬ä¾‹ä¸­ï¼ŒHexiåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º512Ã—512åƒç´ çš„ç”»å¸ƒå…ƒç´ ã€‚ç”±å‰ä¸¤ä¸ªå‚æ•°æŒ‡å®š: 1512, 512, setup, ç¬¬ä¸‰ä¸ªå‚æ•°setupæ„å‘³ç€åªè¦Hexiåˆå§‹åŒ–ï¼Œå®ƒå°±åº”è¯¥åœ¨ä½ çš„æ¸¸æˆä»£ç ä¸­æŸ¥æ‰¾å¹¶è¿è¡Œä¸€ä¸ªå«åšsetupçš„å‡½æ•°ã€‚åœ¨setupå‡½æ•°ä¸­ï¼Œä»»ä½•ä»£ç éƒ½å®Œå…¨å–å†³äºæ‚¨ï¼Œæ‚¨å°†å¾ˆå¿«çœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆå§‹åŒ–ä¸€ä¸ªæ¸¸æˆã€‚(ä½ ä¸å¿…è°ƒç”¨è¿™ä¸ªå‡½æ•°setupï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„åå­—) Hexiå…è®¸ä½ ç”¨ä¸€ä¸ªå¯é€‰çš„ç¬¬4ä¸ªå‚æ•°é¢„åŠ è½½æ¸¸æˆèµ„äº§ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶åæ•°ç»„ã€‚åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæ‚¨åªéœ€è¦é¢„åŠ è½½ä¸€ä¸ªæ–‡ä»¶:chimes.wavï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å°†chimes.wavçš„å®Œæ•´æ–‡ä»¶è·¯å¾„ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åœ¨åˆå§‹åŒ–æ•°ç»„ä¸­åˆ—å‡º: 1[\"sounds/chimes.wav\"] æ‚¨å¯ä»¥åœ¨è¿™é‡Œåˆ—å‡ºä»»æ„æ•°é‡çš„æ¸¸æˆèµ„äº§ï¼ŒåŒ…æ‹¬å›¾åƒã€å­—ä½“å’ŒJSONæ–‡ä»¶ã€‚åœ¨è¿è¡Œä»»ä½•æ¸¸æˆä»£ç ä¹‹å‰ï¼ŒHexiå°†ä¸ºæ‚¨åŠ è½½æ‰€æœ‰è¿™äº›èµ„äº§ã€‚ Hexiå®ç°äº†Pixiçš„è¶…çº§èµ„æºåŠ è½½å™¨ã€‚æ‚¨å¯ä»¥ç›´æ¥é€šè¿‡Hexiçš„loaderå±æ€§è®¿é—®åŠ è½½å™¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡resourceså±æ€§è®¿é—®èµ„æºã€‚æˆ–è€…,ç›´æ¥ä½¿ç”¨PIXI.loaderï¼Œå¦‚æœä½ æƒ³ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œäº†è§£æ›´å¤šå…³äºPixiçš„åŠ è½½ç¨‹åºæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æˆ‘ä»¬å¸Œæœ›æ¸¸æˆç”»å¸ƒèƒ½å¤Ÿæ‰©å±•åˆ°æµè§ˆå™¨çª—å£çš„æœ€å¤§å¤§å°ï¼Œä»¥ä¾¿æ˜¾ç¤ºå°½å¯èƒ½å¤§çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åšscaleToWindowçš„æœ‰ç”¨æ–¹æ³•æ¥ä¸ºæˆ‘ä»¬åšè¿™ä¸ªã€‚ 1g.scaleToWindow(); scaleToWindowå°†ä¼šåœ¨ä½ çš„æ¸¸æˆä¸­æ‰¾åˆ°æœ€é€‚åˆçš„ã€‚é•¿ã€å®½çš„æ¸¸æˆå±å¹•å‚ç›´å±…ä¸­ã€‚é«˜æˆ–æ–¹çš„å±å¹•æ°´å¹³å±…ä¸­ã€‚å¦‚æœæ‚¨æƒ³æŒ‡å®šæ‚¨è‡ªå·±çš„æµè§ˆå™¨èƒŒæ™¯é¢œè‰²æ¥è¾¹æ¡†æ¸¸æˆï¼Œè¯·æä¾›scaleToWindowçš„å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1g.scaleToWindow(\"seaGreen\"); æœ€åä½ éœ€è¦åšçš„æ˜¯è°ƒç”¨æ²³è¥¿çš„startæ–¹æ³• 1g.start(); è¿™æ˜¯æ‰“å¼€Hexiå¼•æ“çš„å¼€å…³ å®šä¹‰ä½ çš„å…¨å±€å˜é‡åœ¨Hexiå¼€å§‹åï¼Œå£°æ˜æ¸¸æˆå‡½æ•°éœ€è¦ä½¿ç”¨çš„æ‰€æœ‰å˜é‡ 12let dungeon, player, treasure, enemies, chimes, exit, healthBar, message, gameScene, gameOverScene; å› ä¸ºå®ƒä»¬ä¸åŒ…å«åœ¨å‡½æ•°ä¸­ï¼Œæ‰€ä»¥è¿™äº›å˜é‡æ˜¯â€œå…¨å±€çš„â€ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨æ‰€æœ‰çš„æ¸¸æˆå‡½æ•°ä¸­ä½¿ç”¨å®ƒä»¬ã€‚(å®ƒä»¬ä¸ä¸€å®šæ˜¯â€œå…¨å±€çš„â€ï¼Œå› ä¸ºå®ƒä»¬é©»ç•™åœ¨å…¨å±€JavaScriptåç§°ç©ºé—´ä¸­ã€‚å¦‚æœæ‚¨æƒ³ç¡®ä¿å®ƒä»¬ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°†æ‰€æœ‰JavaScriptä»£ç å°è£…åœ¨ä¸€ä¸ªå°é—­çš„å‡½æ•°ä¸­ï¼Œä»¥å°†å…¶ä¸å…¨å±€ç©ºé—´éš”ç¦»å¼€æ¥ã€‚æˆ–è€…ï¼Œå¦‚æœæ‚¨æƒ³ç”¨ä¸€ç§å¥‡ç‰¹çš„æ–¹å¼ï¼Œä½¿ç”¨JavaScript ES6/2015æ¨¡å—æˆ–ç±»æ¥æ‰§è¡Œæœ¬åœ°èŒƒå›´ã€‚ ç”¨setupå‡½æ•°åˆå§‹åŒ–æ¸¸æˆåªè¦Hexiå¯åŠ¨ï¼Œå®ƒå°±ä¼šåœ¨ä½ çš„æ¸¸æˆä»£ç ä¸­æŸ¥æ‰¾å¹¶è¿è¡Œä¸€ä¸ªå«setupçš„å‡½æ•°(æˆ–è€…ä½ æƒ³ç»™è¿™ä¸ªå‡½æ•°èµ·çš„å…¶ä»–åå­—)ã€‚setupå‡½æ•°åªè¿è¡Œä¸€æ¬¡ï¼Œå…è®¸æ‚¨ä¸ºæ‚¨çš„æ¸¸æˆæ‰§è¡Œä¸€æ¬¡è®¾ç½®ä»»åŠ¡ã€‚å®ƒæ˜¯åˆ›å»ºå’Œåˆå§‹åŒ–å¯¹è±¡ã€åˆ›å»ºç²¾çµã€æ¸¸æˆåœºæ™¯ã€å¡«å……æ•°æ®æ•°ç»„æˆ–è§£æåŠ è½½çš„JSONæ¸¸æˆæ•°æ®çš„å¥½åœ°æ–¹ã€‚ è¿™æ˜¯ã€Šå¯»å®çŒäººã€‹ä¸­setupå‡½æ•°çš„ç®€è¦é¸Ÿç°è§†å›¾ï¼Œä»¥åŠå®ƒæ‰§è¡Œçš„ä»»åŠ¡ 123456789101112131415function setup() &#123; //Create the `chimes` sound object //Create the `gameScene` group //Create the `exit` door sprite //Create the `player` sprite //Create the `treasure` sprite //Make the enemies //Create the health bar //Add some text for the game over message //Create a `gameOverScene` group //Assign the player's keyboard controllers //set the game state to `play` g.state = play;&#125; æœ€åä¸€è¡Œä»£ç g.state = playå¯èƒ½æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºå®ƒå¯åŠ¨äº†playå‡½æ•°ã€‚playå‡½æ•°åœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿è¡Œæ‰€æœ‰çš„æ¸¸æˆé€»è¾‘ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çœ‹å®ƒå¦‚ä½•å·¥ä½œä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹setupå‡½æ•°ä¸­çš„ç‰¹å®šä»£ç æ˜¯åšä»€ä¹ˆçš„ã€‚ åˆ›å»ºchimeså£°éŸ³å¯¹è±¡ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨æ¸¸æˆä¸­é¢„è£…äº†ä¸€ä¸ªåä¸ºchimes.wavçš„å£°éŸ³æ–‡ä»¶ã€‚åœ¨ä½ å¯ä»¥åœ¨æ¸¸æˆä¸­ä½¿ç”¨å®ƒä¹‹å‰ï¼Œä½ å¿…é¡»ä½¿ç”¨Hexiçš„soundæ–¹æ³•æ¥å¼•ç”¨å®ƒï¼Œæ¯”å¦‚: 1chimes = g.sound(\"sounds/chimes.wav\"); åˆ›å»ºæ¸¸æˆåœºæ™¯Hexiæœ‰ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•å«åšgroupï¼Œå®ƒå¯ä»¥è®©ä½ æŠŠæ¸¸æˆå¯¹è±¡åˆ†ç»„åœ¨ä¸€èµ·ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªå•å…ƒæ¥ä½¿ç”¨ã€‚ç»„ç”¨äºå°†ç§°ä¸º ç²¾çµ çš„ç‰¹æ®Šå¯¹è±¡åˆ†ç»„(æ‚¨å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­äº†è§£è¿™äº›å¯¹è±¡)ã€‚ä½†å®ƒä»¬ä¹Ÿè¢«ç”¨æ¥åˆ¶ä½œæ¸¸æˆåœºæ™¯ã€‚ ã€Šå¯»å®çŒäººã€‹ä½¿ç”¨äº†ä¸¤ä¸ªæ¸¸æˆåœºæ™¯:æ¸¸æˆä¸»æ¸¸æˆgameSceneå’Œæ¸¸æˆç»“æŸæ—¶æ˜¾ç¤ºçš„gameOverSceneã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨groupæ–¹æ³•åˆ¶ä½œgameSceneçš„æ–¹å¼: 1gameScene = g.group(); åˆ›å»ºç»„ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨addChildæ–¹æ³•å‘gameSceneæ·»åŠ ç²¾çµ(æ¸¸æˆå¯¹è±¡)ã€‚ 1gameScene.addChild(anySprite); æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨addæ–¹æ³•ä¸€æ¬¡æ·»åŠ å¤šä¸ªç²¾çµï¼Œå¦‚ä¸‹æ‰€ç¤º: 1gameScene.add(spriteOne, spriteTwo, spriteThree); æˆ–è€…ï¼Œå¦‚æœä½ å–œæ¬¢ï¼Œä½ å¯ä»¥åœ¨ä½ å®Œæˆæ‰€æœ‰çš„ç²¾çµä¹‹ååˆ›å»ºæ¸¸æˆåœºæ™¯ï¼Œç„¶åç”¨ä¸€è¡Œä»£ç å°†æ‰€æœ‰çš„ç²¾çµåˆ†ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1gameScene = g.group(spriteOne, spriteTwp, spriteThree); åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€äº›å¦‚ä½•å‘ç»„æ·»åŠ ç²¾çµçš„ä¸åŒç¤ºä¾‹ã€‚ ä½†æ˜¯ä»€ä¹ˆæ˜¯ç²¾çµï¼Œä½ æ˜¯æ€ä¹ˆåšçš„å‘¢? åˆ¶ä½œç²¾çµç²¾çµæ˜¯ä»»ä½•æ¸¸æˆä¸­æœ€é‡è¦çš„å…ƒç´ ã€‚ç²¾çµåªæ˜¯ä½ å¯ä»¥ç”¨ç‰¹æ®Šå±æ€§æ§åˆ¶çš„å›¾å½¢(å½¢çŠ¶æˆ–å›¾åƒ)ã€‚ä½ èƒ½åœ¨æ¸¸æˆä¸­çœ‹åˆ°çš„ä¸€åˆ‡ï¼Œæ¯”å¦‚æ¸¸æˆè§’è‰²ã€å¯¹è±¡å’ŒèƒŒæ™¯ï¼Œéƒ½æ˜¯ç²¾çµã€‚Hexiå…è®¸ä½ åˆ¶ä½œ5ç§åŸºæœ¬çš„ç²¾çµ:çŸ©å½¢ã€åœ†å½¢ã€ç›´çº¿ã€æ–‡æœ¬å’Œç²¾çµ(åŸºäºå›¾åƒçš„ç²¾çµ)ã€‚ä½ å‡ ä¹å¯ä»¥ç”¨è¿™äº›åŸºæœ¬çš„ç²¾çµç±»å‹åˆ¶ä½œä»»ä½•2DåŠ¨ä½œæ¸¸æˆã€‚(å¦‚æœè¿˜ä¸å¤Ÿï¼Œè¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„è‡ªå®šä¹‰ç²¾çµç±»å‹ã€‚)ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„å®è—çŒäººåªä½¿ç”¨çŸ©å½¢ç²¾çµã€‚ä½ å¯ä»¥åšä¸€ä¸ªè¿™æ ·çš„çŸ©å½¢ç²¾çµ: 123456789let box = g.rectangle( widthInPixels, heightInPixels, \"fillColor\", \"strokeColor\", lineWidth, xPosition, yPosition); ä½ å¯ä»¥ç”¨Hexi circleæ–¹æ³•åšä¸€ä¸ªåœ†å½¢ç²¾çµ: 12345678let ball = g.circle( diameterInPixels, \"fillColor\", \"strokeColor\", lineWidth, xPosition, yPosition); ä»…ä»…ä½¿ç”¨çŸ©å½¢å’Œåœ†å½¢ç²¾çµæ¥è®¾è®¡ä¸€ä¸ªæ–°æ¸¸æˆçš„åŸå‹é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å¸®åŠ©ä½ ä»¥ä¸€ç§çº¯ç²¹çš„ã€åŸºæœ¬çš„æ–¹å¼ä¸“æ³¨äºæ¸¸æˆçš„æœºåˆ¶ã€‚è¿™å°±æ˜¯ã€Šå¯»å®çŒäººã€‹çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸‹é¢æ˜¯åˆ›å»ºå‡ºå£ã€ç©å®¶å’Œå®ç‰©ç²¾çµçš„setupå‡½æ•°çš„ä»£ç ã€‚ 12345678910111213141516171819202122232425262728//The exit doorexit = g.rectangle(48, 48, \"green\");exit.x = 8;exit.y = 8;gameScene.addChild(exit);//The player spriteplayer = g.rectangle(32, 32, \"blue\");player.x = 68;player.y = g.canvas.height / 2 - player.halfHeight;gameScene.addChild(player);//Create the treasuretreasure = g.rectangle(16, 16, \"gold\");//Position it next to the left edge of the canvastreasure.x = g.canvas.width - treasure.width - 10;treasure.y = g.canvas.height / 2 - treasure.halfHeight;//Alternatively, you could use Ga's built in convience method//called `putCenter` to postion the sprite like this://g.stage.putCenter(treasure, 208, 0);//åœ¨å®è—ä¸Šåˆ›å»ºä¸€ä¸ªâ€œpickedUpâ€å±æ€§ï¼Œå¸®åŠ©æˆ‘ä»¬å¼„æ¸…æ¥šè¿™ä¸ªå®è—æ˜¯å¦è¢«ç©å®¶æ¡èµ°äº†treasure.pickedUp = false;//Add the treasure to the `gameScene`gameScene.addChild(treasure); æ³¨æ„ï¼Œåœ¨åˆ›å»ºæ¯ä¸ªç²¾çµä¹‹åï¼Œéƒ½ä½¿ç”¨addChildå°†å…¶æ·»åŠ åˆ°gameSceneä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸Šè¿°ä»£ç äº§ç”Ÿçš„ç»“æœ: è®©æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£è¿™äº›ç²¾çµæ˜¯å¦‚ä½•å®šä½åœ¨ç”»å¸ƒä¸Šçš„ã€‚ å®šä½ç²¾çµæ‰€æœ‰ç²¾çµéƒ½æœ‰xå’Œyå±æ€§ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥ç²¾ç¡®åœ°å®šä½ç”»å¸ƒä¸Šçš„ç²¾çµã€‚xå’Œyå€¼æŒ‡çš„æ˜¯ç›¸å¯¹äºç”»å¸ƒå·¦ä¸Šè§’çš„ç²¾çµåƒç´ åæ ‡ã€‚å·¦ä¸Šè§’çš„xå’Œyå€¼ä¸º0ã€‚è¿™æ„å‘³ç€ä½ ç»™ç²¾çµèµ‹å€¼çš„ä»»ä½•æ­£çš„xå’Œyå€¼ä¼šå°†å®ƒä»¬ä¸é‚£ä¸ªè§’ç‚¹çš„ä½ç½®åˆ†åˆ«æ”¾åœ¨å·¦è¾¹(x)å’Œä¸‹é¢(y)ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ä½ç½®åœ¨å‡ºå£é—¨(ç»¿è‰²æ–¹å—)çš„ä»£ç ã€‚ 12exit.x = 8;exit.y = 8; æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç å°†é—¨è®¾ç½®ä¸ºå³8åƒç´ ï¼Œåœ¨ç”»å¸ƒå·¦ä¸Šè§’ä»¥ä¸‹8åƒç´ ã€‚æ­£xå€¼å°†ç²¾çµå®šä½åœ¨ç”»å¸ƒå·¦è¾¹ç¼˜çš„å³è¾¹ã€‚æ­£yå€¼å°†å®ƒä»¬æ”¾ç½®åœ¨ç”»å¸ƒçš„ä¸Šè¾¹ç¼˜ä»¥ä¸‹ã€‚ ç²¾çµä¹Ÿæœ‰widthå’Œheightå±æ€§ï¼Œä»¥åƒç´ ä¸ºå•ä½å‘Šè¯‰ä½ å®ƒä»¬çš„å®½åº¦å’Œé«˜åº¦ã€‚å¦‚æœä½ æƒ³çŸ¥é“ç²¾çµçš„ä¸€åŠå®½åº¦æˆ–ä¸€åŠé«˜åº¦æ˜¯å¤šå°‘ï¼Œå¯ä»¥ä½¿ç”¨halfWidthå’ŒhalfHeightã€‚ Hexiä¹Ÿæœ‰ä¸€äº›æ–¹ä¾¿çš„æ–¹æ³•ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½ç²¾çµç›¸å¯¹äºå…¶ä»–ç²¾çµçš„ä½ç½®:putTopã€putRightã€putBottomã€putLeftå’ŒputCenterã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä½äºå®è—ç²¾çµ(é»„é‡‘ç›’)ä¸Šé¢çš„ä»£ç è¡Œã€‚ä»£ç å°†å®è—æ”¾ç½®åœ¨ç”»å¸ƒå³è¾¹ç¼˜å·¦è¾¹çš„26åƒç´ å¤„ï¼Œå¹¶å°†å…¶å‚ç›´å±…ä¸­ã€‚ 12treasure.x = g.canvas.width - treasure.width - 10;treasure.y = g.canvas.height / 2 - treasure.halfHeight; è¿™æ˜¯ä¸€å¤§å †å¤æ‚çš„å®šä½ä»£ç ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Hexiçš„å†…ç½®putCenteræ–¹æ³•æ¥å®ç°åŒæ ·çš„æ•ˆæœ: 1g.stage.putCenter(treasure, 220, 0); (stage)èˆå° æ˜¯ä»€ä¹ˆ?å®ƒæ˜¯æ‰€æœ‰ç²¾çµçš„æ ¹å®¹å™¨ï¼Œä¸ç”»å¸ƒçš„å°ºå¯¸å®Œå…¨ç›¸åŒã€‚ä½ å¯ä»¥æŠŠèˆå°æƒ³è±¡æˆä¸€ä¸ªå·¨å¤§çš„ã€çœ‹ä¸è§çš„ç²¾çµï¼Œå’Œç”»å¸ƒä¸€æ ·å¤§ï¼Œå®ƒåŒ…å«äº†æ¸¸æˆä¸­çš„æ‰€æœ‰ç²¾çµï¼Œä»¥åŠé‚£äº›ç²¾çµå¯èƒ½è¢«åˆ†ç»„çš„ä»»ä½•å®¹å™¨(æ¯”å¦‚gameScene)ã€‚putCenterçš„å·¥ä½œåŸç†æ˜¯å°†å®ç‰©æ”¾åœ¨èˆå°ä¸­å¿ƒï¼Œç„¶åå°†å…¶xä½ç½®åç§»220åƒç´ ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨putCenterçš„æ ¼å¼: 1anySprite.putCenter(anyOtherSprite, xOffset, yOffset); æ‚¨å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼ä½¿ç”¨å…¶ä»–putæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³å°†ä¸€ä¸ªç²¾çµç›´æ¥å®šä½åˆ°å¦ä¸€ä¸ªç²¾çµçš„å·¦è¾¹ï¼Œè€Œæ²¡æœ‰ä»»ä½•åç§»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨putLeftï¼Œå¦‚ä¸‹æ‰€ç¤º: 1spriteOne.putLeft(spriteTwo); è¿™å°†æŠŠspriteTwoç›´æ¥æ”¾åœ¨spriteOneçš„å·¦è¾¹ï¼Œå¹¶å‚ç›´å¯¹é½å®ƒã€‚ åˆ†é…åŠ¨æ€å±æ€§åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæ‚¨éœ€è¦æ³¨æ„ä¸€ä¸ªå°ç»†èŠ‚ã€‚åˆ›å»ºç²¾çµçš„ä»£ç è¿˜å‘å®è—ç²¾çµæ·»åŠ äº†ä¸€ä¸ªpickedUpå±æ€§: 1treasure.pickedUp = false; æ‚¨å°†çœ‹åˆ°æˆ‘ä»¬å°†å¦‚ä½•åœ¨æ¸¸æˆé€»è¾‘ä¸­ä½¿ç”¨treasure.pickedUpï¼Œä»¥å¸®åŠ©æˆ‘ä»¬ç¡®å®šæ¸¸æˆçš„è¿›åº¦ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥åŠ¨æ€åœ°å°†ä»»ä½•è‡ªå®šä¹‰å±æ€§æˆ–æ–¹æ³•åˆ†é…ç»™è¿™æ ·çš„ç²¾çµã€‚ åˆ›å»ºæ•Œäººç²¾çµå¯»å®æ¸¸æˆä¸­æœ‰6ä¸ªæ•Œäººç²¾çµ(çº¢è‰²æ–¹å—)ã€‚å®ƒä»¬æ°´å¹³é—´éš”ï¼Œä½†æœ‰éšæœºçš„åˆå§‹å‚ç›´ä½ç½®ã€‚æ‰€æœ‰çš„æ•Œäººç²¾çµéƒ½æ˜¯åœ¨ä¸€ä¸ªforå¾ªç¯ä¸­ä½¿ç”¨è¿™ä¸ªä»£ç åœ¨setupå‡½æ•°ä¸­åˆ›å»ºçš„: 12345678910111213141516171819202122232425262728293031323334353637383940414243//Make the enemieslet numberOfEnemies = 6, spacing = 48, xOffset = 150, speed = 2, direction = 1;//An array to store all the enemiesenemies = [];//Make as many enemies as there are `numberOfEnemies`for (let i = 0; i &lt; numberOfEnemies; i++) &#123; //Each enemy is a red rectangle let enemy = g.rectangle(32, 32, \"red\"); //Space each enemey horizontally according to the `spacing` value. //`xOffset` determines the point from the left of the screen //at which the first enemy should be added. let x = spacing * i + xOffset; //Give the enemy a random y position let y = g.randomInt(0, g.canvas.height - enemy.height); //Set the enemy's direction enemy.x = x; enemy.y = y; //Set the enemy's vertical velocity. `direction` will be either `1` or //`-1`. `1` means the enemy will move down and `-1` means the enemy will //move up. Multiplying `direction` by `speed` determines the enemy's //vertical direction enemy.vy = speed * direction; //Reverse the direction for the next enemy direction *= -1; //Push the enemy into the `enemies` array enemies.push(enemy); //Add the enemy to the `gameScene` gameScene.addChild(enemy);&#125; è¿™æ®µä»£ç äº§ç”Ÿçš„ç»“æœå¦‚ä¸‹: ä»£ç é€šè¿‡Hexiçš„randomIntæ–¹æ³•ç»™æ¯ä¸ªæ•Œäººä¸€ä¸ªéšæœºçš„yä½ç½®: 1let y = g.randomInt(0, g.canvas.height - enemy.height); randomIntå°†ç»™å‡ºå‚æ•°ä¸­æä¾›çš„ä»»æ„ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„éšæœºæ•°ã€‚(å¦‚æœä½ éœ€è¦ä¸€ä¸ªéšæœºå°æ•°ï¼Œå¯ä»¥ä½¿ç”¨randomFloatæ¥ä»£æ›¿)ã€‚ æ‰€æœ‰çš„ç²¾çµéƒ½æœ‰ç§°ä¸ºvxå’Œvyçš„å±æ€§ã€‚å®ƒä»¬å†³å®šäº†ç²¾çµåœ¨æ°´å¹³æ–¹å‘(vx)å’Œå‚ç›´æ–¹å‘(vy)ç§»åŠ¨çš„é€Ÿåº¦å’Œæ–¹å‘ã€‚ã€Šå¯»å®äººã€‹ä¸­çš„æ•Œäººåªæ˜¯ä¸Šä¸‹ç§»åŠ¨ï¼Œæ‰€ä»¥ä»–ä»¬åªéœ€è¦ä¸€ä¸ªvyå€¼ã€‚å®ƒä»¬çš„vyæ˜¯é€Ÿåº¦(2)ä¹˜ä»¥æ–¹å‘(1æˆ–-1) 1enemy.vy = speed * direction; å¦‚æœæ–¹å‘æ˜¯1ï¼Œæ•Œäººçš„vyå°±æ˜¯2ã€‚è¿™æ„å‘³ç€æ•Œäººå°†ä»¥æ¯å¸§2åƒç´ çš„é€Ÿåº¦ç§»åŠ¨å±å¹•ã€‚å¦‚æœæ–¹å‘æ˜¯-1ï¼Œæ•Œäººçš„é€Ÿåº¦æ˜¯-2ã€‚è¿™æ„å‘³ç€æ•Œäººå°†ä»¥æ¯å¸§2åƒç´ çš„é€Ÿåº¦åœ¨å±å¹•ä¸Šç§»åŠ¨ã€‚ å½“æ•Œäººçš„vyè¢«è®¾ç½®å¥½åï¼Œæ–¹å‘å°±ä¼šé¢ å€’ï¼Œè¿™æ ·ä¸‹ä¸€ä¸ªæ•Œäººå°±ä¼šæœç›¸åçš„æ–¹å‘ç§»åŠ¨ 1direction *= -1; æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºçš„æ¯ä¸ªæ•Œäººéƒ½è¢«æ¨è¿›åˆ°ä¸€ä¸ªç§°ä¸ºenemiesçš„æ•°ç»„ä¸­ 1enemies.push(enemy); åœ¨åé¢çš„ä»£ç ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°æˆ‘ä»¬å°†å¦‚ä½•è®¿é—®è¿™ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰æ•Œäººï¼Œä»¥ç¡®å®šä»–ä»¬æ˜¯å¦æ­£åœ¨è§¦æ‘¸æ’­æ”¾å™¨ã€‚ å¥åº·æ¡ä½ ä¼šæ³¨æ„åˆ°å½“ç©å®¶è§¦ç¢°åˆ°ä¸€ä¸ªæ•Œäººæ—¶ï¼Œå±å¹•å³ä¸Šè§’çš„å¥åº·æ¡çš„å®½åº¦ä¼šå‡å°ã€‚ è¿™ä¸ªå¥åº·æ¡æ˜¯æ€ä¹ˆåšçš„?å®ƒåªæ˜¯ä¸¤ä¸ªç›¸åŒä½ç½®çš„çŸ©å½¢ç²¾çµ:ä¸€ä¸ªé»‘è‰²çš„çŸ©å½¢åœ¨åé¢ï¼Œä¸€ä¸ªç»¿è‰²çš„çŸ©å½¢åœ¨å‰é¢ã€‚å®ƒä»¬è¢«ç»„åˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªå«åšhealthBarçš„å•ä¸€åŒ–åˆç‰©spriteã€‚ç„¶åå°†å¥åº·æ¡æ·»åŠ åˆ°gameSceneä¸­ã€‚ 12345678910111213141516//Create the health barlet outerBar = g.rectangle(128, 16, \"black\"), innerBar = g.rectangle(128, 16, \"yellowGreen\");//Group the inner and outer barshealthBar = g.group(outerBar, innerBar);//Set the `innerBar` as a property of the `healthBar`healthBar.inner = innerBar;//Position the health barhealthBar.x = g.canvas.width - 148;healthBar.y = 16;//Add the health bar to the `gameScene`gameScene.addChild(healthBar); æ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸ºinnerçš„å±æ€§è¢«æ·»åŠ åˆ°healthBarã€‚å®ƒåªæ˜¯å¼•ç”¨äº†innerBar(ç»¿è‰²çŸ©å½¢)ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥æ–¹ä¾¿åœ°è®¿é—®å®ƒã€‚ 1healthBar.inner = innerBar; ä½ ä¸éœ€è¦è¿™ä¹ˆåš;ä½†æ˜¯,å˜¿,ä¸ºä»€ä¹ˆä¸å‘¢!è¿™æ„å‘³ç€å¦‚æœä½ æƒ³æ§åˆ¶å†…æ çš„å®½åº¦ï¼Œä½ å¯ä»¥å†™ä¸€äº›æµç•…çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1healthBar.inner.width = 30; è¿™æ˜¯ç›¸å½“æ•´æ´å’Œå¯è¯»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¿æŒå®ƒ! æ¸¸æˆç»“æŸçš„åœºæ™¯å¦‚æœç©å®¶çš„ç”Ÿå‘½å€¼é™è‡³é›¶ï¼Œæˆ–è€…ç©å®¶è®¾æ³•å°†å®ç‰©å¸¦åˆ°å‡ºå£ï¼Œæ¸¸æˆç»“æŸï¼Œæ¸¸æˆåœ¨å±å¹•ä¸Šæ˜¾ç¤ºã€‚ç°åœºæ¸¸æˆåªæ˜¯æ˜¾ç¤ºâ€œä½ èµ¢äº†â€æˆ–â€œä½ è¾“äº†â€çš„ä¸€äº›æ–‡æœ¬ï¼Œè¿™å–å†³äºç»“æœã€‚ è¿™ä½¿å¾—æ€ä¹ˆæ ·?æ–‡æœ¬ç”±æ–‡æœ¬ç²¾çµæ„æˆã€‚ 123let anyText = g.text( \"Hello!\", \"CSS font properties\", \"fillColor\", xPosition, yPosition); åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°â€œHello!â€æ˜¯è¦æ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹ã€‚ä½¿ç”¨contentå±æ€§ç¨åæ›´æ”¹æ–‡æœ¬ç²¾çµçš„å†…å®¹ã€‚ 1anyText.content = \"Some new content\"; ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨setupå‡½æ•°ä¸­åˆ›å»ºæ¶ˆæ¯æ–‡æœ¬çš„æ¸¸æˆ 1234//Add some text for the game over messagemessage = g.text(\"Game Over!\", \"64px Futura\", \"black\", 20, 20);message.x = 120;message.y = g.canvas.height / 2 - 64; æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºgameOverSceneçš„æ–°ç»„ã€‚æ¶ˆæ¯æ–‡æœ¬è¢«æ·»åŠ åˆ°å…¶ä¸­ã€‚gameOverSceneçš„å¯è§†å±æ€§è®¾ç½®ä¸ºfalseï¼Œä»¥ä¾¿åœ¨æ¸¸æˆå¼€å§‹æ—¶ä¸å¯è§ã€‚ 1234gameOverScene = g.group(message);//Make the `gameOverScene` invisible for nowgameOverScene.visible = false; åœ¨æ¸¸æˆç»“æŸæ—¶ï¼Œæˆ‘ä»¬å°†è®¾ç½®æ¸¸æˆåœºæ™¯çš„å¯è§å±æ€§ä¸ºtrueä»¥æ˜¾ç¤ºæ–‡æœ¬æ¶ˆæ¯ã€‚æˆ‘ä»¬è¿˜å°†gameSceneçš„å¯è§å±æ€§è®¾ç½®ä¸ºfalseï¼Œä»¥ä¾¿æ‰€æœ‰çš„æ¸¸æˆç²¾çµéƒ½éšè—èµ·æ¥ã€‚ é”®ç›˜äº¤äº’ä½ ç”¨é”®ç›˜ç®­å¤´é”®æ§åˆ¶ç©å®¶(è“è‰²æ–¹å—)ã€‚Hexiæœ‰ä¸€ä¸ªå†…ç½®çš„ç®­å¤´æ§åˆ¶arrowControlæ–¹æ³•ï¼Œè®©æ‚¨å¿«é€Ÿæ·»åŠ ç®­å¤´é”®çš„äº¤äº’æ€§æ¸¸æˆã€‚æä¾›è¦ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ç§»åŠ¨çš„ç²¾çµï¼Œä»¥åŠä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ç§»åŠ¨çš„æ¯å¸§åƒç´ æ•°ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨arrowControlæ–¹æ³•æ¥å¸®åŠ©ç©å®¶åœ¨æŒ‰ä¸‹ç®­å¤´é”®æ—¶æ¯å¸§ç§»åŠ¨5ä¸ªåƒç´ ã€‚ 1g.arrowControl(player, 5); ä½¿ç”¨arrowControlæ˜¯å®ç°é”®ç›˜äº¤äº’æ€§çš„ä¸€ç§ç®€å•è€Œå¿«é€Ÿçš„æ–¹æ³•ï¼Œä½†æ˜¯é€šå¸¸éœ€è¦æ›´å¥½åœ°æ§åˆ¶æŒ‰ä¸‹é”®æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚Hexiæœ‰ä¸€ä¸ªå†…ç½®çš„keyboardæ–¹æ³•ï¼Œä½ å¯ä»¥å®šä¹‰è‡ªå®šä¹‰é”®ã€‚ 1let customKey = g.keyboard(asciiCode); ä¸ºè¦ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä½¿ç”¨çš„é”®æä¾›asciiç å· æ‰€æœ‰è¿™äº›é”®éƒ½æœ‰å¯å®šä¹‰çš„presså’Œreleaseæ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å¯é€‰åœ°åˆ›å»ºå’Œä½¿ç”¨è¿™äº›é”®ç›˜å¯¹è±¡æ¥å¸®åŠ©ç§»åŠ¨å®è—çŒäººä¸­çš„ç©å®¶è§’è‰²ã€‚(æ‚¨å°†åœ¨setupå‡½æ•°ä¸­å®šä¹‰æ­¤ä»£ç ): 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657//Create some keyboard objects using Hexi's `keyboard` method.//You would usually use this code in the `setup` function.//Supply the ASCII key code value as the single argumentlet leftArrow = g.keyboard(37), upArrow = g.keyboard(38), rightArrow = g.keyboard(39), downArrow = g.keyboard(40);//Left arrow key `press` methodleftArrow.press = () =&gt; &#123; //Change the player's velocity when the key is pressed player.vx = -5; player.vy = 0;&#125;;//Left arrow key `release` methodleftArrow.release = () =&gt; &#123; //If the left arrow has been released, and the right arrow isn't down, //and the player isn't moving vertically: //Stop the player if (!rightArrow.isDown &amp;&amp; player.vy === 0) &#123; player.vx = 0; &#125;&#125;;//The up arrowupArrow.press = () =&gt; &#123; player.vy = -5; player.vx = 0;&#125;;upArrow.release = () =&gt; &#123; if (!downArrow.isDown &amp;&amp; player.vx === 0) &#123; player.vy = 0; &#125;&#125;;//The right arrowrightArrow.press = () =&gt; &#123; player.vx = 5; player.vy = 0;&#125;;rightArrow.release = () =&gt; &#123; if (!leftArrow.isDown &amp;&amp; player.vy === 0) &#123; player.vx = 0; &#125;&#125;;//The down arrowdownArrow.press = () =&gt; &#123; player.vy = 5; player.vx = 0;&#125;;downArrow.release = () =&gt; &#123; if (!upArrow.isDown &amp;&amp; player.vx === 0) &#123; player.vy = 0; &#125;&#125;; æ‚¨å¯ä»¥çœ‹åˆ°ç©å®¶çš„vxå’Œvyå±æ€§çš„å€¼æ ¹æ®æŒ‰ä¸‹æˆ–é‡Šæ”¾çš„é”®è€Œæ”¹å˜ã€‚ä¸€ä¸ªæ­£å€¼çš„vxå€¼å°†ä½¿ç©å®¶å‘å³ç§»åŠ¨ï¼Œä¸€ä¸ªè´Ÿå€¼å°†ä½¿ç©å®¶å‘å·¦ç§»åŠ¨ã€‚ä¸€ä¸ªæ­£å€¼çš„vyå€¼ä¼šè®©ç©å®¶å‘ä¸‹ç§»åŠ¨ï¼Œä¸€ä¸ªè´Ÿå€¼ä¼šè®©ç©å®¶å‘ä¸Šç§»åŠ¨ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ§åˆ¶çš„ç²¾çµ:playerã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç²¾çµç§»åŠ¨æ¯ä¸€å¸§çš„åƒç´ æ•°:5ã€‚æœ€åå››ä¸ªå‚æ•°æ˜¯é¡¶é”®ã€å³é”®ã€åº•é”®å’Œå·¦é”®çš„asciiç ã€‚(ä½ å¯ä»¥è®°ä½è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒä»¬çš„é¡ºåºæ˜¯é¡ºæ—¶é’ˆçš„ï¼Œä»é¡¶éƒ¨å¼€å§‹ã€‚) è®¾ç½®æ¸¸æˆçŠ¶æ€æ¸¸æˆçŠ¶æ€ æ˜¯Hexiå½“å‰è¿è¡Œçš„å‡½æ•°ã€‚å½“Hexiç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè¿è¡Œsetupå‡½æ•°(æˆ–è€…ä½ åœ¨Hexiçš„æ„é€ å‡½æ•°å‚æ•°ä¸­æŒ‡å®šçš„å…¶ä»–å‡½æ•°)ã€‚å¦‚æœæ‚¨æƒ³è¦æ›´æ”¹æ¸¸æˆçŠ¶æ€ï¼Œè¯·ä¸ºHexiçš„çŠ¶æ€å±æ€§åˆ†é…ä¸€ä¸ªæ–°å‡½æ•°ã€‚æ–¹æ³•å¦‚ä¸‹: 1g.state = anyFunction; åœ¨ã€Šå¯»å®æ¸¸æˆã€‹ä¸­ï¼Œå½“è®¾ç½®åŠŸèƒ½å®Œæˆåï¼Œæ¸¸æˆçŠ¶æ€è®¾ç½®ä¸º: 1g.state = play; è¿™ä½¿å¾—HexiæŸ¥æ‰¾å¹¶è¿è¡Œä¸€ä¸ªå«åšplayçš„å‡½æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ†é…ç»™æ¸¸æˆçŠ¶æ€çš„ä»»ä½•å‡½æ•°éƒ½å°†ä»¥æ¯ç§’60å¸§çš„é€Ÿåº¦è¿ç»­å¾ªç¯è¿è¡Œã€‚(æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®Hexiçš„fpså±æ€§éšæ—¶æ”¹å˜å¸§é€Ÿç‡)ã€‚æ¸¸æˆé€»è¾‘é€šå¸¸åœ¨ä¸€ä¸ªè¿ç»­å¾ªç¯ä¸­è¿è¡Œï¼Œè¿™å°±æ˜¯æ¸¸æˆå¾ªç¯ã€‚Hexiä¸ºæ‚¨å¤„ç†å¾ªç¯ç®¡ç†ï¼Œæ‰€ä»¥æ‚¨ä¸å¿…æ‹…å¿ƒå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ (å¦‚æœæ‚¨å¥½å¥‡ï¼ŒHexiä½¿ç”¨ä¸€ä¸ªrequestAnimationFrameå¾ªç¯ï¼Œå®ƒå…·æœ‰ä¸€ä¸ªå›ºå®šçš„é€»è¾‘æ—¶é—´æ­¥é•¿å’Œå¯å˜æ¸²æŸ“æ—¶é—´ã€‚å®ƒä¹Ÿåšé›ªç¢§ä½ç½®æ’å€¼ï¼Œä»¥æ¶ˆé™¤ä»»ä½•ä¸ä¸€è‡´çš„å³°å€¼åœ¨å¸§ç‡ã€‚å®ƒè¿è¡Œçš„æ˜¯ç§˜å¯†çš„å†°æ²™ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨å®ƒçš„ä»»ä½•å±æ€§æ¥è°ƒæ•´ä½ çš„Hexiåº”ç”¨æ¸¸æˆå¾ªç¯ä»¥è·å¾—æœ€å¥½çš„æ•ˆæœã€‚ å¦‚æœæ‚¨éœ€è¦æš‚åœå¾ªç¯ï¼Œåªéœ€ä½¿ç”¨Hexiçš„æš‚åœæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1g.pause(); æ‚¨å¯ä»¥ä½¿ç”¨resumeæ–¹æ³•å†æ¬¡å¯åŠ¨æ¸¸æˆå¾ªç¯ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1g.resume(); ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®è—çŒäººçš„æ¸¸æˆåŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æ¸¸æˆé€»è¾‘ä¸playå‡½æ•°å¾ªç¯æ­£å¦‚æ‚¨åˆšåˆšå­¦åˆ°çš„ï¼Œplayå‡½æ•°ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯åœ¨ä¸€ä¸ªè¿ç»­å¾ªç¯ä¸­è¿è¡Œçš„ã€‚ 123function play() &#123; //This code loops from top to bottom 60 times per second &#125; è¿™å°±æ˜¯æ‰€æœ‰æ¸¸æˆé€»è¾‘å‘ç”Ÿçš„åœ°æ–¹ã€‚è¿™æ˜¯æœ‰è¶£çš„éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹playå‡½æ•°ä¸­çš„ä»£ç æ˜¯åšä»€ä¹ˆçš„ã€‚ ç§»åŠ¨ç©å®¶ç²¾çµå¯»å®è€…åœ¨æ¸¸æˆä¸­ä½¿ç”¨Hexiçš„moveæ–¹æ³•æ¥ç§»åŠ¨ç²¾çµã€‚ 1g.move(player); è¿™ç›¸å½“äºè¿™æ ·å†™ä»£ç : 12player.x += player.vx;player.y += player.vy; å®ƒé€šè¿‡æ·»åŠ vxå’Œvyé€Ÿåº¦å€¼æ¥æ›´æ–°ç©å®¶çš„xå’Œyä½ç½®ã€‚ä½¿ç”¨moveå¯ä»¥çœå»è¾“å…¥å’ŒæŸ¥çœ‹è¿™ä¸ªæ ‡å‡†çš„æ ·æ¿ä»£ç çš„éº»çƒ¦ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡æä¾›æ•°ç»„ä½œä¸ºå‚æ•°æ¥ç§»åŠ¨ä¸€ä¸ªå®Œæ•´çš„ç²¾çµæ•°ç»„ã€‚ 1g.move(arrayOfSprites); ç°åœ¨ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç§»åŠ¨ç©å®¶ï¼Œä½†æ˜¯å½“ç©å®¶åˆ°è¾¾å±å¹•è¾¹ç¼˜æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ? åŒ…å«å±å¹•è¾¹ç•Œå†…çš„ç²¾çµä½¿ç”¨Hexiâ€™s containsæ–¹æ³•å°†ç²¾çµä¿æŒåœ¨å±å¹•çš„è¾¹ç•Œå†… 1g.contain(player, g.stage); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦åŒ…å«çš„ç²¾çµï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»»ä½•å¸¦æœ‰xã€yã€widthå’Œheightå±æ€§çš„JavaScriptå¯¹è±¡ã€‚ å¦‚å‰æ‰€è¿°ï¼Œstageæ˜¯æ‰€æœ‰æ²³è¥¿ç²¾çµçš„æ ¹å®¹å™¨å¯¹è±¡ï¼Œå®ƒçš„å®½åº¦å’Œé«˜åº¦ä¸ç”»å¸ƒç›¸åŒ ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡æ¥æä¾›åŒ…å«æ–¹æ³•ï¼Œä»¥æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚æ–¹æ³•å¦‚ä¸‹: 123456789g.contain( player, &#123; x: 0, y: 0, width: 512, height: 512 &#125;); è¿™å°†åŒ…å«ç©å®¶ç²¾çµåˆ°ç”±å¯¹è±¡çš„ç»´åº¦å®šä¹‰çš„åŒºåŸŸã€‚å¦‚æœæ‚¨æƒ³ç²¾ç¡®åœ°è°ƒæ•´å¯¹è±¡åº”è¯¥åŒ…å«çš„åŒºåŸŸï¼Œè¿™å°†éå¸¸æ–¹ä¾¿ã€‚ containæœ‰ä¸€ä¸ªç‰¹åˆ«æœ‰ç”¨çš„ç‰¹æ€§ã€‚å¦‚æœç²¾çµåˆ°è¾¾ä¸€ä¸ªåŒ…å«è¾¹ï¼Œcontainså°†è¿”å›ä¸€ä¸ªJavaScripté›†ï¼Œå‘Šè¯‰æ‚¨å®ƒåˆ°è¾¾äº†å“ªä¸ªè¾¹:â€œtopâ€ã€â€œrightâ€ã€â€œbottomâ€æˆ–â€œleftâ€ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¥æ‰¾å‡ºç²¾çµåœ¨ç”»å¸ƒä¸Šè§¦ç¢°çš„è¾¹ç¼˜: 1234567891011121314let playerHitsEdges = g.contain(player, g.stage);if(playerHitsEdges) &#123; //Find out on which side the collision happened let collisionSide; if (playerHitsEdges.has(\"left\")) collisionSide = \"left\"; if (playerHitsEdges.has(\"right\")) collisionSide = \"right\"; if (playerHitsEdges.has(\"top\")) collisionSide = \"top\"; if (playerHitsEdges.has(\"bottom\")) collisionSide = \"bottom\"; //Display the result in a text sprite message.content = `The player hit the $&#123;collisionSide&#125; of the canvas`; &#125; ä¸æ•Œäººç¢°æ’å½“ç©å®¶æ”»å‡»è¢«ä»»ä½•ä¸€ä¸ªæ•Œäººæ—¶ï¼Œå¥åº·æ çš„å®½åº¦ä¼šå‡å°‘ï¼Œç©å®¶ä¼šå˜æˆåŠé€æ˜çš„ã€‚ è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?Hexiæœ‰ä¸€æ•´å¥—æœ‰ç”¨çš„äºŒç»´å‡ ä½•å’ŒåŸºäºç“·ç –çš„ç¢°æ’æ£€æµ‹æ–¹æ³•ã€‚Hexiå®ç°äº†Bumpç¢°æ’æ¨¡å—ï¼Œæ‰€ä»¥Bumpçš„æ‰€æœ‰ç¢°æ’æ–¹æ³•éƒ½å’ŒHexiä¸€èµ·å·¥ä½œã€‚ å¯»å®æ¸¸æˆåªä½¿ç”¨å…¶ä¸­ä¸€ç§ç¢°æ’æ–¹æ³•: hitTestRectangleã€‚å®ƒç”¨ä¸¤ä¸ªçŸ©å½¢çš„ç²¾çµå‘Šè¯‰ä½ å®ƒä»¬æ˜¯å¦é‡å ã€‚å¦‚æœæ˜¯ï¼Œå®ƒå°†è¿”å›true;å¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å›falseã€‚ 1g.hitTestRectangle(spriteOne, spriteTwo); ä¸‹é¢æ˜¯playå‡½æ•°ä¸­çš„ä»£ç å¦‚ä½•ä½¿ç”¨hitTestRectangleæ£€æŸ¥ä»»ä½•æ•Œäººå’Œç©å®¶ä¹‹é—´çš„å†²çªã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940//Set `playerHit` to `false` before checking for a collisionlet playerHit = false;//Loop through all the sprites in the `enemies` arrayenemies.forEach(enemy =&gt; &#123; //Move the enemy g.move(enemy); //Check the enemy's screen boundaries let enemyHitsEdges = g.contain(enemy, g.stage); //If the enemy hits the top or bottom of the stage, reverse //its direction if (enemyHitsEdges) &#123; if (enemyHitsEdges.has(\"top\") || enemyHitsEdges.has(\"bottom\")) &#123; enemy.vy *= -1; &#125; &#125; //Test for a collision. If any of the enemies are touching //the player, set `playerHit` to `true` if (g.hitTestRectangle(player, enemy)) &#123; playerHit = true; &#125;&#125;);//If the player is hit...if (playerHit) &#123; //Make the player semi-transparent player.alpha = 0.5; //Reduce the width of the health bar's inner rectangle by 1 pixel healthBar.inner.width -= 1;&#125; else &#123; //Make the player fully opaque (non-transparent) if it hasn't been hit player.alpha = 1;&#125; è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªåä¸ºplayerHitçš„å˜é‡ï¼Œè¯¥å˜é‡åœ¨forEachå¾ªç¯æ£€æŸ¥æ‰€æœ‰æ•Œäººæ˜¯å¦å‘ç”Ÿå†²çªä¹‹å‰è¢«åˆå§‹åŒ–ä¸ºfalseã€‚ 1let playerHit = false; (å› ä¸ºplayå‡½æ•°æ¯ç§’è¿è¡Œ60æ¬¡ï¼Œæ‰€ä»¥playerHitåœ¨æ¯ä¸ªæ–°å¸§ä¸­å°†è¢«é‡æ–°åˆå§‹åŒ–ä¸ºfalse) å¦‚æœhitTestRectangleè¿”å›true, forEachå¾ªç¯å°†playerHitè®¾ç½®ä¸ºtrue 123if(g.hitTestRectangle(player, enemy)) &#123; playerHit = true;&#125; å¦‚æœç©å®¶è¢«å‡»ä¸­ï¼Œä»£ç ä¼šå°†alphaå€¼è®¾ç½®ä¸º0.5ï¼Œä½¿ç©å®¶åŠé€æ˜ã€‚å®ƒè¿˜å¯ä»¥å°†healthBarçš„å†…éƒ¨ç²¾çµçš„å®½åº¦å‡å°‘1åƒç´ ã€‚ 12345678910111213if(playerHit) &#123; //Make the player semi-transparent player.alpha = 0.5; //Reduce the width of the health bar's inner rectangle by 1 pixel healthBar.inner.width -= 1;&#125; else &#123; //Make the player fully opaque (non-transparent) if it hasn't been hit player.alpha = 1;&#125; æ‚¨å¯ä»¥å°†ç²¾çµçš„alphaå±æ€§è®¾ç½®ä¸º0(å®Œå…¨é€æ˜)åˆ°1(å®Œå…¨ä¸é€æ˜)ä¹‹é—´çš„ä»»ä½•å€¼ã€‚0.5çš„å€¼ä½¿å®ƒæˆä¸ºåŠé€æ˜ (Alphaæ˜¯ä¸€ä¸ªä¹…ç»è€ƒéªŒçš„å¹³é¢è®¾è®¡æœ¯è¯­ï¼Œåªæ„å‘³ç€é€æ˜) è¿™æ®µä»£ç è¿˜ä½¿ç”¨moveæ–¹æ³•æ¥ç§»åŠ¨æ•Œäººï¼Œå¹¶åŒ…å«åœ¨ç”»å¸ƒä¸­ã€‚ä»£ç è¿˜ä½¿ç”¨containçš„è¿”å›å€¼æ¥ç¡®å®šæ•Œäººæ˜¯åœ¨æ”»å‡»ç”»å¸ƒçš„é¡¶éƒ¨è¿˜æ˜¯åº•éƒ¨ã€‚å¦‚æœå®ƒå‡»ä¸­é¡¶éƒ¨æˆ–åº•éƒ¨ï¼Œæ•Œäººçš„æ–¹å‘ä¼šåœ¨ä»¥ä¸‹ä»£ç çš„å¸®åŠ©ä¸‹é¢ å€’: 12345678910//Check the enemy's screen boundarieslet enemyHitsEdges = g.contain(enemy, g.stage);//If the enemy hits the top or bottom of the stage, reverse//its directionif (enemyHitsEdges) &#123; if (enemyHitsEdges.has(\"top\") || enemyHitsEdges.has(\"bottom\")) &#123; enemy.vy *= -1; &#125;&#125; å°†æ•Œäººçš„vy(å‚ç›´é€Ÿåº¦)å€¼ä¹˜ä»¥- 1ä¼šä½¿å®ƒæœç›¸åçš„æ–¹å‘å‰è¿›ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åå¼¹æ•ˆåº”ã€‚ ç¢°æ’çš„å®è—å¦‚æœç©å®¶è§¦æ‘¸åˆ°å®è—(é»„è‰²æ–¹å—)ï¼Œé’Ÿå£°å°±ä¼šå“èµ·ã€‚ç„¶åç©å®¶å¯ä»¥æŠŠå®ç‰©å¸¦åˆ°å‡ºå£ã€‚å®è—é›†ä¸­åœ¨ç©å®¶èº«ä¸Šï¼Œå¹¶éšä¹‹ç§»åŠ¨ã€‚ è¿™æ˜¯playå‡½æ•°å®ç°è¿™äº›æ•ˆæœçš„ä»£ç  123456789101112131415//Check for a collision between the player and the treasureif (g.hitTestRectangle(player, treasure)) &#123; //If the treasure is touching the player, center it over the player treasure.x = player.x + 8; treasure.y = player.y + 8; if(!treasure.pickedUp) &#123; //If the treasure hasn't already been picked up, //play the `chimes` sound chimes.play(); treasure.pickedUp = true; &#125;;&#125; æ‚¨å¯ä»¥çœ‹åˆ°ä»£ç åœ¨ifè¯­å¥ä¸­ä½¿ç”¨hitTestRectangleæ¥æµ‹è¯•ç©å®¶å’Œå®è—ä¹‹é—´çš„å†²çª 1if (g.hitTestRectangle(player, treasure)) &#123; å¦‚æœè¿™æ˜¯çœŸçš„ï¼Œå®è—å°±é›†ä¸­åœ¨ç©å®¶èº«ä¸Š 12treasure.x = player.x + 8;treasure.y = player.y + 8; å¦‚æœtreasure.pickedUpæ˜¯falseï¼Œé‚£ä¹ˆä½ çŸ¥é“å®è—è¿˜æ²¡æœ‰è¢«å–èµ°ï¼Œä½ å¯ä»¥æ’­æ”¾é’Ÿå£°: 1chimes.play(); é™¤äº†æ’­æ”¾Hexiçš„å£°éŸ³å¯¹è±¡ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨æ›´å¤šçš„æ–¹æ³•æ¥æ§åˆ¶å®ƒä»¬:æš‚åœã€é‡æ–°å¯åŠ¨å’Œæ’­æ”¾ã€‚(ä½¿ç”¨playFromä»å£°éŸ³æ–‡ä»¶ä¸­çš„ç‰¹å®šç§’å¼€å§‹æ’­æ”¾å£°éŸ³ï¼Œå¦‚:soundObject.playFrom(5)ã€‚è¿™å°†ä½¿å£°éŸ³ä»5ç§’å¼€å§‹æ’­æ”¾ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨0å’Œ1ä¹‹é—´åˆ†é…å€¼æ¥è®¾ç½®å£°éŸ³å¯¹è±¡çš„éŸ³é‡ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å°†éŸ³é‡è®¾ç½®ä¸ºä¸­ç­‰(50%)ã€‚ 1soundObject.volume = 0.5; æ‚¨å¯ä»¥é€šè¿‡å°†-1(å·¦æ‰¬å£°å™¨)å€¼è®¾ç½®ä¸º1(å³æ‰¬å£°å™¨)æ¥è®¾ç½®å£°éŸ³å¯¹è±¡çš„panã€‚æ³›éŸ³å€¼ä¸º0æ—¶ï¼Œä¸¤ä¸ªæ‰¬å£°å™¨çš„éŸ³é‡éƒ½ç›¸ç­‰ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å°†panè®¾ç½®ä¸ºåœ¨å·¦æ‰¬å£°å™¨ä¸­ç¨å¾®çªå‡ºä¸€äº›ã€‚ 1soundObject.pan = -0.2; å¦‚æœæ‚¨æƒ³è¦ä½¿ä¸€ä¸ªå£°éŸ³è¿ç»­é‡å¤ï¼Œè¯·å°†å…¶loopå±æ€§è®¾ç½®ä¸ºtrueã€‚ 1soundObject.loop = true; Hexiå®ç°äº†Sound.jsæ¨¡å—æ¥æ§åˆ¶å£°éŸ³ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨Hexiåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨Sound.jsçš„ä»»ä½•å±æ€§å’Œæ–¹æ³•ã€‚ å› ä¸ºæ‚¨ä¸æƒ³åœ¨æ‹¾å–å®è—åå†æ’­æ”¾ä¸€æ¬¡é’Ÿå£°ï¼Œæ‰€ä»¥ä»£ç åœ¨å£°éŸ³æ’­æ”¾åå°†treasure.pickedUpè®¾ç½®ä¸ºtrueã€‚ 1treasure.pickedUp = true; ç°åœ¨ç©å®¶æ‹¿èµ·äº†å®ç‰©ï¼Œä½ æ€ä¹ˆèƒ½æ£€æŸ¥æ¸¸æˆçš„ç»“å±€å‘¢? ç»“æŸæ¸¸æˆæ¸¸æˆæœ‰ä¸¤ç§ç»“å±€ã€‚ç©å®¶çš„å¥åº·çŠ¶å†µå¯èƒ½ä¼šè€—å°½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯”èµ›å°±ä¼šå¤±è´¥ã€‚æˆ–è€…ï¼Œç©å®¶å¯ä»¥æˆåŠŸåœ°æŠŠå®ç‰©å¸¦åˆ°å‡ºå£ï¼Œè¿™æ ·æ¸¸æˆå°±èµ¢äº†ã€‚å¦‚æœæ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ¸¸æˆçš„çŠ¶æ€å°†è¢«è®¾ç½®ä¸ºç»“æŸï¼Œæ¶ˆæ¯æ–‡æœ¬çš„å†…å®¹å°†æ˜¾ç¤ºç»“æœã€‚ä¸‹é¢æ˜¯playå‡½æ•°ä¸­çš„æœ€åä¸€æ®µä»£ç : 12345678910111213//Does the player have enough health? If the width of the `innerBar`//is less than zero, end the game and display \"You lost!\"if (healthBar.inner.width &lt; 0) &#123; g.state = end; message.content = \"You lost!\";&#125;//If the player has brought the treasure to the exit,//end the game and display \"You won!\"if (g.hitTestRectangle(treasure, exit)) &#123; g.state = end; message.content = \"You won!\";&#125; ç»“æŸå‡½æ•°éå¸¸ç®€å•ã€‚å®ƒåªæ˜¯éšè—äº†gameSceneå¹¶æ˜¾ç¤ºäº†gameOverSceneã€‚ 1234function end() &#123; gameScene.visible = false; gameOverScene.visible = true;&#125; è¿™å°±æ˜¯å¯»å®çŒäºº!åœ¨ç»§ç»­ä¹‹å‰ï¼Œå°è¯•ä½¿ç”¨è¿™äº›ç›¸åŒçš„æŠ€æœ¯ä»å¤´å¼€å§‹åˆ¶ä½œæ‚¨è‡ªå·±çš„æ¸¸æˆã€‚å½“ä½ å‡†å¤‡å¥½äº†ï¼Œç»§ç»­è¯»ä¸‹å»! ä½¿ç”¨å›¾åƒåœ¨ä½ çš„Hexiæ¸¸æˆä¸­æœ‰ä¸‰ç§ä¸»è¦çš„ä½¿ç”¨å›¾åƒçš„æ–¹æ³• ä¸ºæ¯ä¸ªç²¾çµä½¿ç”¨å•ç‹¬çš„å›¾åƒæ–‡ä»¶ ä½¿ç”¨ä¸€ä¸ª çº¹ç†åœ°å›¾é›† ã€‚è¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„å›¾åƒæ–‡ä»¶ï¼ŒåŒ…å«æ¸¸æˆä¸­æ¯ä¸ªç²¾çµçš„å­å›¾åƒã€‚å›¾åƒæ–‡ä»¶é™„å¸¦ä¸€ä¸ªåŒ¹é…çš„JSONæ•°æ®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°æ¯ä¸ªå­å›¾åƒçš„åç§°ã€å¤§å°å’Œä½ç½® ä½¿ç”¨tileset(ä¹Ÿç§°ä¸ºspritesheet)ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå•ä¸€çš„å›¾åƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ¯ä¸ªç²¾çµçš„å­å›¾åƒã€‚ç„¶è€Œï¼Œä¸çº¹ç†å›¾é›†ä¸åŒï¼Œå®ƒæ²¡æœ‰ä¸€ä¸ªæè¿°ç²¾çµæ•°æ®çš„JSONæ–‡ä»¶ã€‚ç›¸åï¼Œæ‚¨éœ€è¦ä½¿ç”¨JavaScriptåœ¨æ¸¸æˆä»£ç ä¸­æŒ‡å®šæ¯ä¸ªç²¾çµçš„å¤§å°å’Œä½ç½®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™å¯ä»¥æ¯”çº¹ç†å›¾é›†æœ‰ä¸€äº›ä¼˜åŠ¿ è¿™ä¸‰ç§åˆ¶ä½œå›¾åƒç²¾çµçš„æ–¹æ³•éƒ½ä½¿ç”¨äº†Hexiçš„spriteæ–¹æ³•ã€‚è¿™æ˜¯ä½¿ç”¨å®ƒæ¥åˆ¶ä½œå›¾åƒç²¾çµçš„æœ€ç®€å•çš„æ–¹æ³•ã€‚ 1let imageSprite = g.sprite(\"images/theSpriteImage.png\"); åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å›¾åƒç²¾çµæ›´æ–°â€œå®è—çŒäººâ€ï¼Œæ‚¨å°†äº†è§£å°†å›¾åƒæ·»åŠ åˆ°æ¸¸æˆä¸­çš„ä¸‰ç§æ–¹æ³•ã€‚ è¿™éƒ¨åˆ†çš„æ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯ç”±Lanea Zimmermanåˆ›ä½œçš„ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šå¥¹çš„è‰ºæœ¯ä½œå“ã€‚è°¢è°¢,Lanea ! ä¸ªäººå½¢è±¡æ‰“å¼€å¹¶æ’­æ”¾ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„å®è—çŒäºº:02_treasureHunterImages.html(åœ¨æ•™ç¨‹æ–‡ä»¶å¤¹ä¸­å¯ä»¥æ‰¾åˆ°)å®ƒå’Œç¬¬ä¸€ä¸ªç‰ˆæœ¬å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯æ‰€æœ‰çš„å½©è‰²æ–¹å—éƒ½è¢«å›¾åƒæ‰€å–ä»£ã€‚ (ç‚¹å‡»ï¼Œç‚¹å‡»é“¾æ¥ç©æ¸¸æˆã€‚)çœ‹çœ‹æºä»£ç ï¼Œä½ ä¼šå‘ç°æ¸¸æˆçš„é€»è¾‘å’Œç»“æ„ä¸æ¸¸æˆçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚å”¯ä¸€æ”¹å˜çš„æ˜¯ç²¾çµçš„å¤–è¡¨ã€‚è¿™æ˜¯å¦‚ä½•åšçš„å‘¢? åŠ è½½å›¾ç‰‡æ–‡ä»¶æ¸¸æˆä¸­çš„æ¯ä¸ªç²¾çµéƒ½ä½¿ç”¨ä¸€ä¸ªPNGå›¾åƒæ–‡ä»¶ã€‚æ‚¨å°†åœ¨æ•™ç¨‹çš„imageså­æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æ‰€æœ‰çš„å›¾åƒã€‚ åœ¨ä½¿ç”¨å®ƒä»¬åˆ¶ä½œç²¾çµä¹‹å‰ï¼Œæ‚¨éœ€è¦é¢„å…ˆå°†å®ƒä»¬åŠ è½½åˆ°Hexiçš„èµ„äº§ä¸­ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–å¼•æ“æ—¶ï¼Œåœ¨Hexiçš„èµ„äº§æ•°ç»„ä¸­åˆ—å‡ºå›¾åƒåç§°åŠå…¶å®Œæ•´çš„æ–‡ä»¶è·¯å¾„ã€‚åˆ›å»ºä¸€ä¸ªåä¸ºthingsToLoadçš„æ•°ç»„ï¼Œåˆ—å‡ºè¦åŠ è½½çš„æ–‡ä»¶åã€‚ç„¶åæä¾›è¯¥æ•°ç»„ä½œä¸ºhexiæ–¹æ³•çš„ç¬¬å››ä¸ªå‚æ•°ã€‚æ–¹æ³•å¦‚ä¸‹: 123456789101112131415//An array that contains all the files you want to loadlet thingsToLoad = [ \"images/explorer.png\", \"images/dungeon.png\", \"images/blob.png\", \"images/treasure.png\", \"images/door.png\", \"sounds/chimes.wav\"];//Create a new Hexi instance, and start itlet g = hexi(512, 512, setup, thingsToLoad);//Start Hexig.start(); å¦‚æœåœ¨webæµè§ˆå™¨ä¸­æ‰“å¼€JavaScriptæ§åˆ¶å°ï¼Œå°±å¯ä»¥ç›‘è§†è¿™äº›èµ„äº§çš„åŠ è½½è¿›åº¦ ç°åœ¨ä½ å¯ä»¥åœ¨ä½ çš„æ¸¸æˆä»£ç ä¸­è®¿é—®è¿™äº›å›¾åƒ: 1g.image(\"images/blob.png\") å°½ç®¡é¢„åŠ è½½å›¾åƒå’Œå…¶ä»–èµ„äº§æ˜¯ä½¿å®ƒä»¬è¿›å…¥æ¸¸æˆçš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨loaderå¯¹è±¡åŠå…¶æ–¹æ³•åœ¨ä»»ä½•å…¶ä»–æ—¶å€™åŠ è½½èµ„äº§ã€‚æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼ŒåŠ è½½ç¨‹åºåªæ˜¯è¿è¡Œåœ¨åº•å±‚çš„PixiåŠ è½½ç¨‹åºçš„åˆ«åï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œäº†è§£å¦‚ä½•ä½¿ç”¨å®ƒã€‚ ç°åœ¨æ‚¨å·²ç»å°†è¿™äº›å›¾åƒåŠ è½½åˆ°æ¸¸æˆä¸­ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥åˆ¶ä½œç²¾çµã€‚ ç”¨å›¾ç‰‡åˆ¶ä½œç²¾çµä½¿ç”¨spriteæ–¹æ³•åˆ›å»ºä¸€ä¸ªå›¾åƒç²¾çµï¼Œä½¿ç”¨æ‚¨ä¹‹å‰äº†è§£çš„æ ¼å¼ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨dungeon.pngæ˜ åƒåˆ›å»ºç²¾çµã€‚(dungeon.pngæ˜¯512Ã—512åƒç´ çš„èƒŒæ™¯å›¾åƒ) 1dungeon = g.sprite(\"images/dungeon.png\"); è¿™æ˜¯æ‰€æœ‰!ç°åœ¨ï¼Œç²¾çµä¸å†æ˜¾ç¤ºä¸ºä¸€ä¸ªç®€å•çš„å½©è‰²çŸ©å½¢ï¼Œè€Œæ˜¯æ˜¾ç¤ºä¸ºä¸€ä¸ª512Ã—512çš„å›¾åƒã€‚æ²¡æœ‰å¿…è¦æŒ‡å®šå®½åº¦æˆ–é«˜åº¦ï¼Œå› ä¸ºHexiæ ¹æ®å›¾åƒçš„å¤§å°è‡ªåŠ¨è®¡ç®—ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‰€æœ‰å…¶ä»–çš„ç²¾çµå±æ€§ï¼Œå¦‚xã€yã€å®½åº¦å’Œé«˜åº¦ï¼Œå°±åƒä½¿ç”¨æ™®é€šçŸ©å½¢ç²¾çµä¸€æ ·ã€‚ ä¸‹é¢æ˜¯è®¾ç½®å‡½æ•°çš„ä»£ç ï¼Œè¯¥å‡½æ•°åˆ›å»ºäº†åœ°ç‰¢èƒŒæ™¯ã€é€€å‡ºé—¨ã€ç©å®¶å’Œå®è—ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨æ·»åŠ åˆ°gameSceneç»„ã€‚ 123456789101112131415161718192021222324//The dungeon backgrounddungeon = g.sprite(\"images/dungeon.png\");//The exit doorexit = g.sprite(\"images/door.png\");exit.x = 32;//The player spriteplayer = g.sprite(\"images/explorer.png\");player.x = 68;player.y = g.canvas.height / 2 - player.halfWidth;//Create the treasuretreasure = g.sprite(\"images/treasure.png\");//Position it next to the left edge of the canvas//g.stage.putCenter(treasure, 208, 0);//Create a `pickedUp` property on the treasure to help us Figure//out whether or not the treasure has been picked up by the playertreasure.pickedUp = false;//Create the `gameScene` group and add the spritesgameScene = g.group(dungeon, exit, player, treasure); ä½œä¸ºå¯¹è¯¥ä»£ç åŸå§‹ç‰ˆæœ¬çš„ç¨å¾®æ›´æœ‰æ•ˆçš„æ”¹è¿›ï¼Œgroupåˆ›å»ºäº†gameSceneå¹¶åœ¨å•ä¸ªæ­¥éª¤ä¸­å¯¹ç²¾çµè¿›è¡Œåˆ†ç»„ çœ‹èµ·æ¥ç†Ÿæ‚‰å—?æ²¡é”™ï¼Œå”¯ä¸€æ”¹å˜çš„ä»£ç æ˜¯åˆ›å»ºç²¾çµçš„è¡Œã€‚è¿™ç§æ¨¡å—åŒ–æ˜¯Hexiçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ ä½¿ç”¨ç®€å•çš„å½¢çŠ¶åˆ›å»ºå¿«é€Ÿçš„æ¸¸æˆåŸå‹ï¼Œå½“ä½ çš„æ¸¸æˆæ€æƒ³å‘å±•çš„æ—¶å€™ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠå®ƒæ¢æˆè¯¦ç»†çš„å›¾ç‰‡ã€‚æ¸¸æˆä¸­çš„å…¶ä½™ä»£ç å¯ä»¥ä¿æŒåŸæ ·ã€‚ å¾®è°ƒæ§åˆ¶åŒºåŸŸè¿™ä¸ªæ–°ç‰ˆæœ¬çš„å®è—çŒäººæœ‰ä¸€ä¸ªå°çš„æ”¹è¿›ï¼Œé‚£å°±æ˜¯ç²¾çµè¢«åŒ…å«åœ¨åœ°ç‰¢é‡Œçš„æ–°æ–¹å¼ã€‚å®ƒä»¬ä»¥ä¸€ç§è‡ªç„¶åœ°ä¸è‰ºæœ¯å“çš„2.5Dè§†è§’ç›¸åŒ¹é…çš„æ–¹å¼è¢«åŒ…å«åœ¨å…¶ä¸­ï¼Œå¦‚è¿™å¼ å±å¹•æˆªå›¾ä¸­çš„ç»¿è‰²æ–¹å—æ‰€ç¤º: è¿™æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“ä¿®æ”¹çš„åœ°æ–¹ã€‚æ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯æä¾›åŒ…å«ä¸€ä¸ªå®šä¹‰åŒ…å«çŸ©å½¢çš„å¤§å°å’Œä½ç½®çš„è‡ªå®šä¹‰å¯¹è±¡çš„åŒ…å«æ–¹æ³•ã€‚æ–¹æ³•å¦‚ä¸‹: 12345678g.contain( player, &#123; x: 32, y: 16, width: g.canvas.width - 32, height: g.canvas.height - 32 &#125;); åªéœ€è°ƒæ•´xã€yã€å®½åº¦å’Œé«˜åº¦å€¼ï¼Œè¿™æ ·åŒ…å«çš„åŒºåŸŸå¯¹äºæ‚¨æ­£åœ¨åˆ¶ä½œçš„æ¸¸æˆæ¥è¯´å°±æ˜¾å¾—è‡ªç„¶äº†ã€‚ ä½¿ç”¨ä¸€ä¸ªçº¹ç†åœ°å›¾é›†å¦‚æœæ‚¨æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤§å‹ã€å¤æ‚çš„æ¸¸æˆï¼Œæ‚¨å°†éœ€è¦ä¸€ç§å¿«é€Ÿã€é«˜æ•ˆçš„å›¾åƒå¤„ç†æ–¹æ³•ã€‚çº¹ç†å›¾è°±å¯ä»¥å¸®åŠ©ä½ åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸€ä¸ªçº¹ç†å›¾é›†å®é™…ä¸Šæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œå®ƒä»¬æ˜¯ç´§å¯†ç›¸å…³çš„: ä¸€ä¸ªPNG tilesetå›¾åƒæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‚¨å¸Œæœ›åœ¨æ¸¸æˆä¸­ä½¿ç”¨çš„æ‰€æœ‰å›¾åƒã€‚(tilesetå›¾åƒæœ‰æ—¶è¢«ç§°ä¸ºspritesheet) ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œæè¿°è¿™äº›å­å›¾åƒåœ¨tilesetä¸­çš„å¤§å°å’Œä½ç½® ä½¿ç”¨çº¹ç†å›¾é›†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„èŠ‚çœæ—¶é—´ã€‚æ‚¨å¯ä»¥æŒ‰ä»»ä½•é¡ºåºæ’åˆ—tilesetçš„å­å›¾åƒï¼ŒJSONæ–‡ä»¶å°†ä¸ºæ‚¨è·Ÿè¸ªå®ƒä»¬çš„å¤§å°å’Œä½ç½®ã€‚è¿™éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºè¿™æ„å‘³ç€å­å›¾åƒçš„å¤§å°å’Œä½ç½®ä¸ä¼šç¡¬ç¼–ç åˆ°æ¸¸æˆç¨‹åºä¸­ã€‚å¦‚æœæ‚¨å¯¹tilesetåšäº†æ›´æ”¹ï¼Œæ¯”å¦‚æ·»åŠ å›¾åƒã€è°ƒæ•´å®ƒä»¬çš„å¤§å°æˆ–åˆ é™¤å®ƒä»¬ï¼Œé‚£ä¹ˆåªéœ€é‡æ–°å‘å¸ƒJSONæ–‡ä»¶ï¼Œæ‚¨çš„æ¸¸æˆå°†ä½¿ç”¨æ›´æ–°åçš„æ•°æ®æ¥æ­£ç¡®æ˜¾ç¤ºå›¾åƒã€‚å¦‚æœä½ è¦åˆ¶ä½œæ¯”ä¸€ä¸ªå°æ¸¸æˆæ›´å¤§çš„ä¸œè¥¿ï¼Œä½ ä¸€å®šè¦ä½¿ç”¨çº¹ç†å›¾é›†ã€‚ ileset JSONæ•°æ®çš„å®é™…æ ‡å‡†æ˜¯ä¸€ç§æ ¼å¼ï¼Œè¿™ç§æ ¼å¼ç”±ä¸€ç§å«åšçº¹ç†åŒ…è£…å™¨çš„æµè¡Œè½¯ä»¶å·¥å…·è¾“å‡º(çº¹ç†åŒ…è£…å™¨çš„â€œåŸºæœ¬â€è®¸å¯è¯æ˜¯å…è´¹çš„)ã€‚å³ä½¿æ‚¨ä¸ä½¿ç”¨çº¹ç†åŒ…è£…å™¨ï¼Œç±»ä¼¼çš„å·¥å…·å¦‚Shoeboxä»¥ç›¸åŒçš„æ ¼å¼è¾“å‡ºJSONæ–‡ä»¶ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ¶ä½œä¸€ä¸ªçº¹ç†è´´å›¾ï¼Œä»¥åŠå¦‚ä½•å°†å®ƒåŠ è½½åˆ°æ¸¸æˆä¸­ã€‚ å‡†å¤‡çš„å›¾ç‰‡æ‚¨é¦–å…ˆéœ€è¦ä¸ºæ‚¨çš„æ¸¸æˆä¸­çš„æ¯ä¸ªå›¾åƒæä¾›å•ç‹¬çš„PNGå›¾åƒã€‚æ‚¨å·²ç»ä¸ºâ€œå¯»å®è€…â€æ‰¾åˆ°äº†å®ƒä»¬ï¼Œæ‰€ä»¥æ‚¨éƒ½å·²ç»è®¾ç½®å¥½äº†ã€‚æ‰“å¼€Texture Packerå¹¶é€‰æ‹©{JS}é…ç½®é€‰é¡¹ã€‚å°†ä½ çš„æ¸¸æˆå›¾åƒæ‹–åˆ°å®ƒçš„å·¥ä½œåŒºä¸­ã€‚æ‚¨è¿˜å¯ä»¥å°†çº¹ç†å°éš”å™¨æŒ‡å‘ä»»ä½•åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹ã€‚çº¹ç†å°éš”å™¨å°†è‡ªåŠ¨å°†å›¾åƒæ’åˆ—åœ¨ä¸€ä¸ªå°å—å›¾åƒä¸Šï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›ä¸åŸå§‹å›¾åƒæ–‡ä»¶ååŒ¹é…çš„åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šç»™ä»–ä»¬ä¸€ä¸ª2åƒç´ çš„å¡«å……ã€‚ åœ°å›¾é›†ä¸­çš„æ¯ä¸€ä¸ªå­å›¾åƒéƒ½è¢«ç§°ä¸ºå¸§ã€‚è™½ç„¶åªæ˜¯ä¸€ä¸ªå¤§çš„å›¾åƒï¼Œçº¹ç†å›¾é›†æœ‰5å¸§ã€‚æ¯ä¸ªå¸§çš„åç§°éƒ½æ˜¯å®ƒçš„åŸå§‹PNGæ–‡ä»¶å:â€dungeon.pngâ€, â€œblob.pngâ€, â€œexplorer.pngâ€, â€œtreasure.pngâ€ å’Œ â€œdoor.pngâ€ã€‚è¿™äº›å¸§åç”¨äºå¸®åŠ©atlaså¼•ç”¨æ¯ä¸ªå­æ˜ åƒã€‚ å®Œæˆåï¼Œè¯·ç¡®ä¿æ•°æ®æ ¼å¼è®¾ç½®ä¸ºJSON(Hash)å¹¶å•å‡»PublishæŒ‰é’®ã€‚é€‰æ‹©æ–‡ä»¶åå’Œä½ç½®ï¼Œå¹¶ä¿å­˜å·²å‘å¸ƒçš„æ–‡ä»¶ã€‚æ‚¨å°†å¾—åˆ°ä¸€ä¸ªPNGæ–‡ä»¶å’Œä¸€ä¸ªJSONæ–‡ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘çš„æ–‡ä»¶åæ˜¯treasureHunter.jsonå’ŒtreasureHunter.pngã€‚ä¸ºäº†è®©ä½ çš„ç”Ÿæ´»æ›´ç®€å•ï¼Œåªéœ€å°†ä¸¤ä¸ªæ–‡ä»¶ä¿å­˜åœ¨é¡¹ç›®çš„imagesæ–‡ä»¶å¤¹ä¸­ã€‚(å¯ä»¥å°†JSONæ–‡ä»¶è§†ä¸ºå›¾åƒæ–‡ä»¶çš„é¢å¤–å…ƒæ•°æ®) Texture Packerä½¿ç”¨èµ·æ¥å¯èƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºæ‚¨éœ€è¦ä½¿æ‰€æœ‰è¿™äº›è®¾ç½®éƒ½æ­£ç¡®ï¼Œä»¥ä¾¿åœ¨ä¸å‘Šè¯‰æ‚¨æœ‰é”™è¯¯çš„æƒ…å†µä¸‹æ­£ç¡®åœ°å‘å¸ƒã€‚å¹¶ä¸”ï¼Œå®ƒå°†è¯•å›¾é€šè¿‡ä½¿ç”¨ä¸æ”¯æŒå…è´¹ç‰ˆæœ¬çš„é»˜è®¤è®¾ç½®æ¥æ¬ºéª—æ‚¨å‡çº§åˆ°ä»˜è´¹ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦æ˜¾å¼åœ°å…³é—­è¿™äº›(æ­£å¦‚æˆ‘ä¸Šé¢æ‰€æè¿°çš„)ï¼Œä»¥ä½¿å…¶å·¥ä½œæ²¡æœ‰é”™è¯¯ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæœ€åçš„åŠªåŠ›è¿˜æ˜¯å€¼å¾—çš„â€”â€”æ‰€ä»¥å¦‚æœä½ é‡åˆ°ä¸å¯èƒ½çš„å›°éš¾ï¼Œç»§ç»­å°è¯•å¹¶åœ¨è¿™ä¸ªèµ„æºåº“ä¸­å‘å¸ƒä¸€ä¸ªé—®é¢˜å§! åŠ è½½çº¹ç†åœ°å›¾é›†è¦å°†çº¹ç†å›¾é›†åŠ è½½åˆ°æ¸¸æˆä¸­ï¼Œåªéœ€åœ¨åˆå§‹åŒ–æ¸¸æˆæ—¶å°†JSONæ–‡ä»¶åŒ…å«åœ¨Hexiçš„èµ„äº§æ•°ç»„ä¸­ã€‚ 1234567let thingsToLoad = [ \"images/treasureHunter.json\", \"sounds/chimes.wav\"];let g = hexi(512, 512, setup, thingsToLoad);g.scaleToWindow();g.start(); è¿™æ˜¯æ‰€æœ‰!ä½ ä¸å¿…åŠ è½½PNGæ–‡ä»¶- Hexiåœ¨åå°è‡ªåŠ¨å®Œæˆã€‚åªéœ€å‘Šè¯‰Hexiæ˜¾ç¤ºå“ªä¸ªtilesetå¸§(å­å›¾åƒ)å°±å¯ä»¥äº†ã€‚ å¦‚æœä½ æƒ³ç”¨çº¹ç†å›¾è°±çš„æ¡†æ¶æ¥åˆ¶ä½œç²¾çµï¼Œä½ å¯ä»¥è¿™æ ·åš: 1anySprite = g.sprite(\"frameName.png\"); Gaå°†åˆ›å»ºç²¾çµï¼Œå¹¶æ˜¾ç¤ºçº¹ç†è´´å›¾ä¸­æ­£ç¡®çš„å›¾åƒã€‚ ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨çº¹ç†å›¾é›†æ¡†æ¶åˆ›å»ºå¯»å®æ¸¸æˆä¸­çš„ç²¾çµ: 1234567891011121314//The dungeon backgrounddungeon = g.sprite(\"dungeon.png\");//The exit doorexit = g.sprite(\"door.png\");exit.x = 32;//The player spriteplayer = g.sprite(\"explorer.png\");player.x = 68;player.y = g.canvas.height / 2 - player.halfWidth;//Create the treasuretreasure = g.sprite(\"treasure.png\"); HexiçŸ¥é“è¿™äº›æ˜¯çº¹ç†åœ°å›¾é›†çš„å¸§åï¼Œè€Œä¸æ˜¯å•ç‹¬çš„å›¾åƒï¼Œå®ƒç›´æ¥æ˜¾ç¤ºå®ƒä»¬æ¥è‡ªtilesetã€‚ å¦‚æœä½ éœ€è¦åœ¨æ¸¸æˆä¸­è®¿é—®çº¹ç†åœ°å›¾é›†çš„JSONæ–‡ä»¶ï¼Œä½ å¯ä»¥è¿™æ ·è·å–: 1jsonFile = g.json(\"jsonFileName.json\"); æŸ¥çœ‹æ•™ç¨‹æ–‡ä»¶å¤¹ä¸­çš„treasureHunterAtlas.jsæ–‡ä»¶ï¼ŒæŸ¥çœ‹å¦‚ä½•åŠ è½½çº¹ç†å›¾é›†å¹¶ä½¿ç”¨å®ƒåˆ¶ä½œç²¾çµçš„å·¥ä½œç¤ºä¾‹ã€‚ å¤–æ˜Ÿäººæ­¦è£…æœ¬ç³»åˆ—æ•™ç¨‹ä¸­çš„ä¸‹ä¸€ä¸ªç¤ºä¾‹æ¸¸æˆæ˜¯Alien Armadaã€‚ä½ èƒ½åœ¨60ä¸ªå¤–æ˜Ÿäººç€é™†å‰æ‘§æ¯ä»–ä»¬å¹¶æ¯ç­åœ°çƒå—?ç‚¹å‡»ä¸‹é¢çš„å›¾ç‰‡é“¾æ¥ç©æ¸¸æˆ: ä½¿ç”¨ç®­å¤´é”®ç§»åŠ¨å¹¶æŒ‰ç©ºæ ¼é”®å°„å‡»ã€‚éšç€æ¸¸æˆçš„è¿›è¡Œï¼Œå¤–æ˜Ÿäººè¶Šæ¥è¶Šé¢‘ç¹åœ°ä»å±å¹•é¡¶ç«¯é™è½ã€‚æ¸¸æˆè§„åˆ™å¦‚ä¸‹: åŠ è½½å¹¶ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ã€‚ åœ¨åŠ è½½æ¸¸æˆèµ„äº§æ—¶æ˜¾ç¤ºåŠ è½½è¿›åº¦æ¡ã€‚ å°„å‡»å­å¼¹ã€‚ åˆ›å»ºå…·æœ‰å¤šä¸ªå›¾åƒçŠ¶æ€çš„ç²¾çµã€‚ ç”Ÿæˆéšæœºçš„æ•Œäººã€‚ ä»æ¸¸æˆä¸­ç§»é™¤ç²¾çµã€‚ æ˜¾ç¤ºä¸€ä¸ªæ¸¸æˆåˆ†æ•°ã€‚ é‡ç½®å¹¶é‡æ–°å¯åŠ¨æ¸¸æˆã€‚ æ‚¨å°†åœ¨æ•™ç¨‹æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å®Œæ•´æ³¨é‡Šçš„å¤–æ˜Ÿæ— æ•Œèˆ°é˜Ÿæºä»£ç ã€‚è¯·åŠ¡å¿…æŸ¥çœ‹å®ƒï¼Œä»¥ä¾¿æ‚¨èƒ½å¤Ÿåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°æ‰€æœ‰è¿™äº›ä»£ç ã€‚å®ƒçš„ä¸€èˆ¬ç»“æ„ä¸ã€Šå¯»å®è€…ã€‹ç›¸åŒï¼Œå¹¶åŠ å…¥äº†è¿™äº›æ–°æŠ€æœ¯ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å®ç°çš„ã€‚ åŠ è½½å¹¶ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“Alien Armadaä½¿ç”¨è‡ªå®šä¹‰å­—ä½“emulogic.ttfæ˜¾ç¤ºå±å¹•å³ä¸Šè§’çš„åˆ†æ•°ã€‚å­—ä½“æ–‡ä»¶é¢„å…ˆåŠ è½½äº†åˆå§‹åŒ–æ¸¸æˆçš„èµ„äº§æ•°ç»„ä¸­çš„å…¶ä½™èµ„äº§æ–‡ä»¶(å£°éŸ³å’Œå›¾åƒ) 12345678910let thingsToLoad = [ \"images/alienArmada.json\", \"sounds/explosion.mp3\", \"sounds/music.mp3\", \"sounds/shoot.mp3\", \"fonts/emulogic.ttf\" //&lt;- The custom font];let g = hexi(480, 320, setup, thingsToLoad, load);g.scaleToWindow();g.start(); è¦ä½¿ç”¨è¯¥å­—ä½“ï¼Œè¯·åœ¨æ¸¸æˆçš„è®¾ç½®å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªæ–‡æœ¬ç²¾çµã€‚textæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæè¿°å­—ä½“çš„ç‚¹å¤§å°å’Œåç§°:â€œ20px emulogicâ€ã€‚ 1scoreDisplay = g.text(\"0\", \"20px emulogic\", \"#00FF00\", 400, 10); æ‚¨å¯ä»¥åŠ è½½å’Œä½¿ç”¨TTFã€OTFã€TTCæˆ–WOFFæ ¼å¼çš„ä»»ä½•å­—ä½“ åŠ è½½è¿›åº¦æ¡å¤–æ˜Ÿäººæ— æ•Œèˆ°é˜Ÿè£…è½½äº†3ä¸ªMP3éŸ³é¢‘æ–‡ä»¶:ä¸€ä¸ªå°„å‡»å£°ï¼Œä¸€ä¸ªçˆ†ç‚¸å£°å’ŒéŸ³ä¹ã€‚éŸ³ä¹å£°éŸ³çš„å¤§å°çº¦ä¸º2 MBï¼Œæ‰€ä»¥åœ¨ç½‘ç»œè¿æ¥ç¼“æ…¢çš„æƒ…å†µä¸‹ï¼Œè¿™ç§å£°éŸ³éœ€è¦å‡ ç§’é’Ÿæ‰èƒ½è¢«åŠ è½½ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œç©å®¶åªèƒ½çœ‹åˆ°ç©ºç™½çš„ç”»å¸ƒï¼Œè€Œå¤–æ˜Ÿäººçš„æ— æ•Œèˆ°é˜Ÿåˆ™è£…è½½ã€‚æœ‰äº›ç©å®¶å¯èƒ½ä¼šè®¤ä¸ºæ¸¸æˆå·²ç»å†»ç»“ï¼Œæ‰€ä»¥æ¸¸æˆä¼šæœ‰å¸®åŠ©åœ°å®ç°ä¸€ä¸ªåŠ è½½æ æ¥é€šçŸ¥ç©å®¶èµ„äº§æ­£åœ¨åŠ è½½ã€‚å®ƒæ˜¯ä¸€ä¸ªä»å·¦å‘å³å±•å¼€çš„è“è‰²çŸ©å½¢ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªæ•°å­—ï¼Œå‘Šè¯‰æ‚¨ç›®å‰åŠ è½½çš„æ¸¸æˆèµ„äº§çš„ç™¾åˆ†æ¯” è¿™æ˜¯ä¸€ä¸ªå†…ç½®åœ¨Hexiå¼•æ“çš„ç‰¹æ€§ã€‚Hexiæœ‰ä¸€ä¸ªå¯é€‰çš„åŠ è½½çŠ¶æ€ï¼Œåœ¨åŠ è½½æ¸¸æˆèµ„äº§æ—¶è¿è¡Œã€‚åœ¨åŠ è½½çŠ¶æ€ä¸‹ï¼Œæ‚¨å¯ä»¥å†³å®šè¦å‘ç”Ÿä»€ä¹ˆã€‚æ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­åŒ…å«åœ¨åŠ è½½èµ„äº§æ—¶åº”è¯¥è¿è¡Œçš„ä»£ç ï¼Œå¹¶å‘Šè¯‰Hexiè¿™ä¸ªå‡½æ•°çš„åç§°ã€‚Hexiçš„å¼•æ“ä¼šè‡ªåŠ¨åœ¨å¾ªç¯ä¸­è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œç›´åˆ°èµ„äº§åŠ è½½å®Œæˆã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¤–æ˜Ÿäººæ— æ•Œèˆ°é˜Ÿæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚æ¸¸æˆä»£ç å‘Šè¯‰Hexiåœ¨åŠ è½½çŠ¶æ€ä¸‹ä½¿ç”¨ä¸€ä¸ªåä¸ºloadçš„å‡½æ•°ã€‚å®ƒé€šè¿‡åˆ—å‡ºloadä½œä¸ºHexiçš„åˆå§‹åŒ–æ„é€ å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ¥å®ç°è¿™ä¸€ç‚¹ã€‚(è¯·åœ¨ä¸‹é¢çš„ä»£ç ä¸­æŸ¥æ‰¾è´Ÿè½½): 1let g = hexi(480, 320, setup, thingsToLoad, load); //&lt;- It's here! è¿™å‘Šè¯‰Hexiåœ¨èµ„äº§åŠ è½½æ—¶åœ¨å¾ªç¯ä¸­è¿è¡Œloadå‡½æ•° è¿™æ˜¯æ¥è‡ªå¤–æ˜Ÿèˆ°é˜Ÿçš„loadå‡½æ•°ã€‚å®ƒå®ç°äº†ä¸€ä¸ªloadingBarå¯¹è±¡ï¼Œå®ƒæ˜¾ç¤ºäº†æ­£åœ¨æ‰©å±•çš„blue barå’ŒåŠ è½½çš„æ–‡ä»¶çš„ç™¾åˆ†æ¯”ã€‚ 123function load()&#123; g.loadingBar();&#125; èµ„äº§åŠ è½½åï¼ŒsetupçŠ¶æ€è‡ªåŠ¨è¿è¡Œ æ‚¨å°†åœ¨Hexiçš„core.jsæ–‡ä»¶ä¸­æ‰¾åˆ°loadingBarä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºç¼–å†™è‡ªå®šä¹‰åŠ è½½åŠ¨ç”»çš„åŸºç¡€ã€‚æ‚¨å¯ä»¥åœ¨loadå‡½æ•°ä¸­è¿è¡Œä»»ä½•æ‚¨å–œæ¬¢çš„ä»£ç ï¼Œå› æ­¤å®Œå…¨ç”±æ‚¨å†³å®šä»€ä¹ˆåº”è¯¥å‘ç”Ÿï¼Œä»€ä¹ˆåœ¨æ‚¨çš„æ¸¸æˆåŠ è½½æ—¶æ˜¾ç¤ºã€‚ å‘å°„å­å¼¹ä½ æ€ä¹ˆèƒ½è®©å¤§ç‚®å°„å‡ºå­å¼¹? å½“ä½ æŒ‰ä¸‹ç©ºæ ¼é”®æ—¶ï¼Œå¤§ç‚®å‘æ•Œäººå‘å°„å­å¼¹ã€‚å­å¼¹ä»ç‚®å¡”çš„æœ«ç«¯å¼€å§‹ï¼Œä»¥æ¯å¸§7åƒç´ çš„é€Ÿåº¦åœ¨ç”»å¸ƒä¸Šç§»åŠ¨ã€‚å¦‚æœä»–ä»¬æ’åˆ°å¤–æ˜Ÿäººï¼Œå¤–æ˜Ÿäººå°±ä¼šçˆ†ç‚¸ã€‚å¦‚æœä¸€é¢—å­å¼¹æ²¡æœ‰å‡»ä¸­å¹¶é£è¿‡èˆå°é¡¶éƒ¨ï¼Œæ¸¸æˆä»£ç å°±ä¼šç§»é™¤å®ƒã€‚ 1bullets = []; æ­¤bulletsæ•°ç»„åœ¨æ¸¸æˆçš„setupå‡½æ•°ä¸­åˆå§‹åŒ–ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Hereçš„è‡ªå®šä¹‰shootæ–¹æ³•æ¥åˆ¶ä½œä»»æ„æ–¹å‘çš„ç²¾çµå°„å‡»å­å¼¹ã€‚ä¸‹é¢æ˜¯å®ç°shootæ–¹æ³•çš„ä¸€èˆ¬æ ¼å¼ã€‚ 12345678910111213g.shoot( cannon, //å¤§ç‚® 4.71, //å°„å‡»è§’åº¦ (4.71 æ˜¯å‘ä¸Š) cannon.halfWidth, //å­å¼¹åœ¨å¤§ç‚®ä¸Šçš„xä½ç½® 0, //å­å¼¹åœ¨å¤§ç‚®ä¸Šçš„yä½ç½® g.stage, //åº”è¯¥æ·»åŠ å­å¼¹çš„å®¹å™¨ 7, //å­å¼¹çš„é€Ÿåº¦ (åƒç´ æ¯å¸§) bullets, //ç”¨äºå­˜å‚¨å­å¼¹çš„æ•°ç»„ //A function that returns the sprite that should //be used to make each bullet () =&gt; g.sprite(\"bullet.png\")); ç¬¬äºŒä¸ªå‚æ•°å†³å®šäº†å­å¼¹åº”è¯¥ä»¥å¼§åº¦è¡¨ç¤ºçš„è§’åº¦ã€‚4.71å¼§åº¦ï¼Œåœ¨æœ¬ä¾‹ä¸­ä½¿ç”¨ï¼Œå‘ä¸Šã€‚0åœ¨å³è¾¹ï¼Œ1.57åœ¨ä¸‹é¢ï¼Œ3.14åœ¨å·¦è¾¹ã€‚ ç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°æ˜¯å­å¼¹åœ¨æ­£å…¸ä¸Šçš„èµ·å§‹xå’Œyä½ç½®ã€‚ç¬¬5ä¸ªå‚æ•°æ˜¯åº”è¯¥æ·»åŠ å­å¼¹çš„å®¹å™¨ï¼Œç¬¬6ä¸ªå‚æ•°æ˜¯åº”è¯¥æ”¾å…¥å­å¼¹çš„æ•°ç»„ã€‚ æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªåº”è¯¥ç”¨ä½œå­å¼¹çš„ç²¾çµã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå­å¼¹æ˜¯ä½¿ç”¨æ¸¸æˆä¸­åŠ è½½çš„çº¹ç†å›¾é›†ä¸­çš„â€bullet.pngâ€å¸§åˆ›å»ºçš„ã€‚ 1() =&gt; g.sprite(\"bullet.png\") ç”¨æ‚¨è‡ªå·±çš„å‡½æ•°æ›¿æ¢æ­¤å‡½æ•°ï¼Œä»¥åˆ›å»ºæ‚¨å¯èƒ½éœ€è¦çš„ä»»ä½•ç±»å‹çš„è‡ªå®šä¹‰å­å¼¹ã€‚ ä½ çš„å­å¼¹ä»€ä¹ˆæ—¶å€™å‘å°„?æ‚¨å¯ä»¥éšæ—¶è°ƒç”¨shootæ–¹æ³•ï¼Œæ— è®ºä½•æ—¶æ‚¨æƒ³è¦åˆ›å»ºé¡¹ç›®ç¬¦å·ï¼Œåœ¨ä»£ç ä¸­çš„ä»»ä½•ä½ç½®ã€‚åœ¨å¤–æ˜Ÿæ— æ•Œèˆ°é˜Ÿä¸­ï¼Œå½“ç©å®¶æŒ‰ä¸‹ç©ºæ ¼é”®æ—¶ï¼Œå­å¼¹ä¼šè¢«å‘å°„ã€‚æ¸¸æˆé€šè¿‡åœ¨ç©ºæ ¼é”®çš„pressæ–¹æ³•ä¸­è°ƒç”¨shootæ¥å®ç°è¿™ä¸€ç‚¹ã€‚æ–¹æ³•å¦‚ä¸‹: 1234567891011121314151617181920g.spaceBar.press = () =&gt; &#123; //Shoot the bullet g.shoot( cannon, //The shooter 4.71, //The angle at which to shoot (4.71 is up) cannon.halfWidth, //Bullet's x position on the cannon 0, //Bullet's y position on the canon g.stage, //The container to which the bullet should be added 7, //The bullet's speed (pixels per frame) bullets, //The array used to store the bullets //A function that returns the sprite that should //be used to make each bullet () =&gt; g.sprite(\"bullet.png\") ); //Play the shoot sound. shootSound.play();&#125;; æ‚¨å¯ä»¥çœ‹åˆ°pressæ–¹æ³•ä¹Ÿä½¿shootSoundå‘æŒ¥ä½œç”¨ã€‚(ä¸Šé¢çš„ä»£ç æ˜¯åœ¨æ¸¸æˆçš„setupå‡½æ•°ä¸­åˆå§‹åŒ–çš„) è¿˜æœ‰ä¸€ä»¶äº‹ä½ éœ€è¦åš:ä½ å¿…é¡»è®©å­å¼¹moveã€‚ä½ å¯ä»¥åœ¨æ¸¸æˆå¾ªç¯playå‡½æ•°ä¸­ä½¿ç”¨ä¸€äº›ä»£ç ã€‚ä½¿ç”¨Hexiçš„moveæ–¹æ³•å¹¶æä¾›å­å¼¹é˜µåˆ—ä½œä¸ºå‚æ•°: 1g.move(bullets); moveæ–¹æ³•è‡ªåŠ¨å¾ªç¯éå†é˜µåˆ—ä¸­çš„æ‰€æœ‰ç²¾çµï¼Œå¹¶ä»¥å…¶vxå’Œvyé€Ÿåº¦å€¼çš„å€¼æ›´æ–°å®ƒä»¬çš„xå’Œyä½ç½®ã€‚ ç°åœ¨ä½ çŸ¥é“å­å¼¹æ˜¯å¦‚ä½•åˆ›å»ºå’ŒåŠ¨ç”»çš„äº†ã€‚ä½†æ˜¯å½“ä»–ä»¬å‡»ä¸­ä¸€ä¸ªå¤–æ˜Ÿäººä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? ç²¾çµçŠ¶æ€å½“ä¸€é¢—å­å¼¹å‡»ä¸­ä¸€ä¸ªå¤–æ˜Ÿäººæ—¶ï¼Œä¼šå‡ºç°ä¸€ä¸ªé»„è‰²çš„çˆ†ç‚¸å›¾åƒã€‚è¿™ä¸ªç®€å•çš„æ•ˆæœæ˜¯é€šè¿‡ç»™æ¯ä¸ªå¤–æ˜Ÿç²¾çµä¸¤ä¸ªçŠ¶æ€æ¥åˆ›é€ çš„:ä¸€ä¸ªæ­£å¸¸çš„çŠ¶æ€å’Œä¸€ä¸ªè¢«ç ´åçš„çŠ¶æ€ã€‚å¤–æ˜Ÿäººè¢«åˆ›é€ ï¼Œä»–ä»¬çš„çŠ¶æ€è¢«è®¾å®šä¸ºæ­£å¸¸ã€‚å¦‚æœä»–ä»¬è¢«å‡»ä¸­ï¼Œä»–ä»¬çš„çŠ¶æ€å°±ä¼šè¢«æ‘§æ¯ã€‚ è¿™ä¸ªç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„? é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¤–æ˜Ÿæ— æ•Œèˆ°é˜Ÿï¼Œè¿™é‡Œå±•ç¤ºçš„æ˜¯: æ‚¨å¯ä»¥çœ‹åˆ°å®šä¹‰è¿™ä¸¤ç§çŠ¶æ€çš„ä¸¤ä¸ªå›¾åƒå¸§:alien.pngå’Œexplosion.pngã€‚åœ¨åˆ›å»ºspriteä¹‹å‰ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°ç»„æ¥åˆ—å‡ºè¿™ä¸¤å¸§: 1234let alienFrames = [ \"alien.png\", \"explosion.png\"]; æ¥ä¸‹æ¥ä½¿ç”¨alienframeæ•°ç»„åˆå§‹åŒ–å¤–æ˜Ÿç²¾çµ 1alien = g.sprite(alienFrames); å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸¤ä¸ªæ­¥éª¤åˆå¹¶æˆä¸€ä¸ªï¼Œåƒè¿™æ ·: 1234alien = g.sprite([ \"alien.png\", \"explosion.png\"]); è¿™å°†ä¸ºç²¾çµåŠ è½½ä¸¤ä¸ªå¸§ã€‚ç¬¬0å¸§æ˜¯alien.png å¸§ï¼Œç¬¬ä¸€å¸§æ˜¯explosion.pngå¸§ã€‚åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºç²¾çµæ—¶ï¼Œé»˜è®¤æ˜¾ç¤ºç¬¬0å¸§ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨spriteçš„showæ–¹æ³•åœ¨spriteä¸Šæ˜¾ç¤ºä»»ä½•å…¶ä»–å¸§å·ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1alien.show(1); ä¸Šé¢çš„ä»£ç å°†æŠŠå¤–æ˜Ÿäººè®¾ç½®ä¸ºç¬¬ä¸€å¸§ï¼Œè¿™å°±æ˜¯explosion.pngå¸§ ä¸ºäº†ä½¿æ‚¨çš„ä»£ç æ›´å…·å¯è¯»æ€§ï¼Œåœ¨ä¸€ä¸ªç‰¹æ®Šçš„çŠ¶æ€å¯¹è±¡ä¸­å®šä¹‰spriteçš„çŠ¶æ€æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ç»™æ¯ä¸ªçŠ¶æ€ä¸€ä¸ªåç§°ï¼Œå…¶å€¼å¯¹åº”äºè¯¥çŠ¶æ€çš„å¸§å·ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å®šä¹‰å¤–æ˜Ÿäººçš„ä¸¤ç§çŠ¶æ€: normalå’Œdestroyed: 1234alien.states = &#123; normal: 0, destroyed: 1&#125;; ç°åœ¨alien.states.normalçš„å€¼ä¸º0,alien.states.destroyedçš„å€¼ä¸º1ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åƒè¿™æ ·æ˜¾ç¤ºå¤–æ˜Ÿäººçš„normalçŠ¶æ€: 1alien.show(alien.states.normal); å±•ç¤ºå¤–æ˜Ÿäººdestroyedçš„çŠ¶æ€: 1alien.show(alien.states.destroyed); è¿™ä½¿æ‚¨çš„ä»£ç å¯è¯»æ€§æ›´å¼ºï¼Œå› ä¸ºæ‚¨å¯ä»¥ä¸€çœ¼çœ‹å‡ºå“ªä¸ªspriteçŠ¶æ€æ­£åœ¨æ˜¾ç¤º æ³¨æ„:Hexiä¹Ÿæœ‰ä¸€ä¸ªä½çº§çš„gotoAndStopæ–¹æ³•ï¼Œå®ƒçš„åŠŸèƒ½å’Œshowä¸€æ ·ã€‚å°½ç®¡ä½ å¯ä»¥åœ¨æ¸¸æˆä»£ç ä¸­è‡ªç”±ä½¿ç”¨gotoAndStopï¼Œä½†æŒ‰ç…§æƒ¯ä¾‹ï¼Œåªæœ‰Hexiçš„æ¸²æŸ“å¼•æ“åœ¨å†…éƒ¨ä½¿ç”¨å®ƒ ç”Ÿæˆéšæœºçš„å¤–æ˜Ÿäººå¤–æ˜Ÿäººæ— æ•Œèˆ°é˜Ÿåœ¨14ä¸ªéšæœºé€‰æ‹©çš„ä½ç½®ä¸­çš„ä»»ä½•ä¸€ä¸ªäº§ç”Ÿå¤–æ˜Ÿäººï¼Œå°±åœ¨èˆå°çš„é¡¶éƒ¨è¾¹ç•Œä¸Šã€‚å¤–æ˜Ÿäººæœ€åˆå‡ºç°çš„é¢‘ç‡å¾ˆä½ï¼Œä½†é€æ¸å¼€å§‹ä»¥è¶Šæ¥è¶Šé«˜çš„é€Ÿåº¦å‡ºç°ã€‚éšç€æ¸¸æˆçš„è¿›è¡Œï¼Œè¿™ä½¿å¾—æ¸¸æˆå˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªç‰¹æ€§æ˜¯å¦‚ä½•å®ç°çš„ã€‚ å¤–æ˜Ÿäººæ—¶æœºå½“æ¸¸æˆå¼€å§‹æ—¶ï¼Œç¬¬ä¸€ä¸ªæ–°çš„å¤–æ˜Ÿäººåœ¨100å¸§åäº§ç”Ÿã€‚åœ¨æ¸¸æˆçš„setupå‡½æ•°ä¸­åˆå§‹åŒ–çš„ä¸€ä¸ªå«åšalienFrequencyçš„å˜é‡ç”¨æ¥å¸®åŠ©è·Ÿè¸ªè¿™ä¸ªã€‚åˆå§‹åŒ–ä¸º100ã€‚ 1alienFrequency = 100; å¦ä¸€ä¸ªåä¸ºalienTimerçš„å˜é‡ç”¨äºè®¡ç®—å‰é¢ç”Ÿæˆçš„å¤–æ˜Ÿäººä¸ä¸‹ä¸€ä¸ªå¤–æ˜Ÿäººä¹‹é—´ç»è¿‡çš„å¸§æ•°ã€‚ 1alienTimer = 0; åœ¨playå‡½æ•°(æ¸¸æˆå¾ªç¯)ä¸­ï¼Œæ¯ä¸ªå¸§éƒ½æ›´æ–°äº†ä¸€ä¸ªalienTimerã€‚å½“alienTimerè¾¾åˆ°alienFrequencyçš„å€¼æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¼‚å½¢ç²¾çµã€‚è¿™æ˜¯playå‡½æ•°çš„ä»£ç ã€‚(æ­¤ä»£ç çœç•¥äº†ç”Ÿæˆå¤–æ˜Ÿç²¾çµçš„å®é™…ä»£ç â€”â€”æˆ‘ä»¬å°†åœ¨å‰é¢çœ‹åˆ°) 1234567891011121314151617//Add one to the alienTimeralienTimer++;//Make a new alien if `alienTimer` equals the `alienFrequency`if(alienTimer === alienFrequency) &#123; //... Create the alien: see ahead for the missing code that does this... //Set the `alienTimer` back to zero alienTimer = 0; //Reduce `alienFrequency` by one to gradually increase //the frequency that aliens are created if(alienFrequency &gt; 2)&#123; alienFrequency--; &#125;&#125; æ‚¨å¯ä»¥åœ¨ä¸Šé¢çš„ä»£ç ä¸­çœ‹åˆ°ï¼Œåˆ›å»ºç²¾çµä¹‹åï¼ŒalienFrequencyå‡å°‘äº†1ã€‚è¿™å°†ä½¿ä¸‹ä¸€ä¸ªå¤–æ˜Ÿäººå‡ºç°çš„æ—¶é—´æ¯”å‰ä¸€ä¸ªå¤–æ˜Ÿäººæ—©1å¸§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸‹é™çš„å¤–æ˜Ÿäººçš„é€Ÿåº¦ç¼“æ…¢å¢åŠ ã€‚æ‚¨è¿˜å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ›å»ºç²¾çµä¹‹åï¼ŒalienTimerè¢«è®¾ç½®ä¸º0ï¼Œä»¥ä¾¿å®ƒå¯ä»¥é‡æ–°è®¡æ•°ï¼Œä»¥ç”Ÿæˆä¸‹ä¸€ä¸ªæ–°çš„å¤–æ˜Ÿäººã€‚ å¤–æ˜Ÿäººçš„éšæœºèµ·å§‹ä½ç½®åœ¨ç”Ÿæˆä»»ä½•å¤–æ˜Ÿäººä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨æ‰€æœ‰çš„å¤–æ˜Ÿäººç²¾çµã€‚ä¸ºæ­¤ï¼Œåœ¨setupå‡½æ•°ä¸­åˆå§‹åŒ–ä¸€ä¸ªåä¸ºaliençš„ç©ºæ•°ç»„ã€‚ 1aliens = []; ç„¶ååœ¨playå‡½æ•°ä¸­åˆ›å»ºæ¯ä¸ªå¼‚å½¢ï¼Œåœ¨ç›¸åŒçš„ifè¯­å¥ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸Šé¢ã€‚è¿™æ®µä»£ç æœ‰å¾ˆå¤šå·¥ä½œè¦åš: å®ƒè®¾ç½®å¤–æ˜Ÿäººçš„å›¾åƒå¸§å’ŒçŠ¶æ€ã€‚ å®ƒè®¾å®šäº†å¤–æ˜Ÿäººçš„é€Ÿåº¦(vxå’Œvy)ã€‚ å®ƒå°†å¤–æ˜Ÿäººå®šä½åœ¨é¡¶ç«¯è¾¹ç•Œä¸Šçš„ä»»æ„æ°´å¹³ä½ç½®ã€‚ æœ€åï¼Œå®ƒæŠŠå¤–æ˜Ÿäººæ¨è¿›äº†aliensçš„æ•°ç»„ã€‚ è¿™é‡Œæœ‰å®Œæ•´çš„ä»£ç æ¥å®Œæˆè¿™ä¸€åˆ‡: 123456789101112131415161718192021222324252627282930313233343536373839404142434445//Add one to the alienTimeralienTimer++;//Make a new alien if `alienTimer` equals the `alienFrequency`if(alienTimer === alienFrequency) &#123; //Create the alien. //Assign two frames from the texture atlas as the //alien's two states let alienFrames = [ \"alien.png\", \"explosion.png\" ]; //Initialize the alien sprite with the frames let alien = g.sprite(alienFrames); //Define some states on the alien that correspond //to its two frames. alien.states = &#123; normal: 0, destroyed: 1 &#125;; //Set its y position above the screen boundary alien.y = 0 - alien.height; //Assign the alien a random x position alien.x = g.randomInt(0, 14) * alien.width; //Set its speed alien.vy = 1; //Push the alien into the `aliens` array aliens.push(alien); //Set the `alienTimer` back to zero alienTimer = 0; //Reduce `alienFrequency` by one to gradually increase //the frequency that aliens are created if(alienFrequency &gt; 2)&#123; alienFrequency--; &#125;&#125; ä½ å¯ä»¥åœ¨ä¸Šé¢çš„ä»£ç ä¸­çœ‹åˆ°å¤–æ˜Ÿäººçš„yä½ç½®å°†å®ƒæ”¾ç½®åœ¨èˆå°çš„é¡¶éƒ¨è¾¹ç•Œä¸Šã€‚ 1alien.y = 0 - alien.height; å®ƒçš„xä½ç½®æ˜¯éšæœºçš„ 1alien.x = g.randomInt(0, 14) * alien.width; è¿™æ®µä»£ç å°†å…¶æ”¾ç½®åœ¨15ä¸ªå¯èƒ½çš„éšæœºä½ç½®(0åˆ°14)ä¹‹ä¸Šã€‚ä»¥ä¸‹æ˜¯è¿™äº›ç«‹åœºçš„è¯´æ˜: æœ€åï¼Œä¹Ÿæ˜¯éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼Œä»£ç å°†å¤–æ˜Ÿäººç²¾çµæ¨å…¥aliensæ•°ç»„ 1aliens.push(alien); æ‰€æœ‰è¿™äº›ä»£ç å¼€å§‹ä»¥ç¨³å®šå¢é•¿çš„é€Ÿåº¦è¾“å‡ºå¤–æ˜Ÿäºº ç§»åŠ¨å¤–æ˜Ÿäººæˆ‘ä»¬å¦‚ä½•è®©å¤–æ˜Ÿäººç§»åŠ¨?ç”¨è®©å­å¼¹ç§»åŠ¨çš„åŒæ ·æ–¹å¼ã€‚æ‚¨å°†åœ¨ä¸Šé¢çš„ä»£ç ä¸­æ³¨æ„åˆ°ï¼Œæ¯ä¸ªå¤–æ˜Ÿäººéƒ½ç”¨vy(å‚ç›´é€Ÿåº¦)å€¼1åˆå§‹åŒ–ã€‚ 1alien.vy = 1; å½“è¿™ä¸ªå€¼åº”ç”¨åˆ°å¤–æ˜Ÿäººçš„yä½ç½®æ—¶ï¼Œå®ƒå°†ä½¿å¤–æ˜Ÿäººä»¥æ¯å¸§1åƒç´ çš„é€Ÿåº¦å‘ä¸‹ç§»åŠ¨ï¼Œå‘èˆå°çš„åº•éƒ¨ç§»åŠ¨ã€‚æ¸¸æˆä¸­æ‰€æœ‰çš„å¤–æ˜Ÿäººç²¾çµéƒ½åœ¨å¤–æ˜Ÿäººé˜µä¸­ã€‚æ‰€ä»¥è¦è®©å®ƒä»¬éƒ½ç§»åŠ¨ï¼Œä½ éœ€è¦éå†å¼‚å½¢æ•°ç»„ä¸­çš„æ¯ä¸ªç²¾çµæ¯ä¸ªå¸§å¹¶å°†å®ƒä»¬çš„vyå€¼æ·»åŠ åˆ°å®ƒä»¬çš„yä½ç½®ã€‚åœ¨playå‡½æ•°ä¸­ç±»ä¼¼çš„ä¸€äº›ä»£ç å¯ä»¥å·¥ä½œ: 123aliens.forEach(alien =&gt; &#123; alien.y += alien.vy;&#125;); ä¸è¿‡ï¼Œä½¿ç”¨Hexiä¾¿æ·çš„å†…ç½®ç§»åŠ¨åŠŸèƒ½æ›´ç®€å•ã€‚åªéœ€æä¾›ä½ æƒ³è¦ç§»åŠ¨çš„ç²¾çµæ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1g.move(aliens); è¿™å°†è‡ªåŠ¨ä½¿ç”¨é€Ÿåº¦æ›´æ–°å¤–æ˜Ÿäººçš„ä½ç½® è®©å¤–æ˜Ÿäººçˆ†ç‚¸æ—¢ç„¶ä½ å·²ç»çŸ¥é“å¦‚ä½•æ”¹å˜å¤–æ˜Ÿäººçš„çŠ¶æ€ï¼Œä½ æ€ä¹ˆèƒ½ç”¨è¿™ä¸ªæŠ€èƒ½åˆ›é€ çˆ†ç‚¸æ•ˆæœå‘¢?ä¸‹é¢æ˜¯æ¥è‡ªå¤–æ˜Ÿèˆ°é˜Ÿçš„ç®€åŒ–ä»£ç ï¼Œå®ƒå‘æ‚¨å±•ç¤ºäº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚ä½¿ç”¨hittestçŸ©å½¢æ¥æ£€æŸ¥å¤–æ˜Ÿäººå’Œå­å¼¹ä¹‹é—´çš„ç¢°æ’ã€‚å¦‚æœå‘ç°äº†ç¢°æ’ï¼Œå–å‡ºå­å¼¹ï¼Œæ˜¾ç¤ºå¤–æ˜Ÿäººè¢«æ‘§æ¯çš„çŠ¶æ€ï¼Œç„¶ååœ¨ä¸€ç§’é’Ÿåç§»é™¤å¤–æ˜Ÿäººã€‚ 123456789101112if (g.hitTestRectangle(alien, bullet)) &#123; //Remove the bullet sprite. g.remove(bullet); //Show the alien's `destroyed` state. alien.show(alien.states.destroyed); //Wait for 1 second (1000 milliseconds) then //remove the alien sprite. g.wait(1000, () =&gt; g.remove(alien));&#125; ä½ å¯ä»¥ä½¿ç”¨Hexiçš„ä¸‡èƒ½removeå‡½æ•°ä»æ¸¸æˆä¸­ç§»é™¤ç²¾çµï¼Œå°±åƒè¿™æ ·: 1g.remove(anySprite); æ‚¨å¯ä»¥é€šè¿‡åˆ—å‡ºå‚æ•°ä¸­è¦åˆ é™¤çš„ç²¾çµæ¥é€‰æ‹©ä¸€æ¬¡åˆ é™¤å¤šä¸ªç²¾çµï¼Œå¦‚ä¸‹æ‰€ç¤º: 1g.remove(spriteOne, spriteTwo, spriteThree); æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ é™¤ä¸€ç³»åˆ—ç²¾çµä¸­çš„ç²¾çµã€‚åªéœ€æä¾›spriteæ•°ç»„ä½œä¸ºç§»é™¤çš„å”¯ä¸€å‚æ•°: 1g.remove(arrayOfSprites); è¿™å°†ä½¿ç²¾çµä»å±å¹•ä¸­æ¶ˆå¤±ï¼Œå¹¶å°†å®ƒä»¬ä»å®ƒä»¬æ‰€åœ¨çš„æ•°ç»„ä¸­æ¸…ç©ºã€‚ Hexiè¿˜æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•å«waitï¼Œå®ƒå¯ä»¥åœ¨ä½ æŒ‡å®šçš„ä»»ä½•å»¶è¿Ÿ(ä»¥æ¯«ç§’ä¸ºå•ä½)ä¹‹åè¿è¡Œä¸€ä¸ªå‡½æ•°ã€‚å¤–æ˜Ÿäººçš„æ— æ•Œèˆ°é˜Ÿæ¸¸æˆä»£ç ä½¿ç”¨ç­‰å¾…ç§»é™¤å¤–æ˜Ÿäººåçš„ä¸€ä¸ªç¬¬äºŒæ¬¡å»¶è¿Ÿï¼Œåƒè¿™æ ·: 1g.wait(1000, () =&gt; g.remove(alien)); è¿™å…è®¸å¤–æ˜Ÿäººåœ¨å®ƒä»æ¸¸æˆä¸­æ¶ˆå¤±ä¹‹å‰æ˜¾ç¤ºå®ƒçš„çˆ†ç‚¸å›¾åƒçŠ¶æ€ä¸€ç§’é’Ÿã€‚ è¿™äº›éƒ½æ˜¯ä½¿å¤–æ˜Ÿäººçˆ†ç‚¸çš„åŸºæœ¬æŠ€æœ¯ï¼Œå½“ä»–ä»¬ç¢°æ’æ—¶æŠŠå¤–æ˜Ÿäººå’Œå­å¼¹ä»æ¸¸æˆä¸­ç§»é™¤ã€‚ä½†æ˜¯åœ¨ã€Šå¼‚å½¢æ— æ•Œèˆ°é˜Ÿã€‹ä¸­ä½¿ç”¨çš„å®é™…ä»£ç è¦å¤æ‚ä¸€äº›ã€‚è¿™æ˜¯å› ä¸ºä»£ç ä½¿ç”¨åµŒå¥—çš„filterå¾ªç¯éå†æ‰€æœ‰çš„å­å¼¹å’Œå¼‚å½¢ï¼Œä»¥ä¾¿å¯ä»¥ç›¸äº’æ£€æŸ¥å®ƒä»¬æ˜¯å¦å‘ç”Ÿå†²çªã€‚å½“å‘ç”Ÿç¢°æ’æ—¶ï¼Œä»£ç ä¹Ÿä¼šæ’­æ”¾çˆ†ç‚¸å£°éŸ³ï¼Œå¹¶å°†åˆ†æ•°æ›´æ–°ä¸º1ã€‚è¿™æ˜¯æ¸¸æˆçš„playå‡½æ•°çš„æ‰€æœ‰ä»£ç ã€‚(å¦‚æœæ‚¨æ˜¯JavaScriptçš„filterå¾ªç¯çš„æ–°æ‰‹ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758//Check for a collision between the aliens and the bullets.//Filter through each alien in the `aliens` array.aliens = aliens.filter(alien =&gt; &#123; //A variable to help check if the alien is //alive or dead. let alienIsAlive = true; //Filter though all the bullets. bullets = bullets.filter(bullet =&gt; &#123; //Check for a collision between an alien and bullet. if (g.hitTestRectangle(alien, bullet)) &#123; //Remove the bullet sprite. g.remove(bullet); //Show the alien's `destroyed` state. alien.show(alien.states.destroyed); //You could alternatively use the frame number, //like this: //alien.show(1); //Play the explosion sound. explosionSound.play(); //Stop the alien from moving. alien.vy = 0; //Set `alienAlive` to false so that it can be //removed from the array. alienIsAlive = false; //Wait for 1 second (1000 milliseconds) then //remove the alien sprite. g.wait(1000, () =&gt; g.remove(alien)); //Update the score. score += 1; //Remove the bullet from the `bullets array. return false; &#125; else &#123; //If there's no collision, keep the bullet in the //bullets array. return true; &#125; &#125;); //Return the value of `alienIsAlive` back to the //filter loop. If it's `true`, the alien will be //kept in the `aliens` array. //If it's `false` it will be removed from the `aliens` array. return alienIsAlive;&#125;); åªè¦filterå¾ªç¯è¿”å›trueï¼Œå½“å‰æ­£åœ¨æ£€æŸ¥çš„spriteå°†ä¿ç•™åœ¨æ•°ç»„ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‘ç”Ÿç¢°æ’ï¼Œå¾ªç¯è¿”å›falseï¼Œå½“å‰çš„å¤–æ˜Ÿäººå’Œå­å¼¹å°†ä»å®ƒä»¬çš„æ•°ç»„ä¸­åˆ é™¤ã€‚ è¿™å°±æ˜¯æ¸¸æˆçš„ç¢°æ’åŸç†! æ˜¾ç¤ºåˆ†æ•°å¤–æ˜Ÿäººæ— æ•Œèˆ°é˜Ÿå¼•å…¥çš„å¦ä¸€ä¸ªæ–°ç‰¹æ€§æ˜¯åŠ¨æ€åˆ†æ•°æ˜¾ç¤ºã€‚æ¯æ¬¡å¤–æ˜Ÿäººè¢«å‡»ä¸­ï¼Œæ¸¸æˆå±å¹•å³ä¸Šè§’çš„åˆ†æ•°å°±ä¼šå¢åŠ 1åˆ†ã€‚è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢? å¤–æ˜Ÿäººæ— æ•Œèˆ°é˜Ÿåˆå§‹åŒ–ä¸€ä¸ªè¢«ç§°ä¸ºscoreDisplayçš„æ–‡æœ¬ç²¾çµåœ¨æ¸¸æˆçš„setupåŠŸèƒ½ã€‚ 1scoreDisplay = g.text(\"0\", \"20px emulogic\", \"#00FF00\", 400, 10); ä½ åœ¨å‰ä¸€èŠ‚ä¸­çœ‹åˆ°ï¼Œå½“ä¸€ä¸ªå¤–æ˜Ÿäººè¢«å‡»ä¸­æ—¶ï¼Œæ¸¸æˆçš„å¾—åˆ†å˜é‡ä¼šå¢åŠ 1: 1score += 1; è¦æ˜æ˜¾åœ°æ›´æ–°åˆ†æ•°ï¼Œæ‚¨åªéœ€å°†åˆ†æ•°å€¼è®¾ç½®ä¸ºè®°åˆ†æ˜¾ç¤ºå™¨çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1scoreDisplay.content = score; è¿™å°±æ˜¯ä¸€åˆ‡! ç»“æŸå¹¶é‡æ–°è®¾ç½®æ¸¸æˆæ¸¸æˆæœ‰ä¸¤ç§ç»“å±€ã€‚è¦ä¹ˆç©å®¶å‡»è½60ä¸ªå¤–æ˜Ÿäººï¼Œè¿™æ ·ç©å®¶å°±èµ¢äº†ã€‚æˆ–è€…ï¼Œå…¶ä¸­ä¸€ä¸ªå¤–æ˜Ÿäººå¿…é¡»ç©¿è¶Šèˆå°çš„åº•éƒ¨è¾¹ç¼˜ï¼Œè¿™æ ·å¤–æ˜Ÿäººå°±èµ¢äº†ã€‚ ä¸€ä¸ªç®€å•çš„ifè¯­å¥åœ¨æ’­æ”¾å‡½æ•°æ£€æŸ¥è¿™ä¸ªã€‚å¦‚æœä»»ä¸€æ¡ä»¶å˜ä¸ºçœŸï¼Œèƒœè€…å°†è¢«è®¾ç½®ä¸ºâ€œç©å®¶â€æˆ–â€œå¤–æ˜Ÿäººâ€ï¼Œæ¸¸æˆçš„çŠ¶æ€å°†è¢«æ›´æ”¹ä¸ºç»“æŸã€‚ 1234567891011121314151617181920212223242526//The player wins if the score matches the value//of `scoreNeededToWin`, which is 60if (score === scoreNeededToWin) &#123; //Set the player as the winner. winner = \"player\"; //Change the game's state to `end`. g.state = end;&#125;//The aliens win if one of them reaches the bottom of//the stage.aliens.forEach(alien =&gt; &#123; //Check to see if the `alien`'s `y` position is greater //than the `stage`'s `height` if (alien.y &gt; g.stage.height) &#123; //Set the aliens as the winner. winner = \"aliens\"; //Change the game's state to `end`. g.state = end; &#125;&#125;); ç»“æŸå‡½æ•°æš‚åœæ¸¸æˆï¼Œä½¿åŠ¨ç”»å†»ç»“ã€‚ç„¶åå®ƒä¼šæ˜¾ç¤ºæ¸¸æˆçš„ä¿¡æ¯ï¼Œå®ƒè¦ä¹ˆæ˜¯â€œåœ°çƒè¢«æ‹¯æ•‘â€ï¼Œè¦ä¹ˆæ˜¯â€œåœ°çƒæ¯ç­!â€å–å†³äºç»“æœã€‚å¦å¤–ï¼ŒéŸ³ä¹éŸ³é‡ä¹Ÿè¢«è®¾ç½®ä¸º50%ã€‚ç„¶ååœ¨å»¶è¿Ÿ3ç§’åï¼Œè°ƒç”¨åä¸ºresetçš„å‡½æ•°ã€‚è¿™æ˜¯å®Œæˆè¿™ä¸€åˆ‡çš„å®Œæ•´çš„ç»“æŸå‡½æ•°: 1234567891011121314151617181920212223242526function end() &#123; //Pause the game loop. g.pause(); //Create the game over message text. gameOverMessage = g.text(\"\", \"20px emulogic\", \"#00FF00\", 90, 120); //Reduce the music volume by half. //1 is full volume, 0 is no volume, and 0.5 is half volume. music.volume = 0.5; //Display \"Earth Saved!\" if the player wins. if (winner === \"player\") &#123; gameOverMessage.content = \"Earth Saved!\"; gameOverMessage.x = 120; &#125; //Display \"Earth Destroyed!\" if the aliens win. if (winner === \"aliens\") &#123; gameOverMessage.content = \"Earth Destroyed!\"; &#125; //Wait for 3 seconds then run the `reset` function. g.wait(3000, () =&gt; reset());&#125; resetå‡½æ•°å°†æ‰€æœ‰çš„æ¸¸æˆå˜é‡é‡ç½®ä¸ºå®ƒä»¬çš„åˆå§‹å€¼ã€‚å®ƒè¿˜å°†éŸ³ä¹éŸ³é‡è°ƒå›åˆ°1ã€‚å®ƒä½¿ç”¨åˆ é™¤å‡½æ•°ä»å¼‚å½¢å’Œå­å¼¹æ•°ç»„ä¸­åˆ é™¤æ‰€æœ‰å‰©ä½™çš„ç²¾çµï¼Œä»¥ä¾¿å½“æ¸¸æˆå†æ¬¡å¼€å§‹æ—¶å¯ä»¥é‡æ–°å¡«å……è¿™äº›æ•°ç»„ã€‚åˆ é™¤ä¹Ÿç”¨äºåˆ é™¤gameOverMessageï¼ŒåŠ å†œç‚®ç²¾çµè¢«é‡æ–°é›†ä¸­åœ¨èˆå°çš„åº•éƒ¨ã€‚æœ€åï¼Œæ¸¸æˆçŠ¶æ€è¢«è®¾ç½®å›æ’­æ”¾ï¼Œè€Œæ¸¸æˆå¾ªç¯é€šè¿‡è°ƒç”¨Hexiçš„æ¢å¤æ–¹æ³•è€Œåœæ­¢ã€‚ 1234567891011121314151617181920212223242526272829function reset() &#123; //Reset the game variables. score = 0; alienFrequency = 100; alienTimer = 0; winner = \"\"; //Set the music back to full volume. music.volume = 1; //Remove any remaining alien and bullet sprites. //The universal `remove` method will loop through //all the sprites in an array of sprites, removed them //from their parent container, and splice them out of the array. g.remove(aliens); g.remove(bullets); //You can also use the universal `remove` function to remove. //a single sprite. g.remove(gameOverMessage); //Re-center the cannon. g.stage.putBottom(cannon, 0, -40); //Change the game state back to `play`. g.state = play; g.resume();&#125; è¿™æ˜¯é‡æ–°å¼€å§‹æ¸¸æˆæ‰€éœ€çš„æ‰€æœ‰ä»£ç ã€‚ä½ å¯ä»¥åƒä½ å–œæ¬¢çš„é‚£æ ·ç©å¤–æ˜Ÿæ— æ•Œèˆ°é˜Ÿï¼Œå®ƒä¼šåƒè¿™æ ·ä¸æ–­åœ°é‡ç½®å’Œé‡å¯è‡ªå·±ã€‚ é£æ‰¬çš„ä»™å¥³Flappy Fairyæ˜¯å¯¹æœ‰å²ä»¥æ¥æœ€è‡­åæ˜­è‘—çš„æ¸¸æˆä¹‹ä¸€çš„è‡´æ•¬:Flappy Birdã€‚ç‚¹å‡»é“¾æ¥ç©æ¸¸æˆ: ç‚¹å‡»â€œGoâ€æŒ‰é’®ï¼Œæ¸¸æˆå°†ä»¥å…¨å±æ¨¡å¼å¯åŠ¨ã€‚ç‚¹å‡»å±å¹•ä¸Šçš„ä»»ä½•åœ°æ–¹ï¼Œè®©ä»™å¥³é£èµ·æ¥ï¼Œå¸®åŠ©å¥¹é€šè¿‡15æ ¹æŸ±å­çš„ç¼éš™åˆ°è¾¾ç»ˆç‚¹ã€‚å½“ä»™å¥³åœ¨è¿·å®«ä¸­é£ç¿”æ—¶ï¼Œä¸€ä¸²äº”é¢œå…­è‰²çš„ä»™å¥³å°˜åŸƒå°¾éšç€å¥¹ã€‚å¦‚æœå¥¹æ’åˆ°ä¸€ä¸ªç»¿è‰²çš„è¡—åŒºï¼Œå¥¹å°±ä¼šåœ¨ä¸€é˜µå°˜åœŸä¸­çˆ†ç‚¸ã€‚ä½†å¦‚æœå¥¹èƒ½åœ¨è¿™15æ ¹æŸ±å­ä¹‹é—´ä¸æ–­ç¼©å°çš„ç¼éš™ä¸­ç©¿è¡Œï¼Œå¥¹å°±èƒ½çœ‹åˆ°ä¸€ä¸ªå·¨å¤§çš„æ¼‚æµ®â€œç»ˆç‚¹â€æ ‡å¿—ã€‚ å¦‚æœä½ èƒ½åšä¸€ä¸ªåƒFlappy Fairyä¸€æ ·çš„æ¸¸æˆï¼Œä½ å‡ ä¹å¯ä»¥åšä»»ä½•å…¶ä»–ç±»å‹çš„2DåŠ¨ä½œæ¸¸æˆã€‚é™¤äº†ä½¿ç”¨ä½ å·²ç»å­¦è¿‡çš„æ‰€æœ‰æŠ€å·§å¤–ï¼ŒFlappy Fairyè¿˜å¼•å…¥äº†ä¸€äº›ä»¤äººå…´å¥‹çš„æ–°æŠ€å·§: ä»¥å…¨å±æ¨¡å¼å¯åŠ¨æ¸¸æˆã€‚ å•å‡»çš„æŒ‰é’®ã€‚ åˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç²¾çµã€‚ ä½¿ç”¨tilingSpriteæ¥åˆ›å»ºæ»šåŠ¨èƒŒæ™¯ã€‚ ä½¿ç”¨ç²’å­æ•ˆæœã€‚ æ‚¨å°†åœ¨æ•™ç¨‹æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å®Œæ•´æ³¨é‡Šçš„Flappy Fairyæºä»£ç ã€‚è¯·åŠ¡å¿…æŸ¥çœ‹å®ƒï¼Œä»¥ä¾¿æ‚¨èƒ½å¤Ÿåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°æ‰€æœ‰è¿™äº›ä»£ç ã€‚å®ƒçš„æ€»ä½“ç»“æ„ä¸æœ¬æ•™ç¨‹ä¸­çš„å…¶ä»–æ¸¸æˆç›¸åŒï¼Œå¹¶æ·»åŠ äº†è¿™äº›æ–°æŠ€æœ¯ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å®ç°çš„ã€‚ åˆ¶ä½œæŒ‰é’®å½“ä½ æŒ‰ä¸‹â€œGoâ€æŒ‰é’®æ—¶ï¼Œæ¸¸æˆå°±å¼€å§‹äº†ã€‚â€œGoâ€æŒ‰é’®æ˜¯ä¸€ç§å«åšâ€œbuttonâ€çš„ç‰¹æ®Šç²¾çµã€‚æŒ‰é’®ç²¾çµæœ‰3ä¸ªå›¾åƒå¸§çŠ¶æ€:ä¸Šã€ä¸‹ã€ä¸‹ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§çŠ¶æ€: 12345goButton = g.button([ \"up.png\", \"over.png\", \"down.png\"]); up.png æ˜¯ä¸€ä¸ªå›¾åƒï¼Œå®ƒæ˜¾ç¤ºäº†å½“æŒ‰é’®ä¸ä¸æŒ‡é’ˆäº¤äº’æ—¶æŒ‰é’®åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚over.pngæ˜¾ç¤ºäº†æŒ‡é’ˆåœ¨ä¸Šé¢å’Œå‘ä¸‹æ—¶çš„æŒ‰é’®çš„æ ·å­ã€‚down.pngæ˜¯æŒ‡é’ˆæŒ‰ä¸‹æŒ‰é’®æ—¶æ˜¾ç¤ºçš„å›¾åƒã€‚ (down.pngå›¾åƒè¢«ç¨å¾®å‘ä¸‹åç§»å¹¶å‘å³åç§»ï¼Œå› æ­¤å®ƒçœ‹èµ·æ¥åƒæ˜¯è¢«å‹ä¸‹äº†ã€‚æ‚¨å¯ä»¥å°†ä»»ä½•æ‚¨å–œæ¬¢çš„å›¾åƒåˆ†é…åˆ°è¿™äº›çŠ¶æ€ï¼ŒæŒ‰é’®å°†æ ¹æ®æŒ‡é’ˆä¸è¿™äº›çŠ¶æ€çš„äº¤äº’æ–¹å¼è‡ªåŠ¨æ˜¾ç¤ºå®ƒä»¬ã€‚(æ³¨æ„:å¦‚æœä½ çš„æ¸¸æˆæ˜¯è§¦æ§çš„ï¼Œä½ å¯èƒ½åªæœ‰ä¸¤ä¸ªæŒ‰é’®çŠ¶æ€:å‘ä¸Šå’Œå‘ä¸‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€åˆ†é…ä¸¤ä¸ªå›¾åƒå¸§ï¼ŒHexiå°†å‡è®¾å®ƒä»¬æ˜¯æŒ‡ä¸Šä¸‹çŠ¶æ€) æŒ‰é’®æœ‰å¯ä»¥å®šä¹‰çš„ç‰¹æ®Šæ–¹æ³•:press, release, over, out, tapã€‚æ‚¨å¯ä»¥ä¸ºè¿™äº›æ–¹æ³•æŒ‡å®šä»»ä½•ä»£ç ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·é‡Šæ”¾playButtonæ—¶ï¼Œå¦‚ä½•æ›´æ”¹æ¸¸æˆçš„çŠ¶æ€: 123goButton.release = () =&gt; &#123; g.state = setupGame;&#125;; æŒ‰é’®è¿˜æœ‰ä¸€ä¸ªåä¸ºenabledçš„å¸ƒå°”(true/false)å±æ€§ï¼Œå¦‚æœæƒ³ç¦ç”¨æŒ‰é’®ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºfalseã€‚(è®¾ç½®ä¸ºtrueä»¥é‡æ–°å¯ç”¨å®ƒã€‚)æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æŒ‰é’®çš„stateå±æ€§æ¥ç¡®å®šæŒ‰é’®çŠ¶æ€æ˜¯å¦ä¸ºâ€œupâ€ã€â€œoverâ€æˆ–â€œdownâ€ã€‚(è¿™äº›çŠ¶æ€å€¼æ˜¯å­—ç¬¦ä¸²ã€‚) é‡è¦!åªè¦å°†æŒ‰é’®çš„äº¤äº’å±æ€§è®¾ç½®ä¸ºtrueï¼Œå°±å¯ä»¥èµ‹äºˆä»»ä½•ç²¾çµæŒ‰é’®çš„ç‰¹æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1anySprite.interact = true; è¿™å°†ä½¿sprite press, release, over, outå’Œtapæ–¹æ³•ä»¥åŠä¸æ™®é€šæŒ‰é’®ç›¸åŒçš„çŠ¶æ€å±æ€§ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥è®©æ‰€æœ‰çš„ç²¾çµéƒ½å¯ä»¥ç‚¹å‡»ï¼Œè¿™å¯¹äºå„ç§å„æ ·çš„äº’åŠ¨æ¸¸æˆæ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ ä½ ä¹Ÿå¯ä»¥è®©èˆå°å¯¹è±¡äº’åŠ¨ï¼ŒæŠŠæ•´ä¸ªæ¸¸æˆç”»é¢å˜æˆä¸€ä¸ªäº’åŠ¨æŒ‰é’®: 1g.stage.interact = true; æœ‰å…³å¦‚ä½•ä½¿ç”¨æŒ‰é’®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æŒ‰é’®ã€‚ç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­çš„buttons.htmlæ–‡ä»¶ã€‚ åŠ¨ç”»ç²¾çµFlappy Fairyçš„ä¸€ä¸ªå¥‡å¦™ç‰¹å¾æ˜¯ï¼Œå½“å®ƒé£èµ·æ¥çš„æ—¶å€™ï¼Œç²¾çµä¼šæ‹æ‰“å®ƒçš„ç¿…è†€ã€‚è¿™ä¸ªåŠ¨ç”»æ˜¯é€šè¿‡åœ¨è¿ç»­å¾ªç¯ä¸­å¿«é€Ÿæ˜¾ç¤º3ä¸ªç®€å•çš„å›¾åƒè€Œåˆ›å»ºçš„ã€‚æ¯ä¸ªå›¾åƒæ˜¾ç¤ºä¸€ä¸ªç¨å¾®ä¸åŒçš„åŠ¨ç”»å¸§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: è¿™ä¸‰å¼ å›¾ç‰‡åªæ˜¯æ¸¸æˆçº¹ç†åœ°å›¾é›†ä¸­ä¸‰ä¸ªæ™®é€šçš„å¸§ï¼Œå«åš0.png, 1.png å’Œ 2.pngã€‚ä½†æ˜¯ä½ æ€ä¹ˆèƒ½æŠŠåƒè¿™æ ·çš„ä¸€ç³»åˆ—å¸§å˜æˆç²¾çµåŠ¨ç”»å‘¢? é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå®šä¹‰åŠ¨ç”»å¸§çš„æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º: 12345let fairyFrames = [ \"0.png\", \"1.png\", \"2.png\"]; ç„¶åä½¿ç”¨è¿™äº›å¸§åˆ›å»ºä¸€ä¸ªç²¾çµï¼Œå¦‚ä¸‹æ‰€ç¤º: 1let fairy = g.sprite(fairyFrames); æˆ–è€…ï¼Œå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥æŠŠå®ƒåˆå¹¶æˆä¸€ä¸ªæ­¥éª¤: 12345let fairy = g.sprite([ \"0.png\", \"1.png\", \"2.png\"]); ä»»ä½•å…·æœ‰å¤šä¸ªå›¾åƒå¸§çš„ç²¾çµéƒ½ä¼šè‡ªåŠ¨æˆä¸ºä¸€ä¸ªåŠ¨ç”»ç²¾çµã€‚å¦‚æœä½ æƒ³è¦åŠ¨ç”»å¸§å¼€å§‹æ’­æ”¾ï¼Œåªéœ€è°ƒç”¨spriteçš„playAnimationæ–¹æ³•: 1fairy.playAnimation(); å¸§å°†è‡ªåŠ¨åœ¨ä¸€ä¸ªè¿ç»­å¾ªç¯ä¸­è¿è¡Œã€‚å¦‚æœä¸å¸Œæœ›å®ƒä»¬å¾ªç¯ï¼Œåˆ™å°†loopè®¾ç½®ä¸ºfalseã€‚ 1fairy.loop = false; ä½¿ç”¨stopAnimationæ–¹æ³•åœæ­¢åŠ¨ç”»: 1fairy.stopAnimation(); å¦‚æœæ‚¨æƒ³çŸ¥é“ç²¾çµçš„åŠ¨ç”»æ˜¯å¦æ­£åœ¨æ’­æ”¾ï¼Œè¯·ä½¿ç”¨Boolean (true/false)çš„playingå±æ€§ã€‚ ä½ å¸Œæœ›åŠ¨ç”»æ’­æ”¾çš„é€Ÿåº¦æ˜¯å¿«è¿˜æ˜¯æ…¢?ä½ å¯ä»¥è¿™æ ·è®¾ç½®åŠ¨ç”»çš„å¸§/ç§’(fps): 1fairy.fps = 24; ç²¾çµåŠ¨ç”»çš„å¸§é€Ÿç‡ä¸æ¸¸æˆçš„å¸§é€Ÿç‡æ— å…³ã€‚è¿™ç»™ä½ å¾ˆå¤§çš„çµæ´»æ€§æ¥å¾®è°ƒç²¾çµåŠ¨ç”»ã€‚ å¦‚æœæ‚¨ä¸æƒ³åœ¨åŠ¨ç”»ä¸­ä½¿ç”¨æ‰€æœ‰ç²¾çµçš„å›¾åƒå¸§ï¼Œåªä½¿ç”¨å…¶ä¸­çš„ä¸€äº›å¸§ï¼Œè¯¥æ€ä¹ˆåŠ?ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªå¸¦æœ‰30å¸§çš„ç²¾çµï¼Œä½†æ‚¨åªå¸Œæœ›åœ¨åŠ¨ç”»çš„ä¸€éƒ¨åˆ†ä¸­æ’­æ”¾10åˆ°15å¸§ã€‚ä¸ºplayAnimationæ–¹æ³•æä¾›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ•°å­—çš„æ•°ç»„:è¦æ’­æ”¾çš„åºåˆ—çš„ç¬¬ä¸€å¸§å’Œæœ€åä¸€å¸§ã€‚ 1animatedSprite.playAnimation([10, 15]); ç°åœ¨åªæœ‰10åˆ°15ä¹‹é—´çš„å¸§ä½œä¸ºåŠ¨ç”»çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†ä½¿å…¶æ›´å…·å¯è¯»æ€§ï¼Œæ‚¨å¯ä»¥å°†åºåˆ—å®šä¹‰ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„æè¿°äº†è¿™äº›åŠ¨ç”»å¸§çš„å®é™…åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸ä»–ä»¬å®šä¹‰äº†ä¸€ä¸ªè§’è‰²çš„è¡Œèµ°å‘¨æœŸã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºwalkCycleçš„æ•°ç»„æ¥å®šä¹‰è¿™äº›å¸§: 1let walkCycle = [10, 15]; ç„¶åä½¿ç”¨playAnimationæ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1animatedSprite.playAnimation(walkCycle); è¿™éœ€è¦ç¼–å†™æ›´å¤šçš„ä»£ç ï¼Œä½†æ˜¯å¯è¯»æ€§æ›´å¥½! æœ‰å…³Hexiçš„ç²¾çµåŠ¨ç”»ç³»ç»Ÿçš„æ›´å¤šç»†èŠ‚ä»¥åŠä½ å¯ä»¥ç”¨å®ƒåšä»€ä¹ˆï¼Œè¯·å‚é˜…ç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­çš„keyframeAnimation.html,textureAtlasAnimation.htmlå’ŒanimationStates.htmlæ–‡ä»¶ã€‚ è®©ä»™å¥³é£ æ—¢ç„¶ä½ å·²ç»çŸ¥é“å¦‚ä½•è®©ç²¾çµåŠ¨èµ·æ¥ï¼Œé‚£ä¹ˆå½“ä½ ç‚¹å‡»æ¸¸æˆå±å¹•æ—¶ï¼ŒFlappy Fairyçš„é£è¡ŒåŠ¨ç”»æ˜¯å¦‚ä½•è§¦å‘çš„å‘¢? åœ¨playå‡½æ•°çš„æ¯ä¸€å¸§ä¸­ï¼Œä»ä»™å¥³çš„yä½ç½®ä¸­å‡å»è¡¨ç¤ºé‡åŠ›çš„0.05ã€‚è¿™å°±æ˜¯æŠŠä»™å¥³æ‹‰åˆ°å±å¹•åº•éƒ¨çš„é‡åŠ›æ•ˆåº”ã€‚ 12fairy.vy += -0.05;fairy.y -= fairy.vy; ä½†å½“ä½ è½»å‡»å±å¹•æ—¶ï¼Œä»™å¥³å°±ä¼šé£èµ·æ¥ã€‚è¿™è¦æ„Ÿè°¢Hexiçš„å†…ç½®æŒ‡é’ˆå¯¹è±¡ã€‚å®ƒæœ‰ä¸€ä¸ªtapæ–¹æ³•ï¼Œæ‚¨å¯ä»¥å®šä¹‰å®ƒæ¥æ‰§è¡Œæ‚¨å–œæ¬¢çš„ä»»ä½•æ“ä½œã€‚åœ¨Flappy Fairyä¸­ï¼Œtapæ–¹æ³•å¢åŠ äº†ç²¾çµçš„å‚ç›´é€Ÿåº¦vyï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½å¢åŠ äº†1.5åƒç´ ã€‚ 123g.pointer.tap = () =&gt; &#123; fairy.vy += 1.5;&#125;; Hexiçš„å†…ç½®æŒ‡é’ˆå¯¹è±¡ä¹Ÿæœ‰æŒ‰ä¸‹å’Œé‡Šæ”¾çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•æ¥å®šä¹‰ã€‚å®ƒè¿˜å…·æœ‰å¸ƒå°”(true/false) isUpã€isDownå’Œtapå±æ€§ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥æ‰¾åˆ°æŒ‡é’ˆçš„çŠ¶æ€ã€‚ ä½†æ˜¯ä½ ä¼šæ³¨æ„åˆ°ä»™å¥³åªä¼šåœ¨å¥¹å¼€å§‹é£èµ·æ¥çš„æ—¶å€™æ‹æ‰“å¥¹çš„ç¿…è†€ï¼Œå½“å¥¹å¤±å»åŠ¨åŠ›å¼€å§‹ä¸‹é™çš„æ—¶å€™åœæ­¢æ‹æ‰“ç¿…è†€ã€‚è¦å®Œæˆè¿™é¡¹å·¥ä½œï¼Œæ‚¨éœ€è¦æ ¹æ®ä»™å¥³å‚ç›´é€Ÿåº¦(vy)å€¼çš„å˜åŒ–ï¼ŒçŸ¥é“ä»™å¥³æ­£åœ¨ä¸Šå‡è¿˜æ˜¯åœ¨ä¸‹é™ã€‚è¿™ä¸ªæ¸¸æˆé‡‡ç”¨äº†ä¸€ç§è€æ‰ç‰™çš„è€æŠŠæˆæ¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚playå‡½æ•°ä»¥ä¸€ä¸ªåä¸ºoldVyçš„æ–°å€¼æ•æ‰åˆ°å½“å‰å¸§ä¸­ä»™å¥³çš„é€Ÿåº¦ã€‚ä½†åªæœ‰åœ¨ä»™å¥³çš„ä½ç½®å‘ç”Ÿå˜åŒ–åæ‰ä¼šè¿™æ ·ã€‚ 12345678910function play()&#123; //... //... all of the code that moves the fairy comes first... //... //Then, after the fairy's position has been changed, capture //her velocity for this current frame fairy.oldVy = fairy.vy;&#125; è¿™æ„å‘³ç€ï¼Œå½“ä¸‹ä¸€ä¸ªæ¸¸æˆå¸§åœ¨ä¸Šä¸‹æ‘†åŠ¨æ—¶ï¼ŒoldVyä»ç„¶ä¼šå­˜å‚¨å‰ä¸€å¸§ä¸­ç²¾çµçš„é€Ÿåº¦å€¼ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨è¿™ä¸ªå€¼è®¡ç®—å‡ºä»å‰ä¸€å¸§åˆ°å½“å‰å¸§çš„é€Ÿåº¦å˜åŒ–é‡ã€‚å¦‚æœå¥¹å¼€å§‹ä¸Šå‡(å¦‚æœvyæ¯”oldVyå¤§)ï¼Œæ’­æ”¾ä»™å¥³çš„åŠ¨ç”»: 12345if (fairy.vy &gt; fairy.oldVy) &#123; if(!fairy.playing) &#123; fairy.playAnimation(); &#125;&#125; å¦‚æœå¥¹å¼€å§‹ä¸‹é™ï¼Œåœæ­¢åŠ¨ç”»ï¼Œåªæ˜¾ç¤ºç²¾çµçš„ç¬¬ä¸€å¸§ã€‚ 1234if (fairy.vy &lt; 0 &amp;&amp; fairy.oldVy &gt; 0) &#123; if (fairy.playing) fairy.stopAnimation(); fairy.show(0);&#125; è¿™å°±æ˜¯ä»™å¥³æ€ä¹ˆé£çš„! åšä¸€ä¸ªæ»šåŠ¨çš„èƒŒæ™¯ Flappy Fairyçš„ä¸€ä¸ªæœ‰è¶£çš„æ–°ç‰¹æ€§æ˜¯ï¼Œå®ƒæœ‰ä¸€ä¸ªæ— é™æ»šåŠ¨çš„èƒŒæ™¯äº‘ä»å³å‘å·¦ç§»åŠ¨ã€‚ èƒŒæ™¯çš„ç§»åŠ¨é€Ÿåº¦æ¯”ç»¿è‰²çš„æŸ±å­è¦æ…¢ï¼Œè¿™ç»™äººä¸€ç§äº‘ç¦»å¾—æ›´è¿œçš„é”™è§‰ã€‚(è¿™æ˜¯ä¸€ç§æµ…æ˜¾çš„ä¼ª3Dæ•ˆæœï¼Œå«åšæŠ›ç‰©çº¿æ»šåŠ¨ã€‚) èƒŒæ™¯åªæ˜¯ä¸€ä¸ªå›¾åƒã€‚ è¿™å¼ ç…§ç‰‡çš„è®¾è®¡ä½¿å¾—äº‘å¹³é“ºæ— ç¼:é¡¶éƒ¨å’Œå·¦è¾¹çš„äº‘ä¸å³ä¸‹è§’çš„äº‘ç›¸åŒ¹é…ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥è¿æ¥åŒä¸€æ˜ åƒçš„å¤šä¸ªå®ä¾‹ï¼Œå®ƒä»¬å°†æ˜¾ç¤ºä¸ºåˆ›å»ºå•ä¸ªã€è¿ç»­çš„æ˜ åƒã€‚(å›¾ç‰‡æ¥è‡ªOpenGameArt) å› ä¸ºè¿™å¯¹æ¸¸æˆéå¸¸æœ‰ç”¨ï¼ŒHexiæœ‰ä¸€ç§ç²¾çµç±»å‹å«åštilingSpriteï¼Œä¸“ä¸ºæ— é™çš„æ»šåŠ¨æ•ˆæœè€Œè®¾è®¡ã€‚ä¸‹é¢æ˜¯å¦‚ä½•åˆ›å»ºtilingSprite: 12345sky = g.tilingSprite( \"sky.png\" //The image to use g.canvas.width, //The width g.canvas.height, //The height); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‚¨æƒ³è¦ä½¿ç”¨çš„å›¾åƒï¼Œæœ€åä¸¤ä¸ªå‚æ•°æ˜¯ç²¾çµçš„å®½åº¦å’Œé«˜åº¦ã€‚ è´´ç –ç²¾çµä¸æ™®é€šç²¾çµå…·æœ‰ç›¸åŒçš„å±æ€§ï¼Œå¢åŠ äº†ä¸¤ä¸ªæ–°å±æ€§:tileXå’ŒtileYã€‚è¿™ä¸¤ä¸ªå±æ€§å…è®¸æ‚¨è®¾ç½®ç²¾çµå·¦ä¸Šè§’çš„å›¾åƒåç§»é‡ã€‚å¦‚æœä½ æƒ³è¿ç»­ä¸æ–­åœ°åˆ¶ä½œä¸€ä¸ªå¹³é“ºçš„ç²¾çµæ»šåŠ¨æ¡ï¼Œåªéœ€åœ¨æ¸¸æˆå¾ªç¯çš„æ¯ä¸€å¸§ä¸­å¢åŠ å°‘é‡çš„tileXå€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1sky.tileX -= 1; è¿™å°±æ˜¯ä½ åšæ— é™æ»šåŠ¨èƒŒæ™¯æ‰€éœ€è¦åšçš„ã€‚ ç²’å­æ•ˆæœä½ å¦‚ä½•åˆ›é€ åƒç«ï¼ŒçƒŸï¼Œé­”æ³•å’Œçˆ†ç‚¸è¿™æ ·çš„æ•ˆæœ?ä½ åˆ¶é€ äº†å¾ˆå¤šå°ç²¾çµ;æœ‰å‡ åä¸ªï¼Œæˆç™¾ä¸Šåƒä¸ªã€‚ç„¶åå¯¹è¿™äº›ç²¾çµæ–½åŠ ä¸€äº›ç‰©ç†æˆ–é‡åŠ›çº¦æŸï¼Œä½¿å®ƒä»¬çš„è¡Œä¸ºç±»ä¼¼äºä½ è¦æ¨¡æ‹Ÿçš„å…ƒç´ ã€‚æ‚¨è¿˜éœ€è¦ç»™ä»–ä»¬ä¸€äº›è§„åˆ™ï¼Œå…³äºä»–ä»¬åº”è¯¥å¦‚ä½•å‡ºç°å’Œæ¶ˆå¤±ï¼Œä»¥åŠä»–ä»¬åº”è¯¥å½¢æˆä»€ä¹ˆæ ·çš„æ¨¡å¼ã€‚è¿™äº›å°ç²¾çµè¢«ç§°ä¸ºç²’å­ã€‚ä½ å¯ä»¥ç”¨å®ƒä»¬ä¸ºæ¸¸æˆåˆ¶ä½œå„ç§å„æ ·çš„ç‰¹æ•ˆã€‚ Hexiæœ‰ä¸€ç§å¤šåŠŸèƒ½çš„å†…ç½®æ–¹æ³•å«åšcreateParticlesï¼Œå®ƒå¯ä»¥åˆ¶é€ æ¸¸æˆæ‰€éœ€çš„å¤§å¤šæ•°ç²’å­æ•ˆæœã€‚ä¸‹é¢æ˜¯ä½¿ç”¨å®ƒçš„æ ¼å¼: 123456789101112131415createParticles( pointer.x, //The particleâ€™s starting x position pointer.y, //The particleâ€™s starting y position () =&gt; sprite(\"images/star.png\"), //Particle function g.stage, //The container to add the particles to 20, //Number of particles 0.1, //Gravity true, //Random spacing 0, 6.28, //Min/max angle 12, 24, //Min/max size 1, 2, //Min/max speed 0.005, 0.01, //Min/max scale speed 0.005, 0.01, //Min/max alpha speed 0.05, 0.1 //Min/max rotation speed); æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå¤§å¤šæ•°å‚æ•°æè¿°äº†æœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´çš„èŒƒå›´ï¼Œè¿™äº›å€¼åº”è¯¥ç”¨äºæ›´æ”¹ç²¾çµçš„é€Ÿåº¦ã€æ—‹è½¬ã€ç¼©æ”¾æˆ–alphaã€‚æ‚¨è¿˜å¯ä»¥æŒ‡å®šåº”è¯¥åˆ›å»ºçš„ç²’å­æ•°ï¼Œå¹¶æ·»åŠ å¯é€‰çš„é‡åŠ›ã€‚é€šè¿‡å®šåˆ¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•ç²¾çµç”Ÿæˆç²’å­ã€‚åªè¦æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä½ æƒ³ä¸ºæ¯ä¸ªç²’å­ä½¿ç”¨çš„ç²¾çµ: 1() =&gt; (\"images/star.png\"), å¦‚æœä½ æä¾›ä¸€ä¸ªå…·æœ‰å¤šä¸ªå¸§çš„ç²¾çµï¼ŒcreateParticlesæ–¹æ³•ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªç²’å­é€‰æ‹©ä¸€ä¸ªéšæœºçš„å¸§ã€‚æœ€å°å’Œæœ€å¤§è§’åº¦å€¼å¯¹äºå®šä¹‰ç²’å­ä»åŸç‚¹è¾å°„å‡ºæ¥æ—¶çš„åœ†å½¢ä¼ æ’­éå¸¸é‡è¦ã€‚å¯¹äºå®Œå…¨åœ†å½¢çš„çˆ†ç‚¸æ•ˆæœï¼Œä½¿ç”¨æœ€å°è§’åº¦ä¸º0ï¼Œæœ€å¤§è§’åº¦ä¸º6.28ã€‚ 10, 6.28, (è¿™äº›å€¼å¼§åº¦;ç­‰äº0å’Œ360ã€‚)0ä»3ç‚¹é’Ÿæ–¹å‘å¼€å§‹ï¼ŒæŒ‡å‘å³è¾¹ã€‚3.14æ˜¯9ç‚¹çš„ä½ç½®ï¼Œ6.28è®©ä½ å†æ¬¡å›åˆ°0ç‚¹ã€‚å¦‚æœä½ æƒ³æŠŠç²’å­èŒƒå›´é™åˆ¶åœ¨ä¸€ä¸ªæ›´çª„çš„è§’åº¦ï¼Œåªè¦æä¾›æè¿°è¿™ä¸ªèŒƒå›´çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚è¿™é‡Œæœ‰ä¸€äº›å€¼ï¼Œä½ å¯ä»¥ç”¨æ¥å°†è§’åº¦é™åˆ¶åœ¨æ¯”è¨æ–œé¢ä¸Šï¼Œåœ°å£³æŒ‡å‘å·¦è¾¹ã€‚ 12.4, 3.6, ä½ å¯ä»¥ä½¿ç”¨åƒè¿™æ ·çš„å—é™è§’åº¦èŒƒå›´æ¥åˆ›å»ºç²’å­æµï¼Œå°±åƒé‚£äº›ç”¨æ¥åˆ›å»ºå–·æ³‰æˆ–ç«ç®­å¼•æ“ç«ç„°çš„ç²’å­æµã€‚(ä½ é©¬ä¸Šå°±ä¼šçŸ¥é“æ€ä¹ˆåšäº†ã€‚)éšæœºé—´éš”å€¼(ç¬¬å…­ä¸ªå‚æ•°)å†³å®šäº†ç²’å­åœ¨è¿™ä¸ªèŒƒå›´å†…çš„é—´éš”æ˜¯å‡åŒ€çš„(å‡)è¿˜æ˜¯éšæœºçš„(çœŸ)ã€‚é€šè¿‡ä»”ç»†åœ°ä¸ºç²’å­é€‰æ‹©ç²¾çµå¹¶ç²¾ç»†åœ°è°ƒæ•´æ¯ä¸ªå‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€šç”¨çš„createparticleæ–¹æ³•æ¥æ¨¡æ‹Ÿä»æ¶²ä½“åˆ°ç«ç„°çš„ä¸€åˆ‡ã€‚åœ¨Flappy Fairyä¸­ï¼Œå®ƒè¢«ç”¨æ¥åˆ›é€ ä»™å°˜ã€‚ ä»™å¥³ç²‰å°˜çˆ†ç‚¸å½“Flappy Fairyæ’ä¸Šä¸€å—æœ¨å¤´æ—¶ï¼Œå®ƒå°±æ¶ˆå¤±åœ¨ä¸€é˜µå°˜åœŸä¸­ã€‚ é‚£æ•ˆæœå¦‚ä½•å‘¢? åœ¨åˆ›å»ºçˆ†ç‚¸æ•ˆæœä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„åˆ—å‡ºäº†æˆ‘ä»¬æƒ³è¦ä¸ºæ¯ä¸ªç²’å­ä½¿ç”¨çš„å›¾åƒã€‚å¦‚å‰æ‰€è¿°ï¼Œå¦‚æœç²¾çµåŒ…å«å¤šä¸ªå¸§ï¼Œé‚£ä¹ˆcreateparticleæ–¹æ³•å°†åœ¨ç²¾çµä¸Šéšæœºæ˜¾ç¤ºä¸€ä¸ªå¸§ã€‚è¦å®Œæˆè¿™é¡¹å·¥ä½œï¼Œé¦–å…ˆå®šä¹‰ä¸€ç»„çº¹ç†å›¾é›†æ¡†æ¶ï¼Œä½ æƒ³ç”¨å®ƒæ¥åº”å¯¹ä»™å¥³çš„å°˜åŸƒçˆ†ç‚¸: 123456dustFrames = [ \"pink.png\", \"yellow.png\", \"green.png\", \"violet.png\"]; å½“ä»™å¥³ç¢°åˆ°ä¸€ä¸ªç»¿è‰²çš„æ–¹å—æ—¶ï¼Œçˆ†ç‚¸å°±å‘ç”Ÿäº†ã€‚æ¸¸æˆå¾ªç¯åœ¨hitTestRectangleæ–¹æ³•çš„å¸®åŠ©ä¸‹å®ç°äº†è¿™ä¸€ç‚¹ã€‚ä»£ç å¾ªç¯éå†è¿™äº›å—ã€‚å¯¹æ¯ä¸ªç»¿è‰²å—å’Œç²¾çµä¹‹é—´çš„å†²çªè¿›è¡Œæ•°ç»„å’Œæµ‹è¯•ã€‚å¦‚æœhitTestRectangleè¿”å›trueï¼Œåˆ™å¾ªç¯é€€å‡ºï¼Œåä¸ºfairyVsBlockçš„å†²çªå¯¹è±¡å˜ä¸ºtrueã€‚ 123let fairyVsBlock = blocks.children.some(block =&gt; &#123; return g.hitTestRectangle(fairy, block, true); &#125;); hitTestRectangleçš„ç¬¬ä¸‰ä¸ªå‚æ•°éœ€è¦æ˜¯trueï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨spriteçš„å…¨å±€åæ ‡(gxå’Œgy)æ¥å®Œæˆç¢°æ’æ£€æµ‹ã€‚è¿™æ˜¯å› ä¸ºä»™å¥³æ˜¯èˆå°çš„å­å…ƒç´ ï¼Œä½†æ˜¯æ¯ä¸ªå—éƒ½æ˜¯å—ç»„çš„å­å…ƒç´ ã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¸å…±äº«ç›¸åŒçš„å±€éƒ¨åæ ‡ç©ºé—´ã€‚ä½¿ç”¨å—ç²¾çµçš„å…¨å±€åæ ‡è¿«ä½¿hitTestRectangleä½¿ç”¨å®ƒä»¬ç›¸å¯¹äºç”»å¸ƒçš„ä½ç½®ã€‚ å¦‚æœfairyVsBlockæ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”ç²¾çµç°åœ¨æ˜¯å¯è§çš„ï¼Œé‚£ä¹ˆå†²çªä»£ç å°±ä¼šè¿è¡Œã€‚å®ƒä½¿ç²¾çµéšå½¢ï¼Œäº§ç”Ÿç²’å­çˆ†ç‚¸ï¼Œå¹¶åœ¨å»¶è¿Ÿ3ç§’åè°ƒç”¨æ¸¸æˆçš„å¤ä½åŠŸèƒ½ã€‚ 123456789101112131415161718192021222324if (fairyVsBlock &amp;&amp; fairy.visible) &#123; //Make the fairy invisible fairy.visible = false; //Create a fairy dust explosion g.createParticles( fairy.centerX, fairy.centerY, //x and y position () =&gt; g.sprite(dustFrames), //Particle sprite g.stage, //The container to add the particles to 20, //Number of particles 0, //Gravity false, //Random spacing 0, 6.28, //Min/max angle 16, 32, //Min/max size 1, 3 //Min/max speed ); //Stop the dust emitter that's trailing the fairy dust.stop(); //Wait 3 seconds and then reset the game g.wait(3000, reset);&#125; ä½¿ç”¨ç²’å­å‘å°„å™¨ç²’å­å‘å°„å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„è®¡æ—¶å™¨ï¼Œä»¥å›ºå®šçš„é—´éš”äº§ç”Ÿç²’å­ã€‚è¿™æ„å‘³ç€å‘é€å™¨ä¸å†åªè°ƒç”¨createParticlesæ–¹æ³•ä¸€æ¬¡ï¼Œè€Œæ˜¯å‘¨æœŸæ€§åœ°è°ƒç”¨å®ƒã€‚Hexiæœ‰ä¸€ä¸ªå†…ç½®çš„ç²’å­å‘å°„å™¨æ–¹æ³•è®©æˆ‘ä»¬å¾ˆå®¹æ˜“åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨å®ƒçš„æ–¹æ³•: 123456let particleStream = g.particleEmitter( 100, //The interval () =&gt; g.createParticles( //The `particleEffect` function //Assign particle parameters... )); ç²’å­å‘å°„å™¨æ³•åªæ˜¯å›´ç»•ç€åˆ›é€ ç²’å­æ³•ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„æ•°å­—ï¼Œå®ƒå†³å®šäº†ç²’å­äº§ç”Ÿçš„é¢‘ç‡ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯createparticleæ–¹æ³•ï¼Œæ‚¨å¯ä»¥éšæ„å®šåˆ¶å®ƒã€‚ç²’å­å‘å°„å™¨æ–¹æ³•è¿”å›ä¸€ä¸ªå¸¦æœ‰æ’­æ”¾å’Œåœæ­¢æ–¹æ³•çš„å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ§åˆ¶ç²’å­æµã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬å°±åƒä½ ç”¨æ¥æ§åˆ¶ç²¾çµåŠ¨ç”»çš„æ¸¸æˆå’Œåœæ­¢æ–¹æ³•ä¸€æ ·ã€‚ 12particleStream.play();particleStream.stop(); å‘å°„å™¨å¯¹è±¡è¿˜æœ‰ä¸€ä¸ªplayingå±æ€§ï¼Œæ ¹æ®å‘å°„å™¨çš„å½“å‰çŠ¶æ€ï¼Œè¯¥å±æ€§å¯ä»¥ä¸ºçœŸï¼Œä¹Ÿå¯ä»¥ä¸ºå‡ã€‚(å‚è§ç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­çš„particleEmitter .htmlæ–‡ä»¶ï¼Œäº†è§£å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ç²’å­å‘å°„å™¨çš„æ›´å¤šç»†èŠ‚ã€‚ Flappy Fairyä¸­ä½¿ç”¨äº†ä¸€ä¸ªç²’å­å‘å°„å™¨ï¼Œå½“ä»™å¥³æ‹æ‰“ç¿…è†€æ—¶ï¼Œå®ƒå°±ä¼šå‘å‡ºä¸€ä¸²äº”é¢œå…­è‰²çš„ç²’å­ã€‚ç²’å­çš„è§’åº¦è¢«é™åˆ¶åœ¨2.4åˆ°3.6å¼§åº¦ä¹‹é—´ï¼Œæ‰€ä»¥å®ƒä»¬ä»¥ä¸€ä¸ªé”¥å½¢çš„æ¥”å½¢å‘ä»™å¥³çš„å·¦è¾¹å‘å°„ã€‚ ç²’å­æµéšæœºåœ°å‘å‡ºç²‰è‰²ã€é»„è‰²ã€ç»¿è‰²æˆ–ç´«è‰²çš„ç²’å­ï¼Œæ¯ä¸ªç²’å­éƒ½æ˜¯çº¹ç†å›¾è°±ä¸Šçš„ä¸€ä¸ªå•ç‹¬çš„æ¡†æ¶ã€‚ ä»¥ä¸‹æ˜¯äº§ç”Ÿè¿™ç§æ•ˆæœçš„ä»£ç : 12345678910111213141516171819202122232425262728dustFrames = [ \"pink.png\", \"yellow.png\", \"green.png\", \"violet.png\"];//Create the emitterdust = g.particleEmitter( 300, //The interval () =&gt; &#123; g.createParticles( //The function fairy.x + 8, //x position fairy.y + fairy.halfHeight + 8, //y position () =&gt; g.sprite(dustFrames), //Particle sprite g.stage, //The container to add the particles to 3, //Number of particles 0, //Gravity true, //Random spacing 2.4, 3.6, //Min/max angle 12, 18, //Min/max size 1, 2, //Min/max speed 0.005, 0.01, //Min/max scale speed 0.005, 0.01, //Min/max alpha speed 0.05, 0.1 //Min/max rotation speed ); &#125;); æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨playå’Œstopæ–¹æ³•æ§åˆ¶å°˜åŸƒå‘å°„å™¨ã€‚ åˆ›é€ å’Œç§»åŠ¨æŸ±å­ä½ ç°åœ¨çŸ¥é“äº†Flappy Fairyå¦‚ä½•å®ç°äº†æ²³è¥¿çš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ï¼Œä»¥è·å¾—ä¸€äº›æœ‰è¶£å’Œæœ‰ç”¨çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æ˜¯æ¸¸æˆç¼–ç¨‹çš„æ–°æ‰‹ï¼Œä½ å¯èƒ½ä¹Ÿæƒ³çŸ¥é“ï¼Œé‚£ä¸ªé£˜é£˜æ¬²ä»™çš„ä¸–ç•Œæ˜¯å¦‚ä½•è¢«åˆ›é€ å‡ºæ¥çš„ã€‚è®©æˆ‘ä»¬å¿«é€Ÿåœ°çœ‹ä¸€ä¸‹åˆ›å»ºå¹¶ç§»åŠ¨ç²¾çµå¿…é¡»å¯¼èˆªçš„ç»¿è‰²æŸ±å­çš„ä»£ç ï¼Œä»¥è¾¾åˆ°å®Œæˆæ ‡è®°ã€‚ æ¸¸æˆä¸­æœ‰15æ ¹ç»¿è‰²æŸ±å­ã€‚æ¯éš”5æ ¹æŸ±å­ï¼Œé¡¶éƒ¨å’Œåº•éƒ¨ä¹‹é—´çš„ç¼éš™å°±ä¼šç¼©å°ã€‚å‰äº”æ ¹æŸ±å­æœ‰å››ä¸ªè¡—åŒºçš„ç©ºéš™ï¼Œåäº”æ ¹æŸ±å­æœ‰ä¸‰ä¸ªè¡—åŒºçš„ç©ºéš™ï¼Œåäº”æ ¹æŸ±å­æœ‰ä¸¤ä¸ªè¡—åŒºçš„ç©ºéš™ã€‚è¿™ä½¿å¾—è¿™ä¸ªæ¸¸æˆå˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œå› ä¸ºFlappyä»™å¥³é£å¾—æ›´è¿œã€‚æ¯ä¸€æ ¹æŸ±å­ä¸Šçš„ç©ºéš™çš„ç¡®åˆ‡ä½ç½®éƒ½æ˜¯éšæœºçš„ï¼Œæ¯æ¬¡æ¸¸æˆéƒ½æ˜¯ä¸åŒçš„ã€‚æ¯æ ¹æŸ±å­çš„é—´è·æ˜¯384åƒç´ ï¼Œè¿™æ˜¯å®ƒä»¬ç›¸é‚»æ—¶çš„æ ·å­ã€‚ ä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ªç¼ºå£æ˜¯å¦‚ä½•ä»å·¦åˆ°å³é€æ¸ç¼©å°çš„ã€‚ æ„æˆæŸ±å­çš„æ‰€æœ‰ç –å—éƒ½å±äºä¸€ä¸ªå«åšblocksçš„groupã€‚ 1blocks = g.group(); åµŒå¥—çš„forå¾ªç¯åˆ›å»ºæ¯ä¸ªå—å¹¶å°†å…¶æ·»åŠ åˆ°blockså®¹å™¨ä¸­ã€‚å¤–ç¯è¿è¡Œ15æ¬¡;ä¸€æ¬¡åˆ›å»ºæ¯ä¸ªæ”¯æŸ±ã€‚å†…å¾ªç¯è¿è¡Œ8æ¬¡;åœ¨æŸ±å­ä¸Šæ¯éš”ä¸€æ®µã€‚è¿™äº›å—åªæœ‰åœ¨å®ƒä»¬æ²¡æœ‰å æ®è¢«éšæœºé€‰æ‹©çš„è·ç¦»æ—¶æ‰ä¼šè¢«æ·»åŠ ã€‚æ¯äº”æ¬¡å¤–ç¯è¿è¡Œä¸€æ¬¡ï¼Œé—´éš™çš„å¤§å°å°±ä¼šç¼©å°ä¸€å€ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839//What should the initial size of the gap be between the pillars?let gapSize = 4;//How many pillars?let numberOfPillars = 15;//Loop 15 times to make 15 pillarsfor (let i = 0; i &lt; numberOfPillars; i++) &#123; //Randomly place the gap somewhere inside the pillar let startGapNumber = g.randomInt(0, 8 - gapSize); //Reduce the `gapSize` by one after every fifth pillar. This is //what makes gaps gradually become narrower if (i &gt; 0 &amp;&amp; i % 5 === 0) gapSize -= 1; //Create a block if it's not within the range of numbers //occupied by the gap for (let j = 0; j &lt; 8; j++) &#123; if (j &lt; startGapNumber || j &gt; startGapNumber + gapSize - 1) &#123; let block = g.sprite(\"greenBlock.png\"); blocks.addChild(block); //Space each pillar 384 pixels apart. The first pillar will be //placed at an x position of 512 block.x = (i * 384) + 512; block.y = j * 64; &#125; &#125; //After the pillars have been created, add the finish image //right at the end if (i === numberOfPillars - 1) &#123; finish = g.sprite(\"finish.png\"); blocks.addChild(finish); finish.x = (i * 384) + 896; finish.y = 192; &#125;&#125; ä»£ç çš„æœ€åä¸€éƒ¨åˆ†å‘ä¸–ç•Œæ·»åŠ äº†ä¸€ä¸ªå¤§å‹çš„finishç²¾çµï¼ŒFlappy Fairyå°†ä¼šçœ‹åˆ°å®ƒæ˜¯å¦èƒ½å¤Ÿä¸€ç›´è¿è¡Œåˆ°æœ€åã€‚ æ¸¸æˆå¾ªç¯åœ¨æ¯ä¸€å¸§ä¸­å‘å³ç§»åŠ¨2ä¸ªåƒç´ å—ç»„ï¼Œä½†åªåœ¨ç»“æŸç²¾çµä¸åœ¨å±å¹•ä¸Šæ—¶: 123if (finish.gx &gt; 256) &#123; blocks.x -= 2;&#125; å½“å®Œæˆçš„ç²¾çµæ»šåŠ¨åˆ°ç”»å¸ƒçš„ä¸­å¿ƒæ—¶ï¼Œå—å®¹å™¨å°†åœæ­¢ç§»åŠ¨ã€‚æ³¨æ„ï¼Œä»£ç ä½¿ç”¨finish spriteçš„å…¨å±€xä½ç½®(gx)æ¥æµ‹è¯•å®ƒæ˜¯å¦åœ¨ç”»å¸ƒåŒºåŸŸå†…ã€‚å› ä¸ºå…¨å±€åæ ‡æ˜¯ç›¸å¯¹äºç”»å¸ƒçš„ï¼Œè€Œä¸æ˜¯çˆ¶å®¹å™¨çš„ï¼Œæ‰€ä»¥å¯¹äºè¿™äº›éœ€è¦åœ¨ç”»å¸ƒä¸Šæ‰¾åˆ°åµŒå¥—ç²¾çµä½ç½®çš„æƒ…å†µï¼Œå®ƒä»¬æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ è¯·ç¡®ä¿åœ¨ç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­æ£€æŸ¥å®Œæ•´çš„Flappy Fairyæºä»£ç ï¼Œä»¥ä¾¿æ‚¨èƒ½å¤Ÿåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°æ‰€æœ‰è¿™äº›ä»£ç ã€‚ ä¸HTMLå’ŒCSSçš„é›†æˆHexiå¯ä»¥æ— ç¼åœ°ä½¿ç”¨HTMLå’ŒCSSã€‚æ‚¨å¯ä»¥è‡ªç”±åœ°å°†Hexiç²¾çµå’Œä»£ç ä¸HTMLå…ƒç´ æ··åˆï¼Œå¹¶ä½¿ç”¨Hexiçš„æ¶æ„æ¥æ„å»ºä¸€ä¸ªåŸºäºHTMLçš„åº”ç”¨ç¨‹åºã€‚å¹¶ä¸”ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨HTMLä¸ºæ‚¨çš„Hexiæ¸¸æˆæ„å»ºä¸€ä¸ªä¸°å¯Œçš„ç”¨æˆ·ç•Œé¢ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?æ²³è¥¿é‡‡å–äº†å®Œå…¨ä¸å¹²æ¶‰çš„æ–¹æ³•ã€‚åªéœ€ç¼–å†™æ™®é€šçš„æ—§HTMLå’ŒCSSï¼Œç„¶ååœ¨Hexiä»£ç ä¸­å¼•ç”¨HTMLã€‚è¿™æ˜¯æ‰€æœ‰!Hexiå¹¶æ²¡æœ‰é‡æ–°å‘æ˜è½®å­ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç¼–å†™ä»»ä½•ä½ å–œæ¬¢çš„ä½æ°´å¹³çš„HTML/CSSä»£ç ï¼Œå¹¶å°†å®ƒæ··åˆåˆ°ä½ çš„Hexiåº”ç”¨ç¨‹åºä¸­ã€‚ æ‚¨å¯ä»¥åœ¨è¿™ä¸ªä»£ç å­˜å‚¨åº“ä¸­çš„Hexiç¤ºä¾‹ä¸­æ‰¾åˆ°ä¸€ä¸ªhtmlæ–‡ä»¶å¤¹ä¸­çš„å·¥ä½œç¤ºä¾‹ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ•°å­—çŒœè°œæ¸¸æˆ: åŒ…å«æŒ‰é’®å’Œæ–‡æœ¬è¾“å…¥å­—æ®µçš„ç°è‰²æ¡†æ˜¯HTMLå…ƒç´ ã€‚è¿™äº›HTMLå…ƒç´ (åŒ…æ‹¬æŒ‰é’®)å®Œå…¨æ˜¯ä½¿ç”¨CSSæ ·å¼çš„ã€‚åŠ¨æ€æ–‡æœ¬å’Œå›¾åƒæ˜¯å…­æ¬¡ç²¾çµã€‚ è¿˜æœ‰ä¸€ä¸ªæ— å½¢çš„&lt;div&gt;å…ƒç´ ï¼Œå®ƒçš„å¤§å°å’ŒHexiçš„ç”»å¸ƒä¸€æ ·ï¼Œä½ç½®ä¹Ÿä¸€æ ·ã€‚å¤§çš„&lt;div&gt;å…ƒç´ æµ®åœ¨ç”»å¸ƒä¸Šï¼ŒåŒ…å«ç°è‰²æ¡†ã€æŒ‰é’®å’Œè¾“å…¥å­—æ®µã€‚ è®©æˆ‘ä»¬å¿«é€Ÿåœ°çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä¸»è¦çš„ã€‚htmlæ–‡ä»¶å¦‚ä¸‹: 12345678910111213141516171819202122&lt;!doctype html&gt;&lt;meta charset=\"utf-8\"&gt;&lt;title&gt;Html integration&lt;/title&gt;&lt;link rel=\"stylesheet\" href=\"style.css\"&gt;&lt;body&gt;&lt;!-- UI --&gt;&lt;div id=\"ui\"&gt; &lt;div id=\"box\"&gt; &lt;button&gt;Guess!&lt;/button&gt; &lt;input id=\"input\" type=\"text\" placeholder=\"X...\" maxlength=\"10\" autofocus&gt; &lt;div&gt;&lt;/div&gt;&lt;!-- Hexi --&gt;&lt;script src=\"../../src/modules/pixi.js/bin/pixi.js\"&gt;&lt;/script&gt;&lt;script src=\"../../bin/modules.js\"&gt;&lt;/script&gt;&lt;script src=\"../../bin/core.js\"&gt;&lt;/script&gt;&lt;!-- Main application file --&gt;&lt;script src=\"main.js\"&gt;&lt;/script&gt;&lt;/body&gt; é‡è¦çš„éƒ¨åˆ†æ˜¯UIéƒ¨åˆ†ï¼Œå°±åœ¨&lt;body&gt;æ ‡ç­¾ä¸‹é¢ã€‚å¸¦æœ‰id uiçš„divç”¨äºå°è£…æ¡†ã€æŒ‰é’®å’Œè¾“å…¥ã€‚ é­”æœ¯å‘ç”Ÿåœ¨style.cssæ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†: 1234567891011121314canvas &#123; position : relative &#125;#ui &#123; position : absolute ; left : 0 ; top : 0 ; width : 512px ; height : 512px /*Important: set the z-index to 1 so that it appears above Hexi's canvas*/ ; z-index: 1 &#125; Hexiçš„ç”»å¸ƒè¢«è®¾ç½®ä¸ºç›¸å¯¹ï¼Œui divè¢«è®¾ç½®ä¸ºç»å¯¹ã€‚uiä¹Ÿè¢«è®¾ç½®ä¸ºä¸Hexiçš„ç”»å¸ƒä¸€æ ·çš„å®½åº¦å’Œé«˜åº¦512pxã€‚éå¸¸é‡è¦çš„æ˜¯ï¼Œuiçš„z-indexä¸º1ï¼Œä»¥è¿«ä½¿å®ƒåœ¨ç”»å¸ƒä¹‹ä¸Šæ˜¾ç¤ºã€‚å…¶ä»–HTMLå…ƒç´ (æ¡†ã€æŒ‰é’®å’Œè¾“å…¥å­—æ®µ)éƒ½æ˜¯å®Œå…¨ç›¸å¯¹äºui divå®šä½çš„â€”â€”è¯·æ£€æŸ¥å®Œæ•´çš„CSSä»£ç ä»¥è·å¾—è¯¦ç»†ä¿¡æ¯ã€‚ è¦è®¿é—®ä½ çš„Hexiä»£ç ä¸­çš„æŒ‰é’®å’Œè¾“å…¥å­—æ®µï¼Œåªéœ€åœ¨æ²³è¥¿çš„è®¾ç½®å‡½æ•°ä¸­åˆ›å»ºå¯¹å®ƒä»¬çš„å¼•ç”¨: 12345678function setup() &#123; //Html elements var button = document.querySelector(\"button\"); button.addEventListener(\"click\", buttonClickHandler, false); var input = document.querySelector(\"#input\"); //...The rest of the setup code creates Hexi sprites... ç„¶ååˆ›å»ºä¸€ä¸ªæ™®é€šçš„å‡½æ•°æ¥å¤„ç†æŒ‰é’®ç‚¹å‡»ï¼Œåƒè¿™æ ·: 1234567function buttonClickHandler(event) &#123; //Capture the player's input from the HTML text input field if (input.value) playersGuess = parseInt(input.value); //...the rest of the code...&#125; input.valueå…è®¸æ‚¨è®¿é—®ç”¨æˆ·åœ¨è¾“å…¥å­—æ®µä¸­è¾“å…¥çš„ä»»ä½•å†…å®¹ã€‚è¿™åªæ˜¯æ™®é€šçš„Web APIä»£ç â€”â€”æ²¡ä»€ä¹ˆç‰¹åˆ«çš„!æ‚¨å¯ä»¥ä½¿ç”¨è¯¥å€¼æ¥æ›´æ”¹ä»»ä½•Hexiç²¾çµå±æ€§ã€‚è¯·æŸ¥çœ‹æºä»£ç ä»¥è·å¾—è¯¦ç»†ä¿¡æ¯ï¼Œä½†è¿™å¹¶ä¸ä»¤äººæ„Ÿåˆ°æ„å¤–ã€‚ ä½†æ˜¯ç¤ºä¾‹ä»£ç æœ‰ä¸€ä¸ªè¯€çªï¼Œé‚£å°±æ˜¯å®ƒçš„è¢–å­ã€‚æ•´ä¸ªHexiåº”ç”¨ç¨‹åºåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæ‰©å±•å’Œå¯¹é½ã€‚è¿™æ„å‘³ç€ï¼ŒHexiçš„ç”»å¸ƒå’ŒUI divçš„æ‰©å±•å’Œä¿æŒä¸€è‡´ã€‚å¦‚æœç”¨æˆ·æ”¹å˜æµè§ˆå™¨çª—å£çš„å¤§å°ï¼Œå®ƒä»¬ç”šè‡³ä¼šé‡æ–°ç¼©æ”¾å’Œé‡æ–°å¯¹é½ã€‚è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢?ä¸‹é¢æ˜¯å®ç°æ­¤ç›®çš„çš„JavaScriptä»£ç (åœ¨main.jsæ–‡ä»¶ä¸­ï¼Œå°±åœ¨Hexiçš„æ ‡å‡†åˆå§‹åŒ–ä»£ç ä¹‹å): 12345678//Scale Hexi's canvasg.scaleToWindow();//Scale the html UI &lt;div&gt; containerscaleToWindow(document.querySelector(\"#ui\"));window.addEventListener(\"resize\", function(event)&#123; scaleToWindow(document.querySelector(\"#ui\"));&#125;); Hexiçš„canvasæ˜¯ç”±Hexiå¼•æ“åœ¨å†…éƒ¨ç¼©æ”¾çš„ï¼Œä½†æ˜¯UIå±‚æ˜¯ä½¿ç”¨å…¨å±€scaleToWindowå‡½æ•°ç¼©æ”¾çš„ã€‚(ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°scaleToWindowå‡½æ•°ã€‚) HTMLå’ŒHexiä¹‹é—´çš„æ¾æ•£é›†æˆæ„å‘³ç€æ‚¨å¯ä»¥éšæ„å®šåˆ¶å®ƒã€‚å¦‚æœä½ æƒ³çš„è¯ï¼Œä½ å¯ä»¥åšä¸€äº›ç–¯ç‹‚çš„ä½çº§HTML/CSSç¼–ç¨‹ï¼ŒæŠŠé€»è¾‘å’Œä½ çš„Hexiç²¾çµæ··åˆåœ¨ä¸€èµ·ï¼Œè®¾è®¡ä»»ä½•ä½ éœ€è¦çš„è‡ªå®šä¹‰å¸ƒå±€ã€‚å®ƒåªæ˜¯HTML !è€Œä¸”ï¼Œæ˜¯çš„ï¼Œå¦‚æœä½ æƒ³çš„è¯ï¼Œä½ å¯ä»¥ç”¨Angular, Reactæˆ–Elmæ¥ç¼–å†™ä½ çš„HTMLã€‚","categories":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://jigangduan.github.io/categories/JavaScript/"},{"name":"Pixi.js","slug":"JavaScript/Pixi-js","permalink":"https://jigangduan.github.io/categories/JavaScript/Pixi-js/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"pixijs","slug":"pixijs","permalink":"https://jigangduan.github.io/tags/pixijs/"},{"name":"æ¸¸æˆ","slug":"æ¸¸æˆ","permalink":"https://jigangduan.github.io/tags/æ¸¸æˆ/"},{"name":"hexi","slug":"hexi","permalink":"https://jigangduan.github.io/tags/hexi/"}]},{"title":"WebApp(æˆ–HybridApp)å’ŒReact-Nativeæ¯”è¾ƒ","slug":"WebAppæˆ–HybridAppå’ŒReactNative","date":"2018-06-06T08:37:38.000Z","updated":"2020-07-25T02:57:18.171Z","comments":true,"path":"2018/06/06/WebAppæˆ–HybridAppå’ŒReactNative/","link":"","permalink":"https://jigangduan.github.io/2018/06/06/WebAppæˆ–HybridAppå’ŒReactNative/","excerpt":"","text":"web App(æˆ–Hybrid App)å¼€å‘ç§»åŠ¨APPçš„å¼Šç«¯ ç”¨æˆ·ä½“éªŒï¼Œå·®å¼ºäººæ„ï¼Œæµç•…åº¦å·® éœ€è¦åŸç”Ÿæ¥å£ï¼Œä½†è°ƒè¯•åŸç”Ÿæ—¶éå¸¸çš„ä¸æ–¹ä¾¿ï¼Œæ²¡æœ‰å·¥å…·çš„æ”¯æŒ å„ä¸ªæœºå‹å†…ç½®çš„webviewçš„å·®å¼‚æ€§ï¼Œå¸¦æ¥çš„é€‚é…é—®é¢˜ éš¾ä»¥æ”¯æ’‘ä½“é‡å¤§çš„ä¸šåŠ¡ï¼Œåªèƒ½åšè½»åº”ç”¨ æ²¡æœ‰ä¼˜ç§€çš„æŠ€æœ¯æ¡†æ¶æ”¯æ’‘ï¼Œå•é¡µé¢éš¾ä»¥é€‚åº”ç§»åŠ¨ç«¯çš„åœºæ™¯ï¼›å¤šé¡µé¢å¢åŠ ä¸šåŠ¡å¤æ‚åº¦ï¼ŒæŠ€æœ¯è½å Dcloudç­‰é¡¹ç›®é™ˆæ—§ï¼Œæ²¡æœ‰å¼€æºï¼Œå†…éƒ¨å‡ºç°é—®é¢˜æ— æ³•è·Ÿè¸ª é€‰æ‹©React Nativeçš„ä¼˜åŠ¿å’Œç¼ºç‚¹ UI åŸç”Ÿæ¸²æŸ“ï¼Œå¯¹æ¯”H5ä½“éªŒæ›´ä¸ºé«˜æ•ˆ æ›¿ä»£ä¼ ç»Ÿçš„WebViewï¼Œæ‰“å¼€æ•ˆç‡æ›´é«˜ï¼Œå’ŒåŸç”Ÿä¹‹é—´çš„äº¤äº’æ›´æ–¹ä¾¿ æ‹¥æœ‰äº†ä¸°å¯Œç¬¬ä¸‰æ–¹æ’ä»¶æ”¯æŒ çƒ­æ›´æ–° Reactå¸¦æ¥çš„å…ˆè¿›ç†å¿µ React å­¦ä¹ æ›²çº¿é«˜äºH5 ç›¸å¯¹å¢å¤§äº†appçš„ä½“ç§¯ æœåŠ¡ç«¯æ¸²æŸ“ å¯¹æ¯” å•é¡µé¢ä¼˜ç‚¹ æ›´å¥½çš„SEO æ›´å¿«çš„é¡µé¢å‘ˆç°é€Ÿåº¦ ç¼ºç‚¹ æ›´å¤æ‚çš„å¼€å‘ï¼Œå¼€å‘çš„ä»£ç éœ€è¦å…¼å®¹å‰åç«¯çš„runtime æ›´å¤æ‚çš„æ„å»ºå’Œéƒ¨ç½² åŠ é‡æœåŠ¡å™¨è´Ÿè½½ React å’Œ Vue æ¯”è¾ƒVueçš„ä¼˜åŠ¿ ç®€å•çš„è¯­æ³•å’Œé¡¹ç›®é…ç½® æ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦å’Œæ›´å°çš„ä½“ç§¯ Reactçš„ä¼˜åŠ¿ æ›´é€‚åˆå¤§å‹åº”ç”¨å’Œæ›´å¥½çš„å¯æµ‹è¯•æ€§ æ›´å¤§çš„ç”Ÿæ€ç³»ç»Ÿï¼Œæ›´å¤šçš„æ”¯æŒå’Œå¥½ç”¨çš„å·¥å…·","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"WebAPP","slug":"å‰ç«¯/WebAPP","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/WebAPP/"}],"tags":[{"name":"webapp","slug":"webapp","permalink":"https://jigangduan.github.io/tags/webapp/"}]},{"title":"å‰ç«¯æ¡†æ¶é€‰å‹","slug":"å‰ç«¯æ¡†æ¶é€‰å‹","date":"2018-05-22T08:48:41.000Z","updated":"2020-07-25T02:57:18.235Z","comments":true,"path":"2018/05/22/å‰ç«¯æ¡†æ¶é€‰å‹/","link":"","permalink":"https://jigangduan.github.io/2018/05/22/å‰ç«¯æ¡†æ¶é€‰å‹/","excerpt":"å‰ç«¯æ¡†æ¶é€‰å‹æ˜¯ä»¶å›°éš¾çš„äº‹æƒ…ï¼Œå›°éš¾çš„åŸå› æ˜¯å„ä¸ªæ–¹é¢çš„æƒè¡¡ï¼ŒåŒ…æ‹¬ é¡¹ç›®ä¸šåŠ¡çš„é€‚åº”æ€§ï¼Œå‰ç«¯å¼€å‘äººå‘˜çš„è‡ªèº«æŠ€æœ¯åå‘ï¼Œå„ä¸ªæ¡†æ¶ä¸»å¼ çš„æ€æƒ³ï¼Œå…¥é—¨å’Œåç»­çš„éš¾æ˜“ç¨‹åº¦,æ€§èƒ½æƒ…å†µ,èƒŒåæ”¯æŒåŠç”Ÿæ€ç³»ç»Ÿæ˜¯å¦ä¸°å¯Œâ€¦..ç»¼åˆçš„è€ƒè™‘ï¼Œä½†åˆæ²¡æœ‰ä¸€å®šçš„æ­£ç¡®ç­”æ¡ˆã€‚","text":"å‰ç«¯æ¡†æ¶é€‰å‹æ˜¯ä»¶å›°éš¾çš„äº‹æƒ…ï¼Œå›°éš¾çš„åŸå› æ˜¯å„ä¸ªæ–¹é¢çš„æƒè¡¡ï¼ŒåŒ…æ‹¬ é¡¹ç›®ä¸šåŠ¡çš„é€‚åº”æ€§ï¼Œå‰ç«¯å¼€å‘äººå‘˜çš„è‡ªèº«æŠ€æœ¯åå‘ï¼Œå„ä¸ªæ¡†æ¶ä¸»å¼ çš„æ€æƒ³ï¼Œå…¥é—¨å’Œåç»­çš„éš¾æ˜“ç¨‹åº¦,æ€§èƒ½æƒ…å†µ,èƒŒåæ”¯æŒåŠç”Ÿæ€ç³»ç»Ÿæ˜¯å¦ä¸°å¯Œâ€¦..ç»¼åˆçš„è€ƒè™‘ï¼Œä½†åˆæ²¡æœ‰ä¸€å®šçš„æ­£ç¡®ç­”æ¡ˆã€‚ æ¡†æ¶éœ€æ±‚ æ•´åˆå¤šé¡¹åŠŸèƒ½é¡¹ç›®çš„èƒ½åŠ›ï¼Œæ”¯æ’‘ä¸šåŠ¡çš„æ‰©å±• å°½é‡å…¼å®¹æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯ å…·æœ‰æŠ€æœ¯å…ˆè¿›æ€§å¯æŒç»­å‘å±• ä¸‰å¤§æ¡†æ¶ç›®å‰ä¸»æµçš„å‰ç«¯æ¡†æ¶æ˜¯ Angular, React,Vue AngularAngularç”±Googleè¿›è¡Œç»´æŠ¤ï¼Œå¹¶ç”¨äºGoogle çš„Adwords å’ŒFiberé¡¹ç›®ã€‚æ—¢ç„¶AdWordsæ˜¯Goolgeé‡è¦çš„å¸é‡‘åˆ©å™¨ï¼Œè‡ªç„¶Angularä¸å¤ªå¯èƒ½çªç„¶å¤­æŠ˜ã€‚ Angularè‡ªå¸¦å¾ˆå¤šçš„åŠŸèƒ½ï¼Œæ›´ä¸°å¯Œçš„åŠŸèƒ½å¯¹äºä¸€ä¸ªæ¡†æ¶æ¥è¯´ï¼Œæ˜¯ä¼˜ç‚¹ä¹Ÿæœ‰å¯èƒ½æ˜¯ç¼ºç‚¹ã€‚ åŠŸèƒ½ç‰¹æ€§Angularé™¤äº†æä¾›ä¸€äº›éœ€è¦æœ€æ–°æµè§ˆå™¨æ”¯æŒçš„åŠŸèƒ½å¤–ï¼ŒåŒæ—¶æä¾›ä»¥ä¸‹æ ‡å‡†åŠŸèƒ½ï¼š ä¾èµ–æ³¨å…¥ æ¨¡æ¿ è·¯ç”±ï¼ˆ@angular/routerï¼‰ AJAXï¼ˆ@angular/httpï¼‰ è¡¨å•ï¼ˆ@angular/formsï¼‰ ç»„ä»¶åŒ–CSSå°è£… XSSä¿æŠ¤ å•å…ƒæµ‹è¯•å·¥å…· åŠŸèƒ½ä¸°å¯Œçš„å¥½å¤„å°±æ˜¯ä½ ä¸éœ€è¦é¢å¤–è´¹ç²¾åŠ›å»æŒ‘é€‰ç¬¬ä¸‰æ–¹çš„ç±»åº“ï¼Œç„¶è€Œï¼Œè¿™ä¹ŸåŒæ ·è®©ä½ æ²¡å¾—é€‰æ‹©ã€‚ æ¨¡å¼TypeScriptTypeScriptæ˜¯ä¸€ç§åŸºäºJavaScriptå¼€å‘å¹¶ç”±Microsoftå¼€å‘çš„æ–°è¯­è¨€ã€‚å…¶å®TypeScriptå°±æ˜¯å‰ç«¯å¼€å‘é¢†åŸŸçš„â€œJavaâ€ï¼Œå…¶ç‰¹ç‚¹ï¼ˆTypeï¼ŒGenericsï¼‰å¤©ç”Ÿå¥‘åˆä»¥å›¢é˜Ÿè§„æ¨¡å¼€å‘ä¸ºç›®æ ‡çš„Angularã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸æ˜¯Babelæ¥ç¼–å†™æœ€å…ˆè¿›çš„JavaScriptã€‚å®ƒè¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨æ³¨é‡Šå’Œç±»å‹æ¨æ–­çš„ç»„åˆæ¥é™æ€åˆ†æä½ çš„ä»£ç  RxJSRxJSæ˜¯ä¸€ä¸ªå“åº”å¼ç¼–ç¨‹åº“ï¼Œå¯ä»¥çµæ´»åœ°å¤„ç†å¼‚æ­¥æ“ä½œå’Œäº‹ä»¶ã€‚å®ƒæ˜¯å°†Observerå’ŒIteratoræ¨¡å¼ä¸åŠŸèƒ½ç¼–ç¨‹ç›¸ç»“åˆçš„ç»„åˆã€‚RxJSå…è®¸æ‚¨å°†ä»»ä½•ä¸œè¥¿è§†ä¸ºè¿ç»­çš„æµï¼Œå¹¶å¯¹å…¶è¿›è¡Œå„ç§æ“ä½œï¼Œä¾‹å¦‚æ˜ å°„ï¼Œè¿‡æ»¤ï¼Œæ‹†åˆ†æˆ–åˆå¹¶ã€‚ ç”Ÿæ€ç³»ç»ŸAngular CLICLIå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ‚¨å¼•å¯¼é¡¹ç›®ï¼Œè€Œæ— éœ€è‡ªè¡Œé…ç½®æ„å»ºã€‚å®ƒå…è®¸æ‚¨ä»…ä½¿ç”¨å‡ ä¸ªå‘½ä»¤æ¥ç”Ÿæˆå’Œè¿è¡Œé¡¹ç›®ã€‚è´Ÿè´£æ„å»ºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è„šæœ¬ï¼Œå¯åŠ¨å¼€å‘æœåŠ¡å™¨å’Œè¿è¡Œæµ‹è¯•éƒ½ä¼šåœ¨node_modulesä¸­éšè—ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨å®ƒæ¥ç”Ÿæˆæ–°çš„ä»£ç ã€‚è¿™ä½¿å¾—æ–°é¡¹ç›®çš„è®¾ç½®å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚ IonicIonic å¼€å‘æ··åˆç§»åŠ¨åº”ç”¨ç¨‹åºã€‚Angularé›†æˆçš„Cordovaå®¹å™¨ï¼Œä»¥åŠä¸€ä¸ªæ¼‚äº®çš„ææ–™ç»„ä»¶åº“ã€‚å¯ä»¥è½»æ¾åœ°è®¾ç½®å’Œæ„å»ºç§»åŠ¨åº”ç”¨ç¨‹åºã€‚ Material design componentså¦‚æœæ‚¨çƒ­è¡·äºè®¾è®¡Materialï¼ŒAngularæœ‰ä¸€ä¸ªMaterialç»„ä»¶åº“ æ›´å¤šæ›´å¤šçš„æœ‰å…³Angularç›¸å…³ç±»åº“å’Œå·¥å…·:Awesome Angular list å­¦ä¹ æ›²çº¿Angularä»‹ç»äº†æœ€å¤šçš„æ–°æ¦‚å¿µã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦ä½¿ç”¨TypeScriptã€‚å¯¹äºå…·æœ‰é™æ€ç±»å‹è¯­è¨€ï¼ˆå¦‚Javaæˆ–.NETï¼‰ç»éªŒçš„å¼€å‘äººå‘˜ï¼Œè¿™å¯èƒ½æ¯”JavaScriptæ›´å®¹æ˜“ç†è§£ï¼Œä½†å¯¹äºçº¯JavaScriptå¼€å‘äººå‘˜ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„å­¦ä¹ ã€‚ æ¡†æ¶æœ¬èº«ä¸°å¯Œçš„æŠ€æœ¯ä¸»é¢˜å¯ä»¥ä»è¯¸å¦‚æ¨¡å—ï¼Œä¾èµ–æ³¨å…¥ã€è£…é¥°å™¨ã€ç»„ä»¶ã€æœåŠ¡ã€ç®¡é“ã€æ¨¡æ¿å’ŒæŒ‡ä»¤ç­‰åŸºç¡€å¼€å§‹ï¼Œåˆ°æ›´é«˜çº§çš„ä¸»é¢˜ï¼Œå¦‚æ›´æ”¹æ£€æµ‹ï¼ŒåŒºåŸŸï¼ŒAoTç¼–è¯‘å’ŒRxJSã€‚è¿™äº›éƒ½åœ¨æ–‡æ¡£ä¸­ã€‚RxJSæ˜¯ä¸€ä¸ªå¾ˆé‡çš„è¯é¢˜ï¼Œåœ¨å®˜æ–¹ç½‘ç«™ä¸Šæœ‰è¯¦ç»†æè¿°ã€‚è™½ç„¶åœ¨åŸºæœ¬åŠŸèƒ½å±‚é¢ä¸Šä½¿ç”¨èµ·æ¥ç›¸å¯¹å®¹æ˜“ï¼Œä½†åœ¨è½¬åˆ°é«˜çº§åº”ç”¨æ—¶ä¼šå˜å¾—æ›´åŠ å¤æ‚ã€‚ ReactReactç”±Facebookå¼€å‘å’Œç»´æŠ¤ï¼Œç”¨äºè‡ªå·±çš„äº§å“ï¼ŒåŒ…æ‹¬Instagramå’ŒWhatsAppã€‚å®ƒä¹Ÿæ˜¯GitHub æœ€å—æ¬¢è¿çš„é¡¹ç›®ä¹‹ä¸€ã€‚ åŠŸèƒ½ç‰¹æ€§Reactæœ¬èº«æä¾›çš„åŠŸèƒ½å°±ç›¸å¯¹ ç®€çº¦ï¼š æ— ä¾èµ–æ³¨å…¥ ä½¿ç”¨JSXä»£æ›¿ä¼ ç»Ÿçš„HTML Templates XSSä¿æŠ¤ å•å…ƒæµ‹è¯•å·¥å…· è‡ªç”±åº¦å»æŒ‘é€‰ç¬¬ä¸‰æ–¹çš„ç±»åº“ï¼Œæ¯”å¦‚ï¼š è·¯ç”±ï¼ˆReact-routerï¼‰ AJAXï¼ˆFetch or axiosï¼‰ å„ç§CSSå°è£…ï¼ˆè¯¦è§ æ›´å¼ºå¤§çš„å•å…ƒæµ‹è¯•ï¼ˆEnzymeï¼‰ æ¨¡å¼JSXReactå†³å®šä½¿ç”¨ä¸€ç§ç±»ä¼¼XMLçš„è¯­è¨€åœ¨ç»„ä»¶ä¸­æŠŠæ ‡è®°å’Œä»£ç ç»“åˆèµ·æ¥ï¼Œç›´æ¥åœ¨JavaScriptä»£ç ä¸­ç¼–å†™HTMLæ ‡è®°ã€‚ ä¼˜ç‚¹ï¼šé™æ€åˆ†æã€‚å¦‚æœåœ¨JSXæ ‡è®°ä¸­å‘ç”Ÿé”™è¯¯ï¼Œç¼–è¯‘å™¨ä¼šç«‹å³æŠ¥é”™è€Œä¸æ˜¯ç•™å¾…è¿è¡Œæ—¶å‡ºç°è«åå…¶å¦™çš„é—®é¢˜ã€‚è¿™æœ‰åŠ©äºå¼€å‘äººå‘˜å¿«é€Ÿæ’æŸ¥é”™è¯¯ä»¥åŠé¿å…å…¶å®ƒæ„šè ¢çš„é”™è¯¯ï¼Œæ¯”å¦‚æ‹¼å†™é”™è¯¯ã€‚ FlowFlowæ˜¯ç”±Facebookå¼€å‘çš„JavaScriptç±»å‹æ£€æŸ¥å·¥å…·ã€‚å®ƒå¯ä»¥è§£æä»£ç å¹¶æ£€æŸ¥å¸¸è§çš„ç±»å‹é”™è¯¯ï¼Œå¦‚éšå¼è½¬æ¢æˆ–å–æ¶ˆå¼•ç”¨ã€‚ ä½ çš„ä»£ç æ³¨é‡Šç±»å‹æ£€æŸ¥å·¥ä½œã€‚åœ¨æµç¨‹ä¸­ï¼Œç±»å‹æ³¨é‡Šæ˜¯å¯é€‰çš„ï¼Œå¯ç”¨äºå‘åˆ†æå™¨æä¾›å…¶ä»–æç¤ºã€‚å¦‚æœä½ æƒ³ä½¿ç”¨é™æ€ä»£ç åˆ†æï¼ŒåŒæ—¶é¿å…é‡å†™ç°æœ‰çš„ä»£ç ï¼ŒFlowæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ ReduxReduxæ˜¯ä¸€ä¸ªå¯ä»¥ä»¥æ¸…æ™°çš„æ–¹å¼ç®¡ç†çŠ¶æ€å˜åŒ–çš„åº“ã€‚å®ƒçš„çµæ„Ÿæ¥è‡ªFluxï¼Œä½†æ˜¯æœ‰ä¸€äº›ç®€åŒ–ã€‚Reduxçš„å…³é”®æ€æƒ³åœ¨äºï¼Œåº”ç”¨ç¨‹åºçš„æ•´ä¸ªçŠ¶æ€ç”±å•ä¸ªå¯¹è±¡è¡¨ç¤ºï¼Œè¯¥å¯¹è±¡ç”±åä¸ºreducersçš„å‡½æ•°è¿›è¡Œçªå˜ã€‚Reducersæœ¬èº«æ˜¯çº¯åŠŸèƒ½ï¼Œä¸ç»„ä»¶åˆ†å¼€å®ç°ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°åˆ†ç¦»é—®é¢˜å’Œæµ‹è¯•ã€‚ å¦‚æœä½ æ­£åœ¨å¼€å±•ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œé‚£ä¹ˆå¼•å…¥Reduxå¯èƒ½æœ‰ç‚¹å¾—ä¸å¿å¤±ï¼Œä½†å¯¹äºä¸­ç­‰å’Œå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ ç”Ÿæ€ç³»ç»ŸCreate React AppCreate-react-app æ˜¯ä¸€ä¸ªCLIå·¥å…·ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºæ–°çš„Reactåº”ç”¨ã€‚å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å·¥ç¨‹ï¼Œå¯åŠ¨å¼€å‘æœåŠ¡å™¨å¹¶åˆ›å»ºç»‘å®šã€‚Jestï¼ˆFacebookçš„ä¸€ä¸ªå•å…ƒæµ‹è¯•å·¥å…·ï¼‰ä¹ŸåŒæ—¶é›†æˆåœ¨Create-react-appå†…éƒ¨ï¼Œæ›´æ–¹ä¾¿çš„è®©æˆ‘ä»¬è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ React NativeReact Native æ˜¯Facebookå¼€å‘çš„åŸºäºReactåœ¨ç§»åŠ¨ç«¯çš„å¼€å‘å¹³å°ï¼Œå€ŸåŠ©æ­¤å¹³å°ï¼ŒReactå¯ä»¥åˆ›å»ºçœŸæ­£çš„Nativeçš„UIã€‚æä¾›äº†ä¸€ç³»åˆ—æ ‡å‡†çš„Reactç»„ä»¶ç”¨äºç»‘å®šã€‚åŒæ—¶å…è®¸åˆ›å»ºè‡ªå·±çš„ç»„ä»¶å¹¶ä¸Objective-Cã€Javaæˆ–è€…Swiftçš„ä»£ç è¿›è¡Œç»‘å®šã€‚ Material UIç”¨äºReactçš„Material Design Componentã€‚ä¸Angularçš„ç‰ˆæœ¬ç›¸æ¯”ï¼Œæ¯”è¾ƒæˆç†Ÿï¼Œå¯ä»¥ä½¿ç”¨æ›´å¹¿æ³›çš„ç»„ä»¶ Next.jsNext.jsæ˜¯ä¸€ä¸ªåŸºäºReactå®ç°çš„æœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶ï¼Œgithubåœ°å€ä¸ºnext.jsã€‚ æ›´å¤šå¯ä»¥ä»Awesome React listäº†è§£æ›´å¤šçš„å·¥å…·å’Œç±»åº“ã€‚ å­¦ä¹ æ›²çº¿JSXå¯¹äºä¸€äº›å¼€å‘äººå‘˜æ¥è¯´ä¼¼ä¹åˆšå¼€å§‹ä¼šè§‰å¾—å¾ˆåˆ«æ‰­ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å¢åŠ å¤æ‚æ€§; åªæ˜¯è¡¨è¾¾å¼ï¼Œå®é™…ä¸Šè¿˜æ˜¯JavaScriptï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç±»ä¼¼HTMLçš„è¯­æ³•ã€‚æ‚¨è¿˜éœ€è¦å­¦ä¹ å¦‚ä½•ç¼–å†™ç»„ä»¶ï¼Œä½¿ç”¨propsè¿›è¡Œé…ç½®å’Œç®¡ç†å†…éƒ¨çŠ¶æ€ã€‚ä¸éœ€è¦å­¦ä¹ ä»»ä½•æ–°çš„é€»è¾‘ç»“æ„æˆ–å¾ªç¯ï¼Œå› ä¸ºæ‰€æœ‰è¿™äº›éƒ½æ˜¯çº¯JavaScriptã€‚ å®˜æ–¹æ•™ç¨‹æ˜¯å¼€å§‹å­¦ä¹ Reactçš„å¥½åœ°æ–¹ã€‚ä¸€æ—¦å®Œæˆäº†å®˜æ–¹æ•™ç¨‹ï¼Œæ¥ä¸‹æ¥åº”è¯¥ç†Ÿæ‚‰å¹¶æŒæ¡Reactçš„è·¯ç”±æœºåˆ¶ ã€‚ ä½¿ç”¨Reduxå°†éœ€è¦ä¸€ä¸ªèŒƒå¼çš„è½¬å˜ï¼Œå…è´¹å…¥é—¨Reduxè§†é¢‘è¯¾ç¨‹å¯ä»¥å¿«é€Ÿä»‹ç»æ ¸å¿ƒæ¦‚å¿µã€‚ æ ¹æ®é¡¹ç›®çš„å¤§å°å’Œå¤æ‚æ€§ï¼Œæ‰¾åˆ°å¹¶å­¦ä¹ ä¸€äº›é¢å¤–çš„åº“ã€‚ VueVue.js æ˜¯ä¸€å¥—æ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚å°¤é›¨æºªä¸ªäººåˆ›ç«‹çš„ä¸€ä¸ªå‰ç«¯MVVMæ¡†æ¶ï¼ŒVue.js æ˜¯æ„å»º Web ç•Œé¢çš„ JavaScript åº“ï¼Œæä¾›æ•°æ®é©±åŠ¨çš„ç»„ä»¶ï¼Œè¿˜æœ‰ç®€å•çµæ´»çš„ APIï¼Œä½¿å¾— MVVM æ›´ç®€å•ã€‚ åŠŸèƒ½ç‰¹æ€§Vueæä¾›çš„åŠŸèƒ½å°±ç›¸å¯¹ ç®€çº¦ï¼š è½»é‡çº§çš„æ¡†æ¶ åŒå‘æ•°æ®ç»‘å®š æŒ‡ä»¤ æ’ä»¶åŒ– æ¨¡å¼ç»„ä»¶ç³»ç»ŸæŠŠUIç»“æ„æ˜ å°„åˆ°æ°å½“çš„ç»„ä»¶æ ‘ã€‚Vueçš„ç»„ä»¶å¼•å…¥æ„å»ºå·¥å…·ä¹‹åæœ‰ä¸€ä¸ªå•æ–‡ä»¶ç»„ä»¶æ¦‚å¿µï¼Œå°±æ˜¯è¿™ä¸ªVueæ–‡ä»¶ã€‚åœ¨åŒä¸€ä¸ªVueæ–‡ä»¶é‡Œï¼Œå¯ä»¥åŒæ—¶å†™ template, script å’Œ styleï¼Œä¸‰ä¸ªä¸œè¥¿æ”¾åœ¨ä¸€ä¸ªé‡Œé¢ã€‚åŒæ—¶ï¼ŒVueçš„å•æ–‡ä»¶ç»„ä»¶å’Œ Web Components æœ‰ä¸€ä¸ªæœ¬è´¨ä¸åŒï¼Œå®ƒæ˜¯åŸºäºæ„å»ºå·¥å…·å®ç°ã€‚ å®¢æˆ·ç«¯è·¯ç”± vue-routeråº”ç”¨çš„URLå’Œç»„ä»¶æ ‘çš„çŠ¶æ€ä¹‹é—´æœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œå®¢æˆ·ç«¯è·¯ç”±çš„èŒè´£å°±æ˜¯è®©è¿™ä¸ªæ˜ å°„å…³ç³»å£°æ˜å¼åœ°å¯¹åº”èµ·æ¥ã€‚ çŠ¶æ€ç®¡ç† vuexå®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€. ç”Ÿæ€ç³»ç»Ÿvue-cliVue æä¾›äº†ä¸€ä¸ªå®˜æ–¹çš„ CLIï¼Œä¸ºå•é¡µé¢åº”ç”¨å¿«é€Ÿæ­å»º (SPA) ç¹æ‚çš„è„šæ‰‹æ¶ã€‚å®ƒä¸ºç°ä»£å‰ç«¯å·¥ä½œæµæä¾›äº† batteries-included çš„æ„å»ºè®¾ç½®ã€‚åªéœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´å°±å¯ä»¥è¿è¡Œèµ·æ¥å¹¶å¸¦æœ‰çƒ­é‡è½½ã€ä¿å­˜æ—¶ lint æ ¡éªŒï¼Œä»¥åŠç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„æ„å»ºç‰ˆæœ¬ã€‚ weexWeex è‡´åŠ›äºä½¿å¼€å‘è€…èƒ½åŸºäºå½“ä»£å…ˆè¿›çš„ Web å¼€å‘æŠ€æœ¯ï¼Œä½¿ç”¨åŒä¸€å¥—ä»£ç æ¥æ„å»º Androidã€iOS å’Œ Web åº”ç”¨ã€‚ç›®å‰ä¸»è¦æ”¯æŒ Vue.js å’Œ Rax è¿™ä¸¤ä¸ªå‰ç«¯æ¡†æ¶ã€‚ æœåŠ¡ç«¯æ¸²æŸ“ Nuxt.jsNuxt æ˜¯ä¸€ä¸ªåŸºäº Vue ç”Ÿæ€çš„æ›´é«˜å±‚çš„æ¡†æ¶ï¼Œä¸ºå¼€å‘æœåŠ¡ç«¯æ¸²æŸ“çš„ Vue åº”ç”¨æä¾›äº†æå…¶ä¾¿åˆ©çš„å¼€å‘ä½“éªŒã€‚ æ›´å¤šå¯ä»¥ä»Awesome vue listäº†è§£æ›´å¤šçš„å·¥å…·å’Œç±»åº“ã€‚ å‰äººå¯¹æ¯” React or VueReact or Vue: Which Javascript UI Library Should You Be Using? | Codementor ä¸¤ä¸ªå€¡å¯¼è€…å¯¹æ¯”äº†Reactå’ŒVue,å¾—å‡ºäº†å¦‚ä¸‹ç»“è®ºï¼š å¦‚æœä½ å–œæ¬¢ç”¨ï¼ˆæˆ–å¸Œæœ›èƒ½å¤Ÿç”¨ï¼‰æ¨¡æ¿æ­å»ºåº”ç”¨ï¼Œè¯·ä½¿ç”¨Vue å¦‚æœä½ å–œæ¬¢ç®€å•å’Œâ€œèƒ½ç”¨å°±è¡Œâ€çš„ä¸œè¥¿ï¼Œè¯·ä½¿ç”¨Vue å¦‚æœä½ çš„åº”ç”¨éœ€è¦å°½å¯èƒ½çš„å°å’Œå¿«ï¼Œè¯·ä½¿ç”¨Vue å¦‚æœä½ è®¡åˆ’æ„å»ºä¸€ä¸ªå¤§å‹åº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨React å¦‚æœä½ æƒ³è¦ä¸€ä¸ªåŒæ—¶é€‚ç”¨äºWebç«¯å’ŒåŸç”ŸAppçš„æ¡†æ¶ï¼Œè¯·é€‰æ‹©React å¦‚æœä½ æƒ³è¦æœ€å¤§çš„ç”Ÿæ€åœˆï¼Œè¯·ä½¿ç”¨React å¦‚æœä½ å·²ç»å¯¹å…¶ä¸­ä¸€ä¸ªç”¨å¾—æ»¡æ„äº†ï¼Œå°±æ²¡æœ‰å¿…è¦æ¢äº† UIç»„ä»¶åº“å’Œæœ€ä½³å®è·µMaterial design componentsAnt Design ComponentsåŸºäº Ant Design è®¾è®¡è¯­è¨€ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€å¥—å¼€ç®±å³ç”¨çš„é«˜è´¨é‡ React ç»„ä»¶ï¼Œç”¨äºå¼€å‘å’ŒæœåŠ¡äºä¼ä¸šçº§ä¸­åå°äº§å“ã€‚ Ant Design Pro é¢„è§ˆ ä¼˜é›…ç¾è§‚ï¼šåŸºäº Ant Design ä½“ç³»ç²¾å¿ƒè®¾è®¡ å¸¸è§è®¾è®¡æ¨¡å¼ï¼šæç‚¼è‡ªä¸­åå°åº”ç”¨çš„å…¸å‹é¡µé¢å’Œåœºæ™¯ æœ€æ–°æŠ€æœ¯æ ˆï¼šä½¿ç”¨ React/dva/antd ç­‰å‰ç«¯å‰æ²¿æŠ€æœ¯å¼€å‘ å“åº”å¼ï¼šé’ˆå¯¹ä¸åŒå±å¹•å¤§å°è®¾è®¡ ä¸»é¢˜ï¼šå¯é…ç½®çš„ä¸»é¢˜æ»¡è¶³å¤šæ ·åŒ–çš„å“ç‰Œè¯‰æ±‚ å›½é™…åŒ–ï¼šå†…å»ºä¸šç•Œé€šç”¨çš„å›½é™…åŒ–æ–¹æ¡ˆ æœ€ä½³å®è·µï¼šè‰¯å¥½çš„å·¥ç¨‹å®è·µåŠ©æ‚¨æŒç»­äº§å‡ºé«˜è´¨é‡ä»£ç  Mock æ•°æ®ï¼šå®ç”¨çš„æœ¬åœ°æ•°æ®è°ƒè¯•æ–¹æ¡ˆ UI æµ‹è¯•ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ä¿éšœå‰ç«¯äº§å“è´¨é‡ Elementä¸€å¥—ä¸ºå¼€å‘è€…ã€è®¾è®¡å¸ˆå’Œäº§å“ç»ç†å‡†å¤‡çš„åŸºäº Vue 2.0 çš„æ¡Œé¢ç«¯ç»„ä»¶åº“ vuejs/vue-cli 3.x iviewä¸€å¥—åŸºäº Vue.js çš„é«˜è´¨é‡ UI ç»„ä»¶åº“ iView adminiView adminæ˜¯åŸºäºVue.jsï¼Œæ­é…ä½¿ç”¨iView UIç»„ä»¶åº“å½¢æˆçš„ä¸€å¥—åå°é›†æˆè§£å†³æ–¹æ¡ˆ 2.0ç‰ˆæœ¬é¢„å‘Š Feature ä½¿ç”¨Vue-cliä½œä¸ºé¡¹ç›®è„šæ‰‹æ¶ ä½¿ç”¨Webpack4ç‰ˆæœ¬ï¼ˆå¾…å®šï¼‰ é‡æ•´é¡¹ç›®ç»“æ„ï¼Œæ›´å¥½å°è£…ç»„ä»¶ æ–°å¢æ›´å¤šç»„ä»¶ å¤šçº§èœå• åŠ¨æ€è·¯ç”± é‡æ„æƒé™æ§åˆ¶ä½“ç³» ä½¿ç”¨æœ€æ–°ç‰ˆiViewä»¥åŠiView-editor åŠ å…¥å¤§æ•°æ®é‡è¡¨æ ¼vue-bigdata-tableç»„ä»¶ï¼Œå‡ åä¸‡æ•°æ®æµç•…æ¸²æŸ“ ç§»åŠ¨ç«¯IonicIonic å¼€å‘æ··åˆç§»åŠ¨åº”ç”¨ç¨‹åºã€‚Angularé›†æˆçš„Cordovaå®¹å™¨ï¼Œä»¥åŠä¸€ä¸ªæ¼‚äº®çš„ææ–™ç»„ä»¶åº“ã€‚å¯ä»¥è½»æ¾åœ°è®¾ç½®å’Œæ„å»ºç§»åŠ¨åº”ç”¨ç¨‹åºã€‚ ç¼–å†™ä¸€æ¬¡è¿è¡Œåˆ°å¤šä¸ªå¹³å° Ionic3åŸºäºæœ€æ–°çš„angular4ã€‚Angular4å’ŒTypeScriptä»¥é¢å‘å¯¹è±¡çš„å¼€å‘æ–¹å¼ï¼Œå°†æˆä¸ºç½‘é¡µå¼€å‘çš„ä¸»æµæ–¹å¼ï¼Œè€Œä¸”åœ¨è¯­æ³•ä¸Šä¸Java 8æƒŠäººçš„ç›¸ä¼¼ã€‚ å®˜æ–¹é›†æˆå¸¸è§çš„120å¤šç§apiåŠŸèƒ½ï¼Œå¦‚è“ç‰™ã€HealthKitã€æŒ‡çº¹Authï¼Œå¯ä»¥åŸºäºcordovaæ‰©å±•å‡ ä¹åŸç”Ÿèƒ½å®ç°çš„æ‰€æœ‰åŠŸèƒ½ã€‚ æ€§èƒ½è€Œç”Ÿ-è¿½æ±‚æ€§èƒ½,è¿è¡Œéå¸¸æµç•…ã€‚ è®©æ‚¨æ„Ÿè§‰åˆ°ç”¨html5å¼€å‘çš„appä¹Ÿå¯ä»¥é£èµ·æ¥ã€‚ ä¸“æ³¨åŸç”ŸNative,åŸºäºcordovaï¼Œå®˜æ–¹æä¾›äº†å‡ ç™¾ä¸ªè°ƒç”¨åŸç”Ÿçš„æ’ä»¶ï¼Œå¯ä»¥å¿«é€Ÿçš„è®©æˆ‘ä»¬å®Œæˆè°ƒç”¨æ‘„åƒå¤´ã€äºŒç»´ç ã€è°ƒç”¨æ”¯ä»˜ã€è°ƒç”¨å®šä½ç­‰åŸç”ŸåŠŸèƒ½ å¼ºå¤§çš„å‘½ä»¤è¡Œ,åˆ©ç”¨ionicframeworkåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥åˆ›å»ºï¼Œæ„å»ºï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²ä½ çš„åº”ç”¨ç¨‹åºåœ¨ä»»ä½•å¹³å°ä¸Šã€‚ React Nativereact-nativeé€šè¿‡Componentsè¿›è¡Œç»„ä»¶åŒ–ã€‚å®ƒæŠŠUIåˆ†å‰²æˆç‹¬ç«‹çš„ã€å¯é‡ç”¨çš„éƒ¨ä»¶ ã€‚ Reacté€šè¿‡è™šæ‹ŸDOMå®ç°äº†å¯¹UIå±‚çš„è§£è€¦ï¼ˆæ— è®ºæ˜¯androidè¿˜æ˜¯iosï¼‰ å°†æµè§ˆå™¨çš„DOMæ ‘æ›¿æ¢ä¸ºNativeçš„UIæ¨¡å—ï¼Œä½¿Reactåœ¨ç§»åŠ¨ç«¯è¿›è¡Œæ¸²æŸ“ é‡‡ç”¨Nativeçš„æ ¸å¿ƒAPIå®Œæˆreactä¸nativeçš„é€šä¿¡ ä½¿ç”¨React Nativeä¸€å¹´åçš„æ„Ÿå— react-nativeæŠ€æœ¯çš„ä¼˜åŠ£ weexWeex è‡´åŠ›äºä½¿å¼€å‘è€…èƒ½åŸºäºå½“ä»£å…ˆè¿›çš„ Web å¼€å‘æŠ€æœ¯ï¼Œä½¿ç”¨åŒä¸€å¥—ä»£ç æ¥æ„å»º Androidã€iOS å’Œ Web åº”ç”¨ã€‚å…·ä½“æ¥è®²ï¼Œåœ¨é›†æˆäº† WeexSDK ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨ JavaScript å’Œç°ä»£æµè¡Œçš„å‰ç«¯æ¡†æ¶æ¥å¼€å‘ç§»åŠ¨åº”ç”¨ã€‚ weexåªæ˜¯æä¾›äº†å¾ˆå¥½çš„å¤šå¹³å°é›†æˆæ–¹å¼ï¼Œä½†è‡ªèº«æä¾›çš„ç»„ä»¶å¾ˆå°‘ï¼Œæ²¡æœ‰é¡¹ç›®ä¸Šçš„ç»“æ„ï¼Œè¿™æ–¹é¢å¯ä»¥å¼•ç”¨ WeexEros) WeexEroseros æ˜¯åŸºäº weex å°è£…é¢å‘å‰ç«¯çš„ vue å†™æ³•çš„è§£å†³æ–¹æ¡ˆï¼Œç”±äº app å¼€å‘çš„ç‰¹æ®Šæ€§ï¼Œeros åˆ™æ›´åé‡å…³å¿ƒäºæ•´ä¸ª app é¡¹ç›®ã€‚ è¯¦ç»†çš„æ–‡æ¡£æ¥è§£å†³ç¯å¢ƒæ­å»ºè¿‡ç¨‹ä¸­çš„å‘ã€‚ ä¸€å¥—ä»£ç ç¼–è¯‘æˆ iosï¼Œandroid ä¸¤ç«¯åŸç”Ÿåº”ç”¨ã€‚ å°è£…äº†å¤§é‡ weex moduleï¼Œè®©å‰ç«¯å¼€å‘æ–¹ä¾¿è¿›è¡ŒåŸç”Ÿçš„æ“ä½œã€‚ æ”¯æŒå¤§é‡ echart å®ä¾‹è¿è¡Œã€‚ å¯ä»¥é€šè¿‡ appboard æœºåˆ¶æ¥å‡å°‘å¤šé¡µé¢é¡¹ç›®ä¸­çš„ä»£ç å†—ä½™ï¼Œå‡å°‘åŒ…ä½“ç§¯ï¼Œå¹¶å¯ä»¥å¯¹å…¶å®æ—¶ä¿®æ”¹ã€‚ å†…ç½®äº†ä¸€å¥—å®Œæ•´çš„ JS äºŒæ¬¡å°è£… module (widget) ï¼Œç›´æ¥é€šè¿‡ vue æ’ä»¶ç³»ç»Ÿæ³¨å…¥ï¼Œç›´æ¥åœ¨ this ä¸Šè°ƒç”¨ï¼Œå¯æ ¹æ®ä¸šåŠ¡è‡ªè¡Œä¿®æ”¹ã€‚ å†…ç½®äº†ä¸­ä»‹è€…æœåŠ¡ï¼Œæ¥è¿›è¡Œå¤šä¸ªé¡µé¢é—´çš„äº¤äº’ï¼Œå¹¶å¯ä»¥ç®¡ç†ä¸šåŠ¡ã€‚ å†…ç½®äº†æœåŠ¡å™¨ç«¯å¢é‡å‘å¸ƒæ›´æ–°é€»è¾‘ï¼Œå¯ä»¥æ­é…ç€å¼€æºçš„ç®€æ˜“å¢é‡å‘å¸ƒç³»ç»Ÿä¸€èµ·ä½¿ç”¨ã€‚ æ”¯æŒçœŸæœºå’Œæ¨¡æ‹Ÿå™¨é€šè¿‡ weex debug æ¥æ–­ç‚¹è°ƒè¯•ï¼Œç¨‹åºæŠ¥é”™å‡ä¼šæœ‰æŠ¥é”™æ—¥å¿—å¼¹çª—æç¤ºã€‚ Ionic vs React NativeIonic vs React Native: å‰ç«¯æ¡†æ¶ä¹‹äº‰ï¼Œè°æ›´èƒœä¸€ç­¹ï¼Ÿ weex&amp;ReactNativeå¯¹æ¯”weex&amp;ReactNativeå¯¹æ¯”","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"}],"tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬å…«éƒ¨åˆ†","slug":"go-micro-tutorial-8","date":"2018-05-10T13:57:01.000Z","updated":"2020-07-25T02:57:18.206Z","comments":true,"path":"2018/05/10/go-micro-tutorial-8/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-8/","excerpt":"","text":"åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ç”¨Terraformåˆ›å»ºä¸€ä¸ªå®¹å™¨å¼•æ“é›†ç¾¤ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®¹å™¨å¼•æ“å’ŒKubernetesæ¥ç ”ç©¶å¦‚ä½•å°†å®¹å™¨éƒ¨ç½²åˆ°æˆ‘ä»¬çš„é›†ç¾¤ä¸­ã€‚ Kubernetesé¦–å…ˆ,Kubernetesæ˜¯ä»€ä¹ˆ?Kubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç®¡ç†æ¡†æ¶ã€‚å®ƒæ˜¯å¹³å°æ— å…³çš„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨æœ¬åœ°æœºå™¨ã€AWSã€è°·æ­Œäº‘æˆ–å…¶ä»–ä»»ä½•åœ°æ–¹è¿è¡Œå®ƒã€‚å®ƒå…è®¸æ‚¨ä½¿ç”¨è§£å¯†é…ç½®æ§åˆ¶å®¹å™¨ç»„å’Œå®ƒä»¬çš„ç½‘ç»œè§„åˆ™ã€‚ æ‚¨åªéœ€ç¼–å†™æè¿°å“ªäº›å®¹å™¨åº”è¯¥è¿è¡Œçš„yaml/jsonæ–‡ä»¶ï¼Œä»¥åŠåœ¨ä½•å¤„è¿è¡Œã€‚æ‚¨å¯ä»¥å®šä¹‰æ‚¨çš„ç½‘ç»œè§„åˆ™ï¼Œä¾‹å¦‚ä»»ä½•ç«¯å£è½¬å‘ã€‚å®ƒè¿˜ä¸ºæ‚¨å¤„ç†æœåŠ¡å‘ç°ã€‚ Kubernetesæ˜¯äº‘åœºæ™¯ä¸­æœ€é‡è¦çš„æ·»åŠ ç‰©ä¹‹ä¸€ï¼Œå®ƒæ­£è¿…é€Ÿæˆä¸ºäº‘å®¹å™¨ç®¡ç†çš„å®é™…é€‰æ‹©ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç†è§£ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§! é¦–å…ˆï¼Œç¡®ä¿æ‚¨åœ¨æœ¬åœ°å®‰è£…äº†kubectl cli: 1$ gcloud components install kubectl ç°åœ¨è®©æˆ‘ä»¬ç¡®ä¿æ‚¨å·²ç»è¿æ¥åˆ°æ‚¨çš„é›†ç¾¤å¹¶æ­£ç¡®åœ°è¿›è¡Œäº†èº«ä»½éªŒè¯ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šç™»å½•å¹¶ç¡®è®¤æˆ‘ä»¬çš„èº«ä»½ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å°†è®¾ç½®é¡¹ç›®è®¾ç½®ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä½¿ç”¨æ­£ç¡®çš„é¡¹ç›®IDå’Œå¯ç”¨æ€§åŒºåŸŸã€‚ 12345678$ echo \"This command will open a web browser, and will ask you to login$ gcloud auth application-default login$ gcloud config set project shippy-freight$ gcloud config set compute/zone eu-west2-a$ echo \"Now generate a security token and access to your KB cluster\"$ gcloud container clusters get-credentials shippy-freight-cluster åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦ç”¨æ‰€é€‰æ‹©çš„åŒºåŸŸæ›¿æ¢è®¡ç®—/åŒºåŸŸï¼Œæ‚¨çš„é¡¹ç›®idå’Œé›†ç¾¤åç§°ä¹Ÿå¯èƒ½ä¸æˆ‘çš„ä¸åŒã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå¤§çº²â€¦â€¦","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬ä¸ƒéƒ¨åˆ†","slug":"go-micro-tutorial-7","date":"2018-05-10T13:56:56.000Z","updated":"2020-07-25T02:57:18.206Z","comments":true,"path":"2018/05/10/go-micro-tutorial-7/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-7/","excerpt":"åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç®€è¦ä»‹ç»äº†ç”¨æˆ·ç•Œé¢å’Œwebå®¢æˆ·ç«¯ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¾®å·¥å…·åŒ…rpcä»£ç†ä¸æ–°åˆ›å»ºçš„rpcæœåŠ¡è¿›è¡Œäº¤äº’ã€‚ è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªäº‘ç¯å¢ƒæ¥æ‰¿è½½æˆ‘ä»¬çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨Terraformæ¥æ¶æ„æˆ‘ä»¬çš„äº‘é›†ç¾¤åœ¨è°·æ­Œäº‘å¹³å°ä¸Šã€‚è¿™åº”è¯¥æ˜¯ä¸€ç¯‡ç›¸å½“çŸ­çš„æ–‡ç« ï¼Œä½†å®ƒå¾ˆé‡è¦ã€‚","text":"åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç®€è¦ä»‹ç»äº†ç”¨æˆ·ç•Œé¢å’Œwebå®¢æˆ·ç«¯ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¾®å·¥å…·åŒ…rpcä»£ç†ä¸æ–°åˆ›å»ºçš„rpcæœåŠ¡è¿›è¡Œäº¤äº’ã€‚ è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªäº‘ç¯å¢ƒæ¥æ‰¿è½½æˆ‘ä»¬çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨Terraformæ¥æ¶æ„æˆ‘ä»¬çš„äº‘é›†ç¾¤åœ¨è°·æ­Œäº‘å¹³å°ä¸Šã€‚è¿™åº”è¯¥æ˜¯ä¸€ç¯‡ç›¸å½“çŸ­çš„æ–‡ç« ï¼Œä½†å®ƒå¾ˆé‡è¦ã€‚ ä¸ºä»€ä¹ˆTerraform","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬å…­éƒ¨åˆ†","slug":"go-micro-tutorial-6","date":"2018-05-10T13:56:52.000Z","updated":"2020-07-25T02:57:18.205Z","comments":true,"path":"2018/05/10/go-micro-tutorial-6/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-6/","excerpt":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸€äº›åœ¨go-microå’Œgoä¸­äº‹ä»¶é©±åŠ¨æ¶æ„çš„å„ç§æ–¹æ³•ã€‚è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ·±å…¥åˆ°å®¢æˆ·ç«¯ï¼Œçœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸æˆ‘ä»¬çš„å¹³å°äº¤äº’çš„webå®¢æˆ·ç«¯ã€‚ æˆ‘ä»¬å°†ç ”ç©¶å¾®å‹å·¥å…·åŒ…ï¼Œä½¿æ‚¨èƒ½å¤Ÿå°†å†…éƒ¨rpcæ–¹æ³•ä»å¤–éƒ¨ä»£ç†åˆ°webå®¢æˆ·ç«¯ã€‚ æˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„å¹³å°åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä»¥åŠä¸€ä¸ªåˆ›å»ºå§”æ‰˜ç•Œé¢ã€‚è¿™å°†æŠŠä»¥å‰çš„ä¸€äº›å¸–å­è”ç³»åœ¨ä¸€èµ·ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§!","text":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸€äº›åœ¨go-microå’Œgoä¸­äº‹ä»¶é©±åŠ¨æ¶æ„çš„å„ç§æ–¹æ³•ã€‚è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ·±å…¥åˆ°å®¢æˆ·ç«¯ï¼Œçœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸æˆ‘ä»¬çš„å¹³å°äº¤äº’çš„webå®¢æˆ·ç«¯ã€‚ æˆ‘ä»¬å°†ç ”ç©¶å¾®å‹å·¥å…·åŒ…ï¼Œä½¿æ‚¨èƒ½å¤Ÿå°†å†…éƒ¨rpcæ–¹æ³•ä»å¤–éƒ¨ä»£ç†åˆ°webå®¢æˆ·ç«¯ã€‚ æˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„å¹³å°åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä»¥åŠä¸€ä¸ªåˆ›å»ºå§”æ‰˜ç•Œé¢ã€‚è¿™å°†æŠŠä»¥å‰çš„ä¸€äº›å¸–å­è”ç³»åœ¨ä¸€èµ·ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§! RPCå¤å…´RESTå·²ç»åœ¨webä¸Šè¿è¡Œå¤šå¹´äº†ï¼Œå®ƒå·²ç»è¿…é€Ÿæˆä¸ºç®¡ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´èµ„æºçš„gotoæ–¹å¼ã€‚RESTçš„å‡ºç°ï¼Œå–ä»£äº†RPCå’ŒSOAPå®ç°çš„ç‹‚é‡è¥¿éƒ¨ï¼Œè¿™ç§æ–¹å¼æœ‰æ—¶ä¼šè®©äººè§‰å¾—è¿‡æ—¶å’Œç—›è‹¦ã€‚æ›¾ç»éœ€è¦ç¼–å†™wsdlæ–‡ä»¶å—? RESTå‘æˆ‘ä»¬æ‰¿è¯ºäº†ä¸€ç§å®ç”¨çš„ã€ç®€å•çš„ã€ç»Ÿä¸€çš„ç®¡ç†èµ„æºçš„æ–¹æ³•ã€‚RESTä½¿ç”¨httpè°“è¯åœ¨æ‰§è¡Œçš„æ“ä½œç±»å‹ä¸­æ›´åŠ æ˜¾å¼ã€‚RESTé¼“åŠ±æˆ‘ä»¬ä½¿ç”¨httpé”™è¯¯ä»£ç æ¥æ›´å¥½åœ°æè¿°æœåŠ¡å™¨çš„å“åº”ã€‚åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œè¿™ç§æ–¹æ³•è¿è¡Œè‰¯å¥½ï¼Œè€Œä¸”å¾ˆå¥½ã€‚ä½†æ˜¯åƒæ‰€æœ‰çš„å¥½ä¸œè¥¿ä¸€æ ·ï¼Œä¼‘æ¯ä¹Ÿæœ‰å¾ˆå¤šæŠ±æ€¨å’Œçƒ¦æ¼ï¼Œæˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œè¯¦ç»†è¯´æ˜ã€‚ä½†è¯·åŠ¡å¿…é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚ä½†éšç€å¾®æœåŠ¡çš„å‡ºç°ï¼ŒRPCæ­£åœ¨å·åœŸé‡æ¥ã€‚ Restå¯¹äºç®¡ç†ä¸åŒçš„èµ„æºéå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯å¾®æœåŠ¡é€šå¸¸åªå¤„ç†å•ä¸ªèµ„æºçš„æœ¬è´¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨å¾®æœåŠ¡ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨RESTfulæœ¯è¯­ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºæ¯ä¸ªæœåŠ¡çš„å…·ä½“æ“ä½œå’Œäº¤äº’ã€‚ Microåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¹¿æ³›åœ°ä½¿ç”¨äº†go-microï¼Œç°åœ¨æˆ‘ä»¬å°†è®¨è®ºmicrocli /toolkitã€‚microtoolkitæä¾›äº†ä¸€ä¸ªAPIç½‘å…³ã€ä¸€ä¸ªsidecarã€ä¸€ä¸ªwebä»£ç†ä»¥åŠå…¶ä»–ä¸€äº›å¾ˆé…·çš„ç‰¹æ€§ã€‚ä½†æˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„ä¸»è¦éƒ¨åˆ†æ˜¯APIç½‘å…³ã€‚ APIç½‘å…³å°†å…è®¸æˆ‘ä»¬å°†rpcè°ƒç”¨ä»£ç†åˆ°webå‹å¥½çš„JSON rpcè°ƒç”¨ï¼Œå¹¶å°†å…¬å¼€æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨çš„urlã€‚ é‚£ä¹ˆè¿™æ˜¯å¦‚ä½•è¿ä½œçš„å‘¢?ä½ é¦–å…ˆè¦ç¡®ä¿å®‰è£…äº†å¾®å‹å·¥å…·åŒ…: 1$ go get -u github.com/micro/micro æ›´å¥½çš„æ˜¯ï¼Œæ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨Dockerï¼Œè®©æˆ‘ä»¬ä½¿ç”¨Dockeræ˜ åƒ: 1$ docker pull microhq/micro ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡ï¼Œæˆ‘åšäº†ä¸€äº›æ›´æ”¹ï¼Œä¸»è¦æ˜¯é”™è¯¯å¤„ç†å’Œå‘½åçº¦å®š: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// shippy-user-service/main.gopackage mainimport ( \"log\" pb \"github.com/EwanValentine/shippy-user-service/proto/auth\" \"github.com/micro/go-micro\" _ \"github.com/micro/go-plugins/registry/mdns\")func main() &#123; // Creates a database connection and handles // closing it again before exit. db, err := CreateConnection() defer db.Close() if err != nil &#123; log.Fatalf(\"Could not connect to DB: %v\", err) &#125; // Automatically migrates the user struct // into database columns/types etc. This will // check for changes and migrate them each time // this service is restarted. db.AutoMigrate(&amp;pb.User&#123;&#125;) repo := &amp;UserRepository&#123;db&#125; tokenService := &amp;TokenService&#123;repo&#125; // Create a new service. Optionally include some options here. srv := micro.NewService( // This name must match the package name given in your protobuf definition micro.Name(\"shippy.auth\"), ) // Init will parse the command line flags. srv.Init() // Will comment this out for now to save having to run this locally... // publisher := micro.NewPublisher(\"user.created\", srv.Client()) // Register handler pb.RegisterAuthHandler(srv.Server(), &amp;service&#123;repo, tokenService, publisher&#125;) // Run the server if err := srv.Run(); err != nil &#123; log.Fatal(err) &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839// shippy-user-service/proto/auth/auth.protosyntax = &quot;proto3&quot;;package auth;service Auth &#123; rpc Create(User) returns (Response) &#123;&#125; rpc Get(User) returns (Response) &#123;&#125; rpc GetAll(Request) returns (Response) &#123;&#125; rpc Auth(User) returns (Token) &#123;&#125; rpc ValidateToken(Token) returns (Token) &#123;&#125;&#125;message User &#123; string id = 1; string name = 2; string company = 3; string email = 4; string password = 5;&#125;message Request &#123;&#125;message Response &#123; User user = 1; repeated User users = 2; repeated Error errors = 3;&#125;message Token &#123; string token = 1; bool valid = 2; repeated Error errors = 3;&#125;message Error &#123; int32 code = 1; string description = 2;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102// shippy-user-service/handler.gopackage mainimport ( \"errors\" \"fmt\" \"log\" pb \"github.com/EwanValentine/shippy-user-service/proto/auth\" micro \"github.com/micro/go-micro\" \"golang.org/x/crypto/bcrypt\" \"golang.org/x/net/context\")const topic = \"user.created\"type service struct &#123; repo Repository tokenService Authable Publisher micro.Publisher&#125;func (srv *service) Get(ctx context.Context, req *pb.User, res *pb.Response) error &#123; user, err := srv.repo.Get(req.Id) if err != nil &#123; return err &#125; res.User = user return nil&#125;func (srv *service) GetAll(ctx context.Context, req *pb.Request, res *pb.Response) error &#123; users, err := srv.repo.GetAll() if err != nil &#123; return err &#125; res.Users = users return nil&#125;func (srv *service) Auth(ctx context.Context, req *pb.User, res *pb.Token) error &#123; log.Println(\"Logging in with:\", req.Email, req.Password) user, err := srv.repo.GetByEmail(req.Email) log.Println(user, err) if err != nil &#123; return err &#125; // Compares our given password against the hashed password // stored in the database if err := bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(req.Password)); err != nil &#123; return err &#125; token, err := srv.tokenService.Encode(user) if err != nil &#123; return err &#125; res.Token = token return nil&#125;func (srv *service) Create(ctx context.Context, req *pb.User, res *pb.Response) error &#123; log.Println(\"Creating user: \", req) // Generates a hashed version of our password hashedPass, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost) if err != nil &#123; return errors.New(fmt.Sprintf(\"error hashing password: %v\", err)) &#125; req.Password = string(hashedPass) if err := srv.repo.Create(req); err != nil &#123; return errors.New(fmt.Sprintf(\"error creating user: %v\", err)) &#125; res.User = req if err := srv.Publisher.Publish(ctx, req); err != nil &#123; return errors.New(fmt.Sprintf(\"error publishing event: %v\", err)) &#125; return nil&#125;func (srv *service) ValidateToken(ctx context.Context, req *pb.Token, res *pb.Token) error &#123; // Decode token claims, err := srv.tokenService.Decode(req.Token) if err != nil &#123; return err &#125; if claims.User.Id == \"\" &#123; return errors.New(\"invalid user\") &#125; res.Valid = true return nil&#125; ç°åœ¨è¿è¡Œ$ make build &amp;&amp; make runã€‚ç„¶åå‰å¾€æ‚¨çš„shippy- emailserviceæœåŠ¡å¹¶è¿è¡Œ$ make build &amp;&amp; make runã€‚ä¸€æ—¦ä¸¤è€…éƒ½è¿è¡Œï¼Œè¿è¡Œ: 123456$ docker run -p 8080:8080 \\ -e MICRO_REGISTRY=mdns \\ microhq/micro api \\ --handler=rpc \\ --address=:8080 \\ --namespace=shippy è¿™åœ¨Dockerå®¹å™¨ä¸­ä½œä¸ºç«¯å£8080çš„rpcå¤„ç†ç¨‹åºè¿è¡Œå¾®apiç½‘å…³ã€‚æˆ‘ä»¬å‘Šè¯‰å®ƒåœ¨æœ¬åœ°ä½¿ç”¨mdnsä½œä¸ºæ³¨å†Œè¡¨ï¼Œä¸å…¶ä»–æœåŠ¡ç›¸åŒã€‚æœ€åï¼Œæˆ‘ä»¬å‘Šè¯‰å®ƒä½¿ç”¨åç§°ç©ºé—´shippyï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€æœ‰æœåŠ¡åç§°çš„ç¬¬ä¸€éƒ¨åˆ†shippy.authæˆ–shippy.emailã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒé»˜è®¤ä¸ºgo.micro.apiï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†æ— æ³•æ‰¾åˆ°æˆ‘ä»¬çš„æœåŠ¡æ¥ä»£ç†å®ƒä»¬ã€‚ æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡æ–¹æ³•ç°åœ¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨: åˆ›å»ºä¸€ä¸ªç”¨æˆ·: 123curl -XPOST -H 'Content-Type: application/json' \\ -d '&#123; \"service\": \"shippy.auth\", \"method\": \"Auth.Create\", \"request\": &#123; \"user\": &#123; \"email\": \"ewan.valentine89@gmail.com\", \"password\": \"testing123\", \"name\": \"Ewan Valentine\", \"company\": \"BBC\" &#125; &#125; &#125;' \\ http://localhost:8080/rpc å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬åœ¨è¯·æ±‚ä¸­åŒ…æ‹¬æˆ‘ä»¬å¸Œæœ›è¢«è·¯ç”±çš„æœåŠ¡ã€æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æœåŠ¡çš„æ–¹æ³•ï¼Œä»¥åŠæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çš„æ•°æ®ã€‚ éªŒè¯ä¸€ä¸ªç”¨æˆ·: 123$ curl -XPOST -H 'Content-Type: application/json' \\ -d '&#123; \"service\": \"shippy.auth\", \"method\": \"Auth.Auth\", \"request\": &#123; \"email\": \"your@email.com\", \"password\": \"SomePass\" &#125; &#125;' \\ http://localhost:8080/rpc å¯„å”®æœåŠ¡ç°åœ¨æ˜¯æ—¶å€™é‡æ–°å¯åŠ¨æˆ‘ä»¬çš„å¯„å”®æœåŠ¡äº†ï¼Œ$ make build &amp;&amp; make runã€‚æˆ‘ä»¬ä¸éœ€è¦åœ¨è¿™é‡Œä¿®æ”¹ä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯ï¼Œè¿è¡Œrpcä»£ç†ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåšåˆ°: åˆ›å»ºä¸€ä¸ªå§”æ‰˜: 12345678910$ curl -XPOST -H 'Content-Type: application/json' \\ -d '&#123; \"service\": \"shippy.consignment\", \"method\": \"ConsignmentService.Create\", \"request\": &#123; \"description\": \"This is a test\", \"weight\": \"500\", \"containers\": [] &#125; &#125;' --url http://localhost:8080/rpc èˆ¹æœåŠ¡ä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œçš„æœ€ç»ˆæœåŠ¡æ˜¯æˆ‘ä»¬çš„èˆ¹åªæœåŠ¡ï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œæ‰€ä»¥åªè¦è¿è¡Œ$ make build &amp;&amp; make runã€‚ ç”¨æˆ·ç•Œé¢è®©æˆ‘ä»¬ä½¿ç”¨æ–°çš„rpcç«¯ç‚¹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªUIã€‚æˆ‘ä»¬å°†ä½¿ç”¨Reactï¼Œä½†ä½ å¯ä»¥éšæ„ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„ã€‚è¯·æ±‚éƒ½æ˜¯ä¸€æ ·çš„ã€‚æˆ‘å°†ä½¿ç”¨æ¥è‡ªFacebookçš„react-create-app libraryã€‚$ npm install -g react-create-app.ä¸€æ—¦å®‰è£…å¥½ï¼Œä½ å°±å¯ä»¥åš$ react-create-app shippy-uiäº†ã€‚è¿™å°†ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªååº”åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹â€¦ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// shippy-ui/src/App.jsimport React, &#123; Component &#125; from 'react';import './App.css';import CreateConsignment from './CreateConsignment';import Authenticate from './Authenticate';class App extends Component &#123; state = &#123; err: null, authenticated: false, &#125; onAuth = (token) =&gt; &#123; this.setState(&#123; authenticated: true, &#125;); &#125; renderLogin = () =&gt; &#123; return ( &lt;Authenticate onAuth=&#123;this.onAuth&#125; /&gt; ); &#125; renderAuthenticated = () =&gt; &#123; return ( &lt;CreateConsignment /&gt; ); &#125; getToken = () =&gt; &#123; return localStorage.getItem('token') || false; &#125; isAuthenticated = () =&gt; &#123; return this.state.authenticated || this.getToken() || false; &#125; render() &#123; const authenticated = this.isAuthenticated(); return ( &lt;div className=\"App\"&gt; &lt;div className=\"App-header\"&gt; &lt;h2&gt;Shippy&lt;/h2&gt; &lt;/div&gt; &lt;div className='App-intro container'&gt; &#123;(authenticated ? this.renderAuthenticated() : this.renderLogin())&#125; &lt;/div&gt; &lt;/div&gt; ); &#125;&#125;export default App; ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸»è¦çš„ä¸¤ä¸ªç»„ä»¶ï¼Œèº«ä»½éªŒè¯å’Œcreatecon: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139// shippy-ui/src/Authenticate.jsimport React from 'react';class Authenticate extends React.Component &#123; constructor(props) &#123; super(props); &#125; state = &#123; authenticated: false, email: '', password: '', err: '', &#125; login = () =&gt; &#123; fetch(`http://localhost:8080/rpc`, &#123; method: 'POST', headers: &#123; 'Content-Type': 'application/json', &#125;, body: JSON.stringify(&#123; request: &#123; email: this.state.email, password: this.state.password, &#125;, service: 'shippy.auth', method: 'Auth.Auth', &#125;), &#125;) .then(res =&gt; res.json()) .then(res =&gt; &#123; this.props.onAuth(res.token); this.setState(&#123; token: res.token, authenticated: true, &#125;); &#125;) .catch(err =&gt; this.setState(&#123; err, authenticated: false, &#125;)); &#125; signup = () =&gt; &#123; fetch(`http://localhost:8080/rpc`, &#123; method: 'POST', headers: &#123; 'Content-Type': 'application/json', &#125;, body: JSON.stringify(&#123; request: &#123; email: this.state.email, password: this.state.password, name: this.state.name, &#125;, method: 'Auth.Create', service: 'shippy.auth', &#125;), &#125;) .then((res) =&gt; res.json()) .then((res) =&gt; &#123; this.props.onAuth(res.token.token); this.setState(&#123; token: res.token.token, authenticated: true, &#125;); localStorage.setItem('token', res.token.token); &#125;) .catch(err =&gt; this.setState(&#123; err, authenticated: false, &#125;)); &#125; setEmail = e =&gt; &#123; this.setState(&#123; email: e.target.value, &#125;); &#125; setPassword = e =&gt; &#123; this.setState(&#123; password: e.target.value, &#125;); &#125; setName = e =&gt; &#123; this.setState(&#123; name: e.target.value, &#125;); &#125; render() &#123; return ( &lt;div className='Authenticate'&gt; &lt;div className='Login'&gt; &lt;div className='form-group'&gt; &lt;input type=\"email\" onChange=&#123;this.setEmail&#125; placeholder='E-Mail' className='form-control' /&gt; &lt;/div&gt; &lt;div className='form-group'&gt; &lt;input type=\"password\" onChange=&#123;this.setPassword&#125; placeholder='Password' className='form-control' /&gt; &lt;/div&gt; &lt;button className='btn btn-primary' onClick=&#123;this.login&#125;&gt;Login&lt;/button&gt; &lt;br /&gt;&lt;br /&gt; &lt;/div&gt; &lt;div className='Sign-up'&gt; &lt;div className='form-group'&gt; &lt;input type='input' onChange=&#123;this.setName&#125; placeholder='Name' className='form-control' /&gt; &lt;/div&gt; &lt;div className='form-group'&gt; &lt;input type='email' onChange=&#123;this.setEmail&#125; placeholder='E-Mail' className='form-control' /&gt; &lt;/div&gt; &lt;div className='form-group'&gt; &lt;input type='password' onChange=&#123;this.setPassword&#125; placeholder='Password' className='form-control' /&gt; &lt;/div&gt; &lt;button className='btn btn-primary' onClick=&#123;this.signup&#125;&gt;Sign-up&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; ); &#125;&#125;export default Authenticate; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118// shippy-ui/src/CreateConsignment.jsimport React from 'react';import _ from 'lodash';class CreateConsignment extends React.Component &#123; constructor(props) &#123; super(props); &#125; state = &#123; created: false, description: '', weight: 0, containers: [], consignments: [], &#125; componentWillMount() &#123; fetch(`http://localhost:8080/rpc`, &#123; method: 'POST', headers: &#123; 'Content-Type': 'application/json', &#125;, body: JSON.stringify(&#123; service: 'shippy.consignment', method: 'ConsignmentService.Get', request: &#123;&#125;, &#125;) &#125;) .then(req =&gt; req.json()) .then((res) =&gt; &#123; this.setState(&#123; consignments: res.consignments, &#125;); &#125;); &#125; create = () =&gt; &#123; const consignment = this.state; fetch(`http://localhost:8080/rpc`, &#123; method: 'POST', headers: &#123; 'Content-Type': 'application/json', &#125;, body: JSON.stringify(&#123; service: 'shippy.consignment', method: 'ConsignmentService.Create', request: _.omit(consignment, 'created', 'consignments'), &#125;), &#125;) .then((res) =&gt; res.json()) .then((res) =&gt; &#123; this.setState(&#123; created: res.created, consignments: [...this.state.consignments, consignment], &#125;); &#125;); &#125; addContainer = e =&gt; &#123; this.setState(&#123; containers: [...this.state.containers, e.target.value], &#125;); &#125; setDescription = e =&gt; &#123; this.setState(&#123; description: e.target.value, &#125;); &#125; setWeight = e =&gt; &#123; this.setState(&#123; weight: Number(e.target.value), &#125;); &#125; render() &#123; const &#123; consignments, &#125; = this.state; return ( &lt;div className='consignment-screen'&gt; &lt;div className='consignment-form container'&gt; &lt;br /&gt; &lt;div className='form-group'&gt; &lt;textarea onChange=&#123;this.setDescription&#125; className='form-control' placeholder='Description'&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;div className='form-group'&gt; &lt;input onChange=&#123;this.setWeight&#125; type='number' placeholder='Weight' className='form-control' /&gt; &lt;/div&gt; &lt;div className='form-control'&gt; Add containers... &lt;/div&gt; &lt;br /&gt; &lt;button onClick=&#123;this.create&#125; className='btn btn-primary'&gt;Create&lt;/button&gt; &lt;br /&gt; &lt;hr /&gt; &lt;/div&gt; &#123;(consignments &amp;&amp; consignments.length &gt; 0 ? &lt;div className='consignment-list'&gt; &lt;h2&gt;Consignments&lt;/h2&gt; &#123;consignments.map((item) =&gt; ( &lt;div&gt; &lt;p&gt;Vessel id: &#123;item.vessel_id&#125;&lt;/p&gt; &lt;p&gt;Consignment id: &#123;item.id&#125;&lt;/p&gt; &lt;p&gt;Description: &#123;item.description&#125;&lt;/p&gt; &lt;p&gt;Weight: &#123;item.weight&#125;&lt;/p&gt; &lt;hr /&gt; &lt;/div&gt; ))&#125; &lt;/div&gt; : false)&#125; &lt;/div&gt; ); &#125;&#125;export default CreateConsignment; æ³¨æ„:æˆ‘è¿˜æ·»åŠ äº†Twitter Bootstrap åˆ°/public/index.htmlå’Œä¿®æ”¹äº†ä¸€äº›cssã€‚ ç°åœ¨è¿è¡Œç”¨æˆ·ç•Œé¢$ npm startã€‚è¿™åº”è¯¥ä¼šåœ¨æ‚¨çš„æµè§ˆå™¨ä¸­è‡ªåŠ¨æ‰“å¼€ã€‚ç°åœ¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ³¨å†Œå’Œç™»å½•ï¼Œå¹¶æŸ¥çœ‹æ‰˜è¿è¡¨å•ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºæ–°çš„æ‰˜è¿ã€‚åœ¨æ‚¨çš„devå·¥å…·ä¸­æŸ¥çœ‹ç½‘ç»œé€‰é¡¹å¡ï¼Œå¹¶æŸ¥çœ‹ä»ä¸åŒçš„å¾®æœåŠ¡ä¸­è§¦å‘å’Œè·å–æ•°æ®çš„rpcæ–¹æ³•ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬äº”éƒ¨åˆ†","slug":"go-micro-tutorial-5","date":"2018-05-10T13:56:48.000Z","updated":"2020-07-25T02:57:18.205Z","comments":true,"path":"2018/05/10/go-micro-tutorial-5/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-5/","excerpt":"åœ¨æœ¬ç³»åˆ—çš„å‰ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç”¨æˆ·èº«ä»½éªŒè¯å’ŒJWTã€‚åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿæµè§ˆä¸€ä¸‹go-microçš„ä»£ç†åŠŸèƒ½ï¼Œç”šè‡³æ˜¯ä»£ç†ã€‚ æ­£å¦‚å‰æ–‡æ‰€æåˆ°çš„ï¼Œgo-microæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„æ¡†æ¶ï¼Œå®ƒæ¥å£è®¸å¤šä¸åŒçš„å¸¸ç”¨æŠ€æœ¯ã€‚å¦‚æœæ‚¨æŸ¥çœ‹ä¸€ä¸‹plugins repoï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒæ”¯æŒäº†å¤šå°‘ä¸ªæ’ä»¶ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨NATSä»£ç†æ’ä»¶ã€‚","text":"åœ¨æœ¬ç³»åˆ—çš„å‰ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç”¨æˆ·èº«ä»½éªŒè¯å’ŒJWTã€‚åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿæµè§ˆä¸€ä¸‹go-microçš„ä»£ç†åŠŸèƒ½ï¼Œç”šè‡³æ˜¯ä»£ç†ã€‚ æ­£å¦‚å‰æ–‡æ‰€æåˆ°çš„ï¼Œgo-microæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„æ¡†æ¶ï¼Œå®ƒæ¥å£è®¸å¤šä¸åŒçš„å¸¸ç”¨æŠ€æœ¯ã€‚å¦‚æœæ‚¨æŸ¥çœ‹ä¸€ä¸‹plugins repoï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒæ”¯æŒäº†å¤šå°‘ä¸ªæ’ä»¶ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨NATSä»£ç†æ’ä»¶ã€‚ äº‹ä»¶é©±åŠ¨æ¶æ„äº‹ä»¶é©±åŠ¨çš„ä½“ç³»ç»“æ„æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¦‚å¿µã€‚æˆ‘ä»¬é€šå¸¸è®¤ä¸ºå¥½çš„ä½“ç³»ç»“æ„æ˜¯å¯ä»¥è§£è€¦çš„;è¿™äº›æœåŠ¡ä¸åº”è¯¥ä¸å…¶ä»–æœåŠ¡ç›¸è€¦åˆã€‚å½“æˆ‘ä»¬ä½¿ç”¨gRPCè¿™æ ·çš„åè®®æ—¶ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¯´æˆ‘æƒ³å°†è¿™ä¸ªè¯·æ±‚å‘å¸ƒåˆ°go.srvã€‚ä¾‹å¦‚ç”¨æˆ·æœåŠ¡ã€‚ä½¿ç”¨æœåŠ¡å‘ç°æ¥æŸ¥æ‰¾è¯¥æœåŠ¡çš„å®é™…ä½ç½®ã€‚è™½ç„¶è¿™å¹¶ä¸èƒ½ç›´æ¥å°†æˆ‘ä»¬ä¸å®ç°ç»“åˆèµ·æ¥ï¼Œä½†å®ƒç¡®å®å°†æœåŠ¡è¿æ¥åˆ°å¦ä¸€ä¸ªåä¸ºgo.srvçš„ä¸œè¥¿ä¸Šã€‚ç”¨æˆ·æœåŠ¡ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œå› ä¸ºå®ƒç›´æ¥ä¸å…¶ä»–ä¸œè¥¿å¯¹è¯ã€‚ é‚£ä¹ˆï¼Œæ˜¯ä»€ä¹ˆä½¿äº‹ä»¶é©±åŠ¨æ¶æ„çœŸæ­£åœ°è§£è€¦äº†å‘¢?ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶çš„è¿‡ç¨‹ã€‚æœåŠ¡aå®Œæˆäº†ä»»åŠ¡xï¼Œç„¶åå¯¹ç”Ÿæ€ç³»ç»Ÿâ€œxåˆšåˆšå‘ç”Ÿâ€è¡¨ç¤ºã€‚å®ƒä¸éœ€è¦çŸ¥é“ï¼Œæˆ–è€…å…³å¿ƒæ˜¯è°åœ¨å¬é‚£ä¸ªäº‹ä»¶ï¼Œæˆ–è€…æ˜¯ä»€ä¹ˆå—åˆ°äº†é‚£ä¸ªäº‹ä»¶çš„å½±å“ã€‚è¿™ç§è´£ä»»ç•™ç»™äº†å€¾å¬çš„å®¢æˆ·ã€‚ å¦‚æœä½ æœŸæœ›åœ¨æŸä¸€äº‹ä»¶ä¸Šæœ‰nä¸ªæœåŠ¡ï¼Œè¿™ä¹Ÿä¼šæ›´å®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦12ä¸ªä¸åŒçš„æœåŠ¡æ¥å¤„ç†ä½¿ç”¨gRPCåˆ›å»ºçš„æ–°ç”¨æˆ·ï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»åœ¨æ‚¨çš„ç”¨æˆ·æœåŠ¡ä¸­å®ä¾‹åŒ–12ä¸ªå®¢æˆ·ç«¯ã€‚ä½¿ç”¨pubsubæˆ–äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæ‚¨çš„æœåŠ¡ä¸éœ€è¦å…³å¿ƒè¿™äº›ã€‚ ç°åœ¨ï¼Œå®¢æˆ·ç«¯æœåŠ¡å°†ç®€å•åœ°ä¾¦å¬äº‹ä»¶ã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦æŸç§ä¸­é—´çš„ä¸­ä»‹æ¥æ¥å—è¿™äº›äº‹ä»¶ï¼Œå¹¶å°†å…¶å‘å¸ƒé€šçŸ¥å®¢æˆ·ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ¯æ¬¡åˆ›å»ºç”¨æˆ·æ—¶åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°æœåŠ¡æ¥å‘é€ç”µå­é‚®ä»¶ã€‚æˆ‘ä»¬å®é™…ä¸Šä¸ä¼šå†™ç”µå­é‚®ä»¶çš„å®ç°ï¼Œåªæ˜¯æš‚æ—¶æŠŠå®ƒæ¨¡æ‹Ÿå‡ºæ¥ã€‚ ä»£ç é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†NATSä»£ç†æ’ä»¶é›†æˆåˆ°æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡ä¸­: 12345678910111213// shippy-user-service/main.gofunc main() &#123; ... // Init will parse the command line flags. srv.Init() // Get instance of the broker using our defaults pubsub := srv.Server().Options().Broker // Register handler pb.RegisterUserServiceHandler(srv.Server(), &amp;service&#123;repo, tokenService, pubsub&#125;) ...&#125; ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨åˆ›å»ºæ–°ç”¨æˆ·æ—¶å‘å¸ƒäº‹ä»¶(è¯·å‚é˜…æ­¤å¤„çš„å®Œæ•´æ›´æ”¹): 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// shippy-user-service/handler.goconst topic = \"user.created\"type service struct &#123; repo Repository tokenService Authable PubSub broker.Broker&#125;...func (srv *service) Create(ctx context.Context, req *pb.User, res *pb.Response) error &#123; // Generates a hashed version of our password hashedPass, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost) if err != nil &#123; return err &#125; req.Password = string(hashedPass) if err := srv.repo.Create(req); err != nil &#123; return err &#125; res.User = req if err := srv.publishEvent(req); err != nil &#123; return err &#125; return nil&#125;func (srv *service) publishEvent(user *pb.User) error &#123; // Marshal to JSON string body, err := json.Marshal(user) if err != nil &#123; return err &#125; // Create a broker message msg := &amp;broker.Message&#123; Header: map[string]string&#123; \"id\": user.Id, &#125;, Body: body, &#125; // Publish message to broker if err := srv.PubSub.Publish(topic, msg); err != nil &#123; log.Printf(\"[pub] failed: %v\", err) &#125; return nil&#125;... ç¡®ä¿ä½ åœ¨è¿è¡ŒPostgresï¼Œç„¶åè®©æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæœåŠ¡: 123$ docker run -d -p 5432:5432 postgres$ make build$ make run ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ç”µå­é‚®ä»¶æœåŠ¡ã€‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„repo: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// shippy-email-servicepackage mainimport ( \"encoding/json\" \"log\" pb \"github.com/EwanValentine/shippy-user-service/proto/user\" micro \"github.com/micro/go-micro\" \"github.com/micro/go-micro/broker\" _ \"github.com/micro/go-plugins/broker/nats\")const topic = \"user.created\"func main() &#123; srv := micro.NewService( micro.Name(\"go.micro.srv.email\"), micro.Version(\"latest\"), ) srv.Init() // Get the broker instance using our environment variables pubsub := srv.Server().Options().Broker if err := pubsub.Connect(); err != nil &#123; log.Fatal(err) &#125; // Subscribe to messages on the broker _, err := pubsub.Subscribe(topic, func(p broker.Publication) error &#123; var user *pb.User if err := json.Unmarshal(p.Message().Body, &amp;user); err != nil &#123; return err &#125; log.Println(user) go sendEmail(user) return nil &#125;) if err != nil &#123; log.Println(err) &#125; // Run the server if err := srv.Run(); err != nil &#123; log.Println(err) &#125;&#125;func sendEmail(user *pb.User) error &#123; log.Println(\"Sending email to:\", user.Name) return nil&#125; åœ¨è¿è¡Œè¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡ŒNATSâ€¦ 1$ docker run -d -p 4222:4222 nats å¦å¤–ï¼Œæˆ‘æƒ³å¿«é€Ÿåœ°è§£é‡Šä¸€ä¸‹æˆ‘è§‰å¾—åœ¨ç†è§£å®ƒæ˜¯å¦‚ä½•ä½œä¸ºä¸€ä¸ªæ¡†æ¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è§‰å¾—å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ã€‚ä½ ä¼šæ³¨æ„åˆ°: 12srv.Init()pubsub := srv.Server().Options().Broker è®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€çœ‹ã€‚å½“æˆ‘ä»¬åœ¨go-microä¸­åˆ›å»ºæœåŠ¡æ—¶ï¼Œåå°çš„srv.Init()å°†æŸ¥æ‰¾ä»»ä½•é…ç½®ï¼Œå¦‚ä»»ä½•æ’ä»¶å’Œç¯å¢ƒå˜é‡ï¼Œæˆ–å‘½ä»¤è¡Œé€‰é¡¹ã€‚ç„¶åå®ƒå°†å®ä¾‹åŒ–è¿™äº›é›†æˆä½œä¸ºæœåŠ¡çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›å®ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ä»æœåŠ¡å®ä¾‹ä¸­å–å‡ºã€‚åœ¨srv.Server().options()ä¸­ï¼Œæ‚¨è¿˜å°†æ‰¾åˆ°ä¼ è¾“å’Œæ³¨å†Œè¡¨ã€‚ åœ¨è¿™é‡Œï¼Œå®ƒå°†æ‰¾åˆ°æˆ‘ä»¬çš„GO_MICRO_BROKERç¯å¢ƒå˜é‡ï¼Œå®ƒå°†æ‰¾åˆ°NATSä»£ç†æ’ä»¶ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚å‡†å¤‡å¥½è®©æˆ‘ä»¬è¿æ¥å’Œä½¿ç”¨ã€‚ å¦‚æœæ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œé‚£ä¹ˆæ‚¨å°†ä½¿ç”¨cmd.Init()ï¼Œç¡®ä¿æ‚¨å¯¼å…¥çš„æ˜¯github.com/micro/go-micro/cmdã€‚è¿™å°†äº§ç”ŸåŒæ ·çš„å½±å“ã€‚ ç°åœ¨æ„å»ºå¹¶è¿è¡Œè¿™ä¸ªæœåŠ¡:$ make build &amp;&amp; make runï¼Œç¡®ä¿æ‚¨ä¹Ÿè¿è¡Œäº†ç”¨æˆ·æœåŠ¡ã€‚ç„¶åè½¬åˆ°æˆ‘ä»¬çš„shippy-user-cli repoï¼Œè¿è¡Œ$ make runï¼ŒæŸ¥çœ‹æˆ‘ä»¬çš„ç”µå­é‚®ä»¶æœåŠ¡è¾“å‡ºã€‚ä½ åº”è¯¥çœ‹çœ‹â€¦â€¦2017/12/26 23:57:23å‘é‚®ä»¶è‡³:Ewan Valentineã€‚ è¿™æ˜¯å®ƒ!è¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹ç‰µå¼ºçš„ä¾‹å­ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç”µå­é‚®ä»¶æœåŠ¡éšå¼åœ°ç›‘å¬å•ä¸ªç”¨æˆ·ã€‚åˆ›å»ºçš„äº‹ä»¶ã€‚ä½†æ˜¯å¸Œæœ›æ‚¨èƒ½çœ‹åˆ°è¿™ç§æ–¹æ³•æ˜¯å¦‚ä½•å…è®¸æ‚¨ç¼–å†™è§£è€¦çš„æœåŠ¡çš„ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å›åˆ°åºåˆ—åŒ–JSONå­—ç¬¦ä¸²çš„é¢†åŸŸï¼Œåœ¨NATSä¸Šä½¿ç”¨JSONå°†ä¼šæœ‰æ€§èƒ½å¼€é”€vs gRPCã€‚ä½†æ˜¯ï¼Œå¯¹äºæŸäº›ç”¨ä¾‹æ¥è¯´ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚NATSæ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå¯¹ç«ç¾å’Œé—å¿˜äº‹ä»¶æ¥è¯´æ˜¯éå¸¸æ£’çš„ã€‚ Go-microè¿˜æ”¯æŒä¸€äº›æœ€å¹¿æ³›ä½¿ç”¨çš„queue/pubsubæŠ€æœ¯ï¼Œä¾›æ‚¨ä½¿ç”¨ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å®ƒä»¬çš„åˆ—è¡¨ã€‚ä½ ä¸éœ€è¦æ”¹å˜ä½ çš„å®ç°ï¼Œå› ä¸ºä½ å¯ä»¥æŠŠå®ƒæŠ½è±¡å‡ºæ¥ã€‚æ‚¨åªéœ€è¦å°†ç¯å¢ƒå˜é‡ä»MICRO_BROKER=natsæ›´æ”¹ä¸ºMICRO_BROKER=googlepubsubï¼Œç„¶åæ›´æ”¹mainä¸­çš„å¯¼å…¥ã€‚ä¾‹å¦‚ï¼Œä» _ &quot;github.com/micro/go-plugins/broker/nats&quot;åˆ°_ &quot;github.com/micro/go-plugins/broker/googlepubsub&quot;ã€‚ å¦‚æœä½ ä¸ä½¿ç”¨go-microï¼Œé‚£å°±ä¼šæœ‰ä¸€ä¸ªNATS goåº“(NATSæœ¬èº«æ˜¯å†™åœ¨goä¸Šçš„ï¼Œæ‰€ä»¥è‡ªç„¶åœ°æ”¯æŒgoæ˜¯ç›¸å½“å¯é çš„)ã€‚ å‘å¸ƒä¸€ä¸ªäº‹ä»¶: 1234nc, _ := nats.Connect(nats.DefaultURL)// Simple Publishernc.Publish(\"user.created\", userJsonString) è®¢é˜…ä¸€ä¸ªäº‹ä»¶: 12345// Simple Async Subscribernc.Subscribe(\"user.created\", func(m *nats.Msg) &#123; user := convertUserString(m.Data) go sendEmail(user)&#125;) æˆ‘ä¹‹å‰æåˆ°è¿‡ï¼Œå½“ä½¿ç”¨ç¬¬ä¸‰æ–¹message broker(æ¯”å¦‚NATS)æ—¶ï¼Œæ‚¨å°±ä¼šå¤±å»å¯¹protobufçš„ä½¿ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªé—æ†¾ï¼Œå› ä¸ºæˆ‘ä»¬å¤±å»äº†ä½¿ç”¨äºŒè¿›åˆ¶æµè¿›è¡Œé€šä¿¡çš„èƒ½åŠ›ï¼Œå½“ç„¶è¿™æ¯”åºåˆ—åŒ–çš„JSONå­—ç¬¦ä¸²çš„å¼€é”€è¦ä½å¾—å¤šã€‚ä½†ä¸å¤§å¤šæ•°æ‹…å¿§ä¸€æ ·ï¼Œgo-microä¹Ÿèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å†…ç½®åˆ°go-microæ˜¯ä¸€ä¸ªpubsubå±‚ï¼Œå®ƒä½äºä»£ç†å±‚ä¹‹ä¸Šï¼Œä½†ä¸éœ€è¦ç¬¬ä¸‰æ–¹ä»£ç†ï¼Œå¦‚NATSã€‚ä½†æ˜¯è¿™ä¸ªç‰¹æ€§çš„å¯æ€•ä¹‹å¤„åœ¨äºï¼Œå®ƒä½¿ç”¨äº†ä½ çš„protobufå®šä¹‰ã€‚æˆ‘ä»¬å›åˆ°äº†ä½å»¶è¿Ÿçš„äºŒè¿›åˆ¶æµé¢†åŸŸã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡ä»¥æ›¿æ¢ç°æœ‰çš„NATSä»£ç†ï¼Œä½¿ç”¨go-microçš„pubsub: 123456789// shippy-user-service/main.gofunc main() &#123; ... publisher := micro.NewPublisher(\"user.created\", srv.Client()) // Register handler pb.RegisterUserServiceHandler(srv.Server(), &amp;service&#123;repo, tokenService, publisher&#125;) ...&#125; 1234567891011121314151617181920// shippy-user-service/handler.gofunc (srv *service) Create(ctx context.Context, req *pb.User, res *pb.Response) error &#123; // Generates a hashed version of our password hashedPass, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost) if err != nil &#123; return err &#125; req.Password = string(hashedPass) // Here's our new publisher code, much simpler if err := srv.repo.Create(req); err != nil &#123; return err &#125; res.User = req if err := srv.Publisher.Publish(ctx, req); err != nil &#123; return err &#125; return nil&#125; ç°åœ¨æˆ‘ä»¬çš„ç”µå­é‚®ä»¶æœåŠ¡: 12345678910111213141516// shippy-email-serviceconst topic = \"user.created\"type Subscriber struct&#123;&#125;func (sub *Subscriber) Process(ctx context.Context, user *pb.User) error &#123; log.Println(\"Picked up a new message\") log.Println(\"Sending email to:\", user.Name) return nil&#125;func main() &#123; ... micro.RegisterSubscriber(topic, srv.Server(), new(Subscriber)) ...&#125; ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ä¸­ä½¿ç”¨åº•å±‚ç”¨æˆ·åŸå‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨gRPCï¼Œä¹Ÿä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»£ç†ã€‚å¤ªæ£’äº†! è¿™æ˜¯ä¸€ä¸ªåŒ…è£…!ä¸‹ä¸€ä¸ªæ•™ç¨‹ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä¸ºæˆ‘ä»¬çš„æœåŠ¡åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œå¹¶æŸ¥çœ‹webå®¢æˆ·ç«¯å¦‚ä½•å¼€å§‹ä¸æˆ‘ä»¬çš„æœåŠ¡äº¤äº’ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬å››éƒ¨åˆ†","slug":"go-micro-tutorial-4","date":"2018-05-10T13:56:32.000Z","updated":"2020-07-25T02:57:18.205Z","comments":true,"path":"2018/05/10/go-micro-tutorial-4/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-4/","excerpt":"åœ¨æœ¬ç³»åˆ—çš„å‰ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†åˆ›å»ºç”¨æˆ·æœåŠ¡å¹¶å¼€å§‹å­˜å‚¨ä¸€äº›ç”¨æˆ·ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦è€ƒè™‘ä½¿æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡å­˜å‚¨ç”¨æˆ·å¯†ç å®‰å…¨ï¼Œå¹¶åˆ›å»ºä¸€äº›åŠŸèƒ½æ¥éªŒè¯ç”¨æˆ·ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ä¸­å‘å¸ƒå®‰å…¨ä»¤ç‰Œã€‚","text":"åœ¨æœ¬ç³»åˆ—çš„å‰ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†åˆ›å»ºç”¨æˆ·æœåŠ¡å¹¶å¼€å§‹å­˜å‚¨ä¸€äº›ç”¨æˆ·ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦è€ƒè™‘ä½¿æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡å­˜å‚¨ç”¨æˆ·å¯†ç å®‰å…¨ï¼Œå¹¶åˆ›å»ºä¸€äº›åŠŸèƒ½æ¥éªŒè¯ç”¨æˆ·ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ä¸­å‘å¸ƒå®‰å…¨ä»¤ç‰Œã€‚ æ³¨æ„ï¼Œæˆ‘ç°åœ¨å·²ç»å°†æˆ‘ä»¬çš„æœåŠ¡åˆ†ç¦»åˆ°å•ç‹¬çš„å­˜å‚¨åº“ä¸­ã€‚æˆ‘å‘ç°è¿™æ›´å®¹æ˜“éƒ¨ç½²ã€‚æœ€åˆï¼Œæˆ‘æ‰“ç®—å°è¯•åšä¸€ä¸ªmonorepoï¼Œä½†æ˜¯æˆ‘å‘ç°ç”¨Goçš„depç®¡ç†æ¥è®¾ç½®å®ƒå¤ªéº»çƒ¦äº†ï¼Œä¸ä¼šæœ‰å„ç§å†²çªã€‚æˆ‘è¿˜å°†å¼€å§‹æ¼”ç¤ºå¦‚ä½•ç‹¬ç«‹è¿è¡Œå’Œæµ‹è¯•å¾®æœåŠ¡ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä¼šå¤±å»dockerã€‚ä½†ç°åœ¨è¿˜å¥½ã€‚ ç°åœ¨éœ€è¦æ‰‹åŠ¨è¿è¡Œæ•°æ®åº“: 12$ docker run -d -p 5432:5432 postgres$ docker run -d -p 27017:27017 mongo æ–°çš„å­˜å‚¨åº“å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°: https://github.com/EwanValentine/shippy-consignment-service https://github.com/EwanValentine/shippy-user-service https://github.com/EwanValentine/shippy-vessel-service https://github.com/EwanValentine/shippy-user-cli https://github.com/EwanValentine/shippy-consignment-cli é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„ç”¨æˆ·å¤„ç†ç¨‹åºæ¥å“ˆå¸Œæˆ‘ä»¬çš„å¯†ç ï¼Œè¿™æ˜¯ç»å¯¹å¿…é¡»çš„ã€‚æ°¸è¿œä¸è¦å­˜å‚¨æ˜æ–‡å¯†ç ã€‚ä½ ä»¬ä¸­çš„å¾ˆå¤šäººä¼šè®¤ä¸ºâ€œduhå¾ˆæ˜æ˜¾â€ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œå®ƒè¿˜åœ¨ç»§ç»­! 1234567891011121314151617181920212223242526272829303132333435363738// shippy-user-service/handler.go...func (srv *service) Auth(ctx context.Context, req *pb.User, res *pb.Token) error &#123; log.Println(\"Logging in with:\", req.Email, req.Password) user, err := srv.repo.GetByEmail(req.Email) log.Println(user) if err != nil &#123; return err &#125; // Compares our given password against the hashed password // stored in the database if err := bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(req.Password)); err != nil &#123; return err &#125; token, err := srv.tokenService.Encode(user) if err != nil &#123; return err &#125; res.Token = token return nil&#125;func (srv *service) Create(ctx context.Context, req *pb.User, res *pb.Response) error &#123; // Generates a hashed version of our password hashedPass, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost) if err != nil &#123; return err &#125; req.Password = string(hashedPass) if err := srv.repo.Create(req); err != nil &#123; return err &#125; res.User = req return nil&#125; è¿™é‡Œå¹¶æ²¡æœ‰å‘ç”Ÿå¾ˆå¤§çš„å˜åŒ–ï¼Œåªæ˜¯æˆ‘ä»¬æ·»åŠ äº†å¯†ç æ•£åˆ—åŠŸèƒ½ï¼Œç„¶ååœ¨ä¿å­˜æ–°ç”¨æˆ·ä¹‹å‰å°†å…¶è®¾ç½®ä¸ºå¯†ç ã€‚æ­¤å¤–ï¼Œåœ¨èº«ä»½éªŒè¯æ–¹é¢ï¼Œæˆ‘ä»¬è¿˜æ£€æŸ¥äº†å“ˆå¸Œå¯†ç ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å¯¹æ•°æ®åº“è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œåœ¨è¿™ä¸ªæœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·¨ç”¨æˆ·ç•Œé¢å’Œåˆ†å¸ƒå¼æœåŠ¡æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘é‡åˆ°çš„æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯JWTï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å’Œwebä¸Šä½¿ç”¨å®ƒã€‚ ä½†æ˜¯åœ¨æˆ‘ä»¬æ‰“å¼€ä¹‹å‰ï¼Œè¯·æ£€æŸ¥ä¸€ä¸‹æˆ‘å¯¹Dockerfileså’Œæ¯ä¸ªæœåŠ¡çš„makefileæ‰€åšçš„æ›´æ”¹ã€‚æˆ‘è¿˜æ›´æ–°äº†å¯¼å…¥æ¥åŒ¹é…æ–°çš„gitå­˜å‚¨åº“ã€‚ JWTJWTä»£è¡¨JSON webä»¤ç‰Œï¼Œæ˜¯ä¸€ç§åˆ†å¸ƒå¼å®‰å…¨åè®®ã€‚OAuthç›¸ä¼¼ã€‚è¿™ä¸ªæ¦‚å¿µå¾ˆç®€å•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®—æ³•ä¸ºç”¨æˆ·ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ•£åˆ—ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ¯”è¾ƒå’ŒéªŒè¯ã€‚ä½†ä¸ä»…å¦‚æ­¤ï¼Œä»¤ç‰Œæœ¬èº«å¯ä»¥åŒ…å«å¹¶ç”±æˆ‘ä»¬çš„ç”¨æˆ·å…ƒæ•°æ®ç»„æˆã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬çš„æ•°æ®æœ¬èº«å¯ä»¥æˆä¸ºä»¤ç‰Œçš„ä¸€éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªJWTçš„ä¾‹å­: 1eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ è¿™ä¸ªä»¤ç‰Œè¢«åˆ†æˆä¸‰éƒ¨åˆ†ã€‚æ¯ä¸€æ®µéƒ½æœ‰é‡è¦æ„ä¹‰ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯å…³äºä»¤ç‰Œæœ¬èº«çš„ä¸€äº›å…ƒæ•°æ®ã€‚ä¾‹å¦‚ä»¤ç‰Œçš„ç±»å‹å’Œç”¨äºåˆ›å»ºä»¤ç‰Œçš„ç®—æ³•ã€‚è¿™ä½¿å®¢æˆ·èƒ½å¤Ÿç†è§£å¦‚ä½•è§£ç ä»¤ç‰Œã€‚ç¬¬äºŒéƒ¨åˆ†ç”±ç”¨æˆ·å®šä¹‰çš„å…ƒæ•°æ®ç»„æˆã€‚è¿™å¯ä»¥æ˜¯æ‚¨çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼Œä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»»ä½•æ‚¨æƒ³è¦çš„ã€‚æœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯éªŒè¯ç­¾åï¼Œå®ƒæ˜¯å…³äºå¦‚ä½•æ•£åˆ—æ ‡è®°å’Œä½¿ç”¨ä»€ä¹ˆæ•°æ®çš„ä¿¡æ¯ã€‚ å½“ç„¶ï¼Œä½¿ç”¨JWTä¹Ÿæœ‰ç¼ºç‚¹å’Œé£é™©ï¼Œæœ¬æ–‡æ¦‚è¿°äº†è¿™äº›ä¼˜ç‚¹ã€‚å¦å¤–ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»æœ¬æ–‡ä»¥äº†è§£å®‰å…¨æœ€ä½³å®è·µã€‚ æˆ‘å»ºè®®æ‚¨ç‰¹åˆ«å…³æ³¨çš„æ˜¯ï¼Œè·å–ç”¨æˆ·çš„IPï¼Œå¹¶å°†å…¶ä½œä¸ºæ ‡è®°å£°æ˜çš„ä¸€éƒ¨åˆ†ã€‚è¿™ç¡®ä¿äº†æŸäººä¸èƒ½çªƒå–æ‚¨çš„ä»¤ç‰Œï¼Œå¹¶åœ¨å¦ä¸€ä¸ªè®¾å¤‡ä¸Šå……å½“æ‚¨çš„è§’è‰²ã€‚ç¡®ä¿æ‚¨ä½¿ç”¨httpsæœ‰åŠ©äºå‡è½»è¿™ç§æ”»å‡»ç±»å‹ï¼Œå› ä¸ºå®ƒæ¨¡ç³Šäº†æ‚¨åœ¨ä¸­é—´é£æ ¼æ”»å‡»ä¸­çš„æ ‡è®°ã€‚ æœ‰è®¸å¤šä¸åŒçš„æ•£åˆ—ç®—æ³•ï¼Œå¯ä»¥ä½¿ç”¨åˆ°æ•£åˆ—JWTï¼Œé€šå¸¸åˆ†ä¸ºä¸¤ç±»ã€‚å¯¹ç§°å’Œéå¯¹ç§°ã€‚å¯¹ç§°å°±åƒæˆ‘ä»¬ä½¿ç”¨çš„æ–¹æ³•ï¼Œä½¿ç”¨å…±äº«çš„ç›ã€‚ä¸å¯¹ç§°åˆ©ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å…¬é’¥å’Œç§é’¥ã€‚è¿™å¯¹äºè·¨æœåŠ¡çš„èº«ä»½éªŒè¯éå¸¸æœ‰ç”¨ã€‚ æ›´å¤šèµ„æº: Auth0 RFCç®—æ³• ç°åœ¨æˆ‘ä»¬å·²ç»è®¨è®ºäº†JWTæ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬æ›´æ–°token_serviceã€‚æ‰§è¡Œè¿™äº›æ“ä½œã€‚æˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¸€ä¸ªéå¸¸æ£’çš„Goåº“:github.com/dgrijalva/jwt-goï¼Œå…¶ä¸­åŒ…å«ä¸€äº›å¾ˆå¥½çš„ä¾‹å­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071// shippy-user-service/token_service.gopackage mainimport ( \"time\" pb \"github.com/EwanValentine/shippy-user-service/proto/user\" \"github.com/dgrijalva/jwt-go\")var ( // Define a secure key string used // as a salt when hashing our tokens. // Please make your own way more secure than this, // use a randomly generated md5 hash or something. key = []byte(\"mySuperSecretKeyLol\"))// CustomClaims is our custom metadata, which will be hashed// and sent as the second segment in our JWTtype CustomClaims struct &#123; User *pb.User jwt.StandardClaims&#125;type Authable interface &#123; Decode(token string) (*CustomClaims, error) Encode(user *pb.User) (string, error)&#125;type TokenService struct &#123; repo Repository&#125;// Decode a token string into a token objectfunc (srv *TokenService) Decode(tokenString string) (*CustomClaims, error) &#123; // Parse the token token, err := jwt.ParseWithClaims(tokenString, &amp;CustomClaims&#123;&#125;, func(token *jwt.Token) (interface&#123;&#125;, error) &#123; return key, nil &#125;) // Validate the token and return the custom claims if claims, ok := token.Claims.(*CustomClaims); ok &amp;&amp; token.Valid &#123; return claims, nil &#125; else &#123; return nil, err &#125;&#125;// Encode a claim into a JWTfunc (srv *TokenService) Encode(user *pb.User) (string, error) &#123; expireToken := time.Now().Add(time.Hour * 72).Unix() // Create the Claims claims := CustomClaims&#123; user, jwt.StandardClaims&#123; ExpiresAt: expireToken, Issuer: \"go.micro.srv.user\", &#125;, &#125; // Create token token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims) // Sign token and return return token.SignedString(key)&#125; æ ¹æ®æˆ‘çš„è§‚ç‚¹ï¼Œæˆ‘ç•™ä¸‹äº†ä¸€äº›æ³¨é‡Šï¼Œè§£é‡Šäº†ä¸€äº›æ›´è¯¦ç»†çš„ç»†èŠ‚ï¼Œä½†æ˜¯è¿™é‡Œçš„å‰æéå¸¸ç®€å•ã€‚Decodeæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä»¤ç‰Œï¼Œå°†å…¶è§£æä¸ºä¸€ä¸ªä»¤ç‰Œå¯¹è±¡ï¼Œå¹¶éªŒè¯å®ƒï¼Œå¹¶åœ¨æœ‰æ•ˆçš„æƒ…å†µä¸‹è¿”å›æ–­è¨€ã€‚è¿™å°†å…è®¸æˆ‘ä»¬ä»ç´¢èµ”ä¸­è·å–ç”¨æˆ·å…ƒæ•°æ®ä»¥éªŒè¯è¯¥ç”¨æˆ·ã€‚ ç¼–ç æ–¹æ³•åšç›¸åçš„äº‹æƒ…ï¼Œå®ƒå°†æ‚¨çš„è‡ªå®šä¹‰å…ƒæ•°æ®æ•£å…¥ä¸€ä¸ªæ–°çš„JWTå¹¶è¿”å›å®ƒã€‚ æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜åœ¨é¡¶éƒ¨è®¾ç½®äº†ä¸€ä¸ªâ€œå…³é”®â€å˜é‡ï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„ç›ï¼Œè¯·ä½¿ç”¨æ¯”è¿™ä¸ªæ›´å®‰å…¨çš„äº§å“ã€‚ ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªéªŒè¯ä»¤ç‰ŒæœåŠ¡ã€‚è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„ç”¨æˆ·cliï¼Œæˆ‘å·²ç»ç®€åŒ–äº†è¿™åªæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œå› ä¸ºæˆ‘åœ¨ä¹‹å‰çš„cliä»£ç ä¸­æœ‰é—®é¢˜ï¼Œæˆ‘ä¼šå›åˆ°è¿™ä¸ªï¼Œä½†æ˜¯è¿™ä¸ªå·¥å…·åªæ˜¯ç”¨äºæµ‹è¯•: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364// shippy-user-cli/cli.gopackage mainimport ( \"log\" \"os\" pb \"github.com/EwanValentine/shippy-user-service/proto/user\" micro \"github.com/micro/go-micro\" microclient \"github.com/micro/go-micro/client\" \"golang.org/x/net/context\")func main() &#123; srv := micro.NewService( micro.Name(\"go.micro.srv.user-cli\"), micro.Version(\"latest\"), ) // Init will parse the command line flags. srv.Init() client := pb.NewUserService(\"go.micro.srv.user\", microclient.DefaultClient) name := \"Ewan Valentine\" email := \"ewan.valentine89@gmail.com\" password := \"test123\" company := \"BBC\" r, err := client.Create(context.TODO(), &amp;pb.User&#123; Name: name, Email: email, Password: password, Company: company, &#125;) if err != nil &#123; log.Fatalf(\"Could not create: %v\", err) &#125; log.Printf(\"Created: %s\", r.User.Id) getAll, err := client.GetAll(context.Background(), &amp;pb.Request&#123;&#125;) if err != nil &#123; log.Fatalf(\"Could not list users: %v\", err) &#125; for _, v := range getAll.Users &#123; log.Println(v) &#125; authResponse, err := client.Auth(context.TODO(), &amp;pb.User&#123; Email: email, Password: password, &#125;) if err != nil &#123; log.Fatalf(\"Could not authenticate user: %s error: %v\\n\", email, err) &#125; log.Printf(\"Your access token is: %s \\n\", authResponse.Token) // let's just exit because os.Exit(0)&#125; æˆ‘ä»¬ç°åœ¨åªéœ€è¦ä¸€äº›ç¡¬ç¼–ç çš„å€¼ï¼Œæ›¿æ¢é‚£äº›å¹¶ä½¿ç”¨$ make build &amp;&amp; make runè¿è¡Œè„šæœ¬ã€‚æ‚¨åº”è¯¥çœ‹åˆ°è¿”å›ä¸€ä¸ªä»¤ç‰Œã€‚å¤åˆ¶å¹¶ç²˜è´´è¿™ä¸ªé•¿æ ‡è®°å­—ç¬¦ä¸²ï¼Œæ‚¨å¾ˆå¿«å°±éœ€è¦å®ƒ! ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„consign-cliä»¥è·å–ä¸€ä¸ªä»¤ç‰Œå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°æˆ‘ä»¬çš„consignment-service: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// shippy-consignment-cli/cli.go...func main() &#123; cmd.Init() // Create new greeter client client := pb.NewShippingService(\"go.micro.srv.consignment\", microclient.DefaultClient) // Contact the server and print out its response. file := defaultFilename var token string log.Println(os.Args) if len(os.Args) &lt; 3 &#123; log.Fatal(errors.New(\"Not enough arguments, expecing file and token.\")) &#125; file = os.Args[1] token = os.Args[2] consignment, err := parseFile(file) if err != nil &#123; log.Fatalf(\"Could not parse file: %v\", err) &#125; // Create a new context which contains our given token. // This same context will be passed into both the calls we make // to our consignment-service. ctx := metadata.NewContext(context.Background(), map[string]string&#123; \"token\": token, &#125;) // First call using our tokenised context r, err := client.CreateConsignment(ctx, consignment) if err != nil &#123; log.Fatalf(\"Could not create: %v\", err) &#125; log.Printf(\"Created: %t\", r.Created) // Second call getAll, err := client.GetConsignments(ctx, &amp;pb.GetRequest&#123;&#125;) if err != nil &#123; log.Fatalf(\"Could not list consignments: %v\", err) &#125; for _, v := range getAll.Consignments &#123; log.Println(v) &#125;&#125; ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„å§”æ‰˜æœåŠ¡æ¥æ£€æŸ¥ä»¤ç‰Œçš„è¯·æ±‚ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// shippy-consignment-service/main.gofunc main() &#123; ... // Create a new service. Optionally include some options here. srv := micro.NewService( // This name must match the package name given in your protobuf definition micro.Name(\"go.micro.srv.consignment\"), micro.Version(\"latest\"), // Our auth middleware micro.WrapHandler(AuthWrapper), ) ...&#125;...// AuthWrapper is a high-order function which takes a HandlerFunc// and returns a function, which takes a context, request and response interface.// The token is extracted from the context set in our consignment-cli, that// token is then sent over to the user service to be validated.// If valid, the call is passed along to the handler. If not,// an error is returned.func AuthWrapper(fn server.HandlerFunc) server.HandlerFunc &#123; return func(ctx context.Context, req server.Request, resp interface&#123;&#125;) error &#123; meta, ok := metadata.FromContext(ctx) if !ok &#123; return errors.New(\"no auth meta-data found in request\") &#125; // Note this is now uppercase (not entirely sure why this is...) token := meta[\"Token\"] log.Println(\"Authenticating with token: \", token) // Auth here authClient := userService.NewUserService(\"go.micro.srv.user\", client.DefaultClient) _, err := authClient.ValidateToken(context.Background(), &amp;userService.Token&#123; Token: token, &#125;) if err != nil &#123; return err &#125; err = fn(ctx, req, resp) return err &#125;&#125; ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„consign-cliå·¥å…·ï¼Œcdè¿›å…¥æˆ‘ä»¬æ–°çš„shippy-consignment-cli repoå¹¶è¿è¡Œ$ make buildæ¥æ„å»ºæˆ‘ä»¬çš„æ–°dockeræ˜ åƒï¼Œç°åœ¨è¿è¡Œ: 12345$ make build$ docker run --net=\"host\" \\ -e MICRO_REGISTRY=mdns \\ consignment-cli consignment.json \\ &lt;TOKEN_HERE&gt; æ³¨æ„ï¼Œåœ¨è¿è¡Œdockerå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯-net=â€hostâ€æ ‡å¿—ã€‚è¿™å‘Šè¯‰Dockeråœ¨æˆ‘ä»¬çš„ä¸»æœºç½‘ç»œä¸Šè¿è¡Œæˆ‘ä»¬çš„å®¹å™¨ã€‚e 127.0.0.1æˆ–localhostï¼Œè€Œä¸æ˜¯å†…éƒ¨Dockerç½‘ç»œã€‚æ³¨æ„ï¼Œæ‚¨ä¸éœ€è¦ä½¿ç”¨æ­¤æ–¹æ³•è¿›è¡Œä»»ä½•ç«¯å£è½¬å‘ã€‚è€Œä¸æ˜¯-p 8080:8080ä½ å¯ä»¥åªåš- p8080ã€‚é˜…è¯»æ›´å¤šå…³äºDockerç½‘ç»œã€‚ ç°åœ¨ï¼Œå½“æ‚¨è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å§”æ‰˜ã€‚å°è¯•ä»ä»¤ç‰Œä¸­åˆ é™¤å‡ ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å®ƒå°±æ— æ•ˆäº†ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªé”™è¯¯ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†JWTä»¤ç‰ŒæœåŠ¡å’Œä¸€ä¸ªç”¨äºéªŒè¯JWTä»¤ç‰Œçš„ä¸­é—´ä»¶æ¥éªŒè¯ç”¨æˆ·ã€‚ å¦‚æœä½ ä¸æƒ³ä½¿ç”¨go-microï¼Œè€Œä½ ä½¿ç”¨çš„æ˜¯vanilla grpcï¼Œä½ ä¼šå¸Œæœ›ä½ çš„ä¸­é—´ä»¶çœ‹èµ·æ¥åƒ: 12345678910111213141516171819202122232425func main() &#123; ... myServer := grpc.NewServer( grpc.UnaryInterceptor(grpc_middleware.ChainUnaryServer(AuthInterceptor), ) ...&#125;func AuthInterceptor(ctx context.Context, req interface&#123;&#125;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler) (interface&#123;&#125;, error) &#123; // Set up a connection to the server. conn, err := grpc.Dial(authAddress, grpc.WithInsecure()) if err != nil &#123; log.Fatalf(\"did not connect: %v\", err) &#125; defer conn.Close() c := pb.NewAuthClient(conn) r, err := c.ValidateToken(ctx, &amp;pb.ValidateToken&#123;Token: token&#125;) if err != nil &#123; log.Fatalf(\"could not authenticate: %v\", err) &#125; return handler(ctx, req)&#125; è¿™ç§è®¾ç½®åœ¨æœ¬åœ°è¿è¡Œæœ‰ç‚¹ç¬¨æ‹™ã€‚ä½†æˆ‘ä»¬å¹¶ä¸æ€»æ˜¯éœ€è¦åœ¨æœ¬åœ°è¿è¡Œæ¯ä¸ªæœåŠ¡ã€‚æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåˆ›å»ºç‹¬ç«‹çš„ã€å¯ä»¥ç‹¬ç«‹æµ‹è¯•çš„æœåŠ¡ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æµ‹è¯•æˆ‘ä»¬çš„å§”æ‰˜æœåŠ¡ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¸€å®šè¦è¿è¡Œæˆ‘ä»¬çš„authserviceã€‚æˆ‘ä½¿ç”¨çš„ä¸€ä¸ªæŠ€å·§æ˜¯åˆ‡æ¢åˆ°å…¶ä»–æœåŠ¡çš„è°ƒç”¨ã€‚ æˆ‘å·²ç»æ›´æ–°äº†æˆ‘ä»¬çš„å¯„å”®æœåŠ¡authåŒ…è£…: 1234567891011// shippy-user-service/main.go...func AuthWrapper(fn server.HandlerFunc) server.HandlerFunc &#123; return func(ctx context.Context, req server.Request, resp interface&#123;&#125;) error &#123; // This skips our auth check if DISABLE_AUTH is set to true if os.Getenv(\"DISABLE_AUTH\") == \"true\" &#123; return fn(ctx, req, resp) &#125; ... &#125;&#125; ç„¶ååœ¨Makefileä¸­æ·»åŠ æ–°çš„toggle: 123456789// shippy-user-service/Makefile...run: docker run -d --net=\"host\" \\ -p 50052 \\ -e MICRO_SERVER_ADDRESS=:50052 \\ -e MICRO_REGISTRY=mdns \\ -e DISABLE_AUTH=true \\ consignment-service è¿™ç§æ–¹æ³•ä½¿å¾—åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„å¾®æœåŠ¡çš„æŸäº›å­éƒ¨åˆ†å˜å¾—æ›´å®¹æ˜“ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•ï¼Œä½†æˆ‘å‘ç°è¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•ã€‚æˆ‘å¸Œæœ›ä½ å·²ç»å‘ç°è¿™ä¸ªæœ‰ç”¨ï¼Œå°½ç®¡æ–¹å‘æœ‰å¾®å°çš„æ”¹å˜ã€‚è€Œä¸”ï¼Œä»»ä½•å…³äºè¿è¡Œå¾®æœåŠ¡çš„å»ºè®®éƒ½æ˜¯éå¸¸å—æ¬¢è¿çš„ï¼Œå› ä¸ºå®ƒå°†ä½¿è¿™ä¸ªç³»åˆ—å˜å¾—æ›´å®¹æ˜“!","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬ä¸‰éƒ¨åˆ†","slug":"go-micro-tutorial-3","date":"2018-05-10T13:56:27.000Z","updated":"2020-07-25T02:57:18.204Z","comments":true,"path":"2018/05/10/go-micro-tutorial-3/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-3/","excerpt":"åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†go-microå’ŒDockerçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚æˆ‘ä»¬è¿˜ä»‹ç»äº†ç¬¬äºŒç§æœåŠ¡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºdocker-composeï¼Œä»¥åŠå¦‚ä½•åœ¨æœ¬åœ°æ›´è½»æ¾åœ°è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†ä»‹ç»ä¸€äº›ä¸åŒçš„æ•°æ®åº“ï¼Œæœ€åæˆ‘ä»¬å°†ä»‹ç»ç¬¬ä¸‰ç§æœåŠ¡ã€‚","text":"åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†go-microå’ŒDockerçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚æˆ‘ä»¬è¿˜ä»‹ç»äº†ç¬¬äºŒç§æœåŠ¡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºdocker-composeï¼Œä»¥åŠå¦‚ä½•åœ¨æœ¬åœ°æ›´è½»æ¾åœ°è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†ä»‹ç»ä¸€äº›ä¸åŒçš„æ•°æ®åº“ï¼Œæœ€åæˆ‘ä»¬å°†ä»‹ç»ç¬¬ä¸‰ç§æœåŠ¡ã€‚ å…ˆå†³æ¡ä»¶å®‰è£…docker-compose:https://docs.docker.com/compose/install/ ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ•°æ®åº“ã€‚ é€‰æ‹©æ•°æ®åº“åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„æ•°æ®å®é™…ä¸Šå¹¶æ²¡æœ‰å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æˆ‘ä»¬çš„æœåŠ¡ä¸­ï¼Œå½“æˆ‘ä»¬çš„å®¹å™¨é‡æ–°å¯åŠ¨æ—¶ï¼Œå®ƒå°±ä¼šä¸¢å¤±ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æŒä¹…åŒ–ã€å­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®çš„æ–¹æ³•ã€‚ å¾®æœåŠ¡çš„å¥½å¤„åœ¨äºï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ã€‚å½“ç„¶ä½ ä¸éœ€è¦è¿™ä¹ˆåšï¼Œå¾ˆå¤šäººéƒ½ä¸éœ€è¦ã€‚äº‹å®ä¸Šï¼Œæˆ‘å¾ˆå°‘ä¸ºå°å›¢é˜Ÿåšè¿™æ ·çš„äº‹æƒ…ï¼Œå› ä¸ºç»´æŠ¤å‡ ä¸ªä¸åŒçš„æ•°æ®åº“æ˜¯ä¸€ç§ç²¾ç¥ä¸Šçš„é£è·ƒï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœåŠ¡æ•°æ®å¯èƒ½ä¸é€‚åˆæ‚¨ä¸ºå…¶ä»–æœåŠ¡ä½¿ç”¨çš„æ•°æ®åº“ã€‚æ‰€ä»¥ç”¨åˆ«çš„ä¸œè¥¿æ˜¯æœ‰æ„ä¹‰çš„ã€‚ç”±äºæ‚¨çš„å…³æ³¨æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå¾®æœåŠ¡ä½¿è¿™ä¸ªç®€å•çš„ç®€å•ã€‚ ä¸ºæ‚¨çš„æœåŠ¡é€‰æ‹©â€œæ­£ç¡®â€çš„æ•°æ®åº“æ˜¯ä¸€ç¯‡å®Œå…¨ä¸åŒçš„æ–‡ç« ï¼Œä¾‹å¦‚è¿™ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šå¯¹è¿™ä¸ªsubectåšå¤ªå¤šçš„ç»†èŠ‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æœ‰ç›¸å½“æ¾æ•£æˆ–ä¸ä¸€è‡´çš„æ•°æ®é›†ï¼Œé‚£ä¹ˆNoSQLæ–‡æ¡£å­˜å‚¨è§£å†³æ–¹æ¡ˆæ˜¯å®Œç¾çš„ã€‚å®ƒä»¬æ›´çµæ´»ï¼Œå¯ä»¥å­˜å‚¨å’Œä½¿ç”¨jsonã€‚æˆ‘ä»¬å°†ä¸ºNoSQLæ•°æ®åº“ä½¿ç”¨MongoDBã€‚æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åŸå› ï¼Œé™¤äº†å®ƒè¡¨ç°è‰¯å¥½ï¼Œå®ƒè¢«å¹¿æ³›ä½¿ç”¨å’Œæ”¯æŒï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªä¼Ÿå¤§çš„åœ¨çº¿ç¤¾åŒºã€‚ å¦‚æœæ‚¨çš„æ•°æ®æ›´ä¸¥æ ¼åœ°å®šä¹‰å’Œå…³ç³»ï¼Œé‚£ä¹ˆä½¿ç”¨ä¼ ç»Ÿçš„rdbmsæˆ–å…³ç³»æ•°æ®åº“æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ç¡¬æ€§è§„å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»»ä½•äººéƒ½å¯ä»¥èƒœä»»è¿™ä»½å·¥ä½œã€‚ä½†æ˜¯ä¸€å®šè¦æŸ¥çœ‹æ‚¨çš„æ•°æ®ç»“æ„ï¼Œè€ƒè™‘æ‚¨çš„æœåŠ¡æ˜¯å¦æ­£åœ¨è¿›è¡Œæ›´å¤šçš„é˜…è¯»æˆ–æ›´å¤šçš„å†™ä½œï¼ŒæŸ¥è¯¢çš„å¤æ‚ç¨‹åº¦å¦‚ä½•ï¼Œå¹¶å°è¯•å°†è¿™äº›ä½œä¸ºé€‰æ‹©æ•°æ®åº“çš„èµ·ç‚¹ã€‚å¯¹äºæˆ‘ä»¬çš„å…³ç³»æ•°æ®åº“ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Postgresã€‚å†ä¸€æ¬¡ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åŸå› ï¼Œé™¤äº†å®ƒåšçš„å¾ˆå¥½ï¼Œæˆ‘å¾ˆç†Ÿæ‚‰å®ƒã€‚ä½ å¯ä»¥ç”¨MySQL, MariaDBï¼Œæˆ–è€…åˆ«çš„ä»€ä¹ˆã€‚ Amazonå’Œè°·æ­Œå¯¹äºè¿™ä¸¤ç§æ•°æ®åº“ç±»å‹çš„å‰æè§£å†³æ–¹æ¡ˆéƒ½æœ‰ä¸€äº›å‡ºè‰²çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœæ‚¨æƒ³é¿å…ç®¡ç†è‡ªå·±çš„æ•°æ®åº“(é€šå¸¸æ˜¯æ˜æ™ºçš„)ã€‚å¦ä¸€ä¸ªä¸é”™çš„é€‰æ‹©æ˜¯ç¼–å†™ï¼Œå®ƒå°†ä½¿ç”¨ç›¸åŒçš„äº‘æä¾›ç¨‹åºä½œä¸ºæ‚¨çš„æœåŠ¡ï¼Œä»¥é¿å…è¿æ¥å»¶è¿Ÿï¼Œä»è€Œå®ç°å„ç§æ•°æ®åº“æŠ€æœ¯çš„å®Œå…¨ç®¡ç†ã€å¯ä¼¸ç¼©çš„å®ä¾‹ã€‚ äºšé©¬é€Š:RDBMS: https://aws.amazon.com/rds/ NoSQL: https://aws.amazon.com/dynamodb/ã€‚ RDBMS: https://cloud.google.com/spanner/ NoSQL: https://cloud.google.com/datastore/ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»è®¨è®ºäº†ä¸€äº›æ•°æ®åº“ï¼Œè®©æˆ‘ä»¬æ¥åšä¸€äº›ç¼–ç ! docker-composeåœ¨æœ¬ç³»åˆ—çš„æœ€åä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†Dockerï¼Œå®ƒè®©æˆ‘ä»¬åœ¨è½»é‡çº§å®¹å™¨ä¸­è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬è‡ªå·±çš„è¿è¡Œæ—¶å’Œä¾èµ–é¡¹ã€‚ä½†æ˜¯ï¼Œå¿…é¡»ä½¿ç”¨å•ç‹¬çš„Makefileæ¥è¿è¡Œå’Œç®¡ç†æ¯ä¸ªæœåŠ¡ï¼Œè¿™æœ‰ç‚¹éº»çƒ¦ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹docker-composeã€‚Docker-compose å…è®¸æ‚¨åœ¨yamlæ–‡ä»¶ä¸­å®šä¹‰dockerå®¹å™¨çš„åˆ—è¡¨ï¼Œå¹¶æŒ‡å®šå…³äºå…¶è¿è¡Œæ—¶çš„å…ƒæ•°æ®ã€‚Docker-composeæœåŠ¡æˆ–å¤šæˆ–å°‘åœ°æ˜ å°„åˆ°æˆ‘ä»¬å·²ç»ä½¿ç”¨çš„dockerå‘½ä»¤ã€‚ä¾‹å¦‚: 1$ docker run -p 50052:50051 -e MICRO_SERVER_ADDRESS=:50051 -e MICRO_REGISTRY=mdns vessel-service å°±å˜æˆäº†: 12345678910version: '3.1'services: vessel-service: build: ./vessel-service ports: - 50052:50051 environment: MICRO_REGISTRY: \"mdns\" MICRO_SERVER_ADDRESS: \":50051\" ç®€å•! å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ç›®å½•$ touch docker-compose.ymlä¸­åˆ›å»ºä¸€ä¸ªdocker- compileæ–‡ä»¶ã€‚ç°åœ¨åŠ å…¥æˆ‘ä»¬çš„æœåŠ¡: 1234567891011121314151617181920212223242526# docker-compose.ymlversion: '3.1'services: consignment-cli: build: ./consignment-cli environment: MICRO_REGISTRY: \"mdns\" consignment-service: build: ./consignment-service ports: - 50051:50051 environment: MICRO_ADDRESS: \":50051\" MICRO_REGISTRY: \"mdns\" DB_HOST: \"datastore:27017\" vessel-service: build: ./vessel-service ports: - 50052:50051 environment: MICRO_ADDRESS: \":50051\" MICRO_REGISTRY: \"mdns\" é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„docker-composeçš„ç‰ˆæœ¬ï¼Œç„¶åæ˜¯æœåŠ¡åˆ—è¡¨ã€‚è¿˜æœ‰å…¶ä»–æ ¹çº§å®šä¹‰ï¼Œå¦‚ç½‘ç»œå’Œå·ï¼Œä½†æˆ‘ä»¬ç°åœ¨åªå…³æ³¨æœåŠ¡ã€‚ æ¯ä¸ªæœåŠ¡ç”±å®ƒçš„åç§°å®šä¹‰ï¼Œç„¶åæˆ‘ä»¬åŒ…æ‹¬ä¸€ä¸ªæ„å»ºè·¯å¾„ï¼Œå®ƒæ˜¯æŒ‡å‘ä¸€ä¸ªä½ç½®çš„å¼•ç”¨ï¼Œè¯¥ä½ç½®åº”è¯¥åŒ…å«ä¸€ä¸ªDockerfileã€‚è¿™å‘Šè¯‰docker-compose ä½¿ç”¨è¿™ä¸ªDockerfileæ¥æ„å»ºå®ƒçš„æ˜ åƒã€‚æ‚¨è¿˜å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨å›¾åƒæ¥ä½¿ç”¨é¢„æ„å»ºæ˜ åƒã€‚æˆ‘ä»¬ä»¥åä¼šè®²åˆ°ã€‚ç„¶åå®šä¹‰ç«¯å£æ˜ å°„ï¼Œæœ€åå®šä¹‰ç¯å¢ƒå˜é‡ã€‚ è¦æ„å»ºdocker-composeæ ˆï¼Œåªéœ€è¿è¡Œ$ docker-compose buildï¼Œå¹¶è¿è¡Œå®ƒï¼Œ$ docker-compose runã€‚è¦åœ¨åå°è¿è¡Œæ ˆï¼Œè¯·ä½¿ç”¨$ docker-compose up -dã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨$ docker psæŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„åˆ—è¡¨ã€‚æœ€åï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ$ docker stop $(docker ps -qa)æ¥åœæ­¢æ‰€æœ‰å½“å‰çš„å®¹å™¨ã€‚ æˆ‘ä»¬æ¥è¿è¡Œæ ˆã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¤§é‡çš„è¾“å‡ºå’Œdockerfileæ­£åœ¨æ„å»ºã€‚æ‚¨å¯èƒ½ä¹Ÿä¼šä»æˆ‘ä»¬çš„CLIå·¥å…·ä¸­çœ‹åˆ°é”™è¯¯ï¼Œä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œè¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºå®ƒæ˜¯åœ¨æˆ‘ä»¬çš„å…¶ä»–æœåŠ¡ä¹‹å‰è¿è¡Œçš„ã€‚å®ƒåªæ˜¯è¯´å®ƒè¿˜æ‰¾ä¸åˆ°å®ƒä»¬ã€‚ è®©æˆ‘ä»¬é€šè¿‡è¿è¡ŒCLIå·¥å…·è¿›è¡Œæµ‹è¯•ã€‚è¦é€šè¿‡docker-ç»„åˆè¿è¡Œå®ƒï¼Œåªéœ€è¿è¡Œ$ docker-compose run consignment-cliï¼Œä¸€æ—¦æ‰€æœ‰å…¶ä»–å®¹å™¨éƒ½åœ¨è¿è¡Œã€‚æ‚¨åº”è¯¥çœ‹åˆ°å®ƒåƒä»¥å‰ä¸€æ ·æˆåŠŸè¿è¡Œã€‚ å®ä½“å’Œprotobufsåœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†protobufsæ˜¯æˆ‘ä»¬æ•°æ®æ¨¡å‹çš„ä¸­å¿ƒã€‚æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥å®šä¹‰æˆ‘ä»¬çš„æœåŠ¡ç»“æ„å’ŒåŠŸèƒ½ã€‚ç”±äºprotobufä»¥æˆ–å¤šæˆ–å°‘çš„æ‰€æœ‰æ­£ç¡®çš„æ•°æ®ç±»å‹ç”Ÿæˆç»“æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡ç”¨è¿™äº›ç»“æ„ä½œä¸ºæˆ‘ä»¬çš„åº•å±‚æ•°æ®åº“æ¨¡å‹ã€‚è¿™å®é™…ä¸Šç›¸å½“ä»¤äººå…´å¥‹ã€‚å®ƒä¸åŸå‹ä¿æŒä¸€è‡´ï¼Œæˆä¸ºçœŸç†çš„å”¯ä¸€æ¥æºã€‚ ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ç¡®å®æœ‰ç¼ºç‚¹ã€‚æœ‰æ—¶ï¼Œå°†protobufç”Ÿæˆçš„ä»£ç ç¼–ç»„åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®åº“å®ä½“ä¸­æ˜¯å¾ˆå›°éš¾çš„ã€‚æœ‰æ—¶ï¼Œæ•°æ®åº“æŠ€æœ¯ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ï¼Œè¿™äº›ç±»å‹å¾ˆéš¾ä»protobufç”Ÿæˆçš„åŸç”Ÿç±»å‹è½¬æ¢ã€‚æˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•å°†Idå­—ç¬¦ä¸²è½¬æ¢ä¸ºId bsonã€‚ObjectId Mongodbçš„å®ä½“ã€‚ç»“æœæ˜¯bsonã€‚ObjectIdï¼Œå®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚å¦å¤–ï¼Œmongodbçš„idç´¢å¼•åœ¨å†…éƒ¨å­˜å‚¨ä¸º_idï¼Œå› æ­¤æ‚¨éœ€è¦ä¸€ç§æ–¹æ³•å°†å…¶ç»‘å®šåˆ°idå­—ç¬¦ä¸²å­—æ®µï¼Œå› ä¸ºæ‚¨ä¸èƒ½çœŸæ­£æ‰§è¡Œ_idå­—ç¬¦ä¸²ã€‚è¿™æ„å‘³ç€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥ä¸ºæ‚¨çš„åŸbufæ–‡ä»¶å®šä¹‰è‡ªå®šä¹‰æ ‡è®°ã€‚ä½†æˆ‘ä»¬ä»¥åä¼šè®²åˆ°ã€‚ æ­¤å¤–ï¼Œè®¸å¤šäººç»å¸¸åå¯¹ä½¿ç”¨protobufå®šä¹‰ä½œä¸ºæ•°æ®åº“å®ä½“ï¼Œå› ä¸ºæ‚¨å°†é€šä¿¡æŠ€æœ¯ä¸æ•°æ®åº“ä»£ç ç´§å¯†è€¦åˆã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç‚¹ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºè®®åœ¨protobufå®šä¹‰ä»£ç å’Œæ•°æ®åº“å®ä½“ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ä½†æ˜¯ï¼Œæ‚¨æœ€ç»ˆä¼šå¾—åˆ°è®¸å¤šè½¬æ¢ä»£ç ï¼Œç”¨äºè½¬æ¢ä¸¤ä¸ªå‡ ä¹ç›¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚: 123456789func (service *Service) (ctx context.Context, req *proto.User, res *proto.Response) error &#123; entity := &amp;models.User&#123; Name: req.Name. Email: req.Email, Password: req.Password, &#125; err := service.repo.Create(entity) ...&#125; è¡¨é¢ä¸Šçœ‹èµ·æ¥å¹¶ä¸æ˜¯é‚£ä¹ˆç³Ÿç³•ï¼Œä½†æ˜¯å½“ä½ æœ‰å‡ ä¸ªåµŒå¥—ç»“æ„å’Œå‡ ç§ç±»å‹æ—¶ã€‚å®ƒå¯èƒ½éå¸¸ç¹çï¼Œè€Œä¸”å¯èƒ½éœ€è¦å¤§é‡çš„è¿­ä»£æ¥è½¬æ¢åµŒå¥—ç»“æ„ç­‰ç­‰ã€‚ ä¸è¿‡,è¿™ç§æ–¹æ³•çœŸçš„åˆ°ä½ å–œæ¬¢å¾ˆå¤šä¸œè¥¿åœ¨ç¼–ç¨‹,è¿™å¹¶ä¸å½’ç»“ä¸ºå¯¹æˆ–é”™ã€‚æ‰€ä»¥æ— è®ºæ„Ÿè§‰æœ€åˆé€‚çš„æ–¹æ³•ã€‚ä½†æ˜¯,æˆ‘è‡ªå·±çš„ä¸ªäººæ„è§æ˜¯,ä¸¤ä¸ªå‡ ä¹ç›¸åŒçš„ç±»å‹ä¹‹é—´çš„è½¬æ¢,å°¤å…¶æ˜¯è€ƒè™‘åˆ°æˆ‘ä»¬å¯¹å¾…protobufä»£ç ä½œä¸ºæˆ‘ä»¬çš„åŸºç¡€æ•°æ®,æ„Ÿè§‰è‡ªå·±åƒä¸€ä¸ªå‡æŸä»æˆ‘ä»¬è·å¾—çš„åˆ©ç›Šä½¿ç”¨protobufsä½œä¸ºä½ çš„æ ¸å¿ƒå®šä¹‰ã€‚æ‰€ä»¥æˆ‘å°†ä½¿ç”¨æˆ‘ä»¬çš„protobufä»£ç æ•°æ®åº“ã€‚é¡ºä¾¿è¯´ä¸€å¥,æˆ‘ä¸æ˜¯è¯´æˆ‘æ˜¯å¯¹çš„,æˆ‘æƒ³å¬åˆ°ä½ çš„æ„è§ã€‚ è®©æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬çš„å¯„å”®æœåŠ¡ã€‚æˆ‘è§‰å¾—æˆ‘ä»¬åº”è¯¥å…ˆæ•´ç†ä¸€ä¸‹ã€‚æˆ‘ä»¬æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½é›†ä¸­åˆ°main_goæ–‡ä»¶ä¸­ã€‚æˆ‘çŸ¥é“è¿™äº›éƒ½æ˜¯å¾®æœåŠ¡ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ··ä¹±çš„å€Ÿå£!å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨consignationserviceã€handler.goã€datastore.goå’Œrepository.goä¸­åˆ›å»ºä¸¤ä¸ªæ›´å¤šçš„æ–‡ä»¶ã€‚æˆ‘åœ¨æœåŠ¡çš„æ ¹ç›®å½•ä¸­åˆ›å»ºè¿™äº›ï¼Œè€Œä¸æ˜¯åˆ›å»ºå®ƒä»¬ä½œä¸ºæ–°çš„åŒ…å’Œç›®å½•ã€‚è¿™å¯¹äºå°å‹çš„å¾®æœåŠ¡æ¥è¯´æ˜¯å®Œå…¨è¶³å¤Ÿçš„ã€‚å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œåˆ›å»ºè¿™æ ·çš„ç»“æ„æ˜¯ä¸€ç§å¸¸è§çš„è¯±æƒ‘: 12345678main.gomodels/ user.gohandlers/ auth.go user.goservices/ auth.go è¿™åˆå›åˆ°äº†MVCæ—¶ä»£ï¼Œåœ¨Golangä¸­å¹¶æ²¡æœ‰å¾—åˆ°çœŸæ­£çš„å»ºè®®ã€‚å½“ç„¶ä¸æ˜¯å°é¡¹ç›®ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªæ›´å¤§çš„é¡¹ç›®ï¼Œæœ‰å¤šä¸ªå…³æ³¨ç‚¹ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ç»„ç»‡å®ƒ: 1234567891011121314main.gousers/ services/ auth.go handlers/ auth.go user.go users/ user.gocontainers/ services/ manage.go models/ container.go åœ¨è¿™é‡Œï¼Œæ‚¨æ˜¯æŒ‰åŸŸå¯¹ä»£ç è¿›è¡Œåˆ†ç»„ï¼Œè€Œä¸æ˜¯æŒ‰å…¶æ‰€åšçš„ä»»æ„åˆ†ç»„ä»£ç ã€‚ ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå®ƒåº”è¯¥åªå¤„ç†ä¸€ä¸ªå•ä¸€çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦é‡‡å–ä¸Šè¿°ä»»ä½•ä¸€ç§æ–¹æ³•ã€‚äº‹å®ä¸Šï¼ŒGoçš„å®—æ—¨æ˜¯é¼“åŠ±ç®€å•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä»ç®€å•çš„å¼€å§‹ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹éƒ½æ”¾åœ¨æœåŠ¡çš„æ ¹ç›®å½•ä¸­ï¼Œå¹¶ä½¿ç”¨ä¸€äº›æ˜ç¡®å®šä¹‰çš„æ–‡ä»¶åã€‚ ä½œä¸ºé™„å¸¦è¯´æ˜ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°Dockerfileçš„æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å°†æ–°çš„åˆ†ç¦»çš„ä»£ç å¯¼å…¥åˆ°åŒ…ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰goç¼–è¯‘å™¨å°†è¿™äº›æ–°æ–‡ä»¶æ‹–å…¥å…¶ä¸­ã€‚å› æ­¤ï¼Œæ›´æ–°æ„å»ºå‡½æ•°å¦‚ä¸‹æ‰€ç¤º: 1RUN CGO_ENABLED=0 GOOS=linux go build -o consignment-service -a -installsuffix cgo main.go repository.go handler.go datastore.go è¿™å°†åŒ…æ‹¬æˆ‘ä»¬å°†è¦åˆ›å»ºçš„æ–°æ–‡ä»¶ã€‚ MongoDB Golang libæ˜¯è¿™ä¸ªç®€å•çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œæœ€åï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡å…³äºç»„ç»‡Go codebaseçš„å¥½æ–‡ç« ã€‚ è®©æˆ‘ä»¬é¦–å…ˆä»main.goä¸­åˆ é™¤æ‰€æœ‰çš„å­˜å‚¨åº“ä»£ç ï¼Œå¹¶é‡æ–°ä½¿ç”¨å®ƒæ¥ä½¿ç”¨mongodbåº“ï¼Œmgoã€‚å†ä¸€æ¬¡ï¼Œæˆ‘è¯•ç€æ³¨é‡Šä»£ç æ¥è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¯·ä»”ç»†é˜…è¯»ä»£ç å’Œæ³¨é‡Šã€‚ç‰¹åˆ«æ˜¯å…³äºmgoå¦‚ä½•å¤„ç†ä¼šè¯çš„éƒ¨åˆ†: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// consignment-service/repository.gopackage mainimport ( pb \"github.com/EwanValentine/shippy/consignment-service/proto/consignment\" \"gopkg.in/mgo.v2\")const ( dbName = \"shippy\" consignmentCollection = \"consignments\")type Repository interface &#123; Create(*pb.Consignment) error GetAll() ([]*pb.Consignment, error) Close()&#125;type ConsignmentRepository struct &#123; session *mgo.Session&#125;// Create a new consignmentfunc (repo *ConsignmentRepository) Create(consignment *pb.Consignment) error &#123; return repo.collection().Insert(consignment)&#125;// GetAll consignmentsfunc (repo *ConsignmentRepository) GetAll() ([]*pb.Consignment, error) &#123; var consignments []*pb.Consignment // Find normally takes a query, but as we want everything, we can nil this. // We then bind our consignments variable by passing it as an argument to .All(). // That sets consignments to the result of the find query. // There's also a `One()` function for single results. err := repo.collection().Find(nil).All(&amp;consignments) return consignments, err&#125;// Close closes the database session after each query has ran.// Mgo creates a 'master' session on start-up, it's then good practice// to copy a new session for each request that's made. This means that// each request has its own database session. This is safer and more efficient,// as under the hood each session has its own database socket and error handling.// Using one main database socket means requests having to wait for that session.// I.e this approach avoids locking and allows for requests to be processed concurrently. Nice!// But... it does mean we need to ensure each session is closed on completion. Otherwise// you'll likely build up loads of dud connections and hit a connection limit. Not nice!func (repo *ConsignmentRepository) Close() &#123; repo.session.Close()&#125;func (repo *ConsignmentRepository) collection() *mgo.Collection &#123; return repo.session.DB(dbName).C(consignmentCollection)&#125; å› æ­¤ï¼Œæˆ‘ä»¬çš„ä»£ç è´Ÿè´£ä¸Mongodbæ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºåˆ›å»ºä¸»session/connection.çš„ä»£ç ã€‚æ›´æ–°consignment-service/datastore.goã€‚ç”¨ä»¥ä¸‹: 123456789101112131415161718// consignment-service/datastore.gopackage mainimport ( \"gopkg.in/mgo.v2\")// CreateSession creates the main session to our mongodb instancefunc CreateSession(host string) (*mgo.Session, error) &#123; session, err := mgo.Dial(host) if err != nil &#123; return nil, err &#125; session.SetMode(mgo.Monotonic, true) return session, nil&#125; å°±æ˜¯è¿™æ ·ï¼Œéå¸¸ç›´æ¥ã€‚å®ƒä»¥ä¸€ä¸ªä¸»æœºå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå°†ä¼šè¯è¿”å›ç»™æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨çš„é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨æ—¶å¤„ç†å®ƒã€‚è®©æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„ä¸»ã€‚å°†æ­¤æ–‡ä»¶è¿æ¥åˆ°æˆ‘ä»¬çš„å­˜å‚¨åº“: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// consignment-service/main.gopackage mainimport ( // Import the generated protobuf code \"fmt\" \"log\" pb \"github.com/EwanValentine/shippy/consignment-service/proto/consignment\" vesselProto \"github.com/EwanValentine/shippy/vessel-service/proto/vessel\" \"github.com/micro/go-micro\" \"os\")const ( defaultHost = \"localhost:27017\")func main() &#123; // Database host from the environment variables host := os.Getenv(\"DB_HOST\") if host == \"\" &#123; host = defaultHost &#125; session, err := CreateSession(host) // Mgo creates a 'master' session, we need to end that session // before the main function closes. defer session.Close() if err != nil &#123; // We're wrapping the error returned from our CreateSession // here to add some context to the error. log.Panicf(\"Could not connect to datastore with host %s - %v\", host, err) &#125; // Create a new service. Optionally include some options here. srv := micro.NewService( // This name must match the package name given in your protobuf definition micro.Name(\"go.micro.srv.consignment\"), micro.Version(\"latest\"), ) vesselClient := vesselProto.NewVesselService(\"go.micro.srv.vessel\", srv.Client()) // Init will parse the command line flags. srv.Init() // Register handler pb.RegisterShippingServiceHandler(srv.Server(), &amp;service&#123;session, vesselClient&#125;) // Run the server if err := srv.Run(); err != nil &#123; fmt.Println(err) &#125;&#125; å¤åˆ¶å’Œå…‹éš†æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä½¿ç”¨mgo Mongodbåº“æ—¶ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ä¼šè¯ï¼Œå®ƒè¢«ä¼ é€’åˆ°æˆ‘ä»¬çš„å¤„ç†ç¨‹åºä¸­ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ¥å…‹éš†è¯¥ä¼šè¯å¹¶å°†å…¶ä¼ é€’åˆ°å­˜å‚¨åº“ä»£ç ä¸­ã€‚ å®é™…ä¸Šï¼Œé™¤äº†ç”Ÿæˆä¸æ•°æ®åº“çš„ç¬¬ä¸€ä¸ªè¿æ¥ä¹‹å¤–ï¼Œæˆ‘ä»¬ä»æœªæ¥è§¦è¿‡â€œä¸»ä¼šè¯â€ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½è¦å¯¹æ•°æ®å­˜å‚¨è¿›è¡Œè°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨äº†session.clone()ã€‚æ­£å¦‚æˆ‘åœ¨ä»£ç æ³¨é‡Šä¸­ç®€è¦æåˆ°çš„ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå€¼å¾—é‡æ–°è¿­ä»£ä¸€äº›ç»†èŠ‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ä¸»ä¼šè¯ï¼Œæ‚¨å°†é‡ç”¨ç›¸åŒçš„å¥—æ¥å­—ã€‚è¿™æ„å‘³ç€æ‚¨çš„æŸ¥è¯¢å¯èƒ½ä¼šè¢«å…¶ä»–æŸ¥è¯¢é˜»å¡ï¼Œå¹¶ä¸”å¿…é¡»ç­‰å¾…æ“ä½œåœ¨è¿™ä¸ªå¥—æ¥å­—ä¸Šå®Œæˆã€‚è¿™åœ¨æ”¯æŒå¹¶å‘æ€§çš„è¯­è¨€ä¸­æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ å› æ­¤ï¼Œä¸ºäº†é¿å…é˜»å¡è¯·æ±‚ï¼Œmgoå…è®¸æ‚¨Copy() æˆ– Clone()ä¸€ä¸ªä¼šè¯ï¼Œä»¥ä¾¿æ‚¨å¯¹æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ä¸€ä¸ªå¹¶å‘è¿æ¥ã€‚æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘æåˆ°è¿‡å¤åˆ¶å’Œå…‹éš†æ–¹æ³•ï¼Œå®ƒä»¬éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç»†å¾®ä½†é‡è¦çš„åŒºåˆ«ã€‚å…‹éš†é‡æ–°ä½¿ç”¨ä¸masterç›¸åŒçš„å¥—æ¥å­—ã€‚è¿™å‡å°‘äº†ç”Ÿæˆä¸€ä¸ªå…¨æ–°å¥—æ¥å­—çš„å¼€é”€ã€‚è¿™æ˜¯å¿«é€Ÿå†™æ€§èƒ½çš„æœ€ä½³é€‰æ‹©ã€‚ç„¶è€Œï¼Œæ›´é•¿çš„æ“ä½œï¼Œä¾‹å¦‚æ›´å¤æ‚çš„æŸ¥è¯¢æˆ–å¤§æ•°æ®ä½œä¸šç­‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–çš„goä¾‹ç¨‹é˜»å¡ï¼Œè¯•å›¾ä½¿ç”¨è¿™ä¸ªå¥—æ¥å­—ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œä½ æœ€å¥½æ˜¯åƒæˆ‘ä»¬è¿™æ ·çš„å…‹éš†ã€‚ æˆ‘ä»¬éœ€è¦åšçš„æœ€åä¸€ç‚¹æ•´ç†æ˜¯å°†gRPCå¤„ç†ç¨‹åºä»£ç ç§»åˆ°æ–°çš„handler.goæ–‡ä»¶ã€‚è®©æˆ‘ä»¬è¿™æ ·åšã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667// consignment-service.gopackage mainimport ( \"log\" \"golang.org/x/net/context\" pb \"github.com/EwanValentine/shippy/consignment-service/proto/consignment\" vesselProto \"github.com/EwanValentine/shippy/vessel-service/proto/vessel\")// Service should implement all of the methods to satisfy the service// we defined in our protobuf definition. You can check the interface// in the generated code itself for the exact method signatures etc// to give you a better idea.type service struct &#123; vesselClient vesselProto.NewVesselService&#125;func (s *service) GetRepo() Repository &#123; return &amp;ConsignmentRepository&#123;s.session.Clone()&#125;&#125;// CreateConsignment - we created just one method on our service,// which is a create method, which takes a context and a request as an// argument, these are handled by the gRPC server.func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment, res *pb.Response) error &#123; repo := s.GetRepo() defer repo.Close() // Here we call a client instance of our vessel service with our consignment weight, // and the amount of containers as the capacity value vesselResponse, err := s.vesselClient.FindAvailable(context.Background(), &amp;vesselProto.Specification&#123; MaxWeight: req.Weight, Capacity: int32(len(req.Containers)), &#125;) log.Printf(\"Found vessel: %s \\n\", vesselResponse.Vessel.Name) if err != nil &#123; return err &#125; // We set the VesselId as the vessel we got back from our // vessel service req.VesselId = vesselResponse.Vessel.Id // Save our consignment err = repo.Create(req) if err != nil &#123; return err &#125; // Return matching the `Response` message we created in our // protobuf definition. res.Created = true res.Consignment = req return nil&#125;func (s *service) GetConsignments(ctx context.Context, req *pb.GetRequest, res *pb.Response) error &#123; repo := s.GetRepo() defer repo.Close() consignments, err := repo.GetAll() if err != nil &#123; return err &#125; res.Consignments = consignments return nil&#125; æˆ‘ä»¬å·²ç»æ›´æ–°äº†æˆ‘ä»¬çš„repoä¸­çš„ä¸€äº›è¿”å›å‚æ•°ï¼Œè¿™äº›å‚æ•°æ¥è‡ªäºä¸Šä¸€ä¸ªæ•™ç¨‹:Old: 1234type Repository interface &#123; Create(*pb.Consignment) (*pb.Consignment, error) GetAll() []*pb.Consignment&#125; New: 12345type Repository interface &#123; Create(*pb.Consignment) error GetAll() ([]*pb.Consignment, error) Close()&#125; è¿™åªæ˜¯å› ä¸ºæˆ‘è§‰å¾—æˆ‘ä»¬ä¸éœ€è¦åœ¨åˆ›å»ºåè¿”å›ç›¸åŒçš„è´§ç‰©ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä»mgoè¿”å›ä¸€ä¸ªé€‚å½“çš„é”™è¯¯ï¼Œä»¥è·å–æˆ‘ä»¬çš„getæŸ¥è¯¢ã€‚å¦åˆ™ä»£ç æˆ–å¤šæˆ–å°‘æ˜¯ç›¸åŒçš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„å°é—­æ–¹æ³•æ·»åŠ åˆ°æ¥å£ä¸­ã€‚ ç°åœ¨è®©æˆ‘ä»¬å¯¹æ‚¨çš„vessel-serviceåšåŒæ ·çš„æ“ä½œã€‚æˆ‘ä¸æ‰“ç®—åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ¼”ç¤ºï¼Œä½ åº”è¯¥åœ¨è¿™ä¸€ç‚¹ä¸Šæœ‰ä¸€ä¸ªå¥½çš„æ„Ÿè§‰ã€‚è®°ä½ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æˆ‘çš„å­˜å‚¨åº“ä½œä¸ºå‚è€ƒã€‚ ä¸è¿‡ï¼Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„vesselserviceæ·»åŠ ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬åˆ›å»ºæ–°çš„å®¹å™¨ã€‚ä¸ä»¥å¾€ä¸€æ ·ï¼Œè®©æˆ‘ä»¬ä»æ›´æ–°æˆ‘ä»¬çš„protobufå®šä¹‰å¼€å§‹: 12345678910111213141516171819202122232425262728syntax = \"proto3\";package vessel;service VesselService &#123; rpc FindAvailable(Specification) returns (Response) &#123;&#125; rpc Create(Vessel) returns (Response) &#123;&#125;&#125;message Vessel &#123; string id = 1; int32 capacity = 2; int32 max_weight = 3; string name = 4; bool available = 5; string owner_id = 6;&#125;message Specification &#123; int32 capacity = 1; int32 max_weight = 2;&#125;message Response &#123; Vessel vessel = 1; repeated Vessel vessels = 2; bool created = 3;&#125; æˆ‘ä»¬åœ¨gRPCæœåŠ¡ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ–°åˆ›å»ºæ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå®¹å™¨å¹¶è¿”å›æˆ‘ä»¬çš„ä¸€èˆ¬å“åº”ã€‚æˆ‘ä»¬è¿˜ä¸ºå“åº”æ¶ˆæ¯æ·»åŠ äº†ä¸€ä¸ªæ–°å­—æ®µï¼Œä»…ä»…æ˜¯ä¸€ä¸ªåˆ›å»ºçš„boolã€‚è¿è¡Œ$ makeæ„å»ºä»¥æ›´æ–°æ­¤æœåŠ¡ã€‚ç°åœ¨æˆ‘ä»¬å°†åœ¨vessel-service/handler.goä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å¤„ç†ç¨‹åºå’Œä¸€ä¸ªæ–°çš„å­˜å‚¨åº“æ–¹æ³•: 12345678910111213141516// vessel-service/handler.gofunc (s *service) GetRepo() Repository &#123; return &amp;VesselRepository&#123;s.session.Clone()&#125;&#125;func (s *service) Create(ctx context.Context, req *pb.Vessel, res *pb.Response) error &#123; repo := s.GetRepo() defer repo.Close() if err := repo.Create(req); err != nil &#123; return err &#125; res.Vessel = req res.Created = true return nil&#125; 1234// vessel-service/repository.gofunc (repo *VesselRepository) Create(vessel *pb.Vessel) error &#123; return repo.collection().Insert(vessel)&#125; æ‰€ä»¥åœ¨è¿™ä¹‹åã€‚æˆ‘ä»¬å·²ç»æ›´æ–°äº†æˆ‘ä»¬çš„æœåŠ¡ä»¥ä½¿ç”¨Mongodbã€‚åœ¨å°è¯•è¿è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°docker-composeæ–‡ä»¶ï¼Œä»¥åŒ…å«Mongodbå®¹å™¨: 123456services: ... datastore: image: mongo ports: - 27017:27017 åœ¨æ‚¨çš„ä¸¤ä¸ªæœåŠ¡ä¸­æ›´æ–°ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬:DB_HOST:â€œdatastore:27017â€ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨ç§°ä¸ºä¸»æœºåï¼Œè€Œä¸æ˜¯æœ¬åœ°ä¸»æœºã€‚è¿™æ˜¯å› ä¸ºdocker-ç»„åˆä¸ºæˆ‘ä»¬å¤„ç†äº†ä¸€äº›èªæ˜çš„å†…éƒ¨DNSã€‚ æ‰€ä»¥ä½ åº”è¯¥: 12345678910111213141516171819202122232425262728293031version: '3.1'services: consignment-cli: build: ./consignment-cli environment: MICRO_REGISTRY: \"mdns\" consignment-service: build: ./consignment-service ports: - 50051:50051 environment: MICRO_ADDRESS: \":50051\" MICRO_REGISTRY: \"mdns\" DB_HOST: \"datastore:27017\" vessel-service: build: ./vessel-service ports: - 50052:50051 environment: MICRO_ADDRESS: \":50051\" MICRO_REGISTRY: \"mdns\" DB_HOST: \"datastore:27017\" datastore: image: mongo ports: - 27017:27017 é‡æ–°æ„å»ºæ‚¨çš„å †æ ˆ$ docker-compose buildå¹¶é‡æ–°è¿è¡Œå®ƒ$ docker-compose upã€‚æ³¨æ„ï¼Œæœ‰æ—¶ç”±äºDockersç¼“å­˜ï¼Œæ‚¨å¯èƒ½éœ€è¦è¿è¡Œä¸€ä¸ªcachelessæ„å»ºæ¥è·å–æŸäº›æ›´æ”¹ã€‚è¦åœ¨docker-composeä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œåªéœ€åœ¨è¿è¡Œ$ docker-compose buildæ—¶ä½¿ç”¨-no-cacheæ ‡å¿—ã€‚ ç”¨æˆ·æœåŠ¡ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸‰ä¸ªæœåŠ¡ã€‚æˆ‘ä»¬å°†ä»æ›´æ–°docker-compose.ymlæ–‡ä»¶å¼€å§‹ã€‚æ­¤å¤–ï¼Œä¸ºäº†å°†å†…å®¹æ··åˆèµ·æ¥ï¼Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·æœåŠ¡åœ¨dockerå †æ ˆä¸­æ·»åŠ Postgres: 1234567891011121314... user-service: build: ./user-service ports: - 50053:50051 environment: MICRO_ADDRESS: \":50051\" MICRO_REGISTRY: \"mdns\" ... database: image: postgres ports: - 5432:5432 ç°åœ¨åœ¨æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·æœåŠ¡ç›®å½•ã€‚å’Œä¹‹å‰çš„æœåŠ¡ä¸€æ ·ã€‚åˆ›å»ºä¸‹åˆ—æ–‡ä»¶:handler.go, main.go, repository.go, database.go, Dockerfile, Makefileï¼Œæˆ‘ä»¬çš„protoæ–‡ä»¶çš„å­ç›®å½•ï¼Œæœ€åæ˜¯protoæ–‡ä»¶æœ¬èº«:proto/user/user.protoã€‚ å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°user.proto: 1234567891011121314151617181920212223242526272829303132333435363738syntax = &quot;proto3&quot;;package go.micro.srv.user;service UserService &#123; rpc Create(User) returns (Response) &#123;&#125; rpc Get(User) returns (Response) &#123;&#125; rpc GetAll(Request) returns (Response) &#123;&#125; rpc Auth(User) returns (Token) &#123;&#125; rpc ValidateToken(Token) returns (Token) &#123;&#125;&#125;message User &#123; string id = 1; string name = 2; string company = 3; string email = 4; string password = 5;&#125;message Request &#123;&#125;message Response &#123; User user = 1; repeated User users = 2; repeated Error errors = 3;&#125;message Token &#123; string token = 1; bool valid = 2; repeated Error errors = 3;&#125;message Error &#123; int32 code = 1; string description = 2;&#125; ç°åœ¨ï¼Œç¡®ä¿æ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç±»ä¼¼äºæˆ‘ä»¬ä»¥å‰çš„æœåŠ¡çš„Makefileï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè¿è¡Œ$ makeæ„å»ºæ¥ç”Ÿæˆæˆ‘ä»¬çš„gRPCä»£ç ã€‚æ ¹æ®æˆ‘ä»¬ä»¥å‰çš„æœåŠ¡ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€äº›ä»£ç æ¥æ¥å£æˆ‘ä»¬çš„gRPCæ–¹æ³•ã€‚æˆ‘ä»¬åªä¼šè®©å…¶ä¸­çš„ä¸€éƒ¨åˆ†åœ¨è¿™ä¸ªç³»åˆ—çš„è¿™ä¸€éƒ¨åˆ†ä¸­å·¥ä½œã€‚æˆ‘ä»¬åªæ˜¯å¸Œæœ›èƒ½å¤Ÿåˆ›å»ºå’Œè·å–ä¸€ä¸ªç”¨æˆ·ã€‚åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºèº«ä»½éªŒè¯å’ŒJWTã€‚æ‰€ä»¥æˆ‘ä»¬å°†ä¼šç•™ä¸‹ä»»ä½•ä¸ç°åœ¨æœ‰å…³çš„æ ‡è®°ã€‚æ‚¨çš„å¤„ç†ç¨‹åºåº”è¯¥æ˜¯è¿™æ ·çš„: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// user-service/handler.gopackage mainimport ( \"golang.org/x/net/context\" pb \"github.com/EwanValentine/shippy/user-service/proto/user\")type service struct &#123; repo Repository tokenService Authable&#125;func (srv *service) Get(ctx context.Context, req *pb.User, res *pb.Response) error &#123; user, err := srv.repo.Get(req.Id) if err != nil &#123; return err &#125; res.User = user return nil&#125;func (srv *service) GetAll(ctx context.Context, req *pb.Request, res *pb.Response) error &#123; users, err := srv.repo.GetAll() if err != nil &#123; return err &#125; res.Users = users return nil&#125;func (srv *service) Auth(ctx context.Context, req *pb.User, res *pb.Token) error &#123; user, err := srv.repo.GetByEmailAndPassword(req) if err != nil &#123; return err &#125; res.Token = \"testingabc\" return nil&#125;func (srv *service) Create(ctx context.Context, req *pb.User, res *pb.Response) error &#123; if err := srv.repo.Create(req); err != nil &#123; return err &#125; res.User = req return nil&#125;func (srv *service) ValidateToken(ctx context.Context, req *pb.Token, res *pb.Token) error &#123; return nil&#125; ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ æˆ‘ä»¬çš„å­˜å‚¨åº“ä»£ç : 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// user-service/repository.gopackage mainimport ( pb \"github.com/EwanValentine/shippy/user-service/proto/user\" \"github.com/jinzhu/gorm\")type Repository interface &#123; GetAll() ([]*pb.User, error) Get(id string) (*pb.User, error) Create(user *pb.User) error GetByEmailAndPassword(user *pb.User) (*pb.User, error)&#125;type UserRepository struct &#123; db *gorm.DB&#125;func (repo *UserRepository) GetAll() ([]*pb.User, error) &#123; var users []*pb.User if err := repo.db.Find(&amp;users).Error; err != nil &#123; return nil, err &#125; return users, nil&#125;func (repo *UserRepository) Get(id string) (*pb.User, error) &#123; var user *pb.User user.Id = id if err := repo.db.First(&amp;user).Error; err != nil &#123; return nil, err &#125; return user, nil&#125;func (repo *UserRepository) GetByEmailAndPassword(user *pb.User) (*pb.User, error) &#123; if err := repo.db.First(&amp;user).Error; err != nil &#123; return nil, err &#125; return user, nil&#125;func (repo *UserRepository) Create(user *pb.User) error &#123; if err := repo.db.Create(user).Error; err != nil &#123; return err &#125;&#125; æˆ‘ä»¬è¿˜éœ€è¦æ”¹å˜ORMçš„è¡Œä¸ºæ¥ç”Ÿæˆä¸€ä¸ªUUIDï¼Œè€Œä¸æ˜¯è¯•å›¾ç”Ÿæˆä¸€ä¸ªæ•´æ•°IDï¼Œå¦‚æœä½ ä¸çŸ¥é“ï¼ŒUUIDæ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„è¿å­—ç¬¦å­—ç¬¦ä¸²ï¼Œç”¨ä½œIDæˆ–ä¸»é”®ã€‚è¿™æ¯”ä½¿ç”¨è‡ªåŠ¨é€’å¢çš„IDæ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒé˜»æ­¢äººä»¬çŒœæµ‹æˆ–éå†APIç«¯ç‚¹ã€‚MongoDBå·²ç»ä½¿ç”¨äº†è¿™ç§å˜ä½“ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å‘Šè¯‰æˆ‘ä»¬çš„Postgresæ¨¡å‹ä½¿ç”¨UUIDã€‚å› æ­¤ï¼Œåœ¨user-service/proto/userä¸­åˆ›å»ºä¸€ä¸ªåä¸ºextensions.goçš„æ–°æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæ·»åŠ : 1234567891011package go_micro_srv_userimport ( \"github.com/jinzhu/gorm\" \"github.com/satori/go.uuid\")func (model *User) BeforeCreate(scope *gorm.Scope) error &#123; uuid := uuid.NewV4() return scope.SetColumn(\"Id\", uuid.String())&#125; è¿™ä¸ªé’©å­è¿›å…¥GORMçš„äº‹ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œä»¥ä¾¿åœ¨å®ä½“è¢«ä¿å­˜ä¹‹å‰ä¸ºIdåˆ—ç”ŸæˆUUIDã€‚ æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œä¸æˆ‘ä»¬çš„MongodbæœåŠ¡ä¸åŒï¼Œæˆ‘ä»¬æ²¡æœ‰è¿›è¡Œä»»ä½•è¿æ¥å¤„ç†ã€‚æœ¬æœºã€SQL/postgresé©±åŠ¨ç¨‹åºçš„å·¥ä½œæ–¹å¼ç•¥æœ‰ä¸åŒï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªåä¸ºâ€œgormâ€çš„è½¯ä»¶åŒ…ï¼Œè®©æˆ‘ä»¬ç®€å•åœ°è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ Gorm - Go + ORMGormæ˜¯ä¸€ä¸ªåˆç†çš„è½»é‡çº§å¯¹è±¡å…³ç³»æ˜ å°„å™¨ï¼Œå®ƒä¸Postgresã€MySQLã€Sqliteç­‰å¾ˆå¥½åœ°å·¥ä½œï¼Œå®ƒå¾ˆå®¹æ˜“è®¾ç½®ã€ä½¿ç”¨å’Œç®¡ç†æ•°æ®åº“æ¨¡å¼è‡ªåŠ¨æ›´æ”¹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨å¾®æœåŠ¡ï¼Œæ‚¨çš„æ•°æ®ç»“æ„è¦å°å¾—å¤šï¼ŒåŒ…å«æ›´å°‘çš„è¿æ¥å’Œæ•´ä½“çš„å¤æ‚æ€§ã€‚æ‰€ä»¥ï¼Œä¸è¦è§‰å¾—ä½ åº”è¯¥ä½¿ç”¨ä»»ä½•ç±»å‹çš„ORMã€‚ æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæµ‹è¯•åˆ›å»ºç”¨æˆ·ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªcliå·¥å…·ã€‚è¿™ä¸€æ¬¡ç”¨æˆ·cliåœ¨æˆ‘ä»¬çš„é¡¹ç›®æ ¹ä¸­ã€‚ç±»ä¼¼äºæˆ‘ä»¬çš„consignment-cliï¼Œä½†è¿™æ¬¡: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package mainimport ( \"log\" \"os\" pb \"github.com/EwanValentine/shippy/user-service/proto/user\" microclient \"github.com/micro/go-micro/client\" \"github.com/micro/go-micro/cmd\" \"golang.org/x/net/context\" \"github.com/micro/cli\" \"github.com/micro/go-micro\")func main() &#123; cmd.Init() // Create new greeter client client := pb.NewUserService(\"go.micro.srv.user\", microclient.DefaultClient) // Define our flags service := micro.NewService( micro.Flags( cli.StringFlag&#123; Name: \"name\", Usage: \"You full name\", &#125;, cli.StringFlag&#123; Name: \"email\", Usage: \"Your email\", &#125;, cli.StringFlag&#123; Name: \"password\", Usage: \"Your password\", &#125;, cli.StringFlag&#123; Name: \"company\", Usage: \"Your company\", &#125;, ), ) // Start as service service.Init( micro.Action(func(c *cli.Context) &#123; name := c.String(\"name\") email := c.String(\"email\") password := c.String(\"password\") company := c.String(\"company\") // Call our user service r, err := client.Create(context.TODO(), &amp;pb.User&#123; Name: name, Email: email, Password: password, Company: company, &#125;) if err != nil &#123; log.Fatalf(\"Could not create: %v\", err) &#125; log.Printf(\"Created: %s\", r.User.Id) getAll, err := client.GetAll(context.Background(), &amp;pb.Request&#123;&#125;) if err != nil &#123; log.Fatalf(\"Could not list users: %v\", err) &#125; for _, v := range getAll.Users &#123; log.Println(v) &#125; os.Exit(0) &#125;), ) // Run the server if err := service.Run(); err != nil &#123; log.Println(err) &#125;&#125; è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†go-microçš„å‘½ä»¤è¡Œå¸®åŠ©å™¨ï¼Œéå¸¸ç®€æ´ã€‚ æˆ‘ä»¬å¯ä»¥è¿è¡Œè¿™ä¸ªå¹¶åˆ›å»ºä¸€ä¸ªç”¨æˆ·: 12345$ docker-compose run user-cli command \\ --name=\"Ewan Valentine\" \\ --email=\"ewan.valentine89@gmail.com\" \\ --password=\"Testing123\" \\ --company=\"BBC\" æ‚¨åº”è¯¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°åˆ›å»ºçš„ç”¨æˆ·! è¿™ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œå› ä¸ºç›®å‰æˆ‘ä»¬å­˜å‚¨çš„æ˜¯æ˜æ–‡å¯†ç ï¼Œä½†æ˜¯åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„æœåŠ¡ä¸­æŸ¥çœ‹èº«ä»½éªŒè¯å’ŒJWTæ ‡è®°ã€‚ æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„æœåŠ¡ï¼Œä¸€ä¸ªé¢å¤–çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæˆ‘ä»¬å¼€å§‹ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ•°æ®åº“æŠ€æœ¯æ¥ä¿å­˜æ•°æ®ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†å¾ˆå¤šé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬è¿‡äºè¿…é€Ÿåœ°è®¨è®ºä»»ä½•äº‹æƒ…ï¼Œæ¶‰åŠå¤ªå¤šæˆ–å‡è®¾å¤ªå¤šçš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±ä¼šé“æ­‰ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬äºŒéƒ¨åˆ†(Dockerå’Œgo-micro)","slug":"go-micro-tutorial-2","date":"2018-05-10T13:56:23.000Z","updated":"2020-07-25T02:57:18.204Z","comments":true,"path":"2018/05/10/go-micro-tutorial-2/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-2/","excerpt":"ä»‹ç»åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ç¼–å†™åŸºäºgRPCçš„å¾®æœåŠ¡çš„åŸºç¡€çŸ¥è¯†ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†;æˆ‘ä»¬å°†ä»‹ç»dockeringaæœåŠ¡çš„åŸºæœ¬å†…å®¹ï¼Œæˆ‘ä»¬è¿˜å°†æ›´æ–°æˆ‘ä»¬çš„æœåŠ¡ä»¥ä½¿ç”¨go-microï¼Œæœ€åï¼Œå¼•å…¥ç¬¬äºŒä¸ªæœåŠ¡ã€‚","text":"ä»‹ç»åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ç¼–å†™åŸºäºgRPCçš„å¾®æœåŠ¡çš„åŸºç¡€çŸ¥è¯†ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†;æˆ‘ä»¬å°†ä»‹ç»dockeringaæœåŠ¡çš„åŸºæœ¬å†…å®¹ï¼Œæˆ‘ä»¬è¿˜å°†æ›´æ–°æˆ‘ä»¬çš„æœåŠ¡ä»¥ä½¿ç”¨go-microï¼Œæœ€åï¼Œå¼•å…¥ç¬¬äºŒä¸ªæœåŠ¡ã€‚ ä»‹ç» Dockeréšç€äº‘è®¡ç®—çš„å‡ºç°å’Œå¾®æœåŠ¡çš„è¯ç”Ÿã€‚éƒ¨ç½²æ›´å¤šã€ä½†æ›´å°çš„ä»£ç å—çš„å‹åŠ›å¯¼è‡´äº†ä¸€äº›æœ‰è¶£çš„æ–°æƒ³æ³•å’ŒæŠ€æœ¯ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯å®¹å™¨çš„æ¦‚å¿µã€‚ ä¼ ç»Ÿä¸Šï¼Œå›¢é˜Ÿä¼šå°†ä¸€ä¸ªæ•´ä½“ç³»ç»Ÿéƒ¨ç½²åˆ°é™æ€æœåŠ¡å™¨ä¸Šï¼Œè¿è¡Œä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨é¢„å®šä¹‰çš„ä¾èµ–é›†æ¥è·Ÿè¸ªã€‚æˆ–è€…å¯èƒ½æ˜¯ç”±Chefæˆ–Puppetæä¾›çš„è™šæ‹Ÿæœºã€‚æ‰©å¤§è§„æ¨¡æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œä½†å¹¶ä¸æ˜¯é‚£ä¹ˆæœ‰æ•ˆã€‚æœ€å¸¸è§çš„é€‰é¡¹æ˜¯å‚ç›´ç¼©æ”¾ã€‚åœ¨é™æ€æœåŠ¡å™¨ä¸ŠæŠ›å‡ºè¶Šæ¥è¶Šå¤šçš„èµ„æºã€‚ åƒvagrantè¿™æ ·çš„å·¥å…·å‡ºç°äº†ï¼Œä½¿å¾—ä¾›åº”VMå˜å¾—ç›¸å½“çç¢ã€‚ä½†æ˜¯ï¼Œè¿è¡ŒVMä»ç„¶æ˜¯ä¸€ä¸ªç›¸å½“é‡è¦çš„æ“ä½œã€‚æ‚¨æ­£åœ¨è¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå®ƒçš„æ‰€æœ‰è£èª‰ï¼Œå†…æ ¸å’Œæ‰€æœ‰ï¼Œåœ¨æ‚¨çš„ä¸»æœºã€‚åœ¨èµ„æºæ–¹é¢ï¼Œè¿™æ˜¯ç›¸å½“æ˜‚è´µçš„ã€‚å› æ­¤ï¼Œå½“microserviceså‡ºç°æ—¶ï¼Œåœ¨å®ƒä»¬è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œè¿™ä¹ˆå¤šå•ç‹¬çš„ä»£ç åº“æ˜¯ä¸å¯èƒ½çš„ã€‚ éšä¹‹è€Œæ¥çš„å®¹å™¨å®¹å™¨æ˜¯æ“ä½œç³»ç»Ÿçš„ç®€åŒ–ç‰ˆæœ¬ã€‚å®¹å™¨ä¸åŒ…å«å†…æ ¸ã€å®¢æˆ·æ“ä½œç³»ç»Ÿæˆ–ä»»ä½•è¾ƒä½çº§åˆ«çš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶é€šå¸¸ç»„æˆä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚ å®¹å™¨åªåŒ…å«é¡¶çº§åº“åŠå…¶è¿è¡Œæ—¶ç»„ä»¶ã€‚å†…æ ¸åœ¨ä¸»æœºä¸Šå…±äº«ã€‚å› æ­¤ï¼Œä¸»æœºè¿è¡Œä¸€ä¸ªå•ä¸€çš„Unixå†…æ ¸ï¼Œç„¶åç”±nä¸ªå®¹å™¨å…±äº«ï¼Œè¿è¡Œéå¸¸ä¸åŒçš„è¿è¡Œæ—¶é›†ã€‚ åœ¨å¼•æ“ç›–ä¸‹ï¼Œå®¹å™¨ä½¿ç”¨å„ç§å†…æ ¸å®ç”¨ç¨‹åºï¼Œä»¥ä¾¿åœ¨å®¹å™¨ç©ºé—´ä¹‹é—´å…±äº«èµ„æºå’Œç½‘ç»œåŠŸèƒ½ã€‚ è¿›ä¸€æ­¥çš„é˜…è¯» è¿™æ„å‘³ç€æ‚¨å¯ä»¥è¿è¡Œè¿è¡Œæ—¶å’Œä»£ç éœ€è¦çš„ä¾èµ–é¡¹ï¼Œè€Œä¸éœ€è¦å¯åŠ¨å‡ ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿã€‚è¿™æ˜¯ä¸€ä¸ªæ¸¸æˆè§„åˆ™çš„æ”¹å˜è€…ï¼Œå› ä¸ºä¸€ä¸ªå®¹å™¨çš„æ•´ä½“å¤§å°ä¸è™šæ‹Ÿæœºç›¸æ¯”ï¼Œæ˜¯æ›´å°çš„ã€‚ä¾‹å¦‚ï¼ŒUbuntuçš„å°ºå¯¸é€šå¸¸å°äº1GBã€‚è€Œå®ƒçš„Dockeræ˜ åƒå‰¯æœ¬ä»…ä¸º188mbã€‚ æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘åœ¨ä»‹ç»ä¸­ä½¿ç”¨äº†æ›´å¹¿æ³›çš„å®¹å™¨ï¼Œè€Œä¸æ˜¯â€œDockerå®¹å™¨â€ã€‚é€šå¸¸è®¤ä¸ºDockerå’Œå®¹å™¨æ˜¯ä¸€å›äº‹ã€‚ç„¶è€Œï¼Œå®¹å™¨æ˜¯Linuxä¸­æ›´å¤šçš„æ¦‚å¿µæˆ–åŠŸèƒ½é›†åˆã€‚Dockeråªæ˜¯ä¸€ç§å®¹å™¨çš„å‘³é“ï¼Œå› ä¸ºå®ƒçš„æ˜“ç”¨æ€§è€Œå˜å¾—æµè¡Œèµ·æ¥ã€‚ä¹Ÿæœ‰å…¶å®ƒçš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ç»§ç»­åšæŒDockerï¼Œå› ä¸ºå®ƒåœ¨æˆ‘çœ‹æ¥æ˜¯æœ€å—æ”¯æŒçš„ï¼Œä¹Ÿæ˜¯æ–°æ¥è€…æœ€ç®€å•çš„ã€‚ æ‰€ä»¥ç°åœ¨å¸Œæœ›ä½ èƒ½çœ‹åˆ°é›†è£…ç®±åŒ–çš„ä»·å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä¸ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡è¿›è¡Œdockeringã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªDockerfile $ touch consignment-service/Dockerfileã€‚ åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹: 1234567FROM alpine:latestRUN mkdir /appWORKDIR /appADD consignment-service /app/consignment-serviceCMD [\"./consignment-service\"] å¦‚æœä½ åœ¨ Linux ä¸Šè¿è¡Œï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä½¿ç”¨ Alpine çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨ Linux æœºå™¨ä¸Šå…³æ³¨è¿™ç¯‡æ–‡ç« ï¼Œåªéœ€ç”¨ debian æ›¿æ¢ alpine å³å¯ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ ç¨åæˆ‘ä»¬å°†ä¼šä»‹ç»ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥æ„å»ºæˆ‘ä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä¸‹è½½æœ€æ–°çš„ Linux Alpine é•œåƒã€‚Linux Alpine æ˜¯ä¸€ä¸ªè½»é‡çº§ Linux å‘è¡Œç‰ˆï¼Œä¸ºè¿è¡Œ Dockerised Web åº”ç”¨ç¨‹åºè€Œå¼€å‘å’Œä¼˜åŒ–ã€‚æ¢ä¸€ç§è¯´æ³•ï¼ŒLinux Alpine å…·æœ‰è¶³å¤Ÿçš„ä¾èµ–å’Œè¿è¡Œæ—¶åŠŸèƒ½æ¥è¿è¡Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºã€‚è¿™æ„å‘³ç€å®ƒçš„é•œåƒå¤§å°åªæœ‰ 8M å·¦å³ã€‚ä¸ä¹‹ç›¸æ¯”ï¼Œå¤§çº¦ 1GB çš„ Ubuntu è™šæ‹Ÿæœºï¼Œä½ å¯ä»¥å¼€å§‹çœ‹åˆ°ä¸ºä»€ä¹ˆ Docker é•œåƒæ›´é€‚åˆå¾®æœåŠ¡å’Œäº‘è®¡ç®—ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•æ¥å­˜æ”¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å°†ä¸Šä¸‹æ–‡ç›®å½•è®¾ç½®åˆ°æˆ‘ä»¬çš„æ–°ç›®å½•ä¸­ã€‚è¿™æ—¶æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç›®å½•æ˜¯é»˜è®¤çš„ç›®å½•ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ Docker å®¹å™¨ä¸­ï¼Œå¹¶è¿è¡Œå®ƒã€‚ ç°åœ¨æˆ‘ä»¬æ¥æ›´æ–° Makefile æ–‡ä»¶æ¥æ„å»ºæˆ‘ä»¬çš„ Docker é•œåƒã€‚ 1234build: ... GOOS=linux GOARCH=amd64 go build docker build -t consignment-service . æˆ‘ä»¬åœ¨è¿™é‡Œå¢åŠ äº†ä¸¤ä¸ªæ­¥éª¤ï¼Œæˆ‘æƒ³è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºæˆ‘ä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½ ä¼šæ³¨æ„åˆ°åœ¨è¿è¡Œå‘½ä»¤ $ go build ä¹‹å‰ï¼Œè®¾ç½®äº†ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚GOOS å’Œ GOARCH å…è®¸æ‚¨ä¸ºå¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿäº¤å‰ç¼–è¯‘æ‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”±äºæˆ‘åœ¨ Macbookä¸Šå¼€å‘ï¼Œæ‰€ä»¥æ— æ³•ç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®©å®ƒåœ¨ Docker å®¹å™¨ä¸­è¿è¡Œå®ƒï¼Œè€Œè¯¥å®¹å™¨ä½¿ç”¨çš„æ˜¯ Linuxã€‚è¿™ä¸ªäºŒè¿›åˆ¶åœ¨ä½ çš„ Docker å®¹å™¨ä¸­å°†æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ï¼Œå®ƒä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ç¬¬äºŒæ­¥æ˜¯æ·»åŠ  Docker æ„å»ºè¿‡ç¨‹ã€‚è¿™å°†è¯»å–ä½ çš„ Dockerfile æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªåç§° consignment-service æ„å»ºé•œåƒã€‚å¥å·è¡¨ç¤ºä¸€ä¸ªç›®å½•è·¯å¾„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯å¸Œæœ›æ„å»ºè¿‡ç¨‹åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ã€‚ æˆ‘å°†åœ¨æˆ‘ä»¬çš„ Makefile ä¸­æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®ï¼š 12run: docker run -p 50051:50051 consignment-service åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿è¡Œ consignment-service Docker é•œåƒï¼Œå¹¶æš´éœ² 50051 ç«¯å£ã€‚ç”±äº Docker åœ¨å•ç‹¬çš„ç½‘ç»œå±‚ä¸Šè¿è¡Œï¼Œå› æ­¤æ‚¨éœ€è¦å°† Docker å®¹å™¨ä¸­ä½¿ç”¨çš„ç«¯å£è½¬å‘ç»™ä¸»æœºã€‚æ‚¨å¯ä»¥é€šè¿‡æ›´æ”¹ç¬¬ä¸€ä¸ªæ®µå°†å†…éƒ¨ç«¯å£è½¬å‘åˆ°ä¸»æœºä¸Šçš„æ–°ç«¯å£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨ç«¯å£ 8080 ä¸Šè¿è¡Œæ­¤æœåŠ¡ï¼Œåˆ™éœ€è¦å°† -p å‚æ•°æ›´æ”¹ä¸º 8080:50051ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡åŒ…å« -d æ ‡å¿—åœ¨åå°è¿è¡Œå®¹å™¨ã€‚ä¾‹å¦‚ï¼Œdocker run -d -p 50051:50051 consignment-serviceã€‚ æ‚¨å¯ä»¥é˜…è¯»æ›´å¤šå…³äº Docker ç½‘ç»œå¦‚ä½•å·¥ä½œçš„ä¿¡æ¯ å½“æ‚¨è¿è¡Œ $ docker build æ—¶ï¼Œæ‚¨æ­£åœ¨å°†ä»£ç å’Œè¿è¡Œæ—¶ç¯å¢ƒæ„å»ºåˆ°é•œåƒä¸­ã€‚Docker é•œåƒæ˜¯æ‚¨çš„ç¯å¢ƒåŠå…¶ä¾èµ–å…³ç³»çš„å¯ç§»æ¤å¿«ç…§ã€‚ä½ å¯ä»¥å°†å®ƒåˆ†äº«åˆ° Docker Hub æ¥å…±äº«ä½ çš„ Docker é•œåƒã€‚Docker é•œåƒå°±åƒä¸€ä¸ª npm æˆ– yum repoã€‚å½“ä½ åœ¨ä½ çš„ Dockerfile é‡Œé¢å®šä¹‰äº† FROMï¼Œä½ å°±å‘Šè¯‰äº† docker ä» docker hub ä¸‹è½½å“ªä¸ªé•œåƒæ¥ä½œä¸ºè¿è¡Œç¯å¢ƒã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æ‰©å±•å¹¶è¦†ç›–è¯¥åŸºæœ¬æ–‡ä»¶çš„æŸäº›éƒ¨åˆ†ï¼Œæ–¹æ³•æ˜¯è‡ªè¡Œé‡æ–°å®šä¹‰å®ƒä»¬ã€‚æˆ‘ä»¬ä¸ä¼šå…¬å¼€æˆ‘ä»¬çš„ Docker é•œåƒï¼Œä½†æ˜¯å¯ä»¥éšæ—¶ä»”ç»†é˜…è¯» Docker hubï¼Œå¹¶ä¸”æ³¨æ„åˆ°æœ‰å¤šå°‘åŠŸèƒ½è¢«å®¹å™¨åŒ–ã€‚ä¸€äº›éå¸¸æ˜¾è‘—çš„äº‹æƒ…å·²ç»è¢« Docker åŒ–äº†ã€‚ Dockerfile ä¸­çš„æ¯ä¸ªå£°æ˜åœ¨ç¬¬ä¸€æ¬¡æ„å»ºæ—¶éƒ½è¢«ç¼“å­˜ã€‚è¿™æ ·å¯ä»¥èŠ‚çœæ¯æ¬¡æ›´æ”¹æ—¶é‡æ–°æ„å»ºæ•´ä¸ªè¿è¡Œæ—¶çš„æ—¶é—´ã€‚ Docker éå¸¸èªæ˜ï¼Œå¯ä»¥ç¡®å®šå“ªäº›éƒ¨åˆ†å‘ç”Ÿäº†å˜åŒ–ï¼Œå“ªäº›éƒ¨åˆ†éœ€è¦é‡æ–°æ„å»ºã€‚è¿™ä½¿å¾—æ„å»ºè¿‡ç¨‹éå¸¸å¿«é€Ÿã€‚ æˆ‘ä»¬å·²ç»ä»‹ç»äº†å¾ˆå¤šå®¹å™¨çš„éƒ¨åˆ†äº†ã€‚è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ä»£ç ã€‚ åœ¨åˆ›å»º gRPC æœåŠ¡æ—¶ï¼Œåˆ›å»ºè¿æ¥çš„ä»£ç æœ‰å¾ˆå¤šï¼Œå¹¶ä¸”å¿…é¡»å°†æœåŠ¡åœ°å€çš„ä½ç½®ç¡¬ç¼–ç åˆ°å®¢æˆ·ç«¯æˆ–å…¶ä»–æœåŠ¡ä¸­ï¼Œä»¥ä¾¿è¿æ¥åˆ°å®ƒã€‚è¿™å¾ˆæ£˜æ‰‹ï¼Œå› ä¸ºå½“æ‚¨åœ¨äº‘ä¸­è¿è¡ŒæœåŠ¡æ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¸å…±äº«ç›¸åŒçš„ä¸»æœºï¼Œæˆ–è€…é‡æ–°éƒ¨ç½²æœåŠ¡ååœ°å€æˆ– IP å¯èƒ½ä¼šæ›´æ”¹ã€‚ è¿™æ˜¯æœåŠ¡å‘ç°çš„èµ·ç‚¹ã€‚æœåŠ¡å‘ç°ä¿æŒæ‰€æœ‰æœåŠ¡åŠå…¶ä½ç½®çš„æœ€æ–°ç›®å½•ã€‚æ¯ä¸ªæœåŠ¡åœ¨è¿è¡Œæ—¶æ³¨å†Œè‡ªå·±ï¼Œå¹¶åœ¨å…³é—­æ—¶è‡ªè¡Œæ³¨é”€ã€‚ æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªåå­—æˆ–ç¼–å·åˆ†é…ç»™å®ƒã€‚ å› æ­¤ï¼Œå³ä½¿å¯èƒ½æœ‰æ–°çš„ IP åœ°å€æˆ–ä¸»æœºåœ°å€ï¼Œåªè¦æœåŠ¡åç§°ä¿æŒä¸å˜ï¼Œæ‚¨å°±ä¸éœ€è¦ä»å…¶ä»–æœåŠ¡æ›´æ–°å¯¹æ­¤æœåŠ¡çš„è°ƒç”¨ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½†æ˜¯åƒç¼–ç¨‹ä¸­çš„å¤§å¤šæ•°æƒ…å†µä¸€æ ·ï¼Œå¦‚æœå·²ç»æœ‰äººè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆé‡æ–°å‘æ˜è½®å­å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚ Go-micro çš„åˆ›å§‹äººæ˜¯ @chuhnkï¼ˆAsim Aslamï¼‰ï¼Œä»–ä»¥ä¸€ç§éå¸¸æ¸…æ™°å’Œæ˜“ç”¨çš„æ–¹å¼è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ Go-microGo-micro æ˜¯ä¸€ä¸ªç”¨ Go ç¼–å†™çš„å¼ºå¤§çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå¤§éƒ¨åˆ†ç”¨äº Goã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Sidecar ä»¥ä¾¿ä¸å…¶ä»–è¯­è¨€è¿›è¡Œäº¤äº’ã€‚ Go-micro æœ‰ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥åˆ¶ä½œå¾®å‹æœåŠ¡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ä»å¯èƒ½è§£å†³çš„æœ€å¸¸è§é—®é¢˜å¼€å§‹ï¼Œé‚£å°±æ˜¯æœåŠ¡å‘ç°ã€‚ æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œä¸€äº›æ›´æ–°ï¼Œè®©å®ƒä¸ go-micro ä¸€èµ·å·¥ä½œã€‚Go-micro ä½œä¸º protoc æ’ä»¶é›†æˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›¿æ¢æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ ‡å‡† gRPC æ’ä»¶ã€‚æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹åœ¨æˆ‘ä»¬çš„ Makefile ä¸­æ›¿æ¢å®ƒã€‚ ç¡®ä¿å®‰è£… go-micro ä¾èµ–: 1go get -u github.com/micro/protobuf/&#123;proto,protoc-gen-go&#125; 123456build: protoc -I. --go_out=plugins=micro:$(GOPATH)/src/github.com/EwanValentine/shippy/consignment-service \\ proto/consignment/consignment.proto ...... æˆ‘ä»¬å·²ç»æ›´æ–°äº†æˆ‘ä»¬çš„ Makefile æ¥ä½¿ç”¨ go-micro æ’ä»¶ï¼Œè€Œä¸æ˜¯ gRPC æ’ä»¶ã€‚ç°åœ¨éœ€è¦æ›´æ–°æˆ‘ä»¬çš„ consignment-service/main.go æ–‡ä»¶æ¥ä½¿ç”¨ go-microã€‚è¿™å°†æŠ½è±¡æˆ‘ä»¬ä»¥å‰çš„ gRPC ä»£ç ï¼Œå®ƒå°†å¤„ç†æ³¨å†Œå’Œè½»æ¾å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889// consignment-service/main.gopackage mainimport ( // Import the generated protobuf code \"fmt\" pb \"github.com/EwanValentine/shippy/consignment-service/proto/consignment\" micro \"github.com/micro/go-micro\" \"golang.org/x/net/context\")type IRepository interface &#123; Create(*pb.Consignment) (*pb.Consignment, error) GetAll() []*pb.Consignment&#125;// Repository - Dummy repository, this simulates the use of a datastore// of some kind. We'll replace this with a real implementation later on.type Repository struct &#123; consignments []*pb.Consignment&#125;func (repo *Repository) Create(consignment *pb.Consignment) (*pb.Consignment, error) &#123; updated := append(repo.consignments, consignment) repo.consignments = updated return consignment, nil&#125;func (repo *Repository) GetAll() []*pb.Consignment &#123; return repo.consignments&#125;// Service should implement all of the methods to satisfy the service// we defined in our protobuf definition. You can check the interface// in the generated code itself for the exact method signatures etc// to give you a better idea.type service struct &#123; repo IRepository&#125;// CreateConsignment - we created just one method on our service,// which is a create method, which takes a context and a request as an// argument, these are handled by the gRPC server.func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment, res *pb.Response) error &#123; // Save our consignment consignment, err := s.repo.Create(req) if err != nil &#123; return err &#125; // Return matching the `Response` message we created in our // protobuf definition. res.Created = true res.Consignment = consignment return nil&#125;func (s *service) GetConsignments(ctx context.Context, req *pb.GetRequest, res *pb.Response) error &#123; consignments := s.repo.GetAll() res.Consignments = consignments return nil&#125;func main() &#123; repo := &amp;Repository&#123;&#125; // Create a new service. Optionally include some options here. srv := micro.NewService( // This name must match the package name given in your protobuf definition micro.Name(\"go.micro.srv.consignment\"), micro.Version(\"latest\"), ) // Init will parse the command line flags. srv.Init() // Register handler pb.RegisterShippingServiceHandler(srv.Server(), &amp;service&#123;repo&#125;) // Run the server if err := srv.Run(); err != nil &#123; fmt.Println(err) &#125;&#125; è¿™é‡Œçš„ä¸»è¦å˜åŒ–æ˜¯æˆ‘ä»¬å®ä¾‹åŒ–æˆ‘ä»¬çš„ gRPC æœåŠ¡å™¨çš„æ–¹å¼ï¼Œå®ƒå¤„ç†æ³¨å†Œæˆ‘ä»¬çš„æœåŠ¡ï¼Œå·²ç»è¢«æ•´é½åœ°æŠ½è±¡åˆ°ä¸€ä¸ª mico.NewService() æ–¹æ³•ä¸­ã€‚æœ€åï¼Œå¤„ç†è¿æ¥æœ¬èº«çš„ service.Run() å‡½æ•°ã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æ³¨å†Œäº†æˆ‘ä»¬çš„å®ç°ï¼Œä½†è¿™æ¬¡ä½¿ç”¨äº†ä¸€ä¸ªç¨å¾®ä¸åŒçš„æ–¹æ³•ã€‚ç¬¬äºŒä¸ªæœ€å¤§çš„å˜åŒ–æ˜¯æœåŠ¡æ–¹æ³•æœ¬èº«ï¼Œå‚æ•°å’Œå“åº”ç±»å‹ç•¥æœ‰å˜åŒ–ï¼ŒæŠŠè¯·æ±‚å’Œå“åº”ç»“æ„ä½œä¸ºå‚æ•°ï¼Œç°åœ¨åªè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚åœ¨æˆ‘ä»¬çš„æ–¹æ³•ä¸­ï¼Œè®¾ç½®äº†ç”± go-micro å¤„ç†å“åº”ã€‚ æœ€åï¼Œæˆ‘ä»¬ä¸å†å¯¹ç«¯å£è¿›è¡Œç¡¬ç¼–ç ã€‚go-micro åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œé…ç½®ã€‚è®¾ç½®åœ°å€, ä½¿ç”¨ MICRO_SERVER_ADDRESS=:50051ã€‚æˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰æˆ‘ä»¬çš„æœåŠ¡ä½¿ç”¨ mdnsï¼ˆå¤šæ’­DNSï¼‰ä½œä¸ºæˆ‘ä»¬æœ¬åœ°ä½¿ç”¨çš„æœåŠ¡ä»£ç†ã€‚ æ‚¨é€šå¸¸ä¸ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ mdns è¿›è¡ŒæœåŠ¡å‘ç°ï¼Œä½†æˆ‘ä»¬å¸Œæœ›é¿å…åœ¨æœ¬åœ°è¿è¡Œè¯¸å¦‚ Consul æˆ– etcd è¿™æ ·çš„æµ‹è¯•ã€‚æ›´å¤šæˆ‘ä»¬å°†åœ¨åé¢ä»‹ç»ã€‚ è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„ Makefile æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ 1234run: docker run -p 50051:50051 \\ -e MICRO_SERVER_ADDRESS=:50051 \\ -e MICRO_REGISTRY=mdns consignment-service -e æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡æ ‡å¿—ï¼Œå®ƒå…è®¸ä½ å°†ç¯å¢ƒå˜é‡ä¼ é€’åˆ°ä½ çš„ Docker å®¹å™¨ä¸­ã€‚ æ¯ä¸ªå˜é‡å¿…é¡»æœ‰ä¸€ä¸ªæ ‡å¿—ï¼Œä¾‹å¦‚ -e ENV=staging -e DB_HOST=localhost ç­‰ã€‚ ç°åœ¨å¦‚æœä½ è¿è¡Œ make runï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ª Dockerised æœåŠ¡ï¼Œå¹¶å…·æœ‰æœåŠ¡å‘ç°åŠŸèƒ½ã€‚æ‰€ä»¥è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„ cli å·¥å…·æ¥åˆ©ç”¨å®ƒã€‚ 1234567891011121314import ( ... \"github.com/micro/go-micro/cmd\" microclient \"github.com/micro/go-micro/client\")func main() &#123; cmd.Init() // Create new greeter client client := pb.NewShippingServiceClient(\"go.micro.srv.consignment\", microclient.DefaultClient) ...&#125; å®Œæ•´æ–‡ä»¶çœ‹è¿™é‡Œ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¼å…¥äº†ç”¨äºåˆ›å»ºå®¢æˆ·ç«¯çš„ go-micro åº“ï¼Œå¹¶ç”¨ go-micro å®¢æˆ·ç«¯ä»£ç å–ä»£äº†ç°æœ‰çš„è¿æ¥ä»£ç ï¼Œè¯¥å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨æœåŠ¡è§£æè€Œä¸æ˜¯ç›´æ¥è¿æ¥åˆ°åœ°å€ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ è¿è¡Œå®ƒï¼Œè¿™æ˜¯è¡Œä¸é€šçš„ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨æ­£åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡ï¼Œå®ƒæœ‰è‡ªå·±çš„ mdnsï¼Œç‹¬ç«‹äºæˆ‘ä»¬ä½¿ç”¨ä¸­çš„ä¸»æœº mdns ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç¡®ä¿æœåŠ¡å’Œå®¢æˆ·ç«¯éƒ½åœ¨ â€œdockerlandâ€ ä¸­è¿è¡Œï¼Œä»¥ä¾¿å®ƒä»¬éƒ½åœ¨ç›¸åŒçš„ä¸»æœºä¸Šè¿è¡Œï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå±‚ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Makefile consignment-cli/Makefileï¼Œå¹¶åˆ›å»ºä¸€äº›æ¡ç›®ã€‚ 123456build: GOOS=linux GOARCH=amd64 go build docker build -t consignment-cli .run: docker run -e MICRO_REGISTRY=mdns consignment-cli ä¸ä¹‹å‰ç±»ä¼¼ï¼Œæˆ‘ä»¬è¦ä¸º Linux æ„å»ºæˆ‘ä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å½“æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„ docker é•œåƒæ—¶ï¼Œæˆ‘ä»¬æƒ³ä¼ é€’ä¸€ä¸ªç¯å¢ƒå˜é‡æ¥æŒ‡ç¤º go-micro ä½¿ç”¨ mdnsã€‚ ç°åœ¨è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ CLI å·¥å…·åˆ›å»ºä¸€ä¸ª Dockerfile ï¼š 123456789FROM alpine:latestRUN mkdir -p /app WORKDIR /appADD consignment.json /app/consignment.json ADD consignment-cli /app/consignment-cliCMD [\"./consignment-cli\"] å®ƒé™¤äº†å¼•å…¥äº†æˆ‘ä»¬çš„ json æ•°æ®æ–‡ä»¶ï¼Œå…¶ä½™ä¸ä¹‹å‰æœåŠ¡çš„ Dockerfile éå¸¸ç›¸ä¼¼ã€‚å¦‚æœä½ åœ¨ä½ çš„ consignment-cli ç›®å½•ï¼Œè¿è¡Œ $ make run å‘½ä»¤ï¼Œä½ åº”è¯¥å’Œä»¥å‰ä¸€æ ·ï¼Œçœ‹è§ Created: trueã€‚ ä¹‹å‰ï¼Œæˆ‘æåˆ°é‚£äº›ä½¿ç”¨ Linux çš„äººåº”è¯¥åˆ‡æ¢åˆ°ä½¿ç”¨ Debian ä½œä¸ºåŸºç¡€æ˜ åƒã€‚ç°åœ¨çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ—¶æœºæ¥çœ‹çœ‹ Docker çš„ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå¤šé˜¶æ®µæ„å»ºã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª Dockerfile ä¸­ä½¿ç”¨å¤šä¸ª Docker é•œåƒã€‚ è¿™åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé•œåƒæ¥æ„å»ºæˆ‘ä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…·æœ‰æ‰€æœ‰æ­£ç¡®çš„ä¾èµ–å…³ç³»ç­‰ï¼Œç„¶åä½¿ç”¨ç¬¬äºŒä¸ªé•œåƒæ¥è¿è¡Œå®ƒã€‚è®©æˆ‘ä»¬è¯•è¯•çœ‹ï¼Œæˆ‘ä¼šåœ¨ä»£ç ä¸­ç•™ä¸‹è¯¦ç»†çš„æ³¨é‡Šï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# consignment-service/Dockerfile# We use the official golang image, which contains all the # correct build tools and libraries. Notice `as builder`,# this gives this container a name that we can reference later on. FROM golang:1.9.0 as builder# Set our workdir to our current service in the gopathWORKDIR /go/src/github.com/EwanValentine/shippy/consignment-service# Copy the current code into our workdirCOPY . .# Here we're pulling in godep, which is a dependency manager tool,# we're going to use dep instead of go get, to get around a few# quirks in how go get works with sub-packages.RUN go get -u github.com/golang/dep/cmd/dep# Create a dep project, and run `ensure`, which will pull in all # of the dependencies within this directory.RUN dep init &amp;&amp; dep ensure# Build the binary, with a few flags which will allow# us to run this binary in Alpine. RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo .# Here we're using a second FROM statement, which is strange,# but this tells Docker to start a new build process with this# image.FROM alpine:latest# Security related package, good to have.RUN apk --no-cache add ca-certificates# Same as before, create a directory for our app.RUN mkdir /app WORKDIR /app# Here, instead of copying the binary from our host machine,# we pull the binary from the container named `builder`, within# this build context. This reaches into our previous image, finds# the binary we built, and pulls it into this container. Amazing!COPY --from=builder /go/src/github.com/EwanValentine/shippy/consignment-service/consignment-service .# Run the binary as per usual! This time with a binary build in a# separate container, with all of the correct dependencies and# run time libraries.CMD [\"./consignment-service\"] è¿™ç§æ–¹æ³•çš„å”¯ä¸€é—®é¢˜ï¼Œæˆ‘æƒ³å›æ¥å¹¶åœ¨æŸäº›æ—¶å€™æ”¹å–„è¿™ä¸€ç‚¹ï¼Œæ˜¯ Docker ä¸èƒ½ä»çˆ¶ç›®å½•ä¸­è¯»å–æ–‡ä»¶ã€‚å®ƒåªèƒ½è¯»å– Dockerfile æ‰€åœ¨ç›®å½•æˆ–å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ è¿™æ„å‘³ç€ä¸ºäº†è¿è¡Œ $ dep ensure æˆ– $ go getï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„ä»£ç è¢«æ¨åˆ° Git ä¸Šï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æå– vessel-serviceã€‚å°±åƒå…¶ä»– Go åŒ…ä¸€æ ·ã€‚è¿™ç§æ–¹æ³•ä¸ç†æƒ³ï¼Œä½†è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬ç°åœ¨çš„éœ€æ±‚ã€‚ ç°åœ¨æˆ‘å°†ä¼šåœ¨å…¶ä»– Docker æ–‡ä»¶ä¸­åº”ç”¨è¿™ç§æ–°æ–¹æ³•ã€‚ å™¢ï¼Œè®°ä½è¦è®°å¾—ä» Makefiles ä¸­åˆ é™¤ $ go buildã€‚ æ›´å¤šçš„å¤šé˜¶æ®µç¼–è¯‘åœ¨è¿™é‡Œ èˆ¹åªæœåŠ¡è®©æˆ‘ä»¬åˆ›å»ºç¬¬äºŒä¸ªæœåŠ¡ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªä»£é”€æœåŠ¡ï¼Œè¿™å°†å¤„ç†å°†ä¸€æ‰¹è´§ç‰©ä¸ä¸€æ‰¹æœ€é€‚åˆè¯¥æ‰¹è´§ç‰©çš„ vessel è¿›è¡ŒåŒ¹é…ã€‚ä¸ºäº†é…åˆæˆ‘ä»¬çš„è´§ç‰©ï¼Œæˆ‘ä»¬éœ€è¦å°†é›†è£…ç®±çš„é‡é‡å’Œæ•°é‡å‘é€åˆ°æˆ‘ä»¬çš„æ–° vessel æœåŠ¡ï¼Œç„¶åå°†æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†è¯¥è´§ç‰©çš„èˆ¹åªã€‚ åœ¨æ‚¨çš„æ ¹ç›®å½•$ mkdir vessel-serviceä¸­åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œç°åœ¨ä¸ºæˆ‘ä»¬çš„æ–°æœåŠ¡protobufå®šä¹‰åˆ›å»ºäº†ä¸€ä¸ªå­ç›®å½•ï¼Œ$ mkdir -p vessel-service/proto/vesselã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„protobufæ–‡ä»¶ï¼Œ$ touch vessel-service/proto/vessel/vessel.protoã€‚ ç”±äº protobuf çš„å®šä¹‰ç¡®å®æ˜¯æˆ‘ä»¬é¢†åŸŸè®¾è®¡çš„æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä»è¿™é‡Œå¼€å§‹ 123456789101112131415161718192021222324252627// vessel-service/proto/vessel/vessel.protosyntax = \"proto3\";package go.micro.srv.vessel;service VesselService &#123; rpc FindAvailable(Specification) returns (Response) &#123;&#125;&#125;message Vessel &#123; string id = 1; int32 capacity = 2; int32 max_weight = 3; string name = 4; bool available = 5; string owner_id = 6;&#125;message Specification &#123; int32 capacity = 1; int32 max_weight = 2;&#125;message Response &#123; Vessel vessel = 1; repeated Vessel vessels = 2;&#125; æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™å’Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡éå¸¸ç›¸ä¼¼ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ª rpc æ–¹æ³• FindAvailable åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡ã€‚ã€‚è¿™éœ€è¦ä¸€ä¸ª Specification ç±»å‹å¹¶è¿”å›ä¸€ä¸ª Response ç±»å‹ã€‚Response ç±»å‹ä½¿ç”¨é‡å¤å­—æ®µè¿”å› Vessel ç±»å‹æˆ–å¤šä¸ª Vesseã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Makefile æ¥å¤„ç†æˆ‘ä»¬çš„æ„å»ºé€»è¾‘å’Œè¿è¡Œè„šæœ¬ã€‚ $ touch vessel-service/Makefileã€‚æ‰“å¼€è¯¥æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 12345678// vessel-service/Makefilebuild: protoc -I. --go_out=plugins=micro:$(GOPATH)/src/github.com/EwanValentine/shippy/vessel-service \\ proto/vessel/vessel.proto docker build -t vessel-service .run: docker run -p 50052:50051 -e MICRO_SERVER_ADDRESS=:50051 -e MICRO_REGISTRY=mdns vessel-service è¿™ä¸æˆ‘ä»¬ä¸ºæ‰˜ç®¡æœåŠ¡åˆ›å»ºçš„ç¬¬ä¸€ä¸ª Makefile å‡ ä¹ç›¸åŒï¼Œä½†æ³¨æ„æœåŠ¡åç§°å’Œç«¯å£å·²ç»æ”¹å˜äº†ä¸€ç‚¹ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨åŒä¸€ä¸ªç«¯å£ä¸Šè¿è¡Œä¸¤ä¸ª Docker å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œåˆ©ç”¨ Docker ç«¯å£è½¬å‘æ¥ç¡®ä¿æœåŠ¡ä¸Šçš„ 50051 ç«¯å£æ˜ å°„åˆ°ä¸»æœºç½‘ç»œä¸Šçš„ 50052 ç«¯å£ã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ª Dockerfileï¼Œä½¿ç”¨æˆ‘ä»¬æ–°çš„å¤šé˜¶æ®µæ ¼å¼ï¼š 123456789101112131415161718192021# vessel-service/DockerfileFROM golang:1.9.0 as builderWORKDIR /go/src/github.com/EwanValentine/shippy/vessel-serviceCOPY . .RUN go get -u github.com/golang/dep/cmd/depRUN dep init &amp;&amp; dep ensureRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo .FROM alpine:latestRUN apk --no-cache add ca-certificatesRUN mkdir /appWORKDIR /appCOPY --from=builder /go/src/github.com/EwanValentine/shippy/vessel-service/vessel-service .CMD [\"./vessel-service\"] æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æˆ‘ä»¬çš„å®ç°: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970// vessel-service/main.gopackage mainimport ( \"context\" \"errors\" \"fmt\" pb \"github.com/EwanValentine/shippy/vessel-service/proto/vessel\" \"github.com/micro/go-micro\")type Repository interface &#123; FindAvailable(*pb.Specification) (*pb.Vessel, error)&#125;type VesselRepository struct &#123; vessels []*pb.Vessel&#125;// FindAvailable - checks a specification against a map of vessels,// if capacity and max weight are below a vessels capacity and max weight,// then return that vessel.func (repo *VesselRepository) FindAvailable(spec *pb.Specification) (*pb.Vessel, error) &#123; for _, vessel := range repo.vessels &#123; if spec.Capacity &lt;= vessel.Capacity &amp;&amp; spec.MaxWeight &lt;= vessel.MaxWeight &#123; return vessel, nil &#125; &#125; return nil, errors.New(\"No vessel found by that spec\")&#125;// Our grpc service handlertype service struct &#123; repo Repository&#125;func (s *service) FindAvailable(ctx context.Context, req *pb.Specification, res *pb.Response) error &#123; // Find the next available vessel vessel, err := s.repo.FindAvailable(req) if err != nil &#123; return err &#125; // Set the vessel as part of the response message type res.Vessel = vessel return nil&#125;func main() &#123; vessels := []*pb.Vessel&#123; &amp;pb.Vessel&#123;Id: \"vessel001\", Name: \"Boaty McBoatface\", MaxWeight: 200000, Capacity: 500&#125;, &#125; repo := &amp;VesselRepository&#123;vessels&#125; srv := micro.NewService( micro.Name(\"go.micro.srv.vessel\"), micro.Version(\"latest\"), ) srv.Init() // Register our implementation with pb.RegisterVesselServiceHandler(srv.Server(), &amp;service&#123;repo&#125;) if err := srv.Run(); err != nil &#123; fmt.Println(err) &#125;&#125; æˆ‘ç•™ä¸‹äº†ä¸€äº›æ³¨é‡Šï¼Œä½†æ˜¯éå¸¸ç®€å•ã€‚å¦å¤–ï¼Œæˆ‘æƒ³æä¸‹ï¼Œä¸€ä¸ª Reddit ç”¨æˆ· /r/jerky_lodash46 æŒ‡å‡ºï¼Œæˆ‘æ›¾ç»ä½¿ç”¨ IRepository ä½œä¸ºæˆ‘çš„æ¥å£åç§°ã€‚æˆ‘æƒ³åœ¨è¿™é‡Œçº æ­£ä¸€ä¸‹ï¼Œåœ¨æˆ‘çš„æ¥å£åå‰é¢åŠ ä¸Š Java å’Œ Cï¼ƒ ç­‰è¯­è¨€çš„çº¦å®šï¼Œä½† Go å¹¶æ²¡æœ‰çœŸæ­£é¼“åŠ±è¿™ä¸€ç‚¹ï¼Œå› ä¸º Go æŠŠæ¥å£å½“ä½œä¸€ç­‰å…¬æ°‘ã€‚æ‰€ä»¥æˆ‘æŠŠ IRepository æ›´åä¸º Repository ï¼Œå¹¶ä¸”æŠŠæˆ‘çš„å…·ä½“ç»“æ„é‡å‘½åä¸º ConsignmentRepositoryã€‚ è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘ä¼šç•™ä¸‹ä»»ä½•é”™è¯¯ï¼Œå¹¶åœ¨ä»¥åçš„æ–‡ç« ä¸­äºˆä»¥çº æ­£ï¼Œä»¥ä¾¿æˆ‘èƒ½å¤Ÿè§£é‡Šè¿™äº›æ”¹è¿›ã€‚æˆ‘ä»¬å¯ä»¥æ›´å¤šåœ°å­¦ä¹ ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰è¶£çš„éƒ¨åˆ†ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ‰˜è¿è´§ç‰©æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜æˆ‘ä»¬çš„æ‰˜è¿æœåŠ¡æ¥å‘¼å«æˆ‘ä»¬çš„æ–° vessel æœåŠ¡ï¼Œæ‰¾åˆ°ä¸€è‰˜èˆ¹ï¼Œå¹¶æ›´æ–°åˆ›å»ºçš„æ‰˜è¿ä¸­çš„ vessel_idï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109// consignment-service/main.gopackage mainimport ( // Import the generated protobuf code \"fmt\" \"log\" pb \"github.com/EwanValentine/shippy/consignment-service/proto/consignment\" vesselProto \"github.com/EwanValentine/shippy/vessel-service/proto/vessel\" micro \"github.com/micro/go-micro\" \"golang.org/x/net/context\")type Repository interface &#123; Create(*pb.Consignment) (*pb.Consignment, error) GetAll() []*pb.Consignment&#125;// Repository - Dummy repository, this simulates the use of a datastore// of some kind. We'll replace this with a real implementation later on.type ConsignmentRepository struct &#123; consignments []*pb.Consignment&#125;func (repo *ConsignmentRepository) Create(consignment *pb.Consignment) (*pb.Consignment, error) &#123; updated := append(repo.consignments, consignment) repo.consignments = updated return consignment, nil&#125;func (repo *ConsignmentRepository) GetAll() []*pb.Consignment &#123; return repo.consignments&#125;// Service should implement all of the methods to satisfy the service// we defined in our protobuf definition. You can check the interface// in the generated code itself for the exact method signatures etc// to give you a better idea.type service struct &#123; repo Repository vesselClient vesselProto.NewVesselService&#125;// CreateConsignment - we created just one method on our service,// which is a create method, which takes a context and a request as an// argument, these are handled by the gRPC server.func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment, res *pb.Response) error &#123; // Here we call a client instance of our vessel service with our consignment weight, // and the amount of containers as the capacity value vesselResponse, err := s.vesselClient.FindAvailable(context.Background(), &amp;vesselProto.Specification&#123; MaxWeight: req.Weight, Capacity: int32(len(req.Containers)), &#125;) log.Printf(\"Found vessel: %s \\n\", vesselResponse.Vessel.Name) if err != nil &#123; return err &#125; // We set the VesselId as the vessel we got back from our // vessel service req.VesselId = vesselResponse.Vessel.Id // Save our consignment consignment, err := s.repo.Create(req) if err != nil &#123; return err &#125; // Return matching the `Response` message we created in our // protobuf definition. res.Created = true res.Consignment = consignment return nil&#125;func (s *service) GetConsignments(ctx context.Context, req *pb.GetRequest, res *pb.Response) error &#123; consignments := s.repo.GetAll() res.Consignments = consignments return nil&#125;func main() &#123; repo := &amp;ConsignmentRepository&#123;&#125; // Create a new service. Optionally include some options here. srv := micro.NewService( // This name must match the package name given in your protobuf definition micro.Name(\"consignment\"), micro.Version(\"latest\"), ) vesselClient := vesselProto.NewVesselService(\"go.micro.srv.vessel\", srv.Client()) // Init will parse the command line flags. srv.Init() // Register handler pb.RegisterShippingServiceHandler(srv.Server(), &amp;service&#123;repo, vesselClient&#125;) // Run the server if err := srv.Run(); err != nil &#123; fmt.Println(err) &#125;&#125; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ vessel æœåŠ¡åˆ›å»ºäº†ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ï¼Œè¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨æœåŠ¡åç§°ï¼Œå³ go.micro.srv.vessel å°†èˆ¹èˆ¶æœåŠ¡ä½œä¸ºå®¢æˆ·ç«¯è°ƒç”¨ï¼Œå¹¶ä¸å…¶æ–¹æ³•äº¤äº’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³• (FindAvailable)ã€‚æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„å¯„å”®é‡é‡ï¼Œä»¥åŠæˆ‘ä»¬æƒ³è¦ä½œä¸ºè§„æ ¼çš„é›†è£…ç®±çš„æ•°é‡å‘é€åˆ° vessel æœåŠ¡ã€‚ç„¶åè¿”å›ä¸€ä¸ªé€‚å½“çš„ vesselã€‚ æ›´æ–° consignment-cli/consignment.json æ–‡ä»¶ï¼Œåˆ é™¤ç¡¬ç¼–ç çš„ vessel_id ï¼Œæˆ‘ä»¬è¦ç¡®è®¤æˆ‘ä»¬è‡ªå·±æ­£åœ¨å·¥ä½œã€‚è®©æˆ‘ä»¬å†æ·»åŠ ä¸€äº›å®¹å™¨ï¼Œå¢åŠ æƒé‡ã€‚ä¾‹å¦‚ 123456789&#123; \"description\": \"This is a test consignment\", \"weight\": 55000, \"containers\": [ &#123; \"customer_id\": \"cust001\", \"user_id\": \"user001\", \"origin\": \"Manchester, United Kingdom\" &#125;, &#123; \"customer_id\": \"cust002\", \"user_id\": \"user001\", \"origin\": \"Derby, United Kingdom\" &#125;, &#123; \"customer_id\": \"cust005\", \"user_id\": \"user001\", \"origin\": \"Sheffield, United Kingdom\" &#125; ]&#125; ç°åœ¨åœ¨ consignment-cli ä¸­è¿è¡Œ $ make build &amp;&amp; makeã€‚æ‚¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå“åº”â€‹â€‹ï¼Œå¹¶åˆ›å»ºè´§ç‰©æ¸…å•ã€‚åœ¨æ‚¨çš„è´§ç‰©ä¸­ï¼Œæ‚¨ç°åœ¨åº”è¯¥çœ‹åˆ° vessel_id å·²ç»è®¾ç½®å¥½äº†ã€‚æ‰€ä»¥ç°åœ¨æœ‰äº†æˆ‘ä»¬ä¸¤ä¸ªäº’è”çš„å¾®æœåŠ¡å’Œä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼åœ¨è¿™ä¸ªç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ä½¿ç”¨ MongoDB æ¥ä¿å­˜è¿™äº›æ•°æ®ã€‚æˆ‘ä»¬è¿˜å°†æ·»åŠ ç¬¬ä¸‰ä¸ªæœåŠ¡ï¼Œå¹¶ä½¿ç”¨ docker-compose æ¥ç®¡ç†æˆ‘ä»¬åœ¨æœ¬åœ°ä¸æ–­å¢é•¿çš„å®¹å™¨ç”Ÿæ€ç³»ç»Ÿã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹-ç¬¬ä¸€éƒ¨åˆ†","slug":"go-micro-tutorial-1","date":"2018-05-10T13:56:15.000Z","updated":"2020-07-25T02:57:18.203Z","comments":true,"path":"2018/05/10/go-micro-tutorial-1/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-1/","excerpt":"ä»‹ç»è¿™æ˜¯ä¸€ä¸ªåèŠ‚Golangçš„å¾®æœåŠ¡çš„ç³»åˆ—ã€‚åˆ©ç”¨protobufå’ŒgRPCä½œä¸ºåº•å±‚ä¼ è¾“åè®®ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºæˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰å¼„æ˜ç™½å¹¶è§£å†³äº†ä¸€ä¸ªæ¸…æ™°è€Œç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘æƒ³è¦åˆ†äº«æˆ‘åœ¨åˆ›å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å¾®æœåŠ¡çš„è¿‡ç¨‹ä¸­æ‰€äº†è§£åˆ°çš„ä¸œè¥¿ï¼Œè¿™äº›æœåŠ¡æ˜¯ä¸å…¶ä»–æ–°å‡ºç°çš„ç”¨æˆ·ç«¯åˆ°ä¸€èµ·çš„ã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›åŸºæœ¬æ¦‚å¿µã€æœ¯è¯­ï¼Œå¹¶ä»¥æœ€åŸå§‹çš„å½¢å¼åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå¾®æœåŠ¡ã€‚","text":"ä»‹ç»è¿™æ˜¯ä¸€ä¸ªåèŠ‚Golangçš„å¾®æœåŠ¡çš„ç³»åˆ—ã€‚åˆ©ç”¨protobufå’ŒgRPCä½œä¸ºåº•å±‚ä¼ è¾“åè®®ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºæˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰å¼„æ˜ç™½å¹¶è§£å†³äº†ä¸€ä¸ªæ¸…æ™°è€Œç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘æƒ³è¦åˆ†äº«æˆ‘åœ¨åˆ›å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å¾®æœåŠ¡çš„è¿‡ç¨‹ä¸­æ‰€äº†è§£åˆ°çš„ä¸œè¥¿ï¼Œè¿™äº›æœåŠ¡æ˜¯ä¸å…¶ä»–æ–°å‡ºç°çš„ç”¨æˆ·ç«¯åˆ°ä¸€èµ·çš„ã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›åŸºæœ¬æ¦‚å¿µã€æœ¯è¯­ï¼Œå¹¶ä»¥æœ€åŸå§‹çš„å½¢å¼åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå¾®æœåŠ¡ã€‚ æˆ‘ä»¬å°†åœ¨æ•´ä¸ªç³»åˆ—ä¸­åˆ›å»ºä»¥ä¸‹æœåŠ¡: è´§ç‰© åº“å­˜ ç”¨æˆ· èº«ä»½éªŒè¯ è§’è‰² èˆ¹åª æˆ‘ä»¬æœ€ç»ˆå°†ä¼šç”¨åˆ°:golang, mongodb, grpc, dockerï¼Œè°·æ­Œäº‘ï¼ŒKubernetes, NATS, CircleCI, Terraformå’Œgo-microã€‚ æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§æˆ‘æ‰€åŒ…å«çš„æ­¥éª¤è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯ä¸€å®šè¦ä½¿ç”¨git repo(æ¯ä¸€ç¯‡æ–‡ç« éƒ½æœ‰è‡ªå·±çš„åˆ†æ”¯)ä½œä¸ºå‚è€ƒï¼Œå°†GOPATHæ›´æ”¹ä¸ºæ‚¨è‡ªå·±çš„æ­¥éª¤ã€‚ åŒæ—¶æ³¨æ„ï¼Œæˆ‘æ­£åœ¨ä½¿ç”¨Macbookï¼Œæ‰€ä»¥æ‚¨å¯èƒ½éœ€è¦ä¿®æ”¹makefileä»¥ä½¿ç”¨$GOPATHè€Œä¸æ˜¯$(GOPATH)ï¼Œæ“ä½œç³»ç»Ÿä¹‹é—´å¯èƒ½è¿˜æœ‰å…¶ä»–ä¸€äº›ä¸ä¸€è‡´çš„åœ°æ–¹ã€‚ å…ˆå†³æ¡ä»¶ å¯¹GolangåŠå…¶ç”Ÿæ€ç³»ç»Ÿçš„ç†è§£ å®‰è£…gRPC / protobuf - çœ‹è¿™é‡Œ å®‰è£…Golang - çœ‹è¿™é‡Œ å®‰è£…ä»¥ä¸‹çš„goåº“: 12go get -u google.golang.org/grpcgo get -u github.com/golang/protobuf/protoc-gen-go æˆ‘ä»¬æ„å»ºä»€ä¹ˆæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ‚¨èƒ½æƒ³åˆ°çš„æœ€é€šç”¨çš„å¾®æœåŠ¡ç¤ºä¾‹ï¼Œä¸€ä¸ªé›†è£…ç®±ç®¡ç†å¹³å°!ä¸€ä¸ªåšå®¢å¯¹å¾®æœåŠ¡çš„ç”¨ä¾‹å¤ªè¿‡ç®€å•ï¼Œæˆ‘æƒ³è¦ä¸€äº›èƒ½çœŸæ­£å±•ç¤ºå¤æ‚æ€§åˆ†ç¦»çš„ä¸œè¥¿ã€‚æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŒ‘æˆ˜! è®©æˆ‘ä»¬ä»åŸºç¡€å¼€å§‹: ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åœ¨ä¼ ç»Ÿçš„åºå¤§åº”ç”¨ç¨‹åºä¸­ï¼Œæ‰€æœ‰çš„ç»„ç»‡ç‰¹æ€§éƒ½è¢«å†™å…¥åˆ°ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ã€‚æœ‰æ—¶ï¼Œå®ƒä»¬è¢«å®ƒä»¬çš„ç±»å‹åˆ†ç»„ï¼Œæ¯”å¦‚æ§åˆ¶å™¨ã€å®ä½“ã€å·¥å‚ç­‰ç­‰ã€‚å…¶ä»–æ—¶å€™ï¼Œå¯èƒ½åœ¨æ›´å¤§çš„åº”ç”¨ç¨‹åºä¸­ï¼Œç‰¹æ€§ä¼šè¢«å…³æ³¨ç‚¹æˆ–ç‰¹æ€§åˆ†éš”å¼€æ¥ã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½ä¼šæœ‰ä¸€ä¸ªauthåŒ…ã€ä¸€ä¸ªæœ‹å‹åŒ…å’Œä¸€ä¸ªæ–‡ç« åŒ…ã€‚å®ƒä»¬å¯èƒ½åŒ…å«è‡ªå·±çš„å·¥å‚ã€æœåŠ¡ã€å­˜å‚¨åº“ã€æ¨¡å‹ç­‰ï¼Œä½†æœ€ç»ˆå®ƒä»¬éƒ½è¢«ç»„åˆåœ¨ä¸€ä¸ªä»£ç åº“ä¸­ã€‚ å¾®æœåŠ¡æ˜¯å°†ç¬¬äºŒç§æ–¹æ³•ç¨ä½œè¿›ä¸€æ­¥çš„æ¦‚å¿µï¼Œå¹¶å°†è¿™äº›å…³æ³¨ç‚¹åˆ†ç¦»ä¸ºç‹¬ç«‹çš„å¯è¿è¡Œçš„ä»£ç åº“ã€‚ ä¸ºä»€ä¹ˆå¾®æœåŠ¡å¤æ‚æ€§â€”â€”å°†ç‰¹æ€§æ‹†åˆ†ä¸ºå¾®æœåŠ¡ï¼Œå¯ä»¥å°†ä»£ç åˆ†å‰²æˆæ›´å°çš„å—ã€‚è¿™è®©äººæƒ³èµ·äº†å¤è€çš„unixæ ¼è¨€:â€œåšå¥½ä¸€ä»¶äº‹â€ã€‚æœ‰ä¸€ç§è¶‹åŠ¿æ˜¯ï¼Œå•åˆ†å­å…è®¸åŸŸå½¼æ­¤ç´§å¯†è€¦åˆï¼Œè€Œå…³æ³¨ç‚¹å˜å¾—æ¨¡ç³Šã€‚è¿™å°†å¯¼è‡´æ›´å±é™©ã€æ›´å¤æ‚çš„æ›´æ–°ã€æ½œåœ¨çš„æ›´å¤šbugå’Œæ›´å¤æ‚çš„é›†æˆã€‚ è§„æ¨¡â€”â€”åœ¨ä¸€ä¸ªæ•´ä½“ä¸­ï¼ŒæŸäº›ä»£ç é¢†åŸŸå¯èƒ½æ¯”å…¶ä»–é¢†åŸŸæ›´é¢‘ç¹åœ°ä½¿ç”¨ã€‚ç”¨ä¸€ä¸ªæ•´ä½“ï¼Œä½ åªèƒ½ç¼©æ”¾æ•´ä¸ªä»£ç åº“ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„authæœåŠ¡ç»å¸¸å—åˆ°æ”»å‡»ï¼Œæ‚¨éœ€è¦æ‰©å±•æ•´ä¸ªä»£ç åº“æ¥å¤„ç†æ‚¨çš„ç¬¬authæœåŠ¡çš„è´Ÿè½½ã€‚ æœ‰äº†å¾®æœåŠ¡ï¼Œè¿™ç§åˆ†ç¦»å°±å¯ä»¥è®©æ‚¨å•ç‹¬åœ°æ‰©å±•å•ä¸ªæœåŠ¡ã€‚è¿™æ„å‘³ç€æ›´æœ‰æ•ˆçš„æ°´å¹³æ‰©å±•ã€‚å®ƒä¸å¤šæ ¸ã€å¤šåŒºåŸŸçš„äº‘è®¡ç®—éå¸¸æœ‰æ•ˆã€‚ Nginxå†™äº†ä¸€ä¸ªå…³äºå¾®æœåŠ¡çš„å„ç§æ¦‚å¿µçš„å¥‡å¦™ç³»åˆ—ï¼Œè¯·é˜…è¯»ã€‚ ä¸ºä»€ä¹ˆGolangæ¯•ç«Ÿï¼Œå¾®æœåŠ¡æ˜¯ç”±æ‰€æœ‰è¯­è¨€æ”¯æŒçš„ï¼Œæ¯•ç«Ÿï¼Œå¾®æœåŠ¡æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç‰¹å®šçš„æ¡†æ¶æˆ–å·¥å…·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº›è¯­è¨€æ›´é€‚åˆï¼Œæˆ–è€…æ¯”å…¶ä»–è¯­è¨€æ›´å¥½åœ°æ”¯æŒå¾®æœåŠ¡ã€‚æœ‰ä¸€ç§éå¸¸æ”¯æŒçš„è¯­è¨€æ˜¯Golangã€‚ Golangéå¸¸è½»ï¼Œéå¸¸å¿«ï¼Œå¹¶ä¸”å¯¹å¹¶å‘æœ‰éå¸¸å¥½çš„æ”¯æŒï¼Œåœ¨è¿è¡Œå¤šä¸ªæœºå™¨å’Œå†…æ ¸æ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ã€‚ Goè¿˜åŒ…å«ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç”¨äºç¼–å†™webæœåŠ¡çš„æ ‡å‡†åº“ã€‚ æœ€åï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆæ£’çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå«åšGo-microã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—ä¸­ä½¿ç”¨ã€‚ å¼•å…¥protobuf/gRPCç”±äºå¾®æœåŠ¡è¢«æ‹†åˆ†ä¸ºå•ç‹¬çš„ä»£ç åº“ï¼Œè€Œå¾®æœåŠ¡çš„ä¸€ä¸ªé‡è¦é—®é¢˜å°±æ˜¯é€šä¿¡ã€‚åœ¨ä¸€ä¸ªå•ä¸€çš„é€šä¿¡ä¸­ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½ ç›´æ¥ä»ä»£ç åº“çš„å…¶ä»–åœ°æ–¹è°ƒç”¨ä»£ç ã€‚ç„¶è€Œï¼Œå¾®æœåŠ¡æ²¡æœ‰è¿™ç§èƒ½åŠ›ï¼Œå› ä¸ºå®ƒä»¬ç”Ÿæ´»åœ¨ä¸åŒçš„åœ°æ–¹ã€‚å› æ­¤ï¼Œä½ éœ€è¦ä¸€ç§æ–¹å¼ï¼Œè®©è¿™äº›ç‹¬ç«‹çš„æœåŠ¡èƒ½å¤Ÿä»¥å°½å¯èƒ½å°‘çš„å»¶è¿Ÿè¿›è¡Œå¯¹è¯ã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„RESTï¼Œä¾‹å¦‚httpä¸Šçš„JSONæˆ–XMLã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼ŒæœåŠ¡Aå¿…é¡»å°†å…¶æ•°æ®ç¼–ç æˆJSON/XMLï¼Œå°†ä¸€ä¸ªå¤§å­—ç¬¦ä¸²å‘é€åˆ°ç½‘ç»œä¸Šï¼Œç„¶åæœåŠ¡äºBï¼Œç„¶åå°†è¯¥æ¶ˆæ¯ä»JSONè§£ç ä¸ºä»£ç ã€‚è¿™åœ¨è§„æ¨¡ä¸Šæœ‰æ½œåœ¨çš„å¼€é”€é—®é¢˜ã€‚å½“æ‚¨è¢«è¿«é‡‡ç”¨è¿™ç§å½¢å¼çš„webæµè§ˆå™¨é€šä¿¡æ—¶ï¼ŒæœåŠ¡å¯ä»¥ä»¥ä»»ä½•ä»–ä»¬å¸Œæœ›çš„æ ¼å¼è¿›è¡Œå¯¹è¯ã€‚ gRPCæ˜¯ç”±è°·æ­Œæå‡ºçš„åŸºäºè½»é‡çº§äºŒè¿›åˆ¶æ–‡ä»¶çš„RPCé€šä¿¡åè®®ã€‚è¿™æ˜¯å¾ˆå¤šå•è¯ï¼Œæˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸€ä¸‹ã€‚gRPCä½¿ç”¨äºŒè¿›åˆ¶ä½œä¸ºå…¶æ ¸å¿ƒæ•°æ®æ ¼å¼ã€‚åœ¨æˆ‘ä»¬çš„RESTfulç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨JSONï¼Œæ‚¨å°†é€šè¿‡httpå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²åŒ…å«å…³äºå…¶ç¼–ç æ ¼å¼çš„å¤§é‡å…ƒæ•°æ®;å…³äºå®ƒçš„é•¿åº¦ï¼Œå®ƒçš„å†…å®¹æ ¼å¼å’Œå„ç§å…¶ä»–é›¶é›¶ç¢ç¢ã€‚è¿™æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨èƒ½å¤Ÿé€šçŸ¥ä¼ ç»Ÿçš„åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯ã€‚åœ¨ä¸¤ä¸ªæœåŠ¡ä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ‰€æœ‰è¿™äº›ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†·ç¡¬äºŒè¿›åˆ¶ï¼Œå®ƒçš„é‡é‡è¦è½»å¾—å¤šã€‚gRPCä½¿ç”¨äº†æ–°çš„HTTP 2.0è§„èŒƒï¼Œå®ƒå…è®¸ä½¿ç”¨äºŒè¿›åˆ¶æ•°æ®ã€‚å®ƒç”šè‡³å…è®¸åŒå‘æµï¼Œè¿™å¾ˆé…·!HTTP 2å¯¹äºgRPCçš„å·¥ä½œæ–¹å¼éå¸¸é‡è¦ã€‚æœ‰å…³HTTP 2çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è°·æ­Œçš„è¿™ç¯‡ç²¾å½©æ–‡ç« ã€‚ ä½†æ˜¯å¯¹äºäºŒè¿›åˆ¶æ•°æ®æˆ‘ä»¬æ€ä¹ˆåšå‘¢?gRPCæœ‰ä¸€ä¸ªå«åšprotobufçš„äº’æ¢DSLã€‚Protobufå…è®¸æ‚¨ä½¿ç”¨å¼€å‘äººå‘˜å‹å¥½çš„æ ¼å¼å®šä¹‰æœåŠ¡çš„æ¥å£ã€‚ è®©æˆ‘ä»¬ä»åˆ›å»ºç¬¬ä¸€ä¸ªæœåŠ¡å®šä¹‰å¼€å§‹ã€‚ä»æˆ‘ä»¬çš„repoçš„æ ¹ç›®å½•åˆ›å»ºä»¥ä¸‹æ–‡ä»¶:consignment-service/proto/consignment/consignment.protoã€‚å°±ç›®å‰è€Œè¨€ï¼Œæˆ‘æŠŠæˆ‘ä»¬æ‰€æœ‰çš„æœåŠ¡éƒ½å®‰æ’åœ¨ä¸€ä¸ªå•ä¸€çš„å›è´­åè®®é‡Œã€‚è¿™å°±æ˜¯æ‰€è°“çš„mono-repoã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†è®©æœ¬æ•™ç¨‹ä¿æŒç®€å•ã€‚æœ‰å¾ˆå¤šåå¯¹ä½¿ç”¨å•å¼•å·çš„ç†ç”±ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºã€‚æ‚¨å¯ä»¥å°†æ‰€æœ‰è¿™äº›æœåŠ¡å’Œç»„ä»¶æ”¾åœ¨å•ç‹¬çš„reposä¸­ï¼Œä¹Ÿæœ‰è®¸å¤šå¾ˆå¥½çš„ç†ç”±æ”¯æŒè¿™ç§æ–¹æ³•ã€‚ è¿™é‡Œæœ‰ä¸€ç¯‡å¾ˆæ£’çš„å…³äºgRPCçš„æ–‡ç« ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ è¯»ä¸€è¯»ã€‚ åœ¨æ‚¨åˆšåˆšåˆ›å»ºçš„consignment.protoæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹: 12345678910111213141516171819202122232425262728// consignment-service/proto/consignment/consignment.protosyntax = &quot;proto3&quot;;package go.micro.srv.consignment;service ShippingService &#123; rpc CreateConsignment(Consignment) returns (Response) &#123;&#125;&#125;message Consignment &#123; string id = 1; string description = 2; int32 weight = 3; repeated Container containers = 4; string vessel_id = 5;&#125;message Container &#123; string id = 1; string customer_id = 2; string origin = 3; string user_id = 4;&#125;message Response &#123; bool created = 1; Consignment consignment = 2;&#125; è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„ä¾‹å­ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆï¼Œå®šä¹‰æ‚¨çš„æœåŠ¡ï¼Œè¿™åº”è¯¥åŒ…å«æ‚¨å¸Œæœ›å‘å…¶ä»–æœåŠ¡å…¬å¼€çš„æ–¹æ³•ã€‚ç„¶åå®šä¹‰æ¶ˆæ¯ç±»å‹ï¼Œè¿™äº›æ˜¯æœ‰æ•ˆçš„æ•°æ®ç»“æ„ã€‚Protobufæ˜¯é™æ€ç±»å‹çš„ï¼Œæ‚¨å¯ä»¥å®šä¹‰è‡ªå®šä¹‰ç±»å‹ï¼Œå°±åƒæˆ‘ä»¬åœ¨å®¹å™¨ä¸­æ‰€åšçš„é‚£æ ·ã€‚æ¶ˆæ¯æœ¬èº«å°±æ˜¯è‡ªå®šä¹‰ç±»å‹ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªåº“ï¼Œæ¶ˆæ¯ç”±protobufå¤„ç†ï¼Œæˆ‘ä»¬å®šä¹‰çš„æœåŠ¡ç”±gRPC protobufæ’ä»¶å¤„ç†ï¼Œå®ƒç¼–è¯‘ä»£ç æ¥ä¸è¿™äº›ç±»å‹äº¤äº’ã€‚æˆ‘ä»¬çš„protoæ–‡ä»¶çš„æœåŠ¡éƒ¨åˆ†ã€‚ ç„¶åï¼Œé€šè¿‡ä¸€ä¸ªCLIæ¥ç”Ÿæˆè¿™ä¸ªprotobufå®šä¹‰ï¼Œç”Ÿæˆä»£ç æ¥æ¥å£è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®å’Œæ‚¨çš„åŠŸèƒ½ã€‚ è¯´åˆ°è¿™é‡Œï¼Œè®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡$ touch consignment-service/Makefileåˆ›å»ºä¸€ä¸ªMakefileã€‚ æ³¨æ„:åœ¨å¤åˆ¶Makefileä»£ç æ—¶è¦æ³¨æ„æ ¼å¼ï¼Œå®ƒä»¬å¿…é¡»æ˜¯åˆ¶è¡¨ç¬¦é—´è·ï¼Œå¦åˆ™å°±ä¼šä¸­æ–­ã€‚è¯·ç¡®ä¿æ‚¨çš„ç¼–è¾‘å™¨å·²ç»å¯¹makefileè¿›è¡Œäº†lintingæˆ–é€‚å½“çš„è®¾ç½®ã€‚ 123build: protoc -I. --go_out=plugins=grpc:$(GOPATH)/src/github.com/ewanvalentine/shipper/consignment-service \\ proto/consignment/consignment.proto è¿™å°†è°ƒç”¨protocåº“ï¼Œè¯¥åº“è´Ÿè´£å°†æ‚¨çš„protobufå®šä¹‰ç¼–è¯‘æˆä»£ç ã€‚æˆ‘ä»¬è¿˜æŒ‡å®šäº†grpcæ’ä»¶çš„ä½¿ç”¨ï¼Œä»¥åŠæ„å»ºä¸Šä¸‹æ–‡å’Œè¾“å‡ºè·¯å¾„ã€‚ ç°åœ¨ï¼Œå½“æ‚¨ä»è¿™ä¸ªæœåŠ¡ç›®å½•è¿è¡Œ$ make buildæ—¶ï¼ŒæŸ¥çœ‹proto/consignment/æ‚¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„Goæ–‡ä»¶ï¼Œå«åšconsignment.pb.goã€‚è¿™æ˜¯gRPC/protobufåº“è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼Œå…è®¸æ‚¨å°†protobufå®šä¹‰ä¸æ‚¨è‡ªå·±çš„ä»£ç è¿›è¡Œæ¥å£ã€‚ æˆ‘ä»¬ç°åœ¨æ¥åˆ›å»ºmain.goæ–‡ä»¶åœ¨é¡¹ç›®æ ¹$ touch consignment-service/main.goã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980// consignment-service/main.gopackage mainimport ( \"log\" \"net\" // Import the generated protobuf code pb \"github.com/ewanvalentine/shipper/consignment-service/proto/consignment\" \"golang.org/x/net/context\" \"google.golang.org/grpc\" \"google.golang.org/grpc/reflection\")const ( port = \":50051\")type IRepository interface &#123; Create(*pb.Consignment) (*pb.Consignment, error)&#125;// Repository - Dummy repository, this simulates the use of a datastore// of some kind. We'll replace this with a real implementation later on.type Repository struct &#123; consignments []*pb.Consignment&#125;func (repo *Repository) Create(consignment *pb.Consignment) (*pb.Consignment, error) &#123; updated := append(repo.consignments, consignment) repo.consignments = updated return consignment, nil&#125;// Service should implement all of the methods to satisfy the service// we defined in our protobuf definition. You can check the interface// in the generated code itself for the exact method signatures etc// to give you a better idea.type service struct &#123; repo IRepository&#125;// CreateConsignment - we created just one method on our service,// which is a create method, which takes a context and a request as an// argument, these are handled by the gRPC server.func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment) (*pb.Response, error) &#123; // Save our consignment consignment, err := s.repo.Create(req) if err != nil &#123; return nil, err &#125; // Return matching the `Response` message we created in our // protobuf definition. return &amp;pb.Response&#123;Created: true, Consignment: consignment&#125;, nil&#125;func main() &#123; repo := &amp;Repository&#123;&#125; // Set-up our gRPC server. lis, err := net.Listen(\"tcp\", port) if err != nil &#123; log.Fatalf(\"failed to listen: %v\", err) &#125; s := grpc.NewServer() // Register our service with the gRPC server, this will tie our // implementation into the auto-generated interface code for our // protobuf definition. pb.RegisterShippingServiceServer(s, &amp;service&#123;repo&#125;) // Register reflection service on gRPC server. reflection.Register(s) if err := s.Serve(lis); err != nil &#123; log.Fatalf(\"failed to serve: %v\", err) &#125;&#125; è¯·ä»”ç»†é˜…è¯»ä»£ç ä¸­çš„æ³¨é‡Šã€‚ä½†æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºäº†å®ç°é€»è¾‘ï¼Œæˆ‘ä»¬çš„gRPCæ–¹æ³•æ¥å£ä½¿ç”¨ç”Ÿæˆçš„æ ¼å¼ï¼Œåœ¨ç«¯å£50051ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„gRPCæœåŠ¡å™¨ã€‚æœ‰ä½ æœ‰å®ƒ!ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„gRPCæœåŠ¡ã€‚ä½ å¯ä»¥ç”¨$ go mainæ¥è¿è¡Œè¿™ä¸ªã€‚å»å§ï¼Œä½†æ˜¯ä½ ä»€ä¹ˆéƒ½çœ‹ä¸åˆ°ï¼Œä½ è¿˜ä¸èƒ½ç”¨å®ƒâ€¦â€¦å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥æŸ¥çœ‹å®ƒçš„å®é™…æ“ä½œã€‚ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œæ¥å£ï¼Œå®ƒå°†ä½¿ç”¨ä¸€ä¸ªJSONå§”æ‰˜æ–‡ä»¶ï¼Œå¹¶ä¸æˆ‘ä»¬çš„gRPCæœåŠ¡äº¤äº’ã€‚ åœ¨æ ¹ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å­ç›®å½•$ mkdir consignment-cliã€‚åœ¨è¯¥ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºcli.goçš„æ–‡ä»¶ã€‚ä»¥ä¸‹å†…å®¹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556// consignment-cli/cli.gopackage mainimport ( \"encoding/json\" \"io/ioutil\" \"log\" \"os\" pb \"github.com/ewanvalentine/shipper/consignment-service/proto/consignment\" \"golang.org/x/net/context\" \"google.golang.org/grpc\")const ( address = \"localhost:50051\" defaultFilename = \"consignment.json\")func parseFile(file string) (*pb.Consignment, error) &#123; var consignment *pb.Consignment data, err := ioutil.ReadFile(file) if err != nil &#123; return nil, err &#125; json.Unmarshal(data, &amp;consignment) return consignment, err&#125;func main() &#123; // Set up a connection to the server. conn, err := grpc.Dial(address, grpc.WithInsecure()) if err != nil &#123; log.Fatalf(\"Did not connect: %v\", err) &#125; defer conn.Close() client := pb.NewShippingService(conn) // Contact the server and print out its response. file := defaultFilename if len(os.Args) &gt; 1 &#123; file = os.Args[1] &#125; consignment, err := parseFile(file) if err != nil &#123; log.Fatalf(\"Could not parse file: %v\", err) &#125; r, err := client.CreateConsignment(context.Background(), consignment) if err != nil &#123; log.Fatalf(\"Could not greet: %v\", err) &#125; log.Printf(\"Created: %t\", r.Created)&#125; ç°åœ¨åˆ›å»ºä¸€ä¸ªå§”æ‰˜(consignment-cli/consignment.json): 12345678&#123; \"description\": \"This is a test consignment\", \"weight\": 550, \"containers\": [ &#123; \"customer_id\": \"cust001\", \"user_id\": \"user001\", \"origin\": \"Manchester, United Kingdom\" &#125; ], \"vessel_id\": \"vessel001\"&#125; ç°åœ¨ï¼Œå¦‚æœä½ åœ¨consignment-serviceè¿è¡Œ$ go run main.goï¼Œç„¶ååœ¨ä¸€ä¸ªå•ç‹¬çš„ç»ˆç«¯é¢æ¿ä¸­è¿è¡Œ$ go run cli.goã€‚æ‚¨åº”è¯¥çœ‹åˆ°ä¸€æ¡æ¶ˆæ¯è¯´Created: trueã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¦‚ä½•æ‰èƒ½çœŸæ­£æ£€éªŒå®ƒåˆ›é€ äº†ä»€ä¹ˆå‘¢?è®©æˆ‘ä»¬ç”¨GetConsignmentsæ–¹æ³•æ¥æ›´æ–°æˆ‘ä»¬çš„æœåŠ¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ›å»ºçš„å§”æ‰˜ã€‚ é¦–å…ˆè®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„protoå®šä¹‰(æˆ‘ç•™ä¸‹æ³¨é‡Šæ¥è¡¨ç¤ºæ‰€åšçš„æ›´æ”¹): 12345678910111213141516171819202122232425262728293031323334353637// consignment-service/proto/consignment/consignment.protosyntax = \"proto3\";package go.micro.srv.consignment;service ShippingService &#123; rpc CreateConsignment(Consignment) returns (Response) &#123;&#125; // Created a new method rpc GetConsignments(GetRequest) returns (Response) &#123;&#125;&#125;message Consignment &#123; string id = 1; string description = 2; int32 weight = 3; repeated Container containers = 4; string vessel_id = 5;&#125;message Container &#123; string id = 1; string customer_id = 2; string origin = 3; string user_id = 4;&#125;// Created a blank get requestmessage GetRequest &#123;&#125;message Response &#123; bool created = 1; Consignment consignment = 2; // Added a pluralised consignment to our generic response message repeated Consignment consignments = 3;&#125; å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æœåŠ¡ä¸Šåˆ›å»ºäº†ä¸€ä¸ªåä¸ºGetConsignmentsçš„æ–°æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„GetRequestï¼Œå®ƒæš‚æ—¶ä¸åŒ…å«ä»»ä½•ä¸œè¥¿ã€‚æˆ‘ä»¬è¿˜åœ¨å“åº”æ¶ˆæ¯ä¸­æ·»åŠ äº†ä¸€ä¸ªconsignmentså­—æ®µã€‚æ‚¨å°†æ³¨æ„åˆ°è¿™é‡Œçš„ç±»å‹åœ¨å®é™…ç±»å‹ä¹‹å‰é‡å¤äº†å…³é”®å­—ã€‚æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çŒœåˆ°çš„é‚£æ ·ï¼Œè¿™æ„å‘³ç€å°†è¿™ä¸ªå­—æ®µä½œä¸ºè¿™äº›ç±»å‹çš„æ•°ç»„æ¥å¤„ç†ã€‚ ç°åœ¨å†æ¬¡è¿è¡Œ$ make buildã€‚ç°åœ¨ï¼Œå†æ¬¡å°è¯•è¿è¡Œæ‚¨çš„æœåŠ¡ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼äº:*. serviceæ²¡æœ‰å®ç°go_micro_srv_consignment.ShippingServiceServer(ä¸¢å¤±GetConsignmentsæ–¹æ³•)çš„é”™è¯¯ã€‚ ç”±äºæˆ‘ä»¬çš„gRPCæ–¹æ³•çš„å®ç°ï¼Œæ˜¯åŸºäºä¸protobufåº“ç”Ÿæˆçš„æ¥å£ç›¸åŒ¹é…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬çš„å®ç°ç¬¦åˆæˆ‘ä»¬çš„protoå®šä¹‰ã€‚ æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹æˆ‘ä»¬çš„consignment-service/main.goæ–‡ä»¶: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package mainimport ( \"log\" \"net\" // Import the generated protobuf code pb \"github.com/ewanvalentine/shipper/consignment-service/proto/consignment\" \"golang.org/x/net/context\" \"google.golang.org/grpc\" \"google.golang.org/grpc/reflection\")const ( port = \":50051\")type IRepository interface &#123; Create(*pb.Consignment) (*pb.Consignment, error) GetAll() []*pb.Consignment&#125;// Repository - Dummy repository, this simulates the use of a datastore// of some kind. We'll replace this with a real implementation later on.type Repository struct &#123; consignments []*pb.Consignment&#125;func (repo *Repository) Create(consignment *pb.Consignment) (*pb.Consignment, error) &#123; updated := append(repo.consignments, consignment) repo.consignments = updated return consignment, nil&#125;func (repo *Repository) GetAll() []*pb.Consignment &#123; return repo.consignments&#125;// Service should implement all of the methods to satisfy the service// we defined in our protobuf definition. You can check the interface// in the generated code itself for the exact method signatures etc// to give you a better idea.type service struct &#123; repo IRepository&#125;// CreateConsignment - we created just one method on our service,// which is a create method, which takes a context and a request as an// argument, these are handled by the gRPC server.func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment) (*pb.Response, error) &#123; // Save our consignment consignment, err := s.repo.Create(req) if err != nil &#123; return nil, err &#125; // Return matching the `Response` message we created in our // protobuf definition. return &amp;pb.Response&#123;Created: true, Consignment: consignment&#125;, nil&#125;func (s *service) GetConsignments(ctx context.Context, req *pb.GetRequest) (*pb.Response, error) &#123; consignments := s.repo.GetAll() return &amp;pb.Response&#123;Consignments: consignments&#125;, nil&#125;func main() &#123; repo := &amp;Repository&#123;&#125; // Set-up our gRPC server. lis, err := net.Listen(\"tcp\", port) if err != nil &#123; log.Fatalf(\"failed to listen: %v\", err) &#125; s := grpc.NewServer() // Register our service with the gRPC server, this will tie our // implementation into the auto-generated interface code for our // protobuf definition. pb.RegisterShippingServiceServer(s, &amp;service&#123;repo&#125;) // Register reflection service on gRPC server. reflection.Register(s) if err := s.Serve(lis); err != nil &#123; log.Fatalf(\"failed to serve: %v\", err) &#125;&#125; è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»åŒ…å«äº†æ–°çš„GetConsignmentsæ–¹æ³•ï¼Œæ›´æ–°äº†æˆ‘ä»¬çš„å­˜å‚¨åº“å’Œæ¥å£ï¼Œå¹¶æ»¡è¶³äº†protoå®šä¹‰ç”Ÿæˆçš„æ¥å£ã€‚å¦‚æœä½ è¿è¡Œ$ go run main.goã€‚å†æ¥ä¸€éï¼Œè¿™åˆç®¡ç”¨äº†ã€‚ è®©æˆ‘ä»¬æ›´æ–°cliå·¥å…·ï¼Œä»¥åŒ…æ‹¬è°ƒç”¨æ­¤æ–¹æ³•å’Œåˆ—å‡ºæˆ‘ä»¬çš„å§”æ‰˜çš„èƒ½åŠ›: 1234567891011func main() &#123; ... getAll, err := client.GetConsignments(context.Background(), &amp;pb.GetRequest&#123;&#125;) if err != nil &#123; log.Fatalf(\"Could not list consignments: %v\", err) &#125; for _, v := range getAll.Consignments &#123; log.Println(v) &#125;&#125; åœ¨æˆ‘ä»¬çš„mainå‡½æ•°çš„æœ€ä¸‹é¢ï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬è®°å½•æˆ‘ä»¬çš„â€Created: successâ€æ¶ˆæ¯ï¼Œé™„åŠ ä¸Šé¢çš„ä»£ç ï¼Œå¹¶é‡æ–°è¿è¡Œ $ go run cli.goã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªå§”æ‰˜ï¼Œç„¶åè°ƒç”¨GetConsignmentsã€‚æ‚¨åº”è¯¥çœ‹åˆ°è¿™ä¸ªåˆ—è¡¨åœ¨è¿è¡Œçš„æ¬¡æ•°è¶Šå¤šã€‚ æ³¨æ„:ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘æœ‰æ—¶å¯èƒ½ä¼šä¿®è®¢ä¹‹å‰ç”¨ä¸€ä¸ªâ€¦è¡¨ç¤ºæ²¡æœ‰å¯¹å‰é¢çš„ä»£ç åšä»»ä½•æ›´æ”¹ï¼Œä½†æ˜¯æ·»åŠ äº†é™„åŠ çš„è¡Œæˆ–é™„åŠ çš„è¡Œã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ°åˆ›å»ºäº†ä¸€ä¸ªå¾®æœåŠ¡å’Œä¸€ä¸ªå®¢æˆ·ç«¯æ¥ä¸å®ƒäº¤äº’ï¼Œä½¿ç”¨protobufå’ŒgRPCã€‚ æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« å°†å›´ç»•å¦‚ä½•é›†æˆgo-microï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œç”¨äºåˆ›å»ºåŸºäºgRPCçš„å¾®æœåŠ¡ã€‚æˆ‘ä»¬è¿˜å°†åˆ›å»ºç¬¬äºŒä¸ªæœåŠ¡ï¼Œå³å®¹å™¨æœåŠ¡ã€‚è¯´åˆ°å®¹å™¨ï¼Œåªæ˜¯ä¸ºäº†æ··æ·†é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜å°†åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­æŸ¥çœ‹Dockerå®¹å™¨ä¸­çš„æœåŠ¡ã€‚ è¿›ä¸€æ­¥çš„é˜…è¯» æ–‡ç« å’Œé€šè®¯https://www.nginx.com/blog/introduction-to-microservices/https://martinfowler.com/articles/microservices.htmlhttps://www.microservices.com/talks/ https://medium.facilelogin.com/ten-talks-on-microservices-you-cannot-miss-at-any-cost-7bbe5ab7f43f#.ui0748oat https://microserviceweekly.com/ ä¹¦https://www.amazon.co.uk/Building-Microservices-Sam-Newman/dp/1491950358 https://www.amazon.co.uk/Devops-Handbook-World-Class-Reliability-Organizations/dp/1942788002 https://www.amazon.co.uk/Phoenix-Project-DevOps-Helping-Business/dp/0988262509 æ’­å®¢https://softwareengineeringdaily.com/tag/microservices/https://martinfowler.com/tags/podcast.htmlhttps://www.infoq.com/microservices/podcasts/","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Goå¾®æœåŠ¡æ•™ç¨‹","slug":"go-micro-tutorial-readme","date":"2018-05-10T13:33:53.000Z","updated":"2020-07-25T02:57:18.206Z","comments":true,"path":"2018/05/10/go-micro-tutorial-readme/","link":"","permalink":"https://jigangduan.github.io/2018/05/10/go-micro-tutorial-readme/","excerpt":"","text":"è¿™æ˜¯ä¸€ä¸ªåèŠ‚Golangçš„å¾®æœåŠ¡çš„ç³»åˆ—ã€‚åˆ©ç”¨protobufå’ŒgRPCä½œä¸ºåº•å±‚ä¼ è¾“åè®®ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºæˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰å¼„æ˜ç™½å¹¶è§£å†³äº†ä¸€ä¸ªæ¸…æ™°è€Œç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘æƒ³è¦åˆ†äº«æˆ‘åœ¨åˆ›å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å¾®æœåŠ¡çš„è¿‡ç¨‹ä¸­æ‰€äº†è§£åˆ°çš„ä¸œè¥¿ï¼Œè¿™äº›æœåŠ¡æ˜¯ä¸å…¶ä»–æ–°å‡ºç°çš„ç”¨æˆ·ç«¯åˆ°ä¸€èµ·çš„ã€‚ ç›®å½•ç¬¬ä¸€éƒ¨åˆ†ç¬¬äºŒéƒ¨åˆ†ç¬¬ä¸‰éƒ¨åˆ†ç¬¬å››éƒ¨åˆ†ç¬¬äº”éƒ¨åˆ†ç¬¬å…­éƒ¨åˆ†ç¬¬ä¸ƒéƒ¨åˆ†ç¬¬å…«éƒ¨åˆ†","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Rediså¼€å‘å’Œè¿ç»´ (4) - å…¶å®ƒåŠŸèƒ½","slug":"redis-devops-4","date":"2018-04-20T03:55:11.000Z","updated":"2020-07-25T02:57:18.227Z","comments":true,"path":"2018/04/20/redis-devops-4/","link":"","permalink":"https://jigangduan.github.io/2018/04/20/redis-devops-4/","excerpt":"","text":"æ…¢æŸ¥è¯¢å®¢æˆ·ç«¯ç”Ÿå‘½å‘¨æœŸ ä¸¤ç‚¹è¯´æ˜ï¼š æ…¢æŸ¥è¯¢å‘ç”Ÿåœ¨ç¬¬3é˜¶æ®µ å®¢æˆ·ç«¯è¶…æ—¶ä¸ä¸€å®šæ˜¯æ…¢æŸ¥è¯¢ï¼Œä½†æ˜¯æ…¢æŸ¥è¯¢æ˜¯å®¢æˆ·ç«¯è¶…æ—¶çš„ä¸€ä¸ªå¯èƒ½çš„åŸå›  æ…¢æŸ¥è¯¢çš„ä¸¤ä¸ªé…ç½®slowlog-max-len å®ƒå†³å®š slow log æœ€å¤šèƒ½ä¿å­˜å¤šå°‘æ¡æ—¥å¿—ï¼Œ slow log æœ¬èº«æ˜¯ä¸€ä¸ª FIFO é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—å¤§å°è¶…è¿‡ slowlog-max-len æ—¶ï¼Œæœ€æ—§çš„ä¸€æ¡æ—¥å¿—å°†è¢«åˆ é™¤ï¼Œè€Œæœ€æ–°çš„ä¸€æ¡æ—¥å¿—åŠ å…¥åˆ° slow logã€‚ å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ— å›ºå®šé•¿åº¦ï¼Œé˜Ÿåˆ—æ»¡åï¼Œç¬¬ä¸€ä¸ªè¿›å…¥é˜Ÿåˆ—çš„å°†ä¼šè¢«è¸¢å‡º ä¿å­˜åœ¨å†…å­˜ä¸­ slowlog-log-slower-than å®ƒå†³å®šè¦å¯¹æ‰§è¡Œæ—¶é—´å¤§äºå¤šå°‘å¾®ç§’(microsecondï¼Œ1ç§’ = 1,000,000 å¾®ç§’)çš„æŸ¥è¯¢è¿›è¡Œè®°å½•ã€‚ æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰ slowlog-log-slower-than=0ï¼Œè®°å½•æ‰€æœ‰å‘½ä»¤ slowlog-log-slower-than&lt;0ï¼Œä¸è®°å½•ä»»ä½•å‘½ä»¤ é…ç½®æ–¹æ³• é»˜è®¤å€¼ 12config get slowlog-max-len = 128config get slowlog-log-slower-than = 10000 ä¿®æ”¹é…ç½®æ–‡ä»¶é‡å¯ åŠ¨æ€é…ç½® æ…¢æŸ¥è¯¢å‘½ä»¤ slowlog get [n]ï¼šè·å–æ…¢æŸ¥è¯¢é˜Ÿåˆ— slowlog lenï¼šè·å–æ…¢æŸ¥è¯¢é˜Ÿåˆ—é•¿åº¦ slowlog resetï¼šæ¸…ç©ºæ…¢æŸ¥è¯¢é˜Ÿåˆ— è¿ç»´ç»éªŒ slowlog-max-len ä¸è¦è®¾ç½®è¿‡å¤§ï¼Œé»˜è®¤10msï¼Œé€šå¸¸è®¾ç½®1ms slowlog-log-slower-than ä¸è¦è®¾ç½®è¿‡å°ï¼Œé€šå¸¸è®¾ç½®1000å·¦å³ ç†è§£å‘½ä»¤çš„ç”Ÿå‘½å‘¨æœŸ å®šæœŸæŒä¹…åŒ–æ…¢æŸ¥è¯¢ pipelineå‘å¸ƒè®¢é˜…BitmapHyperLogLogGEO","categories":[{"name":"Redis","slug":"Redis","permalink":"https://jigangduan.github.io/categories/Redis/"},{"name":"æ•°æ®åº“","slug":"Redis/æ•°æ®åº“","permalink":"https://jigangduan.github.io/categories/Redis/æ•°æ®åº“/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://jigangduan.github.io/tags/redis/"}]},{"title":"Rediså¼€å‘å’Œè¿ç»´ (3) - å®¢æˆ·ç«¯ä½¿ç”¨","slug":"redis-devops-3","date":"2018-04-20T02:07:56.000Z","updated":"2020-07-25T02:57:18.227Z","comments":true,"path":"2018/04/20/redis-devops-3/","link":"","permalink":"https://jigangduan.github.io/2018/04/20/redis-devops-3/","excerpt":"","text":"Redisæ”¯æŒçš„å®¢æˆ·ç«¯ï¼ŒæŸ¥çœ‹è¿™é‡Œ Javaå®¢æˆ·ç«¯Jedis Mavenä¾èµ–ï¼š 1234567&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt; &lt;type&gt;jar&lt;/type&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; Jedisç›´è¿ï¼š ç”ŸæˆJediså¯¹è±¡(è¿æ¥) Jedisæ‰§è¡Œå‘½ä»¤ è¿”å›æ‰§è¡Œç»“æœ å…³é—­Jedisè¿æ¥ 123Jedis jedis = new Jedis(\"127.0.0.1\", 6379);jedis.set(\"hello\", \"world\");String value = jedis.get(\"hello\"); 1Jedis(String host, int port, int connectionTimeout, int soTimeout) host: RedisèŠ‚ç‚¹æ‰€åœ¨æœºå™¨çš„IP portï¼šRedisèŠ‚ç‚¹çš„ç«¯å£ connectionTimeout: å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶ soTimeoutï¼šå®¢æˆ·ç«¯è¯»å†™è¶…æ—¶ Jedisè¿æ¥æ±  ä»èµ„æºæ± å€ŸJediså¯¹è±¡ Jedisæ‰§è¡Œå‘½ä»¤ è¿”å›æ‰§è¡Œç»“æœ å½’è¿˜Jediså¯¹è±¡ç»™è¿æ¥æ±  æ–¹æ¡ˆå¯¹æ¯”ï¼š - ä¼˜ç‚¹ ç¼ºç‚¹ ç›´è¿&nbsp;&nbsp; ç®€å•æ–¹ä¾¿é€‚ç”¨äºå°‘é‡é•¿æœŸè¿æ¥çš„åœºæ™¯ å­˜åœ¨æ¯æ¬¡æ–°é”®/å…³é—­TCPå¼€é”€èµ„æºæ— æ³•æ§åˆ¶ï¼Œå­˜åœ¨è¿æ¥æ³„éœ²çš„å¯èƒ½Jediså¯¹è±¡çº¿ç¨‹ä¸å®‰å…¨ è¿æ¥æ± &nbsp;&nbsp; Jedisé¢„å…ˆç”Ÿæˆï¼Œé™ä½å¼€é”€è¿æ¥æ± çš„å½¢å¼ä¿æŠ¤å’Œæ§åˆ¶èµ„æºä½¿ç”¨ ç›¸å¯¹äºç›´è¿ï¼Œä½¿ç”¨ç›¸å¯¹éº»çƒ¦ï¼Œå°¤å…¶åœ¨èµ„æºçš„ç®¡ç†ä¸Šéœ€è¦å¾ˆå¤šå‚æ•°æ¥ä¿è¯ï¼Œä¸€æ—¦è§„åˆ’ä¸åˆç†ä¹Ÿä¼šå‡ºç°é—®é¢˜ ç®€å•ä½¿ç”¨1234// 1. stringjedis.set(\"hello\", \"world\");jedis.get(\"hello\");jedis.incr(\"counter\"); 1234// 2. hashjedis.hset(\"myhash\", \"f1\", \"v1\");jedis.hset(\"myhash\", \"f2\", \"v2\");jedis.hgetAll(\"myhash\"); 12345// 3. listjedis.hset(\"mylist\", \"1\");jedis.hset(\"mylist\", \"2\");jedis.hset(\"mylist\", \"3\");jedis.lrange(\"mylist\", 0, -1); 12345// 4. setjedis.sadd(\"myset\", \"a\");jedis.sadd(\"myset\", \"b\");jedis.sadd(\"myset\", \"c\");jedis.smembers(\"myset\"); 12345// 5. zsetjedis.zadd(\"myzset\", 99, \"tom\");jedis.zadd(\"myzset\", 66, \"pete\");jedis.zadd(\"myzset\", 33, \"jam\");jedis.zrangeWithScores(\"myset\", 0, -1); Jedisè¿æ¥æ± ä½¿ç”¨Jedisæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š è·å–Jediså®ä¾‹éœ€è¦ä»JedisPoolä¸­è·å– ç”¨å®ŒJediså®ä¾‹éœ€è¦è¿”è¿˜ç»™JedisPool å¦‚æœJedisåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œåˆ™ä¹Ÿéœ€è¦è¿˜ç»™JedisPool 1234567891011121314151617181920212223242526272829303132333435package cn.crxy.redis;import redis.clients.jedis.Jedis;import redis.clients.jedis.JedisPool;import redis.clients.jedis.JedisPoolConfig;public class RedisUtils &#123; private RedisUtils()&#123; &#125; private static JedisPool jedisPool = null; //è·å–é“¾æ¥ public static synchronized Jedis getJedis()&#123; if(jedisPool==null)&#123; JedisPoolConfig jedisPoolConfig = new JedisPoolConfig(); //æŒ‡å®šè¿æ¥æ± ä¸­æœ€å¤§ç©ºé—²è¿æ¥æ•° jedisPoolConfig.setMaxIdle(10); //é“¾æ¥æ± ä¸­åˆ›å»ºçš„æœ€å¤§è¿æ¥æ•° jedisPoolConfig.setMaxTotal(100); //è®¾ç½®åˆ›å»ºé“¾æ¥çš„è¶…æ—¶æ—¶é—´ jedisPoolConfig.setMaxWaitMillis(2000); //è¡¨ç¤ºè¿æ¥æ± åœ¨åˆ›å»ºé“¾æ¥çš„æ—¶å€™ä¼šå…ˆæµ‹è¯•ä¸€ä¸‹é“¾æ¥æ˜¯å¦å¯ç”¨ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¿æ¥æ± ä¸­çš„é“¾æ¥éƒ½å¯ç”¨çš„ã€‚ jedisPoolConfig.setTestOnBorrow(true); jedisPool = new JedisPool(jedisPoolConfig, \"192.168.1.170\", 6379); &#125; return jedisPool.getResource(); &#125; //è¿”å›é“¾æ¥ public static void returnResource(Jedis jedis)&#123; jedisPool.returnResourceObject(jedis); &#125;&#125; pythonå®¢æˆ·ç«¯redis-py å®‰è£…redis-pyGitHub è¦å®‰è£…redis-pyï¼Œåªéœ€:: 1pip install redis æˆ–ä»æºä»£ç : 1python setup.py install 123456import redis&gt;&gt;&gt; r = redis.Redis(host='localhost', port=6379, db=0)&gt;&gt;&gt; r.set('foo', 'bar')True&gt;&gt;&gt; r.get('foo')'bar' golangå®¢æˆ·ç«¯redigo GitHub å®‰è£…: 1go get github.com/gomodule/redigo/redis APIæ–‡æ¡£","categories":[{"name":"Redis","slug":"Redis","permalink":"https://jigangduan.github.io/categories/Redis/"},{"name":"æ•°æ®åº“","slug":"Redis/æ•°æ®åº“","permalink":"https://jigangduan.github.io/categories/Redis/æ•°æ®åº“/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://jigangduan.github.io/tags/redis/"}]},{"title":"Rediså¼€å‘å’Œè¿ç»´ (2) - Redis API","slug":"redis-devops-2","date":"2018-04-19T14:46:25.000Z","updated":"2020-07-25T02:57:18.227Z","comments":true,"path":"2018/04/19/redis-devops-2/","link":"","permalink":"https://jigangduan.github.io/2018/04/19/redis-devops-2/","excerpt":"","text":"é€šç”¨å‘½ä»¤ éå†æ‰€æœ‰key 123keys *keys [pattern] ä¸€èˆ¬ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå•çº¿ç¨‹åˆ—å‡ºè€—æ—¶ å¯ä»¥åœ¨çƒ­å¤‡èŠ‚ç‚¹ä¸Šç”¨ è®¡ç®—keyçš„æ€»æ•° 1dbsize æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨ 1exists key åˆ é™¤æŒ‡å®škey-value 1del key [keys...] keyåœ¨secondsç§’åè¿‡æœŸ 1expire key seconds type key æ•°æ®ç»“æ„å’Œå†…éƒ¨ç¼–ç ### å­—ç¬¦ä¸²ç±»å‹å“ˆå¸Œç±»å‹åˆ—è¡¨ç±»å‹é›†åˆç±»å‹æœ‰åºé›†åˆç±»å‹æŸ¥ç¼ºè¡¥æ¼zrevankzrevrang","categories":[{"name":"Redis","slug":"Redis","permalink":"https://jigangduan.github.io/categories/Redis/"},{"name":"æ•°æ®åº“","slug":"Redis/æ•°æ®åº“","permalink":"https://jigangduan.github.io/categories/Redis/æ•°æ®åº“/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://jigangduan.github.io/tags/redis/"}]},{"title":"Rediså¼€å‘å’Œè¿ç»´ (1) - åˆè¯†","slug":"redis-devops-1","date":"2018-04-19T12:41:55.000Z","updated":"2020-07-25T02:57:18.227Z","comments":true,"path":"2018/04/19/redis-devops-1/","link":"","permalink":"https://jigangduan.github.io/2018/04/19/redis-devops-1/","excerpt":"","text":"å¯¼å­¦ç››èµRedis é«˜æ€§èƒ½ Key-ValueæœåŠ¡å™¨ æ”¯æŒå¤šç§æ•°æ®ç»“æ„ ä¸°å¯Œçš„åŠŸèƒ½ é«˜å¯ç”¨åˆ†å¸ƒå¼æ”¯æŒ ä»‹ç»Redisæ˜¯ä»€ä¹ˆ å¼€æº åŸºäºé”®å€¼çš„å­˜å‚¨æœåŠ¡ç³»ç»Ÿ å¤šç§æ•°æ®ç»“æ„ é«˜æ€§èƒ½ï¼ŒåŠŸèƒ½ä¸°å¯Œ Redisçš„å‰ä¸–ä»Šç”Ÿ ä½œè€…ï¼šSalvaore Sanfilippoï¼ˆantirezï¼‰ è„±èƒäºé¡¹ç›®LLOOGG.com æ”¯æŒçš„æ•°æ®ç»“æ„ï¼š Strings/Blobs/Bitmaps Hash Tables(objects) Linked Lists Sets Sorted Sets è°å†ä½¿ç”¨Redis? GitHub twitter stackoverflow Alibba Baidu å¾®åš â€¦ ç‰¹æ€§ é€Ÿåº¦å¿« 10w OPS æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ ä½¿ç”¨Cè¯­è¨€ å•çº¿ç¨‹ ç±»å‹ æ¯ç§’è¯»å†™æ¬¡æ•° éšæœºè¯»å†™å»¶è¿Ÿ è®¿é—®å¸¦å®½ å†…å­˜ åƒä¸‡çº§ 80ns 5GB SSDç›˜ 35000 1~0.2ms 100~300MB æœºæ¢°ç›˜ 100å·¦å³ 10ms 100MBå·¦å³ æŒä¹…æ€§ Redisæ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯¹æ•°æ®çš„æ›´æ–°å°†å¼‚æ­¥åœ°ä¿å­˜åˆ°ç£ç›˜ä¸­ å¤šç§æ•°æ®ç»“æ„ Strings/Blobs Hash Tables(objects) Linked Lists Sets Sorted Sets Bitmaps(ä½å›¾) HyperLogLogï¼ˆè¶…å°å†…å­˜å”¯ä¸€å€¼è®¡æ•°ï¼‰ GEO(åœ°ç†ä¿¡æ¯å®šä½) æ”¯æŒå¤šç§ç¼–è¾‘è¯­è¨€java php python ruby lua node â€¦ åŠŸèƒ½ä¸°å¯Œ å‘å¸ƒè®¢é˜… Lubè„šæœ¬ äº‹åŠ¡ pipeline ç®€å• 23,000è¡ŒCä»£ç  ä¸»ä»å¤åˆ¶ é«˜å¯ç”¨ï¼Œåˆ†å¸ƒå¼ é«˜å¯ç”¨ =&gt; Redis-Sentinel(v2.8)æ”¯æŒé«˜å¯ç”¨ åˆ†å¸ƒå¼ =&gt; Redis-Cluster(v3.0)æ”¯æŒåˆ†å¸ƒå¼ å…¸å‹åº”ç”¨åœºæ™¯ ç¼“å­˜ç³»ç»Ÿ è®¡æ•°å™¨ æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ æ’è¡Œæ¦œ ç¤¾äº¤ç½‘ç»œ å®æ—¶ç³»ç»Ÿ å®‰è£…å’Œé…ç½®å®‰è£… Linux 12345wget http://download.redis.io/releases/redis-3.0.7.tar.gztar -xzf redis-3.0.7.tar.gzln -s redis-3.0.7 rediscd redismake &amp;&amp; make install Rediså¯æ‰§è¡Œæ–‡ä»¶ï¼š redis-serer RedisæœåŠ¡å™¨ redis-cli Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯ redis-benchmark Redisæ€§èƒ½æµ‹è¯•å·¥å…· redis-check-aof AOFæ–‡ä»¶ä¿®å¤å·¥å…· redis-check-dump RDBæ–‡ä»¶ä¿®å¤å·¥å…· redis-sentinel SentinelæœåŠ¡å™¨(2.8ä»¥å) ä¸‰ç§å¯åŠ¨æ–¹å¼ï¼š æœ€ç®€å¯åŠ¨ 1redis-server é…ç½®æ–‡ä»¶å¯åŠ¨ 1redis-server --port 6380 åŠ¨æ€å‚æ•°å¯åŠ¨ 1redis-server configPath éªŒè¯ï¼š 123ps -ef | grep redisnetstat -antpl | grep redisredis-cli -h ip port ping ç”Ÿäº§ç¯å¢ƒé€‰æ‹©é…ç½®å¯åŠ¨ å•æœºå¤šå®ä¾‹é…ç½®æ–‡ä»¶å¯ä»¥ç”¨ç«¯å£åŒºåˆ†å¼€ Rediså®¢æˆ·ç«¯è¿æ¥ 1234567# redis-cli -h 10.10.79.150 -p 638410.10.79.150:6380&gt; pingPONG10.10.79.150:6380&gt; set hello worldOK10.10.79.150:6380&gt; get hello\"world\" å¸¸ç”¨é…ç½®ï¼š daemonize æ˜¯å¦æ˜¯å®ˆæŠ¤è¿›ç¨‹(no|yes) port å¯¹å¤–ç«¯å£(é»˜è®¤6379) logfile æ—¥å¿—å dir å·¥ä½œç›®å½•â€¦","categories":[{"name":"Redis","slug":"Redis","permalink":"https://jigangduan.github.io/categories/Redis/"},{"name":"æ•°æ®åº“","slug":"Redis/æ•°æ®åº“","permalink":"https://jigangduan.github.io/categories/Redis/æ•°æ®åº“/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://jigangduan.github.io/tags/redis/"}]},{"title":"WebAPPå‡çº§æ–¹æ¡ˆ(iOSç‰ˆ)","slug":"webapp-update-ios","date":"2018-04-19T03:33:51.000Z","updated":"2020-07-25T02:57:18.232Z","comments":true,"path":"2018/04/19/webapp-update-ios/","link":"","permalink":"https://jigangduan.github.io/2018/04/19/webapp-update-ios/","excerpt":"","text":"æœåŠ¡å™¨éƒ¨åˆ†æœåŠ¡ç«¯æä¾›: ç‰ˆæœ¬æ£€æµ‹æ¥å£e.g. http://192.168.11.1:3000/version H5+åŒ…ä¸‹è½½åœ°å€e.g. http://192.168.11.1:3000/download/HelloH5.wgtu H5+åŒ…å‘½åï¼š Supervisor.wgtuæ ¼å¼ï¼š package_name.wgtu H5+åŒ…ä½¿ç”¨zipå‹ç¼© JSéƒ¨åˆ†æ‰§è¡Œæ­¥éª¤: ç‰ˆæœ¬æ£€æµ‹ ä¸‹è½½wgtuåŒ… å®‰è£…wgtuåŒ… é‡å¯ ç‰ˆæœ¬æ£€æµ‹123456789101112131415161718192021222324252627282930313233343536function checkVersion() &#123; var wgtVer = null; plus.runtime.getProperty( plus.runtime.appid, function ( wgtinfo ) &#123; //versionå±æ€§ wgtVer = wgtinfo.version; outSet( wgtStr ); &#125; ); var url = \"http://192.168.11.1:3000/version\"; var xhr = new plus.net.XMLHttpRequest(); xhr.onreadystatechange = function () &#123; switch ( xhr.readyState ) &#123; case 4: if ( xhr.status == 200 ) &#123; outSet(\"æ£€æµ‹æ›´æ–° ç‰ˆæœ¬ï¼š\" + xhr.responseText); var newVer = xhr.responseText; if (wgtVer &amp;&amp; newVer &amp;&amp; (wgtVer != newVer)) &#123; outSet(\"æœ‰æ–°ç‰ˆæœ¬:ï¼Œå¯æ›´æ–°ï¼ï¼, æ—§ç‰ˆæœ¬:\"); alert(\"æœ‰æ–°ç‰ˆæœ¬:\" + newVer + \"ï¼Œå¯æ›´æ–°ï¼ï¼, æ—§ç‰ˆæœ¬:\" + wgtVer); &#125; else &#123; outSet(\"æ— æ–°ç‰ˆæœ¬å¯æ›´æ–°ï¼\"); alert(\"æ— æ–°ç‰ˆæœ¬å¯æ›´æ–°ï¼\"); &#125; &#125; else &#123; outSet(\"æ£€æµ‹æ›´æ–°å¤±è´¥ï¼\"); alert(\"æ£€æµ‹æ›´æ–°å¤±è´¥ï¼\"); &#125; break; default : break; &#125; &#125; xhr.open( \"GET\", url ); xhr.send();&#125; H5åŒ…å‡çº§1234567891011121314151617181920212223242526function updateApp()&#123; var url='http://192.168.11.1:3000/download/HelloH5.wgtu'; plus.nativeUI.showWaiting(\"å‡çº§ä¸­...\"); var dtask = plus.downloader.createDownload( url, &#123;method:\"GET\"&#125;, function(d,status)&#123; if ( status == 200 ) &#123; plus.console.log( \"Download wgtu success: \" + d.filename ); outSet( \"Download wgtu success: \" + d.filename ); plus.runtime.install(d.filename,&#123;&#125;,function()&#123; plus.nativeUI.closeWaiting(); plus.nativeUI.alert(\"Update wgtu success, restart now!\",function()&#123; plus.runtime.restart(); &#125;); &#125;,function(e)&#123; plus.nativeUI.closeWaiting(); alert(\"Update wgtu failed: \"+e.message); &#125;); &#125; else &#123; plus.nativeUI.closeWaiting(); alert( \"Download wgtu failed: \" + status ); &#125; &#125; ); dtask.addEventListener('statechanged',function(d,status)&#123; console.log(\"statechanged: \"+d.state); &#125;); dtask.start();&#125; iOSéƒ¨åˆ† H5åŒ…ä»Buildä½ç½®å‘æ²™ç›’ä½ç½®è¿ç§»ä¾èµ–plus.runtime.installå¯»æ‰¾è¿ç§»ä½ç½® åŠ¨æ€åŠ è½½H5+åŒ…","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"WebAPP","slug":"å‰ç«¯/WebAPP","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/WebAPP/"}],"tags":[{"name":"webapp","slug":"webapp","permalink":"https://jigangduan.github.io/tags/webapp/"}]},{"title":"micro-heartbeat","slug":"micro-heartbeat","date":"2018-03-24T13:36:35.000Z","updated":"2020-07-25T02:57:18.213Z","comments":true,"path":"2018/03/24/micro-heartbeat/","link":"","permalink":"https://jigangduan.github.io/2018/03/24/micro-heartbeat/","excerpt":"æ¼”ç¤ºæœåŠ¡å‘ç°ä½¿ç”¨å¿ƒè·³ã€‚","text":"æ¼”ç¤ºæœåŠ¡å‘ç°ä½¿ç”¨å¿ƒè·³ã€‚ ä¾æ®æœåŠ¡å‘ç°åœ¨å¯åŠ¨å’Œæ³¨é”€æ—¶æä¾›æœåŠ¡å‘ç°ã€‚æœ‰æ—¶ï¼Œè¿™äº›æœåŠ¡å¯èƒ½ä¼šæ„å¤–åœ°æ­»äº¡æˆ–è¢«å¼ºè¡Œæ€æ­»æˆ–é¢ä¸´æš‚æ—¶çš„ç½‘ç»œé—®é¢˜ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°†åœ¨æœåŠ¡å‘ç°ä¸­ä¿ç•™é™ˆæ—§çš„èŠ‚ç‚¹ã€‚å¦‚æœè‡ªåŠ¨åˆ é™¤æœåŠ¡ï¼Œé‚£å°†æ˜¯ç†æƒ³çš„ã€‚ è§£å†³æ–¹æ¡ˆMicroæ”¯æŒä¸€ä¸ªæ³¨å†Œå™¨TTLçš„é€‰é¡¹ï¼Œå¹¶ä¸ºè¿™ä¸ªç¡®åˆ‡çš„åŸå› æ³¨å†Œé—´éš”ã€‚TTLæŒ‡å®šä¸€ä¸ªæ³¨å†Œåœ¨å‘ç°ä¹‹ååº”è¯¥å­˜åœ¨å¤šé•¿æ—¶é—´ï¼Œå®ƒä¼šè¿‡æœŸå¹¶è¢«åˆ é™¤ã€‚é—´éš”æ˜¯æœåŠ¡é‡æ–°æ³¨å†Œä»¥ä¿å­˜å…¶åœ¨æœåŠ¡å‘ç°ä¸­çš„æ³¨å†Œçš„æ—¶é—´ã€‚ è¿™äº›é€‰é¡¹éƒ½å¯ä»¥åœ¨go-microå’Œmicro Toolkitä¸­ä½¿ç”¨ã€‚ Toolkitä½¿ç”¨åƒè¿™æ ·çš„æ ‡å¿—è¿è¡Œå·¥å…·ç®±ä¸­çš„ä»»ä½•ç»„ä»¶ 1micro --register_ttl=30 --register_interval=15 api è¿™ä¸ªç¤ºä¾‹æ˜¾ç¤ºï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ª30ç§’çš„ttlï¼Œé‡æ–°æ³¨å†Œé—´éš”ä¸º15ç§’ã€‚ Go Microåœ¨å®£å¸ƒmicroæœåŠ¡æ—¶ï¼Œæ‚¨å¯ä»¥å°†é€‰é¡¹ä½œä¸ºtime.Durationä¼ é€’ 12345service := micro.NewService( micro.Name(\"com.example.srv.foo\"), micro.RegisterTTL(time.Second*30), micro.RegisterInterval(time.Second*15),)","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"micro new [service]","slug":"micro-new","date":"2018-03-23T13:21:14.000Z","updated":"2020-07-25T02:57:18.213Z","comments":true,"path":"2018/03/23/micro-new/","link":"","permalink":"https://jigangduan.github.io/2018/03/23/micro-new/","excerpt":"micro newå‘½ä»¤æ˜¯ä¸ºmicroæœåŠ¡ç”Ÿæˆæ ·æ¿æ¨¡æ¿çš„å¿«æ·æ–¹å¼ã€‚","text":"micro newå‘½ä»¤æ˜¯ä¸ºmicroæœåŠ¡ç”Ÿæˆæ ·æ¿æ¨¡æ¿çš„å¿«æ·æ–¹å¼ã€‚ ä½¿ç”¨é€šè¿‡æŒ‡å®šç›¸å¯¹äº$GOPATHçš„ç›®å½•è·¯å¾„æ¥åˆ›å»ºæ–°æœåŠ¡ã€‚ 1micro new github.com/micro/foo å°†è¿è¡Œï¼š 1234567891011121314151617181920212223micro new github.com/micro/foocreating service go.micro.srv.foocreating /Users/asim/checkouts/src/github.com/micro/foocreating /Users/asim/checkouts/src/github.com/micro/foo/main.gocreating /Users/asim/checkouts/src/github.com/micro/foo/handlercreating /Users/asim/checkouts/src/github.com/micro/foo/handler/example.gocreating /Users/asim/checkouts/src/github.com/micro/foo/subscribercreating /Users/asim/checkouts/src/github.com/micro/foo/subscriber/example.gocreating /Users/asim/checkouts/src/github.com/micro/foo/proto/examplecreating /Users/asim/checkouts/src/github.com/micro/foo/proto/example/example.protocreating /Users/asim/checkouts/src/github.com/micro/foo/Dockerfilecreating /Users/asim/checkouts/src/github.com/micro/foo/README.mddownload protobuf for micro:go get github.com/micro/protobuf/&#123;proto,protoc-gen-go&#125;compile the proto file example.proto:protoc -I/Users/asim/checkouts/src \\ --go_out=plugins=micro:/Users/asim/checkouts/src \\ /Users/asim/checkouts/src/github.com/micro/foo/proto/example/example.proto é€‰é¡¹æŒ‡å®šæ›´å¤šçš„é€‰é¡¹ï¼Œå¦‚åç§°ç©ºé—´ã€ç±»å‹ã€fqdnå’Œåˆ«å 1micro new --fqdn com.example.srv.foo github.com/micro/foo å¸®åŠ©1234567891011NAME: micro new - Create a new micro serviceUSAGE: micro new [command options] [arguments...]OPTIONS: --namespace \"go.micro\" Namespace for the service e.g com.example --type \"srv\" Type of service e.g api, srv, web --fqdn FQDN of service e.g com.example.srv.service (defaults to namespace.type.alias) --alias Alias is the short name used as part of combined name if specified","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"micro web","slug":"micro-web","date":"2018-03-21T23:09:09.000Z","updated":"2020-07-25T02:57:18.214Z","comments":true,"path":"2018/03/22/micro-web/","link":"","permalink":"https://jigangduan.github.io/2018/03/22/micro-web/","excerpt":"micro webæä¾›äº†æŸ¥çœ‹å’ŒæŸ¥è¯¢æœåŠ¡çš„ä»ªè¡¨æ¿ã€‚","text":"micro webæä¾›äº†æŸ¥çœ‹å’ŒæŸ¥è¯¢æœåŠ¡çš„ä»ªè¡¨æ¿ã€‚ å…¥é—¨æŒ‡å—å®‰è£…1go get -u github.com/micro/micro è¿è¡Œ1micro web ACMEé»˜è®¤ä½¿ç”¨ACMEå®‰å…¨æœåŠ¡ 1MICRO_ENABLE_ACME=true micro web å¯ä»¥é€‰æ‹©æŒ‡å®šä¸€ä¸ªä¸»æœºç™½åå• 123MICRO_ENABLE_ACME=true \\MICRO_ACME_HOSTS=example.com,api.example.com \\micro web TLSè¯ä¹¦APIæ”¯æŒå®‰å…¨åœ°ä½¿ç”¨TLSè¯ä¹¦ 1234MICRO_ENABLE_TLS=true \\MICRO_TLS_CERT_FILE=/path/to/cert \\MICRO_TLS_KEY_FILE=/path/to/key \\micro web æˆªå›¾","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"micro api","slug":"micro-api","date":"2018-03-20T12:57:18.000Z","updated":"2020-07-25T02:57:18.212Z","comments":true,"path":"2018/03/20/micro-api/","link":"","permalink":"https://jigangduan.github.io/2018/03/20/micro-api/","excerpt":"micro apiæ˜¯å¾®æœåŠ¡çš„apiç½‘å…³ã€‚ä½¿ç”¨APIç½‘å…³æ¨¡å¼ä¸ºæ‚¨çš„æœåŠ¡æä¾›ä¸€ä¸ªå•ä¸€å…¥å£ç‚¹ã€‚micro apiä½¿ç”¨æœåŠ¡å‘ç°æœåŠ¡HTTPå’ŒåŠ¨æ€è·¯ç”±åˆ°é€‚å½“çš„åç«¯ã€‚","text":"micro apiæ˜¯å¾®æœåŠ¡çš„apiç½‘å…³ã€‚ä½¿ç”¨APIç½‘å…³æ¨¡å¼ä¸ºæ‚¨çš„æœåŠ¡æä¾›ä¸€ä¸ªå•ä¸€å…¥å£ç‚¹ã€‚micro apiä½¿ç”¨æœåŠ¡å‘ç°æœåŠ¡HTTPå’ŒåŠ¨æ€è·¯ç”±åˆ°é€‚å½“çš„åç«¯ã€‚ æ¦‚è¿°micro apiæ˜¯ä¸€ä¸ªHTTP apiã€‚å¯¹APIçš„è¯·æ±‚é€šè¿‡HTTPæä¾›ï¼Œå¹¶é€šè¿‡RPCåœ¨å†…éƒ¨è·¯ç”±ã€‚å®ƒå»ºç«‹åœ¨go-microçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨å®ƒè¿›è¡ŒæœåŠ¡å‘ç°ã€è´Ÿè½½å¹³è¡¡ã€ç¼–ç å’ŒåŸºäºRPCçš„é€šä¿¡ã€‚ å› ä¸ºmicro apiåœ¨å†…éƒ¨ä½¿ç”¨äº†microï¼Œè¿™ä¹Ÿä½¿å¾—å®ƒæˆä¸ºå¯æ’æ‹”çš„ã€‚å‚è§go-pluginsæ”¯æŒgRPCã€kubernetesã€etcdã€natsã€rabbitmqç­‰ã€‚ å…¥é—¨æŒ‡å—å®‰è£…1go get -u github.com/micro/micro è¿è¡Œ1micro api ACMEé»˜è®¤ä½¿ç”¨ACMEå®‰å…¨æœåŠ¡ 1MICRO_ENABLE_ACME=true micro api å¯ä»¥é€‰æ‹©æŒ‡å®šä¸€ä¸ªä¸»æœºç™½åå• 123MICRO_ENABLE_ACME=true \\MICRO_ACME_HOSTS=example.com,api.example.com \\micro api TLSè¯ä¹¦APIæ”¯æŒå®‰å…¨åœ°ä½¿ç”¨TLSè¯ä¹¦ 1234MICRO_ENABLE_TLS=true \\MICRO_TLS_CERT_FILE=/path/to/cert \\MICRO_TLS_KEY_FILE=/path/to/key \\micro api è®¾ç½®åç§°ç©ºé—´APIåˆ©ç”¨åç§°ç©ºé—´æ¥é€»è¾‘åœ°åˆ†ç¦»åç«¯å’Œé¢å‘å…¬ä¼—çš„æœåŠ¡ã€‚åç§°ç©ºé—´å’Œhttpè·¯å¾„ç”¨äºè§£ææœåŠ¡name/methodã€‚é»˜è®¤çš„åç§°ç©ºé—´æ˜¯go.micro.apiã€‚ 1MICRO_NAMESPACE=com.example.api micro api ä¾‹å­è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ª3å±‚æ¶æ„çš„ä¾‹å­ micro api: (localhost:8080) - ä½œä¸ºhttpå…¥å£ç‚¹ã€‚ apiæœåŠ¡:æä¾›é¢å‘å…¬ä¼—çš„apiæœåŠ¡ã€‚ åç«¯æœåŠ¡:(go.micro.srv.greeter) - å†…éƒ¨èŒƒå›´æœåŠ¡ã€‚ å®Œæ•´çš„ä¾‹å­æ˜¯examples/greeter è¿è¡Œç¤ºä¾‹ ç¡®ä¿æ‚¨æ­£åœ¨è¿è¡ŒæœåŠ¡å‘ç° e.g consul agent -dev å¾—åˆ°ä¾‹å­ 1git clone https://github.com/micro/examples å¯åŠ¨è¯¥æœåŠ¡ 1go run examples/greeter/srv/main.go å¯åŠ¨API 1go run examples/greeter/api/api.go å¯åŠ¨ micro api 1micro api æŸ¥è¯¢é€šè¿‡micro apiè¿›è¡ŒHTTPè°ƒç”¨ 1curl \"http://localhost:8080/greeter/say/hello?name=John\" HTTPè·¯å¾„/greeter/say/helloæ˜ å°„åˆ°æœåŠ¡go.micro.api.greeter Say.Helloæ–¹æ³• ç»•è¿‡apiæœåŠ¡ï¼Œç›´æ¥é€šè¿‡/rpcè°ƒç”¨å 1234curl -d 'service=go.micro.srv.greeter' \\ -d 'method=Say.Hello' \\ -d 'request=&#123;\"name\": \"John\"&#125;' \\ http://localhost:8080/rpc å®Œå…¨ç›¸åŒåœ°è°ƒç”¨JSON 123curl -H 'Content-Type: application/json' \\ -d '&#123;\"service\": \"go.micro.srv.greeter\", \"method\": \"Say.Hello\", \"request\": &#123;\"name\": \"John\"&#125;&#125;' \\ http://localhost:8080/rpc APImicro apiæä¾›äº†ä»¥ä¸‹HTTP api 12- /[service]/[method] # HTTPè·¯å¾„è¢«åŠ¨æ€æ˜ å°„åˆ°æœåŠ¡- /rpc # é€šè¿‡åç§°å’Œæ–¹æ³•æ˜¾å¼åœ°è°ƒç”¨åç«¯æœåŠ¡ å‚è§ä¸‹é¢çš„ä¾‹å­ HandlersHandlersæ˜¯ç®¡ç†è¯·æ±‚è·¯ç”±çš„HTTPå¤„ç†ç¨‹åºã€‚ é»˜è®¤handlerä½¿ç”¨æ³¨å†Œä¸­å¿ƒçš„ç«¯ç‚¹å…ƒæ•°æ®æ¥ç¡®å®šæœåŠ¡è·¯ç”±ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è·¯ç”±ï¼Œå®ƒå°†è¿”å›åˆ°API handlerã€‚æ‚¨å¯ä»¥ä½¿ç”¨go-apié…ç½®æ³¨å†Œè·¯ç”±ã€‚ APIå…·æœ‰ä»¥ä¸‹å¯é…ç½®çš„è¯·æ±‚handler api -å¤„ç†ä»»ä½•HTTPè¯·æ±‚ã€‚é€šè¿‡RPCå®Œå…¨æ§åˆ¶httpè¯·æ±‚/å“åº”ã€‚ event-å¤„ç†ä»»ä½•HTTPè¯·æ±‚å¹¶å‘å¸ƒåˆ°æ¶ˆæ¯æ€»çº¿ã€‚ http -å¤„ç†ä»»ä½•httpè¯·æ±‚å’Œè½¬å‘ä½œä¸ºåå‘ä»£ç†ã€‚ rpc -å¤„ç†jsonå’Œprotobuf POSTè¯·æ±‚ã€‚å‘å‰ RPCã€‚ web -åŒ…å«webå¥—æ¥å­—æ”¯æŒçš„HTTP handlerã€‚ å¯ä»¥é€‰æ‹©ä½¿ç”¨/rpcç«¯ç‚¹ç»•è¿‡handlers API Handler Content-Type: Any Body: Any Forward Format: api.Request/api.Response è·¯å¾„: /[service]/[method] è§£æå™¨:è·¯å¾„ç”¨äºè§£ææœåŠ¡å’Œæ–¹æ³•ã€‚ Configure: Flag --handler=apiæˆ–MICRO_API_HANDLER=apiã€‚ æ²¡æœ‰æŒ‡å®šhandleræ—¶çš„é»˜è®¤handlerã€‚ Event Handleräº‹ä»¶handleræœåŠ¡äºHTTPï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™ä½¿ç”¨go-microä»£ç†çš„æ¶ˆæ¯æ€»çº¿ä¸Šçš„æ¶ˆæ¯ã€‚ Content-Type: Any Body: Any Forward Format:è¯·æ±‚è¢«æ ¼å¼åŒ–ä¸ºgo-api/proto.Event Path: /[topic]/[event] è§£æå™¨:è·¯å¾„ç”¨äºè§£æä¸»é¢˜å’Œäº‹ä»¶åç§°ã€‚ Configure: Flag --handler=eventæˆ– MICRO_API_HANDLER=event HTTP Handlerhttp handleræ˜¯ä¸€ä¸ªåŸºäºæœåŠ¡å‘ç°çš„httpå¤‡ç”¨ä»£ç†ã€‚ Content-Type: Any Body: Any Forward Format: HTTPåå‘ä»£ç† Path: /[service] è§£æå™¨:è·¯å¾„ç”¨äºè§£ææœåŠ¡åç§° é…ç½®:Flag â€”handler=httpæˆ–MICRO_API_HANDLER=http RESTå¯ä»¥ä½œä¸ºå¾®æœåŠ¡åœ¨APIåé¢å®ç° RPC HandlerRPC handlerä»¥RPCè¯·æ±‚çš„å½¢å¼æä¾›jsonæˆ–protobuf HTTP POSTè¯·æ±‚å’Œè½¬å‘ã€‚ Content-Type: application/json æˆ– application/protobuf Body: JSON æˆ– Protobuf æ­£å‘æ ¼å¼:åŸºäºå†…å®¹çš„json-rpcæˆ–proto-rpcã€‚ Path: / [service] / [method] è§£æå™¨:è·¯å¾„ç”¨äºè§£ææœåŠ¡å’Œæ–¹æ³•ã€‚ é…ç½®:Flag â€”handler=rpcæˆ–MICRO_API_HANDLER=rpc Web Handlerweb handleræ˜¯ä¸€ä¸ªåŸºäºæœåŠ¡å‘ç°å’Œweb socketæ”¯æŒçš„httpåå‘ä»£ç†ã€‚ Content-Type: Any Body: Any æ­£å‘æ ¼å¼:HTTPåå‘ä»£ç†ï¼ŒåŒ…æ‹¬web socketsã€‚ Path: /[service] è§£æå™¨:è·¯å¾„ç”¨äºè§£ææœåŠ¡åç§°ã€‚ é…ç½®:Flag â€”handler=web æˆ– MICRO_API_HANDLER=web RPCç«¯ç‚¹/rpcç«¯ç‚¹è®©æˆ‘ä»¬ç»•è¿‡ä¸»handlerç›´æ¥ä¸ä»»ä½•æœåŠ¡å¯¹è¯ è¯·æ±‚å‚æ•° service - è®¾ç½®æœåŠ¡åç§° method - è®¾ç½®æœåŠ¡æ–¹æ³• request - è¯·æ±‚ä½“ address - å¯é€‰åœ°æŒ‡å®šä¸»æœºåœ°å€åˆ°ç›®æ ‡ ç¤ºä¾‹è°ƒç”¨: 1234curl -d 'service=go.micro.srv.greeter' \\ -d 'method=Say.Hello' \\ -d 'request=&#123;\"name\": \"Bob\"&#125;' \\ http://localhost:8080/rpc åœ¨github.com/micro/examples/apiæ‰¾åˆ°å·¥ä½œçš„ä¾‹å­ è§£æå™¨ä½¿ç”¨åç§°ç©ºé—´å€¼å’ŒHTTPè·¯å¾„åˆ°æœåŠ¡çš„MicroåŠ¨æ€è·¯ç”±ã€‚ é»˜è®¤çš„åç§°ç©ºé—´æ˜¯go.micro.apiã€‚é€šè¿‡--namespaceæˆ–MICRO_NAMESPACE=è®¾ç½®åç§°ç©ºé—´ ä½¿ç”¨çš„è§£æå™¨å¦‚ä¸‹æ‰€ç¤ºã€‚ RPCè§£æå™¨RPCæœåŠ¡æœ‰ä¸€ä¸ªåç§°(go.micro.api.greeter)å’Œä¸€ä¸ªæ–¹æ³•(Greeter.Hello)ã€‚ URLsçš„è§£æå¦‚ä¸‹: Path Service Method /foo/bar go.micro.api.foo Foo.Bar /foo/bar/baz go.micro.api.foo Bar.Baz /foo/bar/baz/cat go.micro.api.foo.bar Baz.Cat å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†ç‰ˆæœ¬åŒ–çš„API URLsæ˜ å°„åˆ°æœåŠ¡åç§°: Path Service Method /foo/bar go.micro.api.foo Foo.Bar /v1/foo/bar go.micro.api.v1.foo Foo.Bar /v1/foo/bar/baz go.micro.api.v1.foo Bar.Baz /v2/foo/bar go.micro.api.v2.foo Foo.Bar /v2/foo/bar/baz go.micro.api.v2.foo Bar.Baz HTTPè§£æå™¨å¯¹äºhttp handlerï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç†æœåŠ¡åç§°çš„è§£æã€‚æ‰€ä»¥åˆ†è¾¨ç‡ä¸RPCè§£æå™¨ç•¥æœ‰ä¸åŒã€‚ URLsçš„è§£æå¦‚ä¸‹: Path Service Service Path /foo go.micro.api.foo /foo /foo/bar go.micro.api.foo /foo/bar /greeter go.micro.api.greeter /greeter /greeter/:name go.micro.api.greeter /greeter/:name Go Restful APIçš„ä¾‹å­è¿™é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨go-restfulåœ¨APIåé¢æœåŠ¡RESTçš„ä¸€ä¸ªç¤ºä¾‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package mainimport ( \"log\" \"github.com/emicklei/go-restful\" hello \"github.com/micro/examples/greeter/srv/proto/hello\" \"github.com/micro/go-micro/client\" \"github.com/micro/go-web\" \"context\")type Say struct&#123;&#125;var ( cl hello.SayClient)func (s *Say) Anything(req *restful.Request, rsp *restful.Response) &#123; log.Print(\"Received Say.Anything API request\") rsp.WriteEntity(map[string]string&#123; \"message\": \"Hi, this is the Greeter API\", &#125;)&#125;func (s *Say) Hello(req *restful.Request, rsp *restful.Response) &#123; log.Print(\"Received Say.Hello API request\") name := req.PathParameter(\"name\") response, err := cl.Hello(context.TODO(), &amp;hello.Request&#123; Name: name, &#125;) if err != nil &#123; rsp.WriteError(500, err) &#125; rsp.WriteEntity(response)&#125;func main() &#123; // Create service service := web.NewService( web.Name(\"go.micro.api.greeter\"), ) service.Init() // setup Greeter Server Client cl = hello.NewSayClient(\"go.micro.srv.greeter\", client.DefaultClient) // Create RESTful handler say := new(Say) ws := new(restful.WebService) wc := restful.NewContainer() ws.Consumes(restful.MIME_XML, restful.MIME_JSON) ws.Produces(restful.MIME_JSON, restful.MIME_XML) ws.Path(\"/greeter\") ws.Route(ws.GET(\"/\").To(say.Anything)) ws.Route(ws.GET(\"/&#123;name&#125;\").To(say.Hello)) wc.Add(ws) // Register Handler service.Handle(\"/\", wc) // Run server if err := service.Run(); err != nil &#123; log.Fatal(err) &#125;&#125; è¿è¡Œ Micro API1$ micro api --handler=proxy è¿è¡Œ Greeter Service1$ go run greeter/server/main.go è¿è¡Œ Greeter API12$ go run go-restful.goListening on [::]:64738 Curl APIæµ‹è¯•index 1234curl http://localhost:8080/greeter&#123; \"message\": \"Hi, this is the Greeter API\"&#125; æµ‹è¯•èµ„æº 1234curl http://localhost:8080/greeter/asim&#123; \"msg\": \"Hello asim\"&#125;","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"ç”¨Microæ„å»ºæœ‰å¼¹æ€§å’Œå®¹é”™çš„åº”ç”¨ç¨‹åº","slug":"micro-resiliency","date":"2018-03-18T15:44:26.000Z","updated":"2020-07-25T02:57:18.214Z","comments":true,"path":"2018/03/18/micro-resiliency/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/micro-resiliency/","excerpt":"æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ï¼Œè¿™å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»è§£å†³äº†å¾ˆå¤šé—®é¢˜ï¼Œä½œä¸ºä¸€ä¸ªè¡Œä¸šï¼Œæˆ‘ä»¬ä»ç„¶ç»å†äº†é‡å»ºè®¸å¤šå»ºç­‘è¡—åŒºçš„å‘¨æœŸã€‚æ˜¯å¦å› ä¸ºè¿ç§»åˆ°ä¸‹ä¸€ä¸ªæŠ½è±¡çº§åˆ«ï¼Œè™šæ‹Ÿæœºåˆ°å®¹å™¨ï¼Œé‡‡ç”¨æ–°çš„è¯­è¨€ï¼Œåˆ©ç”¨åŸºäºäº‘çš„æœåŠ¡ï¼Œç”šè‡³æ˜¯è¿™ç§å‘å¾®æœåŠ¡çš„è½¬å˜ã€‚æ€»æœ‰ä¸€äº›ä¸œè¥¿ä¼¼ä¹éœ€è¦æˆ‘ä»¬é‡æ–°å­¦ä¹ å¦‚ä½•ä¸ºä¸‹ä¸€æ³¢æŠ€æœ¯æ„å»ºæ€§èƒ½å’Œå®¹é”™ç³»ç»Ÿã€‚ è¿™æ˜¯ä¸€æ¬¡è¿­ä»£å’Œåˆ›æ–°ä¹‹é—´çš„æ— ä¼‘æ­¢çš„æˆ˜æ–—ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…æ¥å¸®åŠ©å‡è½»å¾ˆå¤šç—›è‹¦ï¼Œå› ä¸ºå‘äº‘ã€å®¹å™¨å’Œå¾®æœåŠ¡çš„è½¬ç§»ä»åœ¨ç»§ç»­ã€‚","text":"æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ï¼Œè¿™å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»è§£å†³äº†å¾ˆå¤šé—®é¢˜ï¼Œä½œä¸ºä¸€ä¸ªè¡Œä¸šï¼Œæˆ‘ä»¬ä»ç„¶ç»å†äº†é‡å»ºè®¸å¤šå»ºç­‘è¡—åŒºçš„å‘¨æœŸã€‚æ˜¯å¦å› ä¸ºè¿ç§»åˆ°ä¸‹ä¸€ä¸ªæŠ½è±¡çº§åˆ«ï¼Œè™šæ‹Ÿæœºåˆ°å®¹å™¨ï¼Œé‡‡ç”¨æ–°çš„è¯­è¨€ï¼Œåˆ©ç”¨åŸºäºäº‘çš„æœåŠ¡ï¼Œç”šè‡³æ˜¯è¿™ç§å‘å¾®æœåŠ¡çš„è½¬å˜ã€‚æ€»æœ‰ä¸€äº›ä¸œè¥¿ä¼¼ä¹éœ€è¦æˆ‘ä»¬é‡æ–°å­¦ä¹ å¦‚ä½•ä¸ºä¸‹ä¸€æ³¢æŠ€æœ¯æ„å»ºæ€§èƒ½å’Œå®¹é”™ç³»ç»Ÿã€‚ è¿™æ˜¯ä¸€æ¬¡è¿­ä»£å’Œåˆ›æ–°ä¹‹é—´çš„æ— ä¼‘æ­¢çš„æˆ˜æ–—ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…æ¥å¸®åŠ©å‡è½»å¾ˆå¤šç—›è‹¦ï¼Œå› ä¸ºå‘äº‘ã€å®¹å™¨å’Œå¾®æœåŠ¡çš„è½¬ç§»ä»åœ¨ç»§ç»­ã€‚ åŠ¨æœºæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš?ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¸æ–­åœ°é‡å»ºæ„å»ºå—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç»§ç»­å°è¯•è§£å†³ç›¸åŒçš„è§„æ¨¡ã€å®¹é”™å’Œåˆ†å¸ƒå¼ç³»ç»Ÿé—®é¢˜? â€œæ›´å¤§ã€æ›´å¼ºã€æ›´å¿«â€ï¼Œç”šè‡³å¯èƒ½æ˜¯â€œé€Ÿåº¦ã€è§„æ¨¡ã€æ•æ·â€ã€‚ä½ ä¼šä»cçº§é«˜ç®¡é‚£é‡Œå¬åˆ°å¾ˆå¤šï¼Œä½†å…³é”®çš„ç»“è®ºæ˜¯ï¼Œæˆ‘ä»¬æ€»æ˜¯éœ€è¦å»ºç«‹æ›´å¤šçš„ä¸šç»©å’Œå¼¹æ€§ç³»ç»Ÿã€‚ åœ¨äº’è”ç½‘çš„æ—©æœŸï¼Œåªæœ‰æˆåƒä¸Šä¸‡çš„äººä¸Šç½‘ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†åŠ é€Ÿï¼Œæˆ‘ä»¬ç°åœ¨è¿›å…¥äº†æ•°åäº¿çš„æ•°é‡çº§ã€‚æ•°åäº¿äººï¼Œæ•°åäº¿çš„è®¾å¤‡ã€‚æˆ‘ä»¬å¿…é¡»å­¦ä¹ å¦‚ä½•å»ºç«‹è¿™æ ·çš„ç³»ç»Ÿã€‚ å¯¹äºè€ä¸€ä»£ï¼Œä½ å¯èƒ½è¿˜è®°å¾—C10Ké—®é¢˜ã€‚æˆ‘ä¸ç¡®å®šæˆ‘ä»¬ç°åœ¨åœ¨å“ªé‡Œï¼Œä½†æˆ‘è®¤ä¸ºæˆ‘ä»¬è®¨è®ºçš„æ˜¯è§£å†³æ•°ç™¾ä¸‡å¹¶å‘è¿æ¥çš„é—®é¢˜ï¼Œå¦‚æœä¸æ˜¯æ›´å¤šçš„è¯ã€‚ä¸–ç•Œä¸Šæœ€å¤§çš„ç§‘æŠ€å…¬å¸åœ¨åå¹´å‰å°±çœŸæ­£è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”åœ¨è§„æ¨¡ä¸Šæœ‰äº†æ„å»ºç³»ç»Ÿçš„æ¨¡å¼ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶ä½™çš„äººä»ç„¶åœ¨å­¦ä¹ ã€‚ äºšé©¬é€Š(Amazon)ã€è°·æ­Œå’Œå¾®è½¯(Microsoft)ç­‰å…¬å¸ç°åœ¨ä¸ºæˆ‘ä»¬æä¾›äº†å¤§è§„æ¨¡çš„äº‘è®¡ç®—å¹³å°ï¼Œä½†æˆ‘ä»¬ä»åœ¨åŠªåŠ›ç ”ç©¶å¦‚ä½•ç¼–å†™èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨å®ƒçš„åº”ç”¨ç¨‹åºã€‚æ‚¨ç°åœ¨å¬åˆ°çš„æœ¯è¯­æ˜¯å®¹å™¨ç¼–æ’ã€å¾®æœåŠ¡å’Œäº‘æœ¬åœ°ã€‚è¿™é¡¹å·¥ä½œæ­£åœ¨è¿›è¡Œä¸­ï¼Œå°†ä¼šæœ‰ä¸€æ®µæ—¶é—´ï¼Œåœ¨æˆ‘ä»¬ä½œä¸ºä¸€ä¸ªè¡Œä¸šçœŸæ­£æ•²å®šéœ€è¦å‘å‰å‘å±•çš„æ¨¡å¼å’Œè§£å†³æ–¹æ¡ˆä¹‹å‰ã€‚ è®¸å¤šå…¬å¸ç°åœ¨éƒ½åœ¨å¸®åŠ©è§£å†³â€œå¦‚ä½•ä»¥å¯æ‰©å±•å’Œå®¹é”™çš„æ–¹å¼è¿è¡Œæˆ‘çš„åº”ç”¨ç¨‹åºâ€çš„é—®é¢˜ã€‚â€,ä½†ä»ç„¶æœ‰å¾ˆå°‘çš„å¸®åŠ©æ›´ä¸ºé‡è¦çš„é—®é¢˜â€¦ å¦‚ä½•ä»¥å¯ä¼¸ç¼©å’Œå®¹é”™çš„æ–¹å¼ç¼–å†™åº”ç”¨ç¨‹åº? é€šè¿‡å…³æ³¨å¾®æœåŠ¡çš„å…³é”®è½¯ä»¶å¼€å‘éœ€æ±‚æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›å¯ä»¥å¸®åŠ©æ‚¨æ„å»ºå¼¹æ€§å’Œå®¹é”™åº”ç”¨ç¨‹åºçš„æ–¹æ³•ï¼Œä»å®¢æˆ·ç«¯å¼€å§‹ã€‚ Clientå®¢æˆ·ç«¯æ˜¯åœ¨go-microä¸­æå‡ºè¯·æ±‚çš„æ„å»ºå—ã€‚å¦‚æœæ‚¨ä¹‹å‰å·²ç»æ„å»ºäº†å¾®æœåŠ¡æˆ–SOAæ¶æ„ï¼Œé‚£ä¹ˆæ‚¨å°±ä¼šçŸ¥é“ï¼Œå¤§éƒ¨åˆ†æ—¶é—´å’Œæ‰§è¡Œéƒ½èŠ±è´¹åœ¨è°ƒç”¨å…¶ä»–æœåŠ¡æ¥è·å–ç›¸å…³ä¿¡æ¯ä¸Šã€‚ è€Œåœ¨ä¸€ä¸ªå•ä¸€çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¸»è¦å…³æ³¨çš„æ˜¯æœåŠ¡å†…å®¹ï¼Œåœ¨ä¸€ä¸ªå¾®æœåŠ¡çš„ä¸–ç•Œä¸­ï¼Œå®ƒæ›´å¤šçš„æ˜¯æ£€ç´¢æˆ–å‘å¸ƒå†…å®¹ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªç²¾ç®€ç‰ˆçš„go-microå®¢æˆ·ç«¯æ¥å£ï¼Œæœ‰ä¸‰ä¸ªæœ€é‡è¦çš„æ–¹æ³•; Call, Publishå’ŒStreamã€‚ 12345678910111213type Client interface &#123; Call(ctx context.Context, req Request, rsp interface&#123;&#125;, opts ...CallOption) error Publish(ctx context.Context, p Publication, opts ...PublishOption) error Stream(ctx context.Context, req Request, opts ...CallOption) (Streamer, error)&#125;type Request interface &#123; Service() string Method() string ContentType() string Request() interface&#123;&#125; Stream() bool&#125; Callå’ŒStreamç”¨äºåŒæ­¥è¯·æ±‚ã€‚Callè¿”å›ä¸€ä¸ªå•ç‹¬çš„ç»“æœï¼Œè€ŒStreamåˆ™æ˜¯ä¸å¦ä¸€ä¸ªæœåŠ¡ä¿æŒçš„åŒå‘æµè¿æ¥ï¼Œå¯ä»¥æ¥å›å‘é€æ¶ˆæ¯ã€‚å‘å¸ƒç”¨äºé€šè¿‡ä»£ç†å‘å¸ƒå¼‚æ­¥æ¶ˆæ¯ï¼Œä½†æˆ‘ä»¬ä»Šå¤©ä¸æ‰“ç®—è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ å®¢æˆ·ç«¯æ˜¯å¦‚ä½•åœ¨å¹•åå·¥ä½œçš„ï¼Œåœ¨å‰å‡ ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå’Œè¿™é‡Œæ‰¾åˆ°ã€‚å¦‚æœä½ æƒ³äº†è§£ç»†èŠ‚ï¼Œå¯ä»¥å»çœ‹çœ‹ã€‚ æˆ‘ä»¬å°†ç®€è¦åœ°ä»‹ç»ä¸€äº›é‡è¦çš„å†…éƒ¨ç»†èŠ‚ã€‚ å®¢æˆ·ç«¯å¤„ç†RPCå±‚ï¼ŒåŒæ—¶åˆ©ç”¨ä»£ç†ã€ç¼–è§£ç å™¨ã€æ³¨å†Œè¡¨ã€é€‰æ‹©å™¨å’Œä¼ è¾“åŒ…è¿›è¡Œå„ç§åŠŸèƒ½ã€‚åˆ†å±‚æ¶æ„å¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬åˆ†ç¦»äº†æ¯ä¸ªç»„ä»¶çš„å…³æ³¨ç‚¹ï¼Œé™ä½äº†å¤æ‚æ€§å¹¶æä¾›äº†å¯æ’æ‹”æ€§ã€‚ ä¸ºä»€ä¹ˆClientå¾ˆé‡è¦?å®¢æˆ·ç«¯æœ¬è´¨ä¸Šæ˜¯æŠ½è±¡äº†æä¾›æœåŠ¡ä¹‹é—´çš„å¼¹æ€§å’Œå®¹é”™é€šä¿¡çš„ç»†èŠ‚ã€‚callç»™å¦ä¸€ä¸ªæœåŠ¡ä¼¼ä¹æ˜¯ç›¸å½“ç›´æ¥çš„ï¼Œä½†æœ‰å¯èƒ½ä¼šå¤±è´¥çš„å„ç§æ–¹æ³•ã€‚ è®©æˆ‘ä»¬å¼€å§‹äº†è§£å…¶ä¸­çš„ä¸€äº›åŠŸèƒ½ä»¥åŠå®ƒçš„å¸®åŠ©ã€‚ æœåŠ¡å‘ç°åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡çš„å®ä¾‹å¯ä»¥æ ¹æ®å„ç§åŸå› æ¥è¿›è¡Œã€‚ç½‘ç»œåˆ†åŒºï¼Œæœºå™¨æ•…éšœï¼Œé‡æ–°è°ƒåº¦ç­‰ç­‰ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯çœŸçš„æƒ³è¦å…³å¿ƒå®ƒã€‚ åœ¨å¯¹å¦ä¸€ä¸ªæœåŠ¡è¿›è¡Œè°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬æŒ‰åç§°è¿›è¡Œæ“ä½œï¼Œå¹¶å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨æœåŠ¡å‘ç°æ¥å°†åç§°è§£æä¸ºåŒ…å«å…¶åœ°å€å’Œç«¯å£çš„å®ä¾‹åˆ—è¡¨ã€‚åœ¨å…³é—­çš„å¯åŠ¨å’Œæ³¨é”€ä¸Šæœ‰å‘ç°çš„æœåŠ¡æ³¨å†Œã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€æåˆ°çš„ï¼Œä»»ä½•æ•°é‡çš„é—®é¢˜éƒ½å¯èƒ½å‡ºç°åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å‘ç°ä¹Ÿä¸ä¾‹å¤–ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¾é ä½œæˆ˜æµ‹è¯•åˆ†å¸ƒå¼æœåŠ¡å‘ç°ç³»ç»Ÿï¼Œå¦‚consulã€etcdå’Œzookeeperæ¥å­˜å‚¨æœ‰å…³æœåŠ¡çš„ä¿¡æ¯ã€‚ æ¯ä¸€ç§æ–¹æ³•éƒ½ä½¿ç”¨Paxosç½‘ç»œä¸€è‡´æ€§ç®—æ³•ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»CAPå®šç†å¾—åˆ°ä¸€è‡´æ€§å’Œåˆ†åŒºçš„å®¹å¿åº¦ã€‚é€šè¿‡è¿è¡Œä¸€ä¸ª3æˆ–5ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿å¤§å¤šæ•°ç³»ç»Ÿæ•…éšœï¼Œå¹¶ä¸ºå®¢æˆ·æœºæä¾›å¯é çš„æœåŠ¡å‘ç°ã€‚ èŠ‚ç‚¹é€‰æ‹©å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¯é åœ°å°†æœåŠ¡åç§°è§£æä¸ºåœ°å€åˆ—è¡¨ã€‚æˆ‘ä»¬å¦‚ä½•é€‰æ‹©è°ƒç”¨å“ªä¸€ä¸ªå‘¢?è¿™å°±æ˜¯go-microé€‰æ‹©å™¨å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å®ƒæ„å»ºåœ¨æ³¨å†Œè¡¨ä¸Šï¼Œå¹¶æä¾›è´Ÿè½½å¹³è¡¡ç­–ç•¥ï¼Œå¦‚è½®è¯¢æˆ–éšæœºæ•£åˆ—ï¼ŒåŒæ—¶æä¾›è¿‡æ»¤ã€ç¼“å­˜å’Œé»‘åå•å¤±è´¥èŠ‚ç‚¹çš„æ–¹æ³•ã€‚ è¿™æ˜¯ä¸€ä¸ªè£å‰ªçš„æ¥å£ã€‚ 123456789type Selector interface &#123; Select(service string, opts ...SelectOption) (Next, error) Mark(service string, node *registry.Node, err error) Reset(service string)&#125;type Next func() (*registry.Node, error)type Filter func([]*registry.Service) []*registry.Servicetype Strategy func([]*registry.Service) Next å¹³è¡¡ç­–ç•¥ç›®å‰çš„ç­–ç•¥ç›¸å½“ç›´æˆªäº†å½“ã€‚å½“é€‰æ‹©è¢«è°ƒç”¨æ—¶ï¼Œé€‰æ‹©å™¨å°†ä»æ³¨å†Œè¡¨ä¸­æ£€ç´¢æœåŠ¡ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨é»˜è®¤ç­–ç•¥å°è£…èŠ‚ç‚¹æ± ï¼Œæˆ–è€…åœ¨è¢«é‡å†™æ—¶ä½œä¸ºä¸€ä¸ªé€‰é¡¹ä¼ å…¥ã€‚ å®¢æˆ·ç«¯å°†æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥è°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°æ¥æ£€ç´¢åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æå‡ºè¯·æ±‚ã€‚å¦‚æœè¯·æ±‚å¤±è´¥å¹¶ä¸”é‡è¯•è®¾ç½®åœ¨1ä¹‹ä¸Šï¼Œå®ƒå°†ç»å†ç›¸åŒçš„è¿‡ç¨‹ï¼Œæ£€ç´¢ä¸‹ä¸€ä¸ªè¦è°ƒç”¨çš„èŠ‚ç‚¹ã€‚ åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨å¤šç§ç­–ç•¥ï¼Œä¾‹å¦‚è½®è¯¢ã€éšæœºæ•£åˆ—ã€æœ€å°connã€åŠ æƒç­‰ã€‚è´Ÿè½½å‡è¡¡ç­–ç•¥å¯¹äºåœ¨æœåŠ¡ä¸­å‡åŒ€åˆ†å¸ƒè¯·æ±‚è‡³å…³é‡è¦ã€‚ é€‰æ‹©ç¼“å­˜è™½ç„¶æœ‰ä¸€ä¸ªå¥å£®çš„æœåŠ¡å‘ç°ç³»ç»Ÿå¾ˆå¥½ï¼Œä½†æ˜¯å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡ŒæŸ¥æ‰¾éƒ½æ˜¯ä½æ•ˆå’Œæ˜‚è´µçš„ã€‚å¦‚æœæ‚¨æƒ³è±¡ä¸€ä¸ªå¤§å‹çš„ç³»ç»Ÿï¼Œæ¯ä¸ªæœåŠ¡éƒ½åœ¨è¿™æ ·åšï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“ä½¿å‘ç°ç³»ç»Ÿè¿‡è½½ã€‚å¯èƒ½ä¼šå‡ºç°å®Œå…¨ä¸å¯ç”¨çš„æƒ…å†µã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚å¤§å¤šæ•°å‘ç°ç³»ç»Ÿæä¾›äº†ä¸€ç§ç›‘å¬æ›´æ–°çš„æ–¹æ³•ï¼Œé€šå¸¸è¢«ç§°ä¸ºè§‚å¯Ÿè€…ã€‚è€Œä¸æ˜¯è½®è¯¢å‘ç°ï¼Œæˆ‘ä»¬ç­‰å¾…äº‹ä»¶è¢«å‘é€ç»™æˆ‘ä»¬ã€‚go-microæ³¨å†Œè¡¨ä¸ºè¿™ä¸ªæä¾›äº†ä¸€ä¸ªè¡¨æŠ½è±¡ã€‚ æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç¼“å­˜é€‰æ‹©å™¨ï¼Œå®ƒåœ¨æœåŠ¡çš„å†…å­˜ç¼“å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªã€‚åœ¨ç¼“å­˜ç¼ºå¤±æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾ä¿¡æ¯çš„å‘ç°ï¼Œç¼“å­˜å®ƒï¼Œç„¶ååœ¨éšåçš„è¯·æ±‚ä¸­ä½¿ç”¨å®ƒã€‚å¦‚æœæ¥æ”¶åˆ°æˆ‘ä»¬æ‰€çŸ¥é“çš„æœåŠ¡çš„ç›‘è§†äº‹ä»¶ï¼Œé‚£ä¹ˆç¼“å­˜å°†ç›¸åº”åœ°æ›´æ–°ã€‚ é¦–å…ˆï¼Œé€šè¿‡åˆ é™¤æœåŠ¡æŸ¥æ‰¾ï¼Œæå¤§åœ°æé«˜äº†æ€§èƒ½ã€‚å®ƒè¿˜æä¾›äº†åœ¨æœåŠ¡å‘ç°å¤±è´¥çš„æƒ…å†µä¸‹çš„ä¸€äº›å®¹é”™ã€‚è™½ç„¶æˆ‘ä»¬æœ‰ç‚¹åæ‰§ï¼Œä½†ç”±äºä¸€äº›å¤±è´¥çš„åœºæ™¯ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—é™ˆæ—§ï¼Œå› æ­¤èŠ‚ç‚¹ä¼šè¢«é€‚å½“åœ°å¤„ç†ã€‚ é»‘åå•çš„èŠ‚ç‚¹æ¥ä¸‹æ¥æ˜¯é»‘åå•ã€‚æ³¨æ„é€‰æ‹©å™¨æ¥å£æœ‰æ ‡è®°å’Œå¤ä½æ–¹æ³•ã€‚æˆ‘ä»¬æ°¸è¿œä¸èƒ½çœŸæ­£ä¿è¯å¥åº·çš„èŠ‚ç‚¹æ˜¯é€šè¿‡å‘ç°æ³¨å†Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšäº›ä»€ä¹ˆã€‚ æ— è®ºä½•æ—¶æå‡ºè¯·æ±‚ï¼Œæˆ‘ä»¬éƒ½ä¼šè·Ÿè¸ªç»“æœã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å®ä¾‹å¤šæ¬¡å¤±è´¥ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥å°†è¯¥èŠ‚ç‚¹åˆ—å…¥é»‘åå•ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡é€‰æ‹©è¯·æ±‚æ—¶å°†å…¶è¿‡æ»¤æ‰ã€‚ åœ¨å°†èŠ‚ç‚¹æ”¾åˆ°æ± ä¸­ä¹‹å‰ï¼Œè¯¥èŠ‚ç‚¹å°†è¢«åˆ—å…¥ä¸€æ®µæ—¶é—´çš„é»‘åå•ã€‚å¦‚æœæœåŠ¡çš„æŸä¸ªèŠ‚ç‚¹å¤±è´¥äº†ï¼Œæˆ‘ä»¬å°†å®ƒä»åˆ—è¡¨ä¸­åˆ é™¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ä¸ºæˆåŠŸçš„è¯·æ±‚æä¾›æœåŠ¡ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ è¶…æ—¶å’Œé‡è¯•Adrian Cockroftæœ€è¿‘å¼€å§‹è®¨è®ºå¾®æœåŠ¡æ¶æ„ä¸­ç¼ºå°‘çš„ç»„ä»¶ã€‚å…¶ä¸­ä¸€ä¸ªéå¸¸æœ‰è¶£çš„äº‹æƒ…æ˜¯ç»å…¸çš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥å¯¼è‡´çº§è”å¤±è´¥ã€‚æˆ‘æ³æ±‚ä½ å»çœ‹çœ‹ä»–çš„å¹»ç¯ç‰‡ã€‚æˆ‘ç›´æ¥é“¾æ¥åˆ°å®ƒå¼€å§‹è¦†ç›–è¶…æ—¶å’Œé‡è¯•çš„åœ°æ–¹ã€‚æ„Ÿè°¢è‰¾å¾·é‡Œå®‰è®©æˆ‘ç”¨å¹»ç¯ç‰‡ã€‚ è¿™å¼ å¹»ç¯ç‰‡ç¡®å®å¾ˆå¥½åœ°æ¦‚æ‹¬äº†è¿™ä¸ªé—®é¢˜ã€‚ Adrianæ‰€æè¿°çš„æ˜¯ä¸€ç§å¸¸è§çš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼“æ…¢çš„å“åº”ä¼šå¯¼è‡´è¶…æ—¶ï¼Œç„¶åå¯¼è‡´å®¢æˆ·æœºé‡è¯•ã€‚ç”±äºè¯·æ±‚å®é™…ä¸Šæ˜¯ä¸‹æ¸¸çš„è¯·æ±‚é“¾ï¼Œå› æ­¤é€šè¿‡ç³»ç»Ÿåˆ›å»ºäº†ä¸€æ•´å¥—æ–°çš„è¯·æ±‚ï¼Œè€Œæ—§çš„å·¥ä½œå¯èƒ½ä»åœ¨è¿›è¡Œã€‚é”™è¯¯é…ç½®å¯èƒ½å¯¼è‡´åœ¨è°ƒç”¨é“¾ä¸­è¶…è½½æœåŠ¡ï¼Œå¹¶å¯¼è‡´éš¾ä»¥æ¢å¤çš„å¤±è´¥åœºæ™¯ã€‚ åœ¨å¾®æœåŠ¡é¢†åŸŸï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è€ƒè™‘å¤„ç†è¶…æ—¶å’Œé‡è¯•çš„ç­–ç•¥ã€‚Adrianæ¥ç€è®¨è®ºäº†è¿™ä¸ªé—®é¢˜çš„æ½œåœ¨è§£å†³æ–¹æ¡ˆã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯è¶…æ—¶é¢„ç®—å’Œå¯¹æ–°èŠ‚ç‚¹çš„é‡è¯•ã€‚ åœ¨é‡è¯•æ–¹é¢ï¼Œæˆ‘ä»¬å·²ç»åœ¨Microä¸Šåšäº†ä¸€æ®µæ—¶é—´äº†ã€‚å¯ä»¥å°†é‡è¯•çš„æ•°é‡é…ç½®ä¸ºå®¢æˆ·æœºçš„é€‰é¡¹ã€‚å¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå®¢æˆ·ç«¯å°†æ£€ç´¢ä¸€ä¸ªæ–°èŠ‚ç‚¹å¹¶å°è¯•å†æ¬¡å‘å‡ºè¯·æ±‚ã€‚ è¶…æ—¶æ˜¯ä¸€äº›ç»è¿‡æ·±æ€ç†Ÿè™‘çš„äº‹æƒ…ï¼Œä½†å®é™…ä¸Šæ˜¯ä»ç»å…¸çš„é™æ€è¶…æ—¶è®¾ç½®å¼€å§‹çš„ã€‚ç›´åˆ°è‰¾å¾·é‡Œå®‰æå‡ºä»–çš„æƒ³æ³•åï¼Œæ‰æ˜ç™½è¯¥ç­–ç•¥åº”è¯¥æ˜¯ä»€ä¹ˆã€‚ é¢„ç®—çš„æš‚åœç°åœ¨è¢«å»ºç«‹åœ¨Microä¸Šã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ ç¬¬ä¸€ä¸ªè°ƒç”¨è€…è®¾ç½®è¶…æ—¶ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨è¾¹ç¼˜ã€‚åœ¨é“¾ä¸Šçš„æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œè¶…æ—¶éƒ½è¢«å‡å°‘ï¼Œä»¥è§£é‡Šå·²ç»é€šè¿‡çš„æ—¶é—´é‡ã€‚å½“é›¶æ—¶é—´ç»“æŸæ—¶ï¼Œæˆ‘ä»¬åœæ­¢å¤„ç†ä»»ä½•è¿›ä¸€æ­¥çš„è¯·æ±‚æˆ–é‡è¯•å¹¶è¿”å›è°ƒç”¨å †æ ˆã€‚ æ­£å¦‚Adrianæ‰€æåˆ°çš„ï¼Œè¿™æ˜¯ä¸€ç§æä¾›åŠ¨æ€è¶…æ—¶é¢„ç®—å¹¶åˆ é™¤åœ¨ä¸‹æ¸¸å‘ç”Ÿçš„ä¸å¿…è¦å·¥ä½œçš„å¥½æ–¹æ³•ã€‚ è¿›ä¸€æ­¥æ¥è¯´ï¼Œä¸‹ä¸€æ­¥åº”è¯¥æ˜¯åˆ é™¤ä»»ä½•ç±»å‹çš„é™æ€è¶…æ—¶ã€‚æœåŠ¡å“åº”çš„æ–¹å¼ä¼šå› ç¯å¢ƒã€è¯·æ±‚è´Ÿè½½ç­‰è€Œæœ‰æ‰€ä¸åŒã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªåŠ¨æ€çš„SLAï¼Œå®ƒä¼šæ ¹æ®å½“å‰çš„çŠ¶æ€è€Œå˜åŒ–ï¼Œä½†åˆä¼šæœ‰ä¸€äº›ä¸œè¥¿éœ€è¦ä¿ç•™ä¸€å¤©ã€‚ è¿æ¥æ± å‘¢?è¿æ¥æ± æ˜¯æ„å»ºå¯ä¼¸ç¼©ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æˆ‘ä»¬å¾ˆå¿«å°±çœ‹åˆ°äº†æ²¡æœ‰å®ƒçš„å±€é™æ€§ã€‚é€šå¸¸ä¼šå¯¼è‡´æ–‡ä»¶æè¿°ç¬¦é™åˆ¶å’Œç«¯å£è€—å°½ã€‚ ç›®å‰æ­£åœ¨è¿›è¡Œçš„ä¸€é¡¹å·¥ä½œæ˜¯å°†è¿æ¥æ± æ·»åŠ åˆ°go-microã€‚è€ƒè™‘åˆ°å¾®çš„å¯æ’æ‹”æ€§ï¼Œåœ¨ä¼ è¾“å±‚ä¸Šå¤„ç†è¿™ä¸€å±‚éå¸¸é‡è¦ï¼Œå› æ­¤ä»»ä½•å®ç°(æ— è®ºæ˜¯HTTPã€NATSã€RabbitMQç­‰)éƒ½å°†å—ç›Šã€‚ ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™æ˜¯å…·ä½“çš„å®ç°ï¼Œæœ‰äº›ä¼ è¾“å¯èƒ½å·²ç»æ”¯æŒäº†ã€‚è™½ç„¶è¿™æ˜¯äº‹å®ï¼Œä½†å¹¶ä¸æ€»æ˜¯ä¿è¯åœ¨æ¯ä¸ªä¼ è¾“è¿‡ç¨‹ä¸­éƒ½ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚é€šè¿‡è§£å†³è¿™ä¸ªç‰¹å®šçš„é—®é¢˜ï¼Œæˆ‘ä»¬é™ä½äº†ä¼ è¾“æœ¬èº«çš„å¤æ‚æ€§å’Œéœ€æ±‚ã€‚ è¿˜æœ‰ä»€ä¹ˆ?è¿™äº›éƒ½æ˜¯ä¸€äº›éå¸¸æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå¯ä»¥ç”¨æ¥åšgo-microï¼Œä½†è¿˜æœ‰ä»€ä¹ˆå‘¢? æˆ‘å¾ˆé«˜å…´ä½ é—®æˆ‘â€¦æˆ–è€…,å‡è®¾ä½ é—®â€¦ã€‚ æœåŠ¡ç‰ˆæœ¬Canaryingæˆ‘ä»¬æœ‰å®ƒ!å®ƒå®é™…ä¸Šæ˜¯åœ¨ä¹‹å‰çš„ä¸€ç¯‡å…³äºå¾®æœåŠ¡çš„æ¶æ„å’Œè®¾è®¡æ¨¡å¼çš„åšå®¢æ–‡ç« ä¸­è®¨è®ºè¿‡çš„ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ã€‚ æœåŠ¡åŒ…å«åç§°å’Œç‰ˆæœ¬ä½œä¸ºæœåŠ¡å‘ç°ä¸­çš„ä¸€å¯¹ã€‚å½“ä»æ³¨å†Œä¸­å¿ƒæ£€ç´¢æœåŠ¡æ—¶ï¼Œå®ƒçš„èŠ‚ç‚¹æŒ‰ç‰ˆæœ¬åˆ†ç»„ã€‚ç„¶åï¼Œå¯ä»¥åˆ©ç”¨å„ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œåˆ©ç”¨é€‰æ‹©å™¨æ¥åœ¨æ¯ä¸ªç‰ˆæœ¬çš„èŠ‚ç‚¹ä¹‹é—´åˆ†é…æµé‡ã€‚ Canaryingä¸ºä»€ä¹ˆé‡è¦?åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬çš„æœåŠ¡å¹¶ç¡®ä¿æ‰€æœ‰çš„åŠŸèƒ½éƒ½èƒ½æ­£å¸¸è¿è¡Œä¹‹å‰ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ–°ç‰ˆæœ¬å¯ä»¥éƒ¨ç½²åˆ°ä¸€ä¸ªå°çš„èŠ‚ç‚¹æ± ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨åˆ†é…ä¸€å®šæ¯”ä¾‹çš„æµé‡ç»™æ–°æœåŠ¡ã€‚ç»“åˆåƒKubernetesè¿™æ ·çš„ä¸šåŠ¡æµç¨‹ç³»ç»Ÿï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¿¡ä»»å’Œå›æ»šæ¥å¢å¼ºéƒ¨ç½²ã€‚ è¿‡æ»¤å‘¢?æˆ‘ä»¬æœ‰å®ƒ!é€‰æ‹©å™¨éå¸¸å¼ºå¤§ï¼Œå®ƒåŒ…æ‹¬åœ¨é€‰æ‹©æ—¶é€šè¿‡è¿‡æ»¤å™¨æ¥è¿‡æ»¤èŠ‚ç‚¹çš„èƒ½åŠ›ã€‚åœ¨å‘å‡ºè¯·æ±‚æ—¶ï¼Œè¿™äº›å¯ä»¥ä½œä¸ºè°ƒç”¨é€‰é¡¹ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ä¸€äº›ç°æœ‰çš„è¿‡æ»¤å™¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å…ƒæ•°æ®ã€ç«¯ç‚¹æˆ–ç‰ˆæœ¬è¿‡æ»¤ã€‚ è¿‡æ»¤ä¸ºä»€ä¹ˆé‡è¦?æ‚¨å¯èƒ½æœ‰ä¸€äº›ä»…åœ¨æœåŠ¡ç‰ˆæœ¬ä¸­å­˜åœ¨çš„åŠŸèƒ½ã€‚å°†è¯·æ±‚æµå›ºå®šåˆ°è¿™äº›ç‰¹å®šçš„ç‰ˆæœ¬ä¹‹é—´ï¼Œç¡®ä¿æ‚¨æ€»æ˜¯èƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„æœåŠ¡ã€‚åœ¨ç³»ç»Ÿä¸­åŒæ—¶è¿è¡Œå¤šä¸ªç‰ˆæœ¬çš„æƒ…å†µéå¸¸å¥½ã€‚ å¦ä¸€ä¸ªæœ‰ç”¨çš„ç”¨ä¾‹æ˜¯æ‚¨å¸Œæœ›åŸºäºä½ç½®çš„æœåŠ¡è·¯ç”±ã€‚é€šè¿‡åœ¨æ¯ä¸ªæœåŠ¡ä¸Šè®¾ç½®ä¸€ä¸ªæ•°æ®ä¸­å¿ƒæ ‡ç­¾ï¼Œæ‚¨å¯ä»¥åº”ç”¨ä¸€ä¸ªåªè¿”å›æœ¬åœ°èŠ‚ç‚¹çš„è¿‡æ»¤å™¨ã€‚åŸºäºå…ƒæ•°æ®çš„è¿‡æ»¤åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¹¶ä¸”æœ‰æ›´å¹¿æ³›çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½åœ¨é‡å¤–å¬åˆ°æ›´å¤šçš„åº”ç”¨ã€‚ å¯æ’æ‹”çš„ä½“ç³»ç»“æ„ä½ ä¼šä¸æ–­å¬åˆ°çš„ä¸€ä»¶äº‹æ˜¯Microçš„å¯æ’æ‹”æ€§ã€‚è¿™æ˜¯ä»ç¬¬ä¸€å¤©å¼€å§‹è®¾è®¡çš„ã€‚ä¸ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿç›¸æ¯”ï¼ŒMicroæä¾›æ„å»ºå—éå¸¸é‡è¦ã€‚å¯ä»¥åœ¨ç›’å­é‡Œå·¥ä½œä½†å¯ä»¥å¢å¼ºçš„ä¸œè¥¿ã€‚ ä¸ºä»€ä¹ˆæ˜¯å¯æ’å…¥çš„é—®é¢˜?æ¯ä¸ªäººå¯¹äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æœ‰ä¸åŒçš„æƒ³æ³•ï¼Œæˆ‘ä»¬çœŸçš„æƒ³æä¾›ä¸€ç§æ–¹å¼è®©äººä»¬è®¾è®¡ä»–ä»¬æƒ³è¦ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜æœ‰å¼ºå¤§çš„æˆ˜æ–—æµ‹è¯•å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›å·¥å…·ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹ç¼–å†™ä»»ä½•ä¸œè¥¿ã€‚ æŠ€æœ¯æ€»æ˜¯åœ¨è¿›åŒ–ï¼Œæ–°çš„å’Œæ›´å¥½çš„å·¥å…·æ¯å¤©éƒ½åœ¨å‡ºç°ã€‚å¦‚ä½•é¿å…é”å®š?ä¸€ä¸ªå¯æ’æ‹”çš„æ¶æ„æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä»Šå¤©ä½¿ç”¨ç»„ä»¶ï¼Œå¹¶åœ¨æ˜å¤©ç”¨æœ€å°‘çš„åŠªåŠ›å°†å®ƒä»¬è½¬æ¢å‡ºæ¥ã€‚ æ’ä»¶Go -microçš„æ¯ä¸ªç‰¹æ€§éƒ½è¢«åˆ›å»ºä¸ºGoæ¥å£ã€‚é€šè¿‡è¿™æ ·åšå¹¶ä¸”åªå¼•ç”¨æ¥å£ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å°†åº•å±‚å®ç°ç”¨æœ€å°‘çš„ä»£ç æ›¿æ¢ä¸ºé›¶ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šä¸€ä¸ªç®€å•çš„importè¯­å¥å’Œæ ‡å¿—ã€‚ åœ¨GitHubä¸Šçš„go-plugin repoä¸­æœ‰è®¸å¤šæ’ä»¶ã€‚ è™½ç„¶go-microæä¾›äº†ä¸€äº›é»˜è®¤å€¼ï¼Œæ¯”å¦‚å‘ç°å’Œhttpçš„ä¼ è¾“ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›åœ¨æ‚¨çš„ä½“ç³»ç»“æ„ä¸­ä½¿ç”¨ä¸€äº›ä¸åŒçš„ä¸œè¥¿ï¼Œç”šè‡³å¯ä»¥å®ç°è‡ªå·±çš„æ’ä»¶ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»åœ¨å…¬å…±å…³ç³»æ¨¡å¼ä¸­ä½¿ç”¨äº†Kubernetesæ³¨å†Œæ’ä»¶å’ŒZookeeperæ³¨å†Œè¡¨ã€‚ å¦‚ä½•ä½¿ç”¨æ’ä»¶?å¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯è¿™ä¹ˆç®€å•ã€‚ 12# Import the pluginimport _ \"github.com/micro/go-plugins/registry/etcd\" 1go run main.go --registry=etcd --registry_address=10.0.0.1:2379 åŒ…è£…å™¨æ›´é‡è¦çš„æ˜¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ”¯æŒä¸­é—´ä»¶çš„æ¦‚å¿µï¼Œå³æ‰€è°“çš„åŒ…è£…å™¨ã€‚é€šè¿‡æ”¯æŒä¸­é—´ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯·æ±‚-å“åº”å¤„ç†å‘¨å›´æ·»åŠ é™„åŠ åŠŸèƒ½çš„preå’ŒpostæŒ‚é’©ã€‚ ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¥½ç†è§£çš„æ¦‚å¿µï¼Œå¹¶ä¸”åœ¨æ•°åƒä¸ªåº“ä¸­ä½¿ç”¨ã€‚æ‚¨å¯ä»¥ç«‹å³çœ‹åˆ°åœ¨ç”¨ä¾‹ä¸­æ‰€å¸¦æ¥çš„å¥½å¤„ï¼Œå¦‚ç”µè·¯ä¸­æ–­ã€é€Ÿç‡é™åˆ¶ã€èº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€è·Ÿè¸ªç­‰ã€‚ 12345678# Client Wrapperstype Wrapper func(Client) Clienttype StreamWrapper func(Streamer) Streamer# Server Wrapperstype HandlerWrapper func(HandlerFunc) HandlerFunctype SubscriberWrapper func(SubscriberFunc) SubscriberFunctype StreamerWrapper func(Streamer) Streamer æˆ‘å¦‚ä½•ä½¿ç”¨åŒ…è£…å™¨?è¿™å’Œæ’ä»¶ä¸€æ ·ç›´æ¥ã€‚ 1234567891011import ( \"github.com/micro/go-micro\" \"github.com/micro/go-plugins/wrapper/breaker/hystrix\")func main() &#123; service := micro.NewService( micro.Name(\"myservice\"), micro.WrapClient(hystrix.NewClientWrapper()), )&#125; ç®€å•çš„å¯¹å§?æˆ‘ä»¬å‘ç°ï¼Œè®¸å¤šå…¬å¸åœ¨å¾®è§‚ä¸Šåˆ›å»ºè‡ªå·±çš„å±‚ï¼Œä»¥åˆå§‹åŒ–ä»–ä»¬æ­£åœ¨å¯»æ‰¾çš„å¤§å¤šæ•°é»˜è®¤åŒ…è£…å™¨ï¼Œå› æ­¤ï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°çš„åŒ…è£…å™¨ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹å®Œæˆã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›å¼¹æ€§å’Œå®¹é”™çš„åŒ…è£…å™¨ã€‚ æ–­è·¯å™¨åœ¨SOAæˆ–å¾®æœåŠ¡ä¸–ç•Œä¸­ï¼Œå•ä¸ªè¯·æ±‚å®é™…ä¸Šå¯ä»¥å¯¼è‡´å¯¹å¤šä¸ªæœåŠ¡çš„è°ƒç”¨ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°åä¸ªæˆ–æ›´å¤šçš„è¯·æ±‚æ”¶é›†å¿…è¦çš„ä¿¡æ¯ï¼Œä»¥è¿”å›ç»™è°ƒç”¨è€…ã€‚åœ¨æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œè¿™å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœå‡ºç°é—®é¢˜ï¼Œå®ƒä¼šå¾ˆå¿«ä¸‹é™åˆ°çº§è”æ•…éšœï¼Œè¿™å¾ˆéš¾åœ¨ä¸é‡ç½®æ•´ä¸ªç³»ç»Ÿçš„æƒ…å†µä¸‹æ¢å¤ã€‚ æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯éƒ¨åˆ†è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œè¯·æ±‚é‡è¯•ï¼Œå¹¶å°†å¤šæ¬¡å¤±è´¥çš„é»‘åå•èŠ‚ç‚¹è§£å†³ï¼Œä½†åœ¨æŸä¸ªæ—¶åˆ»ï¼Œå¯èƒ½éœ€è¦é˜»æ­¢å®¢æˆ·ç«¯å°è¯•å‘å‡ºè¯·æ±‚ã€‚ è¿™å°±æ˜¯æ–­è·¯å™¨å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚ æ–­è·¯å™¨çš„æ¦‚å¿µæ˜¯ç›´æ¥çš„ã€‚å‡½æ•°çš„æ‰§è¡Œè¢«åŒ…è£…æˆ–ä¸è·Ÿè¸ªæ•…éšœçš„æŸç§ç›‘è§†å™¨å…³è”ã€‚å½“æ•…éšœæ•°é‡è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨å°±ä¼šè¢«ç»Šå€’ï¼Œä»»ä½•è¿›ä¸€æ­¥çš„è°ƒç”¨å°è¯•éƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè€Œä¸æ‰§è¡ŒåŒ…è£…çš„å‡½æ•°ã€‚åœ¨è¶…æ—¶æ—¶é—´åï¼Œç”µè·¯è¢«æ”¾å…¥åŠå¼€æ”¾çŠ¶æ€ã€‚å¦‚æœåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ä¸€ä¸ªè°ƒç”¨å¤±è´¥ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–­è·¯å™¨å°±ä¼šå†æ¬¡è¢«ç»Šå€’ï¼Œä½†æ˜¯å¦‚æœå®ƒæˆåŠŸäº†ï¼Œæˆ‘ä»¬å°±ä¼šæ¢å¤åˆ°ä¸€ä¸ªé—­åˆç”µè·¯çš„æ­£å¸¸çŠ¶æ€ã€‚ è™½ç„¶Microå®¢æˆ·æœºçš„å†…éƒ¨ç»“æ„å…·æœ‰ä¸€äº›å†…ç½®çš„å®¹é”™åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬ä¸åº”è¯¥æœŸæœ›èƒ½å¤Ÿè§£å†³æ‰€æœ‰é—®é¢˜ã€‚åœ¨ç°æœ‰çš„æ–­è·¯å™¨å®ç°ä¸­ä½¿ç”¨åŒ…è£…å™¨å¯ä»¥å¤§å¤§å—ç›Šã€‚ é€Ÿåº¦é™åˆ¶å¦‚æœæˆ‘ä»¬èƒ½æ¯«ä¸è´¹åŠ›åœ°æ»¡è¶³ä¸–ç•Œä¸Šæ‰€æœ‰çš„è¦æ±‚ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—?å•Šæ¢¦ã€‚ç°å®ä¸–ç•Œå¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚å¤„ç†ä¸€ä¸ªæŸ¥è¯¢éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œå¹¶ä¸”ç”±äºèµ„æºçš„é™åˆ¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥æä¾›å¾ˆå¤šè¯·æ±‚ã€‚ åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘é™åˆ¶æˆ‘ä»¬å¯ä»¥å¹¶è¡Œåœ°åˆ›å»ºæˆ–æœåŠ¡çš„è¯·æ±‚çš„æ•°é‡ã€‚è¿™å°±æ˜¯é€Ÿç‡é™åˆ¶å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å¦‚æœæ²¡æœ‰é€Ÿç‡é™åˆ¶ï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´èµ„æºè€—å°½æˆ–å®Œå…¨ç˜«ç—ªç³»ç»Ÿï¼Œå¹¶é˜»æ­¢å®ƒç»§ç»­æä¾›ä»»ä½•è¿›ä¸€æ­¥çš„è¯·æ±‚ã€‚è¿™é€šå¸¸æ˜¯DDOSæ”»å‡»çš„åŸºç¡€ã€‚ æ¯ä¸ªäººéƒ½å¬è¯´è¿‡ï¼Œä½¿ç”¨è¿‡æˆ–è€…ç”šè‡³å¯èƒ½å®æ–½è¿‡æŸç§å½¢å¼çš„é™é€Ÿã€‚æœ‰å¾ˆå¤šä¸åŒçš„é€Ÿç‡é™åˆ¶ç®—æ³•ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯æ¼æ¡¶ç®—æ³•ã€‚æˆ‘ä»¬ä¸æ‰“ç®—è®¨è®ºç®—æ³•çš„ç»†èŠ‚ï¼Œä½†å€¼å¾—ä¸€è¯»ã€‚ å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¾®åŒ…è£…å™¨å’Œç°æœ‰çš„åº“æ¥æ‰§è¡Œè¿™ä¸ªåŠŸèƒ½ã€‚åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç°æœ‰çš„å®ç°ã€‚ æˆ‘ä»¬çœŸæ­£æ„Ÿå…´è¶£çš„ä¸€ä¸ªç³»ç»Ÿæ˜¯YouTubeçš„é—¨å«ï¼Œä¸€ä¸ªå…¨çƒåˆ†å¸ƒå¼å®¢æˆ·ç«¯é€Ÿç‡é™åˆ¶å™¨ã€‚æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªç¤¾åŒºçš„è´¡çŒ®ï¼Œæ‰€ä»¥è¯·è”ç³»! æœåŠ¡å™¨ç«¯æ‰€æœ‰è¿™äº›éƒ½æ¶‰åŠåˆ°å¾ˆå¤šå®¢æˆ·ç«¯ç‰¹æ€§æˆ–ç”¨ä¾‹ã€‚æœåŠ¡å™¨ç«¯å‘¢?é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼ŒMicroæ æ†åˆ©ç”¨äº†APIã€CLIã€Sidecarç­‰çš„go-microå®¢æˆ·ç«¯ã€‚è¿™äº›å¥½å¤„å°†æ•´ä¸ªä½“ç³»ç»“æ„ä»è¾¹ç¼˜è½¬åŒ–ä¸ºæœ€åçš„åç«¯æœåŠ¡ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸ºæœåŠ¡å™¨è§£å†³ä¸€äº›åŸºæœ¬é—®é¢˜ã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œæ³¨å†Œä¸­å¿ƒç”¨äºæŸ¥æ‰¾æœåŠ¡ï¼Œè€ŒæœåŠ¡å™¨ç«¯åˆ™æ˜¯æ³¨å†Œå®é™…å‘ç”Ÿçš„åœ°æ–¹ã€‚å½“ä¸€ä¸ªæœåŠ¡çš„ä¸€ä¸ªå®ä¾‹å‡ºç°æ—¶ï¼Œå½“å®ƒä¼˜é›…åœ°é€€å‡ºæ—¶ï¼Œå®ƒä¼šä½¿ç”¨æœåŠ¡å‘ç°æœºåˆ¶å’Œæ³¨é”€å™¨æ³¨å†Œè‡ªå·±ã€‚å…³é”®è¯æ˜¯ä¼˜é›…åœ°ã€‚ å¤„ç†å¤±è´¥åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å¤„ç†æ•…éšœï¼Œæˆ‘ä»¬éœ€è¦å®¹é”™ã€‚æ³¨å†Œè¡¨æ”¯æŒTTLsè¿‡æœŸæˆ–æ ‡è®°èŠ‚ç‚¹ä¸ºä¸å¥åº·çš„ï¼ŒåŸºäºä»»ä½•åŸºç¡€çš„æœåŠ¡å‘ç°æœºåˆ¶æ˜¯e.g consul,etcdã€‚è€ŒæœåŠ¡æœ¬èº«ä¹Ÿæ”¯æŒé‡æ–°æ³¨å†Œã€‚è¿™ä¸¤ç§æ–¹æ³•çš„ç»„åˆæ„å‘³ç€æœåŠ¡èŠ‚ç‚¹å°†åœ¨ä¸€ä¸ªé›†åˆé—´éš”ä¸Šé‡æ–°æ³¨å†Œï¼Œè€Œå®ƒæ˜¯å¥åº·çš„ï¼Œå¹¶ä¸”æ³¨å†Œä¸­å¿ƒå°†åœ¨æ²¡æœ‰åˆ·æ–°çš„æƒ…å†µä¸‹ç»ˆæ­¢è¯¥èŠ‚ç‚¹ã€‚å¦‚æœèŠ‚ç‚¹å› ä»»ä½•åŸå› å¤±è´¥ï¼Œä¸”ä¸é‡æ–°æ³¨å†Œï¼Œåˆ™å°†ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚ è¿™ç§å®¹é”™è¡Œä¸ºæœ€åˆå¹¶ä¸æ˜¯ä½œä¸ºgo-microçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå¿«ä»ç°å®ä¸–ç•Œä¸­çœ‹åˆ°ï¼Œç”±äºææ…Œå’Œå…¶ä»–å¯¼è‡´æœåŠ¡ä¸ä¼˜é›…åœ°é€€å‡ºçš„æ•…éšœï¼Œå¾ˆå®¹æ˜“åœ¨æ³¨å†Œè¡¨ä¸­å¡«å……é™ˆæ—§çš„èŠ‚ç‚¹ã€‚ è¿™æ ·åšçš„æ•ˆæœæ˜¯ï¼Œå¦‚æœæ²¡æœ‰å‡ ç™¾ä¸ªä¸æ–°é²œçš„æ¡ç›®ï¼Œå®¢æˆ·å°±ä¼šè¢«ç•™ä¸‹æ¥å¤„ç†å‡ åä¸ªã€‚è™½ç„¶å®¢æˆ·ç«¯ä¹Ÿéœ€è¦å®¹é”™ï¼Œä½†æˆ‘ä»¬è®¤ä¸ºè¿™ç§åŠŸèƒ½å¯ä»¥é¿å…å¾ˆå¤šé—®é¢˜ã€‚ æ·»åŠ æ›´å¤šçš„åŠŸèƒ½å¦å¤–è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ­£å¦‚ä¸Šé¢æåˆ°çš„ï¼ŒæœåŠ¡å™¨è¿˜æä¾›äº†ä½¿ç”¨åŒ…è£…å™¨æˆ–ä¸­é—´ä»¶çš„èƒ½åŠ›ï¼Œå› ä¸ºå®ƒæ›´å¹¿ä¸ºäººçŸ¥ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸€å±‚ä½¿ç”¨ç”µè·¯ä¸­æ–­ã€é€Ÿç‡é™åˆ¶å’Œå…¶ä»–ç‰¹æ€§æ¥æ§åˆ¶è¯·æ±‚æµã€å¹¶å‘æ€§ç­‰ã€‚ æœåŠ¡å™¨çš„åŠŸèƒ½æ˜¯æ•…æ„ä¿æŒç®€å•ä½†å¯æ’å…¥çš„ï¼Œè¿™æ ·åŠŸèƒ½å°±å¯ä»¥æŒ‰è¦æ±‚åˆ†å±‚æ’åˆ—ã€‚ Clients vs Sidecarsè¿™é‡Œè®¨è®ºçš„å¤§éƒ¨åˆ†å†…å®¹éƒ½å­˜åœ¨äºæ ¸å¿ƒçš„go-microåº“ä¸­ã€‚è™½ç„¶è¿™å¯¹æ‰€æœ‰çš„ç¨‹åºå‘˜æ¥è¯´éƒ½å¾ˆå¥½ï¼Œä½†å…¶ä»–äººå¯èƒ½ä¼šæƒ³ï¼Œæˆ‘è¯¥å¦‚ä½•è·å¾—è¿™äº›å¥½å¤„å‘¢? ä»ä¸€å¼€å§‹ï¼ŒMicroå°±åŒ…å«äº†Sidecarçš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªHTTPä»£ç†ï¼Œå®ƒåŒ…å«äº†go-microå†…ç½®çš„æ‰€æœ‰åŠŸèƒ½ã€‚å› æ­¤ï¼Œæ— è®ºæ‚¨ä½¿ç”¨å“ªç§è¯­è¨€æ„å»ºåº”ç”¨ç¨‹åºï¼Œæ‚¨éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨Micro Sidecarä»ä»¥ä¸Šè®¨è®ºä¸­è·ç›Šã€‚ sidecaræ¨¡å¼å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œäº‹ã€‚NetflixOSSæœ‰ä¸€ä¸ªåä¸ºPranaçš„ç³»ç»Ÿï¼Œå®ƒåˆ©ç”¨åŸºäºJVMçš„NetflixOSSæ ˆã€‚æœ€è¿‘ï¼Œæœ‰ä¸€ä¸ªå«Linkerdçš„åŠŸèƒ½ä¸°å¯Œçš„ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨Twitterçš„Finagleåº“ä¹‹ä¸Šçš„RPCä»£ç†ã€‚ Micro Sidecarä½¿ç”¨é»˜è®¤çš„go-microå®¢æˆ·ç«¯ã€‚æ‰€ä»¥å¦‚æœä½ æƒ³æ·»åŠ å…¶ä»–åŠŸèƒ½ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å¢åŠ å®ƒå’Œé‡å»ºã€‚æˆ‘ä»¬å°†åœ¨å°†æ¥è¿›ä¸€æ­¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…·æœ‰æ‰€æœ‰æ¼‚äº®å®¹é”™åŠŸèƒ½çš„ç‰ˆæœ¬ã€‚ ç­‰ç­‰,è¿˜æœ‰æ›´å¤šè¿™ç¯‡åšå®¢æ–‡ç« æ¶µç›–äº†è®¸å¤šæ ¸å¿ƒçš„go-microåº“å’Œå‘¨å›´çš„å·¥å…·åŒ…ã€‚è¿™äº›å·¥å…·æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ï¼Œä½†å®ƒä»¬è¿˜ä¸å¤Ÿã€‚å½“ä½ æƒ³è¦å¤§è§„æ¨¡è¿è¡Œæ—¶ï¼Œå½“ä½ æƒ³è¦æ•°ç™¾ä¸ªæœåŠ¡æ•°ä»¥ç™¾ä¸‡è®¡çš„å¾®æœåŠ¡æ—¶ï¼Œè¿˜æœ‰å¾ˆå¤šéœ€è¦è§£å†³çš„é—®é¢˜ã€‚ Platformè¿™å°±æ˜¯go-platformå’Œplatformå‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚åœ¨microåŸºç¡€æ„å»ºå—çš„åœ°æ–¹ï¼Œplatformæ›´è¿›ä¸€æ­¥åœ°è§£å†³äº†åœ¨è§„æ¨¡ä¸Šè¿è¡Œçš„éœ€æ±‚ã€‚è®¤è¯ã€åˆ†å¸ƒå¼è·Ÿè¸ªã€åŒæ­¥ã€å¥åº·æ£€æŸ¥ç›‘æ§ç­‰ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦ä¸€å¥—ä¸åŒçš„å·¥å…·æ¥è§‚å¯Ÿã€åå•†ä¸€è‡´å’Œåè°ƒå®¹é”™ï¼Œå¾®å¹³å°å¯ä»¥å¸®åŠ©æ»¡è¶³è¿™äº›éœ€æ±‚ã€‚é€šè¿‡æä¾›åˆ†å±‚æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ¸å¿ƒå·¥å…·å®šä¹‰çš„åŸè¯­åŸºç¡€ä¸Šæ„å»ºï¼Œå¹¶åœ¨éœ€è¦æ—¶å¢å¼ºå…¶åŠŸèƒ½ã€‚ ç°åœ¨è¿˜ä¸ºæ—¶å°šæ—©ï¼Œä½†äººä»¬å¸Œæœ›micro platformèƒ½è§£å†³è®¸å¤šç»„ç»‡åœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿå¹³å°æ—¶é‡åˆ°çš„é—®é¢˜ã€‚ æˆ‘å¦‚ä½•ä½¿ç”¨æ‰€æœ‰è¿™äº›å·¥å…·?æ­£å¦‚æ‚¨å¯ä»¥ä»åšå®¢æ–‡ç« ä¸­æ”¶é›†åˆ°çš„ï¼Œè¿™äº›ç‰¹æ€§ä¸­çš„å¤§éƒ¨åˆ†éƒ½æ˜¯å†…ç½®åœ¨Microå·¥å…·åŒ…ä¸­ã€‚æ‚¨å¯ä»¥åœ¨GitHubä¸ŠæŸ¥çœ‹é¡¹ç›®ï¼Œå¹¶ä¸”å‡ ä¹å¯ä»¥ç«‹å³å¼€å§‹ç¼–å†™å®¹é”™MicroæœåŠ¡ã€‚ å¦‚æœä½ éœ€è¦å¸®åŠ©æˆ–æœ‰é—®é¢˜ï¼Œè¯·åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºã€‚å®ƒéå¸¸æ´»è·ƒï¼Œè€Œä¸”å‘å±•è¿…é€Ÿï¼Œç”¨æˆ·å¹¿æ³›ï¼Œä»é»‘å®¢çš„ä¾§é¢é¡¹ç›®åˆ°ç°åœ¨å·²ç»åœ¨ä½¿ç”¨Microç”Ÿäº§çš„å…¬å¸ã€‚ æ€»ç»“æŠ€æœ¯æ­£åœ¨è¿…é€Ÿå‘å±•ï¼Œäº‘è®¡ç®—ç°åœ¨ç»™æˆ‘ä»¬æä¾›äº†å‡ ä¹æ— é™çš„è§„æ¨¡ã€‚è¯•å›¾è·Ÿä¸Šå˜é©çš„æ­¥ä¼æ˜¯å›°éš¾çš„ï¼Œæ„å»ºå¯ä¼¸ç¼©çš„æ–°ä¸–ç•Œçš„å®¹é”™ç³»ç»Ÿä»ç„¶å…·æœ‰æŒ‘æˆ˜æ€§ã€‚ ä½†ä¸ä¸€å®šéè¦è¿™æ ·ã€‚ä½œä¸ºä¸€ä¸ªç¤¾åŒºï¼Œæˆ‘ä»¬å¯ä»¥äº’ç›¸å¸®åŠ©ï¼Œä»¥é€‚åº”æ–°çš„ç¯å¢ƒï¼Œå¹¶å»ºç«‹ç¬¦åˆæˆ‘ä»¬æ—¥ç›Šå¢é•¿çš„éœ€æ±‚çš„äº§å“ã€‚ é€šè¿‡æä¾›ç®€åŒ–æ„å»ºå’Œç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å·¥å…·ï¼ŒMicroå¯ä»¥å¸®åŠ©æ‚¨å®ç°è¿™ä¸€è¿‡ç¨‹ã€‚å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®åŠ©æˆ‘ä»¬å±•ç¤ºä¸€äº›æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„æ–¹æ³•ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Micro Bot - å¾®æœåŠ¡èŠå¤©å·¥å…·","slug":"the-micro-bot","date":"2018-03-18T15:27:02.000Z","updated":"2020-07-25T02:57:18.229Z","comments":true,"path":"2018/03/18/the-micro-bot/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/the-micro-bot/","excerpt":"ä»Šå¤©æˆ‘æƒ³å’Œä½ ä»¬è°ˆè°ˆæœºå™¨äººã€‚","text":"ä»Šå¤©æˆ‘æƒ³å’Œä½ ä»¬è°ˆè°ˆæœºå™¨äººã€‚ æœºå™¨äººå—?çœŸçš„â€¦ç°åœ¨æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆäº†ã€‚ç°åœ¨æœ‰å¾ˆå¤šå…³äºæœºå™¨äººçš„ç‚’ä½œã€‚å¦‚æœä½ å¯¹èŠå¤©æœºå™¨äººå¾ˆç†Ÿæ‚‰ï¼Œä½ å°±ä¼šçŸ¥é“è¿™ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œäº‹å®ä¸Šï¼Œå®ƒå¯ä»¥è¿½æº¯åˆ°ä¼Šä¸½èæ—¶ä»£ã€‚å¯¹æœºå™¨äººçš„é‡æ–°è¿·æ‹çœŸçš„å‡ºç°äº†ï¼Œå› ä¸ºæˆ‘ä»¬å‘ç°äº†æ›´å¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œè€Œä¸ä»…ä»…æ˜¯å¨±ä¹ã€‚ä»–ä»¬è¿˜å¯¹å¯èƒ½æˆä¸ºä¸‹ä¸€ä¸ªè¶…è¶Šåº”ç”¨çš„äº¤äº’ç•Œé¢ï¼Œå³ä¼šè¯ç”¨æˆ·ç•Œé¢è¿›è¡Œäº†ç ”ç©¶ã€‚ åœ¨å·¥ç¨‹é¢†åŸŸï¼Œæœºå™¨äººä¸ä»…æ˜¯ç”¨äºä¼šè¯ç›®çš„ï¼Œå®ƒä»¬å¯¹äºæ“ä½œä»»åŠ¡æ¥è¯´ä¹Ÿéå¸¸æœ‰ç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¤§å¤šæ•°çš„æŠ€æœ¯äººå‘˜éƒ½å·²ç»ç†Ÿæ‚‰äº†â€œChatOpsâ€è¿™ä¸ªè¯ã€‚GitHubä»è¿™ä¸ªè¯çš„èµ·æºå¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯è¿™ä¸ªæœ¯è¯­çš„èµ·æºï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†æŠ€æœ¯å’Œä¸šåŠ¡æ“ä½œä»»åŠ¡çš„èŠå¤©æœºå™¨äººHubotçš„åˆ›å»ºå’Œä½¿ç”¨ã€‚ è¯·çœ‹çœ‹æ°è¥¿Â·çº½å…°åœ¨GitHubä¸Šå¯¹ChatOptsçš„æ¼”è®²ï¼Œä»¥äº†è§£æ›´å¤šã€‚ åƒå®ƒä¸€æ ·çš„Hubotå’Œæœºå™¨äººå·²ç»è¢«è¯æ˜åœ¨æŠ€æœ¯ç»„ç»‡ä¸­éå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”æˆä¸ºopså’Œè‡ªåŠ¨åŒ–é¢†åŸŸçš„ä¸»è¦å·¥å…·ã€‚é€šè¿‡HipChatæˆ–Slackæ¥æŒ‡å¯¼æœºå™¨äººæ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›æ˜¯ç›¸å½“å¼ºå¤§çš„ã€‚å®ƒå¯¹æ•´ä¸ªå›¢é˜Ÿçš„å¯è§æ€§æœ‰ç›´æ¥çš„ä»·å€¼ã€‚æ¯ä¸ªäººéƒ½èƒ½çœ‹åˆ°ä½ åœ¨åšä»€ä¹ˆï¼Œå½±å“æ˜¯ä»€ä¹ˆã€‚ è¿™ä¸microæœåŠ¡æœ‰ä»€ä¹ˆå…³ç³»?Micro ,microservice toolkitåŒ…æ‹¬è®¸å¤šæä¾›è¿›å…¥è¿è¡Œç³»ç»Ÿçš„å…¥å£ç‚¹çš„æœåŠ¡ã€‚APIã€Webä»ªè¡¨æ¿ã€CLIç­‰éƒ½æ˜¯ç”¨äºäº¤äº’å’Œè§‚å¯Ÿæ‚¨çš„å¾®æœåŠ¡ç¯å¢ƒçš„æ‰€æœ‰å›ºå®šçš„å…¥å£ç‚¹ã€‚åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œå¾ˆæ˜æ˜¾ï¼ŒBotæ˜¯å¦ä¸€ç§å½¢å¼çš„å…¥å£ç‚¹ï¼Œä»¥äº’åŠ¨å’Œè§‚å¯Ÿï¼Œå¹¶ä¸”å®ƒåº”è¯¥æ˜¯åœ¨Microè§‚ä¸–ç•Œçš„ä¸€ç­‰å…¬æ°‘ã€‚ æ‰€ä»¥,â€¦ è®©æˆ‘å…ˆè¯´ä¸€ä¸‹ï¼ŒMicro Botæ˜¯ä¸€ä¸ªéå¸¸æ—©æœŸçš„åŸå‹ï¼Œç›®å‰ä¸“æ³¨äºæä¾›ä¸CLIç›¸åŒçš„ç‰¹æ€§ã€‚æˆ‘ä»¬ä¸æ˜¯æ‹¥æœ‰äººå·¥æ™ºèƒ½åŸºäºChatOpsâ€¦ä½†ä¹Ÿè®¸æœ‰ä¸€å¤©â€¦ Micro BotåŒ…æ‹¬hubotç±»ä¼¼äºè„šæœ¬çš„è¯­ä¹‰ï¼Œä»¥åŠä¸€ç§å®ç°æ–°è¾“å…¥çš„æ–¹å¼ï¼Œå¦‚Slackå’ŒHipchatã€‚è¿™æ˜¯ä¸€ä¸ªç²—ç•¥çš„ç‰ˆæœ¬1ï¼Œä½†æˆ‘ç›¸ä¿¡ï¼Œåªè¦æœ‰ä»€ä¹ˆä¸œè¥¿èƒ½èµ·ä½œç”¨ï¼Œæˆ‘å°±ä¼šç›¸ä¿¡ï¼Œé€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å°±èƒ½æ›´å¿«åœ°æé«˜æœºå™¨äººçš„é€Ÿåº¦ã€‚å¸Œæœ›ä¸ç¤¾åŒºçš„è´¡çŒ®! è¯¥BotåŒ…æ‹¬æ‰€æœ‰çš„CLIå‘½ä»¤å’Œå¯¹Slackå’ŒHipChatçš„è¾“å…¥ã€‚æˆ‘ä»¬çš„ç¤¾åŒºæœºå™¨äººç›®å‰åœ¨æ¼”ç¤ºç¯å¢ƒä¸­è¿è¡Œï¼Œç°åœ¨å¤„äºå¾®æ¾å¼›çŠ¶æ€!å¦‚æœä½ æƒ³çœ‹çš„è¯ï¼Œè¯·åŠ å…¥æˆ‘ä»¬ã€‚ åœ¨çŸ­æœŸå†…ï¼Œæˆ‘ä»¬å°†è€ƒè™‘æ·»åŠ æ›´å¤šçš„è¾“å…¥æ’ä»¶ï¼Œå¦‚IRCã€XMPPå’Œå‘½ä»¤ï¼Œè¿™äº›æ’ä»¶å¯ä»¥ç®€åŒ–ç®¡ç†è¿è¡Œç¯å¢ƒä¸­çš„å¾®æœåŠ¡ã€‚å¦‚æœä½ å¯¹å…¶ä»–çš„è¾“å…¥æˆ–å‘½ä»¤æœ‰æƒ³æ³•ï¼Œæˆ–è€…æƒ³è¦æäº¤ä¸€ä»½å…³äºæŸä»¶äº‹çš„å…¬å…³ï¼Œé‚£ä¹ˆä½ çš„è´¡çŒ®å°±ä¸å—æ¬¢è¿äº†ã€‚æ›´å¤šçš„æ’ä»¶å¯ä»¥åœ¨github.com/micro/go-plugins/botä¸­æ‰¾åˆ°ã€‚ è¿™æ˜¯Microç”Ÿæ€ç³»ç»Ÿå¯ç¼–ç¨‹æœºå™¨äººçš„åŸºæœ¬æ¡†æ¶ã€‚è€ƒè™‘åˆ°æ•´ä¸ªå·¥å…·åŒ…çš„å¯æ’å…¥æ€§ï¼Œåœ¨botå½¢å¼ä¸­æä¾›ç±»ä¼¼çš„ä¸œè¥¿æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚ è®©æˆ‘ä»¬ç»§ç»­è®¨è®ºè¾“å…¥å’Œå‘½ä»¤æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ InputsInputsæ˜¯micro botå¦‚ä½•è¿æ¥åˆ°hipchat, slack, irc, xmppç­‰ç­‰ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†hipchatå’Œslackçš„å®ç°ï¼Œè¿™ä¼¼ä¹æ¶µç›–äº†å¤§é‡çš„ç”¨æˆ·ã€‚ è¿™æ˜¯Inputæ¥å£ã€‚ 1234567891011121314type Input interface &#123; // Provide cli flags Flags() []cli.Flag // Initialise input using cli context Init(*cli.Context) error // Stream events from the input Stream() (Conn, error) // Start the input Start() error // Stop the input Stop() error // name of the input String() string&#125;","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Microæ¶æ„å’Œå¾®æœåŠ¡çš„è®¾è®¡æ¨¡å¼","slug":"micro-architecture","date":"2018-03-18T13:58:35.000Z","updated":"2020-07-25T02:57:18.213Z","comments":true,"path":"2018/03/18/micro-architecture/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/micro-architecture/","excerpt":"åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬å¯¹å¾®æœåŠ¡çš„microæ¶æ„å’Œè®¾è®¡æ¨¡å¼æœ‰å¾ˆå¤šç–‘é—®ã€‚æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°†å°è¯•æŠŠä¸¤è€…éƒ½åŒ…æ‹¬è¿›å»ã€‚","text":"åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬å¯¹å¾®æœåŠ¡çš„microæ¶æ„å’Œè®¾è®¡æ¨¡å¼æœ‰å¾ˆå¤šç–‘é—®ã€‚æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°†å°è¯•æŠŠä¸¤è€…éƒ½åŒ…æ‹¬è¿›å»ã€‚ å…³äºMicroMicroæ˜¯ä¸€ä¸ªå¾®å‹æœåŠ¡å·¥å…·åŒ…ã€‚å®ƒè¢«æ„å»ºä¸ºåœ¨å®ƒçš„ç‰¹æ€§å’Œæ¥å£ä¸Šçš„è§‚ç‚¹ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªå¼ºå¤§çš„å¯æ’å…¥æ¶æ„ï¼Œå…è®¸å°†åº•å±‚çš„ä¾èµ–é¡¹äº¤æ¢å‡ºå»ã€‚ Microä¸“æ³¨äºæ»¡è¶³æ„å»ºå¾®æœåŠ¡çš„åŸºæœ¬éœ€æ±‚ï¼Œå¹¶é€šè¿‡é‡‡ç”¨æ·±æ€ç†Ÿè™‘å’Œæ…é‡çš„æ–¹æ³•æ¥å®ç°å®ƒçš„è®¾è®¡ã€‚ å¦‚æœä½ æƒ³åœ¨microtoolkitä¸Šé˜…è¯»ï¼Œçœ‹çœ‹ä¹‹å‰çš„åšå®¢æ–‡ç« ï¼Œæˆ–è€…ä½ æƒ³äº†è§£æ›´å¤šå…³äºå¾®æœåŠ¡çš„æ¦‚å¿µã€‚ åœ¨æ·±å…¥è®¨è®ºè¿›ä¸€æ­¥çš„æ¶æ„è®¨è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿå›é¡¾ä¸€ä¸‹Microçš„ç‰¹æ€§ã€‚ ToolkitGo Microæ˜¯ä¸€ç§å¯æ’å…¥çš„RPCæ¡†æ¶ï¼Œç”¨äºåœ¨Goä¸­ç¼–å†™å¾®æœåŠ¡ã€‚å®ƒä¸ºæœåŠ¡å‘ç°ã€å®¢æˆ·ç«¯è´Ÿè½½å¹³è¡¡ã€ç¼–ç ã€åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡æä¾›äº†åº“ã€‚ Micro APIæ˜¯ä¸€ä¸ªAPIç½‘å…³ï¼Œå®ƒæœåŠ¡äºHTTPï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±åˆ°é€‚å½“çš„å¾®æœåŠ¡ã€‚å®ƒä½œä¸ºä¸€ä¸ªå…¥å£ç‚¹ï¼Œå¯ä»¥ä½œä¸ºåå‘ä»£ç†ï¼Œä¹Ÿå¯ä»¥å°†HTTPè¯·æ±‚è½¬æ¢ä¸ºRPCã€‚ Micro Webæ˜¯ä¸€ä¸ªWebä»ªè¡¨ç›˜ï¼Œæ˜¯Micro Webåº”ç”¨ç¨‹åºçš„åå‘ä»£ç†ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œç½‘ç»œåº”ç”¨åº”è¯¥ä½œä¸ºå¾®æœåŠ¡æ„å»ºï¼Œå› æ­¤åœ¨å¾®æœåŠ¡é¢†åŸŸè¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘ã€‚å®ƒçš„è¡Œä¸ºç±»ä¼¼äºAPIåå‘ä»£ç†ï¼Œä½†ä¹ŸåŒ…æ‹¬å¯¹web socketsçš„æ”¯æŒã€‚ Micro Sidecaræä¾›äº†go-microä½œä¸ºHTTPæœåŠ¡çš„æ‰€æœ‰åŠŸèƒ½ã€‚è™½ç„¶æˆ‘ä»¬çƒ­çˆ±Goï¼Œç›¸ä¿¡å®ƒæ˜¯æ„å»ºå¾®æœåŠ¡çš„ä¼Ÿå¤§è¯­è¨€ï¼Œä½†æ‚¨å¯èƒ½ä¹Ÿæƒ³ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼Œå› æ­¤Sidecaræä¾›äº†ä¸€ç§å°†å…¶ä»–åº”ç”¨é›†æˆåˆ°Microä¸–ç•Œçš„æ–¹æ³•ã€‚ Micro CLIæ˜¯ä¸€ä¸ªç›´æ¥ä¸æ‚¨çš„å¾®æœåŠ¡äº¤äº’çš„å‘½ä»¤è¡Œç•Œé¢ã€‚å®ƒè¿˜å…è®¸æ‚¨åˆ©ç”¨Sidecarä½œä¸ºä»£ç†ï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›ç›´æ¥è¿æ¥åˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ è¿™æ˜¯å¿«é€Ÿçš„å›é¡¾ã€‚ç°åœ¨è®©æˆ‘ä»¬æ›´æ·±ã€‚ RPC, REST, Protoâ€¦é¦–å…ˆä½ å¯èƒ½ä¼šæƒ³åˆ°ä¸ºä»€ä¹ˆRPCï¼Œä¸ºä»€ä¹ˆä¸ä¼‘æ¯?æˆ‘ä»¬çš„ä¿¡å¿µæ˜¯ï¼ŒRPCæ˜¯è·¨æœåŠ¡é€šä¿¡çš„ä¸€ä¸ªæ›´åˆé€‚çš„é€‰æ‹©ã€‚æˆ–è€…ä½¿ç”¨protobuf IDLå®šä¹‰çš„protobufç¼–ç å’Œapiæ›´å…·ä½“åœ°è¯´RPCã€‚è¿™ç§ç»„åˆå…è®¸åˆ›å»ºå¼ºå®šä¹‰çš„APIæ¥å£å’Œæœ‰æ•ˆçš„æ¶ˆæ¯ç¼–ç æ ¼å¼ã€‚RPCæ˜¯ä¸€ç§ç›´æ¥çš„ã€æ— é™„åŠ çš„ã€ç”¨äºé€šä¿¡çš„åè®®ã€‚ æˆ‘ä»¬å¹¶ä¸å­¤å•ã€‚ è°·æ­Œæ˜¯åˆ›å»ºprotobufï¼Œåœ¨å†…éƒ¨ä½¿ç”¨RPCï¼Œä»¥åŠæœ€è¿‘å¼€æºçš„gRPCï¼Œä¸€ä¸ªRPCæ¡†æ¶ã€‚HailoåŒæ—¶ä¹Ÿæ˜¯RPC/Protobufçš„æœ‰åŠ›å€¡å¯¼è€…ï¼Œå¹¶ä¸”åœ¨è·¨å›¢é˜Ÿå¼€å‘ä¸­æ¯”ç³»ç»Ÿæ€§èƒ½æ›´æœ‰ä¼˜åŠ¿ã€‚ä¼˜æ­¥é€‰æ‹©äº†è‡ªå·±çš„è·¯å¾„ï¼Œå¼€å‘äº†ä¸€ä¸ªåä¸ºTChannelçš„RPCæ¡†æ¶åè®®ã€‚ å°±ä¸ªäººè€Œè¨€ï¼Œæˆ‘ä»¬è®¤ä¸ºæœªæ¥çš„apiå°†ä¼šä½¿ç”¨RPCæ¥æ„å»ºï¼Œå› ä¸ºå®ƒä»¬çš„ç»“æ„æ ¼å¼å¾ˆå¥½ï¼Œä½¿ç”¨é«˜æ•ˆçš„ç¼–ç åè®®(å¦‚protobuf)ï¼Œå¹¶æä¾›äº†å¼ºå®šä¹‰çš„apiå’Œæ€§èƒ½é€šä¿¡ã€‚ HTTP åˆ° RPC, APIâ€¦ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨ç½‘ç»œä¸Šçš„RPCè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚è™½ç„¶å®ƒåœ¨æ•°æ®ä¸­å¿ƒå†…æ˜¯å®Œç¾çš„ï¼Œä½†å´ä¸ºå…¬ä¼—æœåŠ¡å¦‚ç½‘ç«™å’Œç§»åŠ¨apiï¼Œæ˜¯å¦ä¸€ä¸ªäº¤äº’ã€‚è®©æˆ‘ä»¬é¢å¯¹å®ƒï¼Œåœ¨æˆ‘ä»¬ç¦»å¼€HTTPä¹‹å‰ä¼šæœ‰ä¸€æ®µæ—¶é—´ã€‚è¿™æ˜¯microåŒ…å«APIç½‘å…³ã€æœåŠ¡å’Œä¼ è¾“ HTTPè¯·æ±‚çš„åŸå› ä¹‹ä¸€ã€‚ APIç½‘å…³æ˜¯ç”¨äºå¾®æœåŠ¡ä½“ç³»ç»“æ„çš„æ¨¡å¼ã€‚å®ƒå……å½“å¤–éƒ¨ä¸–ç•Œçš„å•ä¸€å…¥å£ç‚¹ï¼Œå¹¶æ ¹æ®è¯·æ±‚æä¾›é€‚å½“çš„æœåŠ¡ã€‚è¿™ä½¿å¾—HTTP APIæœ¬èº«å¯ä»¥ç”±ä¸åŒçš„å¾®æœåŠ¡ç»„æˆã€‚ è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¶æ„æ¨¡å¼ã€‚åœ¨è¿‡å»çš„æ—¥å­é‡Œï¼Œä½ çš„APIçš„æŸä¸ªéƒ¨åˆ†å¯èƒ½ä¼šæ¯æ‰æ•´ä¸ªæ•´ä½“ã€‚ micro APIä½¿ç”¨è·¯å¾„åˆ°æœåŠ¡çš„è§£æï¼Œè¿™æ ·æ¯ä¸ªç‹¬ç‰¹çš„è¯·æ±‚è·¯å¾„éƒ½å¯ä»¥ç”±ä¸åŒçš„APIå¾®æœåŠ¡æ¥æœåŠ¡ï¼Œä¾‹å¦‚:/user =&gt; user api, /order =&gt; order apiã€‚ è¿™æ˜¯ä¸€ä¸ªä¾‹å­ã€‚å¯¹/customer/ordersçš„è¯·æ±‚å°†é€šè¿‡Customer.Ordersæ–¹æ³•å‘é€åˆ°APIæœåŠ¡go.micro.api.customerã€‚ æ‚¨å¯èƒ½æƒ³çŸ¥é“ä»€ä¹ˆæ˜¯APIæœåŠ¡ã€‚ç°åœ¨æ˜¯è®¨è®ºä¸åŒç±»å‹æœåŠ¡çš„åˆé€‚æ—¶æœºã€‚ æœåŠ¡ç±»å‹å¾®æœåŠ¡çš„æ¦‚å¿µæ˜¯å…³äºå…³æ³¨ç‚¹åˆ†ç¦»çš„ï¼Œå¹¶ä¸”ä»unixçš„å“²å­¦ä¸­å€Ÿé‰´äº†å¾ˆå¤šï¼Œå¹¶ä¸”åšå¾—å¾ˆå¥½ã€‚éƒ¨åˆ†å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬è®¤ä¸ºéœ€è¦åœ¨ä¸åŒèŒè´£çš„æœåŠ¡ä¹‹é—´è¿›è¡Œé€»è¾‘å’Œæ¶æ„çš„åˆ†ç¦»ã€‚ æˆ‘ç°åœ¨è¦æ‰¿è®¤ï¼Œè¿™äº›æ¦‚å¿µå¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œäº‹ç‰©ï¼Œä½†å®ƒä»¬æ˜¯ä»¤äººä¿¡æœçš„ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åœ¨éå¸¸æˆåŠŸçš„ç§‘æŠ€å…¬å¸ä¸­å¾—åˆ°è¯æ˜ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é€šè¿‡å·¥å…·ä¼ æ’­è¿™äº›å¼€å‘ç†å¿µå’ŒæŒ‡å¯¼è®¾è®¡å†³ç­–ã€‚ è¿™æ˜¯æˆ‘ä»¬ç›®å‰å®šä¹‰çš„æœåŠ¡ç±»å‹ã€‚ API - ç”±micro apiæœåŠ¡ï¼ŒAPIæœåŠ¡ä½äºæ‚¨çš„åŸºç¡€è®¾æ–½çš„è¾¹ç¼˜ï¼Œæœ€æœ‰å¯èƒ½æœåŠ¡äºå…¬å…±äº¤é€šå’Œæ‚¨çš„ç§»åŠ¨æˆ–webåº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥ä½¿ç”¨HTTPå¤„ç†ç¨‹åºæ„å»ºå®ƒï¼Œå¹¶ä»¥åå‘ä»£ç†æ¨¡å¼è¿è¡Œmicro apiï¼Œæˆ–è€…é»˜è®¤åœ°å¤„ç†åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°çš„ç‰¹å®šRPC apiè¯·æ±‚å“åº”æ ¼å¼ã€‚ Web - ç”±**micro webæœåŠ¡ï¼ŒWebæœåŠ¡ä¾§é‡äºæœåŠ¡htmlå†…å®¹å’ŒæŒ‡ç¤ºæ¿ã€‚micro webåå‘ä»£ç†HTTPå’ŒWebSocketsã€‚è¿™æ˜¯ç›®å‰æ”¯æŒçš„å”¯ä¸€åè®®ï¼Œä½†å°†æ¥å¯èƒ½ä¼šæ‰©å±•ã€‚å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬è®¤ä¸ºwebåº”ç”¨ç¨‹åºæ˜¯å¾®æœåŠ¡ã€‚ SRV - è¿™äº›æ˜¯åŸºäºåç«¯RPCçš„æœåŠ¡ã€‚ä»–ä»¬ä¸»è¦é›†ä¸­äºä¸ºæ‚¨çš„ç³»ç»Ÿæä¾›æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œä¸”å¾ˆå¯èƒ½ä¸æ˜¯é¢å‘å…¬ä¼—çš„ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨ä»ç„¶å¯ä»¥é€šè¿‡micro apiæˆ–webä½¿ç”¨/rpcç«¯ç‚¹è®¿é—®å®ƒä»¬ï¼Œä½†æ›´æœ‰å¯èƒ½çš„æ˜¯ï¼Œapiã€webå’Œå…¶ä»–SRVæœåŠ¡ä½¿ç”¨go-microå®¢æˆ·æœºç›´æ¥è°ƒç”¨å®ƒä»¬ã€‚ æ ¹æ®ä»¥å¾€çš„ç»éªŒï¼Œæˆ‘ä»¬å‘ç°è¿™ç§ç±»å‹çš„ä½“ç³»ç»“æ„æ¨¡å¼éå¸¸å¼ºå¤§ï¼Œå®ƒå¯ä»¥æ‰©å±•åˆ°æ•°ç™¾ç§æœåŠ¡ã€‚é€šè¿‡å°†å…¶æ„å»ºåˆ°å¾®æ¶æ„ä¸­ï¼Œæˆ‘ä»¬è§‰å¾—å®ƒä¸ºå¾®æœåŠ¡å¼€å‘æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ã€‚ å‘½åç©ºé—´å› æ­¤ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œæ˜¯ä»€ä¹ˆé˜»æ­¢äº†micro apiä¸webæœåŠ¡æˆ–micro webå¯¹è¯çš„apiæœåŠ¡ã€‚æˆ‘ä»¬ä½¿ç”¨é€»è¾‘å‘½åç©ºé—´æ¥åˆ†éš”è¿™äº›ã€‚é€šè¿‡å°†åç§°ç©ºé—´é¢„å…ˆè®¾ç½®ä¸ºæœåŠ¡åç§°ï¼Œæˆ‘ä»¬æ¸…æ¥šåœ°ç¡®å®šäº†å®ƒåœ¨ç³»ç»Ÿä¸­çš„ç”¨é€”å’Œä½ç½®ã€‚è¿™æ˜¯ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ¨¡å¼ï¼Œå¯¹æˆ‘ä»¬æœ‰å¥½å¤„ã€‚ micro apiå’Œwebå°†ä¸ºè¯·æ±‚è·¯å¾„çš„å‘½åç©ºé—´å’Œç¬¬ä¸€ä¸ªè·¯å¾„ç»„æˆä¸€ä¸ªæœåŠ¡åç§°ï¼Œä¾‹å¦‚è¯·æ±‚api /customeræˆä¸ºgo.micro.api.customerã€‚ é»˜è®¤åç§°ç©ºé—´: API - go.micro.api Web - go.micro.web SRV - go.micro.srv ä½ åº”è¯¥æŠŠè¿™äº›è®¾ç½®æˆä½ çš„åŸŸåï¼Œæ¯”å¦‚com.example.{api, web, srv}ã€‚micro apiå’Œmicro webå¯ä»¥åœ¨è¿è¡Œæ—¶é…ç½®ï¼Œä»¥è·¯ç”±åˆ°æ‚¨çš„åç§°ç©ºé—´ã€‚ åŒæ­¥/å¼‚æ­¥ä½ ä¼šç»å¸¸å¬åˆ°ä¸å“åº”æ¨¡å¼ç›¸åŒçš„å¾®æœåŠ¡ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œå¾®æœåŠ¡æ˜¯å…³äºåˆ›å»ºäº‹ä»¶é©±åŠ¨çš„æ¶æ„å’Œè®¾è®¡æœåŠ¡ï¼Œè¿™äº›æœåŠ¡ä¸»è¦é€šè¿‡å¼‚æ­¥é€šä¿¡è¿›è¡Œäº¤äº’ã€‚ Microå°†å¼‚æ­¥é€šä¿¡ä½œä¸ºä¸€ä¸ªä¸€æµçš„å…¬æ°‘ï¼Œæ˜¯å¾®æœåŠ¡çš„åŸºæœ¬æ„å»ºå—ã€‚é€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ä¼ é€’äº‹ä»¶å…è®¸ä»»ä½•äººæ¶ˆè´¹å¹¶å¯¹å…¶è¿›è¡Œæ“ä½œã€‚å¯ä»¥æ„å»ºæ–°çš„ç‹¬ç«‹æœåŠ¡ï¼Œè€Œä¸éœ€è¦å¯¹ç³»ç»Ÿçš„å…¶ä»–æ–¹é¢è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è®¾è®¡æ¨¡å¼ï¼Œå› æ­¤æˆ‘ä»¬å·²ç»å°†Brokeræ¥å£åŒ…å«åœ¨äº†go-microä¸­ã€‚ åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡æ˜¯åœ¨Microä¸­ä½œä¸ºå•ç‹¬çš„éœ€æ±‚å¤„ç†çš„ã€‚ä¼ è¾“æ¥å£ç”¨äºåˆ›å»ºæœåŠ¡ä¹‹é—´çš„ç‚¹è¿æ¥ã€‚go-microå®¢æˆ·æœºå’ŒæœåŠ¡å™¨æ„å»ºåœ¨ä¼ è¾“ä¸Šï¼Œä»¥æ‰§è¡Œè¯·æ±‚-å“åº”RPCï¼Œå¹¶æä¾›åŒå‘æµçš„åŠŸèƒ½ã€‚ åœ¨æ„å»ºç³»ç»Ÿæ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸¤ç§é€šä¿¡æ¨¡å¼ï¼Œä½†å…³é”®æ˜¯è¦äº†è§£ä½•æ—¶ä½•åœ°éƒ½åˆé€‚ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¯¹é”™ä¹‹åˆ†ï¼Œè€Œæ˜¯ä¼šåšå‡ºæŸäº›æƒè¡¡ã€‚ åœ¨è·Ÿè¸ªå®¢æˆ·äº‹ä»¶å†å²çš„å®¡è®¡è·Ÿè¸ªç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šä½¿ç”¨ä»£ç†å’Œå¼‚æ­¥é€šä¿¡çš„ç¤ºä¾‹ã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªAPIæˆ–æœåŠ¡éƒ½å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼Œå½“æŸäº›æ“ä½œå‘ç”Ÿæ—¶ï¼Œæ¯”å¦‚å®¢æˆ·ç™»å½•ã€æ›´æ–°ä»–ä»¬çš„é…ç½®æ–‡ä»¶æˆ–ä¸‹è®¢å•ã€‚å®¡è®¡æœåŠ¡å°†è®¢é˜…è¿™äº›äº‹ä»¶å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æŸä¸ªæ—¶é—´åºåˆ—æ•°æ®åº“ä¸­ã€‚ç®¡ç†å‘˜æˆ–å…¶ä»–äººå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿä¸­ä¸ºä»»ä½•ç”¨æˆ·æ‰€å‘ç”Ÿçš„äº‹ä»¶çš„å†å²ã€‚ å¦‚æœè¿™æ˜¯ä¸€ä¸ªåŒæ­¥è°ƒç”¨ï¼Œé‚£ä¹ˆå½“å‡ºç°é«˜æµé‡æˆ–å®šåˆ¶æœåŠ¡çš„æ•°é‡å¢åŠ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·¹æ²¡å®¡è®¡æœåŠ¡ã€‚å¦‚æœç”±äºæŸäº›åŸå› è€Œå…³é—­äº†å®¡è®¡æœåŠ¡ï¼Œæˆ–è€…è°ƒç”¨å¤±è´¥ï¼Œæˆ‘ä»¬å°†å¤±å»è¿™æ®µå†å²ã€‚é€šè¿‡å°†è¿™äº›äº‹ä»¶å‘å¸ƒç»™ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¼‚æ­¥åœ°æŒä¹…åŒ–å®ƒä»¬ã€‚è¿™æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„å’Œå¾®æœåŠ¡çš„å¸¸è§æ¨¡å¼ã€‚ å¥½çš„ï¼Œç¨ç­‰ä¸€ä¸‹ï¼Œä½†ä»€ä¹ˆå®šä¹‰äº†å¾®æœåŠ¡å‘¢?æˆ‘ä»¬æ¶µç›–äº†è®¸å¤šå¾®å‹å·¥å…·æä¾›çš„å¾®æœåŠ¡ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†æœåŠ¡çš„ç±»å‹(API, WEB, SRV)ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆçœŸæ­£çš„å¾®æœåŠ¡ã€‚ å®ƒä¸å…¶ä»–ç±»å‹çš„åº”ç”¨æœ‰ä½•ä¸åŒ?æ˜¯ä»€ä¹ˆèµ‹äºˆäº†å®ƒä¸€ä¸ªâ€œå¾®æœåŠ¡â€çš„ç‰¹æ®Šåç§°ã€‚ è¿™é‡Œæœ‰ä¸åŒçš„å®šä¹‰å’Œè§£é‡Šï¼Œä½†è¿™é‡Œæœ‰ä¸€å¯¹åœ¨å¾®è§‚ä¸–ç•Œä¸­æœ€é€‚åˆçš„è¯´æ˜ã€‚ æ¾æ•£è€¦åˆçš„é¢å‘æœåŠ¡çš„ä½“ç³»ç»“æ„ï¼Œå…·æœ‰æœ‰ç•Œçš„ä¸Šä¸‹æ–‡ã€‚Adrian Cockcroft å°†å•ä¸ªåº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€å¥—å°å‹æœåŠ¡çš„æ–¹æ³•ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¹¶ä¸è½»é‡çº§æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚é©¬ä¸ å› ä¸ºæˆ‘ä»¬çƒ­çˆ±unixå“²å­¦ï¼Œå¹¶ä¸”è§‰å¾—å®ƒä¸å¾®æœåŠ¡ç†å¿µå®Œç¾å¥‘åˆã€‚ åšä¸€ä»¶äº‹ï¼Œåšå¾—å¥½å—?Doug McIlroy æˆ‘ä»¬çš„ä¿¡å¿µå’Œæˆ‘ä»¬æ„å»ºçš„ç†å¿µæ˜¯ï¼Œä¸€ä¸ªå¾®æœåŠ¡æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä¸“æ³¨äºå•ä¸€ç±»å‹çš„å®ä½“æˆ–é¢†åŸŸï¼Œå®ƒé€šè¿‡ä¸€ä¸ªå¼ºå¤§çš„å®šä¹‰çš„APIæä¾›è®¿é—®ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçœŸå®çš„ä¾‹å­ï¼Œæ¯”å¦‚ç¤¾äº¤ç½‘ç»œã€‚ éšç€Ruby on Railsçš„å…´èµ·ï¼Œä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„è½¯ä»¶æ¶æ„æ¨¡å¼æ˜¯MVC -æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ã€‚ åœ¨MVCä¸–ç•Œä¸­ï¼Œæ¯ä¸ªå®ä½“æˆ–åŸŸå°†è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä¾æ¬¡æŠ½è±¡å‡ºæ•°æ®åº“ã€‚è¯¥æ¨¡å‹å¯èƒ½ä¸å…¶ä»–æ¨¡å‹æœ‰å…³ç³»ï¼Œä¾‹å¦‚å¯¹è®¸å¤šæˆ–å¤šä¸ªæ¨¡å‹ã€‚æ§åˆ¶å™¨å¤„ç†å³å°†åˆ°æ¥çš„è¯·æ±‚ï¼Œä»æ¨¡å‹ä¸­æ£€ç´¢æ•°æ®å¹¶å°†å…¶ä¼ é€’ç»™ç”¨æˆ·ã€‚ ç°åœ¨ï¼Œä»¥ä¸€ä¸ªå¾®å‹æœåŠ¡æ¶æ„ä¸ºä¾‹ã€‚æ¯ä¸€ä¸ªæ¨¡å‹éƒ½æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œé€šè¿‡ä¸€ä¸ªAPIæ¥ä¼ é€’æ•°æ®ã€‚ç”¨æˆ·è¯·æ±‚ã€æ•°æ®æ”¶é›†å’Œå‘ˆç°ç”±è®¸å¤šä¸åŒçš„webæœåŠ¡å¤„ç†ã€‚ æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªç„¦ç‚¹ã€‚å½“æˆ‘ä»¬æƒ³è¦æ·»åŠ æ–°çš„ç‰¹æ€§æˆ–å®ä½“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ”¹å˜ä¸€ä¸ªä¸è¯¥ç‰¹æ€§ç›¸å…³çš„æœåŠ¡æˆ–ç¼–å†™ä¸€ä¸ªæ–°æœåŠ¡ã€‚è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»ä¸ºå¯ä¼¸ç¼©çš„è½¯ä»¶å¼€å‘æä¾›äº†ä¸€ç§æ¨¡å¼ã€‚ ç°åœ¨å›åˆ°æˆ‘ä»¬çš„å®šæœŸè®¡åˆ’ã€‚ ç‰ˆæœ¬æ§åˆ¶ ç‰ˆæœ¬æ§åˆ¶æ˜¯å¼€å‘ç°å®ä¸–ç•Œè½¯ä»¶çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚åœ¨å¾®æœåŠ¡é¢†åŸŸï¼Œè€ƒè™‘åˆ°APIå’Œä¸šåŠ¡é€»è¾‘åœ¨è®¸å¤šä¸åŒçš„æœåŠ¡ä¸­è¢«åˆ†å‰²ï¼Œè¿™æ˜¯è‡³å…³é‡è¦çš„ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼ŒæœåŠ¡ç‰ˆæœ¬æ§åˆ¶æ˜¯æ ¸å¿ƒå·¥å…·çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸å¯¹æ›´æ–°å’Œæµé‡å½¢æˆè¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚ åœ¨go-microæœåŠ¡ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªåç§°å’Œç‰ˆæœ¬ã€‚æ³¨å†Œè¡¨å°†æœåŠ¡ä½œä¸ºåˆ—è¡¨è¿”å›ï¼Œå°†èŠ‚ç‚¹æŒ‰å…¶æ³¨å†Œçš„ç‰ˆæœ¬è¿›è¡Œæ‹†åˆ†ã€‚ è¿™æ˜¯åŸºäºç‰ˆæœ¬çš„è·¯ç”±çš„æ„å»ºå—ã€‚ 1234567type Service struct &#123; Name string Version string Metadata map[string]string Endpoints []*Endpoint Nodes []*Node&#125; è¿™ä¸é€‰æ‹©å™¨(å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨)ç›¸ç»“åˆï¼Œåœ¨go-microä¸­ç¡®ä¿è¯·æ±‚åœ¨ä¸åŒç‰ˆæœ¬ä¹‹é—´åˆ†å¸ƒã€‚ é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ¥å£ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºå®ƒæ¥æä¾›ä¸åŒç±»å‹çš„è·¯ç”±ç®—æ³•;éšæœº(é»˜è®¤)ã€è½®è¯¢ã€åŸºäºæ ‡ç­¾ã€å»¶è¿Ÿç­‰ã€‚ é€šè¿‡ä½¿ç”¨é»˜è®¤çš„éšæœºæ•£åˆ—è´Ÿè½½å¹³è¡¡ç®—æ³•ï¼Œå¹¶é€æ­¥æ·»åŠ æ–°æœåŠ¡ç‰ˆæœ¬çš„å®ä¾‹ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œè“ç»¿è‰²éƒ¨ç½²å’Œåšcanaryæµ‹è¯•ã€‚ åœ¨å°†æ¥ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å®ç°ä¸€ä¸ªå…¨å±€æœåŠ¡è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒè¿æ¥åˆ°é€‰æ‹©å™¨ï¼Œå…è®¸åŸºäºè¿è¡Œç³»ç»Ÿä¸­çš„å†å²è¶‹åŠ¿è¿›è¡Œè·¯ç”±å†³ç­–ã€‚å®ƒè¿˜èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è°ƒæ•´å‘é€åˆ°æœåŠ¡çš„æ¯ä¸ªç‰ˆæœ¬çš„æµé‡çš„ç™¾åˆ†æ¯”ï¼Œå¹¶åŠ¨æ€åœ°å°†å…ƒæ•°æ®æˆ–æ ‡ç­¾æ·»åŠ åˆ°æœåŠ¡ä¸­ï¼ŒåŸºäºæ ‡ç­¾çš„è·¯ç”±å†³ç­–å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œã€‚ æ‰©å±•ä»¥ä¸Šå¯¹ç‰ˆæœ¬æ§åˆ¶çš„è¯„è®ºå¼€å§‹æš—ç¤ºäº†æ‰©å±•æœåŠ¡çš„åŸºæœ¬æ¨¡å¼ã€‚è™½ç„¶æ³¨å†Œè¡¨ç”¨ä½œå­˜å‚¨æœ‰å…³æœåŠ¡çš„ä¿¡æ¯çš„æœºåˆ¶ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨é€‰æ‹©å™¨æ¥åˆ†ç¦»è·¯ç”±å’Œè´Ÿè½½å¹³è¡¡çš„å…³æ³¨ã€‚ æŠŠå…³æ³¨ç‚¹åˆ†ç¦»å’Œåšå¥½ä¸€ä»¶äº‹çš„æ¦‚å¿µã€‚æ‰©å±•åŸºç¡€ç»“æ„å’Œä»£ç éå¸¸ç®€å•ï¼Œå®šä¹‰äº†apiå’Œåˆ†å±‚æ¶æ„ã€‚é€šè¿‡åˆ›å»ºè¿™äº›æ„å»ºå—ï¼Œæˆ‘ä»¬å…è®¸è‡ªå·±æ„å»ºæ›´å¯ä¼¸ç¼©çš„è½¯ä»¶ï¼Œå¹¶è§£å†³å…¶ä»–åœ°æ–¹æ›´é«˜å±‚æ¬¡çš„å…³æ³¨ã€‚ è¿™æ˜¯Microå†™ä½œçš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¸Œæœ›åœ¨å¾®æœåŠ¡é¢†åŸŸæŒ‡å¯¼è½¯ä»¶å¼€å‘çš„æ–¹å¼ã€‚ æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ç®€è¦è®¨è®ºäº†äº‘æ¶æ„æ¨¡å¼ï¼Œå¹¶å°†åœ¨è¿™é‡Œé‡æ–°è®¨è®ºä¸€äº›æƒ³æ³•ã€‚ å½“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²æœåŠ¡æ—¶ï¼Œæ‚¨å°†è€ƒè™‘æ„å»ºå¯ä¼¸ç¼©ã€å®¹é”™å’Œæ€§èƒ½çš„ä¸œè¥¿ã€‚äº‘è®¡ç®—ç°åœ¨è®©æˆ‘ä»¬è·å¾—äº†å‡ ä¹æ— é™çš„è§„æ¨¡ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å—å¤±è´¥å½±å“çš„ã€‚äº‹å®ä¸Šï¼Œåœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è§£å†³çš„å…³é”®é—®é¢˜ä¹‹ä¸€æ˜¯å¤±è´¥ï¼Œåœ¨æ„å»ºåŸºç¡€è®¾æ–½æ—¶åº”è¯¥è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚ åœ¨äº‘çš„ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå®¹å¿å¯ç”¨æ€§åŒºåŸŸ(datacenter)æ•…éšœï¼Œç”šè‡³æ˜¯æ•´ä¸ªåŒºåŸŸ(å¤šDC)å®•æœºã€‚åœ¨è¿‡å»çš„æ—¥å­é‡Œï¼Œæˆ‘ä»¬å¸¸å¸¸è°ˆè®ºæ¸©æš–å’Œå†·å¤‡ç”¨ç³»ç»Ÿæˆ–ç¾éš¾æ¢å¤è®¡åˆ’ã€‚å¦‚ä»Šï¼Œæœ€å…ˆè¿›çš„æŠ€æœ¯å…¬å¸ä»¥ä¸€ç§å…¨çƒåŒ–çš„æ–¹å¼è¿ä½œï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºçš„å¤šä¸ªå‰¯æœ¬éƒ½åœ¨ä¸–ç•Œå„åœ°çš„æ•°å­—æ•°æ®ä¸­å¿ƒè¿è¡Œã€‚ æˆ‘ä»¬éœ€è¦å‘è°·æ­Œã€Facebookã€Netflixå’ŒTwitterç­‰å…¬å¸å­¦ä¹ ã€‚æˆ‘ä»¬å¿…é¡»æ„å»ºèƒ½å¤Ÿå®¹å¿AZå¤±è´¥çš„ç³»ç»Ÿï¼Œè€Œä¸å½±å“ç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨å‡ åˆ†é’Ÿæˆ–æ›´çŸ­æ—¶é—´å†…å¤„ç†åŒºåŸŸæ•…éšœã€‚ Microä½¿æ‚¨èƒ½å¤Ÿæ„å»ºè¿™ç§æ¶æ„ã€‚é€šè¿‡æä¾›å¯æ’å…¥çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ€åˆé€‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥æ»¡è¶³å¾®å‹å·¥å…·åŒ…çš„æ¯ä¸ªéœ€æ±‚ã€‚ æœåŠ¡å‘ç°å’Œæ³¨å†Œè¡¨æ˜¯Microçš„æ„å»ºå—ã€‚å®ƒå¯ä»¥ç”¨äºåˆ†ç¦»å’Œå‘ç°åœ¨AZæˆ–åŒºåŸŸå†…çš„ä¸€ç»„æœåŠ¡æˆ–æ‚¨æ‰€é€‰æ‹©çš„ä»»ä½•é…ç½®ã€‚ç„¶åï¼ŒMicro APIå¯ä»¥ç”¨äºè·¯ç”±å’Œå¹³è¡¡å¤šä¸ªæœåŠ¡åŠå…¶åœ¨è¯¥æ‹“æ‰‘ä¸­çš„å®ä¾‹ã€‚ æ€»ç»“å¸Œæœ›è¿™ç¯‡åšæ–‡èƒ½å¤Ÿæ¸…æ™°åœ°æè¿°å¾®å¤„ç†å™¨çš„æ¶æ„ï¼Œä»¥åŠå®ƒå¦‚ä½•ä¸ºå¾®æœåŠ¡æä¾›å¯ä¼¸ç¼©çš„è®¾è®¡æ¨¡å¼ã€‚ å¾®æœåŠ¡é¦–å…ˆæ˜¯å…³äºè½¯ä»¶è®¾è®¡æ¨¡å¼çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å·¥å…·å¯ç”¨æŸäº›åŸºæœ¬æ¨¡å¼ï¼ŒåŒæ—¶ä¸ºå…¶ä»–æ¨¡å¼çš„å‡ºç°æˆ–ä½¿ç”¨æä¾›çµæ´»æ€§ã€‚ å› ä¸ºMicroæ˜¯å¯æ’æ‹”çš„æ¶æ„ï¼Œå®ƒæ˜¯å¤šç§è®¾è®¡æ¨¡å¼çš„å¼ºå¤§æ¨åŠ¨è€…ï¼Œå¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸­å¾—åˆ°é€‚å½“çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºè§†é¢‘æµåŸºç¡€è®¾æ–½ï¼Œæ‚¨å¯ä»¥é€‰æ‹©HTTPä¼ è¾“ä»¥ç‚¹åˆ°ç‚¹é€šä¿¡ã€‚å¦‚æœæ‚¨æ²¡æœ‰å»¶è¿Ÿæ•æ„Ÿï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªä¼ è¾“æ’ä»¶ï¼Œæ¯”å¦‚NATSæˆ–RabbitMQã€‚ æœªæ¥çš„è½¯ä»¶å¼€å‘å·¥å…·å¦‚Microï¼Œæ˜¯éå¸¸ä»¤äººå…´å¥‹çš„ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Microåœ¨NATS - å¾®æœåŠ¡ä¸æ¶ˆæ¯","slug":"micro-on-nats","date":"2018-03-18T12:41:09.000Z","updated":"2020-07-25T02:57:18.214Z","comments":true,"path":"2018/03/18/micro-on-nats/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/micro-on-nats/","excerpt":"åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºåœ¨NATSä¸Šä½¿ç”¨Microã€‚å®ƒåŒ…æ‹¬å…³äºæœåŠ¡å‘ç°çš„è®¨è®ºã€å¯¹å¾®æœåŠ¡çš„åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡ã€‚ è®©æˆ‘ä»¬å¼€å§‹è°ˆæ­£äº‹å§ã€‚","text":"åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºåœ¨NATSä¸Šä½¿ç”¨Microã€‚å®ƒåŒ…æ‹¬å…³äºæœåŠ¡å‘ç°çš„è®¨è®ºã€å¯¹å¾®æœåŠ¡çš„åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡ã€‚ è®©æˆ‘ä»¬å¼€å§‹è°ˆæ­£äº‹å§ã€‚ NATSæ˜¯ä»€ä¹ˆ?NATSæ˜¯ä¸€ä¸ªå¼€æºçš„äº‘æœ¬åœ°æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿæˆ–æ›´ç®€å•çš„æ¶ˆæ¯æ€»çº¿ã€‚NATSæ˜¯ç”±Apceraçš„åˆ›å§‹äººDerek Collisonåˆ›ç«‹çš„ã€‚å®ƒèµ·æºäºVMWareï¼Œå¹¶å¼€å§‹ä»¥rubyä¸ºåŸºç¡€çš„ç³»ç»Ÿã€‚å®ƒæ—©å°±è¢«é‡å†™äº†ï¼Œå¹¶ä¸”åœ¨é‚£äº›å¯»æ‰¾é«˜åº¦å¯ä¼¸ç¼©å’Œé«˜æ€§èƒ½çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„ç”¨æˆ·ä¸­ç¨³æ­¥è·å¾—é‡‡ç”¨ã€‚ å¦‚æœä½ æƒ³æ›´å¤šåœ°äº†è§£NATSæœ¬èº«ï¼Œè¯·è®¿é—®nats.ioæˆ–åŠ å…¥è¿™é‡Œçš„ç¤¾åŒºã€‚ ä¸ºä»€ä¹ˆNATS ?ä¸ºä»€ä¹ˆä¸NATSå‘¢?åœ¨è¿‡å»å¤„ç†è¿‡è®¸å¤šæ¶ˆæ¯æ€»çº¿åï¼Œå¾ˆæ˜æ˜¾ï¼ŒNATSæ˜¯åˆ†å¼€çš„ã€‚å¤šå¹´æ¥ï¼Œä¿¡æ¯ä¼ é€’è¢«è®¤ä¸ºæ˜¯ä¼ä¸šçš„æ•‘æ˜Ÿï¼Œå¯¼è‡´ç³»ç»Ÿè¯•å›¾æˆä¸ºæ‰€æœ‰äººçš„ä¸€åˆ‡ã€‚å®ƒå¯¼è‡´äº†å¾ˆå¤šé”™è¯¯çš„æ‰¿è¯ºï¼Œæ˜¾è‘—çš„ç‰¹å¾è†¨èƒ€å’Œé«˜æˆæœ¬æŠ€æœ¯ï¼Œé€ æˆäº†æ¯”ä»–ä»¬è§£å†³çš„æ›´å¤šçš„é—®é¢˜ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼ŒNATSåˆ™é‡‡å–äº†éå¸¸ä¸“æ³¨çš„æ–¹å¼ï¼Œè§£å†³äº†æ€§èƒ½å’Œå¯ç”¨æ€§æ–¹é¢çš„é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒäº†ä¸å¯æ€è®®çš„ç²¾ç›Šã€‚å®ƒè¯´çš„æ˜¯â€œéšæ—¶å¾…å‘½â€ï¼Œå¹¶ä½¿ç”¨â€œfire and forgetâ€æ¶ˆæ¯æ¨¡å¼ã€‚å®ƒçš„ç®€å•æ€§ã€ç„¦ç‚¹å’Œè½»é‡çº§ç‰¹æ€§ä½¿å®ƒæˆä¸ºå¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿçš„ä¸»è¦å€™é€‰å¯¹è±¡ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œå®ƒå°†å¾ˆå¿«æˆä¸ºä¸»è¦çš„å€™é€‰æœåŠ¡ï¼Œä½œä¸ºæ¶ˆæ¯ä¼ é€’çš„æœåŠ¡ä¹‹é—´çš„é€šä¿¡ä¼ è¾“ã€‚ NATSæä¾›: è¾ƒé«˜çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ é«˜å¯ç”¨æ€§ éå¸¸è½»é‡çº§çš„ æœ€å¤šä¸€æ¬¡äº¤ä»˜ NATSæ‰€ä¸æä¾›çš„: æŒä¹…æ€§ ä¼ è¾“ å¢å¼ºçš„äº¤ä»˜æ¨¡å¼ ä¼ä¸šæ’é˜Ÿ ç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯NATSï¼Œä¸ºä»€ä¹ˆæ˜¯NATSã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•ä¸Microç›¸é€‚åº”çš„å‘¢?è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹ã€‚ Microåœ¨NATSMicroæ˜¯ä¸€ä¸ªä½¿ç”¨å¯æ’å…¥æ¶æ„æ„å»ºçš„å¾®æœåŠ¡å·¥å…·ç®±ï¼Œå®ƒå…è®¸å°†åº•å±‚çš„ä¾èµ–é¡¹ä»¥æœ€å°çš„å˜åŒ–äº¤æ¢å‡ºæ¥ã€‚Go-Microæ¡†æ¶çš„æ¯ä¸ªæ¥å£éƒ½ä¸ºå¾®æœåŠ¡æä¾›äº†ä¸€ä¸ªæ„å»ºå—;ç”¨äºæœåŠ¡å‘ç°çš„æ³¨å†Œã€åŒæ­¥é€šä¿¡çš„ä¼ è¾“ã€å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ä»£ç†ç­‰ã€‚ ä¸ºæ¯ä¸ªç»„ä»¶åˆ›å»ºä¸€ä¸ªæ’ä»¶å°±åƒå®ç°æ¥å£ä¸€æ ·ç®€å•ã€‚æˆ‘ä»¬å°†èŠ±æ›´å¤šçš„æ—¶é—´è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ä»¥åçš„åšå®¢æ–‡ç« ä¸­ç¼–å†™æ’ä»¶ã€‚å¦‚æœæ‚¨æƒ³è¦æŸ¥çœ‹NATSæˆ–å…¶ä»–ç³»ç»Ÿ(å¦‚etcdå‘ç°ã€kafka brokerã€rabbitmqä¼ è¾“)çš„æ’ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°github.com/micro/go-pluginsã€‚ Micro on NATSæœ¬è´¨ä¸Šæ˜¯ä¸€ç»„å¯ç”¨äºä¸NATSæ¶ˆæ¯ç³»ç»Ÿé›†æˆçš„å¾®å‹æ’ä»¶ã€‚é€šè¿‡ä¸ºgo-microçš„å„ç§æ¥å£æä¾›æ’ä»¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è®¸å¤šé›†æˆç‚¹ï¼Œå…è®¸é€‰æ‹©æ¶æ„æ¨¡å¼ã€‚ åœ¨æˆ‘ä»¬çš„ç»éªŒä¸­ï¼Œä¸€ç§å°ºå¯¸å¹¶ä¸é€‚åˆæ‰€æœ‰çš„ï¼Œè€Œå¾®æ“ä½œç³»ç»Ÿçš„çµæ´»æ€§å…è®¸æ‚¨å®šä¹‰ä¸ºæ‚¨å’Œæ‚¨çš„å›¢é˜Ÿå·¥ä½œçš„æ¨¡å‹ã€‚ ä¸‹é¢æˆ‘ä»¬å°†è®¨è®ºç”¨äºä¼ è¾“ã€ä»£ç†å’Œæ³¨å†Œçš„NATSæ’ä»¶çš„å®ç°ã€‚ ä¼ è¾“ ä¼ è¾“æ˜¯åŒæ­¥é€šä¿¡çš„å¾®å‹æ¥å£ã€‚å®ƒä½¿ç”¨ç›¸å½“é€šç”¨çš„Socketè¯­ä¹‰ï¼Œç±»ä¼¼äºå…¶ä»–çš„Goä»£ç ï¼Œä½¿ç”¨Listenã€Dialå’ŒAcceptã€‚è¿™äº›æ¦‚å¿µå’Œæ¨¡å¼å¯¹äºä½¿ç”¨tcpã€httpç­‰çš„åŒæ­¥é€šä¿¡éå¸¸äº†è§£ï¼Œä½†æ˜¯é€‚åº”æ¶ˆæ¯æ€»çº¿å¯èƒ½ä¼šæœ‰äº›å›°éš¾ã€‚ä¸æ¶ˆæ¯æ€»çº¿å»ºç«‹è¿æ¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æœåŠ¡æœ¬èº«ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸ä¸»é¢˜å’Œé€šé“æœ‰å…³çš„ä¼ªè¿æ¥çš„æ¦‚å¿µã€‚ è¿™æ˜¯å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æœåŠ¡ä½¿ç”¨transport.Listenä¾¦å¬æ¶ˆæ¯ã€‚è¿™å°†åˆ›å»ºä¸NATSçš„è¿æ¥ã€‚å½“transport.Acceptè¢«è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªç‹¬ç‰¹çš„ä¸»é¢˜è¢«åˆ›å»ºå¹¶è®¢é˜…ã€‚è¿™ä¸ªç‹¬ç‰¹çš„ä¸»é¢˜å°†è¢«ç”¨ä½œgo-microæ³¨å†Œè¡¨ä¸­çš„æœåŠ¡åœ°å€ã€‚æ¯ä¸ªæ¥æ”¶åˆ°çš„æ¶ˆæ¯å°†è¢«ç”¨ä½œpseudoå¥—æ¥å­—/è¿æ¥çš„åŸºç¡€ã€‚å¦‚æœç°æœ‰çš„è¿æ¥å­˜åœ¨ç›¸åŒçš„åº”ç­”åœ°å€ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°å°†è¯¥æ¶ˆæ¯æ”¾å…¥åˆ°è¯¥è¿æ¥çš„backlogä¸­ã€‚ å¸Œæœ›ä¸æ­¤æœåŠ¡é€šä¿¡çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨transport.Dialæ¥åˆ›å»ºä¸æœåŠ¡çš„è¿æ¥ã€‚è¿™å°†è¿æ¥åˆ°NATSï¼Œåˆ›å»ºå®ƒè‡ªå·±ç‹¬ç‰¹çš„ä¸»é¢˜å¹¶è®¢é˜…å®ƒã€‚ä¸»é¢˜ç”¨äºæœåŠ¡çš„å“åº”ã€‚å½“å®¢æˆ·ç«¯å‘æœåŠ¡å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒå°†ä¸ºè¿™ä¸ªä¸»é¢˜è®¾ç½®åº”ç­”åœ°å€ã€‚ å½“ä»»ä½•ä¸€æ–¹æƒ³è¦å…³é—­è¿æ¥æ—¶ï¼Œä»–ä»¬ç®€å•åœ°è°ƒç”¨transport.Closeæ¥ç»ˆæ­¢ä¸NATSçš„è¿æ¥ã€‚ ä½¿ç”¨ä¼ è¾“æ’ä»¶å¯¼å…¥ä¼ è¾“æ’ä»¶ 1import _ \"github.com/micro/go-plugins/transport/nats\" ä»transportæ ‡å¿—å¼€å§‹ 1go run main.go --transport=nats --transport_address=127.0.0.1:4222 æˆ–è€…ç›´æ¥ä½¿ç”¨transport 1transport := nats.NewTransport() go-microä¼ è¾“æ¥å£: 12345type Transport interface &#123; Dial(addr string, opts ...DialOption) (Client, error) Listen(addr string, opts ...ListenOption) (Listener, error) String() string&#125; ä»£ç† ä»£ç†æ˜¯å¼‚æ­¥æ¶ˆæ¯ä¼ é€’çš„go-microæ¥å£ã€‚å®ƒæä¾›äº†é€‚ç”¨äºå¤§å¤šæ•°æ¶ˆæ¯ä»£ç†çš„é«˜çº§é€šç”¨å®ç°ã€‚NATSæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œå®ƒè¢«ç”¨ä½œæ¶ˆæ¯ä»£ç†ã€‚åªæœ‰ä¸€ä¸ªè­¦å‘Šï¼ŒNATSä¸ä¿å­˜æ¶ˆæ¯ã€‚è™½ç„¶è¿™å¯¹ä¸€äº›äººæ¥è¯´å¯èƒ½ä¸æ˜¯ç†æƒ³çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶ç›¸ä¿¡NATSå¯ä»¥å¹¶ä¸”åº”è¯¥ä½œä¸ºä¸€ä¸ªä¸­é—´äººä½¿ç”¨ã€‚åœ¨ä¸éœ€è¦æŒä¹…æ€§çš„æƒ…å†µä¸‹ï¼Œå®ƒå…è®¸å…·æœ‰é«˜åº¦å¯ä¼¸ç¼©çš„pubå­æ¶æ„ã€‚ NATSæä¾›äº†ä¸€ä¸ªéå¸¸ç›´æ¥çš„å‘å¸ƒå’Œè®¢é˜…æœºåˆ¶ï¼Œå…¶ä¸­åŒ…å«äº†ä¸»é¢˜ã€é€šé“ç­‰æ¦‚å¿µã€‚æ¶ˆæ¯å¯ä»¥ä»¥å¼‚æ­¥çš„æ–¹å¼å‘å¸ƒå¹¶å¿˜è®°æ–¹å¼ã€‚ä½¿ç”¨ç›¸åŒé€šé“åç§°çš„è®¢é˜…è€…åœ¨NATSä¸­å½¢æˆä¸€ä¸ªé˜Ÿåˆ—ç»„ï¼Œç„¶åå…è®¸æ¶ˆæ¯è‡ªåŠ¨å‡åŒ€åœ°åˆ†å¸ƒåœ¨è®¢é˜…è€…ä¹‹é—´ã€‚ ä½¿ç”¨ä»£ç†æ’ä»¶å¯¼å…¥ä»£ç†æ’ä»¶ 1import _ \"github.com/micro/go-plugins/broker/nats\" ä»brokeræ ‡å¿—å¼€å§‹ 1go run main.go --broker=nats --broker_address=127.0.0.1:4222 æˆ–è€…ç›´æ¥ä½¿ç”¨broker 1broker := nats.NewBroker() go-microä»£ç†æ¥å£: 12345678910type Broker interface &#123; Options() Options Address() string Connect() error Disconnect() error Init(...Option) error Publish(string, *Message, ...PublishOption) error Subscribe(string, Handler, ...SubscribeOption) (Subscriber, error) String() string&#125; æ³¨å†Œ æ³¨å†Œæ˜¯æœåŠ¡å‘ç°çš„go-microæ¥å£ã€‚ä½ å¯èƒ½ä¼šæ€è€ƒã€‚ä½¿ç”¨æ¶ˆæ¯æ€»çº¿çš„æœåŠ¡å‘ç°?,å³ä½¿æ˜¯å·¥ä½œå—?ç¡®å®å¦‚æ­¤ï¼Œè€Œä¸”ç›¸å½“ä¸é”™ã€‚è®¸å¤šä½¿ç”¨æ¶ˆæ¯æ€»çº¿çš„äººå°†é¿å…ä½¿ç”¨ä»»ä½•ç±»å‹çš„ç‹¬ç«‹å‘ç°æœºåˆ¶ã€‚è¿™æ˜¯å› ä¸ºæ¶ˆæ¯æ€»çº¿æœ¬èº«å¯ä»¥é€šè¿‡ä¸»é¢˜å’Œé€šé“æ¥å¤„ç†è·¯ç”±ã€‚å®šä¹‰ä¸ºæœåŠ¡åç§°çš„ä¸»é¢˜å¯ä»¥ç”¨ä½œè·¯ç”±é”®ï¼Œè‡ªåŠ¨åœ¨è®¢é˜…è¯¥ä¸»é¢˜çš„æœåŠ¡å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚ Go-microå°†æœåŠ¡å‘ç°å’Œä¼ è¾“æœºåˆ¶è§†ä¸ºä¸¤ä¸ªä¸åŒçš„å…³æ³¨ç‚¹ã€‚å½“å®¢æˆ·ç«¯å‘å¦ä¸€ä¸ªæœåŠ¡å‘å‡ºè¯·æ±‚æ—¶ï¼Œåœ¨è¦†ç›–å±‚ä¹‹ä¸‹ï¼Œå®ƒä¼šæ ¹æ®åç§°æŸ¥æ‰¾æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡ï¼Œé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œç„¶åé€šè¿‡ä¼ è¾“ä¸å®ƒé€šä¿¡ã€‚ é€šå¸¸ï¼Œå­˜å‚¨æœåŠ¡å‘ç°ä¿¡æ¯çš„æœ€å¸¸ç”¨æ–¹æ³•æ˜¯é€šè¿‡ä¸€ä¸ªåˆ†å¸ƒå¼çš„é”®å€¼å­˜å‚¨åº“ï¼Œå¦‚zookeeper, etcdæˆ–ç±»ä¼¼çš„ä¸œè¥¿ã€‚æ‚¨å¯èƒ½å·²ç»æ„è¯†åˆ°,NATSåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ä¸æ˜¯ä¸€ä¸ª,æ‰€ä»¥æˆ‘ä»¬è¦åšä¸€äº›æœ‰ç‚¹ä¸åŒâ€¦ å¹¿æ’­æŸ¥è¯¢!å¹¿æ’­æŸ¥è¯¢å°±åƒä½ æƒ³è±¡çš„é‚£æ ·ã€‚æœåŠ¡ä¾¦å¬æˆ‘ä»¬è®¤ä¸ºç”¨äºå¹¿æ’­æŸ¥è¯¢çš„ç‰¹å®šä¸»é¢˜ã€‚ä»»ä½•æƒ³è¦æœåŠ¡å‘ç°ä¿¡æ¯çš„äººé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªå®ƒè®¢é˜…çš„å›å¤ä¸»é¢˜ï¼Œç„¶åç”¨ä»–ä»¬çš„å›å¤åœ°å€å¯¹å¹¿æ’­ä¸»é¢˜è¿›è¡ŒæŸ¥è¯¢ã€‚ å› ä¸ºæˆ‘ä»¬å®é™…ä¸Šä¸çŸ¥é“ä¸€ä¸ªæœåŠ¡è¿è¡Œçš„å®ä¾‹æœ‰å¤šå°‘ï¼Œæˆ–è€…è¿”å›çš„å“åº”æœ‰å¤šå°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç­‰å¾…å“åº”çš„æ—¶å€™è®¾ç½®äº†ä¸€ä¸ªä¸Šé™ã€‚è¿™æ˜¯ä¸€ç§åˆ†æ•£æ”¶é›†çš„ç²—ç³™æœºåˆ¶ï¼Œä½†ç”±äºNATsçš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ï¼Œå®ƒå®é™…ä¸Šå·¥ä½œå¾—éå¸¸å¥½ã€‚å®ƒè¿˜é—´æ¥æä¾›äº†ä¸€ç§éå¸¸ç®€å•çš„è¿‡æ»¤æœåŠ¡çš„æ–¹å¼ï¼Œå“åº”æ—¶é—´ä¹Ÿæ›´é«˜ã€‚åœ¨å°†æ¥ï¼Œæˆ‘ä»¬å°†è€ƒè™‘æ”¹è¿›åº•å±‚å®ç°ã€‚ æ€»ç»“ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„: åˆ›å»ºåº”ç­”ä¸»é¢˜å¹¶è®¢é˜… ä»¥å›å¤åœ°å€å‘é€å¹¿æ’­ä¸»é¢˜æŸ¥è¯¢ åœ¨ä¸€ä¸ªæ—¶é—´é™åˆ¶åï¼Œå€¾å¬å›åº”å’Œå–æ¶ˆè®¢é˜… èšåˆå“åº”å’Œè¿”å›ç»“æœ ä½¿ç”¨æ³¨å†Œä¸­å¿ƒæ’ä»¶å¯¼å…¥registryæ’ä»¶ 1import _ \"github.com/micro/go-plugins/registry/nats\" ä»registryæ ‡å¿—å¼€å§‹ 1go run main.go --registry=nats --registry_address=127.0.0.1:4222 æˆ–è€…ç›´æ¥ä½¿ç”¨registry 1registry := nats.NewRegistry() go-micro registryæ¥å£: 12345678type Registry interface &#123; Register(*Service, ...RegisterOption) error Deregister(*Service) error GetService(string) ([]*Service, error) ListServices() ([]*Service, error) Watch() (Watcher, error) String() string&#125; NATSä¸ŠåŠ å¼ºMicroåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åªåœ¨localhostä¸ŠæŒ‡å®šä¸€ä¸ªå•ç‹¬çš„NATSæœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬æ¨èçš„å®é™…åº”ç”¨ç¨‹åºæ˜¯ä¸ºé«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§è®¾ç½®ä¸€ä¸ªNATSé›†ç¾¤ã€‚è¦äº†è§£æ›´å¤šå…³äºNATsé›†ç¾¤æ£€æŸ¥çš„NATsæ–‡æ¡£ã€‚ Microæ¥å—ä¸€ä¸ªé€—å·åˆ†éš”çš„åœ°å€åˆ—è¡¨ï¼Œå°±åƒä¸Šé¢æåˆ°çš„æ ‡è®°æˆ–è€…å¯ä»¥é€‰æ‹©ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚å¦‚æœæ‚¨ç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯åº“ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå…è®¸ä½œä¸ºåˆå§‹åŒ–æ³¨å†Œã€ä¼ è¾“å’Œä»£ç†çš„ä¸€ç§å¯å˜çš„ä¸»æœºé›†ã€‚ åœ¨ä¸€ä¸ªäº‘åŸç”Ÿä¸–ç•Œçš„æ¶æ„æ–¹é¢ï¼Œæˆ‘ä»¬è¿‡å»çš„ç»éªŒè¡¨æ˜ï¼Œæ¯ä¸ªAZæˆ–æ¯ä¸ªåŒºåŸŸçš„é›†ç¾¤æ˜¯ç†æƒ³çš„ã€‚å¤§å¤šæ•°äº‘æä¾›å•†åœ¨AZsä¹‹é—´æœ‰ç›¸å¯¹è¾ƒä½çš„(3-5ms)å»¶è¿Ÿï¼Œè¿™ä½¿å¾—åŒºåŸŸé›†ç¾¤æ²¡æœ‰é—®é¢˜ã€‚å½“è¿è¡Œä¸€ä¸ªé«˜åº¦å¯ç”¨çš„é…ç½®æ—¶ï¼Œé‡è¦çš„æ˜¯ç¡®ä¿æ‚¨çš„ç³»ç»Ÿèƒ½å¤Ÿå®¹å¿AZçš„å¤±è´¥ï¼Œå¹¶ä¸”åœ¨æ›´æˆç†Ÿçš„é…ç½®ä¸­èƒ½å¤Ÿå®¹å¿æ•´ä¸ªåŒºåŸŸçš„å¤±è´¥ã€‚æˆ‘ä»¬ä¸å»ºè®®è·¨åŒºåŸŸè¿›è¡Œé›†ç¾¤ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨æ›´é«˜çº§åˆ«çš„å·¥å…·æ¥ç®¡ç†å¤šé›†ç¾¤å’Œå¤šåŒºåŸŸç³»ç»Ÿã€‚ Microæ˜¯ä¸€ä¸ªéå¸¸çµæ´»çš„è¿è¡Œæ—¶ä¸å¯çŸ¥çš„å¾®æœåŠ¡ç³»ç»Ÿã€‚å®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å’Œä»»ä½•é…ç½®ä¸­è¿è¡Œã€‚å®ƒçš„ä¸–ç•Œè§‚æ˜¯ç”±æœåŠ¡æ³¨å†Œä¸­å¿ƒæŒ‡å¯¼çš„ã€‚æœåŠ¡é›†ç¾¤å¯ä»¥åœ¨ä¸€ç»„æœºå™¨ã€AZsæˆ–åŒºåŸŸä¸­è¿›è¡Œæœ¬åœ°åŒ–å’Œå‘½åç©ºé—´ï¼Œè¿™å®Œå…¨åŸºäºæ‚¨æä¾›æœåŠ¡è®¿é—®çš„æ³¨å†Œä¸­å¿ƒã€‚ç»“åˆNATSé›†ç¾¤ï¼Œå®ƒå…è®¸æ‚¨æ„å»ºä¸€ä¸ªé«˜åº¦å¯ç”¨çš„ä½“ç³»ç»“æ„æ¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ æ€»ç»“NATSæ˜¯ä¸€ä¸ªå¯æ‰©å±•å’Œæ€§èƒ½çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒéå¸¸é€‚åˆäºå¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿã€‚å®ƒä¸Microçš„å…³ç³»éå¸¸å¥½ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€æ¼”ç¤ºçš„ï¼Œå®ƒå¯ä»¥ä½œä¸ºæ³¨å†Œè¡¨ã€ä¼ è¾“æˆ–ä»£ç†çš„æ’ä»¶ã€‚æˆ‘ä»¬å·²ç»å®ç°äº†è¿™ä¸‰ç§åŠŸèƒ½ï¼Œä»¥å¼ºè°ƒNATSçš„çµæ´»æ€§ã€‚ å¾®è§‚ä¸Šçš„NATSæ˜¯å¾®è§‚å¼ºå¤§çš„å¯æ’å…¥æ¶æ„çš„ä¸€ä¸ªä¾‹å­ã€‚æ¯ä¸€ä¸ªå¾®å‹è½¯ä»¶åŒ…éƒ½å¯ä»¥å®ç°å¹¶ä»¥æœ€å°çš„å˜åŒ–äº¤æ¢å‡ºå»ã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°æ›´å¤šå…³äºå¾®è§‚çš„ä¾‹å­ã€‚ å¸Œæœ›è¿™èƒ½æ¿€åŠ±ä½ åœ¨NATSä¸Šè¯•ç”¨Microï¼Œç”šè‡³ä¸ºå…¶ä»–ç³»ç»Ÿç¼–å†™ä¸€äº›æ’ä»¶ï¼Œå¹¶å›é¦ˆç¤¾åŒºã€‚ åœ¨github.com/micro/go-pluginsä¸­æ‰¾åˆ°NATSæ’ä»¶çš„æºä»£ç ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"ç”¨Go Microç¼–å†™å¾®æœåŠ¡","slug":"go-micro","date":"2018-03-18T11:30:53.000Z","updated":"2020-07-25T02:57:18.206Z","comments":true,"path":"2018/03/18/go-micro/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/go-micro/","excerpt":"è¿™æ˜¯ä¸€ä¸ªé«˜æ°´å¹³çš„æŒ‡å¯¼ï¼Œç”¨go-microæ¥ç¼–å†™å¾®æœåŠ¡ã€‚ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šæœ‰å…³å¾®æœåŠ¡çš„å†…å®¹ï¼Œè¯·ç‚¹å‡»è¿™é‡Œçš„å…¥é—¨åšå®¢æ–‡ç« ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºMicroçš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œã€‚ è®©æˆ‘ä»¬å¼€å§‹å§ã€‚","text":"è¿™æ˜¯ä¸€ä¸ªé«˜æ°´å¹³çš„æŒ‡å¯¼ï¼Œç”¨go-microæ¥ç¼–å†™å¾®æœåŠ¡ã€‚ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šæœ‰å…³å¾®æœåŠ¡çš„å†…å®¹ï¼Œè¯·ç‚¹å‡»è¿™é‡Œçš„å…¥é—¨åšå®¢æ–‡ç« ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºMicroçš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œã€‚ è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ Go Microæ˜¯ä»€ä¹ˆ?Go Microæ˜¯ä¸€ä¸ªå¯æ’å…¥çš„RPCåº“ï¼Œå®ƒæä¾›äº†ç”¨äºç¼–å†™å¾®æœåŠ¡çš„åŸºæœ¬æ„ä»¶ã€‚å¾®å“²å­¦æ˜¯ç”¨å¯æ’æ‹”çš„ä½“ç³»ç»“æ„è®¾è®¡çš„â€œç”µæ± â€ã€‚ä»è¿™ä¸ªæ¡†ä¸­ï¼Œå®ƒå®ç°äº†ä½¿ç”¨ä»£ç†çš„æœåŠ¡å‘ç°ï¼Œé€šè¿‡httpå’Œä½¿ç”¨proto-rpcæˆ–json-rpcè¿›è¡Œç¼–ç  Go Microæ˜¯: Goå†™çš„åº“ ä¸€ç»„å¯æ’å…¥çš„æ¥å£ åŸºäºRPC Go Microæä¾›äº†æ¥å£: æœåŠ¡å‘ç° ç¼–ç  å®¢æˆ·ç«¯/æœåŠ¡ç«¯ å‘å¸ƒ/è®¢é˜… è¿™é‡Œå¯ä»¥æ‰¾åˆ°æ›´è¯¦ç»†çš„åˆ†ç±»ã€‚ ä¸ºä»€ä¹ˆè¦Go Micro?ä¸€å¹´å‰å°±å¼€å§‹åšGo Microï¼Œæœ€åˆæ˜¯ä¸ºä¸ªäººæœåŠ¡ã€‚ä¸ä¹…ä¹‹åï¼Œå¾ˆæ˜æ˜¾ï¼Œå®ƒå¯¹æ›´å¹¿æ³›çš„å—ä¼—æ¥è¯´ä¹Ÿå¾ˆæœ‰ä»·å€¼ï¼Œä»–ä»¬ä¹Ÿå¸Œæœ›ç¼–å†™å¾®æœåŠ¡ã€‚è¿™æ˜¯åŸºäºåœ¨è°·æ­Œå’ŒHailoç­‰è§„æ¨¡ç»è¥å¾®æœåŠ¡å¹³å°çš„å„ç§ç§‘æŠ€å…¬å¸çš„ç»éªŒã€‚ æ­£å¦‚å‰é¢æåˆ°çš„ï¼ŒGo Microæ˜¯ä¸€ä¸ªå¯æ’å…¥çš„ä½“ç³»ç»“æ„ï¼Œå®ƒä¾§é‡äºæä¾›åŸºäºGoçš„æ¥å£ï¼Œè¿™äº›æ¥å£åœ¨ä¸€èµ·ä½¿ç”¨æ—¶æä¾›äº†ç”¨äºç¼–å†™å¾®æœåŠ¡çš„æ„ä»¶ã€‚è¿™äº›æ¥å£å¯ä»¥é€šè¿‡å…·ä½“çš„å®ç°æ¥æ»¡è¶³ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å‘ç°çš„æ³¨å†Œæ¥å£æœ‰ä¸€ä¸ªé»˜è®¤çš„Consulå®ç°ï¼Œä½†æ˜¯å¯ä»¥ç”¨etcdã€zookeeperæˆ–å…¶ä»–ä»»ä½•èƒ½å¤Ÿæ»¡è¶³æ¥å£çš„åŠŸèƒ½äº¤æ¢ã€‚ å¦‚æœæ‚¨æƒ³è¦äº¤æ¢åº•å±‚æŠ€æœ¯ï¼Œå¯æ’æ‹”çš„ä½“ç³»ç»“æ„æ„å‘³ç€é›¶ä»£ç é‡å†™ã€‚ è®©æˆ‘ä»¬å¼€å§‹å†™ä¸€ä¸ªæœåŠ¡å§ã€‚ å†™ä¸€ä¸ªæœåŠ¡å¦‚æœæ‚¨æƒ³ç›´æ¥é˜…è¯»ä»£ç ï¼Œè¯·æŸ¥çœ‹examples/serviceã€‚ é¡¶å±‚æœåŠ¡æ¥å£æ˜¯æ„å»ºæœåŠ¡çš„ä¸»è¦ç»„ä»¶ã€‚å®ƒå°†æ‰€æœ‰çš„åº•å±‚Go MicroåŒ…å°è£…åˆ°ä¸€ä¸ªæ–¹ä¾¿çš„æ¥å£ä¸­ã€‚ 12345678type Service interface &#123; Init(...Option) Options() Options Client() client.Client Server() server.Server Run() error String() string&#125; 1. åˆå§‹åŒ–æœåŠ¡æ˜¯ç”¨micro.NewServiceåˆ›å»ºçš„ã€‚ 123import \"github.com/micro/go-micro\"service := micro.NewService() é€‰é¡¹å¯ä»¥åœ¨åˆ›å»ºæœŸé—´ä¼ å…¥ã€‚ 1234service := micro.NewService( micro.Name(\"greeter\"), micro.Version(\"latest\"),) è¿™é‡Œå¯ä»¥æ‰¾åˆ°æ‰€æœ‰å¯ç”¨çš„é€‰é¡¹ã€‚ Go Microè¿˜æä¾›äº†ä¸€ç§ä½¿ç”¨micro.Flagsè®¾ç½®å‘½ä»¤è¡Œæ ‡å¿—çš„æ–¹æ³•ã€‚ 12345678910111213import ( \"github.com/micro/cli\" \"github.com/micro/go-micro\")service := micro.NewService( micro.Flags( cli.StringFlag&#123; Name: \"environment\", Usage: \"The environment\", &#125;, )) è¦è§£ææ ‡è®°ä½¿ç”¨service.Initã€‚å¦å¤–ï¼Œè®¿é—®æ ‡å¿—ä½¿ç”¨micro.Action é€‰é¡¹ã€‚ 12345678service.Init( micro.Action(func(c *cli.Context) &#123; env := c.StringFlag(\"environment\") if len(env) &gt; 0 &#123; fmt.Println(\"Environment set to\", env) &#125; &#125;),) Go Microæä¾›é¢„å®šä¹‰çš„æ ‡å¿—ï¼Œå¦‚æœè°ƒç”¨äº†service.Initï¼Œå°±ä¼šè®¾ç½®å’Œè§£æè¿™äº›æ ‡å¿—ã€‚çœ‹è¿™é‡Œæ‰€æœ‰çš„flagsã€‚ 2. å®šä¹‰APIæˆ‘ä»¬ä½¿ç”¨protobufæ–‡ä»¶æ¥å®šä¹‰æœåŠ¡APIæ¥å£ã€‚è¿™æ˜¯ä¸¥æ ¼å®šä¹‰APIå¹¶ä¸ºæœåŠ¡å™¨å’Œå®¢æˆ·æœºæä¾›å…·ä½“ç±»å‹çš„éå¸¸æ–¹ä¾¿çš„æ–¹æ³•ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­å®šä¹‰ã€‚ greeter.proto 12345678910111213syntax = &quot;proto3&quot;;service Greeter &#123; rpc Hello(HelloRequest) returns (HelloResponse) &#123;&#125;&#125;message HelloRequest &#123; string name = 1;&#125;message HelloResponse &#123; string greeting = 2;&#125; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡å¤„ç†ç¨‹åºï¼Œå«åšGreeterï¼Œæ–¹æ³•æ˜¯Helloï¼Œå®ƒä½¿ç”¨å‚æ•°HelloRequestç±»å‹å¹¶è¿”å›HelloResponseã€‚ 3. ç”Ÿæˆçš„APIæ¥å£æˆ‘ä»¬ä½¿ç”¨protocå’Œprotoc-gen-goä¸ºè¿™ä¸ªå®šä¹‰ç”Ÿæˆå…·ä½“çš„goå®ç°ã€‚ Go-microä½¿ç”¨ä»£ç ç”Ÿæˆæ¥æä¾›å®¢æˆ·ç«¯å­˜æ ¹æ–¹æ³•æ¥å‡å°‘æ¿ä»£ç ï¼Œå°±åƒgRPCä¸€æ ·ã€‚å®ƒæ˜¯é€šè¿‡ä¸€ä¸ªprotobufæ’ä»¶éœ€è¦golang/protobuf,å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°github.com/micro/protobufã€‚ 12go get github.com/micro/protobuf/&#123;proto,protoc-gen-go&#125;protoc --go_out=plugins=micro:. greeter.proto ç”Ÿæˆçš„ç±»å‹ç°åœ¨å¯ä»¥å¯¼å…¥ï¼Œå¹¶åœ¨è¯·æ±‚æ—¶åœ¨æœåŠ¡å™¨æˆ–å®¢æˆ·æœºçš„å¤„ç†ç¨‹åºä¸­ä½¿ç”¨ã€‚ è¿™æ˜¯ç”Ÿæˆä»£ç çš„ä¸€éƒ¨åˆ†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051type HelloRequest struct &#123; Name string `protobuf:\"bytes,1,opt,name=name\" json:\"name,omitempty\"`&#125;type HelloResponse struct &#123; Greeting string `protobuf:\"bytes,2,opt,name=greeting\" json:\"greeting,omitempty\"`&#125;// Client API for Greeter servicetype GreeterClient interface &#123; Hello(ctx context.Context, in *HelloRequest, opts ...client.CallOption) (*HelloResponse, error)&#125;type greeterClient struct &#123; c client.Client serviceName string&#125;func NewGreeterClient(serviceName string, c client.Client) GreeterClient &#123; if c == nil &#123; c = client.NewClient() &#125; if len(serviceName) == 0 &#123; serviceName = \"greeter\" &#125; return &amp;greeterClient&#123; c: c, serviceName: serviceName, &#125;&#125;func (c *greeterClient) Hello(ctx context.Context, in *HelloRequest, opts ...client.CallOption) (*HelloResponse, error) &#123; req := c.c.NewRequest(c.serviceName, \"Greeter.Hello\", in) out := new(HelloResponse) err := c.c.Call(ctx, req, out, opts...) if err != nil &#123; return nil, err &#125; return out, nil&#125;// Server API for Greeter servicetype GreeterHandler interface &#123; Hello(context.Context, *HelloRequest, *HelloResponse) error&#125;func RegisterGreeterHandler(s server.Server, hdlr GreeterHandler) &#123; s.Handle(s.NewHandler(&amp;Greeter&#123;hdlr&#125;))&#125; 4. å®ç°å¤„ç†ç¨‹åºæœåŠ¡å™¨éœ€è¦ä¸ºæœåŠ¡è¯·æ±‚æ³¨å†Œ** handlersã€‚handleræ˜¯ä¸€ç§publicç±»å‹ï¼Œå…¶publicæ–¹æ³•ç¬¦åˆç­¾åfunc(ctx context.Context, req interface{}, rsp interface{}) errorã€‚ æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œä¸€ä¸ªç”¨äºGreeteræ¥å£çš„å¤„ç†ç¨‹åºç­¾åçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚ 123type GreeterHandler interface &#123; Hello(context.Context, *HelloRequest, *HelloResponse) error&#125; ä¸‹é¢æ˜¯Greeter handlerçš„ä¸€ä¸ªå®ç° 12345678import proto \"github.com/micro/examples/service/proto\"type Greeter struct&#123;&#125;func (g *Greeter) Hello(ctx context.Context, req *proto.HelloRequest, rsp *proto.HelloResponse) error &#123; rsp.Greeting = \"Hello \" + req.Name return nil&#125; handleråœ¨æ‚¨çš„æœåŠ¡ä¸­æ³¨å†Œçš„å¾ˆåƒhttp.Handlerã€‚ 12345service := micro.NewService( micro.Name(\"greeter\"),)proto.RegisterGreeterHandler(service.Server(), new(Greeter)) æ‚¨è¿˜å¯ä»¥åˆ›å»ºåŒå‘æµhandlerï¼Œä½†æˆ‘ä»¬å°†æŠŠå®ƒç•™åˆ°ä»¥åçš„ä¸€å¤©ã€‚ 5. è¿è¡ŒæœåŠ¡greeter.go è¯¥æœåŠ¡å¯ä»¥é€šè¿‡è°ƒç”¨server.Runæ¥è¿è¡Œã€‚è¿™ä¼šå¯¼è‡´æœåŠ¡ç»‘å®šåˆ°configä¸­çš„åœ°å€(é»˜è®¤è®¾ç½®ä¸ºæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªRFC1918æ¥å£å’Œä¸€ä¸ªéšæœºç«¯å£)å¹¶ä¾¦å¬è¯·æ±‚ã€‚ è¿™å°†åœ¨å‘å‡ºä¸€ä¸ªkillä¿¡å·æ—¶ï¼Œåœ¨å¼€å§‹æ—¶å’Œæ³¨é”€æ—¶å¯¹æœåŠ¡è¿›è¡Œæ³¨å†Œã€‚ 123if err := service.Run(); err != nil &#123; log.Fatal(err)&#125; 6. å®Œæ•´çš„æœåŠ¡greeter.go 1234567891011121314151617181920212223242526272829303132package mainimport ( \"log\" \"github.com/micro/go-micro\" proto \"github.com/micro/examples/service/proto\" \"golang.org/x/net/context\")type Greeter struct&#123;&#125;func (g *Greeter) Hello(ctx context.Context, req *proto.HelloRequest, rsp *proto.HelloResponse) error &#123; rsp.Greeting = \"Hello \" + req.Name return nil&#125;func main() &#123; service := micro.NewService( micro.Name(\"greeter\"), micro.Version(\"latest\"), ) service.Init() proto.RegisterGreeterHandler(service.Server(), new(Greeter)) if err := service.Run(); err != nil &#123; log.Fatal(err) &#125;&#125; è¯·æ³¨æ„ã€‚æœåŠ¡å‘ç°æœºåˆ¶éœ€è¦è¿è¡Œï¼Œå› æ­¤æœåŠ¡å¯ä»¥æ³¨å†Œä¸ºå®¢æˆ·æœºå’Œå…¶ä»–æœåŠ¡å‘ç°ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿå…¥é—¨ã€‚ ç¼–å†™ä¸€ä¸ªå®¢æˆ·ç«¯å®¢æˆ·ç«¯åŒ…ç”¨äºæŸ¥è¯¢æœåŠ¡ã€‚å½“æ‚¨åˆ›å»ºæœåŠ¡æ—¶ï¼Œå°†åŒ…å«ä¸€ä¸ªä¸æœåŠ¡å™¨ä½¿ç”¨çš„åˆå§‹åŒ…ç›¸åŒ¹é…çš„å®¢æˆ·ç«¯ã€‚ æŸ¥è¯¢ä¸Šè¿°æœåŠ¡å¦‚ä¸‹æ‰€ç¤ºã€‚ 12345678910111213// create the greeter client using the service name and clientgreeter := proto.NewGreeterClient(\"greeter\", service.Client())// request the Hello method on the Greeter handlerrsp, err := greeter.Hello(context.TODO(), &amp;proto.HelloRequest&#123; Name: \"John\",&#125;)if err != nil &#123; fmt.Println(err) return&#125;fmt.Println(rsp.Greeter) proto.NewGreeterClientä½¿ç”¨æœåŠ¡åç§°å’Œç”¨äºå‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚ å®Œæ•´çš„ä¾‹å­å¯ä»¥åœ¨go-micro/example/serviceä¸­æ‰¾åˆ°ã€‚ æ€»ç»“å¸Œæœ›è¿™ç¯‡åšæ–‡æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„é«˜çº§æŒ‡å—ï¼Œå¯ä»¥ç”¨Go Microæ¥ç¼–å†™å¾®æœåŠ¡ã€‚æ‚¨å¯ä»¥åœ¨repo github.com/microä¸­æ‰¾åˆ°æ›´å¤šçš„ç¤ºä¾‹æœåŠ¡ï¼Œä»¥å¸®åŠ©æ‚¨è¿›ä¸€æ­¥äº†è§£æ›´çœŸå®çš„ä¸–ç•Œè§£å†³æ–¹æ¡ˆã€‚ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºæˆ‘ä»¬æä¾›çš„æœåŠ¡æˆ–å¾®æœåŠ¡ï¼Œè¯·æ£€æŸ¥micro.muã€‚æˆ–è€…æ˜¯github repoã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"Micro - å¾®æœåŠ¡å·¥å…·åŒ…","slug":"micro","date":"2018-03-18T10:15:47.000Z","updated":"2020-07-25T02:57:18.215Z","comments":true,"path":"2018/03/18/micro/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/micro/","excerpt":"åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œä½ å¯èƒ½å·²ç»å¬è¯´è¿‡è¿™ç§æ–°çš„ç°è±¡ï¼Œå¾®æœåŠ¡ã€‚å¦‚æœä½ è¿˜ä¸ç†Ÿæ‚‰ï¼Œè€Œä¸”å¯¹å­¦ä¹ æ„Ÿå…´è¶£ï¼Œè¯·åœ¨æŸ¥çœ‹è¿™é‡Œã€‚ åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºMicroï¼Œä¸€ä¸ªå¼€æºçš„å¾®æœåŠ¡å·¥å…·åŒ…ã€‚Microæä¾›äº†æ„å»ºå’Œç®¡ç†å¾®æœåŠ¡çš„æ ¸å¿ƒéœ€æ±‚ã€‚å®ƒç”±ä¸€ç³»åˆ—çš„åº“å’Œå·¥å…·ç»„æˆï¼Œè¿™äº›åº“å’Œå·¥å…·ä¸»è¦é¢å‘Goè¯­è¨€çš„ç¼–ç¨‹å¼€å‘ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨Sidecaræ¥è§£å†³å…¶ä»–è¯­è¨€çš„é—®é¢˜ã€‚ åœ¨æˆ‘ä»¬äº†è§£å¾®è§‚çš„ç»†èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆä¸ºä»€ä¹ˆæˆ‘ä»¬å†³å®šæŠŠæ—¶é—´èŠ±åœ¨è¿™ä¸Šé¢ã€‚","text":"åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œä½ å¯èƒ½å·²ç»å¬è¯´è¿‡è¿™ç§æ–°çš„ç°è±¡ï¼Œå¾®æœåŠ¡ã€‚å¦‚æœä½ è¿˜ä¸ç†Ÿæ‚‰ï¼Œè€Œä¸”å¯¹å­¦ä¹ æ„Ÿå…´è¶£ï¼Œè¯·åœ¨æŸ¥çœ‹è¿™é‡Œã€‚ åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºMicroï¼Œä¸€ä¸ªå¼€æºçš„å¾®æœåŠ¡å·¥å…·åŒ…ã€‚Microæä¾›äº†æ„å»ºå’Œç®¡ç†å¾®æœåŠ¡çš„æ ¸å¿ƒéœ€æ±‚ã€‚å®ƒç”±ä¸€ç³»åˆ—çš„åº“å’Œå·¥å…·ç»„æˆï¼Œè¿™äº›åº“å’Œå·¥å…·ä¸»è¦é¢å‘Goè¯­è¨€çš„ç¼–ç¨‹å¼€å‘ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨Sidecaræ¥è§£å†³å…¶ä»–è¯­è¨€çš„é—®é¢˜ã€‚ åœ¨æˆ‘ä»¬äº†è§£å¾®è§‚çš„ç»†èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆä¸ºä»€ä¹ˆæˆ‘ä»¬å†³å®šæŠŠæ—¶é—´èŠ±åœ¨è¿™ä¸Šé¢ã€‚ å¼€å‘æˆ–éƒ¨ç½²ä»æˆ‘ä»¬è¿‡å»çš„ç»éªŒå’Œæˆ‘ä»¬åœ¨ä¸šç•Œæ‰€çœ‹åˆ°çš„æƒ…å†µæ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨å¼€å‘è€Œä¸æ˜¯éƒ¨ç½²ã€‚PaaSè§£å†³æ–¹æ¡ˆæ˜¯ç°æˆçš„ã€‚AWSã€è°·æ­Œå’Œå¾®è½¯ç­‰å…¬å¸éƒ½æä¾›äº†åŠŸèƒ½ä¸°å¯Œçš„å¹³å°ï¼Œè€Œä¸”å¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œå®ƒä»¬ä¹Ÿä¼šè¿…é€Ÿè½¬å‘æ”¯æŒå®¹å™¨ç¼–æ’ã€‚æ‰€æœ‰è¿™ä¸€åˆ‡ä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡ç‚¹å‡»å‡ ä¸ªæŒ‰é’®æ¥è®¿é—®å¤§è§„æ¨¡çš„è®¡ç®—ã€‚ è¿™ä¸ªæ–°ä¸–ç•Œå¬èµ·æ¥ä¸é”™ã€‚ä½ å¯èƒ½ä¼šè¯´è¿™è§£å†³äº†ä½ æ‰€æœ‰çš„é—®é¢˜ï¼Œå¯¹å§?è™½ç„¶æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨å¤§è§„æ¨¡çš„è®¡ç®—èƒ½åŠ›ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ç¼ºä¹èƒ½å¤Ÿä½¿æˆ‘ä»¬ç¼–å†™èƒ½å¤Ÿåˆ©ç”¨å®ƒçš„è½¯ä»¶çš„å·¥å…·ã€‚ä¸ä»…å¦‚æ­¤ï¼Œåœ¨è¿™ä¸ªæ–°çš„ä¸–ç•Œä¸­ï¼Œå®¹å™¨å¯èƒ½ä¼šæ›´åŠ çŸ­æš‚ï¼Œéšç€è¿è¡Œæ—¶é‡æ–°å®‰æ’å®ƒä»¬æˆ–å®ƒä»¬æ­£åœ¨è¿è¡Œçš„æœºå™¨çš„å¤±è´¥ï¼Œå®¹å™¨ä¼šå˜å¾—æ›´åŠ çŸ­æš‚ã€‚ æ‰©å±•çš„æŒ‘æˆ˜æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œç»„ç»‡æ˜¯å¦‚ä½•æˆä¸ºå…¶æ•´ä½“æ¶æ„çš„ç‰ºç‰²å“çš„ã€‚ç”±äºéœ€è¦ä»¥æå¿«çš„é€Ÿåº¦å¢é•¿ï¼Œæœ‰ä¸€ç§è¶‹åŠ¿æ˜¯å°†åŠŸèƒ½å¡è¿›ç°æœ‰ç³»ç»Ÿï¼Œå¹¶å¯¼è‡´æŠ€æœ¯å€ºåŠ¡ï¼Œä½¿é›ªçƒé™·å…¥æ— æ³•æ§åˆ¶çš„å±€é¢ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå½“ç»„ç»‡è¯•å›¾å¢åŠ å·¥ç¨‹å›¢é˜Ÿçš„æ—¶å€™ï¼Œå¼€å‘äººå‘˜åœ¨å•ä¸ªä»£ç åŸºç¡€ä¸Šè¿›è¡Œåä½œï¼Œæˆ–è€…å¹¶è¡Œåœ°è¿›è¡Œç‰¹æ€§å¼€å‘ï¼Œè€Œä¸åœ¨å‘å¸ƒæ—¶è¢«é˜»å¡ï¼Œè¿™å°†å˜å¾—æ›´åŠ å›°éš¾ã€‚ å¯¹äºSOAæˆ–åŸºäºå¾®æœåŠ¡çš„æ¶æ„æ¥è¯´ï¼Œé‡æ„å’Œæœ€ç»ˆè·¯å¾„æ˜¯ä¸å¯é¿å…çš„ã€‚å…¬å¸æœ€ç»ˆä¼šåœ¨æˆ¿å­é‡Œè¿›è¡Œç ”å‘å·¥ä½œï¼Œé€šè¿‡å°è¯•å’Œé”™è¯¯æ¥å­¦ä¹ ã€‚å¦‚æœæœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©åˆ›å»ºå¯ä¼¸ç¼©çš„ç³»ç»Ÿï¼Œå‡å°‘ç ”å‘çš„å¯èƒ½æ€§ï¼Œå¹¶ä»è¿‡å»çš„ç»éªŒä¸­æä¾›ä¸“ä¸šçŸ¥è¯†ã€‚ è¿›å…¥Microåœ¨Microæ–¹é¢ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªå¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨äºå¾®æœåŠ¡å¼€å‘çš„å·¥å…·ã€æœåŠ¡å’Œè§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªåŒåçš„å·¥å…·æ¥æ„å»ºè¿™ä¸ªç”Ÿæ€ç³»ç»Ÿçš„åŸºç¡€ã€‚Microæ˜¯ä¸€ä¸ªå¾®å‹æœåŠ¡å·¥å…·åŒ…ï¼Œå®ƒå¯ä»¥åˆ›å»ºå¯ä¼¸ç¼©çš„ä½“ç³»ç»“æ„ï¼Œå¹¶æé«˜æ‰§è¡Œé€Ÿåº¦ã€‚ è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹Microçš„ç‰¹å¾ã€‚ Go MicroGo Microæ˜¯ä¸€ä¸ªå¯æ’å…¥çš„RPCæ¡†æ¶ï¼Œç”¨äºåœ¨Goä¸­æ„å»ºå¾®æœåŠ¡ã€‚å®ƒæä¾›äº†åˆ›å»ºã€å‘ç°å’Œä¸æœåŠ¡é€šä¿¡æ‰€éœ€çš„åŸºæœ¬ç‰¹æ€§ã€‚ä»»ä½•ä¼˜ç§€çš„å¾®æœåŠ¡ä½“ç³»ç»“æ„çš„æ ¸å¿ƒéƒ½å§‹äºæœåŠ¡å‘ç°ã€åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡ã€‚ åŒ…æ‹¬åŒ…è£…å’Œç‰¹ç‚¹: Registry - å®¢æˆ·ç«¯æœåŠ¡å‘ç° Transport - åŒæ­¥é€šä¿¡ Broker - å¼‚æ­¥é€šä¿¡ Selector - èŠ‚ç‚¹è¿‡æ»¤å’Œè´Ÿè½½å¹³è¡¡ Codec - æ¶ˆæ¯ç¼–ç /è§£ç  Server - æ„å»ºåœ¨ä¸Šé¢çš„RPCæœåŠ¡å™¨ Client - æ„å»ºåœ¨ä¸Šé¢çš„RPCå®¢æˆ·ç«¯ ä¸å¤§å¤šæ•°åº“ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯å¯æ’æ‹”çš„ä½“ç³»ç»“æ„ã€‚è¿™å…è®¸å°†æ¯ä¸ªåŒ…çš„å®ç°å’Œåç«¯ç³»ç»Ÿäº¤æ¢å‡ºå»ã€‚ä¾‹å¦‚;æ³¨å†Œè¡¨çš„é»˜è®¤æœåŠ¡å‘ç°æœºåˆ¶æ˜¯Consulï¼Œä½†è¿™å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸etcdã€zookeeperæˆ–å…¶ä»–æ‚¨é€‰æ‹©å®ç°çš„æ’ä»¶äº¤æ¢ã€‚æˆ‘ä»¬æ­£åœ¨å®ç°çš„æ’ä»¶å¯ä»¥åœ¨github.com/micro/go-pluginsä¸Šæ‰¾åˆ°ã€‚ å¯æ’æ‹”ç³»ç»Ÿçš„ä»·å€¼åœ¨äºèƒ½å¤Ÿé€‰æ‹©ç”¨äºæ”¯æŒå¾®æœåŠ¡çš„å¹³å°ï¼Œè€Œæ— éœ€é‡å†™ä»»ä½•ä»£ç ã€‚Go Microè¦æ±‚é›¶ä»£ç æ›´æ”¹ï¼Œåªéœ€å¯¼å…¥ä¸€ä¸ªæ’ä»¶å°±å¯ä»¥äº†ã€‚ Go Microæ˜¯å†™å¾®æœåŠ¡çš„èµ·ç‚¹ã€‚readmeæä¾›äº†å¦‚ä½•ç¼–å†™ã€è¿è¡Œå’ŒæŸ¥è¯¢æœåŠ¡çš„æ¦‚è¿°ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­ï¼Œåœ¨repo github.com/microä¸­æä¾›äº†micro/example/greeterå’Œæ›´å¤šçš„ç¤ºä¾‹æœåŠ¡ã€‚ SidecarGo Microæä¾›äº†ä¸€ç§æ–¹å¼Goæ¥ç¼–å†™æœåŠ¡ï¼Œä½†æ˜¯å…¶ä»–è¯­è¨€å‘¢?æˆ‘ä»¬å¦‚ä½•åˆ›å»ºä¸€ä¸ªpolygotç”Ÿæ€ç³»ç»Ÿï¼Œè®©ä»»ä½•äººéƒ½èƒ½åˆ©ç”¨Microçš„ä¼˜åŠ¿?è™½ç„¶Microæ˜¯å†™åœ¨Goä¸Šçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è®©ä¸€ä¸ªå¿«é€Ÿç®€å•çš„æ–¹æ³•æ¥é›†æˆç”¨ä»»ä½•è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºã€‚ è¿›å…¥Sidecarï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§çš„ä¼™ä¼´æœåŠ¡ï¼Œå®ƒåœ¨æ¦‚å¿µä¸Šâ€œé™„åŠ â€åˆ°ä¸»(å³çˆ¶çº§)åº”ç”¨ç¨‹åºï¼Œå¹¶é€šè¿‡æä¾›Microç³»ç»Ÿçš„ç‰¹æ€§æ¥è¡¥å……å®ƒã€‚sidecaræ˜¯ä¸€ä¸ªä¸æ‚¨çš„åº”ç”¨ç¨‹åºå¹¶è¡Œè¿è¡Œçš„è¿›ç¨‹ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªHTTPæ¥å£å®ç°äº†Go Microçš„ç‰¹æ€§ã€‚ sidecarçš„ç‰¹ç‚¹: æ³¨å†Œä¸å‘ç°ç³»ç»Ÿ ä¸»æœºå‘ç°å…¶ä»–æœåŠ¡ ä¸»åº”ç”¨ç¨‹åºçš„å¥åº·æ£€æŸ¥ ç”¨äºå‘å‡ºRPCè¯·æ±‚çš„ä»£ç† é€šè¿‡WebSocketsçš„PubSub å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ä½¿ç”¨å¸¦æœ‰rubyæˆ–pythonçš„Sidecarçš„ä¾‹å­ã€‚æˆ‘ä»¬å°†åœ¨ä¸ä¹…çš„å°†æ¥æ·»åŠ æ›´å¤šçš„ç¤ºä¾‹ä»£ç ï¼Œä»¥å¸®åŠ©ç†è§£å¦‚ä½•é›†æˆsidecarã€‚ APIå°†RPCè¯·æ±‚ä»ä¸€ä¸ªæœåŠ¡å‘é€åˆ°å¦ä¸€ä¸ªæœåŠ¡éå¸¸ç®€å•ï¼Œä½†å¯¹äºå¤–éƒ¨è®¿é—®å¹¶ä¸ç†æƒ³ã€‚æœåŠ¡çš„å®ä¾‹å¯èƒ½ä¼šå¤±è´¥ï¼Œå®ƒä»¬å¯èƒ½è¢«é‡æ–°å®‰æ’åˆ°å…¶ä»–åœ°æ–¹ï¼Œæˆ–è€…æœ€ç»ˆç»‘å®šåˆ°ä»»æ„çš„ç«¯å£ã€‚è¯¥APIä¸ºæŸ¥è¯¢å¾®æœåŠ¡æä¾›äº†ä¸€ä¸ªå•ä¸€å…¥å£ç‚¹ï¼Œå¹¶åº”ä½œä¸ºå¤–éƒ¨è®¿é—®çš„ç½‘å…³ã€‚ è¯¥APIæä¾›äº†ä¸€äº›ä¸åŒç±»å‹çš„è¯·æ±‚å¤„ç†ç¨‹åºã€‚ /rpcå¯ä»¥ä½¿ç”¨/rpcç«¯ç‚¹é€šè¿‡RPCæŸ¥è¯¢å•ä¸ªæœåŠ¡ã€‚ä¾‹å­: 1234567curl \\ -d \"service=go.micro.srv.greeter\" \\ -d \"method=Say.Hello\" \\ -d \"request=&#123;\\\"name\\\": \\\"John\\\"&#125;\" \\ http://localhost:8080/rpc&#123;\"msg\":\"Hello John\"&#125; api.Requestè¯¥APIå¯ç”¨äºåˆ†è§£ç”±å•ä¸ªå¾®æœåŠ¡æä¾›çš„urlã€‚è¿™æ˜¯ä¸€ç§å¼ºå¤§çš„APIç»„åˆæ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼ŒAPIä½¿ç”¨è¯·æ±‚è·¯å¾„çš„ç¬¬ä¸€éƒ¨åˆ†ä»¥åŠåç§°ç©ºé—´ç»„ä»¶æ¥ç¡®å®šè¦è·¯ç”±è¯·æ±‚çš„æœåŠ¡ã€‚ç„¶åï¼ŒHTTPè¯·æ±‚è¢«è½¬æ¢ä¸ºä¸€ä¸ªapi.Requestï¼Œå¹¶é€‚å½“åœ°è½¬å‘ã€‚ åœ¨Microä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ›å»ºAPIå¾®æœåŠ¡çš„æ¨¡å¼æ¥æœåŠ¡äºè¾¹ç¼˜çš„è¯·æ±‚ã€‚åˆ†ç¦»åç«¯å’Œå‰ç«¯æœåŠ¡çš„èŒè´£ã€‚ APIè¯·æ±‚å¤„ç†çš„ä¸€ä¸ªä¾‹å­: è¯·æ±‚ 1GET /greeter/say/hello?name=John å˜æˆ 123456789service: go.micro.api.greeter (default namespace go.micro.api is applied)method: Say.Hellorequest &#123; &quot;method&quot;: &quot;GET&quot;, &quot;path&quot;: &quot;/greeter/say/hello&quot;, &quot;get&quot;: &#123; &quot;name&quot;: &quot;John&quot; &#125;&#125; api.Request å’Œ api.Responseçš„ç»“æ„: 123456789101112131415161718192021syntax = &quot;proto3&quot;;message Pair &#123; optional string key = 1; repeated string values = 2;&#125;message Request &#123; optional string method = 1; // GET, POST, etc optional string path = 2; // e.g /greeter/say/hello map&lt;string, Pair&gt; header = 3; map&lt;string, Pair&gt; get = 4; // The URI query params map&lt;string, Pair&gt; post = 5; // The post body params optional string body = 6; // raw request body; if not application/x-www-form-urlencoded&#125;message Response &#123; optional int32 statusCode = 1; map&lt;string, Pair&gt; header = 2; optional string body = 3;&#125; å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¦‚ä½•åˆ›å»ºAPIæœåŠ¡çš„ç¤ºä¾‹ã€‚ Greeter API proxyAPIçš„è¯·æ±‚å¤„ç†çš„æœ€ç»ˆæ–¹æ³•æ˜¯åå‘ä»£ç†ã€‚æ­£å¦‚ä¸Šé¢æ‰€è¿°ï¼ŒAPIä½¿ç”¨è¯·æ±‚è·¯å¾„å’Œåç§°ç©ºé—´ç»„ä»¶æ¥ç¡®å®šè¦è·¯ç”±è¯·æ±‚çš„æœåŠ¡ã€‚é€šè¿‡æä¾›åå‘ä»£ç†å’Œå¾®æœåŠ¡è¯·æ±‚è·¯ç”±ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ”¯æŒRESTï¼Œè¿™æ˜¯ä¸€ç§å¹¿æ³›è¿½æ±‚çš„éœ€æ±‚ã€‚ é€šè¿‡ä¼ é€’â€“api_handler=proxyæ ‡å¿—ï¼Œå¯ä»¥å¯ç”¨ä»£ç†ã€‚ å¦‚ä½•æ„å»ºä¸€ä¸ªRESTful APIçš„ä¸€ä¸ªä¾‹å­å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°micro/examples/greeter/apiã€‚ Web UIweb UIæä¾›äº†ä¸€ä¸ªç®€å•çš„æŒ‡ç¤ºæ¿ï¼Œç”¨äºè§‚å¯Ÿå’Œä¸è¿è¡Œçš„ç³»ç»Ÿäº¤äº’ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜æä¾›äº†ä¸APIéå¸¸ç›¸ä¼¼çš„åå‘ä»£ç†ã€‚æˆ‘ä»¬çš„â€œwebä»£ç†â€çš„ç›®æ ‡æ˜¯ä½¿webåº”ç”¨ç¨‹åºçš„å¼€å‘æˆä¸ºå¾®æœåŠ¡ã€‚åŒæ ·ï¼Œå°±åƒAPIä¸€æ ·ï¼Œè¯·æ±‚è·¯å¾„ä¸åç§°ç©ºé—´ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®å®šè¦è·¯ç”±è¯·æ±‚çš„æœåŠ¡ã€‚webä»£ç†è¿˜æ”¯æŒweb socketsï¼Œå› ä¸ºæˆ‘ä»¬è®¤ä¸ºå®æ—¶æ˜¯äº¤ä»˜webåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ CLICLIæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒæä¾›äº†åœ¨è¿è¡Œç¯å¢ƒä¸­è§‚å¯Ÿã€äº¤äº’å’Œç®¡ç†æœåŠ¡çš„æ–¹æ³•ã€‚å½“å‰çš„ç‰¹æ€§é›†å…è®¸æ‚¨æ£€æŸ¥æ³¨å†Œè¡¨ã€æ£€æŸ¥æœåŠ¡çš„åŸºæœ¬å¥åº·çŠ¶å†µå¹¶å¯¹æœåŠ¡æœ¬èº«æ‰§è¡ŒæŸ¥è¯¢ã€‚ å¦ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§æ˜¯ä½¿ç”¨Sidecarä½œä¸ºCLIçš„ä»£ç†çš„èƒ½åŠ›ã€‚è¿™å°±åƒåœ¨æ‰§è¡ŒCLIæ—¶æŒ‡å®šsidecarçš„åœ°å€ä½œä¸ºæ ‡å¿—ä¸€æ ·ç®€å•â€“proxy_address=example.proxy.comã€‚ æŠŠå®ƒæ”¾åœ¨ä¸€èµ·æˆ‘ä»¬å·²ç»é€šè¿‡ä½¿ç”¨ç®€å•çš„greeteræœåŠ¡ç¼–å†™äº†ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯æµç¨‹ç¤ºä¾‹ã€‚ æµç¨‹å¦‚ä¸‹: HTTP GETè¯·æ±‚name=Johnè¢«å‘é€åˆ°/greeter/say/helloçš„micro API APIå°†è¿™ä¸ªä½¿ç”¨é»˜è®¤åç§°ç©ºé—´è½¬æ¢ä¸ºAPIæœåŠ¡go.micro.api.greeterå’Œæ–¹æ³•Say.Helloã€‚è¯·æ±‚çš„ç»“æ„æ˜¯ä¸€ä¸ªapi.Requestã€‚ ä½¿ç”¨Go Microçš„APIï¼ŒæŸ¥è¯¢æ³¨å†Œè¡¨ä»¥æŸ¥æ‰¾æœåŠ¡go.micro.apiçš„æ‰€æœ‰èŠ‚ç‚¹ã€‚å°†è¯·æ±‚è½¬å‘ç»™èŠ‚ç‚¹ã€‚ greeter apiè§£æè¯·æ±‚ï¼Œç”Ÿæˆhelloã€‚è¯·æ±‚å¹¶è¯·æ±‚rpcæœåŠ¡go.micro.srv.greeterã€‚åŒæ ·ï¼Œä½¿ç”¨ç›¸åŒçš„æ³¨å†Œè¡¨/å‘ç°æœºåˆ¶æ¥æŸ¥æ‰¾æœåŠ¡çš„èŠ‚ç‚¹ã€‚ greeter rpcæœåŠ¡ä½¿ç”¨hello.Responseå“åº”ã€‚ greeter apiå°†å“åº”è½¬æ¢ä¸ºapi.Responseå¹¶å°†å…¶ä¼ å›APIã€‚ micro APIè§£æå“åº”å¹¶å“åº”å®¢æˆ·æœºçš„HTTPè¯·æ±‚ã€‚ åœ¨ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ä¸­ï¼ŒAPIæœåŠ¡å¯ä»¥è°ƒç”¨è®¸å¤šå…¶ä»–RPCæœåŠ¡ï¼Œèšåˆå’Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æœ€ç»ˆçš„æ±‡æ€»ç»“æœä¼ é€’ç»™å®¢æˆ·æœºã€‚è¿™å…è®¸æ‚¨åœ¨ä¸äº†è§£å®¢æˆ·æœºçš„æƒ…å†µä¸‹ï¼Œåœ¨åå°ç»´æŠ¤ä¸€è‡´çš„å¤–éƒ¨å…¥å£ç‚¹å’Œæ›´æ”¹æœåŠ¡ã€‚ Domeå¦‚æœä½ æƒ³åœ¨è¿è¡Œçš„ç³»ç»Ÿä¸Šï¼Œè¯·åœ¨web.micro.pmå¤„æŸ¥çœ‹æˆ‘ä»¬çš„æ¼”ç¤ºã€‚ æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨è°·æ­Œé›†è£…ç®±å¼•æ“åœ¨Kubernetesä¸Šè¿è¡ŒMicroã€‚æ¼”ç¤ºæ˜¯å¼€æºçš„ï¼Œå¦‚æœæ‚¨æƒ³è‡ªå·±è¿è¡Œå®ƒã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œgithub.com/micro/kubernetesæ‰¾åˆ°k8sé…ç½®ã€‚ æ€»ç»“Microä¸ºç¼–å†™å’Œç®¡ç†å¾®æœåŠ¡æä¾›äº†åŸºæœ¬çš„æ„å»ºæ¨¡å—ã€‚å¾®è§‚åŒ…æ‹¬æ ¸å¿ƒéœ€æ±‚;å‘ç°ã€å®¢æˆ·æœº/æœåŠ¡å™¨å’Œå‘å¸ƒ/è®¢é˜…ã€‚CLIè®©æ‚¨ä¸ç¯å¢ƒå’ŒæœåŠ¡äº¤äº’ã€‚sidecarå¯ä»¥é›†æˆä»»ä½•éå¾®åº”ç”¨ç¨‹åºã€‚è¯¥APIæ˜¯rpcè¯·æ±‚çš„å•ä¸€å…¥å£ç‚¹ï¼Œå¯ä»¥åˆ›å»ºRESTç«¯ç‚¹ã€‚æœ‰äº†å¯æ’å…¥çš„æ¥å£ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å¹¶é€‰æ‹©æ‚¨æƒ³è¦åˆ©ç”¨çš„ç³»ç»Ÿæ¥æ„å»ºæ‚¨çš„ä½“ç³»ç»“æ„ã€‚ æˆ‘ä»¬åœ¨Microä¸Šçš„ç›®æ ‡æ˜¯åœ¨è§„æ¨¡ä¸Šå®ç°å¼€å‘ï¼Œæé«˜æ‰§è¡Œé€Ÿåº¦ï¼Œå¹¶ä»å¼€å‘äººå‘˜ç”Ÿå‘½å‘¨æœŸçš„æœ€åˆé˜¶æ®µå¼€å§‹æä¾›ä»·å€¼ã€‚æˆ‘ä»¬è§‰å¾—Microæ˜¯åšæ‰€æœ‰è¿™äº›äº‹æƒ…çš„æœ€å¥½æ–¹æ³•ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå·¥å…·çš„ç”Ÿæ€ç³»ç»Ÿå°†ä¼šå‘å±•åˆ°åŒ…å«æ›´å¤šçš„åŠŸèƒ½ä¸°å¯Œçš„æœåŠ¡ï¼Œç”¨äºå‘ç°ã€è·¯ç”±å’Œå¯è½¬æ¢æ€§ã€‚ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºæˆ‘ä»¬æä¾›çš„æœåŠ¡æˆ–å¾®æœåŠ¡ï¼Œè¯·æ£€æŸ¥micro.muã€‚æˆ–è€…æ˜¯github repoã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"ä»‹ç»Micro - å¾®æœåŠ¡ç³»ç»Ÿ","slug":"micro-introduction","date":"2018-03-18T09:38:06.000Z","updated":"2020-07-25T02:57:18.213Z","comments":true,"path":"2018/03/18/micro-introduction/","link":"","permalink":"https://jigangduan.github.io/2018/03/18/micro-introduction/","excerpt":"Hello World! è®©æˆ‘ä»¬æ¥è°ˆè°ˆè½¯ä»¶å¼€å‘çš„æœªæ¥ã€‚ æ”¹å˜æ­£åœ¨è¿›è¡Œä¹‹ä¸­ã€‚æˆ‘ä»¬æ­£è¶Šæ¥è¶Šå¤šåœ°èµ°å‘ä¸€ä¸ªä»¥ç§‘æŠ€ä¸ºæ ¸å¿ƒçš„ä¸–ç•Œã€‚åœ¨å½“ä»Šæ—¶ä»£ï¼Œä¿æŒç«äº‰ä¼˜åŠ¿æ­£å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚ç»„ç»‡çš„æ‰§è¡Œèƒ½åŠ›ä¼šéšç€ä»–ä»¬è¯•å›¾æ‰©å±•ä½æ•ˆçš„å¹³å°ã€è¿‡ç¨‹å’Œç»“æ„è€Œé™·å…¥åœé¡¿ã€‚åå¹´å‰ï¼Œç§‘æŠ€å…¬å¸ç»å†äº†è¿™äº›è§„æ¨¡çš„é˜µç—›ï¼Œå¤§å¤šæ•°å…¬å¸éƒ½é‡‡ç”¨äº†åŒæ ·çš„æ–¹æ³•æ¥å…‹æœè¿™äº›æŒ‘æˆ˜ã€‚ æ˜¯æ—¶å€™æŠŠä¸–ç•Œä¸Šæœ€æˆåŠŸçš„å…¬å¸çš„ç«äº‰ä¼˜åŠ¿å¸¦ç»™å…¶ä»–äººäº†ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆå¾®æœåŠ¡ï¼Œä¸€ç§åˆ›é€ ç«äº‰ä¼˜åŠ¿çš„æ–¹æ³•ã€‚","text":"Hello World! è®©æˆ‘ä»¬æ¥è°ˆè°ˆè½¯ä»¶å¼€å‘çš„æœªæ¥ã€‚ æ”¹å˜æ­£åœ¨è¿›è¡Œä¹‹ä¸­ã€‚æˆ‘ä»¬æ­£è¶Šæ¥è¶Šå¤šåœ°èµ°å‘ä¸€ä¸ªä»¥ç§‘æŠ€ä¸ºæ ¸å¿ƒçš„ä¸–ç•Œã€‚åœ¨å½“ä»Šæ—¶ä»£ï¼Œä¿æŒç«äº‰ä¼˜åŠ¿æ­£å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚ç»„ç»‡çš„æ‰§è¡Œèƒ½åŠ›ä¼šéšç€ä»–ä»¬è¯•å›¾æ‰©å±•ä½æ•ˆçš„å¹³å°ã€è¿‡ç¨‹å’Œç»“æ„è€Œé™·å…¥åœé¡¿ã€‚åå¹´å‰ï¼Œç§‘æŠ€å…¬å¸ç»å†äº†è¿™äº›è§„æ¨¡çš„é˜µç—›ï¼Œå¤§å¤šæ•°å…¬å¸éƒ½é‡‡ç”¨äº†åŒæ ·çš„æ–¹æ³•æ¥å…‹æœè¿™äº›æŒ‘æˆ˜ã€‚ æ˜¯æ—¶å€™æŠŠä¸–ç•Œä¸Šæœ€æˆåŠŸçš„å…¬å¸çš„ç«äº‰ä¼˜åŠ¿å¸¦ç»™å…¶ä»–äººäº†ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆå¾®æœåŠ¡ï¼Œä¸€ç§åˆ›é€ ç«äº‰ä¼˜åŠ¿çš„æ–¹æ³•ã€‚ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿå¾®æœåŠ¡æ˜¯ä¸€ç§è½¯ä»¶ä½“ç³»ç»“æ„æ¨¡å¼ï¼Œç”¨äºå°†å¤§å‹å•å—åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºæ›´å°çš„å¯ç®¡ç†çš„ç‹¬ç«‹æœåŠ¡ï¼Œè¿™äº›æœåŠ¡é€šè¿‡è¯­è¨€æ— å…³åè®®è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”æ¯ä¸€é¡¹éƒ½ä¸“æ³¨äºåšå¥½ä¸€ä»¶äº‹ã€‚ è¡Œä¸šä¸“å®¶å¯¹å¾®æœåŠ¡çš„å®šä¹‰ï¼š æ¾æ•£è€¦åˆçš„é¢å‘æœåŠ¡çš„ä½“ç³»ç»“æ„ï¼Œå…·æœ‰æœ‰ç•Œçš„ä¸Šä¸‹æ–‡ã€‚Adrian Cockcroft - å°†å•ä¸ªåº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€å¥—å°å‹æœåŠ¡çš„æ–¹æ³•ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œå¹¶ä½¿ç”¨è½»é‡çº§æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚é©¬ä¸ å¾®æœåŠ¡çš„æ¦‚å¿µå¹¶ä¸æ–°é²œï¼Œè¿™æ˜¯å¯¹æœåŠ¡å®šå‘æ¶æ„çš„é‡æ–°è®¾æƒ³ï¼Œä½†é‡‡ç”¨çš„æ–¹æ³•æ›´ç¬¦åˆunixè¿›ç¨‹å’Œç®¡é“ã€‚ å¾®æœåŠ¡æ¶æ„çš„ç†å¿µ: æœåŠ¡æ˜¯å°ç²’åº¦çš„ï¼Œä½œä¸ºä¸€ä¸ªå•ä¸€çš„ä¸šåŠ¡ç”¨é€”ï¼Œç±»ä¼¼äºunixçš„â€œåšä¸€ä»¶äº‹ï¼Œåšå¥½å®ƒâ€çš„å“²å­¦ ç»„ç»‡æ–‡åŒ–åº”è¯¥æ‹¥æŠ±éƒ¨ç½²å’Œæµ‹è¯•çš„è‡ªåŠ¨åŒ–ã€‚è¿™å‡è½»äº†ç®¡ç†å’Œæ“ä½œçš„è´Ÿæ‹…ã€‚ æ–‡åŒ–å’Œè®¾è®¡åŸåˆ™åº”è¯¥åŒ…å«å¤±è´¥å’Œé”™è¯¯ï¼Œç±»ä¼¼äºåè„†å¼±ç³»ç»Ÿã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨å¾®æœåŠ¡ï¼Ÿéšç€ç»„ç»‡è§„æ¨¡çš„æ‰©å¤§ï¼ŒæŠ€æœ¯å’Œäººå‘˜æ•°é‡çš„å¢åŠ ï¼Œç®¡ç†å•ä¸€çš„ä»£ç åº“å˜å¾—æ›´åŠ å›°éš¾ã€‚æˆ‘ä»¬éƒ½ä¹ æƒ¯äº†æ¨ç‰¹å¤±è´¥çš„é²¸é±¼ä¸€æ®µæ—¶é—´ï¼Œå› ä¸ºä»–ä»¬è¯•å›¾æ‰©å¤§ä»–ä»¬çš„ç”¨æˆ·åŸºç¡€å’Œäº§å“ç‰¹æ€§é›†ä¸ä¸€ä¸ªæ•´ä½“ç³»ç»Ÿã€‚å¾®æœåŠ¡ä½¿Twitterèƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºæ›´å°çš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å¯ä»¥ç”±è®¸å¤šä¸åŒçš„å›¢é˜Ÿå•ç‹¬ç®¡ç†ã€‚æ¯ä¸ªå›¢é˜Ÿè´Ÿè´£ç”±è®¸å¤šå¾®æœåŠ¡ç»„æˆçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œè¿™äº›æœåŠ¡å¯ä»¥ç‹¬ç«‹äºå…¶ä»–å›¢é˜Ÿéƒ¨ç½²ã€‚ æˆ‘ä»¬é€šè¿‡ç¬¬ä¸€æ‰‹çš„ç»éªŒäº†è§£åˆ°ï¼Œå¾®æœåŠ¡ç³»ç»Ÿæ”¯æŒæ›´å¿«çš„å¼€å‘å‘¨æœŸã€æ”¹è¿›çš„ç”Ÿäº§åŠ›å’Œå“è¶Šçš„å¯ä¼¸ç¼©ç³»ç»Ÿã€‚ è®©æˆ‘ä»¬æ¥è°ˆè°ˆå…¶ä¸­çš„ä¸€äº›å¥½å¤„: æ›´å®¹æ˜“æ‰©å±•å¼€å‘ â€”â€” å›¢é˜Ÿå›´ç»•ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œç»„ç»‡ï¼Œå¹¶ç®¡ç†ä»–ä»¬è‡ªå·±çš„æœåŠ¡ã€‚ æ›´å®¹æ˜“ç†è§£ â€”â€” å¾®æœåŠ¡è¦å°å¾—å¤šï¼Œé€šå¸¸æ˜¯1000 LOCæˆ–æ›´å°‘ã€‚ æ›´å®¹æ˜“éƒ¨ç½²æ–°ç‰ˆæœ¬çš„æœåŠ¡ â€”â€”æœåŠ¡å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚ æ”¹è¿›çš„å®¹é”™å’Œéš”ç¦» â€”â€”å…³æ³¨çš„åˆ†ç¦»æœ€å°åŒ–äº†ä»å¦ä¸€ä¸ªæœåŠ¡ä¸­äº§ç”Ÿçš„é—®é¢˜çš„å½±å“ã€‚ æ”¹è¿›çš„æ‰§è¡Œé€Ÿåº¦ â€”â€”å›¢é˜Ÿç‹¬ç«‹åœ°å¼€å‘ã€éƒ¨ç½²å’Œç®¡ç†å¾®æœåŠ¡ï¼Œä»è€Œæ›´å¿«åœ°äº¤ä»˜ä¸šåŠ¡éœ€æ±‚ã€‚ å¯é‡ç”¨çš„æœåŠ¡å’Œå¿«é€Ÿçš„åŸå‹ â€”â€”åœ¨microservicesä¸­æ ¹æ·±è’‚å›ºçš„unixå“²å­¦å…è®¸æ‚¨é‡ç”¨ç°æœ‰çš„æœåŠ¡ï¼Œå¹¶åœ¨ä¸Šé¢æ›´å¿«åœ°æ„å»ºå…¨æ–°çš„åŠŸèƒ½ã€‚ ä»€ä¹ˆæ˜¯Micro?Microæ˜¯ä¸€ä¸ªå¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿï¼Œè‡´åŠ›äºä¸ºç°ä»£è½¯ä»¶é©±åŠ¨ä¼ä¸šæä¾›äº§å“ã€æœåŠ¡å’Œè§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬è®¡åˆ’æˆä¸ºä»»ä½•ä¸å¾®æœåŠ¡ç›¸å…³çš„å®é™…èµ„æºï¼Œå¹¶å°†ä½¿å…¬å¸èƒ½å¤Ÿåˆ©ç”¨è¿™é¡¹æŠ€æœ¯ä¸ºè‡ªå·±çš„ä¼ä¸šæœåŠ¡ã€‚ä»æ—©æœŸçš„åŸå‹å¼€å‘ä¸€ç›´åˆ°å¤§è§„æ¨¡çš„ç”Ÿäº§éƒ¨ç½²ã€‚ æˆ‘ä»¬çœ‹åˆ°äº†è¡Œä¸šçš„æ ¹æœ¬æ€§è½¬å˜ã€‚æ‘©å°”å®šå¾‹æ˜¯æœ‰æ•ˆçš„ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½èƒ½è·å¾—è¶Šæ¥è¶Šå¤šçš„è®¡ç®—èƒ½åŠ›ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ— æ³•å……åˆ†è®¤è¯†åˆ°è¿™ç§æ–°çš„èƒ½åŠ›ã€‚åœ¨è¿™ä¸ªæ–°æ—¶ä»£ï¼Œç°æœ‰çš„å·¥å…·å’Œå¼€å‘å®è·µæ²¡æœ‰è§„æ¨¡ã€‚å¼€å‘äººå‘˜æ²¡æœ‰æä¾›ä»å•ç‰‡ä»£ç åŸºè½¬ç§»åˆ°æ›´æœ‰æ•ˆçš„è®¾è®¡æ¨¡å¼çš„å·¥å…·ã€‚å¤§å¤šæ•°å…¬å¸éƒ½ä¸å¯é¿å…åœ°è¦è¾¾åˆ°ä¸€ä¸ªä»¥æ•´ä½“è®¾è®¡æ¥å‡å°‘å›æŠ¥çš„ç¨‹åº¦ï¼Œå¹¶ä¸”å¿…é¡»è¿›è¡Œå¤§è§„æ¨¡çš„ç ”å‘å†é€ å·¥ä½œã€‚Netfixã€Twitterã€Giltå’ŒHailoéƒ½æ˜¯è¿™æ–¹é¢çš„ä¸»è¦ä¾‹å­ã€‚æœ€ç»ˆï¼Œä»–ä»¬éƒ½å»ºç«‹äº†è‡ªå·±çš„å¾®æœåŠ¡å¹³å°ã€‚ æˆ‘ä»¬çš„æ„¿æ™¯æ˜¯æä¾›åŸºæœ¬çš„æ„å»ºæ¨¡å—ï¼Œè®©ä»»ä½•äººéƒ½æ›´å®¹æ˜“é‡‡ç”¨å¾®æœåŠ¡ã€‚ æˆ‘ä»¬ç”¨ä¸€ä¸ªå¼€æºçš„å¾®æœåŠ¡å·¥å…·åŒ…(ä¹Ÿå«åšMicro)æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æœŸå¾…ä¸€ä¸ªåç»­çš„åšå®¢è¯¦ç»†ä»‹ç»è¿™ä¸ªå·¥å…·åŒ…ã€‚ ç°åœ¨è¯¥åšä»€ä¹ˆ?å½“ä½ å¬åˆ°â€œå¾®æœåŠ¡â€è¿™ä¸ªè¯æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä½ èƒ½æƒ³åˆ°å¾®æœåŠ¡ç”Ÿæ€ç³»ç»Ÿã€‚ å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºæˆ‘ä»¬æä¾›çš„æœåŠ¡æˆ–å¾®æœåŠ¡ï¼Œè¯·æ£€æŸ¥micro.muã€‚æˆ–è€…æ˜¯github repoã€‚","categories":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"}],"tags":[{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"}]},{"title":"WebAPP æ¡†æ¶æ–¹æ¡ˆè®¨è®º","slug":"WebApp","date":"2018-03-01T15:54:43.000Z","updated":"2020-07-25T02:57:18.171Z","comments":true,"path":"2018/03/01/WebApp/","link":"","permalink":"https://jigangduan.github.io/2018/03/01/WebApp/","excerpt":"æ¡†æ¶éœ€æ±‚ H5\båº”ç”¨å¼€å‘\b\b\b\bå“åº”å¿«é€Ÿå¼€å‘ \bå¤š\bå®¢æˆ·çš„å®šåˆ¶åŒ– \b\bä¸åŒ\bé¡¹ç›®å‘ˆç°ä¸åŒçš„\båŠŸèƒ½æ¨¡å— ç§»åŠ¨ç«¯\b\båŸç”ŸåŠŸèƒ½çš„æ”¯æŒ å‡çº§\bè¿­ä»£çš„ä¾¿åˆ©æ€§","text":"æ¡†æ¶éœ€æ±‚ H5\båº”ç”¨å¼€å‘\b\b\b\bå“åº”å¿«é€Ÿå¼€å‘ \bå¤š\bå®¢æˆ·çš„å®šåˆ¶åŒ– \b\bä¸åŒ\bé¡¹ç›®å‘ˆç°ä¸åŒçš„\båŠŸèƒ½æ¨¡å— ç§»åŠ¨ç«¯\b\båŸç”ŸåŠŸèƒ½çš„æ”¯æŒ å‡çº§\bè¿­ä»£çš„ä¾¿åˆ©æ€§ ç›®å‰WebAPPæ–¹æ¡ˆå¯¹æ¯” React Native Ionic H5+ å¾®ä¿¡å°ç¨‹åº æ¡†æ¶æ–¹æ¡ˆæ€è·¯ APPï¼š \båŸç”ŸAPPï¼ŒMAå®¹å™¨åŠŸèƒ½å’Œ\b\b\b\bç®¡ç†åŠŸèƒ½ã€‚ MA: å¾®åº”ç”¨ï¼ŒH5+\b\b\bå®ç°çš„å¾®å°åº”ç”¨ã€‚\bå°½é‡åŠŸèƒ½å•ä¸€ï¼Œä½“é‡å°ã€‚ WebView: \b\bç»è¿‡\bå°è£…åŸç”ŸWebView,\b\b\bå°è£…å\b\bç»è¿‡\b\b\b\bæ¡¥æ¥\b\b\bæ’ä»¶æ”¯æŒH5+ plug: æ’ä»¶ï¼Œ\b\bæ¡¥æ¥JSå’ŒåŸç”ŸAPI Sï¼š æœåŠ¡ç«¯å¾®\bæœåŠ¡ ACS: MA\b\bæ³¨å†Œ\bæœåŠ¡ï¼Œ\bè®°å½•åˆ—è¡¨-æœåŠ¡ç«¯\b\b\b\båŒ…å«çš„å¾®\båº”ç”¨ UCSï¼šç”¨æˆ·é…ç½®\b\b\bæœåŠ¡ï¼Œ\bè®°å½•åˆ—è¡¨-ç”¨æˆ·\béœ€è¦çš„å¾®åº”ç”¨ \bæ€è·¯\bç®€ä»‹ ç§»åŠ¨ç«¯APP\b\b\b\bä¸åŒ…æ‹¬\b\bä»»ä½•\b\bä¸šåŠ¡é€»è¾‘ï¼Œ\bä¸šåŠ¡\båŠŸèƒ½åªæŒ‰æ¨¡å—\båˆ†å¸ƒäºå„ä¸ªå¾®åº”ç”¨MAä¸­ã€‚ MAé€šè¿‡H5+å®ç°\bå•ä¸€/ç®€å•çš„\båŠŸèƒ½ï¼Œè¢«\bæ‰“åŒ…æˆèµ„æºåŒ…ï¼Œ\bå­˜å‚¨\b\båœ¨æœåŠ¡å™¨\b\b\b\b\b\b\b\b\bå¾®åº”ç”¨ä»“åº“ä¸­ã€‚ ACS/UCS è®°å½•/ç®¡ç†å¾®åº”ç”¨\bä»“åº“å’Œç”¨æˆ·\bå¾®åº”ç”¨éœ€æ±‚ APP\bé€šè¿‡ACS/UCSï¼Œ å‘ç°/åŠ è½½/å‡çº§ å¾®åº”ç”¨ APPé€šè¿‡WebViewå¯åŠ¨\bå¾®åº”ç”¨ï¼Œè¿è¡Œ\b\bä¸šåŠ¡åŠŸèƒ½ ä¸»è¦\bæ¶‰åŠçš„åŠŸèƒ½ WebView\båŠ è½½\b\bæœ¬åœ°MAèµ„æº H5+ æ’ä»¶å¼€å‘\bè°ƒç”¨\båŸç”ŸAPI MAèµ„æº\bç®¡ç† MAèµ„æºé…ç½®è·å– \bMAèµ„æº\bç½‘ç»œåŠ è½½ MAèµ„æº\bæœ¬åœ°ç®¡ç† \b\bç§»åŠ¨ç«¯æƒé™è·å– \bå£³APPçš„\bå…¶å®ƒåŠŸèƒ½ éœ€è¦è€ƒè™‘çš„é—®é¢˜ \bé…ç½®ä¿¡æ¯\b\b\bè§„èŒƒ ç§»åŠ¨ç«¯æƒé™ç®¡ç† æ’ä»¶å¼€å‘ å¾®\båº”ç”¨ä¹‹é—´éœ€è¦\bé€šä¿¡å—ï¼Ÿå¦‚ä½•\bé€šä¿¡ï¼Ÿ \b\bæ€§èƒ½è¦æ±‚ H5çš„æµç•…\båº¦ MAèµ„æºåŒ…çš„åŠ è½½é€Ÿåº¦ H5åœ¨å„ä¸ªAndroidç³»ç»Ÿä¸­çš„é€‚é…é—®é¢˜ \b\båæœŸï¼Œæ¯æ·»åŠ ä¸€ä¸ªæ’ä»¶\béƒ½éœ€è¦\bAPPçš„æ‰“åŒ…ä¸Šæ¶ï¼Œ\bå»ºè®®\b\b\b\b\b\b\b\b\bå‡å°‘ä¸Šæ¶æ¬¡æ•° \bå¯èƒ½å­˜åœ¨é—®é¢˜/\bé£é™© iOSä¸Šæ¶\bé£é™©ï¼ŒH5 APPä¸Šæ¶çš„ä¸ç¡®å®šæ€§ é€‚é…é—®é¢˜çš„å„ç§\bå‘ï¼ˆWebAppçš„å‘ï¼‰ H5+ Engineçš„å°é—­æ€§ï¼Œæ²¡æœ‰å¼€æºï¼Œå¤ªä¾èµ–5+SDK åç»­ä»»åŠ¡ \bæ–¹æ¡ˆçš„\bå¯è¡Œæ€§\b \b\b\bç ”ç©¶æ’ä»¶å¼€å‘çš„å®ç°æ–¹å¼","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"WebAPP","slug":"å‰ç«¯/WebAPP","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/WebAPP/"}],"tags":[{"name":"webapp","slug":"webapp","permalink":"https://jigangduan.github.io/tags/webapp/"}]},{"title":"ä½¿ç”¨Expoå·¥ä½œ","slug":"expo-working-with-expo","date":"2018-02-08T04:15:06.000Z","updated":"2020-07-25T02:57:18.201Z","comments":true,"path":"2018/02/08/expo-working-with-expo/","link":"","permalink":"https://jigangduan.github.io/2018/02/08/expo-working-with-expo/","excerpt":"","text":"å¯åŠ¨å’Œè¿è¡Œåˆ›å»ºä¸€ä¸ªå¸æˆ·æ‰“å¼€XDEåï¼Œå°†æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚å¡«å…¥ä½ æƒ³è¦çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åç‚¹å‡»ç»§ç»­-å¦‚æœç”¨æˆ·åè¿˜æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºå¸æˆ·ã€‚ åˆ›å»ºé¡¹ç›®æŒ‰ä¸‹Projectå¹¶é€‰æ‹©New Projectï¼Œç„¶åé€‰æ‹©é€‰é¡¹Tab Navigationé€‰é¡¹ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªè‰¯å¥½çš„èµ·ç‚¹ï¼Œç„¶ååœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥é¡¹ç›®åç§°ã€‚æˆ‘å°†è°ƒç”¨æˆ‘çš„first-projectï¼Œå¹¶æŒ‰ä¸‹åˆ›å»ºã€‚ æ¥ä¸‹æ¥ï¼Œé€‰æ‹©ä¿å­˜é¡¹ç›®çš„ä½ç½®ã€‚æˆ‘æŠŠæ‰€æœ‰æœ‰è¶£çš„é¡¹ç›®éƒ½ä¿å­˜åœ¨~/codingä¸­ï¼Œæ‰€ä»¥æˆ‘å¯¼èˆªåˆ°é‚£ä¸ªç›®å½•å¹¶æŒ‰ä¸‹æ‰“å¼€ã€‚ XDEç°åœ¨åœ¨é€‰æ‹©çš„ç›®å½•ä¸­åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›®:å®ƒå¤åˆ¶ä¸€ä¸ªåŸºæœ¬çš„æ¨¡æ¿ï¼Œå¹¶å®‰è£…reactã€react-nativeå’Œexpoã€‚ å½“é¡¹ç›®åˆå§‹åŒ–å¹¶å‡†å¤‡å¥½æ—¶ï¼Œæ‚¨å°†åœ¨XDEæ—¥å¿—ä¸­çœ‹åˆ°&quot;React packager ready&quot;çš„æ¶ˆæ¯ã€‚ â€œReact packagerâ€æ˜¯ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨Babelç¼–è¯‘æˆ‘ä»¬çš„åº”ç”¨JavaScriptä»£ç ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°ä¸–åšä¼šåº”ç”¨ç¨‹åºä¸­ã€‚ æ³¨æ„:å¦‚æœä½ åœ¨MacOSä¸Šï¼ŒXDEè¢«å›°åœ¨â€œWaiting for packager and tunnel to startâ€çš„æ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ä½ çš„æœºå™¨ä¸Šå®‰è£…watchmanã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨Homebrewï¼Œbrew install watchmanã€‚ åœ¨ä½ çš„æ‰‹æœºæˆ–æ¨¡æ‹Ÿå™¨ä¸Šæ‰“å¼€åº”ç”¨ä½ ä¼šå‘ç°XDEæ˜¾ç¤ºä½ ä¸€ä¸ªURL http://4v-9wa.notbrent.mynewproject.exp.direct:80-å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å®ƒï¼Œä½ ä¼šçœ‹åˆ°å®ƒæä¾›äº†ä¸€äº›JSONã€‚è¿™ä¸ªJSONæ˜¯Expoçš„æ¸…å•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„æ‰‹æœºä¸Šæ‰“å¼€åº”ç”¨ç¨‹åºï¼ŒæŠŠè¿™ä¸ªURLè¾“å…¥åœ°å€æ ã€‚æˆ–è€…ï¼ŒæŒ‰ä¸‹åˆ†äº«ï¼Œè¾“å…¥ä½ çš„ç”µè¯å·ç ï¼Œç„¶åæŒ‰å‘é€é“¾æ¥ã€‚æ‰“å¼€ä½ çš„æ‰‹æœºä¸Šçš„ä¿¡æ¯ï¼Œç‚¹å‡»é“¾æ¥ï¼Œåœ¨Expoä¸Šæ‰“å¼€å®ƒã€‚ä½ å¯ä»¥å’Œä»»ä½•å®‰è£…äº†Expo appçš„äººåˆ†äº«è¿™ä¸ªé“¾æ¥ï¼Œä½†æ˜¯åªè¦ä½ åœ¨XDEä¸­æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œå®ƒå°±ä¼šè¢«ä½¿ç”¨ã€‚ è¦åœ¨iOSæ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€åº”ç”¨ï¼Œä½ å¯ä»¥æŒ‰ä¸‹DeviceæŒ‰é’®ï¼Œé€‰æ‹©Open on iOS Simulator(macOS)ã€‚è¦åœ¨Androidæ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œé¦–å…ˆè¦å¯åŠ¨å®ƒï¼Œç„¶åæŒ‰ä¸‹Deviceï¼Œç„¶ååœ¨Open on Androidã€‚ ç¬¬ä¸€æ¬¡ä¿®æ”¹åœ¨æ‚¨çš„æ–°é¡¹ç›®ä¸­æ‰“å¼€screens/HomeScreen.jsï¼Œå¹¶æ›´æ”¹render()å‡½æ•°ä¸­çš„ä»»ä½•æ–‡æœ¬ã€‚ä½ åº”è¯¥çœ‹åˆ°ä½ çš„åº”ç”¨é‡æ–°è½½å…¥ä½ çš„æ”¹å˜ã€‚ çœ‹ä¸å‡ºä½ çš„å˜åŒ–å—?Liveé‡è½½æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œä½†æ˜¯è®©æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›æ­¥éª¤æ¥å¯ç”¨å®ƒï¼Œä»¥é˜²æ­¢åœ¨æŸç§æƒ…å†µä¸‹æ— æ³•æ­£å¸¸å·¥ä½œã€‚ é¦–å…ˆï¼Œç¡®ä¿åœ¨XDEä¸­å¯ç”¨äº†å¼€å‘æ¨¡å¼ã€‚ æ¥ä¸‹æ¥ï¼Œå…³é—­åº”ç”¨ç¨‹åºå¹¶é‡æ–°æ‰“å¼€å®ƒã€‚ ä¸€æ—¦åº”ç”¨å†æ¬¡æ‰“å¼€ï¼Œä½ å°±å¯ä»¥æ‘‡æ™ƒä½ çš„è®¾å¤‡æ¥æ˜¾ç¤ºå¼€å‘è€…èœå•ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿå™¨ï¼Œè¯·æŒ‰ä¸‹âŒ˜+dåœ¨iOSæˆ–ctrl+måœ¨Androidã€‚ å¦‚æœä½ çœ‹åˆ°Enable Live Reloadï¼ŒæŒ‰ä¸‹å®ƒï¼Œä½ çš„åº”ç”¨å°±ä¼šé‡æ–°åŠ è½½ã€‚å¦‚æœæ‚¨çœ‹åˆ°äº†Disable Live Reloadï¼Œé‚£ä¹ˆé€€å‡ºå¼€å‘äººå‘˜èœå•å¹¶å°è¯•è¿›è¡Œå¦ä¸€ä¸ªæ›´æ”¹ã€‚ æ‰‹åŠ¨é‡æ–°åŠ è½½åº”ç”¨ç¨‹åº å¦‚æœæ‚¨å·²ç»æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œäº†é‡æ–°åŠ è½½ï¼Œä»ç„¶æ²¡æœ‰å·¥ä½œï¼Œè¯·æŒ‰ä¸‹XDEå³ä¸‹è§’çš„æŒ‰é’®æ¥å‘é€ä¸€ä¸ªæ”¯æŒè¯·æ±‚ã€‚åœ¨æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæ‚¨å¯ä»¥æ‘‡åŠ¨è®¾å¤‡å¹¶æŒ‰ä¸‹Reloadï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å·¥å…·ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥åŒæ—¶ä½¿ç”¨æ²¡æœ‰å¼€å‘æ¨¡å¼çš„å·¥å…·ã€‚ ç¥è´ºä½ æ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Expoé¡¹ç›®ï¼Œè¿›è¡Œäº†æ›´æ”¹ï¼Œå¹¶çœ‹åˆ°äº†å®ƒçš„æ›´æ–°ã€‚ æœ¯è¯­è¡¨app.jsonapp.jsonæ˜¯ä¸€ä¸ªä¸ºæ¯ä¸ªExpoé¡¹ç›®è€Œå­˜åœ¨çš„æ–‡ä»¶ï¼Œå®ƒè¢«ç”¨æ¥é…ç½®ä½ çš„é¡¹ç›®ï¼Œä¾‹å¦‚åå­—ã€å›¾æ ‡å’Œsplash screenã€‚æ›´å¤šä¿¡æ¯è¯·é˜…è¯»â€œapp.jsonçš„é…ç½®â€ create-react-native-appReact Nativeä¸create-react-appæ˜¯ä¸€æ ·çš„ã€‚æ‚¨å¯ä»¥è®¾ç½®å¹¶åˆ›å»ºä¸€ä¸ªæ— éœ€æ„å»ºé…ç½®çš„React Native appï¼Œå¹¶ä½¿ç”¨Expoæ¥å®Œæˆè¿™ä¸€ä»»åŠ¡ã€‚è¯·é˜…è¯»æ›´å¤šçš„â€œExpoå’Œåˆ›é€ React Native Appâ€ã€‚ åˆ†ç¦»â€œåˆ†ç¦»â€ä¸€è¯åœ¨Expoä¸Šè¢«ç”¨äºæè¿°ç¦»å¼€èˆ’é€‚çš„æ ‡å‡†Expoå¼€å‘ç¯å¢ƒï¼Œåœ¨è¿™é‡Œä½ ä¸å¿…å¤„ç†æ„å»ºé…ç½®æˆ–æœ¬åœ°ä»£ç ã€‚å½“ä½ ä»Expoâ€œåˆ†ç¦»â€çš„æ—¶å€™ï¼Œä½ ä¼šå¾—åˆ°ExpoKitçš„åŸç”Ÿé¡¹ç›®ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨Expoçš„apiæ¥å»ºé€ ä½ çš„é¡¹ç›®ï¼Œä½†æ˜¯ä½ çš„å·¥ä½œæµç¨‹å’Œä½ åœ¨æ²¡æœ‰Expoçš„æƒ…å†µä¸‹å»ºç«‹ä¸€ä¸ªååº”çš„æœ¬åœ°åº”ç”¨æ˜¯ä¸€æ ·çš„ã€‚è¯¦æƒ…è¯·é˜…è¯»â€œåˆ†ç¦»ExpoKitâ€ã€‚ ejectâ€œejectâ€è¿™ä¸ªè¯æ˜¯ç”±create-react-appæ¨å¹¿çš„ï¼Œå®ƒè¢«ç”¨äºcreate-react-native-appã€‚å½“ä½ â€œejectâ€ä½ çš„é¡¹ç›®æ—¶ï¼Œä½ ä¼šé‡‡å–æ›´æç«¯çš„æ­¥éª¤ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ†ç¦»â€”â€”ä½ å¤±å»äº†å¯¹Expo APIsçš„è®¿é—®ï¼Œå®Œå…¨ç¦»å¼€äº†Expoçš„ç¯å¢ƒã€‚é˜…è¯»æ›´å¤šå…³äºejectingã€‚ EmulatorEmulatorç”¨äºæè¿°æ‚¨çš„è®¡ç®—æœºä¸Šçš„Androidè®¾å¤‡çš„è½¯ä»¶ä»¿çœŸå™¨ã€‚é€šå¸¸ï¼ŒiOSæ¨¡æ‹Ÿå™¨è¢«ç§°ä¸ºSimulatorsã€‚ expç”¨äºä¸Expoåˆä½œçš„å‘½ä»¤è¡Œå·¥å…·ã€‚é˜…è¯»æ›´å¤šã€‚ ä½“éªŒåº”ç”¨ç¨‹åºçš„åŒä¹‰è¯é€šå¸¸æ„å‘³ç€æ›´å•ä¸€çš„ç”¨é€”å’Œæ›´å°çš„èŒƒå›´ï¼Œæœ‰æ—¶æ˜¯è‰ºæœ¯çš„å’Œå¼‚æƒ³å¤©å¼€çš„ Expo ClientExpo SDKExpoKitExpoKitæ˜¯ä¸€ä¸ªObjective-Cå’ŒJavaåº“ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨Expo SDKå’Œå¹³å°ä»¥åŠä½ ç°æœ‰çš„Expoé¡¹ç›®ï¼Œä½œä¸ºä¸€ä¸ªæ›´å¤§çš„æ ‡å‡†åŸç”Ÿé¡¹ç›®çš„ä¸€éƒ¨åˆ†â€”â€”ä½ é€šå¸¸ä¼šç”¨Xcodeã€Android Studioæˆ–è€…react-native initæ¥åˆ›å»ºè¿™ä¸ªé¡¹ç›®ã€‚é˜…è¯»æ›´å¤šã€‚ iOSåœ¨iPhoneã€iPadå’Œè‹¹æœç”µè§†ä¸Šä½¿ç”¨çš„æ“ä½œç³»ç»Ÿã€‚Expoç›®å‰åœ¨iOSç‰ˆiPhoneå’ŒiPadä¸Šè¿è¡Œã€‚ é“¾æ¥Manifestæœ¬åœ°ç›®å½•npmOver the Air updatesåŒ…ç®¡ç†å™¨å‘å¸ƒReact NativeShell appSimulatorSlugæˆ‘ä»¬åœ¨app.jsonä¸­ä½¿ç”¨â€œslugâ€è¿™ä¸ªè¯ï¼ŒæŒ‡çš„æ˜¯å®ƒçš„urlä¸­åº”ç”¨ç¨‹åºçš„åç§°ã€‚ä¾‹å¦‚ï¼ŒNative Componentåˆ—è¡¨åº”ç”¨ç¨‹åºå°±ç”Ÿæ´»åœ¨https://expo.io/@community/native-component-listå’Œslugæ˜¯native-component-listã€‚ SnackSnackæ˜¯ä¸€ç§æµè§ˆå™¨å¼€å‘ç¯å¢ƒï¼Œä½ å¯ä»¥åœ¨ä½ çš„æ‰‹æœºæˆ–ç”µè„‘ä¸Šä¸å®‰è£…ä»»ä½•å·¥å…·ï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œå»ºç«‹Expoä½“éªŒã€‚ ç‹¬ç«‹appä¸€ä¸ªå¯ä»¥æäº¤åˆ°iOSåº”ç”¨å•†åº—æˆ–Android Playå•†åº—çš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ›´å¤šåœ°é˜…è¯»â€œæ„å»ºç‹¬ç«‹åº”ç”¨â€ã€‚ XDEä¸€ä¸ªå¸¦æœ‰å›¾å½¢ç”¨æˆ·ç•Œé¢(GUI)çš„æ¡Œé¢å·¥å…·ï¼Œç”¨äºä¸Expoé¡¹ç›®åˆä½œã€‚å®ƒä¸exp CLIå·¥å…·çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä½†é€‚ç”¨äºæ›´ç†Ÿæ‚‰GUIçš„äººã€‚ yarnä¸€ä¸ªç”¨äºJavaScriptçš„åŒ…ç®¡ç†å™¨ã€‚æ›´å¤š ä½¿ç”¨app.jsoné…ç½®app.jsonæ˜¯ä½ ç”¨æ¥é…ç½®ä¸å±äºä»£ç çš„éƒ¨åˆ†åº”ç”¨ç¨‹åºçš„é¦–é€‰ä¹‹åœ°ã€‚å®ƒä½äºæ‚¨çš„é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œç´§é‚»æ‚¨çš„package.jsonã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„: 12345678&#123; \"expo\": &#123; \"name\": \"My app\", \"slug\": \"my-app\", \"sdkVersion\": \"25.0.0\", \"privacy\": \"public\" &#125;&#125; app.jsonä¹‹å‰è¢«ç§°ä¸ºexp.jsonï¼Œä½†æ˜¯ä¸ºäº†ä¿æŒä¸ Create React Native Appçš„ä¸€è‡´æ€§ï¼Œå®ƒå·²ç»è¢«åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚å¦‚æœæ‚¨æ­£åœ¨å°†æ‚¨çš„åº”ç”¨ç¨‹åºä»ä½¿ç”¨exp.jsonè½¬æ¢ä¸ºapp.jsonï¼Œé‚£ä¹ˆæ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨app.jsonçš„æ ¹ä¸Šæ·»åŠ ä¸€ä¸ªâ€œexpoâ€é”®ï¼Œä½œä¸ºæ‰€æœ‰å…¶ä»–é”®çš„çˆ¶å…ƒç´ ã€‚ å¤§å¤šæ•°æ¥è‡ªapp.jsonçš„é…ç½®åœ¨è¿è¡Œæ—¶éƒ½å¯ä»¥é€šè¿‡Expo.Constants.manifestçš„JavaScriptä»£ç è®¿é—®ã€‚è¯¸å¦‚å¯†åŒ™ä¹‹ç±»çš„æ•æ„Ÿä¿¡æ¯è¢«åˆ é™¤ã€‚æœ‰å…³å¦‚ä½•å°†ä»»æ„é…ç½®æ•°æ®ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸‹é¢çš„&quot;extra&quot;é”®ã€‚ ä¸‹é¢æ˜¯åœ¨app.jsonçš„&quot;extra&quot;å…³é”®å­—ä¸‹é¢æä¾›çš„å±æ€§åˆ—è¡¨: name å¿…éœ€ã€‚ä½ çš„appçš„åå­—åœ¨Expoä¸Šå’Œä½ çš„homeå±å¹•ä¸Šéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹appã€‚ description ç®€çŸ­åœ°æè¿°ä¸€ä¸‹ä½ çš„åº”ç”¨æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä¸ºä»€ä¹ˆå¾ˆæ£’ã€‚ slug å¿…éœ€ã€‚ç”¨äºå‘å¸ƒçš„å‹å¥½urlåç§°ã€‚ä¾‹å¦‚:expo.io/@your-username/slugã€‚ privacy publicæˆ–unlistedã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œåˆ™é»˜è®¤ä¸ºunlistedã€‚åœ¨æœªæ¥ï¼Œprivateå°†å¾—åˆ°æ”¯æŒã€‚unlistedéšè—äº†æœç´¢ç»“æœçš„ç»éªŒã€‚æœ‰æ•ˆå€¼:publicã€unlisted sdkVersion å¿…éœ€ã€‚è¿è¡Œé¡¹ç›®çš„Expo sdkVersionã€‚è¿™åº”è¯¥ä¸æ‚¨çš„package.jsonä¸­æŒ‡å®šçš„ç‰ˆæœ¬ä¸€è‡´ã€‚ version ä½ çš„appç‰ˆæœ¬ï¼Œä½¿ç”¨ä½ å–œæ¬¢çš„ä»»ä½•ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆã€‚ platforms æ‚¨çš„é¡¹ç›®æ˜ç¡®æ”¯æŒçš„å¹³å°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå®ƒä¼šé»˜è®¤ä¸º[&quot;ios&quot;, &quot;android&quot;]ã€‚ githubUrl å¦‚æœä½ æƒ³åœ¨Githubä¸Šåˆ†äº«ä½ çš„åº”ç”¨ç¨‹åºçš„æºä»£ç ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œè¾“å…¥å­˜å‚¨åº“çš„URLï¼Œå®ƒå°†é“¾æ¥åˆ°ä½ çš„Expoé¡¹ç›®é¡µé¢ã€‚ orientation æŠŠä½ çš„åº”ç”¨ç¨‹åºé”å®šåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–¹å‘ä¸Šï¼Œç”¨portraitæˆ–landscapeã€‚é»˜è®¤ä¸ºæ²¡æœ‰é”ã€‚æœ‰æ•ˆå€¼:â€˜defaultâ€™, â€˜portraitâ€™, â€˜landscapeâ€™ primaryColor åœ¨Androidä¸Šï¼Œè¿™å°†å†³å®šä½ çš„åº”ç”¨åœ¨å¤šä»»åŠ¡çš„é¢œè‰²ã€‚ç›®å‰è¿™æ¬¾åº”ç”¨è¿˜æ²¡æœ‰åœ¨iOSä¸Šä½¿ç”¨ï¼Œä½†å°†æ¥å¯èƒ½ä¼šç”¨äºå…¶ä»–ç”¨é€”ã€‚6ä¸ªå­—ç¬¦é•¿çš„åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œå¦‚:&#39;#000000&#39; icon æœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°åº”ç”¨ç¨‹åºå›¾æ ‡çš„å›¾åƒã€‚æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨1024x1024 pngæ–‡ä»¶ã€‚è¿™ä¸ªå›¾æ ‡å°†ä¼šå‡ºç°åœ¨ä¸»å±å’ŒExpoåº”ç”¨ç¨‹åºä¸­ã€‚ notification è¿œç¨‹(æ¨é€)é€šçŸ¥çš„é…ç½® iconæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒï¼Œç”¨ä½œæ¨é€é€šçŸ¥çš„å›¾æ ‡ã€‚é€æ˜çš„48x48 pngç°åº¦å›¾ã€‚ colorå½“å®ƒå‡ºç°åœ¨é€šçŸ¥æ‰˜ç›˜ä¸­æ—¶ï¼Œä¸ºæ¨é€é€šçŸ¥å›¾åƒç€è‰²ã€‚6ä¸ªå­—ç¬¦é•¿çš„åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œå¦‚:&#39;#000000&#39; androidModeåˆ†åˆ«æ˜¾ç¤ºæ¯ä¸ªæ¨é€é€šçŸ¥(default)æˆ–collapseä¸ºä¸€ä¸ª(collapse)ã€‚æœ‰æ•ˆå€¼:â€˜defaultâ€™, â€˜collapseâ€™ androidCollapsedTitleå¦‚æœandroidModeè¢«è®¾ç½®ä¸ºcollapseï¼Œè¿™ä¸ªæ ‡é¢˜å°†è¢«ç”¨äºå´©æºƒçš„é€šçŸ¥æ¶ˆæ¯ã€‚ä¾‹å¦‚:â€™#{unread_notifications} new interactionsâ€™ loading å¼ƒç”¨:ä½¿ç”¨splashä»£æ›¿ã€‚ç”¨æˆ·åœ¨æ‰“å¼€åº”ç”¨ç¨‹åºæ—¶çœ‹åˆ°çš„åŠ è½½å±å¹•çš„é…ç½®ï¼ŒåŒæ—¶è·å–å’Œç¼“å­˜æ†ç»‘åŒ…å’Œèµ„äº§ã€‚ iconåœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlæ˜¾ç¤ºçš„å›¾åƒã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ exponentIconColorå¦‚æœæ²¡æœ‰æä¾›iconï¼Œæˆ‘ä»¬å°†å±•ç¤ºExpoæ ‡å¿—ã€‚ä½ å¯ä»¥åœ¨whiteå’Œblueä¹‹é—´é€‰æ‹©ã€‚æœ‰æ•ˆå€¼:â€˜whiteâ€™, â€˜blueâ€™ exponentIconGrayscaleç±»ä¼¼äºexponentIconColorï¼Œä½†è¡¨ç¤ºå®ƒåº”è¯¥æ˜¯ç°åº¦(1)è¿˜æ˜¯ä¸(0)ã€‚ backgroundImageæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°å›¾åƒä»¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ backgroundColoré¢œè‰²å¡«å……åŠ è½½å±å¹•èƒŒæ™¯6å­—ç¬¦é•¿çš„åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œ eg: &#39;#000000&#39; hideExponentTextåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒExpoåœ¨åŠ è½½å±å¹•çš„åº•éƒ¨æ˜¾ç¤ºäº†ä¸€äº›æ–‡æœ¬ã€‚è®¾ç½®ä¸ºtrueï¼Œç¦ç”¨ appKey åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸–åšä¼šå°†ä½œä¸ºmainçš„æ³¨å†Œåœ°ç”³è¯·æ³¨å†Œã€‚å¦‚æœæ‚¨æƒ³è¦æ›´æ”¹è¿™ä¸ªå±æ€§ï¼Œæ‚¨å¯ä»¥åœ¨è¯¥å±æ€§ä¸­æŒ‡å®šåç§°ã€‚ androidStatusBarColor å¼ƒç”¨ã€‚ä½¿ç”¨androidStatusBarä»£æ›¿ã€‚6ä¸ªå­—ç¬¦é•¿çš„åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œå¦‚:â€™#000000â€™ androidStatusBar é…ç½®androidçŠ¶æ€æ ã€‚ barStyleé…ç½®çŠ¶æ€æ å›¾æ ‡ï¼Œä»¥æœ‰äº®æˆ–æš—é¢œè‰²ã€‚æœ‰æ•ˆå€¼:â€˜light-contentâ€™, â€˜dark-contentâ€™ backgroundColoré…ç½®androidçŠ¶æ€æ ã€‚6å­—ç¬¦é•¿åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œeg: â€˜#000000â€™ androidShowExponentNotificationInShellApp ä½¿ç”¨refreshæŒ‰é’®å’Œè°ƒè¯•ä¿¡æ¯å‘æ‚¨çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªé€šçŸ¥ã€‚ scheme ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºã€‚é“¾æ¥åˆ°ä½ çš„åº”ç”¨ç¨‹åºçš„URLæ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®ä¸ºâ€™demoâ€™ï¼Œé‚£ä¹ˆdemo:// URLsä¼šåœ¨ç‚¹å‡»æ—¶æ‰“å¼€ä½ çš„åº”ç”¨ã€‚å­—ç¬¦ä¸²ä»¥å­—æ¯å¼€å¤´ï¼Œç„¶åæ˜¯å­—æ¯ã€æ•°å­—ã€â€+â€, â€.â€ or â€-â€ çš„ç»„åˆã€‚ entryPoint ç›¸å¯¹è·¯å¾„åˆ°æ‚¨çš„ä¸»JavaScriptæ–‡ä»¶ã€‚ extra ä½ æƒ³è¦ä¼ é€’ç»™ä½ çš„ç»éªŒçš„ä»»ä½•é¢å¤–çš„é¢†åŸŸã€‚å€¼å¯ä»¥é€šè¿‡Expo.Constants.manifest.extraã€‚(äº†è§£æ›´å¤š) rnCliPath packagerOpts ignoreNodeModulesValidation nodeModulesPath ios ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºã€‚iOSç‹¬ç«‹åº”ç”¨ç‰¹å®šé…ç½® bundleIdentifierè¿™æ˜¯ä½ çš„iOSç‹¬ç«‹åº”ç”¨çš„bundle idï¼Œä½ å¯ä»¥åœ¨app Storeä¸­ä½¿ç”¨å®ƒï¼Œä½†å®ƒå¿…é¡»æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚çœ‹åˆ°è¿™ä¸ªStackOverflowé—®é¢˜ã€‚iOSç»‘å®šæ ‡è¯†ç¬¦æ ‡è®°ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºçš„å”¯ä¸€åç§°ã€‚ä¾‹å¦‚ï¼Œexp.hostã€‚æˆ‘ä»¬çš„Expoæ˜¯æˆ‘ä»¬çš„åŸŸåï¼Œè€ŒExpoå°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨ã€‚ buildNumberä¸ºä½ çš„iOSç‹¬ç«‹åº”ç”¨æ„å»ºæ•°å­—ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªåŒ¹é…è‹¹æœæ ¼å¼çš„CFBundleVersionæ ¼å¼çš„å­—ç¬¦ä¸² iconæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹URLåˆ°ä½ çš„åº”ç”¨åœ¨iOSä¸Šçš„å›¾æ ‡ã€‚å¦‚æœæŒ‡å®šäº†ï¼Œè¿™å°†è¦†ç›–é¡¶çº§çš„å›¾æ ‡é”®ã€‚ä½¿ç”¨ä¸€ä¸ª1024x1024çš„å›¾æ ‡ï¼Œéµå¾ªè‹¹æœçš„å›¾æ ‡çš„ç•Œé¢æŒ‡å—ï¼ŒåŒ…æ‹¬é¢œè‰²é…ç½®å’Œé€æ˜åº¦ã€‚ä¸–åšä¼šå°†äº§ç”Ÿå…¶ä»–æ‰€éœ€çš„è§„æ¨¡ã€‚è¿™ä¸ªå›¾æ ‡å°†ä¼šå‡ºç°åœ¨ä¸»å±å’ŒExpoåº”ç”¨ç¨‹åºä¸­ã€‚ merchantIdåœ¨ä½ çš„ç‹¬ç«‹åº”ç”¨ä¸­ä½¿ç”¨Apple Payçš„å•†å®¶IDã€‚ appStoreUrlå¦‚æœä½ å·²ç»æŠŠå®ƒéƒ¨ç½²åˆ°è‹¹æœåº”ç”¨å•†åº—ï¼Œä½ å¯ä»¥åœ¨è‹¹æœapp Storeä¸Šä½¿ç”¨å®ƒã€‚å¦‚æœä½ çš„åº”ç”¨æ˜¯å…¬å¼€çš„ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä¸–åšä¼šé¡¹ç›®é¡µé¢ä¸Šé“¾æ¥åˆ°ä½ çš„å•†åº—é¡µé¢ã€‚ config branchåˆ†æ”¯é”®è¿æ¥åˆ†æ”¯è¿æ¥æœåŠ¡ã€‚ apiKeyä½ çš„åˆ†æ”¯API Key usesNonExemptEncryptionè®¾ç½®ç‹¬ç«‹ipaâ€™s Info.plist ITSAppUsesNonExemptEncryption,ç»™å®šçš„å¸ƒå°”å€¼ã€‚ googleMapsApiKeyä¸ºä½ çš„ç‹¬ç«‹åº”ç”¨æä¾›çš„Google Maps iOS SDK keyã€‚ googleSignInä¸ºä½ çš„ç‹¬ç«‹åº”ç”¨æä¾›çš„Google Sign-In iOS SDK reservedClientIdä¿ç•™çš„å®¢æˆ·ç«¯ID URLæ–¹æ¡ˆã€‚å¯ä»¥åœ¨GoogeService-Info.plistä¸­æ‰¾åˆ° isRemoteJSEnabledå¦‚æœè®¾ç½®ä¸ºfalseï¼Œæ‚¨çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºå°†æ°¸è¿œä¸ä¼šä¸‹è½½ä»»ä½•ä»£ç ï¼Œå¹¶ä¸”åªä¼šä½¿ç”¨åœ¨è®¾å¤‡ä¸Šæœ¬åœ°ç»‘å®šçš„ä»£ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„åº”ç”¨çš„æ‰€æœ‰æ›´æ–°éƒ½å¿…é¡»é€šè¿‡è‹¹æœå®¡æ ¸æäº¤ã€‚é»˜è®¤å€¼ä¸ºtrueã€‚(è¯·æ³¨æ„ï¼Œè¿™å°†æ— æ³•é€šè¿‡ExpoKité¡¹ç›®æ¥å®ç°) loadJSInBackgroundExperimentalå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œä½ çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºä¼šç«‹å³è¿è¡Œå®ƒçš„ç¼“å­˜JSåŒ…ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå¹¶åœ¨åå°è¯·æ±‚ä¸€ä¸ªæ–°çš„ã€‚ supportsTabletä½ çš„ç‹¬ç«‹iOSåº”ç”¨æ˜¯å¦æ”¯æŒå¹³æ¿ç”µè„‘çš„å°ºå¯¸ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ isTabletOnlyå¦‚æœè¿™æ˜¯trueï¼Œè¯´æ˜ä½ çš„ç‹¬ç«‹iOSåº”ç”¨ä¸æ”¯æŒæ‰‹æœºï¼Œåªæ”¯æŒå¹³æ¿ç”µè„‘ã€‚ infoPlistä»»æ„é…ç½®çš„å­—å…¸ï¼Œæ·»åŠ åˆ°æ‚¨çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„æœ¬åœ°Info.plistã€‚é€‚ç”¨äºæ‰€æœ‰å…¶ä»–ç‰¹å®šäºExpoé…ç½®ã€‚æ²¡æœ‰æ‰§è¡Œå…¶ä»–éªŒè¯ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ç¨‹åºå•†åº—çš„æ‹’ç»ä¸­ä½¿ç”¨å®ƒã€‚ associatedDomainsä¸€ä¸ªåŒ…å«ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„ç›¸å…³åŸŸçš„æ•°ç»„ã€‚ usesIcloudStorageä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè¯¥åº”ç”¨æ˜¯å¦ä½¿ç”¨ç”¨äºDocumentPickerçš„iCloudå­˜å‚¨ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…DocumentPickeræ–‡æ¡£ã€‚ splashä¸ºç‹¬ç«‹çš„iOSåº”ç”¨æä¾›åŠ è½½å’Œå¯åŠ¨å±å¹•çš„é…ç½®ã€‚ backgroundColoré¢œè‰²å¡«å……å±å¹•èƒŒæ™¯6ä¸ªå­—ç¬¦çš„é•¿åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œå¦‚:â€™#000000â€™ resizeModeç¡®å®šå›¾åƒå°†å¦‚ä½•æ˜¾ç¤ºåœ¨å¼¹å‡ºçš„åŠ è½½å±å¹•ä¸­ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªåŒ…å«æˆ–åŒ…å«çš„é»˜è®¤å€¼ã€‚æœ‰æ•ˆå€¼:â€˜coverâ€™, â€˜containâ€™ imageæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ tabletImageæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°å›¾åƒä»¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ androidç‹¬ç«‹çš„åº”ç”¨ç¨‹åºã€‚Androidç‹¬ç«‹åº”ç”¨ç¨‹åºç‰¹å®šé…ç½® packageçš„Androidç‹¬ç«‹åº”ç”¨ç¨‹åºçš„åŒ…åï¼Œä½ å¯ä»¥åšï¼Œä½†å®ƒéœ€è¦åœ¨Play Storeä¸­æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚çœ‹åˆ°è¿™ä¸ªStackOverflowé—®é¢˜ã€‚åå‘DNSæ ‡è®°ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºçš„å”¯ä¸€åç§°ã€‚ä¾‹å¦‚ï¼Œhost.exp.exponentã€‚æˆ‘ä»¬çš„åŸŸåæ˜¯æˆ‘ä»¬çš„åŸŸåï¼Œè€ŒExpoå°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨ã€‚ versionCodeGoogle Playéœ€è¦çš„ç‰ˆæœ¬å·ã€‚æ¯ä¸ªç‰ˆæœ¬å¢åŠ ä¸€ä¸ªã€‚å¿…é¡»æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚https://developer.android.com/studio/publish/versioning.html iconæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä½ çš„åº”ç”¨ç¨‹åºåœ¨Androidä¸Šçš„å›¾æ ‡ã€‚å¦‚æœæŒ‡å®šäº†ï¼Œè¿™å°†è¦†ç›–é¡¶çº§çš„å›¾æ ‡é”®ã€‚æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨1024x1024 pngæ–‡ä»¶(Google Playå•†åº—æ¨èä½¿ç”¨é€æ˜åº¦)ã€‚è¿™ä¸ªå›¾æ ‡å°†ä¼šå‡ºç°åœ¨ä¸»å±å’Œä¸–åšä¼šåº”ç”¨ç¨‹åºä¸­ã€‚ playStoreUrlå¦‚æœä½ å·²ç»éƒ¨ç½²åœ¨Google Play Storeï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ç¨‹åºçš„URLã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯å…¬å¼€çš„ï¼Œè¿™æ˜¯ç”¨æ¥é“¾æ¥åˆ°ä½ çš„å•†åº—é¡µé¢çš„ã€‚ permissionsç‹¬ç«‹åº”ç”¨ç¨‹åºä½¿ç”¨çš„æƒé™åˆ—è¡¨ã€‚åˆ é™¤è¯¥å­—æ®µä»¥ä½¿ç”¨é»˜è®¤çš„æƒé™åˆ—è¡¨ã€‚ç¤ºä¾‹: [ &quot;CAMERA&quot;, &quot;ACCESS_FINE_LOCATION&quot; ].æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æŒ‡å®šä»¥ä¸‹æƒé™: ACCESS_COARSE_LOCATION ACCESS_FINE_LOCATION CAMERA MANAGE_DOCUMENTS READ_CONTACTS READ_CALENDAR WRITE_CALENDAR READ_EXTERNAL_STORAGE READ_INTERNAL_STORAGE READ_PHONE_STATE RECORD_AUDIO USE_FINGERPRINT VIBRATE WAKE_LOCK WRITE_EXTERNAL_STORAGE com.anddoes.launcher.permission.UPDATE_COUNT com.android.launcher.permission.INSTALL_SHORTCUT com.google.android.c2dm.permission.RECEIVE com.google.android.gms.permission.ACTIVITY_RECOGNITION com.google.android.providers.gsf.permission.READ_GSERVICES com.htc.launcher.permission.READ_SETTINGS com.htc.launcher.permission.UPDATE_SHORTCUT com.majeur.launcher.permission.UPDATE_BADGE com.sec.android.provider.badge.permission.READ com.sec.android.provider.badge.permission.WRITE com.sonyericsson.home.permission.BROADCAST_BADGE config branchåˆ†æ”¯é”®è¿æ¥åˆ†æ”¯é“¾æ¥æœåŠ¡ã€‚ apiKeyä½ åˆ†æ”¯API key fabricGoogle Developers Fabric keysè¿æ¥Crashlyticså’Œå…¶ä»–æœåŠ¡ã€‚ apiKeyä½ Fabric API key buildSecretFabric build secret googleMapsä½ çš„ç‹¬ç«‹appçš„Google Maps Android SDK keyã€‚ apiKeyGoogle Maps Android SDK API key googleSignInä¸ºä½ çš„ç‹¬ç«‹åº”ç”¨æä¾›çš„Google Sign-In iOS SDK apiKeyAndroid API keyã€‚å¯ä»¥åœ¨å¼€å‘äººå‘˜æ§åˆ¶å°çš„å‡­æ®éƒ¨åˆ†æˆ–åœ¨google-services.jsonä¸­æ‰¾åˆ°ã€‚ certificateHashç”¨äºæ„å»ºapkçš„ç­¾åè¯ä¹¦çš„SHA-1å“ˆå¸Œï¼Œæ²¡æœ‰ä»»ä½•åˆ†éš”ç¬¦:ã€‚å¯ä»¥åœ¨google-service.jsonä¸­æ‰¾åˆ°ã€‚https://developers.google.com/android/guides/client-auth splashä¸ºç‹¬ç«‹çš„Androidåº”ç”¨ç¨‹åºåŠ è½½å’Œå¯åŠ¨å±å¹•çš„é…ç½®ã€‚ backgroundColoré¢œè‰²å¡«å……å±å¹•èƒŒæ™¯6ä¸ªå­—ç¬¦çš„é•¿åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œå¦‚: â€˜#000000â€™ resizeModeç¡®å®šå›¾åƒå°†å¦‚ä½•æ˜¾ç¤ºåœ¨å¼¹å‡ºçš„åŠ è½½å±å¹•ä¸­ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªcoveræˆ–contain,é»˜è®¤å€¼containã€‚æœ‰æ•ˆå€¼:â€˜coverâ€™, â€˜containâ€™ ldpiæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ mdpiæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ hdpiæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ xhdpiæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ xxhdpiæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ xxxhdpiæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ facebookAppId ç”¨äºæ‰€æœ‰çš„Facebookåº“ã€‚åœ¨https://developers.facebook.comä¸Šè®¾ç½®ä½ çš„Facebookåº”ç”¨ç¨‹åºIDã€‚ facebookDisplayName ç”¨äºåŸç”Ÿçš„Facebookç™»å½•ã€‚ facebookScheme ç”¨äºFacebookæœ¬åœ°ç™»å½•ã€‚ä»â€œfbâ€å¼€å§‹ï¼Œæ¥ç€æ˜¯ä¸€ç³»åˆ—çš„æ•°å­—ï¼Œæ¯”å¦‚â€œfb1234567890â€ã€‚ä½ å¯ä»¥åœ¨https://developers.facebook.com/docs/facebook-login/iosæ‰¾åˆ°ä½ çš„æ–¹æ¡ˆçš„é…ç½®ä¿¡æ¯ã€‚plistâ€éƒ¨åˆ†ã€‚ splash ä¸ºç‹¬ç«‹åº”ç”¨ç¨‹åºåŠ è½½å’Œå¯åŠ¨å±å¹•çš„é…ç½®ã€‚ backgroundColoré¢œè‰²å¡«å……å±å¹•èƒŒæ™¯6ä¸ªå­—ç¬¦çš„é•¿åå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²ï¼Œå¦‚:â€™#000000â€™ resizeModeç¡®å®šå›¾åƒå°†å¦‚ä½•æ˜¾ç¤ºåœ¨å¼¹å‡ºçš„åŠ è½½å±å¹•ä¸­ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªåŒ…å«æˆ–åŒ…å«çš„é»˜è®¤å€¼ã€‚æœ‰æ•ˆå€¼:â€˜coverâ€™, â€˜containâ€™ imageæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹urlåˆ°ä¸€ä¸ªå›¾åƒæ¥å¡«å……åŠ è½½å±å¹•çš„èƒŒæ™¯ã€‚å›¾åƒå¤§å°å’Œçºµæ¨ªæ¯”å–å†³äºä½ ã€‚å¿…é¡»æ˜¯ä¸€ä¸ª.pngã€‚ hooks å¯¹è„šæœ¬çš„é…ç½®ï¼Œä»¥å°†å…¶è¿æ¥åˆ°å‘å¸ƒè¿‡ç¨‹ä¸­ postPublish assetBundlePatterns ä¸€ç»„æ–‡ä»¶globå­—ç¬¦ä¸²ï¼Œå®ƒæŒ‡å‘çš„èµ„äº§å°†è¢«ç»‘å®šåˆ°ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚åœ¨ç¦»çº¿æ”¯æŒæŒ‡å—ä¸­é˜…è¯»æ›´å¤šä¿¡æ¯ å¼€å‘æ¨¡å¼React NativeåŒ…æ‹¬ä¸€äº›éå¸¸æœ‰ç”¨çš„å¼€å‘å·¥å…·:åœ¨Chromeä¸­è¿›è¡Œè¿œç¨‹JavaScriptè°ƒè¯•ã€å®æ—¶é‡è½½ã€çƒ­é‡åŠ è½½ï¼Œä»¥åŠä¸€ä¸ªç±»ä¼¼äºæ‚¨åœ¨Chromeä¸­ä½¿ç”¨çš„å—æ¬¢è¿çš„æ£€æŸ¥å™¨çš„å…ƒç´ æ£€æŸ¥å™¨ã€‚å®ƒè¿˜æ‰§è¡Œä¸€äº›éªŒè¯ï¼Œå½“æ‚¨çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œæ—¶ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä¸èµæˆçš„å±æ€§ï¼Œæˆ–è€…æ‚¨å¿˜è®°å°†å¿…éœ€çš„å±æ€§ä¼ é€’åˆ°ç»„ä»¶ä¸­ï¼Œé‚£ä¹ˆå®ƒå°†ç»™æ‚¨å‘å‡ºè­¦å‘Šã€‚ è¿™æ˜¯æœ‰ä»£ä»·çš„:ä½ çš„åº”ç”¨åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œå¾—æ¯”è¾ƒæ…¢ã€‚ä½ å¯ä»¥åœ¨XDEä¸Šæ¥å›åˆ‡æ¢ã€‚å½“ä½ æ‰“å¼€å®ƒæ—¶ï¼Œå…³é—­å¹¶é‡æ–°æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åºï¼Œè®©å®ƒç”Ÿæ•ˆã€‚åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºçš„æ€§èƒ½æ—¶ï¼Œä¸€å®šè¦ç¦ç”¨å¼€å‘æ¨¡å¼ã€‚ åœ¨XDEä¸­åˆ‡æ¢å¼€å‘æ¨¡å¼ expå‘½ä»¤è¡Œæ¥å£é™¤äº†XDEä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªCLI expï¼Œå¦‚æœæ‚¨å–œæ¬¢åœ¨å‘½ä»¤è¡Œä¸Šå·¥ä½œï¼Œæˆ–è€…æƒ³è¦åœ¨æµ‹è¯•æˆ–æŒç»­é›†æˆ(CI)ä¸­ä½¿ç”¨Expoã€‚ å®‰è£…è¿è¡Œ npm install -g exp å®‰è£…å…¨å±€exp. å¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡expæˆ–XDEï¼Œé‚£ä¹ˆæ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä½¿ç”¨exp loginç™»å½•æ‚¨çš„Expoå¸æˆ·ã€‚ å‘½ä»¤æŸ¥çœ‹ä½¿ç”¨exp --helpçš„å‘½ä»¤åˆ—è¡¨: 1234567891011121314151617181920212223242526272829303132333435363738394041Usage: exp [options] [command]Options: -V, --version output the version number -o, --output [format] Output format. pretty (default), raw -h, --help output usage informationCommands: android [options] [project-dir] Opens your app in Expo on a connected Android device build:ios|bi [options] [project-dir] Build a standalone IPA for your project, signed and ready for submission to the Apple App Store. build:android|ba [options] [project-dir] Build a standalone APK for your project, signed and ready for submission to the Google Play Store. build:status|bs [options] [project-dir] Gets the status of a current (or most recently finished) build for your project. convert|onentize [options] [project-dir] Initialize Expo project files within an existing React Native project detach [options] [project-dir] Creates Xcode and Android Studio projects for your app. Use this if you need to add custom native functionality. diagnostics [options] [project-dir] Uploads diagnostics information and returns a url to share with the Expo team. doctor [options] [project-dir] Diagnoses issues with your Expo project. fetch:ios:certs [options] [project-dir] Fetch this project&apos; iOS certificates. Writes to PROJECT_DIR/PROJECT_NAME_(dist|push).p12 and prints passwords to stdout. fetch:android:keystore [options] [project-dir] Fetch this project&apos;s Android keystore. Writes keystore to PROJECT_DIR/PROJECT_NAME.jks and prints passwords to stdout. init|i [options] [project-dir] Initializes a directory with an example project. Run it without any options and you will be prompted for the name and type. install:ios [options] Install the latest version of Expo Client for iOS on the simulator install:android [options] Install the latest version of Expo Client for Android on a connected device or emulator ios [options] [project-dir] Opens your app in Expo in an iOS simulator on your computer login|signin [options] Login to Expo logout [options] Logout from exp.host path [options] Sets PATH for XDE prepare-detached-build [options] [project-dir] Prepares a detached project for building publish:history|ph [options] [project-dir] View a log of your published releases. publish:details|pd [options] [project-dir] View the details of a published release. publish:set|ps [options] [project-dir] Set a published release to be served from a specified channel. publish:rollback|pr [options] [project-dir] Rollback an update to a channel. publish|p [options] [project-dir] Publishes your project to exp.host register [options] Sign up for a new Expo account send [options] [project-dir] Sends a link to your project to a phone number or e-mail address start|r [options] [project-dir] Starts or restarts a local server for your app and gives you a URL to it url|u [options] [project-dir] Displays the URL you can use to view your project in Expo whoami|w [options] Checks with the server and then says who you are logged in as é€šè¿‡ä¼ é€’â€“helpæ ‡å¿—æŸ¥çœ‹å…³äºç‰¹å®šå‘½ä»¤çš„å…¶ä»–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œexp start --helpè¾“å‡º: 12345678910111213141516171819202122232425262728Usage: start|r [options] [project-dir]Starts or restarts a local server for your app and gives you a URL to itOptions: -s, --send-to [dest] A phone number or e-mail address to send a link to -c, --clear Clear the React Native packager cache -a, --android Opens your app in Expo on a connected Android device -i, --ios Opens your app in Expo in a currently running iOS simulator on your computer -m, --host [mode] tunnel (default), lan, localhost. Type of host to use. &quot;tunnel&quot; allows you to view your link on other networks -p, --protocol [mode] exp (default), http, redirect. Type of protocol. &quot;exp&quot; is recommended right now --tunnel Same as --host tunnel --lan Same as --host lan --localhost Same as --host localhost --dev Turns dev flag on --no-dev Turns dev flag off --strict Turns strict flag on --no-strict Turns strict flag off --minify Turns minify flag on --no-minify Turns minify flag off --exp Same as --protocol exp --http Same as --protocol http --redirect Same as --protocol redirect --non-interactive Fails if an interactive prompt would be required to continue. --offline Allows this command to run while offline -h, --help output usage information å¦å¤–ï¼Œä½ å¯ä»¥åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œï¼Œå°†ç¦»çº¿æ ‡å¿—ä¼ é€’ç»™androidã€iosæˆ–å¯åŠ¨å‘½ä»¤ã€‚ æŸ¥çœ‹æ—¥å¿—åœ¨Expoåº”ç”¨ç¨‹åºä¸­å†™å…¥æ—¥å¿—å°±åƒåœ¨æµè§ˆå™¨ä¸­ä¸€æ ·:ä½¿ç”¨console.log, console.warn, console.errorã€‚æ³¨æ„:æˆ‘ä»¬ç›®å‰ä¸æ”¯æŒè¿œç¨‹è°ƒè¯•æ¨¡å¼ä¹‹å¤–çš„console.tableã€‚ æ¨è:ä½¿ç”¨Expoå·¥å…·æŸ¥çœ‹æ—¥å¿—å½“ä½ æ‰“å¼€ä¸€ä¸ªä»XDEæˆ–expä¸­æœåŠ¡çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œè¯¥åº”ç”¨ä¼šå°†æ—¥å¿—å‘é€åˆ°æœåŠ¡å™¨ï¼Œå¹¶è®©å®ƒä»¬æ–¹ä¾¿åœ°æä¾›ç»™ä½ ã€‚è¿™æ„å‘³ç€ä½ ç”šè‡³ä¸éœ€è¦æŠŠä½ çš„è®¾å¤‡è¿æ¥åˆ°ä½ çš„ç”µè„‘ä¸ŠæŸ¥çœ‹æ—¥å¿—â€”â€”äº‹å®ä¸Šï¼Œå¦‚æœæœ‰äººæ‰“å¼€äº†ä¸–ç•Œå¦ä¸€ç«¯çš„åº”ç”¨ï¼Œä½ ä»ç„¶å¯ä»¥ä»ä»–ä»¬çš„è®¾å¤‡ä¸Šçœ‹åˆ°ä½ çš„åº”ç”¨çš„æ—¥å¿—ã€‚ XDEæ—¥å¿—é¢æ¿å½“æ‚¨åœ¨XDEä¸­æ‰“å¼€ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œæ—¥å¿—çª—å£å°†è¢«ä¸€åˆ†ä¸ºäºŒã€‚æ‚¨çš„åº”ç”¨ç¨‹åºæ—¥å¿—æ˜¾ç¤ºåœ¨å³è¾¹ï¼Œè€Œpackageræ—¥å¿—æ˜¾ç¤ºåœ¨å·¦è¾¹ã€‚ XDEè¿˜å…è®¸æ‚¨åœ¨ä»»ä½•æ‰“å¼€åº”ç”¨ç¨‹åºçš„è®¾å¤‡ä¹‹é—´åˆ‡æ¢æ—¥å¿—ã€‚ ä½¿ç”¨expæŸ¥çœ‹æ—¥å¿—å¦‚æœæ‚¨ä½¿ç”¨æˆ‘ä»¬çš„å‘½ä»¤è¡Œå·¥å…·expï¼Œé‚£ä¹ˆå½“æ‚¨çš„é¡¹ç›®è¿è¡Œæ—¶ï¼Œpackageræ—¥å¿—å’Œåº”ç”¨æ—¥å¿—éƒ½å°†è‡ªåŠ¨åœ°æµã€‚ä¸ºäº†åœæ­¢æ‚¨çš„é¡¹ç›®(å¹¶ç»“æŸæ—¥å¿—æµ)ï¼Œä½¿ç”¨ctrl+cç»ˆæ­¢è¿›ç¨‹ã€‚ å¯é€‰:æ‰‹åŠ¨è®¿é—®è®¾å¤‡æ—¥å¿—è™½ç„¶è¿™é€šå¸¸æ˜¯ä¸å¿…è¦çš„ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³çœ‹åˆ°ä½ çš„è®¾å¤‡ä¸Šå‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ï¼Œç”šè‡³æ˜¯æ¥è‡ªå…¶ä»–åº”ç”¨å’Œæ“ä½œç³»ç»Ÿæœ¬èº«çš„æ—¥å¿—ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€ æŸ¥çœ‹iOSæ¨¡æ‹Ÿå™¨çš„æ—¥å¿—é€‰é¡¹1:ä½¿ç”¨GUIæ—¥å¿— åœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼ŒæŒ‰âŒ˜ + /æˆ–è¿›å…¥Debug -&gt; Open System Log-è¿™ä¸¤ä¸ªæ‰“å¼€ä¸€ä¸ªæ—¥å¿—çª—å£ï¼Œæ˜¾ç¤ºè®¾å¤‡ä¸Šçš„æ‰€æœ‰æ—¥å¿—ï¼ŒåŒ…æ‹¬Expoåº”ç”¨ç¨‹åºçš„æ—¥å¿—ã€‚ é€‰é¡¹2:åœ¨ç»ˆç«¯æ‰“å¼€å®ƒ è¿è¡Œinstruments -s devices æ‰¾åˆ°ä½ æ­£åœ¨ä½¿ç”¨çš„æ¨¡æ‹Ÿå™¨çš„è®¾å¤‡/æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œeg: iPhone 6s (9.2) [5083E2F9-29B4-421C-BDB5-893952F2B780] æ‹¬å·ä¸­çš„éƒ¨åˆ†ç»“æŸæ—¶è®¾å¤‡ä»£ç ,å› æ­¤æ‚¨ç°åœ¨å¯ä»¥è¿™æ ·åš: tail -f ~/Library/Logs/CoreSimulator/DEVICE_CODE/system.log, å¦‚: tail -f ~/Library/Logs/CoreSimulator/5083E2F9-29B4-421C-BDB5-893952F2B780/system.log æŸ¥çœ‹iPhoneçš„æ—¥å¿— brew install libimobiledevice ä»£å…¥ä½ çš„æ‰‹æœº idevicepair pair åœ¨ä½ çš„è®¾å¤‡ä¸ŠæŒ‰ä¸‹ accept è¿è¡Œ idevicesyslog ä»Androidè®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨æŸ¥çœ‹æ—¥å¿— ç¡®ä¿å®‰è£…äº†Android SDK ç¡®ä¿åœ¨æ‚¨çš„è®¾å¤‡ä¸Šå¯ç”¨äº†USBè°ƒè¯•(å¯¹äºä»¿çœŸå™¨æ¥è¯´æ²¡æœ‰å¿…è¦)ã€‚ è¿è¡Œadb logcat è°ƒè¯•ä½¿ç”¨ Simulator / Emulatoråœ¨ä¸€ä¸ªå®é™…çš„è®¾å¤‡ä¸Šæµ‹è¯•ä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œæ„Ÿè§‰æ˜¯æ²¡æœ‰ä»»ä½•æ›¿ä»£çš„ï¼Œä½†æ˜¯åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šæ›´å®¹æ˜“ä½¿ç”¨æ¨¡æ‹Ÿå™¨ã€‚ è‹¹æœå°†ä»–ä»¬çš„æ¨¡æ‹Ÿå™¨ç§°ä¸ºâ€œSimulatorâ€ï¼Œè€Œè°·æ­Œå°†ä»–ä»¬çš„æ¨¡æ‹Ÿå™¨ç§°ä¸ºâ€œEmulatorâ€ã€‚ iOSç¡®ä¿ä½ æœ‰æœ€æ–°çš„Xcode(æ¯”å¦‚Mac App Store)ã€‚è¿™åŒ…æ‹¬iOSæ¨¡æ‹Ÿå™¨ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å·¥å…·ã€‚ Androidåœ¨Androidä¸Šï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨æ ‡å‡†æ¨¡æ‹Ÿå™¨çš„Genymotionæ¨¡æ‹Ÿå™¨â€”â€”æˆ‘ä»¬å‘ç°å®ƒæ›´å®Œæ•´ã€æ›´å¿«ã€æ›´å®¹æ˜“ä½¿ç”¨ã€‚ ä¸‹è½½Genymotion(å…è´¹ç‰ˆæœ¬)å¹¶éµå¾ªGenymotionå®‰è£…æŒ‡å—ã€‚ä¸€æ—¦ä½ å®‰è£…äº†Genymotionï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿè®¾å¤‡â€”â€”æˆ‘ä»¬æ¨èä¸€ä¸ªNexus 5, Androidç‰ˆæœ¬ç”±ä½ å†³å®šã€‚å¯åŠ¨è™šæ‹Ÿè®¾å¤‡æ—¶ï¼Œå®ƒå·²ç»å‡†å¤‡å¥½äº†ã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·éµå¾ªæˆ‘ä»¬çš„GenymotionæŒ‡å—ã€‚ å¼€å‘è€…èœå•è¿™ä¸ªèœå•ä½¿æ‚¨èƒ½å¤Ÿè®¿é—®å‡ ä¸ªå¯¹è°ƒè¯•æœ‰ç”¨çš„å‡½æ•°ã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºè°ƒè¯•èœå•ã€‚è°ƒç”¨å®ƒå–å†³äºæ‚¨æ­£åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„è®¾å¤‡ã€‚ iOSè®¾å¤‡ä¸Šæ‘‡ä¸€ä¸‹è¿™ä¸ªè£…ç½®ã€‚ åœ¨iOSæ¨¡æ‹Ÿå™¨åœ¨æ¨¡æ‹Ÿå™¨ä¸Šçš„Macä¸ŠæŒ‰Ctrl-Cmd-Zæ¥æ¨¡æ‹Ÿæ¡æ‰‹åŠ¨ä½œï¼Œæˆ–è€…æŒ‰ä¸‹Cmd+Dã€‚ åœ¨Genymotionåœ¨Genymotionçš„å·¥å…·æ ä¸­æŒ‰ä¸‹â€œèœå•â€æŒ‰é’®ï¼Œæˆ–è€…ç›´æ¥ç‚¹å‡»Cmd-mã€‚ è°ƒè¯•Javascriptä½ å¯ä»¥ä½¿ç”¨Chromeè°ƒè¯•å™¨å·¥å…·æ¥è°ƒè¯•Expoåº”ç”¨ç¨‹åºã€‚ä¸å…¶åœ¨ä½ çš„æ‰‹æœºä¸Šè¿è¡Œä½ çš„åº”ç”¨ç¨‹åºçš„JavaScriptï¼Œä¸å¦‚å°†å®ƒè¿è¡Œåœ¨Chromeæµè§ˆå™¨çš„ä¸€ä¸ªwebworkerä¸­ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è®¾ç½®æ–­ç‚¹ã€æ£€æŸ¥å˜é‡ã€æ‰§è¡Œä»£ç ç­‰ç­‰ï¼Œå°±åƒè°ƒè¯•webåº”ç”¨ç¨‹åºæ—¶æ‰€åšçš„é‚£æ ·ã€‚ ä¸ºäº†ç¡®ä¿æœ€ä½³è°ƒè¯•ä½“éªŒï¼Œé¦–å…ˆå°†æ‚¨çš„ä¸»æœºç±»å‹æ›´æ”¹ä¸ºLANæˆ–localhostã€‚å¦‚æœä½ ä½¿ç”¨äº†å¯ç”¨è°ƒè¯•çš„éš§é“ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½ä¼šç»å†å¤ªå¤šçš„å»¶è¿Ÿï¼Œä»¥è‡³äºä½ çš„åº”ç”¨æ— æ³•ä½¿ç”¨ã€‚åœ¨è¿™é‡Œï¼Œä¹Ÿç¡®ä¿æ£€æŸ¥å¼€å‘æ¨¡å¼ã€‚ å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å±€åŸŸç½‘ï¼Œè¯·ç¡®ä¿ä½ çš„è®¾å¤‡ä¸ä½ çš„å¼€å‘æœºå™¨åœ¨åŒä¸€ä¸ªwifiç½‘ç»œä¸Šã€‚è¿™å¯èƒ½ä¸ä¼šåœ¨æŸäº›å…¬å…±ç½‘ç»œä¸Šå¥æ•ˆã€‚é™¤éä½ åœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œå¦åˆ™æœ¬åœ°ä¸»æœºå°†æ— æ³•å·¥ä½œï¼Œè€Œä¸”åªæœ‰åœ¨ä½ çš„è®¾å¤‡é€šè¿‡usbè¿æ¥åˆ°ä½ çš„æœºå™¨æ—¶ï¼Œå®ƒæ‰ä¼šåœ¨Androidä¸Šè¿è¡Œã€‚ åœ¨ä½ çš„è®¾å¤‡ä¸Šæ‰“å¼€è¿™ä¸ªåº”ç”¨ï¼Œæ‰“å¼€å¼€å‘è€…èœå•ï¼Œç„¶åç‚¹å‡»Debug JS Remotelyã€‚è¿™å°†æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨é€‰é¡¹å¡URL http://localhost:19001/debugger-uiã€‚ä»é‚£é‡Œï¼Œæ‚¨å¯ä»¥è®¾ç½®æ–­ç‚¹ï¼Œå¹¶é€šè¿‡JavaScriptæ§åˆ¶å°è¿›è¡Œäº¤äº’ã€‚å½“ä½ å®Œæˆçš„æ—¶å€™ï¼Œæ‘‡åŠ¨è¿™ä¸ªè®¾å¤‡ï¼Œåœæ­¢Chromeçš„è°ƒè¯•ã€‚ å½“ä½¿ç”¨Chromeè°ƒè¯•æ—¶ï¼Œconsole.logè¯­å¥çš„è¡Œå·åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šèµ·ä½œç”¨ã€‚è¦è·å¾—æ­£ç¡®çš„è¡Œå·ï¼Œæ‰“å¼€Chromeå¼€å‘å·¥å…·è®¾ç½®ï¼Œè¿›å…¥â€œblackè£…ç®±â€é€‰é¡¹å¡ï¼Œç¡®ä¿é€‰ä¸­â€œBlackboxå†…å®¹è„šæœ¬â€ï¼Œå¹¶å°†expo/src/Logs.jsæ·»åŠ ä¸ºå¸¦æœ‰â€œBlackboxâ€é€‰é¡¹çš„æ¨¡å¼ã€‚ æ•…éšœä¸»æœºè°ƒè¯•å½“æ‚¨åœ¨XDEä¸­æ‰“å¼€ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå½“æ‚¨åœ¨Androidä¸Šæ‰“å¼€æ—¶ï¼ŒXDEå°†è‡ªåŠ¨å‘Šè¯‰æ‚¨çš„è®¾å¤‡è½¬å‘localhost:19000å’Œ19001åˆ°æ‚¨çš„å¼€å‘æœºå™¨ï¼Œåªè¦æ‚¨çš„è®¾å¤‡è¢«æ’å…¥æˆ–æ¨¡æ‹Ÿå™¨æ­£åœ¨è¿è¡Œã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨localhostè¿›è¡Œè°ƒè¯•ï¼Œå¹¶ä¸”å®ƒæ²¡æœ‰å·¥ä½œï¼Œå…³é—­åº”ç”¨ç¨‹åºå¹¶åœ¨Androidä¸Šå†æ¬¡æ‰“å¼€å®ƒã€‚æˆ–è€…ï¼Œå¦‚æœæ‚¨å®‰è£…äº†Androidå¼€å‘å·¥å…·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰‹åŠ¨è½¬å‘ç«¯å£:adb reverse tcp:19000 tcp:19000 - adb reverse tcp:19001 tcp:19001 æºç æ˜ å°„å’Œå¼‚æ­¥å‡½æ•°æºç æ˜ å°„å’Œå¼‚æ­¥å‡½æ•°ä¸æ˜¯100%å¯é çš„ã€‚åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œæœ¬åœ°çš„å“åº”éƒ½ä¸èƒ½å¾ˆå¥½åœ°ä½¿ç”¨Chromeçš„æºä»£ç æ˜ å°„ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨äº†æ–­ç‚¹ï¼Œä½ åº”è¯¥ç›´æ¥ä»ä½ çš„ä»£ç ä¸­ä½¿ç”¨è°ƒè¯•å™¨è°ƒç”¨ã€‚ HTTPè°ƒè¯•è¦è°ƒè¯•åº”ç”¨ç¨‹åºçš„HTTPè¯·æ±‚ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ä»£ç†ã€‚ä»¥ä¸‹çš„é€‰é¡¹å°†å…¨éƒ¨å¥æ•ˆ: Charles Proxy mitmproxy Fiddler åœ¨Androidä¸Šï¼Œä»£ç†è®¾ç½®åº”ç”¨ç¨‹åºæœ‰åŠ©äºåœ¨è°ƒè¯•å’Œéè°ƒè¯•æ¨¡å¼ä¹‹é—´åˆ‡æ¢ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒè¿˜ä¸èƒ½ä¸Android Må…¼å®¹ã€‚ æœªæ¥çš„å·¥ä½œæ˜¯åœ¨Chrome DevToolsä¸­æ˜¾ç¤ºç½‘ç»œè¯·æ±‚ã€‚ çƒ­åŠ è½½å’Œé‡æ–°åŠ è½½çƒ­æ¨¡å—é‡è½½æ˜¯ä¸€ç§å¿«é€Ÿé‡è½½æ›´æ”¹çš„æ–¹æ³•ï¼Œä¸ä¼šåœ¨å±å¹•æˆ–å¯¼èˆªå †æ ˆä¸­ä¸¢å¤±çŠ¶æ€ã€‚è¦å¯ç”¨ï¼Œè¯·è°ƒç”¨å¼€å‘äººå‘˜èœå•å¹¶ç‚¹å‡»â€œå¯ç”¨çƒ­é‡åŠ è½½â€é¡¹ã€‚è€ŒLive Reloadå°†é‡æ–°åŠ è½½æ•´ä¸ªJSä¸Šä¸‹æ–‡ï¼Œçƒ­æ¨¡å—é‡è½½å°†ä½¿æ‚¨çš„è°ƒè¯•å‘¨æœŸæ›´å¿«ã€‚ä½†æ˜¯ï¼Œç¡®ä¿æ‚¨æ²¡æœ‰æ‰“å¼€ä¸¤ä¸ªé€‰é¡¹ï¼Œå› ä¸ºè¿™æ˜¯ä¸æ”¯æŒçš„è¡Œä¸ºã€‚ å…¶ä»–è°ƒè¯•æŠ€å·§Dotan Nahumåœ¨ä»–çš„â€œDebugging React Native Applicationsâ€ä¸­æ¦‚è¿°äº†å…¶ä»–æœ‰ç”¨çš„å·¥å…·ï¼Œæ¯”å¦‚ç›‘è§†æ¡¥æ¢ä¿¡æ¯å’ŒJSEventLoopWatchdogã€‚ Genymotion å‘å¸ƒå½“æ‚¨åœ¨å¼€å‘é¡¹ç›®æ—¶ï¼Œæ‚¨æ­£åœ¨è®¡ç®—æœºä¸Šç¼–å†™ä»£ç ï¼Œå½“æ‚¨ä½¿ç”¨XDEæˆ–expæ—¶ï¼ŒæœåŠ¡å™¨å’Œæœ¬åœ°åŒ…è£…å™¨ä¼šåœ¨æ‚¨çš„æœºå™¨ä¸Šè¿è¡Œï¼Œå¹¶å°†æ‰€æœ‰çš„æºä»£ç æ‰“åŒ…ï¼Œå¹¶ä½¿å…¶ä»URLä¸­è·å¾—ã€‚æ‚¨æ­£åœ¨å¤„ç†çš„é¡¹ç›®çš„URLå¯èƒ½æ˜¯è¿™æ ·çš„:exp://i3-kvb.ccheever.an-example.exp.direct:80ã€‚ exp.directæ˜¯æˆ‘ä»¬ç”¨æ¥è¿›è¡Œéš§é“æŒ–æ˜çš„é¢†åŸŸï¼Œæ‰€ä»¥å³ä½¿ä½ åœ¨VPNæˆ–é˜²ç«å¢™åé¢ï¼Œä»»ä½•æœ‰ä½ çš„URLçš„è®¾å¤‡éƒ½åº”è¯¥èƒ½å¤Ÿè®¿é—®ä½ çš„é¡¹ç›®ã€‚è¿™ä½¿å¾—åœ¨ä½ çš„æ‰‹æœºä¸Šæ‰“å¼€ä½ çš„é¡¹ç›®æˆ–å‘é€ç»™ä½ æ­£åœ¨å’Œè°ä¸åœ¨åŒä¸€å±€åŸŸç½‘çš„å…¶ä»–äººæ›´å®¹æ˜“ã€‚ ä½†æ˜¯ç”±äºåŒ…è£…å™¨å’ŒæœåŠ¡å™¨åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè¿è¡Œï¼Œå¦‚æœæ‚¨å…³é—­äº†æ‚¨çš„ç¬”è®°æœ¬æˆ–å…³é—­XDEï¼Œæ‚¨å°†æ— æ³•ä»è¯¥URLåŠ è½½æ‚¨çš„é¡¹ç›®ã€‚â€œå‘å¸ƒâ€æ˜¯æˆ‘ä»¬ç”¨æ¥éƒ¨ç½²æ‚¨çš„é¡¹ç›®çš„æœ¯è¯­ã€‚å®ƒä½¿æ‚¨çš„é¡¹ç›®å¯ä»¥åœ¨ä¸€ä¸ªæŒä¹…çš„URLä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚https://expo.io/@community/native-component-listã€‚å®ƒè¿˜ä¼šå°†ä½ çš„æ‰€æœ‰åº”ç”¨å›¾ç‰‡ã€å­—ä½“å’Œè§†é¢‘ä¸Šä¼ è‡³CDN(åœ¨è¿™é‡Œé˜…è¯»æ›´å¤š)ã€‚ å¦‚ä½•å‘å¸ƒè¦å‘å¸ƒé¡¹ç›®ï¼Œè¯·å•å‡»XDEä¸­çš„å‘å¸ƒæŒ‰é’®ã€‚(åœ¨çª—æˆ·çš„å³ä¸Šè§’ã€‚)å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨exp cliå·¥å…·ï¼Œåˆ™è¿è¡Œexp publishã€‚ä¸éœ€è¦è®¾ç½®ï¼Œç»§ç»­åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¹¶åœ¨ä¸å‘ç”Ÿä»»ä½•æ›´æ”¹çš„æƒ…å†µä¸‹å‘å¸ƒå®ƒï¼Œæ‚¨å°†çœ‹åˆ°å®ƒæ˜¯æœ‰æ•ˆçš„ã€‚ å½“ä½ è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œpackagerä¼šå°†ä½ æ‰€æœ‰çš„ä»£ç éƒ½ç¼©å°ï¼Œå¹¶ç”Ÿæˆä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç (ä¸€ä¸ªç”¨äºiOSï¼Œä¸€ä¸ªç”¨äºAndroid)ï¼Œç„¶åå°†è¿™äº›ä»£ç ä¸Šä¼ åˆ°CDNä¸Šã€‚æ‚¨å°†è·å¾—ä¸€ä¸ªé“¾æ¥ï¼Œå¦‚https://exp.host/@ccheever/an-exampleï¼Œä»»ä½•äººéƒ½å¯ä»¥ä»è¿™ä¸ªé¡¹ç›®ä¸­åŠ è½½æ‚¨çš„é¡¹ç›®ã€‚ ä»»ä½•æ—¶å€™æ‚¨æƒ³è¦éƒ¨ç½²ä¸€ä¸ªæ›´æ–°ï¼Œå†æ¬¡ç‚¹å‡»å‘å¸ƒï¼Œæ–°çš„ç‰ˆæœ¬å°†ä¼šåœ¨ç”¨æˆ·ä¸‹ä¸€æ¬¡æ‰“å¼€å®ƒçš„æ—¶å€™ç«‹å³å¯ç”¨ã€‚ éƒ¨ç½²åˆ°App Storeå’ŒPlay Storeå½“ä½ å‡†å¤‡å¥½å°†ä½ çš„åº”ç”¨åˆ†å‘ç»™æœ€ç»ˆç”¨æˆ·æ—¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶(ipaæˆ–apkæ–‡ä»¶)ï¼Œç„¶åå°†å®ƒæ”¾åˆ°iOSåº”ç”¨å•†åº—å’ŒGoogle Playå•†åº—ä¸­ã€‚çœ‹åˆ°åˆ†å‘åº”ç”¨ç¨‹åºã€‚ è¿™ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºçŸ¥é“åœ¨ä½ çš„åº”ç”¨å‘å¸ƒçš„urlä¸­å¯»æ‰¾æ›´æ–°ï¼Œå¦‚æœä½ å‘å¸ƒäº†ä¸€ä¸ªæ›´æ–°ï¼Œé‚£ä¹ˆä¸‹æ¬¡ç”¨æˆ·æ‰“å¼€ä½ çš„åº”ç”¨æ—¶ï¼Œä»–ä»¬ä¼šè‡ªåŠ¨ä¸‹è½½è¿™ä¸ªæ–°ç‰ˆæœ¬ã€‚è¿™äº›é€šå¸¸è¢«ç§°ä¸ºâ€œç©ºä¸­â€(OTA)æ›´æ–°ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºCodePushï¼Œä½†å®ƒæ˜¯å†…ç½®åœ¨Expoä¸Šçš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦å®‰è£…ä»»ä½•ä¸œè¥¿ã€‚ è¦é…ç½®ä½ çš„åº”ç”¨ç¨‹åºå¤„ç†JSæ›´æ–°çš„æ–¹å¼ï¼Œè¯·å‚è§ç¦»çº¿æ”¯æŒã€‚ é™åˆ¶å¦‚æœæ‚¨åœ¨app.jsonä¸­åšå‡ºä»¥ä¸‹ä»»ä½•æ›´æ”¹ï¼Œæ‚¨å°†éœ€è¦é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´æ”¹ç”Ÿæ•ˆ: å¢åŠ Expo SDKç‰ˆæœ¬ åœ¨iosæˆ–å®‰å“ç³»ç»Ÿä¸‹ä¿®æ”¹ä»»ä½•ä¸œè¥¿ æ”¹å˜ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨ æ”¹å˜ä½ çš„åº”ç”¨ç¨‹åºå›¾æ ‡ æ”¹å˜ä½ çš„åº”ç”¨ç¨‹åºçš„åå­— æ”¹å˜ä½ çš„åº”ç”¨æ–¹æ¡ˆ æ”¹å˜ä½ çš„facebookScheme åœ¨assetBundlePatternsä¸‹æ”¹å˜ä½ çš„æ†ç»‘èµ„äº§ éšç§æ‚¨å¯ä»¥å°†é¡¹ç›®çš„éšç§è®¾ç½®åœ¨æ‚¨çš„app.jsoné…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å…³é”®çš„â€œprivacyâ€è®¾ç½®ä¸ºâ€œpublicâ€æˆ–â€œunlistedâ€ã€‚ è¿™äº›é€‰é¡¹çš„å·¥ä½œæ–¹å¼ä¸YouTubeä¸Šç±»ä¼¼ã€‚æœªåˆ—å‡ºçš„é¡¹ç›®urlå°†æ˜¯ç§˜å¯†çš„ï¼Œé™¤éæ‚¨å‘Šè¯‰äººä»¬å…³äºå®ƒä»¬æˆ–å…±äº«å®ƒä»¬ã€‚å…¬å…±é¡¹ç›®å¯èƒ½ä¼šå‡ºç°åœ¨å…¶ä»–å¼€å‘äººå‘˜èº«ä¸Šã€‚ é“¾æ¥ä»‹ç»æ¯ä¸ªå¥½çš„ç½‘ç«™éƒ½æœ‰https://ï¼Œhttpså°±æ˜¯æ‰€è°“çš„URLæ–¹æ¡ˆã€‚ä¸å®‰å…¨çš„ç½‘ç«™ä½¿ç”¨http://ï¼Œhttpæ˜¯URLæ–¹æ¡ˆã€‚æˆ‘ä»¬æŠŠå®ƒå«åšçŸ­æœŸè®¡åˆ’ã€‚ è¦ä»ä¸€ä¸ªç½‘ç«™å¯¼èˆªåˆ°å¦ä¸€ä¸ªç½‘ç«™ï¼Œä½ å¯ä»¥åœ¨ç½‘ç»œä¸Šä½¿ç”¨ä¸€ä¸ªé”šæ ‡ç­¾(&lt;a&gt;)ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨åƒçª—å£è¿™æ ·çš„JavaScript APIs window.historyå’Œwindow.locationã€‚ é™¤äº†httpsä¹‹å¤–ï¼Œæ‚¨å¯èƒ½è¿˜ç†Ÿæ‚‰mailto schemeã€‚å½“æ‚¨æ‰“å¼€mailto schemeçš„é“¾æ¥æ—¶ï¼Œæ‚¨çš„æ“ä½œç³»ç»Ÿå°†æ‰“å¼€ä¸€ä¸ªå·²å®‰è£…çš„é‚®ä»¶åº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨å®‰è£…äº†å¤šä¸ªé‚®ä»¶åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆæ‚¨çš„æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæç¤ºæ‚¨é€‰æ‹©ä¸€ä¸ªã€‚ç±»ä¼¼åœ°ï¼Œä¹Ÿæœ‰æ‰“ç”µè¯å’Œå‘çŸ­ä¿¡çš„è®¡åˆ’ã€‚è¯·é˜…è¯»ä¸‹é¢å…³äºå†…ç½®URLæ–¹æ¡ˆçš„æ›´å¤šä¿¡æ¯ã€‚ httpså’Œhttpæ˜¯ç”±æ‚¨çš„æµè§ˆå™¨å¤„ç†çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸åŒçš„urlæ–¹æ¡ˆé“¾æ¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»Slackè·å¾—ä¸€ä¸ªâ€œç¥å¥‡é“¾æ¥â€çš„ç”µå­é‚®ä»¶æ—¶ï¼Œâ€œå¯åŠ¨Slackâ€æŒ‰é’®æ˜¯ä¸€ä¸ªå¸¦æœ‰hrefçš„é”šæ ‡ç­¾ï¼Œå®ƒçœ‹èµ·æ¥åƒæ˜¯:slack://secret/magic-login/other-secretã€‚å°±åƒSlackä¸€æ ·ï¼Œä½ å¯ä»¥å‘Šè¯‰æ“ä½œç³»ç»Ÿä½ æƒ³è¦å¤„ç†ä¸€ä¸ªå®šåˆ¶çš„æ–¹æ¡ˆã€‚è¯·é˜…è¯»æœ‰å…³é…ç½®æ–¹æ¡ˆçš„æ›´å¤šä¿¡æ¯ã€‚å½“Slackåº”ç”¨æ‰“å¼€æ—¶ï¼Œå®ƒä¼šæ”¶åˆ°ç”¨äºæ‰“å¼€å®ƒçš„URLï¼Œç„¶åå¯ä»¥å¯¹é€šè¿‡URLæä¾›çš„æ•°æ®è¿›è¡Œæ“ä½œâ€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ªå°†ç”¨æˆ·ç™»å½•åˆ°ç‰¹å®šæœåŠ¡å™¨çš„ç§˜å¯†å­—ç¬¦ä¸²ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºæ·±åº¦é“¾æ¥ã€‚é˜…è¯»æ›´å¤šå…³äºå¦‚ä½•å¤„ç†ä½ çš„åº”ç”¨çš„æ·±åº¦é“¾æ¥ã€‚ æ·±åº¦é“¾æ¥ä¸schemeå¹¶ä¸æ˜¯å”¯ä¸€å¯ç”¨çš„é“¾æ¥å·¥å…·â€”â€”æˆ‘ä»¬æ­£åœ¨åŠªåŠ›ä¸ºiOSä¸Šçš„é€šç”¨é“¾æ¥æ·»åŠ æ”¯æŒï¼Œæˆ‘ä»¬è¿˜æ”¯æŒä¸åˆ†æ”¯çš„å»¶è¿Ÿæ·±åº¦é“¾æ¥ã€‚æˆ‘ä»¬å°†åœ¨æœªæ¥çš„sdkä¸­æ›´æ–°æ›´å¤šçš„ä¿¡æ¯ã€‚ ä»ä½ çš„åº”ç”¨ç¨‹åºåˆ°å…¶ä»–åº”ç”¨ç¨‹åºå†…ç½®çš„URLæ–¹æ¡ˆæ­£å¦‚åœ¨ç®€ä»‹ä¸­æåˆ°çš„ï¼Œåœ¨æ¯ä¸ªå¹³å°ä¸Šéƒ½å­˜åœ¨ä¸€äº›æ ¸å¿ƒåŠŸèƒ½çš„URLæ–¹æ¡ˆã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„åˆ—è¡¨ï¼Œä½†æ˜¯æ¶µç›–äº†æœ€å¸¸ç”¨çš„æ–¹æ¡ˆã€‚ Scheme æè¿° iOS Android mailto æ‰“å¼€é‚®ä»¶åº”ç”¨ï¼Œå¦‚:mailto: support@expo.io âœ… âœ… tel æ‰“å¼€phone app, eg: tel:+123456789 âœ… âœ… sms æ‰“å¼€SMS app, eg: sms:+123456789 âœ… âœ… https / http æ‰“å¼€webæµè§ˆå™¨app, eg: https://expo.io âœ… âœ… æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åºçš„é“¾æ¥React Nativeä¸­æ²¡æœ‰é”šæ ‡è®°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å†™&lt;a href=&quot;https://expo.io&quot;&gt;ã€‚ç›¸åï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨Linking.openURLã€‚ 123import &#123; Linking &#125; from 'react-native';Linking.openURL('https://expo.io'); é€šå¸¸ï¼Œå¦‚æœæ²¡æœ‰ç”¨æˆ·çš„è¯·æ±‚ï¼Œæ‚¨å°±ä¸ä¼šæ‰“å¼€URLï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„Anchorç»„ä»¶ç¤ºä¾‹ï¼Œå½“å®ƒè¢«æŒ‰ä¸‹æ—¶ï¼Œå®ƒå°†æ‰“å¼€ä¸€ä¸ªURLã€‚ 12345678910111213141516171819import &#123; Linking, Text &#125; from 'react-native';export default class Anchor extends React.Component &#123; _handlePress = () =&gt; &#123; Linking.openURL(this.props.href); this.props.onPress &amp;&amp; this.props.onPress(); &#125;; render() &#123; return ( &lt;Text &#123;...this.props&#125; onPress=&#123;this._handlePress&#125;&gt; &#123;this.props.children&#125; &lt;/Text&gt; ); &#125;&#125;// &lt;Anchor href=\"https://google.com\"&gt;Go to Google&lt;/Anchor&gt;// &lt;Anchor href=\"mailto://support@expo.io\"&gt;Go to Google&lt;/Anchor&gt; ä½¿ç”¨Expo.WebBrowserï¼Œè€Œä¸æ˜¯é“¾æ¥æ‰“å¼€webé“¾æ¥ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†æ‰“å¼€ä¸€ä¸ªwebé“¾æ¥ä½¿ç”¨Expo.WebBrowser.openBrowserAsyncå’ŒReact Nativeâ€™s Linking.openURLçš„çš„åŒºåˆ«ã€‚é€šå¸¸ï¼ŒWebBrowseræ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ˜¯ä½ çš„åº”ç”¨ä¸­çš„ä¸€ä¸ªæ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°å…³é—­å®ƒå¹¶è¿”å›åˆ°ä½ çš„åº”ç”¨ã€‚ 123456789101112131415161718192021import React, &#123; Component &#125; from &apos;react&apos;;import &#123; Button, Linking, View, StyleSheet &#125; from &apos;react-native&apos;;import &#123; Constants, WebBrowser &#125; from &apos;expo&apos;;export default class App extends Component &#123; render() &#123; return ( &lt;View style=&#123;styles.container&#125;&gt; &lt;Button title=&quot;Open URL with ReactNative.Linking&quot; onPress=&#123;this._handleOpenWithLinking&#125; style=&#123;styles.button&#125; /&gt; &lt;Button title=&quot;Open URL with Expo.WebBrowser&quot; onPress=&#123;this._handleOpenWithWebBrowser&#125; style=&#123;styles.button&#125; /&gt; &lt;/View&gt; ); &#125; æ‰“å¼€å…¶ä»–åº”ç”¨ç¨‹åºçš„é“¾æ¥å¦‚æœä½ çŸ¥é“å¦ä¸€æ¬¾åº”ç”¨çš„å®šåˆ¶æ–¹æ¡ˆï¼Œä½ å¯ä»¥é“¾æ¥åˆ°å®ƒã€‚ä¸€äº›æœåŠ¡æä¾›äº†æ·±åº¦é“¾æ¥çš„æ–‡æ¡£ï¼Œä¾‹å¦‚Lyftæ·±åº¦é“¾æ¥æ–‡æ¡£æè¿°äº†å¦‚ä½•ç›´æ¥é“¾æ¥åˆ°ç‰¹å®šçš„ä½ç½®å’Œç›®çš„åœ°: 1lyft://ridetype?id=lyft&amp;pickup[latitude]=37.764728&amp;pickup[longitude]=-122.422999&amp;destination[latitude]=37.7763592&amp;destination[longitude]=-122.4242038 ç”¨æˆ·å¯èƒ½æ²¡æœ‰å®‰è£…Lyftåº”ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³æ‰“å¼€åº”ç”¨/Playå•†åº—ï¼Œæˆ–è€…è®©ä»–ä»¬çŸ¥é“ä»–ä»¬éœ€è¦å…ˆå®‰è£…ã€‚æˆ‘ä»¬å»ºè®®åœ¨è¿™äº›æƒ…å†µä¸‹ä½¿ç”¨åº“react-native-app-linkã€‚ åœ¨iOSä¸Šï¼ŒLinking.canOpenUrléœ€è¦é¢å¤–çš„é…ç½®æ¥æŸ¥è¯¢å…¶ä»–åº”ç”¨çš„é“¾æ¥æ–¹æ¡ˆã€‚ä½ å¯ä»¥åœ¨ä½ çš„app.jsonä¸­ä½¿ç”¨ios.infoPlisté”®æ¥æŒ‡å®šåº”ç”¨ç¨‹åºéœ€è¦æŸ¥è¯¢çš„æ–¹æ¡ˆåˆ—è¡¨ã€‚ä¾‹å¦‚: 123\"infoPlist\": &#123; \"LSApplicationQueriesSchemes\": [\"lyft\"]&#125; å¦‚æœä½ æ²¡æœ‰æŒ‡å®šè¿™ä¸ªåˆ—è¡¨ï¼Œä¸ç®¡è®¾å¤‡æ˜¯å¦å®‰è£…äº†è¿™ä¸ªåº”ç”¨ï¼ŒLinking.canOpenUrlå¯èƒ½ä¼šè¿”å›falseã€‚æ³¨æ„ï¼Œè¿™ç§é…ç½®åªèƒ½åœ¨ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨Expoå®¢æˆ·ç«¯æµ‹è¯•æ—¶ä¸åº”ç”¨çš„æœ¬åœ°æ›´æ”¹ã€‚ é“¾æ¥åˆ°ä½ çš„åº”ç”¨åœ¨Expoå®¢æˆ·ç«¯åœ¨ç»§ç»­ä¹‹å‰ï¼ŒèŠ±ç‚¹æ—¶é—´å­¦ä¹ å¦‚ä½•åœ¨Expoå®¢æˆ·ç«¯é“¾æ¥åˆ°ä½ çš„åº”ç”¨ç¨‹åºæ˜¯å€¼å¾—çš„ã€‚Expoå®¢æˆ·ç«¯ä½¿ç”¨exp:// schemeï¼Œä½†å¦‚æœæˆ‘ä»¬é“¾æ¥åˆ°exp://æ²¡æœ‰ä»»ä½•åœ°å€ï¼Œå®ƒå°†ä¼šæ‰“å¼€åº”ç”¨åˆ°ä¸»ç•Œé¢ã€‚ åœ¨å¼€å‘ä¸­,åº”ç”¨ç¨‹åºå°†ä¼šä½åœ¨ä¸€ä¸ªurlåƒexp://wg-qka.community.app.exp.direct:80ã€‚å½“å®ƒè¢«éƒ¨ç½²æ—¶ï¼Œå®ƒå°†ä¼šå‡ºç°åœ¨ä¸€ä¸ªURLä¸­ï¼Œæ¯”å¦‚exp://exp.host/@community/with-webbrowser-redirectã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªç½‘ç«™ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé“¾æ¥ï¼Œæ¯”å¦‚&lt;a href=&quot;exp://expo.io/@community/with-webbrowser-redirect&quot;&gt;Open my project&lt;/a&gt;ã€‚æ‰“å¼€æˆ‘çš„é¡¹ç›®ï¼Œç„¶ååœ¨ä½ çš„è®¾å¤‡ä¸Šæ‰“å¼€è¿™ä¸ªç½‘ç«™ï¼Œç‚¹å‡»è¿™ä¸ªé“¾æ¥ï¼Œå®ƒå°±ä¼šåœ¨Expoå®¢æˆ·ç«¯æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨Linking.openURLä»å¦ä¸€ä¸ªåº”ç”¨ä¸­é“¾æ¥åˆ°å®ƒã€‚ åœ¨ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºè¦é“¾æ¥åˆ°ä½ çš„ç‹¬ç«‹åº”ç”¨ï¼Œä½ éœ€è¦ä¸ºä½ çš„åº”ç”¨ç¨‹åºæŒ‡å®šä¸€ä¸ªæ–¹æ¡ˆï¼Œä½ å¯ä»¥åœ¨ä½ çš„app.jsonä¸­æ³¨å†Œä¸€ä¸ªæ–¹æ¡ˆï¼Œé€šè¿‡åœ¨scheme keyä¸‹é¢æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²: 12345&#123; \"expo\": &#123; \"scheme\": \"myapp\" &#125;&#125; ä¸€æ—¦ä½ å»ºç«‹äº†ç‹¬ç«‹çš„åº”ç”¨ï¼Œå¹¶å°†å…¶å®‰è£…åˆ°ä½ çš„è®¾å¤‡ä¸Šï¼Œä½ å°±å¯ä»¥ç”¨myapp://çš„é“¾æ¥æ‰“å¼€å®ƒã€‚ Expo.Constants.linkingUriä¸ºäº†çœå»æ’å…¥å¤§é‡æ¡ä»¶çš„éº»çƒ¦ï¼ŒåŸºäºæ‚¨æ‰€åœ¨çš„ç¯å¢ƒå’Œç¡¬ç¼–ç urlï¼Œæˆ‘ä»¬æä¾›äº†linkingUriå¸¸é‡ã€‚å½“æ‚¨æƒ³è¦æä¾›ä¸€ä¸ªéœ€è¦é‡å®šå‘åˆ°åº”ç”¨ç¨‹åºçš„urlçš„æœåŠ¡æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒï¼Œå®ƒå°†è§£å†³ä»¥ä¸‹é—®é¢˜: åœ¨Expoå®¢æˆ·ç«¯å‘å¸ƒçš„åº”ç”¨:exp://exp.host/@community/with-webbrowser-redirect/+ ç‹¬ç«‹å‡ºç‰ˆçš„åº”ç”¨:myapp://+ å¼€å‘: exp://wg-qka.community.app.exp.direct:80/+ æ‚¨å°†æ³¨æ„åˆ°ï¼Œåœ¨æ¯ä¸ªURLçš„æœ«å°¾æœ‰ä¸€ä¸ª/+ â€” ä»»ä½•åœ¨/+ä¹‹åè¢«åº”ç”¨ç¨‹åºç”¨æ¥æ¥æ”¶æ•°æ®çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®ºã€‚ æ³¨æ„:ç›®å‰æœ‰ä¸€ä¸ªå·²çŸ¥çš„é—®é¢˜ï¼Œåœ¨Androidç‹¬ç«‹ç‰ˆæœ¬ä¸­æ²¡æœ‰å‡ºç°+ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä¸ä¹…çš„ç‰ˆæœ¬ä¸­è§£å†³è¿™ä¸ªé—®é¢˜ï¼ åœ¨ä½ çš„åº”ç”¨ä¸­å¤„ç†é“¾æ¥æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å¤„ç†æ‰“å¼€åº”ç”¨ç¨‹åºçš„urlã€‚ å¦‚æœåº”ç”¨å·²ç»æ‰“å¼€ï¼Œåº”ç”¨å°±ä¼šè¢«å¯åŠ¨ï¼Œé“¾æ¥äº‹ä»¶å°±ä¼šè¢«è§¦å‘ æ‚¨å¯ä»¥ä½¿ç”¨Linking.addEventListener(â€˜urlâ€™, callback)æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚ å¦‚æœè¿™ä¸ªåº”ç”¨ç¨‹åºè¿˜æ²¡æœ‰æ‰“å¼€ï¼Œå®ƒå°±ä¼šæ‰“å¼€ï¼Œurlä¼šä½œä¸ºinitialURLä¼ é€’ æ‚¨å¯ä»¥ä½¿ç”¨Linking.getInitialURLæ¥å¤„ç†è¿™äº›äº‹ä»¶â€”â€”å¦‚æœæœ‰çš„è¯ï¼Œå®ƒè¿”å›ä¸€ä¸ªè§£æåˆ°urlçš„Promiseã€‚ è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ï¼Œä»¥æŸ¥çœ‹è¿™äº›ç¤ºä¾‹ã€‚ é€šè¿‡URLå°†æ•°æ®ä¼ é€’ç»™åº”ç”¨ç¨‹åºå¦‚æœæˆ‘æƒ³å°†ä¸€äº›æ•°æ®ä¼ é€’åˆ°æˆ‘çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘å¯ä»¥åœ¨å¸¸é‡Constants.linkingUriçš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºqsçš„ä¸œè¥¿æ¥è§£ææŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ å½“å¤„ç†ç”¨äºæ‰“å¼€/å‰æ™¯åº”ç”¨çš„URLæ—¶ï¼Œå®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„: 12345678_handleUrl = (url) =&gt; &#123; this.setState(&#123; url &#125;); let queryString = url.replace(Constants.linkingUri, ''); if (queryString) &#123; let data = qs.parse(queryString); alert(`Linked to app with data: $&#123;JSON.stringify(data)&#125;`); &#125;&#125; å¦‚æœä½ æ‰“å¼€ä¸€ä¸ªURLï¼Œåƒ${Constants.linkingUri}?hello=world&amp;goodbye=nowï¼Œè¿™å°†ä¼šalert {hello: &#39;world&#39;, goodbye: &#39;now&#39;}ã€‚ ä¾‹å­:ä»ç½‘é¡µæµè§ˆå™¨é“¾æ¥åˆ°ä½ çš„åº”ç”¨ç¤ºä¾‹é¡¹ç›®examples/with-webbrowser-redirectæ¼”ç¤ºäº†å¦‚ä½•ä»WebBrowseré‡å®šå‘å¹¶ä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­è·å–æ•°æ®ã€‚åœ¨Expoä¸Šè¯•è¯•å§ã€‚ ç¤ºä¾‹:ä½¿ç”¨é“¾æ¥è¿›è¡Œèº«ä»½éªŒè¯é“¾æ¥åˆ°ä½ çš„åº”ç”¨çš„ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯åœ¨æ‰“å¼€ä¸€ä¸ªç½‘é¡µæµè§ˆå™¨åé‡å®šå‘å›ä½ çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨å±å¹•ä¸Šæ‰“å¼€ä¸€ä¸ªwebæµè§ˆå™¨ä¼šè¯ï¼Œå½“ç”¨æˆ·æˆåŠŸç™»å½•æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆå°†æ‚¨çš„ç½‘ç«™é‡å®šå‘åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å°†èº«ä»½éªŒè¯ä»¤ç‰Œå’Œå…¶ä»–æ•°æ®é™„åŠ åˆ°URLã€‚ æ³¨æ„:å¦‚æœå°è¯•ä½¿ç”¨é“¾æ¥ã€‚openURLæ‰“å¼€webæµè§ˆå™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åä½ çš„åº”ç”¨å¯èƒ½ä¼šè¢«è‹¹æœæ‹’ç»ï¼ŒåŸå› æ˜¯ç³Ÿç³•æˆ–ä»¤äººå›°æƒ‘çš„ç”¨æˆ·ä½“éªŒã€‚WebBrowser.openBrowserAsyncæ‰“å¼€äº†ä¸€ä¸ªæ¨¡æ€çš„æµè§ˆå™¨çª—å£ï¼Œå¤–è§‚å’Œæ„Ÿè§‰éƒ½å¾ˆå¥½ï¼Œè‹¹æœå…¬å¸ä¹Ÿæ‰¹å‡†äº†ã€‚ è¦æŸ¥çœ‹ä½¿ç”¨webæµè§ˆå™¨è¿›è¡Œèº«ä»½éªŒè¯çš„å®Œæ•´ç¤ºä¾‹ï¼Œè¯·å‚è§examples/with-facebook-authã€‚ç›®å‰ï¼ŒFacebookè®¤è¯è¦æ±‚ä½ éƒ¨ç½²ä¸€ä¸ªå°çš„webserveræ¥é‡å®šå‘åˆ°ä½ çš„åº”ç”¨ç¨‹åº(æ­£å¦‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æ‰€æè¿°çš„é‚£æ ·)ï¼Œå› ä¸ºFacebookä¸å…è®¸ä½ é‡å®šå‘åˆ°è‡ªå®šä¹‰çš„æ–¹æ¡ˆï¼Œè€ŒExpoæ­£åœ¨ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€ŒåŠªåŠ›ã€‚åœ¨Expoä¸Šè¯•ä¸€è¯•ã€‚ å¦ä¸€ä¸ªä½¿ç”¨WebBrowserè¿›è¡Œèº«ä»½éªŒè¯çš„ä¾‹å­å¯ä»¥åœ¨expo/auth0-exampleä¸­æ‰¾åˆ°ã€‚ å½“ä¸ä½¿ç”¨æ·±å±‚é“¾æ¥æ—¶è¿™æ˜¯åœ¨ä½ çš„åº”ç”¨ä¸­å»ºç«‹æ·±åº¦é“¾æ¥çš„æœ€ç®€å•æ–¹æ³•ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¾ˆå°‘çš„é…ç½®ã€‚ ä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å®‰è£…ä½ çš„åº”ç”¨ï¼Œå¹¶æŒ‰ç…§å®ƒçš„è‡ªå®šä¹‰æ¨¡å¼é“¾æ¥åˆ°ä½ çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆä»–ä»¬çš„æ“ä½œç³»ç»Ÿå°†ä¼šæ˜¾ç¤ºé¡µé¢ä¸èƒ½æ‰“å¼€ï¼Œä½†ä¸èƒ½æä¾›æ›´å¤šçš„ä¿¡æ¯ã€‚è¿™ä¸æ˜¯ä¸€æ¬¡ä¼Ÿå¤§çš„ç»å†ã€‚åœ¨æµè§ˆå™¨ä¸­æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æ­¤å¤–ï¼Œè®¸å¤šæ¶ˆæ¯åº”ç”¨ç¨‹åºä¸ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ¡ˆè‡ªåŠ¨ç”Ÿæˆurlâ€”â€”ä¾‹å¦‚ï¼Œexp://exp.host/@community/native-component-listå¯èƒ½åªæ˜¯åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºä¸ºçº¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ä½œä¸ºé“¾æ¥(exp://exp.host/@community/native- componentlist)ã€‚ Expo &amp; â€œCreate React Native Appâ€Create React Native Appå…è®¸æ‚¨æ„å»ºä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ„å»ºé…ç½®çš„React Native appã€‚è¿™å¯¹æ‚¨æ¥è¯´å¯èƒ½å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºä¸–åšä¼šä¹Ÿä¼šè¿™æ ·åšâ€”â€”å½“æ‚¨ç”¨XDEæˆ–expåˆ›å»ºä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œæ‚¨ä¸å¿…å¤„ç†Xcodeæˆ–Android Studioé…ç½®æ–‡ä»¶ï¼Œå®ƒåªæ˜¯å·¥ä½œã€‚æœ¬æŒ‡å—æ—¨åœ¨æ¦‚è¿°åšè§ˆä¼šä¸CRNA (create-react-native-app)ä¹‹é—´çš„ä¸€äº›å…³é”®åŒºåˆ«ã€‚ Expoæ˜¯å¦‚ä½•å·¥ä½œçš„ å‡çº§ Expo","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"React Native","slug":"React/React-Native","permalink":"https://jigangduan.github.io/categories/React/React-Native/"},{"name":"Expo","slug":"React/React-Native/Expo","permalink":"https://jigangduan.github.io/categories/React/React-Native/Expo/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"react-native","slug":"react-native","permalink":"https://jigangduan.github.io/tags/react-native/"},{"name":"expo","slug":"expo","permalink":"https://jigangduan.github.io/tags/expo/"}]},{"title":"Expo ä»‹ç»","slug":"expo-introduce","date":"2018-02-08T03:38:08.000Z","updated":"2020-07-25T02:57:18.200Z","comments":true,"path":"2018/02/08/expo-introduce/","link":"","permalink":"https://jigangduan.github.io/2018/02/08/expo-introduce/","excerpt":"how-to-become-a-react-native-developer ä»‹ç»Expoæ˜¯ä¸€å¥—å·¥å…·ã€åº“å’ŒæœåŠ¡ï¼Œè®©ä½ å¯ä»¥é€šè¿‡ç¼–å†™JavaScriptæ¥æ„å»ºæœ¬åœ°çš„iOSå’ŒAndroidåº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨Expoå·¥ä½œè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Expoå¼€å‘ç¯å¢ƒå’Œå·¥å…·çš„å„ä¸ªæ–¹é¢ã€‚å¦‚æœä½ å¯¹Expoå®Œå…¨é™Œç”Ÿï¼Œä¸€å®šè¦ç¡®ä¿ä½ å·²ç»å®‰è£…å¥½äº†å·¥å…·å¹¶å››å¤„çœ‹çœ‹ã€‚åœ¨æ­¤ä¹‹åï¼Œæ‚¨å¯èƒ½æƒ³è¦é˜…è¯»å¹¶è¿è¡Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚","text":"how-to-become-a-react-native-developer ä»‹ç»Expoæ˜¯ä¸€å¥—å·¥å…·ã€åº“å’ŒæœåŠ¡ï¼Œè®©ä½ å¯ä»¥é€šè¿‡ç¼–å†™JavaScriptæ¥æ„å»ºæœ¬åœ°çš„iOSå’ŒAndroidåº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨Expoå·¥ä½œè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Expoå¼€å‘ç¯å¢ƒå’Œå·¥å…·çš„å„ä¸ªæ–¹é¢ã€‚å¦‚æœä½ å¯¹Expoå®Œå…¨é™Œç”Ÿï¼Œä¸€å®šè¦ç¡®ä¿ä½ å·²ç»å®‰è£…å¥½äº†å·¥å…·å¹¶å››å¤„çœ‹çœ‹ã€‚åœ¨æ­¤ä¹‹åï¼Œæ‚¨å¯èƒ½æƒ³è¦é˜…è¯»å¹¶è¿è¡Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚ å¿«é€Ÿå…¥é—¨ä»‹ç»Expoåº”ç”¨ç¨‹åºæ˜¯å¸¦æœ‰Expo SDKçš„æœ¬åœ°åº”ç”¨ç¨‹åºã€‚SDKæ˜¯ä¸€ä¸ªnative-and-JSåº“ï¼Œå®ƒæä¾›äº†å¯¹è®¾å¤‡çš„ç³»ç»ŸåŠŸèƒ½çš„è®¿é—®(åƒç…§ç›¸æœºã€è”ç³»äººã€æœ¬åœ°å­˜å‚¨å’Œå…¶ä»–ç¡¬ä»¶)ã€‚è¿™æ„å‘³ç€æ‚¨ä¸éœ€è¦ä½¿ç”¨Xcodeæˆ–Android Studioï¼Œä¹Ÿä¸éœ€è¦ç¼–å†™ä»»ä½•æœ¬åœ°ä»£ç ï¼Œè€Œä¸”å®ƒä¹Ÿä½¿æ‚¨çš„çº¯jsé¡¹ç›®éå¸¸ä¾¿äºç§»æ¤ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨åŒ…å«ä¸–åšä¼šSDKçš„ä»»ä½•æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œã€‚ Expoè¿˜æä¾›äº†UIç»„ä»¶æ¥å¤„ç†å„ç§å„æ ·çš„ç”¨ä¾‹ï¼Œè¿™äº›ç”¨ä¾‹å‡ ä¹æ‰€æœ‰çš„åº”ç”¨éƒ½èƒ½è¦†ç›–ï¼Œä½†æ²¡æœ‰è¢«èå…¥åˆ°React Nativeä¸­ï¼Œæ¯”å¦‚å›¾æ ‡ã€æ¨¡ç³Šè§†å›¾ç­‰ç­‰ã€‚ æœ€åï¼ŒExpo SDKæä¾›äº†å¯¹æœåŠ¡çš„è®¿é—®ï¼Œè¿™äº›æœåŠ¡é€šå¸¸æ˜¯ä¸€ç§å¾ˆéš¾ç®¡ç†çš„æœåŠ¡ï¼Œä½†å‡ ä¹æ¯ä¸ªåº”ç”¨éƒ½éœ€è¦å®ƒã€‚å…¶ä¸­æœ€å—æ¬¢è¿çš„æ˜¯:Expoå¯ä»¥ä¸ºä½ ç®¡ç†ä½ çš„èµ„äº§ï¼Œå®ƒå¯ä»¥å¸®ä½ å¤„ç†æ¨é€é€šçŸ¥ï¼Œå®ƒè¿˜å¯ä»¥æ„å»ºåŸç”ŸäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶å·²ç»å‡†å¤‡å¥½éƒ¨ç½²åˆ°app storeä¸­ã€‚ è€ƒè™‘ä½¿ç”¨Expoå—? å¦‚æœä½ æƒ³äº†è§£ä¸€ä¸‹Expoæä¾›äº†ä»€ä¹ˆï¼Œä½ å¯èƒ½æƒ³è¦ç†Ÿæ‚‰ä¸€ä¸‹Expoé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒæè¿°äº†ä½ æ˜¯å¦‚ä½•è¿›å…¥ä¸€ä¸ªäº§å“çš„iOSå’ŒAndroidåº”ç”¨çš„åœºæ™¯ã€‚ ä¸ºäº†è¿›ä¸€æ­¥è§£é‡Šï¼Œæ£€æŸ¥ç»å¸¸è¢«é—®åˆ°çš„é—®é¢˜ä¹Ÿå¾ˆå¥½ã€‚ å‡†å¤‡å¥½å¼€å§‹äº†å—? é¦–å…ˆå®‰è£…å·¥å…·ï¼Œçœ‹çœ‹å‘¨å›´çš„æƒ…å†µã€‚ é€šè¿‡è·Ÿè¸ªå’Œè¿è¡ŒæŒ‡å—æ¥å®Œæˆä½ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚ å¦‚æœæ‚¨è¿˜ä¸ç†Ÿæ‚‰Reactå’ŒReact Nativeï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨React Native Expressæ¥å¼•å¯¼æ‚¨çš„çŸ¥è¯†ã€‚ å®‰è£…å¼€å‘åº”ç”¨ç¨‹åºä½ éœ€è¦æœ‰ä¸¤ç§å·¥å…·â€”â€”ä¸€ä¸ªæ¡Œé¢å¼€å‘å·¥å…·å’Œä¸€ä¸ªç§»åŠ¨å®¢æˆ·ç«¯æ¥æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åºã€‚ æ¡Œé¢å¼€å‘å·¥å…·:XDEXDEä»£è¡¨Expoå¼€å‘ç¯å¢ƒã€‚å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼ŒåŒ…å«äº†æ‰€æœ‰éœ€è¦å¯åŠ¨çš„ä¾èµ–é¡¹ã€‚ ä¸ºmacOSã€Windows(64ä½)æˆ–Linuxä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„XDEã€‚ åœ¨Linuxä¸Šï¼Œæ‰“å¼€chmod a+x xde.AppImage å’Œ ./xde.AppImageã€‚ ç§»åŠ¨å®¢æˆ·ç«¯:iOSå’ŒAndroid ExpoExpoå®¢æˆ·ç«¯å°±åƒä¸€ä¸ªç”¨Expoæ­å»ºçš„åº”ç”¨çš„æµè§ˆå™¨ã€‚å½“ä½ åœ¨ä½ çš„é¡¹ç›®ä¸Šå¯åŠ¨XDEæ—¶ï¼Œå®ƒä¼šä¸ºä½ ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹çš„å¼€å‘URLï¼Œä½ å¯ä»¥ä»iOSæˆ–Androidçš„ä¸–åšä¼šå®¢æˆ·ç«¯è®¿é—®å®ƒï¼Œæ— è®ºæ˜¯åœ¨çœŸå®çš„è®¾å¤‡ä¸Šï¼Œè¿˜æ˜¯åœ¨æ¨¡æ‹Ÿå™¨ä¸Šã€‚ åœ¨ä½ çš„è®¾å¤‡ä¸‹è½½Androidä»Play Store æˆ– iOSä»App Store æ‰€éœ€çš„Androidå’ŒiOSç‰ˆæœ¬:æœ€ä½çš„Androidç‰ˆæœ¬æ”¯æŒæ˜¯Android 4.4ï¼Œæœ€å°çš„iOSç‰ˆæœ¬æ˜¯iOS 9.0ã€‚ æ‚¨ä¸éœ€è¦åœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ‰‹åŠ¨å®‰è£…ä¸–åšä¼šå®¢æˆ·ç«¯ï¼Œå› ä¸ºXDEä¼šè‡ªåŠ¨å®Œæˆè¿™ä¸ªæ“ä½œã€‚è¯·å‚é˜…æœ¬æŒ‡å—çš„ä¸‹ä¸€éƒ¨åˆ†ã€‚ iOSæ¨¡æ‹Ÿå™¨é€šè¿‡è‹¹æœApp Storeå®‰è£…Xcodeã€‚éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå»æ‰“ä¸ªç›¹ã€‚æ¥ä¸‹æ¥ï¼Œæ‰“å¼€Xcodeï¼Œè¿›å…¥é¦–é€‰é¡¹å¹¶å•å‡»ç»„ä»¶é€‰é¡¹å¡ï¼Œä»åˆ—è¡¨ä¸­å®‰è£…æ¨¡æ‹Ÿå™¨ã€‚ ä¸€æ—¦æ¨¡æ‹Ÿå™¨æ‰“å¼€ï¼Œä½ åœ¨XDEä¸­æ‰“å¼€äº†ä¸€ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥åœ¨XDEä¸Šæ‰“å¼€iOSæ¨¡æ‹Ÿå™¨ï¼Œå®ƒä¼šå°†Expoå®¢æˆ·ç«¯å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Šï¼Œå¹¶åœ¨é‡Œé¢æ‰“å¼€ä½ çš„åº”ç”¨ã€‚ ä¸å·¥ä½œå—? æœ‰æ—¶XDEä¼šè‡ªåŠ¨å®‰è£…ä¸–åšå®¢æˆ·ç«¯ï¼Œé€šå¸¸æ˜¯ç”±äºä½ çš„ç¯å¢ƒæˆ–Xcodeå·¥å…·é“¾ä¸Šçš„å°å·®å¼‚é€ æˆçš„ã€‚å¦‚æœæ‚¨éœ€è¦æ‰‹åŠ¨åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå®‰è£…ä¸–åšä¼šå®¢æˆ·ç«¯ï¼Œæ‚¨å¯ä»¥éµå¾ªä»¥ä¸‹æ­¥éª¤: ä¸‹è½½æœ€æ–°çš„æ¨¡æ‹Ÿå™¨æ„å»ºã€‚ æå–å­˜æ¡£çš„å†…å®¹ã€‚ä½ åº”è¯¥å¾—åˆ°ä¸€ä¸ªåƒæŒ‡æ•°.x.xxxè¿™æ ·çš„ç›®å½•ã€‚ ç¡®ä¿æ¨¡æ‹Ÿå™¨æ­£åœ¨è¿è¡Œã€‚ åœ¨ç»ˆç«¯ä¸­ï¼Œè¿è¡Œ xcrun simctl install booted [path to extracted directory] Androidæ¨¡æ‹Ÿå™¨ä¸‹è½½Genymotion(å…è´¹ç‰ˆ)ï¼Œå¹¶éµå¾ªGenymotionå®‰è£…æŒ‡å—ã€‚ä¸€æ—¦ä½ å®‰è£…äº†Genymotionï¼Œåˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿè®¾å¤‡â€”â€”æˆ‘ä»¬æ¨èNexus 5ï¼ŒAndroidç‰ˆæœ¬å°±ä¼šç”±ä½ æ¥å†³å®šã€‚åœ¨å‡†å¤‡å¥½æ—¶å¯åŠ¨è™šæ‹Ÿè®¾å¤‡ã€‚ ä¸€æ—¦æ¨¡æ‹Ÿå™¨æ‰“å¼€ï¼Œä½ åœ¨XDEä¸­æ‰“å¼€äº†ä¸€ä¸ªé¡¹ç›®ï¼Œä½ å°±å¯ä»¥åœ¨XDEçš„Androidå¹³å°ä¸Šå‘å¸ƒå¼€æ”¾é¡¹ç›®ï¼Œå®ƒä¼šå°†Expoå®¢æˆ·ç«¯å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Šï¼Œå¹¶åœ¨é‡Œé¢æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·éµå¾ªæˆ‘ä»¬çš„GenymotionæŒ‡å—ã€‚ Node.jsè¦æƒ³å¼€å§‹Expoï¼Œä½ ä¸ä¸€å®šéœ€è¦å®‰è£…äº†Node.jsï¼Œä½†ä¸€æ—¦ä½ å¼€å§‹æ„å»ºä¸œè¥¿ï¼Œä½ å°±ä¼šæƒ³è¦æ‹¥æœ‰å®ƒã€‚ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Node.jsã€‚ Watchmanä¸€äº›macOSç”¨æˆ·ä¼šé‡åˆ°é—®é¢˜ï¼Œå¦‚æœä»–ä»¬æ²¡æœ‰å®‰è£…åœ¨ä»–ä»¬çš„æœºå™¨ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å»ºè®®æ‚¨å®‰è£…Watchmanã€‚å½“ç”¨æˆ·æ”¹å˜æ—¶ï¼Œä»–ä»¬ä¼šè§‚å¯Ÿæ–‡ä»¶å’Œè®°å½•ï¼Œç„¶åè§¦å‘ç›¸åº”çš„åŠ¨ä½œï¼Œå¹¶åœ¨å†…éƒ¨è¿›è¡Œååº”ã€‚ä¸‹è½½å¹¶å®‰è£…Watchmanã€‚ XDEä¹‹æ—…ç™»å½•å±å¹•å½“ä½ ç¬¬ä¸€æ¬¡æ‰“å¼€XDEæ—¶ï¼Œä½ ä¼šåœ¨å±å¹•ä¸Šçœ‹åˆ°è¿™ä¸ªæ ‡å¿—ã€‚å¦‚æœä½ å·²ç»æœ‰äº†ä¸€ä¸ªè´¦æˆ·ï¼Œè¯·ç»§ç»­ç™»å½•ã€‚å¦‚æœä½ ä¸è¿™æ ·åšï¼Œè¦ä¹ˆå’ŒGithubç­¾çº¦ï¼Œè¦ä¹ˆæ³¨å†Œä¸€ä¸ªè´¦æˆ·ã€‚ ä¸»å±å¹•æˆåŠŸ,ä½ ç­¾ç½²!åœ¨è¿™ä¸ªå±å¹•ä¸Šï¼Œæ‚¨å¯èƒ½æƒ³è¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæˆ–è€…æ‰“å¼€ä¸€ä¸ªç°æœ‰çš„é¡¹ç›®ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬åˆ—å‡ºäº†ä¸€äº›æœ€è¿‘å¼€æ”¾çš„é¡¹ç›®ã€‚ é¡¹ç›®å¯¹è¯æ¡†ç‚¹å‡»é¡¹ç›®ï¼Œä½ å°±ä¼šçœ‹åˆ°ä½ èƒ½åšçš„ä¸€åˆ‡ã€‚å½“ç„¶ï¼Œä½ ä¸èƒ½å…³é—­ä¸€ä¸ªé¡¹ç›®æˆ–è€…åœ¨finderä¸­æ˜¾ç¤ºå®ƒï¼Œå› ä¸ºä½ è¿˜æ²¡æœ‰æ‰“å¼€ä¸€ä¸ªé¡¹ç›®ã€‚ é€€å‡º,å¦‚æœä½ æƒ³è¦åœ¨ä»»ä½•æ—¶å€™ï¼Œä½ éƒ½å¯ä»¥ç‚¹å‡»å³ä¸Šæ–¹çš„ç”¨æˆ·åå¹¶é€€å‡ºã€‚æˆ–æ³¨é”€ã€‚è°èƒ½çœŸæ­£åŒæ„è¿™ä¸€çœ‹æ³•å‘¢? é¡¹ç›®å±å¹•æ‰€ä»¥æˆ‘ä»¬å·²ç»å¼€æ”¾äº†ä¸€ä¸ªæ–°é¡¹ç›®ã€‚å·¦è¾¹çš„çª—æ ¼æ˜¯ReactåŒ…è£…å™¨ï¼Œæ‚¨å¯ä»¥åœ¨å®ƒçš„å¯åŠ¨å’Œè¿è¡Œä¸­äº†è§£æ›´å¤šå…³äºExpoçš„å·¥ä½œã€‚å³è¾¹çš„é¢æ¿æ˜¯ç”¨äºè®¾å¤‡æ—¥å¿—çš„ï¼Œæ‚¨å¯ä»¥åœ¨æŸ¥çœ‹æ—¥å¿—ä¸­çœ‹åˆ°æ›´å¤šçš„å†…å®¹ã€‚ åˆ†äº«å‘ä»»ä½•æœ‰äº’è”ç½‘è¿æ¥çš„äººå‘é€ä½ çš„åº”ç”¨ç¨‹åºçš„é“¾æ¥ã€‚å¦‚æœä½ çš„è®¾å¤‡æ²¡æœ‰è¿æ¥åˆ°ä½ çš„ç”µè„‘ä¸Šï¼Œè¿™ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ è®¾å¤‡ä¸Šæ‰“å¼€è®¾å¤‡æŒ‰é’®å¯ä»¥è®©ä½ åœ¨è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šå¿«é€Ÿæ‰“å¼€ä½ çš„åº”ç”¨ã€‚æ›´å¤šçš„é˜…è¯»å¯åŠ¨å’Œè¿è¡Œã€‚ å¼€å‘æ¨¡å¼æ‚¨é€šå¸¸å¸Œæœ›åœ¨å¼€å‘æ¨¡å¼ä¸­ä½¿ç”¨æ‚¨çš„é¡¹ç›®ã€‚è¿™ä½¿å®ƒè¿è¡Œå¾—ç¨å¾®æ…¢ä¸€äº›ï¼Œå› ä¸ºå®ƒå¢åŠ äº†å¾ˆå¤šè¿è¡Œæ—¶éªŒè¯çš„ä»£ç æ¥è­¦å‘Šæ‚¨æ½œåœ¨çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒä¹Ÿæä¾›äº†å®æ—¶é‡è½½ã€çƒ­é‡è½½ã€è¿œç¨‹è°ƒè¯•å’Œå…ƒç´ æ£€æŸ¥å™¨çš„è®¿é—®æƒã€‚å¦‚æœä½ æƒ³æµ‹è¯•ä¸æ€§èƒ½ç›¸å…³çš„ä»»ä½•ä¸œè¥¿ï¼Œç¦ç”¨å¼€å‘æ¨¡å¼å¹¶é‡æ–°åŠ è½½ä½ çš„åº”ç”¨ã€‚ é¡¹ç›®å¯¹è¯æ¡†(ä¸é¡¹ç›®æ‰“å¼€)é™¤äº†ä¸»å±å¹•æä¾›çš„é€‰é¡¹å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä¸€äº›å¿«æ·æ–¹å¼ï¼Œæ¯”å¦‚åœ¨finderä¸­æ˜¾ç¤ºé¡¹ç›®ç›®å½•ã€‚ å‘å¸ƒå½“ä½ åœ¨ä½ çš„é¡¹ç›®ä¸Šå·¥ä½œçš„æ—¶å€™ï¼Œå®ƒä¼šå¾—åˆ°ä¸€ä¸ªä¸´æ—¶çš„URLï¼Œä»ä½ çš„ç”µè„‘ä¸Šæä¾›ã€‚å½“ä½ å‡†å¤‡å¥½ä¸ä»–äººåˆ†äº«è¿™ä¸ªé¡¹ç›®æ—¶ï¼Œä½ å¯ä»¥ å‘å¸ƒ è¿™ä¸ªé¡¹ç›®æ¥è·å¾—ä¸€ä¸ªæ°¸ä¹…çš„URL(ç±»ä¼¼expo.io/@your-username/your-app-slug)ï¼Œä»»ä½•äººéƒ½å¯ä»¥å’ŒExpoçš„å®¢æˆ·ä¸€èµ·å¼€æ”¾ã€‚ å½“æ‚¨ç‚¹å‡»XDEä¸­çš„PublishæŒ‰é’®æ—¶ï¼Œæ‚¨å°†è¢«è¦æ±‚ç¡®è®¤æ‚¨å¸Œæœ›æ‚¨çš„é¡¹ç›®å¯¹å…¬ä¼—å¼€æ”¾ã€‚XDEéœ€è¦èŠ±ä¸€äº›æ—¶é—´æ¥ç”Ÿæˆä½ çš„è¿·ä½ JSåŒ…ï¼Œå¹¶å°†ä½ çš„èµ„äº§ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šï¼Œä¸€æ—¦å®Œæˆï¼Œæ‰“å°å‡ºä½ çš„åº”ç”¨å‘å¸ƒçš„URLã€‚ä½ å¯ä»¥è¯»åˆ°æ›´å¤šçš„ç»†èŠ‚ï¼Œå…³äºåœ¨Expoå¦‚ä½•è¿ä½œå’Œå‘å¸ƒæŒ‡å—æ–¹é¢ï¼Œå‘å¸ƒæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ é¡¹ç›®ç”Ÿå‘½å‘¨æœŸExpoè®©ä½ å¾ˆå®¹æ˜“å¼€å§‹ç¼–å†™åº”ç”¨ç¨‹åºï¼Œä½†Expoä¹Ÿå¯ä»¥å°†ä½ çš„é¡¹ç›®å¸¦å‘ç”Ÿäº§ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯èƒ½åœ¨æ­¤è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å·¥å…·å’ŒæœåŠ¡çš„æ¦‚è¿°ã€‚ æœ¬æŒ‡å—æ—¨åœ¨å¯¹Expoæä¾›çš„å†…å®¹è¿›è¡Œé«˜å±‚æ¬¡çš„è§£é‡Šã€‚å‡ºäºå¥½å¥‡ï¼Œè¿™äº›ä¸»é¢˜çš„æŠ€æœ¯å®ç°å°†åœ¨è¿™é‡Œæ›´è¯¦ç»†åœ°ä»‹ç»ã€‚ åˆ›å»ºä¸€ä¸ªä¸–åšä¼šé¡¹ç›®æ‚¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ¡Œé¢å·¥å…·å’Œæ–‡æœ¬ç¼–è¾‘å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„Expoé¡¹ç›®ã€‚æŸ¥çœ‹å¯åŠ¨å¹¶è¿è¡Œä¸€ä¸ªå¿«é€ŸæŒ‡å—æ¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨ä¸€ä¸ªè®¾å¤‡ä¸Šè¿è¡Œå®ƒï¼Œå¹¶è¿›è¡Œæ›´æ”¹ã€‚ Expoåº”ç”¨ç¨‹åºæ˜¯æœ¬åœ°åº”ç”¨ç¨‹åºã€‚æœ€å¿«çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¯åŠ¨å¹¶è¿è¡ŒæŒ‡å—ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥è½¬æ¢ä¸€ä¸ªå·²æœ‰çš„React Nativeåº”ç”¨ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªç”±create-react-native-appç”Ÿæˆçš„é¡¹ç›®ã€‚ æœ¬åœ°å¼€å‘å½“ä½ åœ¨ä¸€ä¸ªExpoé¡¹ç›®ä¸Šå·¥ä½œæ—¶ï¼Œæˆ‘ä»¬ä¼šä»ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šä¸ºä½ çš„é¡¹ç›®æä¾›ä¸€ä¸ªå®ä¾‹ã€‚å¦‚æœä½ å…³é—­äº†è¿™ä¸ªé¡¹ç›®æˆ–è€…å…³é—­äº†ä½ çš„ç”µè„‘ï¼Œä½ çš„å¼€å‘é¡¹ç›®å°±ä¼šåœæ­¢ã€‚ åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åšExpo Clientçš„é¢„æ„å»ºçš„iOS/Androidåº”ç”¨æ¥æµ‹è¯•ä½ çš„é¡¹ç›®ã€‚å®ƒè¦æ±‚æ‚¨çš„è®¡ç®—æœºä¸ºæ‚¨çš„é¡¹ç›®çš„æœ¬åœ°å‰¯æœ¬(é€šè¿‡localhostã€LANæˆ–éš§é“)ï¼Œä¸‹è½½å®ƒï¼Œå¹¶è¿è¡Œå®ƒã€‚æ‚¨å¯ä»¥åˆ©ç”¨å„ç§å¼€å‘å·¥å…·ï¼Œå¦‚è°ƒè¯•ã€æµè®¾å¤‡æ—¥å¿—ã€æ£€æŸ¥å…ƒç´ ã€çƒ­æ¨¡å—é‡æ–°åŠ è½½ç­‰ç­‰ã€‚ å‘å¸ƒæ‚¨çš„é¡¹ç›®å¦‚æœä½ ç‚¹å‡»XDEçš„ å‘å¸ƒ æŒ‰é’®ï¼Œæˆ‘ä»¬å°±ä¼šå°†ä½ çš„åº”ç”¨çš„ä¸€ä¸ªè¿·ä½ ç‰ˆå¤åˆ¶åˆ°æˆ‘ä»¬çš„CDNä¸Šï¼Œå¹¶ç»™ä½ ä¸€ä¸ªå¯åˆ†äº«çš„ç½‘å€ï¼Œä½ çš„åœ°å€ï¼Œexpo.io/@your-username/your-app-slugã€‚ ä½ å¯ä»¥ç«‹å³ä¸ä»»ä½•æ‹¥æœ‰Expo Clientåº”ç”¨ç¨‹åºçš„äººåˆ†äº«è¿™ä¸ªé“¾æ¥ï¼Œé˜…è¯»æ›´å¤šå…³äºè¿™é‡Œçš„å‘å¸ƒã€‚ æ›´æ–°åº”ç”¨ç¨‹åºæ‚¨å¯ä»¥åœ¨ä¸å½±å“ç”¨æˆ·çš„æƒ…å†µä¸‹ç»§ç»­åœ¨æœ¬åœ°è¿›è¡Œæ›´æ”¹ã€‚ä»»ä½•æ—¶å€™ä½ å‘å¸ƒåº”ç”¨ç¨‹åºçš„ä¿®æ”¹ï¼Œä½ çš„æ–°ç‰ˆæœ¬å°±ä¼šç«‹å³è¢«ä»»ä½•æœ‰é“¾æ¥çš„äººä½¿ç”¨ã€‚ æˆ‘ä»¬ç»å¸¸å‘å¸ƒå¯¹Expo SDKçš„æ›´æ–°ã€‚æ¯æ¬¡æ›´æ–°åŒ…æ‹¬è¯´æ˜å¦‚ä½•å‡çº§ä½ çš„é¡¹ç›®ã€‚å¦‚æœæ‚¨å†³å®šæ›´æ–°æˆ‘ä»¬çš„SDKçš„æ›´æ–°ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ—§ç‰ˆæœ¬çš„å‰¯æœ¬å°†ç»§ç»­æ­£å¸¸å·¥ä½œã€‚ç”¨æˆ·å°†ä¸‹è½½ä»–ä»¬çš„å®¢æˆ·ç«¯æ”¯æŒçš„æœ€æ–°ç‰ˆæœ¬ã€‚ éƒ¨ç½²åˆ°è‹¹æœåº”ç”¨å•†åº—å’ŒGoogle Playå•†åº—å½“ä½ å‡†å¤‡åœ¨è‹¹æœåº”ç”¨å•†åº—å’ŒGoogle Playå•†åº—æ­£å¼å‘å¸ƒä½ çš„åº”ç”¨æ—¶ï¼Œä¸–åšä¼šå°±å¯ä»¥ä¸ºä½ å¸¦æ¥éƒ¨ç½²äº†.ipaå’Œ.apkï¼Œå‡†å¤‡æäº¤ç»™è‹¹æœå’Œè°·æ­Œã€‚æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šç”Ÿæˆå®ƒä»¬ï¼Œæ‰€ä»¥ä½ ä»ç„¶ä¸éœ€è¦ä»»ä½•è‹¹æœæˆ–è°·æ­Œè½¯ä»¶ã€‚å‚è§å…³äºåˆ†å‘åº”ç”¨ç¨‹åºçš„æ–‡æ¡£ã€‚ æ›´æ”¹æœ¬åœ°ä»£ç ä½ å¯ä»¥åœ¨app Storeå’ŒPlayå•†åº—ä¸­ä½¿ç”¨ä½ çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶åªç¼–å†™JSã€‚ç„¶è€Œï¼Œå¦‚æœä½ é‡åˆ°äº†Expoæ‰€æ²¡æœ‰çš„ç‰¹æ®Šçš„é«˜çº§éœ€æ±‚ï¼Œæˆ‘ä»¬å°±æä¾›äº†åˆ†ç¦»åˆ°ExpoKitçš„èƒ½åŠ›ï¼Œè¿™æ˜¯ä½ çš„Expoé¡¹ç›®çš„æœ¬åœ°Xcodeå’ŒAndroidå·¥ä½œå®¤çš„ä»£è¡¨ã€‚ âš ï¸:å¦‚æœæ‚¨é€‰æ‹©ä¸Expoåˆ†å¼€ï¼Œä¸€äº›ExpoæœåŠ¡å°†ä¸å¤å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸èƒ½å†ä¸ºæ‚¨ç”Ÿæˆç‹¬ç«‹çš„æ„å»ºã€‚æ‚¨éœ€è¦è‡ªå·±ç®¡ç†æœ¬æœºæ„å»ºã€‚ é¢å¤–çš„èµ„æºä»¥ä¸‹èµ„æºå¯¹äºå­¦ä¹ Expoå’Œå®ƒæ‰€ä¾èµ–çš„ä¸€äº›é¡¹ç›®æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ Expo åšå®¢ Expositionâ€”â€”å®˜æ–¹åšå®¢ï¼Œæ¯ä¸ªæœˆæˆ‘ä»¬éƒ½ä¼šå‘å¸ƒæ–°é—»ç¨¿å’Œå…¶ä»–ä¸Expoç›¸å…³çš„å†…å®¹ã€‚ è¯¾ç¨‹ ä½¿ç”¨Expo repl.it - React Native - åœ¨æ¥ä¸‹æ¥çš„5åˆ†é’Ÿå†…æ„å»ºä½ çš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åº (å…è´¹) React Europe - React Nativeå·¥ä½œå®¤è§†é¢‘åœ¨YouTubeçš„ä»‹ç» (å…è´¹) RMOTR - React Native &amp; Expo ç§»åŠ¨å¼€å‘ (ä»˜è´¹) Udemy - React Native: Stephen Griderçš„é«˜çº§æ¦‚å¿µ (ä»˜è´¹) Udacity - React Nanodegree (ä»˜è´¹) React Native React Native Express - React Nativeæœ€ä½³å®è·µå…¥é—¨! è¿™æ˜¯å¯¹ React å’Œ React Nativeçš„æ„å»ºå—çš„ä¸€æ¬¡æ¼”ç»ƒ. å®˜æ–¹ React Native æ–‡æ¡£ React Native åŸºæœ¬åŸç† (egadad.ioè§†é¢‘è¯¾ç¨‹) åŠ¨æ€ React Native UI å…ƒç´  (egadad.ioçš„è§†é¢‘è¯¾ç¨‹) å­¦ä¹  React Native (ä¹¦) Jani EvÃ¤kallioçš„èŠå¤©æ•™ç¨‹ ä¼šè°ˆ React Native Europe - Snackçš„å»ºç«‹ React Europe - Expo Snack React Conf - åˆ›å»º React Native App Reactive - ä»React web åˆ°æœ¬åœ°ç§»åŠ¨ React Europe - å»ºé€  Androidçš„ li.stä»¥ Expo å’Œ React Native å“ˆä½›å¤§å­¦CS50è¯¾ç¨‹ - å¾ˆå®¹æ˜“å°±èƒ½å»ºç«‹React Nativeåº”ç”¨ Apollo Day - GraphQL at Expo React React Express React è¯¾ç¨‹ Egghead.io - å‡ ä¸ªæ’­æ”¾åˆ—è¡¨ï¼ŒåŒ…æ‹¬Reactå’ŒReduxåŸºæœ¬åŸç†. å®˜æ–¹ React æ–‡æ¡£ JavaScript ES6 Katas - ä¸ºäº†è®©è‡ªå·±ç†Ÿæ‚‰æ–°JavaScriptç‰¹æ€§ï¼Œå¯ä»¥è®©è‡ªå·±ç†Ÿæ‚‰ä½¿ç”¨React Nativeçš„æ–°JavaScriptç‰¹æ€§","categories":[{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"React Native","slug":"React/React-Native","permalink":"https://jigangduan.github.io/categories/React/React-Native/"},{"name":"Expo","slug":"React/React-Native/Expo","permalink":"https://jigangduan.github.io/categories/React/React-Native/Expo/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"react-native","slug":"react-native","permalink":"https://jigangduan.github.io/tags/react-native/"},{"name":"expo","slug":"expo","permalink":"https://jigangduan.github.io/tags/expo/"}]},{"title":"çŒ«çš„JavaScript","slug":"jsforcats","date":"2018-02-06T04:24:23.000Z","updated":"2020-07-25T02:57:18.210Z","comments":true,"path":"2018/02/06/jsforcats/","link":"","permalink":"https://jigangduan.github.io/2018/02/06/jsforcats/","excerpt":"æ–°ç¨‹åºå‘˜ç®€ä»‹ä½ çš„äººç±»ä¼™ä¼´ä¹Ÿå¯ä»¥è½»æ˜“çš„åšåˆ°ï¼ JavaScriptæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæˆ–è€…ï¼Œæ¢å¥è¯è¯´ï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºè¢«æŒ‡ä»¤å»åšäº‹æƒ…çš„æ–¹å¼ã€‚å°±åƒä¸€ä¸ªäººç”¨â€œå£å“¨â€å’Œâ€œçŒ«å«â€æ§åˆ¶äººç±»ä¸€æ ·ï¼Œä¸€ä¸ªäººæ§åˆ¶ç€ç”¨ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„è¯­å¥ã€‚æ‰€æœ‰çš„webæµè§ˆå™¨éƒ½èƒ½ç†è§£JavaScriptï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¥è®©webé¡µé¢åšä¸€äº›ç–¯ç‹‚çš„äº‹æƒ…ï¼ JavaScriptæ˜¯ä¸€ç§ä½¿webé¡µé¢æ›´å…·äº¤äº’æ€§çš„æ–¹æ³•ã€‚å¦‚ä»Šï¼ŒJavaScriptåœ¨å¾ˆå¤šåœ°æ–¹è¿è¡Œï¼Œè€Œä¸ä»…ä»…æ˜¯webæµè§ˆå™¨â€”â€”å®ƒè¿è¡Œåœ¨webæœåŠ¡å™¨ã€æ‰‹æœºç”šè‡³æ˜¯æœºå™¨äººä¸Šã€‚è¿™ç¯‡æ–‡ç« å°†ä¼šæ•™ä½ ä¸€äº›JavaScriptåŸºç¡€çŸ¥è¯†ï¼Œè¿™æ ·ä½ å°±å¯ä»¥éšæ—¶å¯åŠ¨å’Œè¿è¡Œã€‚ å®é™…æ—¶é—´:æ²¡æœ‰çš„å¾ˆå¤šã€‚å¤§æ¦‚ä¸€ä¸¤ä¸ªå°æ—¶å§ã€‚å› ä¸ºä½ æ˜¯ä¸€åªçŒ«ä½ ä¸å¤ªå¯èƒ½è·‘ï¼Œæ›´æœ‰å¯èƒ½åœ¨å¤ªé˜³ä¸‹èººç€","text":"æ–°ç¨‹åºå‘˜ç®€ä»‹ä½ çš„äººç±»ä¼™ä¼´ä¹Ÿå¯ä»¥è½»æ˜“çš„åšåˆ°ï¼ JavaScriptæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæˆ–è€…ï¼Œæ¢å¥è¯è¯´ï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºè¢«æŒ‡ä»¤å»åšäº‹æƒ…çš„æ–¹å¼ã€‚å°±åƒä¸€ä¸ªäººç”¨â€œå£å“¨â€å’Œâ€œçŒ«å«â€æ§åˆ¶äººç±»ä¸€æ ·ï¼Œä¸€ä¸ªäººæ§åˆ¶ç€ç”¨ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„è¯­å¥ã€‚æ‰€æœ‰çš„webæµè§ˆå™¨éƒ½èƒ½ç†è§£JavaScriptï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¥è®©webé¡µé¢åšä¸€äº›ç–¯ç‹‚çš„äº‹æƒ…ï¼ JavaScriptæ˜¯ä¸€ç§ä½¿webé¡µé¢æ›´å…·äº¤äº’æ€§çš„æ–¹æ³•ã€‚å¦‚ä»Šï¼ŒJavaScriptåœ¨å¾ˆå¤šåœ°æ–¹è¿è¡Œï¼Œè€Œä¸ä»…ä»…æ˜¯webæµè§ˆå™¨â€”â€”å®ƒè¿è¡Œåœ¨webæœåŠ¡å™¨ã€æ‰‹æœºç”šè‡³æ˜¯æœºå™¨äººä¸Šã€‚è¿™ç¯‡æ–‡ç« å°†ä¼šæ•™ä½ ä¸€äº›JavaScriptåŸºç¡€çŸ¥è¯†ï¼Œè¿™æ ·ä½ å°±å¯ä»¥éšæ—¶å¯åŠ¨å’Œè¿è¡Œã€‚ å®é™…æ—¶é—´:æ²¡æœ‰çš„å¾ˆå¤šã€‚å¤§æ¦‚ä¸€ä¸¤ä¸ªå°æ—¶å§ã€‚å› ä¸ºä½ æ˜¯ä¸€åªçŒ«ä½ ä¸å¤ªå¯èƒ½è·‘ï¼Œæ›´æœ‰å¯èƒ½åœ¨å¤ªé˜³ä¸‹èººç€ ä¸è¦åšä¸€åªèƒ†å°çš„çŒ«å³ä½¿æ˜¯ç¼–ç¨‹ï¼Œä½ ä¹Ÿä¼šæ°¸è¿œåœ°ç«™åœ¨ä½ çš„è„šä¸Šã€‚ä¸åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„ä¸€æ¯æ°´ä¸åŒï¼Œè¿™äº›æ•™ç¨‹ä¸­çš„ä»»ä½•ä¸œè¥¿éƒ½ä¸ä¼šå¯¹ä½ çš„ç”µè„‘é€ æˆä»»ä½•æŸå®³ï¼Œå³ä½¿ä½ é”®å…¥å‘½ä»¤æˆ–è€…ç‚¹å‡»é”™è¯¯çš„æŒ‰é’®ã€‚åƒçŒ«ä¸€æ ·ï¼Œè®¡ç®—æœºç¨‹åºå‘˜æ€»æ˜¯çŠ¯é”™è¯¯:æ‹¼å†™é”™è¯¯ï¼Œå¿˜è®°å¼•å·æˆ–æ‹¬å¼§ï¼Œå¿˜è®°åŸºæœ¬çš„åŠŸèƒ½(å’Œyarnï¼Œlasers)çš„å·¥ä½œã€‚ç¨‹åºå‘˜æ›´å…³å¿ƒçš„æ˜¯è®©å®ƒæœ€ç»ˆå·¥ä½œï¼Œè€Œä¸æ˜¯è®©å®ƒç¬¬ä¸€æ¬¡å·¥ä½œã€‚å­¦ä¹ çš„æœ€å¥½æ–¹æ³•å°±æ˜¯çŠ¯é”™è¯¯ï¼ æ‰€ä»¥ï¼Œä¸è¦æˆä¸ºä¸€åªèƒ†å°çš„çŒ«ï¼æœ€ç³Ÿç³•çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœæ‚¨é™·å…¥å›°å¢ƒï¼Œæ‚¨å¯èƒ½ä¸å¾—ä¸åœ¨webæµè§ˆå™¨ä¸­åˆ·æ–°è¿™ä¸€é¡µé¢ã€‚ä¸è¿‡ï¼Œä¸è¦æ‹…å¿ƒï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘å‘ç”Ÿã€‚ åŸºç¡€çŸ¥è¯†ç°åœ¨è¿™ä¸ªé¡µé¢ä¸Šæœ‰JavaScriptè¿è¡Œã€‚è®©æˆ‘ä»¬ç¨å¾®ç©ä¸€ä¸‹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘å‡è®¾æ‚¨ä½¿ç”¨Google Chromeæ¥é˜…è¯»è¿™ä¸€é¡µ(å¦‚æœæ‚¨ä¸ä½¿ç”¨Chromeçš„è¯ï¼Œè¿™å¯¹æˆ‘ä»¬ä¸¤ä¸ªäººæ¥è¯´å¯èƒ½æ›´å®¹æ˜“äº›)ã€‚ é¦–å…ˆï¼Œå³é”®å•å‡»å±å¹•ä¸Šçš„ä»»ä½•åœ°æ–¹ï¼Œç„¶åå•å‡»æ£€æŸ¥å…ƒç´ ï¼Œç„¶åå•å‡»æ§åˆ¶å°é€‰é¡¹å¡ã€‚ä½ åº”è¯¥çœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿: è¿™æ˜¯ä¸€ä¸ªæ§åˆ¶å°ï¼Œä¹Ÿç§°ä¸ºâ€œå‘½ä»¤è¡Œâ€æˆ–â€œç»ˆç«¯â€ã€‚åŸºæœ¬ä¸Šï¼Œè¿™æ˜¯ä¸€ç§å°†ä¸€ä»¶äº‹ä¸€ä»¶ä¸€ä»¶åœ°è¾“å…¥åˆ°ç”µè„‘é‡Œçš„æ–¹æ³•ï¼Œç„¶åç«‹å³è®©ç”µè„‘å›å¤ã€‚å®ƒä»¬ä½œä¸ºä¸€ç§å­¦ä¹ å·¥å…·éå¸¸æœ‰ç”¨(æˆ‘å‡ ä¹æ¯å¤©éƒ½åœ¨ä½¿ç”¨æ§åˆ¶å°)ã€‚ æ§åˆ¶å°æœ‰ä¸€äº›å¾ˆé…·çš„ä¸œè¥¿ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å¼€å§‹è¾“å…¥ä¸€äº›ä¸œè¥¿ï¼Œæ§åˆ¶å°æ­£åœ¨å¸®åŠ©æˆ‘ï¼Œç»™æˆ‘ä¸€ä¸ªåˆ—è¡¨ï¼Œè®©æˆ‘å¯ä»¥ç»§ç»­è¾“å…¥æ‰€æœ‰å¯èƒ½çš„ä¸œè¥¿ï¼å¦ä¸€ä»¶ä½ å¯ä»¥åšçš„äº‹æƒ…æ˜¯åœ¨æ§åˆ¶å°ä¸­è¾“å…¥1+1ï¼Œç„¶åç‚¹å‡»Enteré”®ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ ä½¿ç”¨æ§åˆ¶å°æ˜¯å­¦ä¹ JavaScriptçš„ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†ã€‚å¦‚æœä½ ä¸çŸ¥é“æŸä»¶äº‹æ˜¯å¦æœ‰æ•ˆï¼Œæˆ–è€…ä½ çš„å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Œé‚£å°±å»æ§åˆ¶å°ï¼ŒæŠŠå®ƒå¼„æ¸…æ¥šï¼è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­: Stringså› ä¸ºæˆ‘æ˜¯ä¸€åªçŒ«ï¼Œæ‰€ä»¥æˆ‘æƒ³ç”¨é‚£äº›è¯¥æ­»çš„ç‹—,æŠŠç‹—ç‹—çš„æ¯ä¸€ä¸ªå•è¯éƒ½æ›¿æ¢æ‰ã€‚é¦–å…ˆè¿›å…¥ä½ çš„æ§åˆ¶å°ï¼Œè¾“å…¥å‡ å¥åŒ…å«ç‹—è‡³å°‘ä¸€æ¬¡çš„å¥å­ã€‚åœ¨JavaScriptä¸­ï¼Œä¸€ä¸²å­—æ¯ã€æ•°å­—ã€å•è¯æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿éƒ½è¢«ç§°ä¸ºå­—ç¬¦ä¸²(å¦‚å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä¸²)ã€‚å­—ç¬¦ä¸²å¿…é¡»ä»¥å¼•å·å¼€å§‹å’Œç»“æŸã€‚å•&#39;æˆ–åŒ&quot;ï¼Œåªæ˜¯ç¡®ä¿ä½ åœ¨å¼€å§‹æ—¶ä½¿ç”¨çš„æ˜¯ä¸€æ ·çš„ã€‚ çœ‹åˆ°ä»¤äººè®¨åŒçš„é”™è¯¯æ¶ˆæ¯äº†å—?åˆ«æ‹…å¿ƒï¼Œä½ æ²¡æœ‰è¿åä»»ä½•æ³•å¾‹ã€‚å½“æœºå™¨äººå‘Šè¯‰ä½ ä½ çš„ç¨‹åºæœ‰é—®é¢˜æ—¶ï¼ŒåŒæ­¥é”™è¯¯å°±æ˜¯å®ƒå¬èµ·æ¥çš„æ ·å­ã€‚å¤´ä¸¤ä¸ªå¥å­åœ¨å¼€å¤´å’Œç»“å°¾éƒ½æœ‰åŒ¹é…çš„å¼•å·ï¼Œä½†æ˜¯å½“æˆ‘æŠŠå•å¼•å·å’ŒåŒå¼•å·æ··åˆåœ¨ä¸€èµ·æ—¶ï¼Œæˆ‘å°±æ„Ÿåˆ°å®³æ€•äº† å¥½ï¼Œä¸ºäº†ä¿®å¤å…¶ä¸­çš„ä¸€ä¸ªå¥å­(ç”¨æˆ‘ä»¬çš„å¢å¼ºç‰ˆæœ¬æ›¿æ¢dog)ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆä¿å­˜åŸæ¥çš„å¥å­ï¼Œè¿™æ ·å½“æˆ‘ä»¬æ›¿æ¢é­”æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå«èµ·æ¥ã€‚æ³¨æ„ï¼Œå½“æˆ‘ä»¬å°†å­—ç¬¦ä¸²è¾“å…¥åˆ°æ§åˆ¶å°æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²æ˜¯å¦‚ä½•ä»¥çº¢è‰²é‡å¤çš„?è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å‘Šè¯‰å®ƒè¦åœ¨ä»»ä½•åœ°æ–¹ä¿å­˜è¿™ä¸ªå¥å­ï¼Œæ‰€ä»¥å®ƒæ‰ä¼šè¿”å›(æˆ–è€…å¦‚æœæˆ‘ä»¬æŠŠäº‹æƒ…æç ¸äº†ï¼Œå®ƒä¼šç»™æˆ‘ä»¬ä¸€ä¸ªé”™è¯¯)ã€‚ å€¼å’Œå˜é‡å€¼æ˜¯JavaScriptä¸­æœ€ç®€å•çš„ç»„ä»¶ã€‚1æ˜¯ä¸€ä¸ªå€¼ï¼Œtrueæ˜¯ä¸€ä¸ªå€¼ï¼Œâ€helloâ€æ˜¯ä¸€ä¸ªå€¼ï¼Œfunction() {}æ˜¯ä¸€ä¸ªå€¼ï¼Œlistä¼šç»§ç»­ä¸‹å»ï¼JavaScriptä¸­æœ‰å‡ ç§ä¸åŒç±»å‹çš„å€¼ï¼Œä½†æˆ‘ä»¬ä¸éœ€è¦é©¬ä¸Šå¤„ç†å®ƒä»¬â€”â€”æ‚¨å°†ä¼šè‡ªç„¶åœ°äº†è§£åˆ°å®ƒä»¬çš„ä»£ç ï¼ ä¸ºäº†å­˜å‚¨å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨å˜é‡ã€‚â€œå˜é‡â€è¿™ä¸ªè¯çš„æ„æ€æ˜¯â€œå¯ä»¥æ”¹å˜â€ï¼Œå› ä¸ºå˜é‡å¯ä»¥å­˜å‚¨è®¸å¤šä¸åŒç±»å‹çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥å¤šæ¬¡æ›´æ”¹å®ƒä»¬çš„å€¼ã€‚å®ƒä»¬å¾ˆåƒé‚®ç®±ã€‚æˆ‘ä»¬æŠŠä¸€äº›ä¸œè¥¿æ”¾åœ¨ä¸€ä¸ªå˜é‡é‡Œï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å¥å­ï¼Œç„¶åç»™è¿™ä¸ªå˜é‡ä¸€ä¸ªåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æŸ¥æ‰¾è¿™ä¸ªå¥å­ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œé‚®ç®±å¿…é¡»æœ‰PO Boxå·ç ï¼Œä½†åœ¨JavaScriptä¸­ï¼Œé€šå¸¸åªä½¿ç”¨å°å†™å­—æ¯æˆ–æ•°å­—ï¼Œè€Œä¸éœ€è¦ä»»ä½•ç©ºæ ¼ã€‚ varæ˜¯å˜é‡çš„ç®€å†™ï¼Œè€Œç­‰å·çš„æ„æ€æ˜¯æŠŠå³è¾¹çš„ä¸œè¥¿æ”¾åœ¨å·¦è¾¹çš„ä¸œè¥¿ä¸Šã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ—¢ç„¶æˆ‘ä»¬å°†å¥å­å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œæ§åˆ¶å°ä¸ä¼šç«‹å³è¿”å›æˆ‘ä»¬çš„å¥å­ï¼Œè€Œæ˜¯ç»™æˆ‘ä»¬æœªå®šä¹‰çš„æ„æ€ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥è¿”å›ã€‚ å¦‚æœæ‚¨ç®€å•åœ°å°†ä¸€ä¸ªå˜é‡åè¾“å…¥åˆ°æ§åˆ¶å°ï¼Œå®ƒå°†è¾“å‡ºè¯¥å˜é‡ä¸­å­˜å‚¨çš„å€¼ã€‚å…³äºå˜é‡çš„ä¸€ä¸ªæ³¨é‡Šæ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“åˆ‡æ¢åˆ°å¦ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå®ƒä»¬ä¼šæ¶ˆå¤±ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘åœ¨Chromeä¸­ç‚¹å‡»RefreshæŒ‰é’®ï¼Œæˆ‘çš„dogSentenceå˜é‡å°±ä¼šè¢«æŠ¹å»ï¼Œå°±åƒå®ƒä»æ¥æ²¡æœ‰å­˜åœ¨è¿‡ä¸€æ ·ã€‚ä½†ç°åœ¨ä¸è¦å¤ªæ‹…å¿ƒè¿™ä¸€ç‚¹â€”â€”ä½ å¯ä»¥åœ¨é”®ç›˜ä¸Šæ•²å‡»é”®ç›˜ä¸Šçš„ä¸Šæˆ–ä¸‹ç®­å¤´ï¼Œæ¥å®Œæˆä½ æœ€è¿‘è¾“å…¥çš„æ‰€æœ‰ä¸œè¥¿ã€‚ å‡½æ•°æ—¢ç„¶æˆ‘ä»¬å·²ç»å°†è¯­å¥å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ›´æ”¹ä¸€ä¸ªå­˜å‚¨åœ¨å…¶ä¸­çš„å•è¯ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œä¸€ä¸ªå‡½æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å‡½æ•°æ˜¯ä¸€ç§ç±»å‹çš„å€¼ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½(ä¹Ÿå°±æ˜¯ç›®çš„æˆ–è¡Œä¸º)ã€‚æˆ‘è®¤ä¸ºï¼ŒæŠŠå®ƒä»¬ç§°ä¸ºâ€œè¡ŒåŠ¨â€å¬èµ·æ¥å¾ˆå¥‡æ€ªï¼Œæ‰€ä»¥ä»–ä»¬ç”¨â€œå‡½æ•°â€ä¸€è¯æ¥ä»£æ›¿ã€‚ JavaScriptæœ‰ä¸€ä¸ªåä¸ºreplaceçš„å‡½æ•°ï¼Œå®ƒå®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼å‡½æ•°åœ¨æ‹¬å·ä¸­(0ã€1æˆ–å¤šä¸ª)ä¸­æ¥å—ä»»æ„æ•°é‡çš„å€¼ï¼Œå¹¶è¿”å›ä»»ä½•å€¼(æœªå®šä¹‰çš„)æˆ–æ›´æ”¹çš„å­—ç¬¦ä¸²ã€‚æ›¿æ¢å‡½æ•°å¯ç”¨äºä»»ä½•å­—ç¬¦ä¸²ï¼Œå¹¶å…·æœ‰ä¸¤ä¸ªå€¼:è¦å–å‡ºçš„å­—ç¬¦å’Œè¦äº¤æ¢çš„å­—ç¬¦ã€‚æè¿°è¿™äº›ä¸œè¥¿ä¼šè®©ä½ æ„Ÿåˆ°å›°æƒ‘æ‰€ä»¥è¿™é‡Œæ˜¯ä¸€ä¸ªè§†è§‰ä¸Šçš„ä¾‹å­: è¯·æ³¨æ„ï¼Œå³ä½¿åœ¨æˆ‘ä»¬è¿è¡Œæ›¿æ¢ä¹‹åï¼Œå®ƒçš„å€¼æ˜¯ä¸€æ ·çš„å—?è¿™æ˜¯å› ä¸ºreplaceå‡½æ•°(ä»¥åŠå¤§å¤šæ•°JavaScriptå‡½æ•°)æ¥å—æˆ‘ä»¬èµ‹äºˆå®ƒçš„å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å€¼ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä¼ å…¥çš„å€¼ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å­˜å‚¨ç»“æœ(åœ¨æ›¿æ¢å‡½æ•°çš„å·¦è¾¹æ²¡æœ‰=)ï¼Œå®ƒåªæ˜¯åœ¨æˆ‘ä»¬çš„æ§åˆ¶å°ä¸­æ‰“å°äº†è¿”å›å€¼ã€‚ æ ‡å‡†åº“æ‚¨å¯èƒ½æƒ³çŸ¥é“åœ¨JavaScriptä¸­è¿˜æœ‰å“ªäº›å‡½æ•°å¯ç”¨ã€‚ç­”æ¡ˆ:ä¸€å¨ã€‚åœ¨MDN(ä¸€ä¸ªç”±Mozillaè¿è¡Œçš„ç«™ç‚¹æ‹¥æœ‰è®¸å¤šå…³äºwebæŠ€æœ¯çš„æ¼‚äº®ä¿¡æ¯)ï¼Œæ‚¨å¯ä»¥åœ¨MDNä¸­äº†è§£åˆ°è®¸å¤š æ„å»ºçš„æ ‡å‡†åº“ ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯å…³äºJavaScriptçš„æ•°å­¦å¯¹è±¡çš„MDNé¡µé¢ã€‚ ç¬¬ä¸‰æ–¹JavaScriptè¿˜æœ‰å¾ˆå¤šJavaScriptä»£ç éƒ½ æ²¡æœ‰å†…ç½®ã€‚æ¥è‡ªç¬¬ä¸‰æ–¹çš„JavaScripté€šå¸¸è¢«ç§°ä¸ºâ€œåº“â€æˆ–â€œæ’ä»¶â€ã€‚æˆ‘æœ€å–œæ¬¢çš„ä¸€ä¸ªå«åš Underscore.js ã€‚è®©æˆ‘ä»¬å»æŠ“å–å®ƒå¹¶è½½å…¥åˆ°æˆ‘ä»¬çš„é¡µé¢ï¼ç¬¬ä¸€æ¬¡å»Underscoreç½‘ç«™,http://underscorejs.org/,ç‚¹å‡»ä¸‹è½½é“¾æ¥(æˆ‘é€šå¸¸ä½¿ç”¨å¼€å‘ç‰ˆæœ¬,å› ä¸ºä»–ä»¬æ›´å®¹æ˜“è¯»ä½†éƒ½å°†ç»™ä½ ç›¸åŒçš„åŸºæœ¬åŠŸèƒ½),ç„¶åå¤åˆ¶åˆ°æ‚¨çš„å‰ªè´´æ¿çš„æ‰€æœ‰ä»£ç (ä½ å¯ä»¥ä½¿ç”¨ä»ç¼–è¾‘èœå•ä¸­é€‰æ‹©æ‰€æœ‰é€‰æ‹©çš„ä¸€åˆ‡)ã€‚ç„¶åæŠŠå®ƒç²˜è´´åˆ°ä½ çš„æ§åˆ¶å°ï¼Œç‚¹å‡»å›è½¦ã€‚ç°åœ¨ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸­æœ‰ä¸€ä¸ªæ–°çš„å˜é‡:_ã€‚Underscoreç»™ä½ æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚ç¨åæˆ‘ä»¬å°†å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„çŸ¥è¯†ã€‚ åˆ¶ä½œæ–°å‡½æ•°ä½ å¹¶ä¸å±€é™äºä½¿ç”¨ä»–äººçš„å‡½æ•°â€”â€”ä½ ä¹Ÿå¯ä»¥è‡ªå·±å†™ã€‚è¿™å¾ˆç®€å•!è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºmakeMoreExcitingçš„å‡½æ•°ï¼Œå®ƒåœ¨å­—ç¬¦ä¸²çš„æœ«å°¾æ·»åŠ äº†ä¸€äº›æ„Ÿå¹å·ã€‚ 123function makeMoreExciting(string) &#123; return string + '!!!!'&#125; åœ¨æˆ‘çš„è„‘æµ·é‡Œï¼Œæˆ‘è¿™æ ·å¤§å£°åœ°è¯»å‡ºæ¥:â€œæœ‰ä¸€ä¸ªå‡½æ•°å«åš make more excitingï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²çš„æœ«å°¾æœ‰å¾ˆå¤šæ„Ÿå¹å·ã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å°†å¦‚ä½•åœ¨æ§åˆ¶å°ä¸­æ‰‹åŠ¨å†™å…¥ã€‚ è¡¨è¾¾å¼string + &#39;!!!!&#39;è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬çš„å˜é‡åä¸ºstringçš„å˜é‡ä¿æŒä¸å˜(å› ä¸ºæˆ‘ä»¬ä»æœªå°†å®ƒæ›´æ–°ä¸º=)ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨æ“ä½œã€‚é¦–å…ˆï¼Œå°†è¯¥å‡½æ•°ç²˜è´´åˆ°æ§åˆ¶å°ï¼Œç„¶åé€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²æ¥è°ƒç”¨å‡½æ•°: æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²çš„å˜é‡æ¥è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°(åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å°†å­—ç¬¦ä¸²ç›´æ¥è¾“å…¥ä¸ºä¸€ä¸ªå€¼ï¼Œè€Œä¸æ˜¯å…ˆå°†å…¶ä¿å­˜åˆ°ä¸€ä¸ªå˜é‡ä¸­): MakeMoreExciting (sentence)çš„ç›¸å½“äºsentence + â€˜!!!!â€™ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹in-place(æ›´æ–°)sentenceçš„å€¼å‘¢?ç®€å•åœ°å°†å‡½æ•°çš„è¿”å›å€¼ä¿å­˜å›æˆ‘ä»¬çš„sentenceå˜é‡: 12var sentence = \"time for a nap\"sentence = makeMoreExciting(sentence) ç°åœ¨sentenceé‡Œæœ‰äº†æ„Ÿå¹å·ï¼æ³¨æ„ï¼Œå½“æ‚¨åˆå§‹åŒ–ä¸€ä¸ªå˜é‡æ—¶ï¼Œæ‚¨åªéœ€è¦ä½¿ç”¨varï¼Œè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒã€‚åœ¨æ­¤ä¹‹åï¼Œæ‚¨ä¸åº”è¯¥ä½¿ç”¨varï¼Œé™¤éæ‚¨æƒ³è¦é‡æ–°åˆå§‹åŒ–(é‡æ–°è®¾ç½®/æ¸…é™¤/æ¸…ç©º)å˜é‡ã€‚ å¦‚æœæˆ‘ä»¬åœ¨å‡½æ•°ä¸­å–å‡ºreturn statementä¼šå‘ç”Ÿä»€ä¹ˆ? ä¸ºä»€ä¹ˆsentenceæ˜¯ç©ºçš„å—?å› ä¸ºå‡½æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹è¿”å›undefinedï¼æ‚¨å¯ä»¥é€šè¿‡è¿”å›æŸä¸ªå€¼æ¥è¿”å›ä¸€ä¸ªå€¼ã€‚å‡½æ•°åº”è¯¥å…·æœ‰ä¸€ä¸ªå€¼ï¼Œå¦‚æœå®ƒä»¬æ”¹å˜äº†å€¼æˆ–è€…åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å€¼ï¼Œè¿™ä¸ªå€¼åº”è¯¥åœ¨ä»¥åè¢«ä½¿ç”¨ï¼Œè¿”å›ä¸€ä¸ªå€¼(æœ‰è¶£çš„äº‹å®:è¿™ä¸ªæ ·å¼çš„ä¸€ä¸ªå¥‡ç‰¹çš„æœ¯è¯­æ˜¯å‡½æ•°å¼ç¼–ç¨‹)ã€‚è¿™æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œè€Œæ˜¯ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•æ¥æ˜¾ç¤ºè¾“å‡º: 12345function yellIt(string) &#123; string = string.toUpperCase() string = makeMoreExciting(string) console.log(string)&#125; è¿™ä¸ªå‡½æ•°ï¼ŒyellItï¼Œä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„å‡½æ•°makeMoreExcitingï¼Œä»¥åŠå†…ç½®çš„å­—ç¬¦ä¸²æ–¹æ³•toUpperCaseã€‚æ–¹æ³•åªæ˜¯ä¸€ä¸ªå‡½æ•°çš„åå­—ï¼Œå½“å®ƒå±äºæŸä¸ªä¸œè¥¿çš„æ—¶å€™â€”â€”åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒtoUpperCaseæ˜¯ä¸€ä¸ªå±äºå­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç§°ä¸ºä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªå‡½æ•°ã€‚å¦ä¸€æ–¹é¢ï¼ŒmakeMoreExcitingä¸å±äºä»»ä½•äººï¼Œå› æ­¤å°†å…¶ç§°ä¸ºä¸€ç§æ–¹æ³•æ˜¯ä¸æ­£ç¡®çš„(æˆ‘çŸ¥é“è¿™æ˜¯ä¸€ç§æ··æ·†)ã€‚ è¯¥å‡½æ•°çš„æœ€åä¸€è¡Œæ˜¯å¦ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œå®ƒåªæ¥å—æ‚¨æä¾›çš„ä»»ä½•å€¼ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å° é‚£ä¹ˆä¸Šé¢çš„yellItå‡½æ•°æœ‰ä»€ä¹ˆé—®é¢˜å—?è§†æƒ…å†µè€Œå®š!ä»¥ä¸‹æ˜¯ä¸¤ç§ä¸»è¦çš„åŠŸèƒ½: ä¿®æ”¹æˆ–åˆ›å»ºå€¼å¹¶è¿”å›å®ƒä»¬çš„å‡½æ•° å‡½æ•°æ¥å—å€¼å¹¶æ‰§è¡Œä¸€äº›æ— æ³•è¿”å›çš„æ“ä½œ console.logæ˜¯ç¬¬äºŒç§åŠŸèƒ½çš„ä¾‹å­:å®ƒæŠŠä¸œè¥¿æ‰“å°åˆ°ä½ çš„æ§åˆ¶å°â€”â€”ä½ å¯ä»¥ç”¨çœ¼ç›çœ‹åˆ°çš„åŠ¨ä½œï¼Œä½†è¿™ä¸èƒ½ç”¨JavaScriptçš„å€¼æ¥è¡¨ç¤ºã€‚æˆ‘è‡ªå·±çš„ç»éªŒæ³•åˆ™æ˜¯ï¼ŒæŠŠè¿™ä¸¤ç§å‡½æ•°åˆ†å¼€ï¼Œè¿™æ˜¯æˆ‘é‡å†™yellItå‡½æ•°çš„æ–¹å¼: 123456function yellIt(string) &#123; string = string.toUpperCase() return makeMoreExciting(string)&#125;console.log(yellIt(\"i fear no human\")) yellItå˜å¾—æ›´é€šç”¨ï¼Œè¿™æ„å‘³ç€å®ƒåªåšä¸€ä¸¤ä¸ªç®€å•çš„å°äº‹æƒ…ï¼Œä¸çŸ¥é“å¦‚ä½•å°†è‡ªå·±æ‰“å°åˆ°æ§åˆ¶å°â€”â€”åœ¨å‡½æ•°å®šä¹‰ä¹‹å¤–ï¼Œè¯¥éƒ¨åˆ†æ€»æ˜¯å¯ä»¥ç¼–ç¨‹çš„ã€‚ å¾ªç¯ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€äº›åŸºæœ¬çš„æŠ€èƒ½æˆ‘ä»¬å¯ä»¥å¼€å§‹å˜å¾—æ‡’æƒ°ã€‚ä»€ä¹ˆ? !æ˜¯çš„ï¼Œè¿™æ˜¯å¯¹çš„:ç¼–ç¨‹å°±æ˜¯æ‡’æƒ°ã€‚Perlç¼–ç¨‹è¯­è¨€çš„å‘æ˜è€…æ‹‰é‡Œæ²ƒå°”ç§°ï¼Œæ‡’æƒ°æ˜¯ä¼˜ç§€ç¨‹åºå‘˜æœ€é‡è¦çš„ç¾å¾·ã€‚å¦‚æœç”µè„‘ä¸å­˜åœ¨ï¼Œä½ å°†ä¸å¾—ä¸æ‰‹å·¥åšå„ç§ç¹ççš„å·¥ä½œï¼Œä½†å¦‚æœä½ å­¦ä¼šç¼–ç¨‹ï¼Œä½ å°±å¯ä»¥æ•´å¤©èººåœ¨å¤ªé˜³åº•ä¸‹ï¼Œè€Œç”µè„‘åˆ™å¯ä»¥ä¸ºä½ è¿è¡Œç¨‹åºã€‚è¿™æ˜¯ä¸€ç§å……æ»¡äº†æ”¾æ¾çš„å…‰è£çš„ç”Ÿæ´»æ–¹å¼ï¼ å¾ªç¯æ˜¯åˆ©ç”¨è®¡ç®—æœºçš„åŠ›é‡çš„æœ€é‡è¦çš„æ–¹æ³•ä¹‹ä¸€ã€‚è¿˜è®°å¾—æ—©äº›æ—¶å€™Underscore.jså—?ç¡®ä¿ä½ åœ¨é¡µé¢ä¸ŠåŠ è½½äº†å®ƒ(è®°ä½:ä½ å¯ä»¥åœ¨ä½ çš„é”®ç›˜ä¸Šæ•²ä¸Šå‡ ä¸‹ç®­å¤´ï¼Œç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼Œå¦‚æœä½ éœ€è¦çš„è¯)ï¼Œç„¶ååœ¨ä½ çš„æ§åˆ¶å°ä¸­å¤åˆ¶/ç²˜è´´è¿™ä¸ªã€‚ 1234function logANumber(someNumber) &#123; console.log(someNumber)&#125;_.times(10, logANumber) è¿™æ®µä»£ç ä½¿ç”¨çš„æ˜¯Underscoreçš„timesæ–¹æ³•ï¼Œå®ƒåŒ…å«1ä¸ªæ•°å­—å’Œ1ä¸ªå‡½æ•°ï¼Œç„¶åä»0å¼€å§‹ï¼Œ10ä¸ªæ­¥éª¤æ˜¯1ï¼Œç”¨æ¯ä¸ªæ­¥éª¤çš„æ•°å­—æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ å¦‚æœæˆ‘ä»¬è¦æ‰‹åŠ¨å†™å‡ºä¸Šé¢çš„ä»£ç ï¼Œå®ƒä¼šæ˜¯è¿™æ ·çš„: 12345678910logANumber(0)logANumber(1)logANumber(2)logANumber(3)logANumber(4)logANumber(5)logANumber(6)logANumber(7)logANumber(8)logANumber(9) ä½†æ˜¯çŒ«æ‹’ç»åšè¿™æ ·çš„ä¸å¿…è¦çš„æ‰‹å·¥å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ€»æ˜¯é—®è‡ªå·±:â€œæˆ‘æ˜¯ä¸æ˜¯ç”¨æœ€æ‡’çš„æ–¹å¼åšè¿™ä»¶äº‹?â€ é‚£ä¹ˆä¸ºä»€ä¹ˆè¿™ä¸ªå«åšå¾ªç¯å‘¢?å¯ä»¥è¿™æ ·æƒ³:å¦‚æœæˆ‘ä»¬è¦ç”¨JavaScriptæ•°ç»„å†™å‡º10ä¸ªæ•°å­—(ä»0åˆ°9)ï¼Œå®ƒä¼šæ˜¯è¿™æ ·çš„: 1var zeroThroughTen = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] çœŸæ­£çš„timesæ˜¯è®¿é—®æ¯ä¸ªæ•°å­—å¹¶é‡å¤ä¸€ä¸ªä»»åŠ¡:åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä»»åŠ¡æ˜¯ç”¨å½“å‰çš„æ•°å­—è°ƒç”¨logANumberå‡½æ•°ã€‚ä»¥è¿™ç§æ–¹å¼é‡å¤ä»»åŠ¡è¢«ç§°ä¸ºå¾ªç¯éå†æ•°ç»„ã€‚ Arraysæˆ‘å·²ç»æè¿‡å‡ æ¬¡äº†ï¼Œä½†è®©æˆ‘ä»¬èŠ±ä¸€åˆ†é’Ÿæ—¶é—´æ¥äº†è§£å®ƒä»¬ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ éœ€è¦è·Ÿè¸ªæ‰€æœ‰çš„æœ‹å‹ã€‚å¥½å§ï¼Œæ•°ç»„ä¼šåšå¾—å¾ˆå¥½ã€‚æƒ³è±¡ä¸€ä¸ªæ•°ç»„ï¼Œå°±åƒä¸€ä¸ªæ’åºåˆ—è¡¨ï¼Œä½ å¯ä»¥ä¿å­˜å¤§é‡çš„ä¸œè¥¿ã€‚ è¿™å°±æ˜¯ä½ çš„åˆ¶ä½œæ–¹æ³•: 1var myCatFriends = [\"bill\", \"tabby\", \"ceiling\"] ç”œèœœçš„!ç°åœ¨ä½ æœ‰äº†ä¸€ä»½ä½ çš„çŒ«å‹çš„åå•ã€‚ å…ƒç´ (ä¹Ÿå°±æ˜¯æ•°ç»„ä¸­çš„å•ä¸€é¡¹)å­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œä»0å¼€å§‹ï¼Œä»é‚£é‡Œå¼€å§‹è®¡æ•°ã€‚myCatFriends[0]è¿”å›billå’ŒmyCatFriends[1]è¿”å›tabbyã€‚ç­‰ç­‰ã€‚ ä¸ºäº†è®©ä½ çš„å¥½å‹ç¦»å¼€ä½ çš„å…¨æ–°çš„æ•°ç»„ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®ä¸€ä¸ªå…ƒç´ : 1console.log(myCatFriends[0]) å¦‚æœä½ åœ¨å¦ä¸€ä¸ªæ™šä¸Šåœ¨æœ€æ—¶é«¦çš„çŒ«å’ªä¿±ä¹éƒ¨é‡Œåšäº†ä¸€ä¸ªå…¨æ–°çš„çŒ«å’ªæœ‹å‹ï¼Œä½ æƒ³æŠŠå®ƒä»¬åŠ åˆ°ä½ çš„åå•ä¸Šï¼Œé‚£å°±å¤ªç®€å•äº†:myCatFriends.push(&quot;super hip cat&quot;)ã€‚ ä¸ºäº†æ£€æŸ¥æ–°çŒ«æ˜¯å¦èƒ½è¿›å…¥ä½ çš„æ•°ç»„ï¼Œä½ å¯ä»¥ä½¿ç”¨.length: æ³¨æ„åˆ°pushæ˜¯å¦‚ä½•è¿”å›é•¿åº¦çš„?æ–¹ä¾¿çš„!è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°ç»„å°†å§‹ç»ˆä¿æŒé¡ºåºï¼Œè¿™æ„å‘³ç€å®ƒä»¬å°†è®°ä½æ‚¨æ·»åŠ æˆ–å®šä¹‰çš„é¡ºåºçš„é¡ºåºã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„JavaScriptéƒ½ä¿å­˜äº†æ’åºï¼Œæ‰€ä»¥è¦è®°ä½æ•°ç»„çš„ç‰¹æ®Šå±æ€§ï¼ Objectsæ•°ç»„å¯¹åˆ—è¡¨å¾ˆå¥½ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–ä»»åŠ¡ï¼Œå®ƒä»¬å¯èƒ½å¾ˆéš¾å¤„ç†ã€‚æƒ³æƒ³æˆ‘ä»¬çš„çŒ«æœ‹å‹åœˆå§ã€‚å¦‚æœæ‚¨è¿˜æƒ³å­˜å‚¨æ›´å¤šçš„åç§°ï¼Œåˆè¯¥å¦‚ä½•å‘¢? 123var myCatFriends = [\"bill\", \"tabby\", \"ceiling\"]var lastNames = [\"the cat\", \"cat\", \"cat\"]var addresses = [\"The Alley\", \"Grandmas House\", \"Attic\"] æœ‰æ—¶åœ¨ä¸€ä¸ªå˜é‡ä¸­åŒ…å«æ‰€æœ‰çš„åœ°å€æˆ–åç§°æ˜¯å¾ˆå¥½çš„ã€‚ä½†æœ‰æ—¶ä½ æœ‰ä¸€åªçŒ«ï¼Œè®©æˆ‘ä»¬è¯´billï¼Œä½ åªæ˜¯æƒ³æŸ¥ä¸€ä¸‹é‚£åªçŒ«çš„åœ°å€ã€‚ä½¿ç”¨æ•°ç»„éœ€è¦å¤§é‡çš„å·¥ä½œï¼Œå› ä¸ºä½ ä¸èƒ½åªè¯´â€œå—¨ï¼Œæ•°ç»„ï¼Œç»™æˆ‘Billçš„åœ°å€â€å› ä¸ºâ€œBillâ€åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä»–çš„åœ°å€æ˜¯å®Œå…¨ä¸åŒçš„æ•°ç»„ã€‚ è¿™å¯èƒ½æ˜¯å¾ˆè„†å¼±çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ”¹å˜äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨å¼€å§‹çš„æ—¶å€™æ·»åŠ äº†ä¸€ä¸ªæ–°çš„catï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»æ›´æ–°æˆ‘ä»¬çš„è´¦å•å˜é‡ï¼Œä»¥æŒ‡å‘åœ¨æ•°ç»„ä¸­æ–°çš„Billä¿¡æ¯çš„ä½ç½®ï¼è¿™é‡Œæœ‰ä¸€ä¸ªæ›´å®¹æ˜“ç»´æŠ¤çš„æ–¹å¼æ¥å­˜å‚¨è¿™æ ·çš„ä¿¡æ¯:ä½¿ç”¨å¯¹è±¡: 123var firstCat = &#123; name: \"bill\", lastName: \"the cat\", address: \"The Alley\" &#125;var secondCat = &#123; name: \"tabby\", lastName: \"cat\", address: \"Grandmas House\" &#125;var thirdCat = &#123; name: \"ceiling\", lastName: \"cat\", address: \"Attic\" &#125; æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢?å› ä¸ºç°åœ¨æˆ‘ä»¬ä¸ºæ¯åªçŒ«éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è®©çŒ«çš„å€¼æ›´æ–¹ä¾¿ã€æ›´å®¹æ˜“è¯»æ‡‚ã€‚ ä½ å¯ä»¥æŠŠé’¥åŒ™æ”¾åœ¨é’¥åŒ™åœˆä¸Šã€‚æ¯ä¸€ä¸ªéƒ½æ˜¯é’ˆå¯¹ç‰¹å®šçš„é—¨ï¼Œå¦‚æœä½ çš„é’¥åŒ™ä¸Šæœ‰æ¼‚äº®çš„æ ‡ç­¾ï¼Œä½ å°±èƒ½å¿«é€Ÿæ‰“å¼€é—¨ã€‚äº‹å®ä¸Šï¼Œå·¦è¾¹çš„ä¸œè¥¿è¢«ç§°ä¸ºé”®(ä¹Ÿç§°ä¸ºå±æ€§)ï¼Œå³è¾¹çš„ä¸œè¥¿æ˜¯å€¼ã€‚ ä½ å¯ä»¥æŠŠå¯¹è±¡æƒ³è±¡ä¸ºé’¥åŒ™ç¯ä¸Šçš„é’¥åŒ™ã€‚æ¯ä¸€ä¸ªéƒ½æ˜¯é’ˆå¯¹ç‰¹å®šçš„é—¨ï¼Œå¦‚æœä½ çš„é’¥åŒ™ä¸Šæœ‰æ¼‚äº®çš„æ ‡ç­¾ï¼Œä½ å°±èƒ½å¿«é€Ÿæ‰“å¼€é—¨ã€‚äº‹å®ä¸Šï¼Œå·¦è¾¹çš„ä¸œè¥¿è¢«ç§°ä¸ºé”®(ä¹Ÿç§°ä¸ºå±æ€§)ï¼Œå³è¾¹çš„ä¸œè¥¿æ˜¯å€¼ã€‚ 12// an object with a single key 'name' and single value 'bill'&#123; name: 'bill' &#125; å¦‚æœä½ èƒ½æŠŠæ•°æ®æ”¾åˆ°å¯¹è±¡ä¸­ï¼Œä½ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°ç»„å‘¢?å› ä¸ºå¯¹è±¡ä¸è®°å¾—ä½ è®¾ç½®çš„é”®çš„é¡ºåºï¼Œä½ å¯èƒ½ä¼šè¿›å…¥è¿™æ ·ä¸€ä¸ªå¯¹è±¡: 1&#123; date: \"10/20/2012\", diary: \"slept a bit today\", name: \"Charles\" &#125; ä½†æ˜¯ç”µè„‘å¯ä»¥æŠŠå®ƒè¿˜ç»™ä½ : 1&#123; diary: \"slept a bit today\", name: \"Charles\", date: \"10/20/2012\" &#125; è¿˜æ˜¯è¿™æ ·! 1&#123; name: \"Charles\", diary: \"slept a bit today\", date: \"10/20/2012\" &#125; æ‰€ä»¥ä½ ä¸èƒ½ç›¸ä¿¡å¯¹è±¡ä¸­é”®çš„é¡ºåºã€‚å¦‚æœä½ æƒ³è¦å˜å¾—éå¸¸æ¼‚äº®ï¼Œä½ å¯ä»¥åšä¸€ä¸ªå……æ»¡äº†å¯¹è±¡çš„æ•°ç»„ï¼Œæˆ–è€…ä¸€ä¸ªå……æ»¡æ•°ç»„çš„å¯¹è±¡ï¼ 1234567891011121314151617181920var moodLog = [ &#123; date: \"10/20/2012\", mood: \"catnipped\" &#125;, &#123; date: \"10/21/2012\", mood: \"nonplussed\" &#125;, &#123; date: \"10/22/2012\", mood: \"purring\" &#125;]// ordered from least to most favoritevar favorites = &#123; treats: [\"bird sighting\", \"belly rub\", \"catnip\"], napSpots: [\"couch\", \"planter box\", \"human face\"]&#125; å½“ä½ æŠŠä¸åŒçš„ä¸œè¥¿ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œä½ å°±åœ¨åˆ¶é€ æ•°æ®ç»“æ„ä½“ï¼Œå°±åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼ CallbacksCallbackså¹¶ä¸æ˜¯JavaScriptåƒå¯¹è±¡æˆ–æ•°ç»„é‚£æ ·çš„ç‰¹æ€§ï¼Œè€Œæ˜¯ä½¿ç”¨å‡½æ•°çš„ä¸€ç§ç‰¹å®šæ–¹å¼ã€‚è¦ç†è§£Callbacksä¸ºä»€ä¹ˆæ˜¯æœ‰ç”¨çš„ï¼Œæ‚¨é¦–å…ˆå¿…é¡»äº†è§£å¼‚æ­¥(é€šå¸¸ç®€ç§°ä¸ºå¼‚æ­¥)ç¼–ç¨‹ã€‚æ ¹æ®å®šä¹‰ï¼Œå¼‚æ­¥ä»£ç æ˜¯ä»¥ä¸€ç§éåŒæ­¥çš„æ–¹å¼ç¼–å†™çš„ã€‚åŒæ­¥ä»£ç æ˜“äºç†è§£å’Œç¼–å†™ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜: 12var photo = download('http://foo-chan.com/images/sp.jpg')uploadPhotoTweet(photo, '@maxogden') è¿™æ®µåŒæ­¥çš„ä¼ªä»£ç ä¸‹è½½äº†ä¸€å¼ å¯çˆ±çš„çŒ«ç…§ç‰‡ï¼Œç„¶åå°†ç…§ç‰‡ä¸Šä¼ åˆ°twitterï¼Œå¹¶åœ¨@maxogdenä¸Šæ¨æ–‡ã€‚å¾ˆç®€å•çš„! è¿™æ®µä»£ç æ˜¯åŒæ­¥çš„ï¼Œå› ä¸ºä¸ºäº†å°†ç…§ç‰‡ä¸Šä¼ è‡³æ¨æ–‡ï¼Œç…§ç‰‡ä¸‹è½½å¿…é¡»å®Œæˆã€‚è¿™æ„å‘³ç€ç¬¬2è¡Œä¸èƒ½è¿è¡Œï¼Œç›´åˆ°ç¬¬1è¡Œä¸­çš„ä»»åŠ¡å®Œå…¨å®Œæˆã€‚å¦‚æœæˆ‘ä»¬è¦å®ç°è¿™ä¸ªä¼ªä»£ç ä¸‹è½½æˆ‘ä»¬æƒ³è¦ç¡®ä¿â€œé˜»å¡â€æ‰§è¡Œ,ç›´åˆ°ä¸‹è½½å®Œæˆäº†,è¿™æ„å‘³ç€å®ƒå°†é˜²æ­¢å…¶ä»–JavaScriptæ‰§è¡Œ,ç›´åˆ°å®Œæˆ,å½“ä¸‹è½½å®Œæˆå,å°†un-block JavaScriptæ‰§è¡Œå’Œ2å·çº¿å°†æ‰§è¡Œã€‚ åŒæ­¥ä»£ç å¯¹äºå¿«é€Ÿå‘ç”Ÿçš„äº‹æƒ…å¾ˆå¥½ï¼Œä½†æ˜¯å¯¹äºé‚£äº›éœ€è¦ä¿å­˜ã€åŠ è½½ã€ä¸‹è½½æˆ–ä¸Šä¼ çš„ä¸œè¥¿æ¥è¯´æ˜¯å¾ˆå¯æ€•çš„ã€‚å¦‚æœä½ æ­£åœ¨ä¸‹è½½ç…§ç‰‡çš„æœåŠ¡å™¨å¾ˆæ…¢ï¼Œæˆ–è€…ä½ æ­£åœ¨ä½¿ç”¨çš„ç½‘ç»œè¿æ¥å¾ˆæ…¢ï¼Œæˆ–è€…ä½ æ­£åœ¨è¿è¡Œçš„ç”µè„‘ä¸Šè¿è¡Œçš„ç”µè„‘ä¸Šæœ‰å¤ªå¤šçš„youtubeè§†é¢‘æ ‡ç­¾ï¼Œè¿è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œæ€ä¹ˆåŠ?è¿™æ„å‘³ç€ï¼Œåœ¨ç¬¬2è¡Œå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå®ƒå¯èƒ½éœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿçš„ç­‰å¾…ã€‚åŒæ—¶ï¼Œç”±äºé¡µé¢ä¸Šçš„æ‰€æœ‰JavaScriptéƒ½åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­è¢«é˜»æ­¢è¿è¡Œï¼Œç½‘é¡µä¼šå®Œå…¨å†»ç»“ï¼Œç›´åˆ°ä¸‹è½½å®Œæˆåæ‰ä¼šå‡ºç°å“åº”ã€‚ åº”è¯¥ä¸æƒœä¸€åˆ‡ä»£ä»·é¿å…é˜»å¡çš„æ‰§è¡Œï¼Œå°¤å…¶æ˜¯è¿™æ ·åšä¼šä½¿ç¨‹åºå†»ç»“æˆ–å˜å¾—æ— å“åº”ã€‚è®©æˆ‘ä»¬å‡è®¾ä¸Šé¢çš„ç…§ç‰‡éœ€è¦ä¸€ç§’é’Ÿçš„æ—¶é—´ä¸‹è½½ã€‚ä¸ºäº†è¯´æ˜ä¸€ç§’é’Ÿå¯¹ä¸€å°ç°ä»£è®¡ç®—æœºæœ‰å¤šé•¿çš„æ—¶é—´ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç¨‹åºæ¥æµ‹è¯•JavaScriptåœ¨ä¸€ç§’å†…å¯ä»¥å¤„ç†å¤šå°‘ä»»åŠ¡ã€‚ 1234567891011121314151617function measureLoopSpeed() &#123; var count = 0 function addOne() &#123; count = count + 1 &#125; // Date.now() returns a big number representing the number of // milliseconds that have elapsed since Jan 01 1970 var now = Date.now() // Loop until Date.now() is 1000 milliseconds (1 second) or more into // the future from when we started looping. On each loop, call addOne while (Date.now() - now &lt; 1000) addOne() // Finally it has been &gt;= 1000ms, so let's print out our total count console.log(count)&#125;measureLoopSpeed() å°†ä¸Šé¢çš„ä»£ç å¤åˆ¶åˆ°ä½ çš„JavaScriptæ§åˆ¶å°ï¼Œä¸€ç§’é’Ÿåå®ƒå°±ä¼šæ‰“å°å‡ºä¸€ä¸ªæ•°å­—ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œæˆ‘å¾—åˆ°äº†8527360ï¼Œå¤§çº¦850ä¸‡ã€‚åœ¨ä¸€ç§’å†…ï¼ŒJavaScriptå¯ä»¥è°ƒç”¨addOneå‡½æ•°850ä¸‡æ¬¡ï¼å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰åŒæ­¥ä»£ç ä¸‹è½½ç…§ç‰‡ï¼Œè€Œç…§ç‰‡ä¸‹è½½éœ€è¦ä¸€ç§’ï¼Œè¿™æ„å‘³ç€æ‚¨å¯èƒ½ä¼šé˜»æ­¢850ä¸‡æ“ä½œçš„å‘ç”Ÿï¼Œè€ŒJavaScriptæ‰§è¡Œè¢«é˜»å¡ã€‚ æœ‰äº›è¯­è¨€æœ‰ä¸€ä¸ªåä¸ºsleepçš„å‡½æ•°ï¼Œå®ƒå¯ä»¥é˜»å¡æ‰§è¡Œæ•°ç§’ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨sleepçš„Mac OSä¸Šè¿è¡ŒTerminal.appçš„bashä»£ç ã€‚å½“æ‚¨è¿è¡Œå‘½ä»¤sleep 3 &amp;&amp; echo &#39;done sleeping nowæ—¶ã€‚åœ¨æ‰“å°å‡ºæ¥ä¹‹å‰ï¼Œå®ƒä¼šé˜»å¡3ç§’ã€‚ JavaScriptæ²¡æœ‰sleepå‡½æ•°ã€‚æ—¢ç„¶ä½ æ˜¯ä¸€åªçŒ«ï¼Œä½ å¯èƒ½ä¼šé—®è‡ªå·±:â€œæˆ‘ä¸ºä»€ä¹ˆè¦å­¦ä¹ ä¸€é—¨ä¸æ¶‰åŠç¡çœ çš„ç¼–ç¨‹è¯­è¨€?â€ä½†ç•™åœ¨æˆ‘èº«è¾¹ã€‚ä¸å…¶ä¾èµ–ç¡çœ ç­‰å¾…äº‹æƒ…çš„å‘ç”Ÿï¼ŒJavaScriptçš„è®¾è®¡è¿˜é¼“åŠ±ä½¿ç”¨å‡½æ•°ã€‚å¦‚æœåœ¨æ‰§è¡Œä»»åŠ¡Bä¹‹å‰å¿…é¡»ç­‰å¾…ä»»åŠ¡Aå®Œæˆï¼Œåˆ™å°†ä»»åŠ¡Bçš„æ‰€æœ‰ä»£ç éƒ½æ”¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œåœ¨å®Œæˆä»»åŠ¡æ—¶åªè°ƒç”¨è¯¥å‡½æ•°ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ç§å°é—­é£æ ¼çš„ä»£ç : 12a()b() è¿™æ˜¯ä¸€ç§éé˜»å¡çš„é£æ ¼: 1a(b) åœ¨éé˜»å¡ç‰ˆæœ¬ä¸­bæ˜¯ä¸€ä¸ªcallbackã€‚åœ¨é˜»å¡ç‰ˆæœ¬ä¸­aå’Œbéƒ½æ˜¯called/invoked(å®ƒä»¬éƒ½æœ‰()åç«‹å³æ‰§è¡Œå‡½æ•°)ã€‚åœ¨éé˜»å¡ç‰ˆæœ¬ä¸­ï¼Œæ‚¨å°†æ³¨æ„åˆ°åªæœ‰aè¢«è°ƒç”¨ï¼Œè€Œbåªæ˜¯ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™aã€‚ åœ¨é˜»å¡ç‰ˆæœ¬ä¸­ï¼Œaå’Œbä¹‹é—´æ²¡æœ‰æ˜ç¡®çš„å…³ç³»ï¼Œåœ¨éé˜»å¡ç‰ˆæœ¬ä¸­ï¼Œå®ƒå˜æˆäº†ä¸€é¡¹å·¥ä½œï¼Œåšå®ƒéœ€è¦åšçš„äº‹æƒ…ï¼Œç„¶ååœ¨å®Œæˆæ—¶è°ƒç”¨bã€‚ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨å‡½æ•°ç§°ä¸ºå›è°ƒå‡½æ•°ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›è°ƒå‡½æ•°åœ¨aå®Œæˆåä¼šè¢«è°ƒç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¼ªä»£ç çš„å®ç°ï¼Œå®ƒå¯èƒ½æ˜¯è¿™æ ·çš„: 123456789function a(done) &#123; download('https://pbs.twimg.com/media/B4DDWBrCEAA8u4O.jpg:large', function doneDownloading(error, png) &#123; // handle error if there was one if (err) console.log('uh-oh!', error) // call done when you are all done done() &#125;)&#125; å›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„éé˜»å¡ä¾‹å­a(b)ï¼Œæˆ‘ä»¬æŠŠaå’Œbä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚åœ¨ä¸Šé¢çš„å‡½æ•°å®šä¹‰ä¸­ï¼Œdoneå‚æ•°æ˜¯æˆ‘ä»¬ä¼ å…¥çš„bå‡½æ•°ã€‚è¿™ç§è¡Œä¸ºä¸€å¼€å§‹å¾ˆéš¾è®©ä½ çš„å¤´è„‘æœ‰ä¸ªå¤´ç»ªã€‚å½“ä½ è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ å…¥çš„å‚æ•°åœ¨å‡½æ•°ä¸­ä¸ä¼šæœ‰ç›¸åŒçš„å˜é‡åã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºbçš„å‡½æ•°æ˜¯åœ¨å‡½æ•°å†…éƒ¨å®Œæˆçš„ã€‚ä½†bå’Œdoneåªæ˜¯å˜é‡åï¼ŒæŒ‡å‘ç›¸åŒçš„åº•å±‚å‡½æ•°ã€‚é€šå¸¸å›è°ƒå‡½æ•°è¢«æ ‡è®°ä¸ºdoneæˆ–å›è°ƒï¼Œä»¥æ˜ç¡®å®ƒä»¬æ˜¯åœ¨å½“å‰å‡½æ•°ä¸ºdoneæ—¶åº”è¯¥è°ƒç”¨çš„å‡½æ•°ã€‚ æ‰€ä»¥ï¼Œåªè¦aå’Œbåœ¨å®Œæˆæ—¶ï¼Œaå’Œbéƒ½è¢«è°ƒç”¨åœ¨éé˜»å¡å’Œé˜»å¡çš„ä¸¤ä¸ªç‰ˆæœ¬ä¸­ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œåœ¨éé˜»å¡ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœæ­¢JavaScriptçš„æ‰§è¡Œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéé˜»å¡æ ·å¼æ˜¯æŒ‡æ‚¨ç¼–å†™æ¯ä¸ªå‡½æ•°çš„åœ°æ–¹ï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿå°½å¿«è¿”å›ï¼Œè€Œä¸ä¼šé˜»å¡ã€‚ ä¸ºäº†è¿›ä¸€æ­¥è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ éœ€è¦ä¸€ç§’é’Ÿçš„æ—¶é—´æ¥å®Œæˆï¼Œå¹¶ä¸”ä½ ä½¿ç”¨äº†é˜»å¡ç‰ˆæœ¬ï¼Œé‚£æ„å‘³ç€ä½ åªèƒ½åšä¸€ä»¶äº‹ã€‚å¦‚æœä½ ä½¿ç”¨éé˜»å¡ç‰ˆæœ¬(åˆç§°ä½¿ç”¨å›è°ƒ)ï¼Œä½ å¯ä»¥åœ¨åŒä¸€ç§’å†…å®Œæˆæ•°ç™¾ä¸‡ä»¶å…¶ä»–äº‹æƒ…ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥æ›´å¿«åœ°å®Œæˆä½ çš„å·¥ä½œï¼Œå¹¶åœ¨å‰©ä¸‹çš„æ—¶é—´é‡Œç¡è§‰ã€‚ è®°ä½:ç¼–ç¨‹å®Œå…¨æ˜¯å…³äºæ‡’æƒ°çš„ï¼Œä½ åº”è¯¥æ˜¯ä¸€ä¸ªç¡è§‰çš„äººï¼Œè€Œä¸æ˜¯ä½ çš„ç”µè„‘ã€‚ å¸Œæœ›æ‚¨ç°åœ¨å¯ä»¥çœ‹åˆ°ï¼Œå›è°ƒå‡½æ•°åªæ˜¯åœ¨ä¸€äº›å¼‚æ­¥ä»»åŠ¡ä¹‹åè°ƒç”¨å…¶ä»–å‡½æ•°çš„å‡½æ•°ã€‚å¼‚æ­¥ä»»åŠ¡çš„å¸¸è§ä¾‹å­æœ‰:è¯»å–ç…§ç‰‡ã€ä¸‹è½½æ­Œæ›²ã€ä¸Šä¼ å›¾ç‰‡ã€ä¸æ•°æ®åº“å¯¹è¯ã€ç­‰å¾…ç”¨æˆ·æŒ‰ä¸‹é”®æˆ–ç‚¹å‡»æŸäººç­‰ï¼Œä»»ä½•éœ€è¦æ—¶é—´çš„äº‹æƒ…ã€‚JavaScriptéå¸¸æ“…é•¿å¤„ç†åƒè¿™æ ·çš„å¼‚æ­¥ä»»åŠ¡ï¼Œåªè¦æ‚¨èŠ±æ—¶é—´å­¦ä¹ å¦‚ä½•ä½¿ç”¨å›è°ƒï¼Œå¹¶é˜²æ­¢JavaScriptè¢«é˜»å¡ã€‚ ç»“æŸ!è¿™åªæ˜¯æ‚¨ä¸JavaScriptçš„å…³ç³»çš„å¼€å§‹ï¼ä½ ä¸å¯èƒ½ä¸€ä¸‹å­å°±å­¦ä¼šæ‰€æœ‰çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä½ åº”è¯¥æ‰¾åˆ°é€‚åˆä½ çš„ä¸œè¥¿ï¼Œå¹¶å°è¯•åœ¨è¿™é‡Œå­¦ä¹ æ‰€æœ‰çš„æ¦‚å¿µã€‚ æˆ‘å»ºè®®æ˜å¤©å†æ¥ä¸€éï¼Œä»ä¸€å¼€å§‹å°±æŠŠæ•´ä»¶äº‹å†åšä¸€éï¼åœ¨ä½ å¾—åˆ°æ‰€æœ‰ä¸œè¥¿ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦å‡ æ¬¡(ç¼–ç¨‹æ˜¯å›°éš¾çš„)ã€‚è¯•ç€é¿å…åœ¨ä»»ä½•åŒ…å«é—ªäº®å¯¹è±¡çš„æˆ¿é—´é‡Œé˜…è¯»è¿™ä¸€é¡µã€‚å®ƒä»¬ä¼šè®©äººéš¾ä»¥ç½®ä¿¡çš„åˆ†å¿ƒã€‚ ä½ è¿˜æƒ³çŸ¥é“å¦ä¸€ä¸ªè¯é¢˜å—?åœ¨githubä¸Šä¸ºå®ƒæ‰“å¼€ä¸€ä¸ªé—®é¢˜ã€‚ æ¨èé˜…è¯»å¯¹äºçŒ«æ¥è¯´ï¼ŒJavaScriptè·³è¿‡äº†å¾ˆå¤šä¸é‡è¦çš„ç»†èŠ‚ï¼Œè¿™äº›ç»†èŠ‚å¹¶ä¸é‡è¦(çŒ«çš„æ³¨æ„åŠ›ä¸é›†ä¸­)ï¼Œä½†å¦‚æœä½ è§‰å¾—ä½ éœ€è¦æ·±å…¥ç ”ç©¶ä¸€ä¸‹ï¼Œå°±å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å†…å®¹: NodeSchool.ioæ˜¯ä¸€ç§ç¤¾åŒºé©±åŠ¨çš„ã€å¼€æºçš„æ•™è‚²è½¯ä»¶ï¼Œå®ƒä»¥ä¸€ç§äº¤äº’çš„ã€è‡ªå¯¼å‘çš„æ–¹å¼æ•™æˆå„ç§webå¼€å‘æŠ€èƒ½ã€‚æˆ‘å¸®åŠ©NodeSchool !å¯æ‚²çš„æ˜¯ï¼Œå®ƒæ¯”è¿™ä¸€é¡µæ›´å°‘çš„çŒ«ã€‚ Eloquent Javascriptæ˜¯ä¸€æœ¬å…è´¹çš„ä¹¦ï¼Œæ•™ä½ Javascriptï¼å¾ˆå¥½!ç‰¹åˆ«æ˜¯å…³äºå€¼ã€å˜é‡å’Œæ§åˆ¶æµçš„ç« èŠ‚ Mozillaçš„JavaScriptæŒ‡å—ä¹Ÿæœ‰ä¸€ä¸ªå¾ˆå¯çˆ±çš„å…¥é—¨ç« èŠ‚å«åšå€¼ï¼Œå˜é‡å’Œæ–‡å­— æ ‡å‡†JSé£æ ¼æŒ‡å—æ˜¯æˆ‘ä½¿ç”¨çš„JSé£æ ¼çš„â€œé›¶é…ç½®â€linter è®©æˆ‘ä»¬æ¥å†™@shamaçš„ä»£ç è¿™æ˜¯æˆ‘çš„ä¸€ä¸ªæœ‹å‹åˆ¶ä½œçš„å¾ˆæ£’çš„YouTubeç¼–ç æ•™ç¨‹","categories":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://jigangduan.github.io/categories/JavaScript/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"}]},{"title":"Hyperoslo Cacheä»‹ç»","slug":"hyperoslo-cache","date":"2018-01-26T01:20:34.000Z","updated":"2020-07-25T02:57:18.207Z","comments":true,"path":"2018/01/26/hyperoslo-cache/","link":"","permalink":"https://jigangduan.github.io/2018/01/26/hyperoslo-cache/","excerpt":"æè¿°åœ¨è¿™ä¸ªé¢†åŸŸé‡Œï¼ŒCacheå¹¶ä¸æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å¦ä¸€ä¸ªè®©ä½ æ‹¥æœ‰ä¸Šå¸åŠ›é‡çš„æ€ªç‰©åº“ã€‚é™¤äº†ç¼“å­˜ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸åšï¼Œä½†å®ƒåšå¾—å¾ˆå¥½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„å…¬å…±APIï¼Œå®ƒæœ‰å¼€ç®±å³ç”¨çš„å®ç°å’Œå·¨å¤§çš„è‡ªå®šä¹‰å¯èƒ½æ€§ã€‚é«˜é€Ÿç¼“å­˜åœ¨Swift 4ä¸­ä½¿ç”¨Codableæ¥æ‰§è¡Œåºåˆ—åŒ–ã€‚","text":"æè¿°åœ¨è¿™ä¸ªé¢†åŸŸé‡Œï¼ŒCacheå¹¶ä¸æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å¦ä¸€ä¸ªè®©ä½ æ‹¥æœ‰ä¸Šå¸åŠ›é‡çš„æ€ªç‰©åº“ã€‚é™¤äº†ç¼“å­˜ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸åšï¼Œä½†å®ƒåšå¾—å¾ˆå¥½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„å…¬å…±APIï¼Œå®ƒæœ‰å¼€ç®±å³ç”¨çš„å®ç°å’Œå·¨å¤§çš„è‡ªå®šä¹‰å¯èƒ½æ€§ã€‚é«˜é€Ÿç¼“å­˜åœ¨Swift 4ä¸­ä½¿ç”¨Codableæ¥æ‰§è¡Œåºåˆ—åŒ–ã€‚ å…³é”®ç‰¹æ€§ ä¸Swift 4 Codableåˆä½œã€‚ä»»ä½•ç¬¦åˆCodableçš„ä¸œè¥¿éƒ½å°†è¢«Storageè½»æ¾åœ°ä¿å­˜å’ŒåŠ è½½ã€‚ [X] é»˜è®¤ç£ç›˜å­˜å‚¨ã€‚å¯é€‰åœ°ä½¿ç”¨å†…å­˜å­˜å‚¨æ¥å¯ç”¨æ··åˆ. [X] é€‰é¡¹é€šè¿‡DiskConfigå’ŒMemoryConfig. æ”¯æŒè¿‡æœŸå’Œæ¸…é™¤è¿‡æœŸçš„å¯¹è±¡. çº¿ç¨‹å®‰å…¨çš„ã€‚å¯ä»¥ä»ä»»ä½•é˜Ÿåˆ—è®¿é—®æ“ä½œ. é»˜è®¤æƒ…å†µä¸‹åŒæ­¥ã€‚è¿˜æ”¯æŒå¼‚æ­¥APIs. [X] å­˜å‚¨å›¾åƒé€šè¿‡ImageWrapper. å¹¿æ³›çš„å•å…ƒæµ‹è¯•è¦†ç›–é¢å’Œæ–‡æ¡£. æ”¯æŒiOS, tvOS å’Œ macOS. ä½¿ç”¨StorageCacheæ˜¯å»ºç«‹åŸºäºè´£ä»»é“¾æ¨¡å¼,åœ¨å…¶ä¸­æœ‰è®¸å¤šå¤„ç†å¯¹è±¡ï¼Œæ¯ä¸ªå¤„ç†å¯¹è±¡éƒ½çŸ¥é“å¦‚ä½•æ‰§è¡Œ1ä¸ªä»»åŠ¡ï¼Œå¹¶å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä½†è¿™åªæ˜¯å®ç°ç»†èŠ‚ã€‚æ‚¨éœ€è¦çŸ¥é“çš„æ˜¯Storageï¼Œå®ƒä¿å­˜å¹¶åŠ è½½Codableå¯¹è±¡ã€‚ Storageæœ‰ç£ç›˜å­˜å‚¨å’Œå¯é€‰çš„å†…å­˜å­˜å‚¨ã€‚å†…å­˜å­˜å‚¨åº”è¯¥æ›´å°‘æ—¶é—´å’Œå†…å­˜æ¶ˆè€—ï¼Œè€Œç£ç›˜å­˜å‚¨ç”¨äºæ»¡è¶³åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„å†…å®¹ï¼Œæ›´åƒä¸€ç§å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æ–¹ä¾¿æ–¹å¼ï¼Œè¿™äº›ä¿¡æ¯åº”è¯¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æŒä¹…åŒ–ã€‚ DiskConfigæ˜¯å¿…éœ€çš„ï¼Œè®¾ç½®ç£ç›˜å­˜å‚¨ã€‚æ‚¨å¯ä»¥é€‰æ‹©é€šè¿‡MemoryConfigæ¥å°†å†…å­˜ä½œä¸ºå‰ç«¯å­˜å‚¨ã€‚ 1234let diskConfig = DiskConfig(name: \"Floppy\")let memoryConfig = MemoryConfig(expiry: .never, countLimit: 10, totalCostLimit: 10)let storage = try? Storage(diskConfig: diskConfig, memoryConfig: memoryConfig) Codable ç±»å‹Storageæ”¯æŒä»»ä½•ç¬¦åˆCodableåè®®å¯¹è±¡ã€‚ä½ å¯ä»¥åšä½ è‡ªå·±çš„äº‹æƒ…ç¬¦åˆCodable,è¿™æ ·å¯ä»¥ä¿å­˜å’ŒåŠ è½½Storageã€‚ æ”¯æŒçš„ç±»å‹: åŸè¯­å¦‚ Int, Float, String, Bool, â€¦ æ•°ç»„çš„å…ƒç´ å¦‚ [Int], [Float], [Double], â€¦ åŸºæœ¬ç±»å‹çš„Setå¦‚ Set&lt;String&gt;, Set&lt;Int&gt;, â€¦ ç®€å•çš„å­—å…¸ [String: Int], [String: String], â€¦ Date URL Data é”™è¯¯å¤„ç†é”™è¯¯å¤„ç†æ˜¯é€šè¿‡try catchå®Œæˆçš„ã€‚Storageåœ¨StorageErroræ–¹é¢æŠ›å‡ºé”™è¯¯ã€‚ 1234567891011121314public enum StorageError: Error &#123; /// ä¸èƒ½æ‰¾åˆ°å¯¹è±¡ case notFound /// å¯¹è±¡è¢«æ‰¾åˆ°ï¼Œä½†æ˜¯è¢«è¯·æ±‚çš„ç±»å‹å¤±è´¥äº† case typeNotMatch /// æ–‡ä»¶å±æ€§æ˜¯ç•¸å½¢çš„ case malformedFileAttributes /// ä¸èƒ½æ‰§è¡Œè§£ç  case decodingFailed /// ä¸èƒ½æ‰§è¡Œç¼–ç  case encodingFailed /// å­˜å‚¨å·²ç»è¢«é‡Šæ”¾äº† case deallocated&#125; åœ¨ä»å­˜å‚¨ä¸­åŠ è½½æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç£ç›˜é—®é¢˜æˆ–ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ï¼Œå› æ­¤ï¼Œå¦‚æœè¦å¤„ç†é”™è¯¯ï¼Œåˆ™éœ€è¦try catch 12345do &#123; let storage = try Storage(diskConfig: diskConfig, memoryConfig: memoryConfig)&#125; catch &#123; print(error)&#125; é…ç½®ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨å¤šç§é…ç½®é€‰é¡¹ 12345678910111213let diskConfig = DiskConfig( //ç£ç›˜å­˜å‚¨çš„åç§°ï¼Œè¿™å°†ç”¨ä½œç›®å½•ä¸­çš„æ–‡ä»¶å¤¹åç§° name: \"Floppy\", //åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ·»åŠ çš„å¯¹è±¡éƒ½å°†ä½¿ç”¨è¯¥è¿‡æœŸæ—¥æœŸ //å¦‚æœå®ƒæ²¡æœ‰åœ¨`setObject(forKey:expiry:)`æ–¹æ³•ä¸­è¢«è¦†ç›– expiry: .date(Date().addingTimeInterval(2*3600)), maxSize: 10000, // å­˜å‚¨ç£ç›˜ç¼“å­˜çš„ä½ç½®ã€‚å¦‚æœnilï¼Œå®ƒè¢«æ”¾ç½®åœ¨cachesDirectoryç›®å½•ä¸­. directory: try! FileManager.default.url(for: .documentDirectory, in: .userDomainMask, appropriateFor: nil, create: true).appendingPathComponent(\"MyPreferences\"), // æ•°æ®ä¿æŠ¤ç”¨äºåœ¨ç£ç›˜ä¸Šä»¥åŠ å¯†æ ¼å¼å­˜å‚¨æ–‡ä»¶ï¼Œå¹¶æ ¹æ®éœ€è¦å¯¹å…¶è¿›è¡Œè§£å¯† protectionType: .complete) 123456789let memoryConfig = MemoryConfig( //åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ·»åŠ çš„å¯¹è±¡éƒ½å°†ä½¿ç”¨è¯¥è¿‡æœŸæ—¥æœŸ //å¦‚æœå®ƒæ²¡æœ‰åœ¨`setObject(forKey:expiry:)`æ–¹æ³•ä¸­è¢«è¦†ç›– expiry: .date(Date().addingTimeInterval(2*60)), /// å†…å­˜ä¸­çš„å¯¹è±¡çš„æœ€å¤§æ•°é‡åº”è¯¥ä¿æŒåœ¨å†…å­˜ä¸­ countLimit: 50, /// ç¼“å­˜åœ¨å¼€å§‹æ¸…é™¤å¯¹è±¡ä¹‹å‰æ‰€èƒ½å®¹çº³çš„æœ€å¤§æ€»æˆæœ¬ totalCostLimit: 0) åœ¨iOSå¹³å°ä¸Šï¼ŒtvOSè¿˜å¯ä»¥åœ¨DiskConfigä¸ŠæŒ‡å®šprotectionTypeï¼Œåœ¨åº”ç”¨ç¨‹åºçš„å®¹å™¨ä¸­ä¸ºå­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶æ·»åŠ å®‰å…¨çº§åˆ«ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯,è¯·å‚è§FileProtectionType åŒæ­¥ APIsç¼ºçœæƒ…å†µä¸‹ï¼ŒStorageæ˜¯åŒæ­¥çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‚¨å¯ä»¥ä»ä»»ä½•é˜Ÿåˆ—è®¿é—®å®ƒã€‚æ‰€æœ‰åŒæ­¥åŠŸèƒ½éƒ½å—åˆ°StorageAwareåè®®çš„çº¦æŸã€‚ 12345678910111213141516171819202122// ä¿å­˜åˆ°storagetry? storage.setObject(10, forKey: \"score\")try? storage.setObject(\"Oslo\", forKey: \"my favorite city\", expiry: .never)try? storage.setObject([\"alert\", \"sounds\", \"badge\"], forKey: \"notifications\")try? storage.setObject(data, forKey: \"a bunch of bytes\")try? storage.setObject(authorizeURL, forKey: \"authorization URL\")// ä»storageåŠ è½½let score = try? storage.object(ofType: Int.self, forKey: \"score\")let favoriteCharacter = try? storage.object(ofType: String.self, forKey: \"my favorite city\")// æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨let hasFavoriteCharacter = try? storage.existsObject(ofType: String.self, forKey: \"my favorite city\")// åˆ é™¤å­˜å‚¨ä¸­çš„å¯¹è±¡try? storage.removeObject(forKey: \"my favorite city\")// åˆ é™¤æ‰€æœ‰å¯¹è±¡try? storage.removeAll()// åˆ é™¤è¿‡æœŸçš„å¯¹è±¡try? storage.removeExpiredObjects() Entryæ‚¨å¯ä»¥ä½¿ç”¨å®ƒçš„è¿‡æœŸä¿¡æ¯å’Œå…ƒæ•°æ®æ¥è·å–å¯¹è±¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Entry 1234let entry = try? storage.entry(ofType: String.self, forKey: \"my favorite city\")print(entry?.object)print(entry?.expiry)print(entry?.meta) å¦‚æœä»ç£ç›˜å­˜å‚¨å™¨ä¸­å–å‡ºå¯¹è±¡ï¼Œmetaå¯èƒ½åŒ…å«æ–‡ä»¶ä¿¡æ¯ã€‚ è‡ªå®šä¹‰ CodableCodableé€‚ç”¨äºåƒ[String: Int], [String: String], â€¦ è¿™æ ·çš„ç®€å•å­—å…¸å®ƒå¹¶ä¸é€‚ç”¨äº[String: Any]ï¼Œå› ä¸ºAnyä¸ç¬¦åˆCodableçš„ä¸€è‡´æ€§ï¼Œå®ƒå°†åœ¨è¿è¡Œæ—¶å¼•å‘è‡´å‘½é”™è¯¯ã€‚å› æ­¤ï¼Œå½“æ‚¨ä»åç«¯å“åº”ä¸­è·å¾—jsonæ—¶ï¼Œæ‚¨éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ‚¨çš„è‡ªå®šä¹‰Codableå¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºå­˜å‚¨ã€‚ 1234567struct User: Codable &#123; let firstName: String let lastName: String&#125;let user = User(fistName: \"John\", lastName: \"Snow\")try? storage.setObject(user, forKey: \"character\") å¼‚æ­¥ APIsåœ¨asyncæ–¹å¼ä¸­ï¼Œæ‚¨å¤„ç†Resultè€Œä¸æ˜¯try catchï¼Œå› ä¸ºresultæ˜¯åœ¨ç¨åçš„æ—¶é—´äº¤ä»˜çš„ï¼Œä»¥é¿å…é˜»å¡å½“å‰çš„è°ƒç”¨é˜Ÿåˆ—ã€‚åœ¨å®Œæˆå—ä¸­ï¼Œæ‚¨è¦ä¹ˆæœ‰valueï¼Œè¦ä¹ˆæœ‰errorã€‚ æ‚¨å¯ä»¥é€šè¿‡storage.asyncè®¿é—®å¼‚æ­¥APIsï¼Œå®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§æ‚¨æƒ³è¦çš„ä»»ä½•é¡ºåºä½¿ç”¨åŒæ­¥å’Œå¼‚æ­¥APIsã€‚æ‰€æœ‰çš„å¼‚æ­¥å‡½æ•°éƒ½å—åˆ°AsyncStorageAwareåè®®çš„çº¦æŸã€‚ 123456789101112131415161718192021222324252627282930313233storage.async.setObject(\"Oslo\", forKey: \"my favorite city\") &#123; result in switch result &#123; case .value: print(\"saved successfully\") case .error(let error): print(error) &#125; &#125;&#125;storage.async.object(ofType: String.self, forKey: \"my favorite city\") &#123; result in switch result &#123; case .value(let city): print(\"my favorite city is \\(city)\") case .error(let error): print(error) &#125; &#125;&#125;storage.async.existsObject(ofType: String.self, forKey: \"my favorite city\") &#123; result in if case .value(let exists) = result, exists &#123; print(\"I have a favorite city\") &#125;&#125;storage.async.removeAll() &#123; result in print(\"removal completes\")&#125;storage.async.removeExpiredObjects() &#123; result in print(\"removal completes\")&#125; åˆ°æœŸæ—¥æœŸé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä¿å­˜çš„å¯¹è±¡ä¸æ‚¨åœ¨DiskConfigæˆ–MemoryConfigä¸­æŒ‡å®šçš„åˆ°æœŸæ—¶é—´å…·æœ‰ç›¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚å¯ä»¥é€šè¿‡æŒ‡å®šsetObjectçš„expiryæ¥è¦†ç›–ç‰¹å®šå¯¹è±¡ 123456789101112// é…ç½®çš„é»˜è®¤è¿‡æœŸæ—¥æœŸå°†è¢«åº”ç”¨åˆ°é¡¹ç›®ä¸­try? storage.setObject(\"This is a string\", forKey: \"string\")// ç»™å®šçš„è¿‡æœŸæ—¥æœŸtry? storage.setObject( \"This is a string\", forKey: \"string\" expiry: .date(Date().addingTimeInterval(2 * 3600)))// æ¸…é™¤è¿‡æœŸçš„å¯¹è±¡storage.removeExpiredObjects() å…³äºå›¾ç‰‡ï¼Ÿå¦‚æ‚¨æ‰€çŸ¥ï¼ŒNSImageå’ŒUIImageåœ¨é»˜è®¤æƒ…å†µä¸‹ä¸ç¬¦åˆCodableã€‚ä¸ºäº†ä½¿å®ƒåœ¨å¯ç¼–ç¨‹åºä¸­è¿è¡Œè‰¯å¥½ï¼Œæˆ‘ä»¬å¼•å…¥äº†ImageWrapperï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ä¿å­˜å’ŒåŠ è½½å›¾åƒ 1234let wrapper = ImageWrapper(image: starIconImage)try? storage.setObject(wrapper, forKey: \"star\")let icon = try? storage.object(ofType: ImageWrapper.self, forKey: \"star\").image å¦‚æœä½ æƒ³æŠŠå›¾åƒè½½å…¥UIImageViewæˆ–NSImageViewï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç¤¼ç‰©ç»™ä½ ã€‚å«åšImaginary,å¹¶ä½¿ç”¨Cacheä¸‹ç½©æ—¶,è®©ä½ çš„ç”Ÿæ´»æ›´å®¹æ˜“å¤„ç†è¿œç¨‹å›¾åƒã€‚ å¤„ç†JSONå“åº”å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç”¨ä¾‹æ˜¯ä»åç«¯è·å–jsonï¼Œå¹¶å°†jsonå­˜å‚¨åˆ°å­˜å‚¨ä¸­ï¼Œä»¥ä¾¿å°†æ¥ä½¿ç”¨ã€‚å¦‚æœä½ ä½¿ç”¨åº“Alamofireæˆ–Malibu,ä½ æ˜¯å¾—åˆ°jsonå½¢å¼çš„å­—å…¸,å­—ç¬¦ä¸²,æˆ–æ•°æ®ã€‚ Storageå¯ä»¥æŒä¹…å­˜å‚¨å­—ç¬¦ä¸²æˆ–æ•°æ®ã€‚æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨JSONArrayWrapperå’ŒJSONDictionaryWrapperå°†jsonä¿å­˜åˆ°Storageä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬æ›´å–œæ¬¢æŒä¹…åŒ–å¼ºç±»å‹çš„å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡æ˜¯æ‚¨å°†åœ¨UIä¸­æ˜¾ç¤ºçš„å¯¹è±¡ã€‚æ­¤å¤–ï¼Œå¦‚æœjsonæ•°æ®ä¸èƒ½è½¬æ¢ä¸ºå¼ºç±»å‹çš„å¯¹è±¡ï¼Œé‚£ä¹ˆä¿å­˜å®ƒçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢?ğŸ˜‰ æ‚¨å¯ä»¥åœ¨JSONDecoderä¸Šä½¿ç”¨è¿™äº›æ‰©å±•æ¥è§£ç jsonå­—å…¸ã€å­—ç¬¦ä¸²æˆ–æ•°æ®åˆ°å¯¹è±¡ã€‚ 123let user = JSONDecoder.decode(jsonString, to: User.self)let cities = JSONDecoder.decode(jsonDictionary, to: [City].self)let dragons = JSONDecoder.decode(jsonData, to: [Dragon].self) è¿™å°±æ˜¯å¦‚ä½•ä½¿ç”¨Alamofireæ‰§è¡Œå¯¹è±¡è½¬æ¢å’Œä¿å­˜ 12345678Alamofire.request(\"https://gameofthrones.org/mostFavoriteCharacter\").responseString &#123; response in do &#123; let user = try JSONDecoder.decode(response.result.value, to: User.self) try storage.setObject(user, forKey: \"most favorite character\") &#125; catch &#123; print(error) &#125;&#125; å®‰è£…CocoapodsCache æ˜¯é€šè¿‡CocoaPodsæä¾›çš„ã€‚å®‰è£…å®ƒç®€å•åœ°å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°æ‚¨çš„Podfile: 1pod 'Cache' CarthageCache æ˜¯é€šè¿‡ Carthageæä¾›çš„.å®‰è£…å®ƒç®€å•åœ°å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°æ‚¨çš„Cartfile: 1github \"hyperoslo/Cache\" ä½ è¿˜éœ€è¦æ·»åŠ  SwiftHash.framework åœ¨ä½ çš„ copy-frameworks è„šæœ¬.","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"iOSç¬¬ä¸‰æ–¹åº“","slug":"iOS/iOSç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/iOS/iOSç¬¬ä¸‰æ–¹åº“/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"}]},{"title":"åŸºäºSyliusæ­å»ºç”µå•†å¹³å°","slug":"sylius-set-up","date":"2018-01-03T04:53:57.000Z","updated":"2020-07-25T02:57:18.229Z","comments":true,"path":"2018/01/03/sylius-set-up/","link":"","permalink":"https://jigangduan.github.io/2018/01/03/sylius-set-up/","excerpt":"Syliusæ˜¯ä¸€ç§ç”µå­å•†åŠ¡æŠ€æœ¯ï¼Œå®ƒèƒ½è®©ä½ å®Œå…¨è‡ªç”±åœ°åˆ›é€ ä¸€ç§ç‹¬ç‰¹çš„å®¢æˆ·ä½“éªŒã€‚å®ƒä¸æ‚¨ç°æœ‰çš„ç³»ç»Ÿé›†æˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¿è¯å¿«é€Ÿä¸Šå¸‚ã€‚ Syliusä½¿ç”¨PHPç¼–ç¨‹è¯­è¨€å’ŒSymfonyæ¡†æ¶ã€‚åƒDrupalæˆ–eZè¿™æ ·çš„å¤§å‹çš„å¼€æºé¡¹ç›®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å®ƒä½¿ç”¨doctrineä½œä¸ºORMã€æ•°æ®åº“æŠ½è±¡å’ŒTWIG(PHPçš„å®‰å…¨æ¨¡æ¿å¼•æ“)ã€‚ Syliusä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„è§£å†³æ–¹æ¡ˆâ€”â€”æ‚¨å¯ä»¥éšæ—¶æ›´æ”¹æˆ–å¼€å‘å®ƒã€‚å®ƒå¯ä»¥ä½œä¸ºä½ çš„è‡ªå®šä¹‰ç”µå­å•†åŠ¡å¹³å°çš„åŸºç¡€ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä½ è‡ªå·±ç³»ç»Ÿçš„æ ¸å¿ƒã€‚ è¿™ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•æ­å»ºSyliusæ¡†æ¶å’Œæ·»åŠ ShopAPIæ’ä»¶ï¼Œä»¥é€‚åº”ç§»åŠ¨APPçš„ç”µå•†å®¢æˆ·ç«¯APIã€‚","text":"Syliusæ˜¯ä¸€ç§ç”µå­å•†åŠ¡æŠ€æœ¯ï¼Œå®ƒèƒ½è®©ä½ å®Œå…¨è‡ªç”±åœ°åˆ›é€ ä¸€ç§ç‹¬ç‰¹çš„å®¢æˆ·ä½“éªŒã€‚å®ƒä¸æ‚¨ç°æœ‰çš„ç³»ç»Ÿé›†æˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¿è¯å¿«é€Ÿä¸Šå¸‚ã€‚ Syliusä½¿ç”¨PHPç¼–ç¨‹è¯­è¨€å’ŒSymfonyæ¡†æ¶ã€‚åƒDrupalæˆ–eZè¿™æ ·çš„å¤§å‹çš„å¼€æºé¡¹ç›®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å®ƒä½¿ç”¨doctrineä½œä¸ºORMã€æ•°æ®åº“æŠ½è±¡å’ŒTWIG(PHPçš„å®‰å…¨æ¨¡æ¿å¼•æ“)ã€‚ Syliusä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„è§£å†³æ–¹æ¡ˆâ€”â€”æ‚¨å¯ä»¥éšæ—¶æ›´æ”¹æˆ–å¼€å‘å®ƒã€‚å®ƒå¯ä»¥ä½œä¸ºä½ çš„è‡ªå®šä¹‰ç”µå­å•†åŠ¡å¹³å°çš„åŸºç¡€ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä½ è‡ªå·±ç³»ç»Ÿçš„æ ¸å¿ƒã€‚ è¿™ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•æ­å»ºSyliusæ¡†æ¶å’Œæ·»åŠ ShopAPIæ’ä»¶ï¼Œä»¥é€‚åº”ç§»åŠ¨APPçš„ç”µå•†å®¢æˆ·ç«¯APIã€‚ ç³»ç»Ÿéœ€æ±‚é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹è¿è¡ŒSymfonyçš„éœ€æ±‚ã€‚ æ¨èæ“ä½œç³»ç»Ÿæ˜¯Unixç³»ç»Ÿ â€”â€” Linuxï¼ŒMacOS WebæœåŠ¡å™¨å’Œé…ç½® Apache web server â‰¥ 2.2 å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¨èæ–¹æ³•æ˜¯ä½¿ç”¨PHPå†…ç½®çš„webæœåŠ¡å™¨ PHPéœ€è¦æ¨¡å—å’Œé…ç½®PHPç‰ˆæœ¬:PHP ^7.1 PHPæ‰©å±•: gd æ²¡æœ‰å…·ä½“çš„é…ç½® exif æ²¡æœ‰å…·ä½“çš„é…ç½® fileinfo æ²¡æœ‰å…·ä½“çš„é…ç½® intl æ²¡æœ‰å…·ä½“çš„é…ç½® PHPé…ç½®è®¾ç½®: memory_limit â‰¥1024M date.timezone Europe/Warsaw æ•°æ®åº“ MySQL 5.x å½“ç„¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–RDBMSï¼Œä¾‹å¦‚PostgreSQLã€‚ è®¿é—®æƒé™å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹å’Œæ–‡ä»¶åªéœ€è¦è¯»å–è®¿é—®æƒé™ï¼Œä½†æ˜¯ä¸€äº›æ–‡ä»¶å¤¹ä¹Ÿéœ€è¦å¯¹Apache/Nginxç”¨æˆ·çš„å†™è®¿é—®æƒé™: var/cache ar/logs web/media ç¯å¢ƒæ­å»ºä¸ºäº†æ–¹ä¾¿ï¼Œç¯å¢ƒåœ¨macOSä¸Šé€‰æ‹©ä½¿ç”¨MAMP Proã€‚ å¼€å‘è¿‡ç¨‹ä¸­çš„WebæœåŠ¡å™¨ä½¿ç”¨PHPå†…ç½®çš„webæœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸»è¦çš„é…ç½®æ˜¯PHPå’Œæ•°æ®åº“çš„ç¯å¢ƒã€‚MAMP Proä¸Šè‡ªå¸¦MySQLå’ŒphpMyAdmin. åŒå‡»phpMyAdminå›¾æ ‡ï¼š PHPé…ç½®ä½¿èƒ½ç›¸å…³æ‰©å±•ï¼š å†…å­˜é™åˆ¶ï¼š åˆ›å»ºæ•°æ®åº“ç”¨æˆ·å’Œåº“ å®‰è£…æœ¬æ–‡å‡è®¾æ‚¨ç†Ÿæ‚‰PHPçš„ä¾èµ–ç®¡ç†å™¨Composerã€‚ åˆ›å»ºSyliusé¡¹ç›®è¦ä½¿ç”¨Syliusæ ‡å‡†ç‰ˆåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤: 1composer create-project sylius/sylius-standard sylius composerå¼€å§‹å®‰è£…ï¼š 1234567891011Installing sylius/sylius-standard (v1.0.7) - Installing sylius/sylius-standard (v1.0.7): Downloading (100%) Created project in syliusLoading composer repositories with package informationInstalling dependencies (including require-dev) from lock fileWarning: The lock file is not up to date with the latest changes in composer.json. You may be getting outdated dependencies. Run update to update them.Package operations: 151 installs, 0 updates, 0 removals - Installing ocramius/package-versions (1.2.0): Downloading (100%) - Installing behat/transliterator (v1.2.0): Loading from cache - Installing doctrine/lexer (v1.0.1): Loading from cache... ... å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£…å¯ä»¥ä¸‹è½½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œä¾èµ–äº†å¾ˆå¤šçš„åº“ã€‚ ä¾èµ–ä¸‹è½½å®Œæˆä¹‹åï¼Œå®‰è£…è¿‡ç¨‹ä¼šæ„å»ºå‚æ•°ï¼Œéœ€è¦å¡«å†™ä¿¡æ¯ï¼š 1234567891011121314&gt; Incenteev\\ParameterHandler\\ScriptHandler::buildParametersCreating the \"app/config/parameters.yml\" fileSome parameters are missing. Please provide them.database_driver (pdo_mysql):database_host (127.0.0.1):database_port (null): 8889database_name (sylius): syliusdatabase_user (root): syliusdatabase_password (null): syliusmailer_transport (smtp):mailer_host (127.0.0.1):mailer_user (null): syliusmailer_password (null): syliussecret (EDITME): ä»¥ä¸Šä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œåˆ›å»ºäº†ä¸€ä¸ªapp/config/parameters.ymlæ–‡ä»¶ã€‚è®¾ç½®äº†ä¸€äº›é…ç½®å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¹Ÿå¯ä»¥åœ¨æ–‡ä»¶ä¸­æ›´æ”¹ã€‚ æœ€åä¼šæ¸…é™¤ç¼“å­˜å’Œå®‰è£…èµ„æºï¼š Syliusé¡¹ç›®æ–°å»ºæˆåŠŸï¼ï¼ æ–°å»ºå®ŒæˆSyliusé¡¹ç›®åï¼Œä¼šå‡ºç°ä¸€ä¸ªsyliusæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯æ•´ä¸ªé¡¹ç›®å·¥ç¨‹ã€‚ 123456789101112131415161718$ tree -L 1.â”œâ”€â”€ Gulpfile.jsâ”œâ”€â”€ LICENSEâ”œâ”€â”€ README.mdâ”œâ”€â”€ appâ”œâ”€â”€ behat.yml.distâ”œâ”€â”€ binâ”œâ”€â”€ composer.jsonâ”œâ”€â”€ composer.lockâ”œâ”€â”€ etcâ”œâ”€â”€ featuresâ”œâ”€â”€ package.jsonâ”œâ”€â”€ srcâ”œâ”€â”€ varâ”œâ”€â”€ vendorâ”œâ”€â”€ webâ””â”€â”€ yarn.lock æ ‡å‡†çš„Symfonyé¡¹ç›®ç›®å½•ç»“æ„ã€‚Symfonyå’ŒSyliusçš„æºç éƒ½åœ¨vendorç›®å½•çº§ä¸‹ã€‚ å®‰è£…Sylius12$ cd sylius # Move to the newly created directory$ php bin/console sylius:install å®‰è£…è¿‡ç¨‹ä¸»è¦æ˜¯: æ£€æŸ¥ç³»ç»Ÿéœ€æ±‚ å»ºç«‹æ•°æ®åº“ã€‚åˆ›å»ºSyliusç›¸å…³çš„æ•°æ®è¡¨å’Œä¸€äº›æµ‹è¯•çš„èµ„æºæ•°æ®(æ¯”å¦‚äº§å“/é¡¾å®¢ç”¨æˆ·ç­‰)ã€‚ æ‰€ä»¥å®‰è£…è¿‡ç¨‹è¯·ç¡®ä¿æ•°æ®åº“èƒ½æ­£å¸¸è¿æ¥ã€‚ åˆ›å»ºåª’ä½“æ–‡ä»¶å¤¹ â€˜web/mediaâ€™,â€™web/media/imageâ€™ é€‰æ‹©è´§å¸ æ·»åŠ è¯­è¨€ç¯å¢ƒen_US åˆ›å»ºæ‚¨çš„ç®¡ç†å‘˜å¸æˆ· å®‰è£…assetsä¸ºäº†çœ‹åˆ°ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„å‰ç«¯ï¼Œæ‚¨éœ€è¦å®‰è£…å®ƒçš„assets. Yarnå®‰è£…åˆ°æ‚¨çš„é¡¹ç›®ç›®å½•å¹¶è¿è¡Œ: 1$ yarn install ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨gulpæ¥å®‰è£…viewsï¼Œåªéœ€è¿è¡Œä¸€ä¸ªç®€å•çš„å‘½ä»¤: 1$ yarn run gulp è®¿é—®å•†åº—å»ºè®®ä½¿ç”¨Symfonyå†…ç½®webæœåŠ¡å™¨è¿è¡Œphp bin/console server:start 127.0.0.1:8000å‘½ä»¤ï¼Œç„¶ååœ¨webæµè§ˆå™¨ä¸­è®¿é—®http://127.0.0.1:8000ï¼Œä»¥æŸ¥çœ‹è¯¥å•†åº—ã€‚ è®¿é—®ç®¡ç†é¢æ¿æŸ¥çœ‹/admin urlï¼Œæ‚¨å°†åœ¨å…¶ä¸­æ‰¾åˆ°ç®¡ç†é¢æ¿ã€‚ è¯·è®°ä½ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨å®‰è£…Syliusæ—¶æä¾›çš„å‡­è¯ä½œä¸ºç®¡ç†å‘˜ç™»å½•ã€‚ ä¿®æ”¹ç®¡ç†é¢æ¿ä¸ºä¸­æ–‡ é¡¹ç›®ç»“æ„ç®€ä»‹åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°è¿™äº›é‡è¦çš„å­ç›®å½•: app/config/ - æ·»åŠ yamlé…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬è·¯ç”±ã€å®‰å…¨ã€çŠ¶æ€æœºé…ç½®ç­‰ var/logs/ - åº”ç”¨ç¨‹åºçš„æ—¥å¿— var/cache/ - é¡¹ç›®çš„ç¼“å­˜ src/ - AppBundleä¸­æ·»åŠ æ‰€æœ‰è‡ªå®šä¹‰é€»è¾‘çš„åœ°æ–¹ web/ - æ”¾ç½®ä½ çš„é¡¹ç›®çš„èµ„äº§ bin/console å‘½ä»¤åˆ—è¡¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124$ php bin/console listSymfony 3.4.2 (kernel: app, env: dev, debug: true)Usage: command [options] [arguments]Options: -h, --help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -q, --quiet ä¸è¦è¾“å‡ºä»»ä½•æ¶ˆæ¯ -V, --version æ˜¾ç¤ºè¿™ä¸ªåº”ç”¨ç¨‹åºç‰ˆæœ¬ --ansi Force ANSI output --no-ansi Disable ANSI output -n, --no-interaction ä¸è¦é—®ä»»ä½•äº’åŠ¨çš„é—®é¢˜ -e, --env=ENV ç¯å¢ƒåç§°[é»˜è®¤:â€œdevâ€] --no-debug å…³é—­è°ƒè¯•æ¨¡å¼ -v|vv|vvv, --verbose å¢åŠ æ¶ˆæ¯çš„å†—ä½™:1ç”¨äºæ­£å¸¸è¾“å‡ºï¼Œ2ç”¨äºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3ç”¨äºè°ƒè¯•ã€‚Available commands: about æ˜¾ç¤ºå½“å‰é¡¹ç›®çš„ä¿¡æ¯ help æ˜¾ç¤ºå‘½ä»¤çš„å¸®åŠ© list å‘½ä»¤åˆ—è¡¨ assets assets:install åœ¨å…¬å…±ç›®å½•ä¸‹å®‰è£…bundle webèµ„äº§ cache cache:clear æ¸…ç©ºç¼“å­˜ cache:pool:clear æ¸…é™¤ç¼“å­˜æ±  cache:pool:prune ä¿®å‰ªç¼“å­˜æ±  cache:warmup é¢„çƒ­ç©ºç¼“å­˜ config config:dump-reference ä¸ºæ‰©å±•è½¬å‚¨é»˜è®¤é…ç½® debug debug:autowiring åˆ—å‡ºå¯ä»¥ç”¨äºè‡ªåŠ¨è£…é…çš„ç±»/æ¥å£ debug:config è½¬å‚¨å½“å‰é…ç½® debug:container æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„å½“å‰æœåŠ¡ debug:event-dispatcher ä¸ºåº”ç”¨ç¨‹åºæ˜¾ç¤ºå·²é…ç½®çš„ä¾¦å¬å™¨ debug:form æ˜¾ç¤ºè¡¨å•ç±»å‹ä¿¡æ¯ debug:payum:gateway [payum:gateway:debug] debug:router æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„å½“å‰è·¯ç”± debug:swiftmailer æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„å½“å‰é‚®ä»¶ debug:translation æ˜¾ç¤ºæ¶ˆæ¯ç¿»è¯‘ä¿¡æ¯ debug:twig æ˜¾ç¤ºä¸€ç»„åˆ†æ”¯å‡½æ•°ã€ç­›é€‰å™¨ã€å…¨å±€å˜é‡å’Œæµ‹è¯• debug:winzou:state-machine doctrine doctrine:cache:clear-collection-region æ¸…é™¤äºŒçº§ç¼“å­˜æ”¶é›†åŒºåŸŸ. doctrine:cache:clear-entity-region æ¸…é™¤äºŒçº§ç¼“å­˜å®ä½“åŒºåŸŸ. doctrine:cache:clear-metadata ä¸ºä¸€ä¸ªå®ä½“ç®¡ç†å™¨æ¸…é™¤æ‰€æœ‰çš„å…ƒæ•°æ®ç¼“å­˜ doctrine:cache:clear-query ä¸ºä¸€ä¸ªå®ä½“ç®¡ç†å™¨æ¸…é™¤æ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜ doctrine:cache:clear-query-region æ¸…é™¤äºŒçº§ç¼“å­˜æŸ¥è¯¢åŒºåŸŸ. doctrine:cache:clear-result ä¸ºå®ä½“ç®¡ç†å™¨æ¸…é™¤ç»“æœç¼“å­˜ doctrine:cache:contains æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé«˜é€Ÿç¼“å­˜æ¡ç›® doctrine:cache:delete åˆ é™¤ç¼“å­˜æ¡ç›® doctrine:cache:flush [doctrine:cache:clear] åˆ·æ–°ä¸€ä¸ªç»™å®šçš„ç¼“å­˜ doctrine:cache:stats è·å–ç»™å®šç¼“å­˜æä¾›è€…çš„ç»Ÿè®¡ä¿¡æ¯ doctrine:database:create åˆ›å»ºé…ç½®çš„æ•°æ®åº“ doctrine:database:drop Drops the configured database doctrine:database:import å°†SQLæ–‡ä»¶ç›´æ¥å¯¼å…¥æ•°æ®åº“. doctrine:ensure-production-settings éªŒè¯è¯¥åŸåˆ™æ˜¯å¦ä¸ºç”Ÿäº§ç¯å¢ƒé…ç½®äº†é€‚å½“çš„é…ç½®. doctrine:fixtures:load å°†æ•°æ®å›ºå®šåˆ°æ•°æ®åº“ä¸­. doctrine:generate:entities [generate:doctrine:entities] ä»æ˜ å°„ä¿¡æ¯ä¸­ç”Ÿæˆå®ä½“ç±»å’Œæ–¹æ³•å­˜æ ¹ doctrine:mapping:convert [orm:convert:mapping] è½¬æ¢æ”¯æŒæ ¼å¼ä¹‹é—´çš„æ˜ å°„ä¿¡æ¯. doctrine:mapping:import ä»ç°æœ‰æ•°æ®åº“å¯¼å…¥æ˜ å°„ä¿¡æ¯ doctrine:mapping:info doctrine:migrations:diff é€šè¿‡å°†å½“å‰æ•°æ®åº“ä¸æ˜ å°„ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œç”Ÿæˆè¿ç§». doctrine:migrations:execute æ‰‹åŠ¨æ‰§è¡Œå•ä¸ªè¿ç§»ç‰ˆæœ¬. doctrine:migrations:generate ç”Ÿæˆä¸€ä¸ªç©ºç™½çš„è¿ç§»ç±». doctrine:migrations:latest è¾“å‡ºæœ€æ–°ç‰ˆæœ¬å· doctrine:migrations:migrate æ‰§è¡Œè¿ç§»åˆ°æŒ‡å®šçš„ç‰ˆæœ¬æˆ–æœ€æ–°çš„å¯ç”¨ç‰ˆæœ¬. doctrine:migrations:status æŸ¥çœ‹ä¸€ç»„è¿ç§»çš„çŠ¶æ€. doctrine:migrations:version æ‰‹åŠ¨æ·»åŠ å’Œåˆ é™¤ç‰ˆæœ¬è¡¨ä¸­çš„è¿ç§»ç‰ˆæœ¬. doctrine:query:dql ä»å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œä»»æ„DQL. doctrine:schema:create æ‰§è¡Œ(æˆ–è½¬å‚¨)ç”Ÿæˆæ•°æ®åº“æ¨¡å¼æ‰€éœ€çš„SQL doctrine:schema:drop æ‰§è¡Œ(æˆ–è½¬å‚¨)åˆ é™¤å½“å‰æ•°æ®åº“æ¨¡å¼æ‰€éœ€çš„SQL doctrine:schema:update æ‰§è¡Œ(æˆ–è½¬å‚¨)æ›´æ–°æ•°æ®åº“æ¨¡å¼æ‰€éœ€çš„SQLï¼Œä»¥åŒ¹é…å½“å‰çš„æ˜ å°„å…ƒæ•°æ®. doctrine:schema:validate éªŒè¯æ˜ å°„æ–‡ä»¶. fos fos:oauth-server:clean æ¸…é™¤åˆ°æœŸçš„ä»¤ç‰Œ gaufrette gaufrette:filesystem:keys åˆ—å‡ºæ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶é”® liip liip:imagine:cache:remove åˆ é™¤ç”¨äºä¼ é€’çš„èµ„äº§è·¯å¾„å’Œè¿‡æ»¤å™¨åç§°çš„èµ„äº§ç¼“å­˜ liip:imagine:cache:resolve ä¸ºå·²ä¼ é€’çš„èµ„äº§è·¯å¾„å’Œè¿‡æ»¤é›†åç§°è§£æèµ„äº§ç¼“å­˜ lint lint:twig Lints a template and outputs encountered errors lint:xliff Lints a XLIFF file and outputs encountered errors lint:yaml Lints a file and outputs encountered errors payum payum:security:create-capture-token payum:security:create-notify-token payum:status å…è®¸è·å¾—ä»˜æ¬¾çŠ¶æ€. router router:match é€šè¿‡æ¨¡æ‹Ÿè·¯å¾„ä¿¡æ¯åŒ¹é…æ¥å¸®åŠ©è°ƒè¯•è·¯ç”± security security:check æ£€æŸ¥é¡¹ç›®ä¾èµ–é¡¹ä¸­çš„å®‰å…¨æ€§é—®é¢˜ security:encode-password ç¼–ç ä¸€ä¸ªå¯†ç . server server:run è¿è¡Œä¸€ä¸ªæœ¬åœ°webæœåŠ¡å™¨ server:start åœ¨åå°å¯åŠ¨ä¸€ä¸ªæœ¬åœ°webæœåŠ¡å™¨ server:status ä¸ºç»™å®šåœ°å€è¾“å‡ºæœ¬åœ°webæœåŠ¡å™¨çš„çŠ¶æ€ server:stop åœæ­¢ä½¿ç”¨`server:start` å‘½ä»¤å¯åŠ¨çš„æœ¬åœ°webæœåŠ¡å™¨ sonata sonata:block:debug è°ƒè¯•æ‰€æœ‰å¯ç”¨çš„å—ï¼Œæ˜¾ç¤ºæ¯ä¸ªå—çš„é»˜è®¤è®¾ç½® sonata:core:dump-doctrine-metadata è·å–å½“å‰æ•™æ¡æ¨¡å¼çš„ä¿¡æ¯ swiftmailer swiftmailer:email:send å‘é€ç®€å•çš„ç”µå­é‚®ä»¶æ¶ˆæ¯ swiftmailer:spool:send ä»çº¿è½´å‘é€ç”µå­é‚®ä»¶ sylius sylius:cancel-unpaid-orders åˆ é™¤åœ¨é…ç½®æœŸé—´æœªæ”¯ä»˜çš„è®¢å•ã€‚é…ç½®å‚æ•°â€”â€”sylius_order.order_expiration_period. sylius:debug:resource è°ƒè¯•èµ„æºå…ƒæ•°æ®. sylius:fixtures:list åˆ—å‡ºå¯ç”¨çš„fixtures sylius:fixtures:load ä»ç»™å®šçš„å¥—ä»¶åŠ è½½fixtures sylius:install åœ¨æ‚¨çš„é¦–é€‰ç¯å¢ƒä¸­å®‰è£…Sylius. sylius:install:assets å®‰è£…æ‰€æœ‰Syliusèµ„äº§. sylius:install:check-requirements æ£€æŸ¥æ‰€æœ‰çš„Syliuséœ€æ±‚æ˜¯å¦æ»¡è¶³. sylius:install:database å®‰è£…Syliusæ•°æ®åº“. sylius:install:sample-data å°†æ ·æœ¬æ•°æ®å®‰è£…åˆ°Sylius. sylius:install:setup Syliusé…ç½®è®¾ç½®. sylius:oauth-server:create-client åˆ›å»ºä¸€ä¸ªæ–°å®¢æˆ· sylius:remove-expired-carts åˆ é™¤åœ¨é…ç½®æœŸé—´ç©ºé—²çš„è´­ç‰©è½¦ã€‚é…ç½®å‚æ•°â€”â€”sylius_order.cart_expires_after. sylius:theme:assets:install åœ¨å…¬å…±webç›®å½•ä¸‹å®‰è£…ä¸»é¢˜webèµ„äº§ sylius:theme:list æ˜¾ç¤ºè¢«æ£€æµ‹åˆ°çš„ä¸»é¢˜çš„åˆ—è¡¨. sylius:user:demote é€šè¿‡åˆ é™¤è§’è‰²æ¥æ¼”ç¤ºç”¨æˆ·. sylius:user:promote é€šè¿‡æ·»åŠ è§’è‰²æ¥æå‡ç”¨æˆ·. translation translation:update æ›´æ–°çš„ç¿»è¯‘æ–‡ä»¶ å®‰è£…ShopAPIæ’ä»¶ ShopAPIæ’ä»¶æä¾›äº†Syliusç”µå­å•†åŠ¡å¹³å°ä¸Šçš„ShopApiå®ç°ã€‚ ä½¿ç”¨å®‰è£…æ’ä»¶åŒ…ä¿®æ”¹composer.jsonæ–‡ä»¶,åœ¨requireèŠ‚ç‚¹ä¸­æ·»åŠ ä¸€è¡Œï¼š &quot;sylius/shop-api-plugin&quot;: &quot;^1.0.0@beta&quot; ç„¶åï¼Œæ‰§è¡Œï¼š 1$ composer.phar update è¾“å‡ºç»“æœä¸ºï¼š ä»è¾“å‡ºä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼š å®‰è£…äº†sylius/shop-api-plugin (v1.0.0-beta.20) å®‰è£…äº†ä¾èµ–åº“: â€˜league/tacticianâ€™ â€˜league/tactician-doctrineâ€™ â€˜league/tactician-bundleâ€™ æ›´æ–°äº†ä¸€äº›ä¾èµ–åŒ… æ‰©å±•é…ç½®æ–‡ä»¶æ·»åŠ SyliusShopApiåˆ°AppKernel 12345678910111213141516// app/AppKernel.php /** * &#123;@inheritdoc&#125; */ public function registerBundles() &#123; $bundles = [ // ... new \\Sylius\\ShopApiPlugin\\ShopApiPlugin(), new \\League\\Tactician\\Bundle\\TacticianBundle(), ]; return array_merge(parent::registerBundles(), $bundles); &#125; app/config/config.yml æ·»åŠ  - { path: &#39;^/shop-api&#39;, priorities: [&#39;json&#39;], fallback_format: json, prefer_extension: true } åˆ° fos_rest.format_listener.rulesèŠ‚ å¯¼å…¥æ’ä»¶é…ç½® 12345678910111213141516# app/config/config.ymlimports: # ... - &#123; resource: \"@ShopApiPlugin/Resources/config/app/config.yml\" &#125;# ...fos_rest: # ... format_listener: rules: - &#123; path: '^/shop-api', priorities: ['json'], fallback_format: json, prefer_extension: true &#125; # &lt;-- Add this - &#123; path: '^/api', priorities: ['json', 'xml'], fallback_format: json, prefer_extension: true &#125; - &#123; path: '^/', stop: true &#125; æ·»åŠ è·¯ç”±åˆ° app/config/routing.yml123456# app/config/routing.yml# ...sylius_shop_api: resource: \"@ShopApiPlugin/Resources/config/routing.yml\" é…ç½®é˜²ç«å¢™ æ”¹å˜sylius.security.shop_regexå‚æ•°ä¹ŸåŒ…å«shop-apiå‰ç¼€ æ·»åŠ ShopAPIæ­£åˆ™è¡¨è¾¾å¼å‚æ•°shop_api.security.regex: &quot;^/shop-apiâ€ æ·»åŠ ShopAPIé˜²ç«å¢™é…ç½®: 12345678910111213141516parameters: # ... sylius.security.shop_regex: \"^/(?!admin|api|shop-api)[^/]++\" # shop-api has been added inside the brackets shop_api.security.regex: \"^/shop-api\"# ...security: firewalls: // ... shop_api: pattern: \"%shop_api.security.regex%\" stateless: true anonymous: true è°ƒæ•´ç­¾å‡ºé…ç½®é¿å…ä¸Sylius shop APIå‘ç”Ÿå†²çªã€‚ä¾‹å¦‚(å‡è®¾ï¼Œæ‚¨æ­£åœ¨ä½¿ç”¨å¸¸è§„çš„Syliuså®‰å…¨å®šä¹‰): 1234567# app/config/config.yml# ...sylius_shop: checkout_resolver: pattern: \"%sylius.security.shop_regex%/checkout/\" (å¯é€‰)è·¨æºAjaxè¯·æ±‚å¦‚æœæ‚¨å·²ç»å®‰è£…äº†nelmio/NelmioCorsBundleä»¥æ”¯æŒè·¨æºAjaxè¯·æ±‚ å°†NelmioCorsBundleæ·»åŠ åˆ°AppKernelä¸­ 1234567891011121314// app/AppKernel.php/** * &#123;@inheritdoc&#125; */public function registerBundles()&#123; $bundles = array( // ... new Nelmio\\CorsBundle\\NelmioCorsBundle(), // ... ); // ...&#125; å°†é…ç½®æ·»åŠ åˆ°config.ymlä¸­ 123456789101112131415161718192021# app/config/config.yml# ...nelmio_cors: defaults: allow_credentials: false allow_origin: [] allow_headers: [] allow_methods: [] expose_headers: [] max_age: 0 hosts: [] origin_regex: false forced_allow_origin_value: ~ paths: '^/shop-api/': allow_origin: ['*'] allow_headers: ['Content-Type', 'authorization'] allow_methods: ['POST', 'PUT', 'GET', 'DELETE', 'OPTIONS'] max_age: 3600 é™„åŠ åŠŸèƒ½å±æ€§å¦‚æœæ‚¨æƒ³è¦æ¥æ”¶åºåˆ—åŒ–çš„å±æ€§ï¼Œæ‚¨éœ€è¦åœ¨shop_api.included_attributesé”®ä¸‹å®šä¹‰ä¸€ä¸ªä»–ä»¬çš„ä»£ç æ•°ç»„ã€‚å¦‚: 123shop_api: included_attributes: - \"MUG_MATERIAL_CODE\" æˆæƒé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æä¾›æ­¤bundleçš„æˆæƒã€‚ä½†æ˜¯ä¸ºäº†æ ·ä¾‹é…ç½®æ£€æŸ¥ï¼Œå®ƒè¢«æµ‹è¯•ä¸LexikJWTAuthenticationBundleä¸€èµ·å·¥ä½œ security.yml 1234567891011121314151617181920212223242526272829303132333435363738394041# app/config/security.ymlparameters: ... shop_api.security.regex: \"^/shop-api\"security: ... firewalls: ... shop_api_login: pattern: \"%shop_api.security.regex%/login\" stateless: true anonymous: true form_login: provider: sylius_shop_user_provider login_path: shop_api_login_check check_path: shop_api_login_check success_handler: lexik_jwt_authentication.handler.authentication_success failure_handler: lexik_jwt_authentication.handler.authentication_failure require_previous_session: false shop_api: pattern: \"%shop_api.security.regex%\" stateless: true anonymous: true guard: authenticators: - lexik_jwt_authentication.jwt_token_authenticator ... ... access_control: ... - &#123; path: \"%shop_api.security.regex%/login\", role: IS_AUTHENTICATED_ANONYMOUSLY &#125; - &#123; path: \"%shop_api.security.regex%/register\", role: IS_AUTHENTICATED_ANONYMOUSLY &#125; åœ¨config.ymlä¸­çš„jwt parameterså’Œjwté…ç½® 123456789101112parameters: secret: \"Heron is the best animal in the world!\" jwt_private_key_path: '%kernel.root_dir%/config/jwt/private-test.pem' jwt_public_key_path: '%kernel.root_dir%/config/jwt/public-test.pem' jwt_key_pass_phrase: 'heron' jwt_token_ttl: 3600lexik_jwt_authentication: private_key_path: '%jwt_private_key_path%' public_key_path: '%jwt_public_key_path%' pass_phrase: '%jwt_key_pass_phrase%' token_ttl: '%jwt_token_ttl%' rsa keysä¾‹å­ æµ‹è¯•åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡APIæµ‹è¯•ç”¨ä¾‹è¿›è¡Œæµ‹è¯•ã€‚ä¸ºäº†è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 1$ bin/phpunit Shop APIs1234567891011121314151617181920212223242526272829303132333435$ bin/console debug:router | grep shop-api shop_api_pickup_cart POST ANY ANY /shop-api/carts/&#123;token&#125; shop_api_cart_summary GET ANY ANY /shop-api/carts/&#123;token&#125; shop_api_add_to_cart POST ANY ANY /shop-api/carts/&#123;token&#125;/items shop_api_add_multiple_items_to_cart POST ANY ANY /shop-api/carts/&#123;token&#125;/multiple-items shop_api_drop_cart DELETE ANY ANY /shop-api/carts/&#123;token&#125; shop_api_change_item_quantity PUT ANY ANY /shop-api/carts/&#123;token&#125;/items/&#123;id&#125; shop_api_remove_item_from_cart DELETE ANY ANY /shop-api/carts/&#123;token&#125;/items/&#123;id&#125; shop_api_estimated_shipping_cost GET ANY ANY /shop-api/carts/&#123;token&#125;/estimated-shipping-cost shop_api_add_coupon_to_cart PUT ANY ANY /shop-api/carts/&#123;token&#125;/coupon shop_api_remove_coupon_to_cart DELETE ANY ANY /shop-api/carts/&#123;token&#125;/coupon shop_api_product_show_details_by_slug GET ANY ANY /shop-api/products-by-slug/&#123;slug&#125; shop_api_add_product_review_by_slug POST ANY ANY /shop-api/product-reviews-by-slug/&#123;slug&#125; shop_api_product_show_catalog_by_slug GET ANY ANY /shop-api/taxon-products-by-slug/&#123;taxonSlug&#125; shop_api_product_show_reviews_by_slug GET ANY ANY /shop-api/product-reviews-by-slug/&#123;slug&#125; shop_api_product_show_details_by_code GET ANY ANY /shop-api/products/&#123;code&#125; shop_api_product_show_catalog_by_code GET ANY ANY /shop-api/taxon-products/&#123;code&#125; shop_api_product_show_reviews_by_code GET ANY ANY /shop-api/products/&#123;code&#125;/reviews shop_api_add_product_review_by_code POST ANY ANY /shop-api/products/&#123;code&#125;/reviews shop_api_taxon_show_details GET ANY ANY /shop-api/taxons/&#123;code&#125; shop_api_taxon_show_tree GET ANY ANY /shop-api/taxons/ sylius_shop_api_register POST ANY ANY /shop-api/register sylius_shop_api_resend_verification_token POST ANY ANY /shop-api/resend-verification-link sylius_shop_api_user_verification PUT ANY ANY /shop-api/verify-account sylius_shop_api_reset_password PUT ANY ANY /shop-api/request-password-reset sylius_shop_password_reset PUT ANY ANY /shop-api/password-reset/&#123;token&#125; shop_api_address_checkout PUT ANY ANY /shop-api/checkout/&#123;token&#125;/address shop_api_summarize_checkout GET ANY ANY /shop-api/checkout/&#123;token&#125; shop_api_available_shipping_checkout GET ANY ANY /shop-api/checkout/&#123;token&#125;/shipping shop_api_choose_shipping_method PUT ANY ANY /shop-api/checkout/&#123;token&#125;/shipping/&#123;shippingId&#125; shop_api_available_payment_methods_checkout GET ANY ANY /shop-api/checkout/&#123;token&#125;/payment shop_api_choose_payment_method_checkout PUT ANY ANY /shop-api/checkout/&#123;token&#125;/payment/&#123;paymentId&#125; shop_api_complete_checkout PUT ANY ANY /shop-api/checkout/&#123;token&#125;/complete shop_api_me GET ANY ANY /shop-api/me shop_api_login_check POST ANY ANY /shop-api/login_check","categories":[{"name":"PHP","slug":"PHP","permalink":"https://jigangduan.github.io/categories/PHP/"},{"name":"Symfony","slug":"PHP/Symfony","permalink":"https://jigangduan.github.io/categories/PHP/Symfony/"},{"name":"ç”µå•†","slug":"PHP/Symfony/ç”µå•†","permalink":"https://jigangduan.github.io/categories/PHP/Symfony/ç”µå•†/"}],"tags":[{"name":"php","slug":"php","permalink":"https://jigangduan.github.io/tags/php/"},{"name":"symfony","slug":"symfony","permalink":"https://jigangduan.github.io/tags/symfony/"},{"name":"ç”µå•†","slug":"ç”µå•†","permalink":"https://jigangduan.github.io/tags/ç”µå•†/"}]},{"title":"Android ç½‘é¡µè·å–çŸ­ä¿¡éªŒè¯ç  å¯è¡Œæ€§é¢„ç ”","slug":"WebPage-Get-SMS","date":"2017-12-18T08:09:01.000Z","updated":"2020-07-25T02:57:18.171Z","comments":true,"path":"2017/12/18/WebPage-Get-SMS/","link":"","permalink":"https://jigangduan.github.io/2017/12/18/WebPage-Get-SMS/","excerpt":"ç›®æ ‡ï¼š Android ç½‘é¡µè·å–çŸ­ä¿¡éªŒè¯ç  ç›®å‰çŠ¶æ€ï¼š é¢„è¨€é˜¶æ®µï¼ˆæŠ€æœ¯ä¸Šæœªå®ç°ï¼‰","text":"ç›®æ ‡ï¼š Android ç½‘é¡µè·å–çŸ­ä¿¡éªŒè¯ç  ç›®å‰çŠ¶æ€ï¼š é¢„è¨€é˜¶æ®µï¼ˆæŠ€æœ¯ä¸Šæœªå®ç°ï¼‰ ç½‘é¡µç«¯æ–¹æ¡ˆï¼š Android WebKitæ’ä»¶å¼€å‘ SMS-BrowserPlugin æ–¹æ¡ˆæè¿°ï¼š WebKitæ’ä»¶åŒ…æ‹¬PluginServiceå’ŒPlugin.soåŠ¨æ€åº“, Plugin.soæä¾›ä¸WebKitçš„äº¤äº’ï¼Œæä¾›JSçš„æ¥å£ï¼›PluginServiceé™æ€æ³¨å†ŒWebKitæ’ä»¶actionï¼Œå®ç°çŸ­ä¿¡æ‹¦æˆªåŠŸèƒ½ã€‚ Androidç«¯æ‹¦æˆªçŸ­ä¿¡æ–¹æ¡ˆ æ–¹æ¡ˆä¸€ï¼š ç›‘å¬SMSå¹¿æ’­ æ–¹æ¡ˆäºŒï¼š NotificationListenserServicç›‘å¬Notificationsï¼Œè¿‡æ»¤çŸ­ä¿¡åº”ç”¨åŒ…åçš„é€šçŸ¥ä¿¡æ¯ è¿‡ç¨‹è®°å½•ï¼š ç ”ç©¶Android WebKitæ’ä»¶åŸç†åŠå®ç°æ–¹å¼ åˆ›å»ºç¤ºä¾‹Pluginé¡¹ç›® åŠ¨æ€åº“éœ€è¦Androidä¸­ç›¸å…³æ’ä»¶éƒ¨åˆ†æ¥å£å¤´æ–‡ä»¶ï¼Œå¯»æ‰¾å¤´æ–‡ä»¶ï¼Œä¸‹è½½åæ”¾å…¥é¡¹ç›®ä¸­ã€‚åˆéœ€è¦ä¾èµ–å…¶ä»–libå’Œå¤´æ–‡ä»¶ï¼Œä¾èµ–è¿‡é‡ï¼Œä¾èµ–æ–‡ä»¶æ— ä»æŸ¥èµ·ï¼Œæ”¾å¼ƒæ­¤æ–¹æ¡ˆï¼Œè¯¥ç”¨Androidæºç ä¸‹ç¼–è¯‘æ–¹å¼ Androidæºç ä¸‹ç¼–è¯‘æ–¹å¼ å®‰è£…è™šæ‹ŸæœºUbuntuç¯å¢ƒï¼Œå®‰è£…SSH-Server,Samba å®‰è£…JDK1.6åŠAndroidç¼–è¯‘æ‰€éœ€è¦çš„ä¾èµ–åº“ï¼ˆJDKç‰ˆæœ¬å’Œä¾èµ–ç¯å¢ƒéœ€è¦ä¸è¦ç¼–è¯‘çš„Androidç‰ˆæœ¬ç›¸å…³ï¼‰ å®‰è£…repo ä¸‹è½½android-4.0_r1æºç ï¼ˆç¿»å¢™ä¸‹è½½é€Ÿåº¦è¿‡æ…¢ï¼Œä½¿ç”¨ä¸­ç§‘å¤§é•œåƒã€‚ä¸‹è½½ä¸­ç”±äºç½‘é€Ÿä¸ç¨³å®šé—®é¢˜ï¼Œå®¹æ˜“å¡ä½ï¼Œå¡ä½åæ²¡æœ‰ä»»ä½•ååº”ï¼Œéœ€è¦åœæ­¢å†é‡æ–°ä¸‹è½½ï¼‰ ä¸‹è½½åä»“åº“å’Œå·¥ä½œåŒºæºç å®¹é‡è¿‘80Gï¼Œç¼–è¯‘å­˜å‚¨ç©ºé—´æº¢å‡ºï¼Œåˆ é™¤æ‰ä»“åº“.repoï¼Œè¿›å‰©ä¸‹æºç éƒ¨åˆ† ç¼–è¯‘æºç  ç¼–è¯‘SampleBrowserPluginï¼Œç”ŸæˆSampleBrowserPlugin.apkå’ŒSampleBrowserPlugin.odex åˆå¹¶.apkå’Œ.odex ï¼ˆSampleBrowserPlugin.apkæ— æ³•ç›´æ¥å®‰è£…ï¼Œåˆå¹¶.apkå’Œ.odexï¼Œå†æ‰“åŒ…é‡æ–°ç­¾åã€‚ä½†å®‰è£…è¿˜æ˜¯æŠ¥é”™ï¼‰ ä½¿ç”¨æºç ç¼–è¯‘çš„åŠ¨æ€åº“ è§£å‹ç¼©.apkï¼Œå¾—åˆ°åŠ¨æ€åº“armeabi-v7a/libsampleplugin.so æ–‡ä»¶ å°†libsampleplugin.soåŠ å…¥åˆ°ç¤ºä¾‹Pluginé¡¹ç›®ä¸­ ç¼–è¯‘é¡¹ç›®ç”ŸæˆAPKï¼Œå®‰è£…åº”ç”¨å¹¶å¯åŠ¨ ç¼–å†™HTMLæ–‡ä»¶ï¼ŒåŒ…å«æ’ä»¶ç›¸å…³å‚æ•°çš„å¯¹è±¡ æ¨å…¥è®¾å¤‡çš„SDCardä¸­ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€(ç»“æœè¿˜æ˜¯æ’ä»¶æ— æ³•åŠ è½½) ç¼–è¯‘é¡¹ç›®ç”ŸæˆAPKï¼Œå®‰è£…åº”ç”¨å¹¶å¯åŠ¨ è„šæœ¬ä½¿ç”¨æ’ä»¶å¯¹è±¡ ç¼–å†™HTMLæ–‡ä»¶ï¼ŒåŒ…å«æ’ä»¶ç›¸å…³å‚æ•°çš„å¯¹è±¡ æ¨å…¥è®¾å¤‡çš„SDCardä¸­ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€(ç»“æœè¿˜æ˜¯æ’ä»¶æ— æ³•åŠ è½½) ç›®å‰é‡åˆ°çš„é—®é¢˜ï¼š æ’ä»¶æ— æ³•è¢«æµè§ˆå™¨æ­£å¸¸çš„åŠ è½½ åç»­æ–¹å‘ï¼š åˆ†æWeb APIæ˜¯å¦æœ‰å¯¹åº”çš„æ¥å£ ä¸å¯è¡Œ, åˆ†æWebExtensionæ˜¯å¦å¯è¡Œ ä¸å¯è¡Œï¼ŒWebExtensionç”±HTMLã€CSSã€JSæ„æˆï¼Œä¸èƒ½è®¿é—®AndroidåŸç”Ÿæ¥å£ å€ŸåŠ©æœåŠ¡å™¨ä¸­è½¬ å‚è€ƒæ–‡æ¡£ï¼š Androidæµè§ˆå™¨æ’ä»¶å¼€å‘ android æµè§ˆå™¨æ’ä»¶å¼€å‘ å¼€å‘è€…éœ€è¦äº†è§£çš„WebKit Android Webkitæ’ä»¶ è§£æAndroid WebKitæ’ä»¶åŸºæœ¬ç»“æ„ æ·±å…¥ç†è§£Androidï¼šWebKitå· Android WebKitæ’ä»¶çš„åŸºæœ¬ç»“æ„ AndroidçŸ­ä¿¡æ‹¦æˆªæœºåˆ¶é€‚é…çš„å‘(ä¸‹)â€“4.4ä»¥ä¸Šç³»ç»Ÿï¼Œä¸»è¦æ˜¯6.0 AndroidçŸ­ä¿¡æ‹¦æˆªæœºåˆ¶é€‚é…çš„å‘(ä¸Š)â€“4.4ä»¥ä¸‹ç³»ç»Ÿ AndroidXRef Android æ¸…åå¤§å­¦é•œåƒ ä¸‹è½½Androidæºä»£ç é”™è¯¯æ±‡æ€»åˆ†æ ä½ çœŸçš„ç†è§£AccessibilityServiceå— æ·±å…¥ç†è§£SELinux SEAndroidï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰ Android å¼€æºé¡¹ç›®æŒ‡å— ã€androidæºç ã€‘ç¼–è¯‘android Mæºç ã€åˆ·æœºï¼Œå¼€å¯æºç å­¦ä¹ çš„First Step å¦‚ä½•åˆ©ç”¨æ‹¦æˆªé©¬å®ç°çŸ­ä¿¡æ‹¦æˆª å¾®ä¿¡æŠ¢çº¢åŒ…å¤–æŒ‚æºç  6.0çŸ­ä¿¡ç›‘å¬ GetSMSDemo PermissionGen NotificationListenerServiceä¸èƒ½ç›‘å¬åˆ°é€šçŸ¥ï¼Œç ”ç©¶äº†ä¸€å¤©ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ å®‰å“é€šçŸ¥æ ç®¡ç†è¯¦è§£åŠåˆ†æ NotificationListenerService","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"é¢„ç ”","slug":"Android/é¢„ç ”","permalink":"https://jigangduan.github.io/categories/Android/é¢„ç ”/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"}]},{"title":"Androidä¸­odexå’Œapkæ–‡ä»¶çš„åˆå¹¶æ–¹æ³•","slug":"merge-odex-apk","date":"2017-12-14T03:48:01.000Z","updated":"2020-07-25T02:57:18.212Z","comments":true,"path":"2017/12/14/merge-odex-apk/","link":"","permalink":"https://jigangduan.github.io/2017/12/14/merge-odex-apk/","excerpt":"Android Romä¸­çš„APKæ˜¯è¢«åˆ†å¼€çš„ï¼Œåˆ†ä¸ºapkå’Œodexã€‚APKä¸­çš„dexè¢«åˆ†ç¦»å‡ºæ¥æˆäº†å•ç‹¬çš„æ–‡ä»¶odex,åŒ…æ‹¬äº†Javaç¼–è¯‘çš„æ–‡ä»¶ï¼Œè€ŒapkåŒ…å«äº†èµ„æºæ–‡ä»¶å’Œ.soã€‚ è¿™æ ·åšå¯ä»¥ä½¿å…¶å‚å•†ä¿è¯ä¸€å®šçš„åç›—ç‰ˆï¼Œå› ä¸ºæ²¡æœ‰dexæ–‡ä»¶çš„apkæ˜¯æ— æ³•æ­£å¸¸å®‰è£…çš„ï¼Œè€Œå‚å•†ç›´æ¥å°†odexå’Œä¸å®Œæ•´çš„apkæ–‡ä»¶æ”¾åˆ°æ‰‹æœºromå›ºåŒ–åˆ°/system/binä¸­å¯ä»¥è®©ä¸€èˆ¬ç”¨æˆ·æ— æ³•æ­£å¸¸å¯¼å‡ºä½¿ç”¨ã€‚ å¯èƒ½æƒ³åˆ°çš„æ˜¯åˆå¹¶odexå’Œapkå˜æˆapkä¸­åŒ…å«dexæ–‡ä»¶çš„ï¼Œè¿™æ ·åˆå¹¶åæœ€ç»ˆapkæ–‡ä»¶å®‰è£…åœ¨/data/ä¸­ï¼Œè€Œromå­˜æ”¾åœ¨ /system/appä¸­ï¼Œæ‰€ä»¥æœ€ç»ˆå¯¼è‡´äº†ç”¨æˆ·å¯è£…åœ¨Androidæ‰‹æœºä¸­çš„è½¯ä»¶ä¼šå˜å°‘ï¼Œå ç”¨ç³»ç»Ÿç©ºé—´ã€‚ ä¸‹é¢ä»‹ç»å¦‚ä½•é‡æ–°æ‰“åŒ…å’Œç­¾åçš„æ–¹æ³•ï¼š","text":"Android Romä¸­çš„APKæ˜¯è¢«åˆ†å¼€çš„ï¼Œåˆ†ä¸ºapkå’Œodexã€‚APKä¸­çš„dexè¢«åˆ†ç¦»å‡ºæ¥æˆäº†å•ç‹¬çš„æ–‡ä»¶odex,åŒ…æ‹¬äº†Javaç¼–è¯‘çš„æ–‡ä»¶ï¼Œè€ŒapkåŒ…å«äº†èµ„æºæ–‡ä»¶å’Œ.soã€‚ è¿™æ ·åšå¯ä»¥ä½¿å…¶å‚å•†ä¿è¯ä¸€å®šçš„åç›—ç‰ˆï¼Œå› ä¸ºæ²¡æœ‰dexæ–‡ä»¶çš„apkæ˜¯æ— æ³•æ­£å¸¸å®‰è£…çš„ï¼Œè€Œå‚å•†ç›´æ¥å°†odexå’Œä¸å®Œæ•´çš„apkæ–‡ä»¶æ”¾åˆ°æ‰‹æœºromå›ºåŒ–åˆ°/system/binä¸­å¯ä»¥è®©ä¸€èˆ¬ç”¨æˆ·æ— æ³•æ­£å¸¸å¯¼å‡ºä½¿ç”¨ã€‚ å¯èƒ½æƒ³åˆ°çš„æ˜¯åˆå¹¶odexå’Œapkå˜æˆapkä¸­åŒ…å«dexæ–‡ä»¶çš„ï¼Œè¿™æ ·åˆå¹¶åæœ€ç»ˆapkæ–‡ä»¶å®‰è£…åœ¨/data/ä¸­ï¼Œè€Œromå­˜æ”¾åœ¨ /system/appä¸­ï¼Œæ‰€ä»¥æœ€ç»ˆå¯¼è‡´äº†ç”¨æˆ·å¯è£…åœ¨Androidæ‰‹æœºä¸­çš„è½¯ä»¶ä¼šå˜å°‘ï¼Œå ç”¨ç³»ç»Ÿç©ºé—´ã€‚ ä¸‹é¢ä»‹ç»å¦‚ä½•é‡æ–°æ‰“åŒ…å’Œç­¾åçš„æ–¹æ³•ï¼š é‡æ–°æ‰“åŒ…ä¸‹è½½ç¼–è¯‘å’Œåç¼–è¯‘å·¥å…·: smaliå’Œbaksmaliï¼šä¸‹è½½åœ°å€ï¼šhttps://bitbucket.org/JesusFreke/smali/downloads/ å°†ROMä¸­çš„frameworkä¸­çš„æ–‡ä»¶å…¨å¤åˆ¶å‡ºæ¥1$ cp /home/jigangduan/android/out/target/product/generic/system/framework/*.* boot/ é€šè¿‡odexç”Ÿæˆclassæ–‡ä»¶1java -jar ../smail/baksmali-2.0.jar -x -d boot/ 111.odex åç¼–è¯‘ç”Ÿæˆï¼š 123456789101112131415161718out/â””â”€â”€ com â””â”€â”€ android â””â”€â”€ sampleplugin â”œâ”€â”€ AnimationSurface.smali â”œâ”€â”€ BackgroundSurface.smali â”œâ”€â”€ BackgroundTest.smali â”œâ”€â”€ graphics â”‚ â”œâ”€â”€ CubeRenderer.smali â”‚ â””â”€â”€ Cube.smali â”œâ”€â”€ PaintSurface$1.smali â”œâ”€â”€ PaintSurface.smali â”œâ”€â”€ R$attr.smali â”œâ”€â”€ R$drawable.smali â”œâ”€â”€ R.smali â”œâ”€â”€ R$string.smali â”œâ”€â”€ SamplePlugin.smali â””â”€â”€ VideoSurface.smali é€šè¿‡classç”Ÿæˆclasses.dex æ–‡ä»¶1$ java -Xmx512M -jar ../smail/smali-2.0.jar out -o classes.dex å°†classes.dexæ”¾åˆ°apkæ–‡ä»¶12345678$ zip -m 111.apk classes.dexzip I/O error: Permission deniedzip error: Could not create output file (111.apk)$ sudo chmod +w 111.apk$ zip -m 111.apk classes.dex adding: classes.dex (deflated 52%) æ‰“åŒ…é‡æ–°ç­¾åç”Ÿæˆè¯ä¹¦ *.keystore12345678910111213141516171819202122$ keytool -genkeypair -alias mydemo.keystore -keyalg RSA -validity 100 -keystore mydemo.keystoreEnter keystore password: Keystore password is too short - must be at least 6 charactersEnter keystore password: Re-enter new password:What is your first and last name? [Unknown]: 111What is the name of your organizational unit? [Unknown]: logitWhat is the name of your organization? [Unknown]: logitWhat is the name of your City or Locality? [Unknown]: changshaWhat is the name of your State or Province? [Unknown]: hnWhat is the two-letter country code for this unit? [Unknown]: chIs CN=111, OU=logit, O=logit, L=changsha, ST=hn, C=ch correct? [no]: yEnter key password for &lt;mydemo.keystore&gt;(RETURN if same as keystore password): ç»™apkç­¾å12345678910111213$ jarsigner -verbose -keystore mydemo.keystore -signedjar 111_ca.apk 111.apk mydemo.keystoreEnter Passphrase for keystore: updating: META-INF/MANIFEST.MF adding: META-INF/MYDEMO_K.SF adding: META-INF/MYDEMO_K.RSA signing: AndroidManifest.xml signing: lib/armeabi-v7a/libsampleplugin.so signing: res/drawable-mdpi/sample_browser_plugin.png signing: resources.arsc signing: classes.dexWarning:The signer certificate will expire within six months.","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"é€†å‘","slug":"Android/é€†å‘","permalink":"https://jigangduan.github.io/categories/Android/é€†å‘/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"é€†å‘","slug":"é€†å‘","permalink":"https://jigangduan.github.io/tags/é€†å‘/"},{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","permalink":"https://jigangduan.github.io/tags/åç¼–è¯‘/"}]},{"title":"MySQLç®€å•æ“ä½œ(11)-ç®¡ç†å·¥å…·","slug":"my-common-grammar11","date":"2017-12-09T08:25:25.000Z","updated":"2020-07-25T02:57:18.216Z","comments":true,"path":"2017/12/09/my-common-grammar11/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar11/","excerpt":"","text":"phpMyAdminNavicat for MySQLMySQL Workbench","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(10)-å­˜å‚¨å¼•æ“","slug":"my-common-grammar10","date":"2017-12-09T07:25:25.000Z","updated":"2020-07-25T02:57:18.216Z","comments":true,"path":"2017/12/09/my-common-grammar10/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar10/","excerpt":"","text":"æŸ¥çœ‹æ•°æ®è¡¨çš„åˆ›å»ºå‘½ä»¤ï¼š 1SHOW CREATE table tal_name MySQLå¯ä»¥å°†æ•°æ®ä»¥ä¸åŒçš„æŠ€æœ¯å­˜å‚¨åœ¨æ–‡ä»¶ï¼ˆå†…å­˜ï¼‰ä¸­ï¼Œè¿™ç§æŠ€æœ¯å°±ç§°ä¸ºå­˜å‚¨å¼•æ“ æ¯ä¸€ç§å­˜å‚¨å¼•æ“ä½¿ç”¨ä¸åŒçš„å­˜å‚¨æœºåˆ¶ï¼Œç´¢å¼•æŠ€å·§ï¼Œé”å®šæ°´å¹³ï¼Œæœ€ç»ˆæä¾›å¹¿æ³›ä¸”ä¸åŒçš„åŠŸèƒ½ MySQLæ”¯æŒç±»å‹ï¼š MyISAM InnoDB Memory CSV Archive å¹¶å‘æ§åˆ¶å½“å¤šä¸ªè¿æ¥å¯¹è®°å½•è¿›è¡Œä¿®æ”¹æ—¶ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ é” å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼šåœ¨åŒä¸€æ—¶é—´æ®µå†…ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥è¯»å–åŒä¸€ä¸ªèµ„æºï¼Œè¯»å–è¿‡ç¨‹ä¸­æ•°æ®ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ– æ’ä»–é”ï¼ˆå†™é”ï¼‰ï¼šåœ¨ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªå†™å…¥èµ„æºï¼Œå½“è¿›è¡Œå†™é”æ—¶ä¼šé˜»å¡å…¶ä»–çš„è¯»é”æˆ–è€…å†™é”æ“ä½œ é”é¢—ç²’ è¡¨é”ï¼Œæ˜¯ä¸€ç§å¼€é”€æœ€å°çš„é”ç­–ç•¥ è¡Œé”ï¼Œæ˜¯ä¸€ç§å¼€é”€æœ€å¤§çš„é”ç­–ç•¥ äº‹åŠ¡å¤„ç†äº‹åŠ¡ç”¨äºä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§ äº‹åŠ¡çš„ç‰¹æ€§ï¼š åŸå­æ€§(Atomicity) ä¸€è‡´æ€§(Consistency) éš”ç¦»æ€§(Isolation) æŒä¹…æ€§(Durability) å¤–é”®å’Œç´¢å¼• å¤–é”® æ˜¯ä¿éšœæ•°æ®ä¸€è‡´æ€§çš„ç­–ç•¥ ç´¢å¼• æ˜¯å¯¹æ•°æ®è¡¨ä¸­ä¸€åˆ—æˆ–å¤šåˆ—çš„å€¼è¿›è¡Œæ’åºçš„ä¸€ç§ç»“æ„ å­˜å‚¨å¼•æ“ç‰¹ç‚¹ç‰¹ç‚¹ | MyISAM | InnoDB | Memory | Archiveå­˜å‚¨é™åˆ¶ | 256TB | 64TB | æœ‰ | æ— äº‹åŠ¡å®‰å…¨ | - | æ”¯æŒ | - | -æ”¯æŒç´¢å¼• | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | -é”é¢—ç²’ | è¡¨é” | è¡Œé” | è¡¨é” | è¡Œé”æ•°æ®å‹ç¼© | æ”¯æŒ | - | - | æ”¯æŒæ”¯æŒå¤–é”® | - | æ”¯æŒ | - | - ç´¢å¼•ï¼š æ™®é€šç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•ï¼Œå…¨æ–‡ç´¢å¼•ï¼Œbtreeç´¢å¼•ï¼Œhashç´¢å¼• â€¦â€¦ è®¾ç½®å­˜å‚¨å¼•æ“ é€šè¿‡ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶å®ç° 1default-storage-engine = engine é€šè¿‡åˆ›å»ºæ•°æ®è¡¨å‘½ä»¤å®ç° 1234CREATE TABLE table_name( ... ...) ENGINE = engine; é€šè¿‡ä¿®æ”¹æ•°æ®è¡¨å‘½ä»¤å®ç° 1ALTER TABLE table_name ENGINE [=] engine_name;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(9)-MySQLå­˜å‚¨è¿‡ç¨‹","slug":"my-common-grammar9","date":"2017-12-09T06:25:25.000Z","updated":"2020-07-25T02:57:18.218Z","comments":true,"path":"2017/12/09/my-common-grammar9/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar9/","excerpt":"","text":"SQLå‘½ä»¤ â€“&gt; MySQLå¼•æ“ -åˆ†æ-&gt; è¯­æ³•æ­£ç¡® â€“&gt; å¯è¯†åˆ«å‘½ä»¤ -æ‰§è¡Œ-&gt; æ‰§è¡Œç»“æœ -è¿”å›-&gt; å®¢æˆ·ç«¯ å­˜å‚¨è¿‡ç¨‹æ˜¯SQLè¯­å¥å’Œæ§åˆ¶è¯­å¥çš„é¢„ç¼–è¯‘é›†åˆï¼Œä»¥ä¸€ä¸ªåç§°å­˜å‚¨å¹¶ä½œä¸ºä¸€ä¸ªå•å…ƒå¤„ç† ä¼˜ç‚¹ï¼š å¢å¼ºSQLè¯­å¥çš„åŠŸèƒ½å’Œçµæ´»æ€§ å®ç°è¾ƒå¿«çš„æ‰§è¡Œé€Ÿåº¦ å‡å°‘ç½‘ç»œæµé‡ å­˜å‚¨è¿‡ç¨‹è¯­æ³•ç»“æ„è§£æ1234567CREATE[DEFINER = &#123; user | CURRENT_USER&#125;]PROCEDURE sp_name([proc_parameter[,...]])[characteristic ...] routine_bodyproc_parameter:[IN | OUT | INOUT] param_name type å‚æ•° INï¼Œ è¡¨ç¤ºè¯¥å‚æ•°çš„å€¼å¿…é¡»åœ¨è°ƒç”¨å­˜å‚¨è¿‡ç¨‹æ—¶æŒ‡å®š OUTï¼Œ è¡¨ç¤ºè¯¥å‚æ•°çš„å€¼å¯ä»¥è¢«å­˜å‚¨è¿‡ç¨‹æ”¹å˜ï¼Œå¹¶ä¸”å¯ä»¥è¿”å› INOUTï¼Œ è¡¨ç¤ºè¯¥å‚æ•°çš„è°ƒç”¨æ—¶æŒ‡å®šï¼Œå¹¶ä¸”å¯ä»¥è¢«æ”¹å˜å’Œè¿”å› ç‰¹æ€§123COMMENT 'string'| &#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA&#125;| SQL SECURITY &#123; DEFINER | INVOKER &#125; COMMENT: æ³¨é‡Š CONTAINS SQLï¼šåŒ…å«SQLè¯­å¥ï¼Œä½†ä¸åŒ…å«è¯»æˆ–å†™æ•°æ®çš„è¯­å¥ NO SQLï¼šä¸åŒ…å«SQLè¯­å¥ READS SQL DATAï¼šåŒ…å«è¯»æ•°æ®çš„è¯­å¥ MODIFIES SQL DATAï¼šåŒ…å«å†™æ•°æ®çš„è¯­å¥ SQL SECURITY { DEFINER | INVOKER } æŒ‡æ˜è°æœ‰æƒé™æ¥æ‰§è¡Œ è¿‡ç¨‹ä½“ ç”±åˆæ³•çš„SQLè¯­å¥æ„æˆ å¯ä»¥æ˜¯ä»»æ„çš„SQLè¯­å¥ï¼ˆä¸èƒ½åˆ›å»ºæ•°æ®åº“å’Œè¡¨ï¼‰ å¦‚æœä¸ºå¤åˆç»“æ„åˆ™ä½¿ç”¨BEGINâ€¦ENDè¯­å¥ å¤åˆç»“æ„å¯ä»¥åŒ…å«å£°æ˜ï¼Œå¾ªç¯ï¼Œæ§åˆ¶ç»“æ„ è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ CALL sp_name([parameter[,â€¦]]) CALL sp_name[()] åˆ é™¤å­˜å‚¨è¿‡ç¨‹1DROP PROCEDURE [IF EXISTS] sp_name åˆ›å»ºä¸å¸¦å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹1CREATE PROCEDURE sp1 SELECT VERSION(); åˆ›å»ºå¸¦INç±»å‹å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹ä¸¾ä¾‹ï¼š 123456DELIMITER //CREATE PROCEDURE removeUserById(IN p_id INT UNSIGNED)BEGINDELETE FROM users WHERE id = p_id;END// åˆ›å»ºå¸¦INå’ŒOUTç±»å‹å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹ä¸¾ä¾‹ï¼š 12345678910DELIMITER //CREATE PROCEDURE removeUserAndReturnUserNums(IN p_id INT UNSIGNED, OUT userNums INT UNSIGNED)BEGINDELETE FROM users WHERE id = p_id;SELECT count(id) FROM users INTO userNums;END//DELIMITER ; 1CALL removeUserAndReturnUserNums(27, @nums); åˆ›å»ºå¸¦å¤šä¸ªOUTç±»å‹å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹ä¸¾ä¾‹ï¼š 1234567891011DELIMITER //CREATE PROCEDURE removeUserByAgeAndReturnUserNums(IN p_age SMALLINT UNSIGNED, OUT deleteUsers SMALLINT UNSIGNED, OUT userCounts SMALLINT UNSIGNED)BEGINDELETE FROM users WHERE age = p_age;SELECT ROW_COUNT() INTO deleteUsers;SELECT COUNT(ID) INTO userCounts;END//DELIMITER ; ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹1234ALTER PROCEDURE sp_name [characteristic ...]COMMENT 'string'| &#123; CONTAINS SQL | NO SQL | READA SQL DATA | MODIFIES SQL DATA&#125;| SQL SECURITY &#123; DEFINER | INVOKER &#125; å­˜å‚¨è¿‡ç¨‹ä¸è‡ªå®šä¹‰å‡½æ•°çš„åŒºåˆ« å­˜å‚¨è¿‡ç¨‹å®ç°çš„åŠŸèƒ½å¤æ‚ä¸€äº›ï¼›è€Œå‡½æ•°çš„é’ˆå¯¹æ€§æ›´å¼º å­˜å‚¨è¿‡ç¨‹å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼›å‡½æ•°åªèƒ½æœ‰ä¸€ä¸ªè¿”å›å€¼ å­˜å‚¨è¿‡ç¨‹ä¸€èˆ¬ç‹¬ç«‹çš„æ¥æ‰§è¡Œï¼›è€Œå‡½æ•°å¯ä»¥ä½œä¸ºå…¶ä»–SQLè¯­å¥çš„ç»„æˆéƒ¨åˆ†å‡ºç°","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(8)-è‡ªå®šä¹‰å‡½æ•°","slug":"my-common-grammar8","date":"2017-12-09T05:25:25.000Z","updated":"2020-07-25T02:57:18.217Z","comments":true,"path":"2017/12/09/my-common-grammar8/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar8/","excerpt":"","text":"ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°(user-defined function, UDF)æ˜¯ä¸€ç§å¯¹MySQLæ‰©å±•çš„é€”å¾„ï¼Œå…¶ç”¨æ³•ä¸å†…ç½®å‡½æ•°ç›¸åŒ åˆ›å»ºè‡ªå®šä¹‰å‡½æ•° 1234CREATE FUNCTION function_nameRETURNS&#123;STRING|INTEGER|REAL|DECIMAL&#125;routine_body å‡½æ•°ä½“ ç”±åˆæ³•çš„SQLè¯­å¥æ„æˆ å¯ä»¥æ˜¯ç®€å•çš„SELECTæˆ–INSERTè¯­å¥ å¦‚æœä¸ºå¤åˆç»“æ„åˆ™ä½¿ç”¨BEGINâ€¦ENDè¯­å¥ å¤åˆç»“æ„å¯ä»¥åŒ…å«å£°æ˜ï¼Œå¾ªç¯ï¼Œæ§åˆ¶ç»“æ„ åˆ›å»ºä¸å¸¦å‚æ•°çš„è‡ªå®šä¹‰å‡½æ•°ä¸¾ä¾‹ï¼š 12CREATE FUNCTION f1() RETRUNS VARCHAR(30)RETURN DATE_FORMAT(NOW(), '%Yå¹´%mæœˆ%dæ—¥ %Hç‚¹:%iåˆ†:%sç§’'); åˆ›å»ºå¸¦å‚æ•°çš„è‡ªå®šä¹‰å‡½æ•°123CREATE FUNCTION f2(num1 SMALLINT UNSIGNED, num2 SMALLINT UNSIGNED)RETURNS FLOAT(10,2) UNSIGNEDRETURN (num+num2)/2; åˆ é™¤è‡ªå®šä¹‰å‡½æ•°1DROP FUNCTION function_name; åˆ›å»ºå…·æœ‰å¤åˆç»“æ„å‡½æ•°ä½“çš„è‡ªå®šä¹‰å‡½æ•°123456CREATE FUNCTION adduser(username VARCHAR(20))RETURNS INT UNSIGNEDBEGININSERT test(username) VALUES(username);RETURN LAST_INSERT_ID();END//","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(7)-è¿ç®—ç¬¦å’Œå‡½æ•°","slug":"my-common-grammar7","date":"2017-12-09T04:25:25.000Z","updated":"2020-07-25T02:57:18.217Z","comments":true,"path":"2017/12/09/my-common-grammar7/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar7/","excerpt":"","text":"å­—ç¬¦å‡½æ•° å‡½æ•°å æè¿° CONCAT() å­—ç¬¦è¿æ¥ CONCAT_WS() ä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦è¿›è¡Œå­—ç¬¦è¿æ¥ FORMAT() æ•°å­—æ ¼å¼åŒ– LOWER() è½¬æ¢æˆå°å†™å­—æ¯ UPPER() è½¬æ¢æˆå¤§å†™å­—æ¯ LEFT() è·å–å·¦ä¾§å­—ç¬¦ RIGHT() è·å–å³ä¾§å­—ç¬¦ LENGTH() è·å–å­—ç¬¦ä¸²é•¿åº¦ LTRIM() åˆ é™¤å‰å¯¼ç©ºæ ¼ RTRIM() åˆ é™¤åå¯¼ç©ºæ ¼ TRIM() åˆ é™¤å‰å¯¼ç©ºæ ¼å’Œåå¯¼ç©ºæ ¼ SUBSTRING() å­—ç¬¦ä¸²æˆªå– [NOT] LIKE æ¨¡å¼åŒ¹é…(%ä»£è¡¨0æˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼›_ä»£è¡¨ä»»æ„ä¸€ä¸ªå­—ç¬¦) REPLACE() å­—ç¬¦ä¸²æ›¿æ¢ æ•°å€¼è¿ç®—ç¬¦å’Œå‡½æ•° å‡½æ•°å æè¿° CEIL() è¿›ä¸€å–æ•´ DIV æ•´æ•°é™¤æ³• FLOOR() èˆä¸€å–æ•´ MOD å–ä½™æ•°(å–æ¨¡) POWER() å¹‚è¿ç®— ROUND() å››èˆäº”å…¥ TRUNCATE() æ•°å­—æˆªå– æ¯”è¾ƒè¿ç®—ç¬¦å’Œå‡½æ•° å‡½æ•°å æè¿° [NOT] BETWEENâ€¦ANDâ€¦ [ä¸]åœ¨èŒƒå›´ä¹‹å†… [NOT] IN() [ä¸]åœ¨åˆ—å‡ºå€¼èŒƒå›´å†… IS [NOT] NULL [ä¸]ä¸ºç©º æ—¥æœŸæ—¶é—´å‡½æ•° å‡½æ•°å æè¿° NOW() å½“å‰æ—¥æœŸå’Œæ—¶é—´ CURDATE() å½“å‰æ—¥æœŸ CURTIME() å½“å‰æ—¶é—´ DATE_ADD() å½“å‰å˜åŒ– DATEDIFF() å½“å‰å·®å€¼ DATE_FORMAT() æ—¥æœŸæ ¼å¼åŒ– ä¿¡æ¯å‡½æ•° å‡½æ•°å æè¿° CONNECTION_ID() è¿æ¥ID DATEBASE() å½“å‰æ•°æ®åº“ LAST_INSERT_ID() æœ€åæ’å…¥è®°å½•çš„IDå· USER() å½“å‰ç”¨æˆ· VERSION() ç‰ˆæœ¬ä¿¡æ¯ èšåˆ å‡½æ•°å æè¿° AVG() å¹³å‡å€¼ COUNT() è®¡æ•° MAX() æœ€å¤§å€¼ MIN() æœ€å°å€¼ SUM() æ±‚å’Œ åŠ å¯† å‡½æ•°å æè¿° MD5() ä¿¡æ¯æ‘˜è¦ç®—æ³• PASSWORD() å¯†ç ç®—æ³•","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(6)-å­æŸ¥è¯¢ä¸è¿æ¥","slug":"my-common-grammar6","date":"2017-12-09T03:25:25.000Z","updated":"2020-07-25T02:57:18.217Z","comments":true,"path":"2017/12/09/my-common-grammar6/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar6/","excerpt":"","text":"å­æŸ¥è¯¢å­æŸ¥è¯¢ï¼ˆSubqueryï¼‰æ˜¯æŒ‡å‡ºç°åœ¨å…¶ä»–SQLè¯­å¥å†…çš„SELECTå­å¥ ä¾‹å¦‚ï¼š 1SELECT * FROM t1 WHERE col1 = (SELECT col2 FROM t2); å…¶ä¸­ SELECT * FROM t1 ç§°ä¸ºOuter Query/Outer Statementï¼›SELECT col2 FROM t2 ç§°ä¸ºSubquery å­æŸ¥è¯¢æŒ‡åµŒå¥—åœ¨æŸ¥è¯¢å†…éƒ¨ï¼Œä¸”å¿…é¡»å§‹ç»ˆå‡ºç°åœ¨åœ†æ‹¬å·å…§ å­æŸ¥è¯¢å¯ä»¥åŒ…æ‹¬å¤šä¸ªå…³é”®å­—æˆ–æ¡ä»¶ï¼Œå¦‚ DISTINCT,GROUP BY,ORDER BY,LIMIT,å‡½æ•°ç­‰ å­æŸ¥è¯¢çš„å¤–å±‚æŸ¥è¯¢å¯ä»¥æ˜¯ï¼š SELECT,INSERT,UPDATE,SETæˆ–DO å­æŸ¥è¯¢è¿”å›å€¼å­æŸ¥è¯¢å¯ä»¥è¿”å›æ ‡é‡,ä¸€è¡Œï¼Œä¸€åˆ—æˆ–å­æŸ¥è¯¢ ç”±æ¯”è¾ƒè¿ç®—ç¬¦å¼•å‘çš„å­æŸ¥è¯¢ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢ =, &gt;, &lt;, &gt;=, &lt;=, &lt;&gt;, !=, &lt;=&gt; è¯­æ³•ç»“æ„ operand comparison_operator subquery ç”¨ ANY, SOME æˆ– ALL ä¿®é¥°çš„æ¯”è¾ƒè¿ç®—ç¬¦ 12345operand comparison_operator ANY(subquery)operand comparison_operator SOME(subquery)operand comparison_operator ALL(subquery) è¿ç®—ç¬¦\\å…³é”®å­— ANY SOME ALL &gt;, &gt;= æœ€å°å€¼ æœ€å°å€¼ æœ€å¤§å€¼ &lt;, &lt;= æœ€å¤§å€¼ æœ€å¤§å€¼ æœ€å°å€¼ = ä»»æ„å€¼ ä»»æ„å€¼ - &lt;&gt;, != - - ä»»æ„å€¼ ç”±[NOT] INå¼•å‘çš„å­æŸ¥è¯¢è¯­æ³•ç»“æ„ operand comparison_operator [NOT] IN (subquery) =ANY è¿ç®—ç¬¦ä¸ IN ç­‰æ•ˆ !=ALL æˆ– &lt;&gt;ALL è¿ç®—ç¬¦ä¸ NOT IN ç­‰æ•ˆ ç”±[NOT] EXISTSå¼•å‘çš„å­æŸ¥è¯¢å¦‚æœå­æŸ¥è¯¢è¿”å›ä»»ä½•è¡Œï¼ŒEXISTS å°†è¿”å›TRUEï¼›å¦åˆ™ä¸ºFALSE ä½¿ç”¨ INSERTâ€¦SELECT æ’å…¥è®°å½•å°†æŸ¥è¯¢ç»“æœå†™å…¥æ•°æ®è¡¨ 1INSERT [INTO] tbl_name [(col_name, ...)] SELECT ... å¤šè¡¨æ›´æ–°1UPDATE table_references SET col_name1=&#123;expr1|DEFAULT&#125; [, col_name2=&#123;expr2|DEFAULT&#125;] ... [WHERE where_condition] CREATEâ€¦SELECTåˆ›å»ºæ•°æ®è¡¨åŒæ—¶å°†æŸ¥è¯¢ç»“æœå†™å…¥åˆ°æ•°æ®è¡¨ 123CREATE TABLE [IF NOT EXISTS] tabl_name [(create_definition, ...)]select_statement è¿æ¥çš„è¯­æ³•MySQLåœ¨SELECTè¯­å¥ï¼Œå¤šè¡¨æ›´æ–°ï¼Œå¤šè¡¨åˆ é™¤è¯­å¥ä¸­æ”¯æŒJOINæ“ä½œ 1234table_reference&#123;[INNER | CROSS] JOIN | &#123;LEFT|RIGHT&#125; [OUTER] JOIN&#125;table_referenceON conditional_expr æ•°æ®è¡¨å‚ç…§table_reference 1tal_name [[AS] alias] | table_subquery [AS] alias æ•°æ®è¡¨å¯ä»¥ä½¿ç”¨tab_name AS alias_name æˆ–tab_name alias_nameèµ‹äºˆåˆ«å table_subqueryå¯ä»¥ä½œä¸ºå­æŸ¥è¯¢ä½¿ç”¨åœ¨FROMå­å¥ä¸­ï¼Œè¿™æ ·çš„å­æŸ¥è¯¢å¿…é¡»ä¸ºå…¶èµ‹äºˆåˆ«å è¿æ¥ç±»å‹ INNER JOIN, å…§è¿æ¥ åœ¨MySQLä¸­ï¼ŒJOINï¼Œ CROSS JOINå’ŒINNER JOINæ˜¯ç­‰ä»·çš„ LEFT [OUTER] JOIN, å·¦å¤–è¿æ¥ RIGHT [OUTER] JOIN, å³å¤–è¿æ¥ è¿æ¥æ¡ä»¶ä½¿ç”¨ONå…³é”®å­—æ¥è®¾å®šè¿æ¥æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨WHEREæ¥ä»£æ›¿ é€šç”¨ä½¿ç”¨ONå…³é”®å­—æ¥è®¾å®šæ¡ä»¶æ¡ä»¶ï¼›ä½¿ç”¨WHEREå…³é”®å­—æ¥è¿›è¡Œç»“æœè®°å½•çš„è¿‡æ»¤ã€‚ å…§è¿æ¥INNER JOINæ˜¾ç¤ºå·¦è¡¨åŠå³è¡¨ç¬¦åˆè¿æ¥æ¡ä»¶çš„è®°å½• ä¸¾ä¾‹ï¼š 1SELECT goods_id, goods_name, cate_name FROM tab_goods INNER JOIN tdb_goods_cates ON tdb_goods.cate_id = tdb_goods_cates.cate_id; å·¦å¤–è¿æ¥ LEFT [OUTER] JOINæ˜¾ç¤ºå·¦è¡¨çš„å…¨éƒ¨è®°å½•åŠå³è¡¨ç¬¦åˆæ¡ä»¶è¿æ¥çš„è®°å½• A LEFT JOIN B join_condition æ•°æ®è¡¨Bçš„ç»“æœé›†ä¾èµ–æ•°æ®A æ•°æ®è¡¨Açš„ç»“æœé›†æ ¹æ®å·¦è¿æ¥æ¡ä»¶ä¾èµ–æ‰€æœ‰æ•°æ®è¡¨(Bè¡¨é™¤å¤–) å·¦å¤–è¿æ¥æ¡ä»¶å†³å®šå¦‚ä½•æ£€ç´¢æ•°æ®è¡¨Bï¼ˆåœ¨æ²¡æœ‰æŒ‡å®šWHEREæ¡ä»¶çš„æƒ…å†µä¸‹ï¼‰ å¦‚æœæ•°æ®è¡¨Açš„æŸæ¡è®°å½•ç¬¦å·WHEREæ¡ä»¶ï¼Œä½†æ˜¯åœ¨æ•°æ®è¡¨Bä¸å­˜åœ¨ç¬¦åˆè¿æ¥æ¡ä»¶çš„è®°å½•ï¼Œå°†ç”Ÿæˆä¸€ä¸ªæ‰€æœ‰åˆ—ä¸ºç©ºçš„é¢å¤–çš„Bè¡Œ ä¸¾ä¾‹ï¼š 1SELECT goods_id, goods_name, cate_name FROM tab_goods LEFT JOIN tdb_goods_cates ON tdb_goods.cate_id = tdb_goods_cates.cate_id; å³å¤–è¿æ¥ RIGHT [OUTER] JOINæ˜¾ç¤ºå³è¡¨çš„å…¨éƒ¨è®°å½•åŠå·¦è¡¨ç¬¦åˆæ¡ä»¶è¿æ¥çš„è®°å½• ä¸¾ä¾‹ï¼š 1SELECT goods_id, goods_name, cate_name FROM tab_goods RIGHT JOIN tdb_goods_cates ON tdb_goods.cate_id = tdb_goods_cates.cate_id; å¤šè¡¨è¿æ¥ä¸¾ä¾‹ï¼š 123SELECT goods_id, goods_name, cate_name, brand_name FROM tab_goods AS gINNER JOIN tdb_goods_cates AS c ON g.cate_id = c.cate_idINNER JOIN tdb_goods_brands AS b ON g.brand_id = b.brand_id; å…³äºè¿æ¥çš„å‡ ç‚¹è¯´æ˜å¤–è¿æ¥å¦‚æœä½¿ç”¨å…§è¿æ¥æŸ¥æ‰¾çš„è®°å½•åœ¨æ•°æ®è¡¨ä¸­ä¸å­˜åœ¨ï¼Œå¹¶ä¸”åœ¨WHEREå­å¥ä¸­å°è¯•ä»¥ä¸‹æ“ä½œï¼šcol_namd IS NULLæ—¶ï¼Œå¦‚æœcol_nameè¢«å®šä¹‰ä¸ºNOT NULL,MySQLå°†åœ¨æ‰¾åˆ°ç¬¦åˆè¿æ¥æ¡ä»¶çš„è®°å½•åœæ­¢æœç´¢æ›´å¤šçš„è¡Œ æ— é™çº§åˆ†ç±»è¡¨è®¾è®¡ä¸¾ä¾‹ï¼š 12345CREATE TABLE tab_goods_types( type_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT, type_name VARCHAR(20) NOT NULL, parent_id SMALLINT UNSIGNED NOT NULL DEFAULT 0); è‡ªèº«è¿æ¥åŒä¸€ä¸ªæ•°æ®è¡¨å¯¹å…¶è‡ªèº«è¿›è¡Œè¿æ¥ ä¸¾ä¾‹ï¼š 12SELECT s.type_id, s.type_name, p.type_name FROM tdb_goods_types AS s LEFT JOIN tdb_goods_types AS pON s.parent_id = p.type_id; å¤šè¡¨åˆ é™¤123DELETE tab_name[.*] [, tal_name[.*]] ...FROM table_references[WHERE where_condition]","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(5)-æ“ä½œæ•°æ®è¡¨ä¸­çš„è®°å½•","slug":"my-common-grammar5","date":"2017-12-09T02:25:25.000Z","updated":"2020-07-25T02:57:18.217Z","comments":true,"path":"2017/12/09/my-common-grammar5/","link":"","permalink":"https://jigangduan.github.io/2017/12/09/my-common-grammar5/","excerpt":"","text":"æ’å…¥è®°å½• INSERT 1INSERT [INTO] tal_name [(col_name,...)] &#123;VALUES|VALUE&#125;(&#123;expr|DEFAULT&#125;,...),(...),...; expr è¡¨è¾¾å¼ ä¸¾ä¾‹ï¼š 1INSERT users VALUES(NULL,'Tom','123',25,1); è‡ªåŠ¨é€’å¢çš„å­—æ®µè®¾ç½®æˆNULLæˆ–DEFAULTå°†è‡ªå¢çš„å€¼ INSERT SET 1INSERT [INTO] tal_name SET col_name=&#123;expr|DEFAULT&#125;; ä¸ç¬¬ä¸€ç§æ–¹å¼çš„åŒºåˆ«æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢(subQuery) INSERT SELECT 1INSERT [INTO] tal_name (col_name,...) SELECT ...; å¯ä»¥å°†æŸ¥è¯¢ç»“æœæ’å…¥åˆ°æŒ‡å®šæ•°æ®è¡¨ æ›´æ–°è®°å½• UPDATE è¡¨å•æ›´æ–° 1UPDATE [LOW_PRIORITY] [IGNORE] table_reference SET col_name1=&#123;exp1|DEFAULT&#125;[,col_name2=&#123;exp2|DEFAULT&#125;]... [WHERE where_condition]; åˆ é™¤è®°å½• DELETE è¡¨å•åˆ é™¤ 1DELETE FROM tal_name [WHERE where_condition]; æŸ¥è¯¢è¡¨è¾¾å¼è§£æSELECT æŸ¥æ‰¾è®°å½•123456789SELECT select_expr [,select_expr ...][ FROM table_references [WHERE where_condition] [GROUP BY &#123;col_name | position&#125; [ASC | DESC], ...] [HAVING where_conditon] [ORDER BY &#123;col_name | expr | position&#125; [ASC|DESC], ...] [LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;]]; select_expr æŸ¥è¯¢è¡¨è¾¾å¼ æ¯ä¸€ä¸ªè¡¨è¾¾å¼è¡¨ç¤ºæƒ³è¦çš„ä¸€åˆ—ï¼Œå¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ª å¤šä¸ªåˆ—ä¹‹é—´ä»¥è‹±æ–‡é€—å·åˆ†éš” æ˜Ÿå·ï¼ˆï¼‰è¡¨ç¤ºæ‰€æœ‰åˆ—ï¼Œtab_name.å¯ä»¥è¡¨ç¤ºå‘½åè¡¨çš„æ‰€æœ‰åˆ— æŸ¥è¯¢è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨[AS] alias_nameä¸ºå…¶èµ‹äºˆåˆ«å åˆ«åå¯ç”¨äºGROUP BY, ORDRE BYæˆ–HAVINGå­å¥ WHERE æ¡ä»¶è¡¨è¾¾å¼å¯¹è®°å½•è¿›è¡Œè¿‡æ»¤ï¼Œ å¦‚æœæ²¡æœ‰æŒ‡å®šWHEREå­å¥ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰è®°å½•ã€‚åœ¨WHEREè¡¨è¾¾å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨MySQLæ”¯æŒçš„å‡½æ•°æˆ–è¿ç®—ç¬¦ GROUP BY å¯¹æŸ¥è¯¢ç»“æœåˆ†ç»„1[GROUP BY &#123;col_name | position&#125; [ASC | DESC], ...] ASC å‡åºï¼Œé»˜è®¤ DESC é™åº HAVING è®¾ç½®åˆ†ç»„æ¡ä»¶[HAVING where_conditon] GROUP BY å¯¹æŸ¥è¯¢ç»“æœæ’åº1[ORDER BY &#123;col_name | expr | position&#125; [ASC|DESC], ...] LIMIT é™åˆ¶æŸ¥è¯¢æ•°é‡1[LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;]","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(4)-çº¦æŸä»¥åŠä¿®æ”¹æ•°æ®è¡¨","slug":"my-common-grammar4","date":"2017-12-08T15:25:25.000Z","updated":"2020-07-25T02:57:18.216Z","comments":true,"path":"2017/12/08/my-common-grammar4/","link":"","permalink":"https://jigangduan.github.io/2017/12/08/my-common-grammar4/","excerpt":"","text":"çº¦æŸä¿éšœæ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ çº¦æŸåˆ†ä¸ºè¡¨çº§çº¦æŸå’Œåˆ—çº§çº¦æŸ çº¦æŸç±»å‹åŒ…æ‹¬: NOT NULL(éç©ºçº¦æŸ) PRIMARY KEY(ä¸»é”®çº¦æŸ) UNIQUE KEY(å”¯ä¸€çº¦æŸ) DEFAULT(é»˜è®¤çº¦æŸ) FOREIGN KEY(å¤–é”®çº¦æŸ) FOREIGN KEY(å¤–é”®çº¦æŸ) ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œå®Œæ•´æ€§ å®ç°ä¸€å¯¹ä¸€æˆ–ä¸€å¯¹å¤šå…³ç³» å¤–é”®çº¦æŸçš„è¦æ±‚ çˆ¶è¡¨å’Œå­è¡¨å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œè€Œä¸”ç¦æ­¢ä½¿ç”¨ä¸´æ—¶è¡¨ æ•°æ®è¡¨çš„å­˜å‚¨å¼•æ“åªèƒ½ä¸ºInnoDB å¤–é”®åˆ—å’Œå‚è€ƒåˆ—å¿…é¡»å…·æœ‰ç›¸ä¼¼çš„æ•°æ®ç±»å‹ã€‚å…¶ä¸­æ•°å­—é•¿åº¦æˆ–æ˜¯å¦ç¬¦å·ä½å¿…é¡»ç›¸åŒï¼›è€Œå­—ç¬¦é•¿åº¦å¯ä»¥ä¸åŒ å¤–é”®åˆ—å’Œå‚ç…§åˆ—å¿…é¡»åˆ›å»ºç´¢å¼•ã€‚å¦‚æœå¤–é”®åˆ—ä¸å­˜åœ¨ç´¢å¼•çš„è¯ï¼ŒMySQLå°†è‡ªåŠ¨åˆ›å»ºç´¢å¼• ç¼–è¾‘æ•°æ®è¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“MySQLé…ç½®æ–‡ä»¶ default-storage-engine=INNODB å¤–é”®çº¦æŸçš„å‚ç…§æ“ä½œ CASCADE: ä»çˆ¶è¡¨åˆ é™¤æˆ–æ›´æ–°ä¸”è‡ªåŠ¨åˆ é™¤æˆ–æ›´æ–°å­è¡¨ä¸­åŒ¹é…åˆ°è¡Œ SET UNLL: ä»çˆ¶è¡¨åˆ é™¤æˆ–æ›´æ–°è¡Œï¼Œå¹¶è®¾ç½®å­è¡¨ä¸­çš„å¤–é”®è¡Œä¸ºNULLã€‚å¦‚æœä½¿ç”¨è¯¥é€‰é¡¹ï¼Œå¿…é¡»ä¿è¯å­è¡¨åˆ—æ²¡æœ‰æŒ‡å®šNOT NULL RESTRICT: æ‹’ç»å¯¹çˆ¶è¡¨çš„åˆ é™¤æˆ–æ›´æ–°æ“ä½œ NO ACTION: æ ‡å‡†SQLçš„å…³é”®å­—ï¼Œåœ¨MySQLä¸­ä¸RESTRICTç›¸åŒ ä¿®æ”¹æ•°æ®è¡¨ æ·»åŠ å•åˆ— 1ALTER TABLE tal_name ADD [COLUMN] col_name column_definition [FIRST | AFTER col_name]; æ·»åŠ å¤šåˆ— 1ALTER TABLE tal_name ADD [COLUMN] (col_name column_definition,...); åˆ é™¤åˆ— 1ALTER TABLE tal_name DROP [COLUMN] col_name; æ·»åŠ ä¸»é”®çº¦æŸ 1ALTER TABLE tal_name ADD [CONSTRAINT [symbol]] PRIMARY KEY [index_type] (index_col_name,...); æ·»åŠ å”¯ä¸€çº¦æŸ 1ALTER TABLE tal_name ADD [CONSTRAINT [symbol]] UNIQUE [INDEC|KEY] [index_name][index_type] (index_col_name,...); æ·»åŠ å¤–é”®çº¦æŸ 1ALTER TABLE tal_name ADD [CONSTRAINT [symbol]] FOREING KEY [index_name](index_col_name,...) reference_definition; æ·»åŠ /åˆ é™¤é»˜è®¤çº¦æŸ 1ALTER TABLE tal_name ALTER [COLUMN] col_name &#123;SET DEFAULT literal | DROP DEFAULT&#125;; åˆ é™¤ä¸»é”®çº¦æŸ 1ALTER TABLE tal_name DROP PRIMARY KEY; åˆ é™¤å”¯ä¸€çº¦æŸ 1ALTER TABLE tal_name DROP &#123;INDEX|KEY&#125; index_name; åˆ é™¤å¤–é”®çº¦æŸ 1ALTER TABLE tal_name DROP FOREIGN KEY fk_symbol; ä¿®æ”¹åˆ—å®šä¹‰ 1ALTER TABLE tal_name MODIFY [COLUMN] col_name column_definition [FIRST | AFTER col_name]; ä¿®æ”¹åˆ—åç§° 1ALTER TABLE tal_name CHANGE [COLUMN] old_col_name new_col_name column_definition [FIRST | AFTER col_name]; æ•°æ®è¡¨æ›´å æ–¹æ³•ä¸€ï¼š 1ALTER TABLE tal_name RENAME [TO|AS] new_tbl_name; æ–¹æ³•äºŒï¼š 1RENAME TABLE tal_name TO new_tbl_name [, tabl_name2 TO new_tal_name2];","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(3)-æ•°æ®è¡¨","slug":"my-common-grammar3","date":"2017-12-08T14:25:25.000Z","updated":"2020-07-25T02:57:18.216Z","comments":true,"path":"2017/12/08/my-common-grammar3/","link":"","permalink":"https://jigangduan.github.io/2017/12/08/my-common-grammar3/","excerpt":"","text":"åˆ›å»ºæ•°æ®è¡¨ 1234CREATE TABLE [IF NOT EXISTS] table_name ( column_name data_type [NULL | NOT NULL | [AUTO_INCREMENT] PRIMARY KEY] [UNIQUE KEY] [DEFAULT default_value], ...); ä¸¾ä¾‹ï¼š 12345CREATE TABLE tb1 ( username VARCHAR(20), age TINYINT UNSIGNED, salary FLOAT(8,2) UNSIGNED); NULL, å­—æ®µå€¼å¯ä»¥ä¸ºç©º NOT NULL, å­—æ®µå€¼ç¦æ­¢ä¸ºç©º AUTO_INCREMENT, è‡ªåŠ¨ç¼–å·ï¼Œä¸”å¿…é¡»ä¸ä¸»é”®ç»„åˆä½¿ç”¨ï¼›é»˜è®¤æƒ…å†µï¼Œåˆå§‹å€¼ä¸º1ï¼Œæ¯æ¬¡å¢é‡ä¸º1 PRIMARY KEY ä¸»é”®çº¦æŸ æ¯å¼ è¡¨åªèƒ½å­˜åœ¨ä¸€ä¸ªä¸»é”® ä¸»é”®ä¿è¯è®°å½•çš„å”¯ä¸€æ€§ ä¸»é”®è‡ªåŠ¨ä¸ºNOT NULL UNIQUE KEY å”¯ä¸€çº¦æŸ å¯ä»¥ä¿è¯è®°å½•å”¯ä¸€æ€§ å­—æ®µå¯ä»¥ä¸ºç©ºå€¼(NULL) æ¯å¼ è¡¨å¯ä»¥å­˜åœ¨å¤šä¸ªå”¯ä¸€çº¦æŸ DEFAULT é»˜è®¤å€¼ å½“æ’å…¥è®°å½•æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®ä¸ºå­—æ®µèµ‹å€¼ï¼Œåˆ™è‡ªåŠ¨èµ‹é»˜è®¤å€¼ æŸ¥çœ‹æ•°æ®è¡¨ 1SHOW TABLES [FROM db_name] [LIKE 'pattern' | WHERE expr]; æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„ 1SHOW COLUMNS FROM tal_name; æ’å…¥è®°å½• 1INSERT [INTO] tal_name[(col_name,...)] VALUES(val,...); ä¸¾ä¾‹ï¼š 1INSERT ta1(username,salary) VALUES('John',4500.69); æŸ¥æ‰¾è®°å½• 1SELECT expr,... FROM tal_name;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(2)-æ•°æ®ç±»å‹","slug":"my-common-grammar2","date":"2017-12-08T13:25:25.000Z","updated":"2020-07-25T02:57:18.216Z","comments":true,"path":"2017/12/08/my-common-grammar2/","link":"","permalink":"https://jigangduan.github.io/2017/12/08/my-common-grammar2/","excerpt":"","text":"æ•´å‹ æ•°æ®ç±»å‹ å­˜å‚¨èŒƒå›´ å­—èŠ‚ TINYINT æœ‰ç¬¦å·ï¼š-128ï½127ï¼›æ— ç¬¦å·ï¼š0ï½255 1 SMALLINT æœ‰ç¬¦å·ï¼š-32768ï½32767ï¼›æ— ç¬¦å·ï¼š0ï½65535 2 MEDIUMINT æœ‰ç¬¦å·ï¼š-8388608ï½8388607ï¼›æ— ç¬¦å·ï¼š0ï½16777215 3 INT æœ‰ç¬¦å·ï¼š-2^31ï½2^31-1ï¼›æ— ç¬¦å·ï¼š0ï½2^32-1 4 BIGINT æœ‰ç¬¦å·ï¼š-2^63ï½2^63-1ï¼›æ— ç¬¦å·ï¼š0ï½2^64-1 8 æµ®ç‚¹å‹FLOAT[M,D]DOUBLE[M,D] Mæ˜¯æ•°å­—æ€»ä½æ•°ï¼ŒDæ˜¯å°æ•°ç‚¹åçš„ä½æ•° æ—¥æœŸæ—¶é—´å‹ ç±»å‹ å­—èŠ‚ YEAR 1 TIME 3 DATE 3 DATETIME 8 TIMESTAMP 4 å­—ç¬¦å‹ ç±»å‹ å­˜å‚¨éœ€æ±‚ CHAR(M) Mä¸ªå­—èŠ‚, 0 &lt;= M &lt;= 255 VARCHAR(M) L+1ä¸ªå­—èŠ‚, L &lt;= M &amp;&amp; 0 &lt;= M &lt;= 65535 TINYTEXT L+1ä¸ªå­—èŠ‚, L &lt;= 2^8 TEXT L+1ä¸ªå­—èŠ‚, L &lt;= 2^16 MEDIUMTEXT L+1ä¸ªå­—èŠ‚, L &lt;= 2^24 LONGTEXT L+1ä¸ªå­—èŠ‚, L &lt;= 2^32 ENUM(â€˜value1â€™, â€˜value2â€™) 1æˆ–2ä¸ªå­—èŠ‚ï¼Œå–å†³æšä¸¾å€¼ä¸ªæ•°ï¼ˆæœ€å¤š65,535ï¼‰ SET(â€˜value1â€™, â€˜value2â€™) 1,2,3,4æˆ–8ä¸ªå­—èŠ‚ï¼Œå–å†³setæˆå‘˜æ•°ç›®(æœ€å¤š64ä¸ªæˆå‘˜)","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"MySQLç®€å•æ“ä½œ(1)-æ•°æ®åº“","slug":"my-common-grammar","date":"2017-12-08T12:25:25.000Z","updated":"2020-07-25T02:57:18.215Z","comments":true,"path":"2017/12/08/my-common-grammar/","link":"","permalink":"https://jigangduan.github.io/2017/12/08/my-common-grammar/","excerpt":"","text":"ç™»é™†/é€€å‡º1mysql -u`username` -p`password` -P`port` -h`host` MySQLé»˜è®¤ç«¯å£å· 3306 MySQLè¶…çº§ç”¨æˆ·å root é€€å‡º mysql &gt; exit; mysql &gt; quit; mysql &gt; \\q; ä¿®æ”¹æç¤ºç¬¦1shell&gt;mysql -uroot -proot --prompt æç¤ºç¬¦ æˆ– 1mysql&gt;prompt æç¤ºç¬¦ å‚æ•° æè¿° \\D æ—¥æœŸ \\d å½“å‰æ•°æ®åº“ \\h æœåŠ¡å™¨åç§° \\u å½“å‰ç”¨æˆ· å¸¸è§å‘½ä»¤ æ˜¾ç¤ºå½“å‰æœåŠ¡å™¨ç‰ˆæœ¬ 1SELECT VERSION(); æ˜¾ç¤ºå½“å‰æ—¥å‰æ—¶é—´ 1SELECT NOW(); æ˜¾ç¤ºå½“å‰ç”¨æˆ· 1SELECT USER(); æ“ä½œæ•°æ®åº“ æ‰“å¼€æ•°æ®åº“ 1USE database_name; ç”¨æˆ·å½“å‰æ‰“å¼€çš„æ•°æ®åº“ 1SELECT DATABASE(); åˆ›å»ºæ•°æ®åº“ 1CREATE &#123;DATABASE | SCHEMAS&#125; [IF NOT EXISTS] db_name [DEFAULT] CHARACTER SET [=] charset_name; æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸‹çš„æ•°æ®åº“åˆ—è¡¨ 1SHOW &#123;DATABASE | SCHEMAS&#125; [LIKE 'pattern' | WHERE expr]; ä¿®æ”¹æ•°æ®åº“ 1ALTER &#123;DATABASE | SCHEMAS&#125; db_name [DEFAULT] CHARACTER SET [=] charset_name; åˆ é™¤æ•°æ®åº“ 1DROP &#123;DATABASE | SCHEMAS&#125; [IF NOT EXISTS] db_name;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"}]},{"title":"SampleBrowserPluginä»‹ç»","slug":"BrowserPlugin","date":"2017-12-04T14:56:21.000Z","updated":"2020-07-25T02:57:18.148Z","comments":true,"path":"2017/12/04/BrowserPlugin/","link":"","permalink":"https://jigangduan.github.io/2017/12/04/BrowserPlugin/","excerpt":"å¯¹äºAndroidæµè§ˆå™¨æ’ä»¶çš„å¼€å‘å¯ä»¥å‚è€ƒæºç çš„å®ä¾‹,development/samples/browsepluginå®ä¾‹ã€‚æœ¬æ–‡å¯¹æ­¤å®ä¾‹è¿›è¡Œä»‹ç»ã€‚","text":"å¯¹äºAndroidæµè§ˆå™¨æ’ä»¶çš„å¼€å‘å¯ä»¥å‚è€ƒæºç çš„å®ä¾‹,development/samples/browsepluginå®ä¾‹ã€‚æœ¬æ–‡å¯¹æ­¤å®ä¾‹è¿›è¡Œä»‹ç»ã€‚ ä»‹ç»è¿™ä¸ªç¤ºä¾‹æ’ä»¶æ˜¯ä¸ºäº†ç»™æ’ä»¶å¼€å‘è€…ä¸€ä¸ªå‚è€ƒç‚¹ï¼Œçœ‹çœ‹androidæµè§ˆå™¨æ’ä»¶æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¯ç”¨çš„APIsã€‚ä¸€ä¸ªæ’ä»¶å°±åƒæ ‡å‡†çš„apkä¸€æ ·è¢«æ‰“åŒ…ï¼Œå¯ä»¥é€šè¿‡å¸‚åœºæˆ–adbå®‰è£…ã€‚ç¤ºä¾‹æ’ä»¶å°è¯•å°½å¯èƒ½å¤šåœ°ä½¿ç”¨APIsï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„APIséƒ½è¢«è¦†ç›–ã€‚ è¯•å›¾è®©ä¸€ä¸ªæ’ä»¶æ¼”ç¤ºä¸€ä¸ªå±å¹•ä¸Šæ‰€æœ‰å¯èƒ½çš„APIäº¤äº’æ˜¯ä¸ç°å®çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„æ’ä»¶ï¼Œå› ä¸ºé‚£ä¼šå¯¼è‡´è®¸å¤šç‹¬ç«‹çš„apkéœ€è¦ç»´æŠ¤ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å‘äº†ä½¿ç”¨â€œå­æ’ä»¶â€çš„æƒ³æ³•ã€‚åœ¨ä¸€ä¸ªæ’ä»¶ä¸­ï¼Œæ’ä»¶åªæœ‰ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒä»¬éƒ½å¯ä»¥å…±äº«å°½å¯èƒ½å¤šçš„é€šç”¨ä»£ç ã€‚æ¯ä¸ªå­æ’ä»¶åŠå…¶åŠŸèƒ½çš„è¯¦ç»†æè¿°å¯ä»¥åœ¨å­æ’ä»¶éƒ¨åˆ†ä¸­æ‰¾åˆ°ã€‚ æ’ä»¶ç»“æ„æ ·ä¾‹æ’ä»¶è¢«æ‰“åŒ…ä¸ºä¸€ä¸ªæ’ä»¶ï¼Œä½†æ˜¯åŒ…å«è®¸å¤šç‹¬ç‰¹çš„å­æ’ä»¶(å¦‚éŸ³é¢‘å’Œpaint)ã€‚ è¿™ä¸ªåŒ…ç”±ä¸¤éƒ¨åˆ†ç»„æˆ: åŒ…å«é…ç½®çš„Javaä»£ç ; C++å…±äº«åº“ï¼ŒåŒ…å«æµè§ˆå™¨/æ’ä»¶ç»‘å®šå’Œå­æ’ä»¶ç±»ã€‚ JAVA Android.mk: æŒ‡å®šAPK(SampleBrowserPlugin)çš„åç§°ï¼Œä»¥åŠåŒ…å«å“ªäº›å…±äº«åº“ã€‚ AndroidManifest.xml: ç±»ä¼¼äºæ ‡å‡†çš„androidæ¸…å•æ–‡ä»¶ï¼Œé™¤äº†å®ƒå¿…é¡»åŒ…å«ç‰¹å®šäºæ’ä»¶çš„&quot;uses-permission&quot;å’Œ&quot;service&quot; å…ƒç´ ã€‚&quot;service&quot;å…ƒç´ åŒ…å«æè¿°serviceçš„javaç»„ä»¶çš„å­å…ƒç´ ã€‚ src/*: javaæºæ–‡ä»¶çš„ä½ç½®ã€‚è¿™åŒ…å«äº†SamplePluginã€‚ç±»æ˜¯æˆ‘ä»¬çš„æ’ä»¶çš„javaç»„ä»¶ã€‚ç»„ä»¶å¿…é¡»å­˜åœ¨å¹¶å®ç°æ‰€éœ€çš„æ¥å£ï¼Œå°½ç®¡ç®€å•åœ°è¿”å›nullæ˜¯æœ‰æ•ˆçš„ã€‚ res/*: é™æ€èµ„æºçš„ä½ç½®(ä¾‹å¦‚æ’ä»¶çš„å›¾æ ‡) C++ jni/Android.mk: æŒ‡å®šä¸apkä¸€èµ·åŒ…å«çš„å…±äº«åº“çš„æ„å»ºå‚æ•°ã€‚è¯¥åº“åŒ…å«æ’ä»¶å’Œæµè§ˆå™¨ä¹‹é—´çš„æ‰€æœ‰ç»‘å®šã€‚ jni/main.*: è¿™æ®µä»£ç æ˜¯æ’ä»¶å’Œæµè§ˆå™¨ä¹‹é—´çš„ç»‘å®šç‚¹ã€‚å®ƒæ”¯æŒæ ‡å‡†çš„netscapeé£æ ¼æ’ä»¶ä»¥åŠæ‰€æœ‰androidç‰¹å®šAPIsæ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½ã€‚æ’ä»¶çš„èµ·å§‹ç‚¹æ˜¯NP_Initializeå‡½æ•°ã€‚NPP_Newå‡½æ•°è´Ÿè´£è¯»å–è¾“å…¥çš„argsï¼Œå¹¶é€‰æ‹©é€‚å½“çš„å­æ’ä»¶å®ä¾‹åŒ–ã€‚å¤§å¤šæ•°å…¶ä»–å‡½æ•°è¦ä¹ˆè¿”å›å›ºå®šå€¼ï¼Œè¦ä¹ˆå°†å®ƒä»¬çš„è¾“å…¥ä¼ é€’ç»™å­æ’ä»¶è¿›è¡Œå¤„ç†ã€‚ jni/PluginObject.*: pluginObjectæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å®¹å™¨æ¥å­˜å‚¨å˜é‡(æ’ä»¶çš„çŠ¶æ€)ã€‚è¿™ä¸ªå¯¹è±¡çš„ä¸¤ä¸ªä¸»è¦èŒè´£æ˜¯ æ„é€ å’Œå­˜å‚¨NPClasså¯¹è±¡(ä½¿ç”¨è‹¹æœæä¾›çš„ä»£ç å®Œæˆ) ä¸ºå­æ’ä»¶å¯¹è±¡æä¾›æŠ½è±¡ç±»ï¼Œå¹¶åœ¨å®ä¾‹åŒ–åå­˜å‚¨å­æ’ä»¶ã€‚ jni/*/*: æ¯ä¸ªå­æ’ä»¶éƒ½æœ‰ä¸€ä¸ªåŒ…å«å…¶ç±»å®šä¹‰å’Œé€»è¾‘çš„æ–‡ä»¶å¤¹ã€‚å­æ’ä»¶ä»æµè§ˆå™¨æ¥æ”¶äº‹ä»¶ï¼Œå®ƒä¹Ÿå¯ä»¥ä½¿ç”¨netscapeæ’ä»¶åŠŸèƒ½å’Œä¸“ç”¨çš„androidç•Œé¢æ¥ä¸æµè§ˆå™¨è¿›è¡Œé€šä¿¡ã€‚ å¦‚ä½•éƒ¨ç½²åªéœ€ç®€å•åœ°åœ¨è®¾å¤‡/æ¨¡æ‹Ÿå™¨ä¸Šç¼–è¯‘å’Œå®‰è£…æ’ä»¶å³â€¦ è¿è¡Œ&quot;make SampleBrowserPlugin&quot;(ç¼–è¯‘libsampleplugin.soï¼Œæ„å»ºapk) å‰é¢çš„å‘½ä»¤ç”Ÿæˆä¸€ä¸ªapkæ–‡ä»¶ï¼Œä»¥ä¾¿è®°å½•å®ƒçš„ä½ç½® è¿è¡Œ&quot;adb install [apk_file]&quot;ï¼Œå°†å…¶å®‰è£…åœ¨è®¾å¤‡/æ¨¡æ‹Ÿå™¨ä¸Š æµè§ˆå™¨ä¼šè‡ªåŠ¨è¯†åˆ«æ’ä»¶çš„å¯ç”¨æ€§ ç°åœ¨æ’ä»¶å·²ç»å®‰è£…å¥½äº†ï¼Œä½ å¯ä»¥åƒé€šè¿‡è®¾ç½® -&gt; åº”ç”¨ -&gt; ç®¡ç†åº”ç”¨ç¨‹åºä¸€æ ·ç®¡ç†å®ƒã€‚è¦æ‰§è¡Œæ’ä»¶ï¼Œæ‚¨éœ€è¦åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­åŒ…å«ä¸€ä¸ªhtmlä»£ç ç‰‡æ®µï¼Œè¯¥æ–‡æ¡£å¯ç”±æµè§ˆå™¨è®¿é—®ã€‚mime-typeä¸èƒ½æ”¹å˜ï¼Œä½†æ‚¨å¯ä»¥æ›´æ”¹å®½åº¦ã€é«˜åº¦å’Œå‚æ•°ã€‚è¿™äº›å‚æ•°ç”¨äºé€šçŸ¥æ’ä»¶è¦æ‰§è¡Œçš„æ’ä»¶ï¼Œä»¥åŠä½¿ç”¨å“ªä¸ªç»˜å›¾æ¨¡å‹ã€‚ 1234&lt;object type=\"application/x-testbrowserplugin\" height=50 width=250&gt; &lt;param name=\"DrawingModel\" value=\"Surface\" /&gt; &lt;param name=\"PluginType\" value=\"Background\" /&gt;&lt;/object&gt; å­æ’ä»¶æ¯ä¸ªå­æ’ä»¶å¯¹åº”ä¸€ä¸ªæ’ä»¶ç±»å‹ï¼Œå¯ä»¥æ”¯æŒä¸€ä¸ªæˆ–å¤šä¸ªç»˜å›¾æ¨¡å‹ã€‚åœ¨ä¸‹é¢çš„å°èŠ‚ä¸­ï¼Œæœ‰å…³äºæ¯ä¸ªå­æ’ä»¶çš„æè¿°ä»¥åŠåˆ›å»ºhtmlä»£ç ç‰‡æ®µæ‰€éœ€çš„ä¿¡æ¯ã€‚ åŠ¨ç”» æ’ä»¶ç±»å‹: åŠ¨ç”» ç»˜åˆ¶æ¨¡å‹: ä½å›¾ è¿™ä¸ªæ’ä»¶åœ¨å±å¹•ä¸Šç”»äº†ä¸€ä¸ªå°çƒã€‚å¦‚æœè¿™ä¸ªæ’ä»¶ä¸æ˜¯å®Œå…¨åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”å®ƒè¢«è§¦æ‘¸äº†ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¯•å›¾åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå®ƒè‡ªå·±ã€‚ éŸ³é¢‘ æ’ä»¶ç±»å‹:éŸ³é¢‘ ç»˜åˆ¶æ¨¡å‹:ä½å›¾ è¿™ä¸ªæ’ä»¶æ’­æ”¾ä¸€ä¸ªä½äº/sdcard/sdample.rawçš„åŸå§‹éŸ³é¢‘æ–‡ä»¶(éœ€è¦æä¾›ä½ è‡ªå·±çš„)ã€‚å®ƒä½¿ç”¨touchæ¥è§¦å‘æ’­æ”¾ã€æš‚åœå’Œåœæ­¢æŒ‰é’®ã€‚ åå° æ’ä»¶ç±»å‹:åå° ç»˜åˆ¶æ¨¡å‹:Surface è¿™ä¸ªæ’ä»¶çš„å¯è§†ç»„ä»¶å¾ˆå°‘ï¼Œä½†ä¸»è¦æ˜¯åœ¨åå°è¿è¡ŒAPIæµ‹è¯•ã€‚è¿™ä¸ªæ’ä»¶å¤„ç†ç¼©æ”¾å®ƒè‡ªå·±çš„ä½å›¾ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚è¿™ä¸ªæ’ä»¶çš„è¾“å‡ºåœ¨æ—¥å¿—ä¸­è¢«å‘ç°ï¼Œå› ä¸ºå¦‚æœå®ƒæ£€æµ‹åˆ°ä»»ä½•APIå¤±è´¥ï¼Œå®ƒä¼šæ‰“å°é”™è¯¯ã€‚æµ‹è¯•çš„ä¸€äº›APIæ˜¯å®šæ—¶å™¨ã€javascriptè®¿é—®å’Œä½å›¾æ ¼å¼ã€‚ è¡¨å• æ’ä»¶ç±»å‹:è¡¨å• ç»˜åˆ¶æ¨¡å‹:ä½å›¾ è¿™ä¸ªæ’ä»¶æ¨¡ä»¿äº†ä¸€ä¸ªç®€å•çš„ç”¨æˆ·å/å¯†ç è¡¨å•ã€‚æ‚¨å¯ä»¥é€šè¿‡è§¦æ‘¸æˆ–ä½¿ç”¨å¯¼èˆªé”®æ¥é€‰æ‹©æ–‡æœ¬æ¡†ã€‚ä¸€æ—¦é€‰ä¸­ï¼Œè¿™ä¸ªæ¡†å°±ä¼šçªå‡ºæ˜¾ç¤ºï¼Œé”®ç›˜å°±ä¼šå‡ºç°ã€‚å¦‚æœé€‰æ‹©çš„æ–‡æœ¬æ¡†ä¸æ˜¯å®Œå…¨çš„è§†å›¾ï¼Œé‚£ä¹ˆæ’ä»¶å°†ç¡®ä¿å®ƒä»¥å±å¹•ä¸ºä¸­å¿ƒã€‚ PAINT æ’ä»¶ç±»å‹: Paint ç»˜åˆ¶æ¨¡å‹: Surface è¿™ä¸ªæ’ä»¶æä¾›äº†ä¸€ä¸ªç”¨æˆ·å¯ä»¥â€œPaintâ€çš„ç•Œé¢ã€‚è¾“å…¥æ–¹æ³•å¯ä»¥åœ¨é¼ æ ‡(ç‚¹)å’Œè§¦æ‘¸(çº¿)ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚è¿™ä¸ªæ’ä»¶æœ‰ä¸€ä¸ªå›ºå®šçš„è¡¨é¢ï¼Œå¯ä»¥è®©æµè§ˆå™¨åœ¨ç¼©æ”¾æ—¶ç¼©æ”¾ã€‚ ç›¸å…³çŸ¥è¯†å¯ä»¥å‚è€ƒhttps://developer.mozilla.org/en/Gecko_Plugin_API_Reference","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Browser Plugin","slug":"Android/Browser-Plugin","permalink":"https://jigangduan.github.io/categories/Android/Browser-Plugin/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"}]},{"title":"SDKMAN! è½¯ä»¶å¼€å‘å·¥å…·åŒ…ç®¡ç†å™¨","slug":"sdkman","date":"2017-11-30T05:11:25.000Z","updated":"2020-07-25T02:57:18.228Z","comments":true,"path":"2017/11/30/sdkman/","link":"","permalink":"https://jigangduan.github.io/2017/11/30/sdkman/","excerpt":"SDKMAN!æ˜¯åœ¨å¤§å¤šæ•°Unixç³»ç»Ÿä¸Šç®¡ç†å¤šä¸ªè½¯ä»¶å¼€å‘å¥—ä»¶çš„å¹¶è¡Œç‰ˆæœ¬çš„å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å‘½ä»¤è¡Œæ¥å£(CLI)å’Œç”¨äºå®‰è£…ã€åˆ‡æ¢ã€åˆ é™¤å’Œåˆ—å‡ºå€™é€‰å¯¹è±¡çš„APIã€‚ä»¥å‰è¢«ç§°ä¸ºGVMçš„Groovyç¯å¢ƒç®¡ç†å™¨ï¼Œå®ƒæ˜¯ç”±éå¸¸æœ‰ç”¨çš„RVMå’Œrbenvå·¥å…·æ‰€å¯å‘çš„ï¼Œè¿™äº›å·¥å…·åœ¨Rubyç¤¾åŒºä¸­å¹¿æ³›ä½¿ç”¨ã€‚","text":"SDKMAN!æ˜¯åœ¨å¤§å¤šæ•°Unixç³»ç»Ÿä¸Šç®¡ç†å¤šä¸ªè½¯ä»¶å¼€å‘å¥—ä»¶çš„å¹¶è¡Œç‰ˆæœ¬çš„å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å‘½ä»¤è¡Œæ¥å£(CLI)å’Œç”¨äºå®‰è£…ã€åˆ‡æ¢ã€åˆ é™¤å’Œåˆ—å‡ºå€™é€‰å¯¹è±¡çš„APIã€‚ä»¥å‰è¢«ç§°ä¸ºGVMçš„Groovyç¯å¢ƒç®¡ç†å™¨ï¼Œå®ƒæ˜¯ç”±éå¸¸æœ‰ç”¨çš„RVMå’Œrbenvå·¥å…·æ‰€å¯å‘çš„ï¼Œè¿™äº›å·¥å…·åœ¨Rubyç¤¾åŒºä¸­å¹¿æ³›ä½¿ç”¨ã€‚ å®‰è£…åœ¨ç±»unixå¹³å°ä¸Šå®‰è£…SDKMAN!ï¼Œå°±åƒä»¥å‰ä¸€æ ·å®¹æ˜“ã€‚SDKMAN!åœ¨Mac OSXã€Linuxã€Cygwinã€Solariså’ŒFreeBSDä¸Šå¯ä»¥é¡ºåˆ©å®‰è£…ã€‚æˆ‘ä»¬è¿˜æ”¯æŒBashå’ŒZSH shellã€‚ åªéœ€æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶è¾“å…¥: 1$ curl -s \"https://get.sdkman.io\" | bash æŒ‰ç…§å±å¹•ä¸Šçš„è¯´æ˜å®Œæˆå®‰è£…ã€‚ æ¥ä¸‹æ¥ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯æˆ–è¾“å…¥: 1$ source \"$HOME/.sdkman/bin/sdkman-init.sh\" æœ€åï¼Œè¿è¡Œä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œä»¥ç¡®ä¿å®‰è£…æˆåŠŸ: 1$ sdk version å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œåˆ™åº”è¯¥æ˜¾ç¤ºè¯¥ç‰ˆæœ¬: 1sdkman 5.0.0+51 Betaé€šé“å¯¹äºæ›´å–œæ¬¢å†’é™©çš„äººæ¥è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæµ‹è¯•é¢‘é“ã€‚æ‰€æœ‰æ–°çš„CLIç‰¹æ€§éƒ½å°†é¦–å…ˆé’ˆå¯¹è¿™ä¸€ç»„ç”¨æˆ·è¿›è¡Œè¯•ç”¨ã€‚Betaç‰ˆæœ¬åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç¨³å®šçš„ï¼Œä½†å¶å°”ä¹Ÿä¼šä¸­æ–­ã€‚è¦åŠ å…¥æµ‹è¯•ç¨‹åºï¼Œåªéœ€æ›´æ–°~/.sdkman/etc/configæ–‡ä»¶å¦‚ä¸‹: 1sdkman_beta_channel=true æ¥ä¸‹æ¥ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶æ‰§è¡Œä¸€ä¸ªå¼ºåˆ¶æ›´æ–°: 1$ sdk selfupdate force è¦ç¦»å¼€æµ‹è¯•é€šé“ï¼Œåªéœ€å°†ä¸Šé¢çš„é…ç½®è®¾ç½®ä¸ºfalseï¼Œå¹¶éµå¾ªç›¸åŒçš„æ­¥éª¤ã€‚ å¸è½½åœ¨ä¸å¤ªå¯èƒ½çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›å¸è½½SDKMANï¼æˆ‘ä»¬è¿˜æ²¡æœ‰è‡ªåŠ¨åŒ–çš„æ–¹æ³•æ¥åšè¿™ä»¶äº‹ã€‚å¦‚æœä½ çœŸçš„æƒ³æŠŠå®ƒä»ä½ çš„ç³»ç»Ÿä¸­åˆ é™¤ï¼Œé‚£å°±å¾ˆå®¹æ˜“åšåˆ°ã€‚ä¸‹é¢çš„å†…å®¹å°†æŒ‡å¯¼æ‚¨è¿›è¡Œå¤‡ä»½ï¼Œç„¶åä»ç³»ç»Ÿä¸­åˆ é™¤æ•´ä¸ªå®‰è£…ã€‚ 12tar zcvf ~/sdkman-backup_$(date +%F-%kh%M).tar.gz -C ~/ .sdkman$ rm -rf ~/.sdkman æœ€åä¸€æ­¥æ˜¯ç¼–è¾‘å’Œåˆ é™¤æ‚¨çš„.bashrc, .bash_profile å’Œ/æˆ– .profileæ–‡ä»¶ä¸­çš„åˆå§‹åŒ–ä»£ç ç‰‡æ®µã€‚å¦‚æœä½ ä½¿ç”¨ZSHï¼Œä».zshrcä¸­åˆ é™¤å®ƒã€‚è¦åˆ é™¤çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹: 12#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!![[ -s \"/home/dudette/.sdkman/bin/sdkman-init.sh\" ]] &amp;&amp; source \"/home/dudette/.sdkman/bin/sdkman-init.sh\" ä¸€æ—¦åˆ é™¤ï¼Œæ‚¨å°±æˆåŠŸåœ°ä»ä½ çš„æœºå™¨å¸è½½äº†SDKMANï¼ã€‚ å®‰è£…åˆ°è‡ªå®šä¹‰ä½ç½®å®‰è£…SDKMANï¼åˆ°ä¸€ä¸ªé™¤$HOME/.sdkmanä»¥å¤–çš„è‡ªå®šä¹‰ä½ç½®æ˜¯å¯èƒ½çš„ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨å®‰è£…ä¹‹å‰å°†æ‚¨çš„å®šåˆ¶ä½ç½®å¯¼å‡ºä¸ºSDKMAN_DIRæ¥å®ç°ã€‚åªéœ€æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶è¾“å…¥: 1$ export SDKMAN_DIR=\"/usr/local/sdkman\" &amp;&amp; curl -s \"https://get.sdkman.io\" | bash ä¸ºæ­¤ï¼Œæ‚¨çš„ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶å¤¹æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™æ˜¯è‡³å…³é‡è¦çš„ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œå¦‚æœè¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼ŒSDKMAN!å°†å°è¯•åˆ›å»ºå®ƒã€‚ ä½¿ç”¨å®‰è£…SDKæœ€æ–°ç¨³å®šç‰ˆæœ¬é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå®‰è£…æ‚¨çš„SDKçš„æœ€æ–°ç¨³å®šç‰ˆæœ¬(æ¯”å¦‚Java JDK)ã€‚ 1$ sdk install java æ‚¨å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡º: 12345678Downloading: java 8u111In progress...######################################################################## 100.0%Installing: java 8u111Done installing! å¦‚æœæ‚¨å¸Œæœ›å°†æ­¤ç‰ˆæœ¬è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œåˆ™ä¼šæç¤ºæ‚¨ã€‚ 1Do you want java 8u111 to be set as default? (Y/n): å›ç­”yes(æˆ–å›è½¦)å°†ç¡®ä¿æ‰€æœ‰åç»­çš„shelléƒ½å°†åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„SDKã€‚ 1Setting java 8u111 as default. ç‰¹å®šç‰ˆæœ¬éœ€è¦ä¸€ä¸ªSDKçš„ç‰¹å®šç‰ˆæœ¬å—?ç®€å•åœ°é™å®šä½ éœ€è¦çš„ç‰ˆæœ¬: 1$ sdk install scala 2.12.1 æ‰€æœ‰åç»­æ­¥éª¤éƒ½ä¸ä¸Šé¢ç›¸åŒã€‚ å®‰è£…æœ¬åœ°ç‰ˆæœ¬éœ€è¦ä¸€ä¸ªå¿«ç…§å—?å·²ç»æœ‰æœ¬åœ°å®‰è£…äº†å—?è®¾ç½®ä¸€ä¸ªæœ¬åœ°ç‰ˆæœ¬: 1$ sdk install groovy 3.0.0-SNAPSHOT /path/to/groovy-3.0.0-SNAPSHOT åˆ é™¤ç‰ˆæœ¬åˆ é™¤ä¸€ä¸ªå®‰è£…ç‰ˆæœ¬ã€‚ 1$ sdk uninstall scala 2.11.6 å€™é€‰åˆ—è¡¨è·å¾—ä¸€ä»½å¯ç”¨çš„å€™é€‰åˆ—è¡¨: 1$ sdk list è¿™å°†æä¾›ä¸€ä¸ªå¯æœç´¢çš„å­—æ¯åˆ—è¡¨ï¼Œå…¶ä¸­æœ‰åç§°ã€å½“å‰ç¨³å®šçš„é»˜è®¤ç‰ˆæœ¬ã€ç½‘ç«™URLã€æè¿°ä»¥åŠæ¯ä¸ªå€™é€‰äººçš„ç®€å•å®‰è£…å‘½ä»¤ã€‚è¾“å‡ºè¢«ç”¨ç®¡é“è¿æ¥åˆ°æ›´å°‘çš„æ ‡å‡†é”®ç›˜å¿«æ·é”®ï¼Œå¯ä»¥ä½¿ç”¨qé€€å‡ºã€‚ 12345678910111213141516171819202122================================================================================Available Candidates================================================================================q-quit /-search downj-down ?-search upk-up h-help--------------------------------------------------------------------------------Groovy (2.4.5) http://www.groovy-lang.org/Groovy is a powerful, optionally typed and dynamic language, with static-typingand static compilation capabilities, for the Java platform aimed at multiplyingdevelopersâ€™ productivity thanks to a concise, familiar and easy to learn syntax.It integrates smoothly with any Java program, and immediately delivers to yourapplication powerful features, including scripting capabilities, Domain-SpecificLanguage authoring, runtime and compile-time meta-programming and functionalprogramming. $ sdk install groovy--------------------------------------------------------------------------------Scala (2.11.7) http://www.scala-lang.org/... ç‰ˆæœ¬åˆ—è¡¨è¦è·å¾—å€™é€‰ç‰ˆæœ¬çš„åˆ—è¡¨: 1sdk list groovy è¿™å°†äº§ç”Ÿä¸€ä¸ªåˆ—è¡¨è§†å›¾ï¼Œæ˜¾ç¤ºSDKçš„å¯ç”¨ã€æœ¬åœ°ã€å®‰è£…å’Œå½“å‰ç‰ˆæœ¬ã€‚ 12345678910111213141516171819202122232425================================================================================Available Groovy Versions================================================================================ &gt; * 2.4.4 2.3.1 2.0.8 1.8.3 2.4.3 2.3.0 2.0.7 1.8.2 2.4.2 2.2.2 2.0.6 1.8.1 2.4.1 2.2.1 2.0.5 1.8.0 2.4.0 2.2.0 2.0.4 1.7.9 2.3.9 2.1.9 2.0.3 1.7.8 2.3.8 2.1.8 2.0.2 1.7.7 2.3.7 2.1.7 2.0.1 1.7.6 2.3.6 2.1.6 2.0.0 1.7.5 2.3.5 2.1.5 1.8.9 1.7.4 2.3.4 2.1.4 1.8.8 1.7.3 2.3.3 2.1.3 1.8.7 1.7.2 2.3.2 2.1.2 1.8.6 1.7.11 2.3.11 2.1.1 1.8.5 1.7.10 2.3.10 2.1.0 1.8.4 1.7.1================================================================================+ - local version* - installed&gt; - currently in use================================================================================ ä½¿ç”¨ç‰ˆæœ¬åœ¨å½“å‰ç»ˆç«¯é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªç»™å®šç‰ˆæœ¬: 1$ sdk use scala 2.12.1 é‡è¦çš„æ˜¯è¦è®¤è¯†åˆ°ï¼Œè¿™å°†åªæ”¹å˜å½“å‰shellçš„å€™é€‰ç‰ˆæœ¬ã€‚è¦ä½¿æ­¤æ›´æ”¹æŒä¹…ï¼Œè¯·ä½¿ç”¨defaultå‘½ä»¤ã€‚ é»˜è®¤çš„ç‰ˆæœ¬é€‰æ‹©ä¸€ä¸ªç»™å®šç‰ˆæœ¬çš„é»˜è®¤å€¼: 1$ sdk default scala 2.11.6 è¿™å°†ç¡®ä¿æ‰€æœ‰åç»­çš„shelléƒ½å°†ä»¥2.11.6çš„ç‰ˆæœ¬å¼€å§‹ä½¿ç”¨ã€‚ å½“å‰ç‰ˆæœ¬(s)è¦äº†è§£ç›®å‰æ­£åœ¨ä½¿ç”¨çš„å€™é€‰: 12$ sdk current java Using java version 8u111 è¦äº†è§£ç›®å‰æ‰€æœ‰å€™é€‰çš„ä½¿ç”¨æƒ…å†µ: 12345$ sdk current Using: groovy: 2.4.7 java: 8u111 scala: 2.12.1 è¿‡æ—¶çš„ç‰ˆæœ¬(s)çœ‹çœ‹ä½ çš„ç³»ç»Ÿä¸Šçš„å€™é€‰äººç›®å‰çš„æƒ…å†µæ˜¯æ€æ ·çš„: 123$ sdk outdated springboot Outdated: springboot (1.2.4.RELEASE, 1.2.3.RELEASE &lt; 1.2.5.RELEASE) çœ‹çœ‹æ‰€æœ‰å€™é€‰éƒ½è¿‡æ—¶äº†: 12345$ sdk outdated Outdated: gradle (2.3, 1.11, 2.4, 2.5 &lt; 2.6) grails (2.5.1 &lt; 3.0.4) springboot (1.2.4.RELEASE, 1.2.3.RELEASE &lt; 1.2.5.RELEASE) SDKMANï¼ç‰ˆæœ¬æ˜¾ç¤ºå½“å‰çš„SDKMANï¼ç‰ˆæœ¬ 1$ sdk version å¹¿æ’­æ¶ˆæ¯åœ¨å‘½ä»¤è¡Œä¸Šè·å–æœ€æ–°çš„SDKå‘å¸ƒé€šçŸ¥: 1234567$ sdk broadcast==== BROADCAST =================================================================* 06/12/16: Scala 2.12.1 released on SDKMAN! #scala* 23/11/16: Gradle 3.2.1 released on SDKMAN! #gradle* 22/11/16: Ceylon 1.3.1 released on SDKMAN! #ceylonlang================================================================================ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ¯å½“åœ¨SDKMAN!ä¸Šå‘å¸ƒä¸€ä¸ªSDKç‰ˆæœ¬æ—¶ï¼Œåœ¨ä½¿ç”¨CLIæ—¶å°†ä¼šå‡ºç°ä¸€ä¸ªé€šçŸ¥ã€‚æ¯ä¸€æ¬¡æ–°çš„å¹¿æ’­éƒ½è¢«æ¨åˆ°æ¨ç‰¹ä¸Šã€‚ ç¦»çº¿æ¨¡å¼æœ€åˆè¢«ç§°ä¸ºâ€œé£æœºæ¨¡å¼â€ï¼Œå®ƒå…è®¸SDKMAN!åœ¨ç¦»çº¿å·¥ä½œæ—¶å‘æŒ¥ä½œç”¨ã€‚å®ƒæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥å¯ç”¨æˆ–ç¦ç”¨ç¦»çº¿æ¨¡å¼ã€‚ 123456$ sdk offline enable Forced offline mode enabled.$ sdk offline disable Online mode re-enabled! å½“åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œå¤§å¤šæ•°å‘½ä»¤ä»ç„¶å¯ä»¥å·¥ä½œï¼Œå³ä½¿å®ƒä»¬çš„æ“ä½œæ˜¯ç¼©å°çš„ã€‚ä¸€ä¸ªä¾‹å­æ˜¯listå‘½ä»¤ï¼Œå®ƒåªæ˜¾ç¤ºå½“å‰å®‰è£…çš„å’Œæ´»åŠ¨çš„ç‰ˆæœ¬(s): 12345678910$ sdk list ------------------------------------------------------------ Offline Mode: only showing installed groovy versions ------------------------------------------------------------ &gt; 2.4.4 * 2.4.3 ------------------------------------------------------------ * - installed &gt; - currently in use ------------------------------------------------------------ å½“å› ç‰¹ç½‘å˜å¾—å¯ç”¨/ä¸å¯ç”¨æ—¶ï¼Œç¦»çº¿æ¨¡å¼ä¹Ÿå°†è‡ªåŠ¨ç¦ç”¨/å¯ç”¨ã€‚å½“ç„¶ï¼Œéœ€è¦ç½‘ç»œè¿æ¥çš„å‘½ä»¤ä¸ä¼šèµ·ä½œç”¨ï¼Œä½†ä¼šå‘å‡ºè­¦å‘Šã€‚ è‡ªå‡çº§å®‰è£…ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„SDKMANï¼å¦‚æœå¯ç”¨ã€‚ 1$ sdk selfupdate å¦‚æœæ²¡æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œå°†æ˜¾ç¤ºé€‚å½“çš„æ¶ˆæ¯ã€‚é‡æ–°å®‰è£…å¯èƒ½æ˜¯é€šè¿‡å°†forceå‚æ•°ä¼ é€’ç»™å‘½ä»¤: 1$ sdk selfupdate force è‡ªåŠ¨æ£€æŸ¥æ–°ç‰ˆæœ¬çš„SDKMANï¼ä¹Ÿå°†ä»£è¡¨ç”¨æˆ·æ‰§è¡Œã€‚ å†²æ´—æœ‰æ—¶å¯èƒ½éœ€è¦å†²æ´— SDKMAN!çš„æœ¬åœ°çŠ¶æ€ã€‚flushå‘½ä»¤å¯ä»¥å¸®åŠ©æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œå¹¶å…è®¸æ‰§è¡Œä»¥ä¸‹æ“ä½œ: Candidates1$ sdk flush candidates æ¸…é™¤å€™é€‰åˆ—è¡¨ã€‚æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å°†è·å–å¹¶å­˜å‚¨æœ€æ–°çš„åˆ—è¡¨ã€‚å½“ä¸€ä¸ªæ–°çš„å€™é€‰åœ¨SDKMANä¸Šå¯ç”¨æ—¶ï¼Œé€šå¸¸éœ€è¦è¿™æ ·åš Broadcast1$ sdk flush broadcast æ¸…é™¤å¹¿æ’­ç¼“å­˜ï¼Œä¸‹è½½ä¸‹ä¸€ä¸ªå‘½ä»¤è°ƒç”¨çš„æœ€æ–°å¯ç”¨æ–°é—»ã€‚ Archives1$ sdk flush archives æ¸…é™¤åŒ…å«æ‰€æœ‰ä¸‹è½½çš„SDKäºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼“å­˜ã€‚è¿™å¯ä»¥å ç”¨å¾ˆå¤šç©ºé—´ï¼Œæ‰€ä»¥å€¼å¾—ä¸æ—¶åœ°æ¸…ç†ä¸€ä¸‹ï¼ ä¸´æ—¶æ–‡ä»¶å¤¹1$ sdk flush temp åœ¨å®‰è£…æ–°ç‰ˆæœ¬çš„å€™é€‰ç‰ˆæœ¬å’ŒSDKMANçš„æ—¶å€™ï¼Œæ¸…é™¤å‡†å¤‡å·¥ä½œæ–‡ä»¶å¤¹ã€‚ å¸®åŠ©æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è·å¾—åŸºæœ¬çš„å¸®åŠ©: 1$ sdk help è¿™åº”è¯¥ä¼šäº§ç”Ÿä¸€äº›ç±»ä¼¼çš„ä¸œè¥¿: 12345678910111213141516171819202122Usage: sdk [version] sdk offline commands: install or i [version] uninstall or rm list or ls use or u [version] default or d [version] current or c [candidate] outdated or o [candidate] version or v broadcast or b help or h offline selfupdate [force] flush candidate : ... version : where optional, defaults to latest stable if not providedeg: sdk install groovy é…ç½®å°½ç®¡é…ç½®æ˜¯æœ‰é™çš„ï¼Œä½†æ˜¯å¯é…ç½®é¡¹çš„åˆ—è¡¨ä¼šéšç€éœ€è¦è€Œå¢é•¿ã€‚å¯ä»¥åœ¨~/.sdkman/etc/configæ–‡ä»¶ä¸­æ‰¾åˆ°é…ç½®ã€‚ç›®å‰ï¼Œä»¥ä¸‹æ˜¯å¯é…ç½®çš„: 1234567891011121314151617181920# make sdkman non-interactive, preferred for CI environmentssdkman_auto_answer=true|false# perform automatic selfupdatessdkman_auto_selfupdate=true|false# disables SSL certificate verification# https://github.com/sdkman/sdkman-cli/issues/327# HERE BE DRAGONS....sdkman_insecure_ssl=true|false# disable GVM alias, for users of the Go Version Managersdkman_disable_gvm_alias=true|false# configure curl timeoutssdkman_curl_connect_timeout=5sdkman_curl_max_time=4# subscribe to the beta channelsdkman_beta_channel=true Windows PowerShell ä½¿ç”¨SDKMAN","categories":[{"name":"åŒ…ç®¡ç†å™¨","slug":"åŒ…ç®¡ç†å™¨","permalink":"https://jigangduan.github.io/categories/åŒ…ç®¡ç†å™¨/"}],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/tags/å·¥å…·/"},{"name":"jvm","slug":"jvm","permalink":"https://jigangduan.github.io/tags/jvm/"}]},{"title":"CocoaPods ç®€ä»‹","slug":"cocoapods","date":"2017-11-30T05:03:18.000Z","updated":"2020-07-25T02:57:18.196Z","comments":true,"path":"2017/11/30/cocoapods/","link":"","permalink":"https://jigangduan.github.io/2017/11/30/cocoapods/","excerpt":"CocoaPodsæ˜¯Swiftå’ŒObjective-C Cocoaé¡¹ç›®çš„ä¸€ä¸ªä¾èµ–å…³ç³»ç®¡ç†å™¨ã€‚å®ƒæœ‰è¶…è¿‡4ä¸‡ä¸ªlibrariesï¼Œåœ¨è¶…è¿‡280ä¸‡ä¸ªåº”ç”¨ç¨‹åºä¸­è¢«ä½¿ç”¨ã€‚CocoaPodså¯ä»¥å¸®åŠ©ä½ ä¼˜é›…åœ°æ‰©å±•ä½ çš„é¡¹ç›®ã€‚","text":"CocoaPodsæ˜¯Swiftå’ŒObjective-C Cocoaé¡¹ç›®çš„ä¸€ä¸ªä¾èµ–å…³ç³»ç®¡ç†å™¨ã€‚å®ƒæœ‰è¶…è¿‡4ä¸‡ä¸ªlibrariesï¼Œåœ¨è¶…è¿‡280ä¸‡ä¸ªåº”ç”¨ç¨‹åºä¸­è¢«ä½¿ç”¨ã€‚CocoaPodså¯ä»¥å¸®åŠ©ä½ ä¼˜é›…åœ°æ‰©å±•ä½ çš„é¡¹ç›®ã€‚ å®‰è£…CocoaPodsæ˜¯ç”¨Rubyæ„å»ºçš„ï¼Œåœ¨OS Xä¸Šé»˜è®¤å®‰è£…æœ‰Rubyï¼Œæˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨é»˜è®¤çš„Rubyã€‚ ä½¿ç”¨é»˜è®¤çš„Rubyå®‰è£…è¦æ±‚æ‚¨åœ¨å®‰è£…gemsæ—¶ä½¿ç”¨sudoã€‚æŒ‡å—ä¸­è¿˜æœ‰è¿›ä¸€æ­¥çš„å®‰è£…è¯´æ˜ã€‚ 12# Xcode 8 + 9$ sudo gem install cocoapods å¼€å§‹åœ¨Xcodeé¡¹ç›®ç›®å½•ä¸­åˆ—å‡ºä¸€ä¸ªåä¸ºPodfileçš„æ–‡æœ¬æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹: 12345678platform :ios, '8.0'use_frameworks!target 'MyApp' do pod 'AFNetworking', '~&gt; 2.6' pod 'ORStackView', '~&gt; 3.0' pod 'SwiftyJSON', '~&gt; 2.3'end æç¤º: CocoaPodsæä¾›äº†ä¸€ä¸ªpod initå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ™ºèƒ½é»˜è®¤å€¼çš„Podfileã€‚ä½ åº”è¯¥ä½¿ç”¨å®ƒã€‚ ç°åœ¨æ‚¨å¯ä»¥åœ¨æ‚¨çš„é¡¹ç›®ä¸­å®‰è£…ä¾èµ–é¡¹: 1$ pod install åœ¨æ„å»ºé¡¹ç›®æ—¶ï¼Œç¡®ä¿å§‹ç»ˆæ‰“å¼€Xcodeå·¥ä½œåŒºï¼Œè€Œä¸æ˜¯é¡¹ç›®æ–‡ä»¶: 1$ open App.xcworkspace ç°åœ¨æ‚¨å¯ä»¥å¯¼å…¥æ‚¨çš„ä¾èµ–é¡¹äº†: 1#import &lt;Reachability/Reachability.h&gt; åˆ›å»ºpodæœ‰æ—¶å€™ï¼Œå¯¹äºä½ çš„ä¸€ä¸ªä¾èµ–é¡¹ï¼ŒCocoaPodsè¿˜æ²¡æœ‰ä¸€ä¸ªpodã€‚å¹¸è¿çš„æ˜¯ï¼Œåˆ›å»ºpodéå¸¸ç®€å•: 123$ pod spec create Peanut$ edit Peanut.podspec$ pod spec lint Peanut.podspec ä½ å¯ä»¥åœ¨æŒ‡å—ä¸­æ‰¾åˆ°å¾ˆå¤šå…³äºè¿™ä¸ªè¿‡ç¨‹çš„ä¿¡æ¯ã€‚å½“ä½ å®Œæˆçš„æ—¶å€™ï¼Œä½ å¯ä»¥å¾—åˆ°ä¸€ä¸ªè´¦æˆ·ï¼ŒæŠŠä½ çš„podæ¨åˆ°CocoaPodsçš„æ ‘å¹²ä¸Šã€‚","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"åŒ…ç®¡ç†å™¨","slug":"iOS/åŒ…ç®¡ç†å™¨","permalink":"https://jigangduan.github.io/categories/iOS/åŒ…ç®¡ç†å™¨/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"cocoapods","slug":"cocoapods","permalink":"https://jigangduan.github.io/tags/cocoapods/"}]},{"title":"Android è‡ªåŠ¨åŒ–æµ‹è¯• - ç¬¬6éƒ¨åˆ†","slug":"introduction-automated-android-testing-part-6","date":"2017-11-20T10:31:58.000Z","updated":"2020-07-25T02:57:18.209Z","comments":true,"path":"2017/11/20/introduction-automated-android-testing-part-6/","link":"","permalink":"https://jigangduan.github.io/2017/11/20/introduction-automated-android-testing-part-6/","excerpt":"åœ¨ä¹‹å‰çš„5ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä»å¤´å¼€å§‹æ„å»ºAndroidåº”ç”¨çš„ä¸åŒæ–¹é¢ã€‚æˆ‘ä»¬ä¸“æ³¨äºåœ¨è¿‡ç¨‹ä¸­åŒ…æ‹¬æµ‹è¯•ã€‚ä»¥ä¸‹æ˜¯ä¸å‰å‡ ç¯‡æ–‡ç« çš„é“¾æ¥: ç¬¬1éƒ¨åˆ† - ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å†™æµ‹è¯•? ç¬¬2éƒ¨åˆ† - è¿›è¡Œæµ‹è¯•è®¾ç½®ä½ çš„åº”ç”¨ç¨‹åº ç¬¬3éƒ¨åˆ† - åˆ›å»ºAPIè°ƒç”¨ ç¬¬4éƒ¨åˆ† - åˆ›å»ºrepositories ç¬¬5éƒ¨åˆ† - éµå¾ªMVPæ¨¡å¼ åœ¨æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸ºæˆ‘ä»¬åœ¨ç¬¬5éƒ¨åˆ†ä¸­åˆ›å»ºçš„è§†å›¾åˆ›å»ºEspressoæµ‹è¯•ã€‚è¿™ç¯‡æ–‡ç« çš„Github repoå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚ å¦‚æœæ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œé‚£ä¹ˆæµ‹è¯•ä¸€ä¸ªè§†å›¾åŒ…å«æ‰€æœŸæœ›çš„ç¡®åˆ‡ä¿¡æ¯æ˜¯å¾ˆæ£˜æ‰‹çš„ã€‚è¿™äº›æ•°æ®å¯ä»¥éšæ—¶æ›´æ”¹ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ä¸åº”è¯¥å› ä¸ºå®ƒè€Œå¤±è´¥ã€‚ä¸ºäº†ä½¿æµ‹è¯•å¯é ä¸”å¯é‡å¤ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è°ƒç”¨ä»»ä½•ç”Ÿäº§APIsã€‚ æ¨¡æ‹ŸAPIè°ƒç”¨çš„å“åº”å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ä¾èµ–äºæ¨¡æ‹Ÿæ•°æ®çš„æµ‹è¯•ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿæˆ‘ä»¬çš„APIè°ƒç”¨: é€‰é¡¹1 - ä½¿ç”¨WireMockå¹¶è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œå®ƒä¸ºç‰¹å®šçš„ç½‘ç»œè°ƒç”¨æä¾›ç›¸åŒçš„é™æ€JSONã€‚ é€‰é¡¹2 - ä½¿ç”¨OkHttpçš„MockWebServerï¼Œå®ƒåœ¨ä½ çš„è®¾å¤‡ä¸Šè¿è¡Œä¸€ä¸ªwebserverï¼Œå¹¶æä¾›ä½ æ‰€è¯·æ±‚çš„ä»»ä½•å“åº”ã€‚ é€‰é¡¹3 - åˆ›å»ºä¸€ä¸ªè¿”å›è™šæ‹Ÿå¯¹è±¡çš„Retrofit RESTæ¥å£çš„è‡ªå®šä¹‰å®ç°ã€‚ æ˜¾ç„¶ï¼Œè¿™ä¸ªé€‰æ‹©å®Œå…¨å–å†³äºæ‚¨å¦‚ä½•ç¼–å†™UIæµ‹è¯•ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼ŒWireMockæ˜¯é¢å¤–çš„å·¥ä½œï¼Œå› ä¸ºæˆ‘éœ€è¦ç¡®ä¿æˆ‘æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œå®ƒè¿è¡Œçš„æ˜¯ä¸€ä¸ªé™æ€IPåœ°å€ã€‚ ä¸WireMockç›¸æ¯”ï¼ŒMockWebServerè¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºæ‚¨ä¸éœ€è¦è®¾ç½®ä¸€ä¸ªç‹¬ç«‹çš„webæœåŠ¡å™¨(æœåŠ¡å™¨åœ¨è®¾å¤‡ä¸Šè¿è¡Œ)ã€‚MockWebServerä¹Ÿå¾ˆçµæ´»ï¼Œå› ä¸ºæ‚¨å¯ä»¥ç»™å®ƒä¸åŒçš„åœºæ™¯ã€‚ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æŒ‡å®šæŸä¸ªè°ƒç”¨çš„å¤±è´¥ç‡æˆ–æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œï¼Œéƒ½æ˜¯å¯ä»¥ä½¿ç”¨MockWebServerå®ç°çš„ã€‚(é˜…è¯»æ›´å¤šè¿™é‡Œ) æˆ‘å°†ä½¿ç”¨é€‰é¡¹3æ¥æµ‹è¯•UIä¸æ¨¡æ‹Ÿå“åº”æ•°æ®åŒ¹é…çš„ç›®çš„ã€‚å¦‚æœæˆ‘æƒ³ä¸ºæ…¢ç½‘ç»œç¯å¢ƒæ·»åŠ æµ‹è¯•(æˆ–æŸç§éåŠŸèƒ½æµ‹è¯•)ï¼Œæˆ‘å°†é€‰æ‹©é€‰é¡¹2ã€‚å¦‚æœæ‚¨ä¸èƒ½ä½¿ç”¨OkHttpï¼Œé‚£ä¹ˆæˆ‘å°†é€‰æ‹©é€‰é¡¹1ä½œä¸ºWiremockä¸ä»»ä½•HTTPå®¢æˆ·æœºä¸€èµ·å·¥ä½œã€‚","text":"åœ¨ä¹‹å‰çš„5ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä»å¤´å¼€å§‹æ„å»ºAndroidåº”ç”¨çš„ä¸åŒæ–¹é¢ã€‚æˆ‘ä»¬ä¸“æ³¨äºåœ¨è¿‡ç¨‹ä¸­åŒ…æ‹¬æµ‹è¯•ã€‚ä»¥ä¸‹æ˜¯ä¸å‰å‡ ç¯‡æ–‡ç« çš„é“¾æ¥: ç¬¬1éƒ¨åˆ† - ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å†™æµ‹è¯•? ç¬¬2éƒ¨åˆ† - è¿›è¡Œæµ‹è¯•è®¾ç½®ä½ çš„åº”ç”¨ç¨‹åº ç¬¬3éƒ¨åˆ† - åˆ›å»ºAPIè°ƒç”¨ ç¬¬4éƒ¨åˆ† - åˆ›å»ºrepositories ç¬¬5éƒ¨åˆ† - éµå¾ªMVPæ¨¡å¼ åœ¨æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸ºæˆ‘ä»¬åœ¨ç¬¬5éƒ¨åˆ†ä¸­åˆ›å»ºçš„è§†å›¾åˆ›å»ºEspressoæµ‹è¯•ã€‚è¿™ç¯‡æ–‡ç« çš„Github repoå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚ å¦‚æœæ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œé‚£ä¹ˆæµ‹è¯•ä¸€ä¸ªè§†å›¾åŒ…å«æ‰€æœŸæœ›çš„ç¡®åˆ‡ä¿¡æ¯æ˜¯å¾ˆæ£˜æ‰‹çš„ã€‚è¿™äº›æ•°æ®å¯ä»¥éšæ—¶æ›´æ”¹ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ä¸åº”è¯¥å› ä¸ºå®ƒè€Œå¤±è´¥ã€‚ä¸ºäº†ä½¿æµ‹è¯•å¯é ä¸”å¯é‡å¤ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è°ƒç”¨ä»»ä½•ç”Ÿäº§APIsã€‚ æ¨¡æ‹ŸAPIè°ƒç”¨çš„å“åº”å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ä¾èµ–äºæ¨¡æ‹Ÿæ•°æ®çš„æµ‹è¯•ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿæˆ‘ä»¬çš„APIè°ƒç”¨: é€‰é¡¹1 - ä½¿ç”¨WireMockå¹¶è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œå®ƒä¸ºç‰¹å®šçš„ç½‘ç»œè°ƒç”¨æä¾›ç›¸åŒçš„é™æ€JSONã€‚ é€‰é¡¹2 - ä½¿ç”¨OkHttpçš„MockWebServerï¼Œå®ƒåœ¨ä½ çš„è®¾å¤‡ä¸Šè¿è¡Œä¸€ä¸ªwebserverï¼Œå¹¶æä¾›ä½ æ‰€è¯·æ±‚çš„ä»»ä½•å“åº”ã€‚ é€‰é¡¹3 - åˆ›å»ºä¸€ä¸ªè¿”å›è™šæ‹Ÿå¯¹è±¡çš„Retrofit RESTæ¥å£çš„è‡ªå®šä¹‰å®ç°ã€‚ æ˜¾ç„¶ï¼Œè¿™ä¸ªé€‰æ‹©å®Œå…¨å–å†³äºæ‚¨å¦‚ä½•ç¼–å†™UIæµ‹è¯•ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼ŒWireMockæ˜¯é¢å¤–çš„å·¥ä½œï¼Œå› ä¸ºæˆ‘éœ€è¦ç¡®ä¿æˆ‘æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œå®ƒè¿è¡Œçš„æ˜¯ä¸€ä¸ªé™æ€IPåœ°å€ã€‚ ä¸WireMockç›¸æ¯”ï¼ŒMockWebServerè¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºæ‚¨ä¸éœ€è¦è®¾ç½®ä¸€ä¸ªç‹¬ç«‹çš„webæœåŠ¡å™¨(æœåŠ¡å™¨åœ¨è®¾å¤‡ä¸Šè¿è¡Œ)ã€‚MockWebServerä¹Ÿå¾ˆçµæ´»ï¼Œå› ä¸ºæ‚¨å¯ä»¥ç»™å®ƒä¸åŒçš„åœºæ™¯ã€‚ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æŒ‡å®šæŸä¸ªè°ƒç”¨çš„å¤±è´¥ç‡æˆ–æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œï¼Œéƒ½æ˜¯å¯ä»¥ä½¿ç”¨MockWebServerå®ç°çš„ã€‚(é˜…è¯»æ›´å¤šè¿™é‡Œ) æˆ‘å°†ä½¿ç”¨é€‰é¡¹3æ¥æµ‹è¯•UIä¸æ¨¡æ‹Ÿå“åº”æ•°æ®åŒ¹é…çš„ç›®çš„ã€‚å¦‚æœæˆ‘æƒ³ä¸ºæ…¢ç½‘ç»œç¯å¢ƒæ·»åŠ æµ‹è¯•(æˆ–æŸç§éåŠŸèƒ½æµ‹è¯•)ï¼Œæˆ‘å°†é€‰æ‹©é€‰é¡¹2ã€‚å¦‚æœæ‚¨ä¸èƒ½ä½¿ç”¨OkHttpï¼Œé‚£ä¹ˆæˆ‘å°†é€‰æ‹©é€‰é¡¹1ä½œä¸ºWiremockä¸ä»»ä½•HTTPå®¢æˆ·æœºä¸€èµ·å·¥ä½œã€‚ ç”¨Gradle flavorsæ¥æ¨¡æ‹Ÿæ•°æ®é€šè¿‡ä½¿ç”¨Gradle flavorsï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ¨¡æ‹Ÿå‡ºAPIçš„å“åº”ã€‚å¦‚æœä½ è¯»äº†ç¬¬äºŒç¯‡å…³äºGradle flavorsçš„æ–‡ç« ï¼Œä½ åº”è¯¥å·²ç»æœ‰äº†ä¸€ä¸ªâ€œmockâ€å’Œâ€œproductionâ€çš„flavorã€‚ ç¡®ä¿æ‚¨å·²ç»åˆ‡æ¢åˆ°mockDebug flavorã€‚ åœ¨srcç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªmockæ–‡ä»¶å¤¹ã€‚ ç„¶ååœ¨mockæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåŒ…ï¼Œå®ƒæ¨¡ä»¿äº†ä¸»åŒ…åã€‚ä½¿ä¸€ä¸ªç±»ç§°ä¸ºMockGithubUserRestServiceImplã€‚æœ€ç»ˆçš„æ–‡ä»¶ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„: ![](https://i0.wp.com/riggaroo.co.za/wp-content/uploads/2016/09/Screen-Shot-2016-09-02-at-11.41.31-AM.png?ssl=1) åˆ›å»ºä¸€ä¸ªprodç›®å½• å°†å…ˆå‰å®šä¹‰çš„Injectionç±»ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚æˆ‘ä»¬å°†åœ¨mockæ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¦ä¸€ä¸ªInjectionç±»ã€‚è¿™ä¸ªç±»å°†ä¼šæ³¨å…¥è¢«æ¨¡æ‹Ÿçš„GithubæœåŠ¡ï¼Œè€Œä¸æ˜¯ç”Ÿäº§APIã€‚ ![](https://i1.wp.com/riggaroo.co.za/wp-content/uploads/2016/09/Screen-Shot-2016-09-02-at-12.14.31-PM.png?resize=612%2C1024&amp;ssl=1) åœ¨Injectionç±»ä½äº**mock**æ–‡ä»¶å¤¹ä¸­,æˆ‘ä»¬ç®€å•åœ°è¿”å›MockGithubUserServiceImplåˆ›å»ºã€‚ åœ¨prodæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å°†è¿”å›å®é™…çš„æ›´æ–°GithubæœåŠ¡ã€‚ Mock Injectionç±»: 123456789101112131415public class Injection &#123; private static GithubUserRestService userRestService; public static UserRepository provideUserRepo() &#123; return new UserRepositoryImpl(provideGithubUserRestService()); &#125; static GithubUserRestService provideGithubUserRestService() &#123; if (userRestService == null) &#123; userRestService = new MockGithubUserRestServiceImpl(); &#125; return userRestService; &#125;&#125; Prodæ³¨å°„ç±»: 123456789101112131415161718192021222324252627282930313233343536373839public class Injection &#123; private static final String BASE_URL = \"https://api.github.com\"; private static OkHttpClient okHttpClient; private static GithubUserRestService userRestService; private static Retrofit retrofitInstance; public static UserRepository provideUserRepo() &#123; return new UserRepositoryImpl(provideGithubUserRestService()); &#125; static GithubUserRestService provideGithubUserRestService() &#123; if (userRestService == null) &#123; userRestService = getRetrofitInstance().create(GithubUserRestService.class); &#125; return userRestService; &#125; static OkHttpClient getOkHttpClient() &#123; if (okHttpClient == null) &#123; HttpLoggingInterceptor logging = new HttpLoggingInterceptor(); logging.setLevel(HttpLoggingInterceptor.Level.BASIC); okHttpClient = new OkHttpClient.Builder().addInterceptor(logging).build(); &#125; return okHttpClient; &#125; static Retrofit getRetrofitInstance() &#123; if (retrofitInstance == null) &#123; Retrofit.Builder retrofit = new Retrofit.Builder().client(Injection.getOkHttpClient()).baseUrl(BASE_URL) .addConverterFactory(GsonConverterFactory.create()) .addCallAdapterFactory(RxJavaCallAdapterFactory.create()); retrofitInstance = retrofit.build(); &#125; return retrofitInstance; &#125;&#125; ä»æ¨¡æ‹ŸæœåŠ¡è¿”å›çš„æ•°æ®ä¾èµ–äºæ‚¨çš„ç‰¹å®šéœ€æ±‚ã€‚ ä¸‹é¢æ˜¯æˆ‘MockGithubUserRestServiceImplçš„å®ç°: 1234567891011121314151617181920212223242526272829public class MockGithubUserRestServiceImpl implements GithubUserRestService &#123; private final List&lt;User&gt; usersList = new ArrayList&lt;&gt;(); private User dummyUser1, dummyUser2; public MockGithubUserRestServiceImpl() &#123; dummyUser1 = new User(\"riggaroo\", \"Rebecca Franks\", \"https://riggaroo.co.za/wp-content/uploads/2016/03/rebeccafranks_circle.png\", \"Android Dev\"); dummyUser2 = new User(\"riggaroo2\", \"Rebecca's Alter Ego\", \"https://s-media-cache-ak0.pinimg.com/564x/e7/cf/f3/e7cff3be614f68782386bfbeecb304b1.jpg\", \"A unicorn\"); usersList.add(dummyUser1); usersList.add(dummyUser2); &#125; @Override public Observable&lt;UsersList&gt; searchGithubUsers(final String searchTerm) &#123; return Observable.just(new UsersList(usersList)); &#125; @Override public Observable&lt;User&gt; getUser(final String username) &#123; if (username.equals(\"riggaroo\")) &#123; return Observable.just(dummyUser1); &#125; else if (username.equals(\"riggaroo2\")) &#123; return Observable.just(dummyUser2); &#125; return Observable.just(null); &#125;&#125; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘åªæ˜¯è¿”å›ä¸€äº›è™šæ„çš„æ•°æ®ã€‚è®©æˆ‘ä»¬è¿è¡Œè¿™ä¸ªåº”ç”¨çš„æ¨¡æ‹Ÿç‰ˆæœ¬ï¼Œæ— è®ºä½ æœç´¢ä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚ ![](https://i1.wp.com/riggaroo.co.za/wp-content/uploads/2016/09/gif-dummydata.gif?resize=480%2C854&amp;ssl=1) ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå·¥ä½œè™šæ‹Ÿåº”ç”¨ç¨‹åºï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥å†™Espresso UIæµ‹è¯•ã€‚ å†™Espressoæµ‹è¯•çš„åŸºç¡€åœ¨ç¼–å†™ä¸€ä¸ªEspressoæµ‹è¯•æ—¶ï¼Œä¸‹é¢çš„å…¬å¼ç”¨äºåœ¨UIä¸­æ‰§è¡Œå‡½æ•°: 123onView(withId(R.id.menu_search)) // withId(R.id.menu_search) is a ViewMatcher .perform(click()) // click() is a ViewAction .check(matches(isDisplayed())); // matches(isDisplayed()) is a ViewAssertion ViewMatchers - ç”¨äºåœ¨activityä¸­æ‰¾åˆ°ä¸€ä¸ªè§†å›¾ã€‚æœ‰ä¸€å †ä¸åŒç§ç±»çš„matchersã€‚ä¾‹å¦‚:withId(R.id.menu_search)ã€withText(&quot;Search&quot;)ã€withTag(&quot;custom_tag&quot;)ã€‚ ViewActions - ç”¨äºä¸è§†å›¾äº¤äº’ã€‚ä¾‹å¦‚:click()ã€doubleClick()ã€swipeUp()ã€typeText() ViewAssertations - ç”¨äºæ–­è¨€æŸäº›è§†å›¾å…·æœ‰ç‰¹å®šçš„å±æ€§ã€‚ä¾‹å¦‚:doesNotExist()ã€isAbove()ã€isBelow()ã€‚ å¯¹äºä¸åŒçš„Espressoæ–¹æ³•ï¼Œæœ‰ä¸€ä¸ªå¾ˆå¥½çš„å¤‡å¿˜å•ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°pdfæ ¼å¼çš„:android-espresso-testing.pdfã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨å†™Espressoæµ‹è¯•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ™®é€šçš„hamcrest matchersã€‚æ–¹æ³•å¦‚not(), allOf() å’Œ anyOf()éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ ç¼–å†™Espresso UIæµ‹è¯•å¦‚æœæ‚¨è¿˜è®°å¾—ï¼Œåœ¨ç¬¬2ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†éœ€è¦æ·»åŠ å“ªäº›ä¾èµ–é¡¹æ¥ç¼–å†™Espressoæµ‹è¯•ã€‚ç°åœ¨æˆ‘ä»¬æ¥å†™ä¸€ä»½Espressoæµ‹è¯•ã€‚ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹androidTestMockã€‚ è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æµ‹è¯•åªè¿è¡Œåœ¨mockçš„å˜ä½“ä¸Šï¼Œè€Œä¸æ˜¯åœ¨productionç‰ˆæœ¬ä¸Šã€‚ç„¶ååˆ›å»ºä¸€ä¸ªä¸ä¸»åŒ…ååŒ¹é…çš„ç›®å½•ã€‚åœ¨è¯¥ç›®å½•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªåä¸ºUserSearchActivityTestçš„æ–°ç±»ã€‚ä½ çš„é¡¹ç›®åº”è¯¥æ˜¯è¿™æ ·çš„: ![](https://i1.wp.com/riggaroo.co.za/wp-content/uploads/2016/09/AndroidTestMock_folder.png?resize=768%2C703&amp;ssl=1) æˆ‘ä»¬å°†é¦–å…ˆç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„æµ‹è¯•ï¼Œä»¥ç¡®ä¿å½“activityå¯åŠ¨æ—¶ï¼Œæ–‡æœ¬â€œå¼€å§‹é”®å…¥æœç´¢â€å°†æ˜¾ç¤ºå‡ºæ¥: 1234567891011121314public class UserSearchActivityTest &#123; @Rule public ActivityTestRule&lt;UserSearchActivity&gt; testRule = new ActivityTestRule&lt;&gt;(UserSearchActivity.class); @Test public void searchActivity_onLaunch_HintTextDisplayed()&#123; //Given activity automatically launched //When user doesn't interact with the view //Then onView(withText(\"Start typing to search\")) .check(matches(isDisplayed())); &#125;&#125; @Rule ActivityTestRuleæŒ‡å®šè¯¥æµ‹è¯•å°†ä½¿ç”¨å“ªä¸ªactivityã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæµ‹è¯•å°†ä½¿ç”¨UserSearchActivityè¿è¡Œã€‚è¿™å°†è‡ªåŠ¨å¯åŠ¨UserSearchActivityã€‚ä¼ é€’é¢å¤–å‚æ•°å°†æŒ‡ç¤ºæ‚¨æ˜¯å¦å¸Œæœ›è¯¥activityè‡ªåŠ¨å¯åŠ¨æˆ–ä¸å¯åŠ¨ã€‚ æµ‹è¯•searchActivity_onLaunch_HintTextDisplayed()æ˜¯éå¸¸ç®€å•çš„ã€‚å®ƒåœ¨è§†å›¾ä¸­æœç´¢æ–‡æœ¬ï¼Œå¹¶æ–­è¨€æ–‡æœ¬åœ¨UIä¸­å¯è§ ä¸‹ä¸€æ­¥æµ‹è¯•ç¨å¾®å¤æ‚ä¸€ç‚¹: 12345678910111213141516@Testpublic void searchText_ReturnsCorrectlyFromWebService_DisplaysResult() &#123; //Given activity is automatically launched //When onView(allOf(withId(R.id.menu_search), withEffectiveVisibility(ViewMatchers.Visibility.VISIBLE))).perform( click()); // When using a SearchView, there are two views that match the id menu_search - one that represents the icon, and the other the edit text view. We want to click on the visible one. onView(withId(R.id.search_src_text)).perform(typeText(\"riggaroo\"), pressKey(KeyEvent.KEYCODE_ENTER)); //Then onView(withText(\"Start typing to search\")).check(matches(not(isDisplayed()))); onView(withText(\"riggaroo - Rebecca Franks\")).check(matches(isDisplayed())); onView(withText(\"Android Dev\")).check(matches(isDisplayed())); onView(withText(\"A unicorn\")).check(matches(isDisplayed())); onView(withText(\"riggaroo2 - Rebecca's Alter Ego\")).check(matches(isDisplayed()));&#125; è¾“å…¥åˆ°SearchViewå¹¶æŒ‰enteré”®åï¼Œæˆ‘ä»¬æ–­è¨€å‡çš„ç»“æœä¼šæ˜¾ç¤ºåœ¨UIä¸Šã€‚ æˆ‘ä»¬ç°åœ¨å·²ç»ä¸ºç§¯æçš„åœºæ™¯ç¼–å†™äº†æµ‹è¯•ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥ä¸ºè¿™ä¸ªæ¶ˆæçš„æƒ…å†µæ·»åŠ ä¸€ä¸ªæµ‹è¯•ã€‚ æˆ‘ä»¬éœ€è¦è°ƒæ•´MockGithubUserRestServiceImplä¸ºäº†è®©å®ƒè¿”å›è‡ªå®šä¹‰é”™è¯¯å¯è§å¦‚æœéœ€è¦ã€‚ 12345678910111213private static Observable dummyGithubSearchResult = null;public static void setDummySearchGithubCallResult(Observable result) &#123; dummyGithubSearchResult = result;&#125;@Overridepublic Observable&lt;UsersList&gt; searchGithubUsers(final String searchTerm) &#123; if (dummyGithubSearchResult != null) &#123; return dummyGithubSearchResult; &#125; return Observable.just(new UsersList(usersList));&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºæœç´¢ç»“æœè®¾ç½®ä¸€ä¸ªå¯è§‚å¯Ÿçš„è™šæ‹Ÿæ•°æ®ã€‚ å½“searchGithubUsers()è¢«è°ƒç”¨æ—¶ï¼Œè¯¥å¯è§‚å¯Ÿçš„å€¼å°†è¢«è¿”å›ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ¥æ£€æŸ¥æ˜¯å¦åœ¨UIä¸Šæ˜¾ç¤ºäº†é”™è¯¯ã€‚ 123456789101112@Testpublic void searchText_ServiceCallFails_DisplayError()&#123; String errorMsg = \"Server Error\"; MockGithubUserRestServiceImpl.setDummySearchGithubCallResult(Observable.error(new Exception(errorMsg))); onView(allOf(withId(R.id.menu_search), withEffectiveVisibility(ViewMatchers.Visibility.VISIBLE))).perform( click()); // When using a SearchView, there are two views that match the id menu_search - one that represents the icon, and the other the edit text view. We want to click on the visible one. onView(withId(R.id.search_src_text)).perform(typeText(\"riggaroo\"), pressKey(KeyEvent.KEYCODE_ENTER)); onView(withText(errorMsg)).check(matches(isDisplayed()));&#125; åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç¡®ä¿æœåŠ¡å°†è¿”å›ä¸€ä¸ªå¼‚å¸¸ã€‚ç„¶åï¼Œæˆ‘ä»¬æ–­è¨€é”™è¯¯æ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨UIä¸Šã€‚ è®©æˆ‘ä»¬è¿è¡Œæµ‹è¯•: ä»–ä»¬éƒ½é€šè¿‡äº†! Androidä»£ç è¦†ç›–ç‡ä¸ºäº†äº†è§£æ‚¨çš„æµ‹è¯•æœ‰å¤šæœ‰æ•ˆï¼Œè·å¾—ä»£ç è¦†ç›–åº¦é‡æ˜¯éå¸¸æ£’çš„ã€‚ ä¸ºäº†åœ¨æ‚¨çš„UIæµ‹è¯•ä¸­å¯ç”¨ä»£ç è¦†ç›–ç‡ï¼Œå¯ä»¥åœ¨æ‚¨çš„build.gradle:ä¸­æ·»åŠ testCoverageEnabled = trueã€‚ 123456789buildTypes &#123; release &#123; minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' &#125; debug &#123; testCoverageEnabled = true &#125;&#125; è¿è¡Œä»»åŠ¡createMockDebugCoverageReportã€‚ä½ å°†åœ¨è¿™é‡Œæ‰¾åˆ°HTMLæŠ¥å‘Šæ‰€åœ¨åœ°:app/build/reports/coverage/mock/debug/index.htmlã€‚ Yay-æˆ‘ä»¬åªæœ‰æ¨¡æ‹ŸUIæµ‹è¯•çš„82%çš„è¦†ç›–ç‡ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬åœ¨ç¬¬å››ç¯‡å’Œè¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°è¯´æ˜æˆ‘ä»¬æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æµ‹è¯•è¦†ç›–ç‡ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿­ä»£åœ°è¿”å›å¹¶å°è¯•è¦†ç›–æ›´å¤šçš„ä»£ç åŒºåŸŸã€‚ PS-ä»£ç è¦†ç›–ç›®å‰ä¸Jackç¼–è¯‘å™¨ä¸å…¼å®¹ã€‚ä¸ºäº†ä½¿ä»£ç è¦†ç›–ç‡æŠ¥å‘Šå·¥ä½œï¼Œæˆ‘åˆ‡æ¢åˆ°ä½¿ç”¨Retrolambdaã€‚å¦‚æœä½ å¯¹å­¦ä¹ æœ‰å…´è¶£ï¼Œå¯ä»¥å»çœ‹çœ‹è¿™ä¸ªåˆ†æ”¯ã€‚ ç»“è®ºæˆ‘ä»¬å·²ç»å®Œæˆäº†æˆ‘ä»¬çš„åŠŸèƒ½ã€‚å”·!6çš„åšå®¢æ–‡ç« ã€‚æ˜¾ç„¶ï¼Œåœ¨è¿™æ¬¾åº”ç”¨ä¸­è¿˜å¯ä»¥å®Œæˆæ›´å¤šçš„æµ‹è¯•ï¼Œæ¯”å¦‚æµ‹è¯•ä½ çš„åº”ç”¨åœ¨ä½å†…å­˜è®¾å¤‡ä¸Šçš„è¡¨ç°ï¼Œæˆ–è€…åœ¨ç½‘ç»œè¿æ¥ä¸ä½³çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›éåŠŸèƒ½æµ‹è¯•ã€‚ è¿™ä¸€ç³»åˆ—çš„ç»“è®ºæ˜¯â€œå¼•å…¥Androidè‡ªåŠ¨åŒ–æµ‹è¯•â€ã€‚ è¿›ä¸€æ­¥çš„é˜…è¯» å…ˆè¿›çš„Espressoæµ‹è¯• â€“ Chiu-Ki â€“ https://realm.io/news/chiu-ki-chan-advanced-android-espresso-testing/ Screen Robots â€“ https://realm.io/news/kau-jake-wharton-testing-robots/ TestButler â€“ https://github.com/linkedin/test-butler","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"}]},{"title":"Android è‡ªåŠ¨åŒ–æµ‹è¯• - ç¬¬5éƒ¨åˆ†","slug":"introduction-automated-android-testing-part-5","date":"2017-11-20T09:15:26.000Z","updated":"2020-07-25T02:57:18.208Z","comments":true,"path":"2017/11/20/introduction-automated-android-testing-part-5/","link":"","permalink":"https://jigangduan.github.io/2017/11/20/introduction-automated-android-testing-part-5/","excerpt":"åœ¨è¿™ä¸€ç³»åˆ—çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”ç©¶ä¸€ä¸ªå«åšGithubç”¨æˆ·æœç´¢çš„æ ·æœ¬åº”ç”¨ã€‚ç¬¬1-4éƒ¨åˆ†ä»‹ç»äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥è¿›è¡Œæµ‹è¯•ã€è®¾ç½®æµ‹è¯•ã€åˆ›å»ºAPIè°ƒç”¨å¹¶åˆ›å»ºä¸€ä¸ªæ¼”ç¤ºç¨‹åºã€‚çœ‹ä¸€ä¸‹å‰é¢çš„æ–‡ç« ï¼Œç¬¬5éƒ¨åˆ†æ˜¯è¿™ä¸ªç³»åˆ—çš„å»¶ç»­ã€‚ åœ¨ç¬¬5éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹ä¸ç¬¬4éƒ¨åˆ†ä¸­åˆ›å»ºçš„Presenterçš„äº¤äº’ï¼Œæˆ‘ä»¬å°†åˆ›å»ºUIæ¥æ˜¾ç¤ºæœç´¢ç»“æœçš„åˆ—è¡¨ã€‚","text":"åœ¨è¿™ä¸€ç³»åˆ—çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”ç©¶ä¸€ä¸ªå«åšGithubç”¨æˆ·æœç´¢çš„æ ·æœ¬åº”ç”¨ã€‚ç¬¬1-4éƒ¨åˆ†ä»‹ç»äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥è¿›è¡Œæµ‹è¯•ã€è®¾ç½®æµ‹è¯•ã€åˆ›å»ºAPIè°ƒç”¨å¹¶åˆ›å»ºä¸€ä¸ªæ¼”ç¤ºç¨‹åºã€‚çœ‹ä¸€ä¸‹å‰é¢çš„æ–‡ç« ï¼Œç¬¬5éƒ¨åˆ†æ˜¯è¿™ä¸ªç³»åˆ—çš„å»¶ç»­ã€‚ åœ¨ç¬¬5éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹ä¸ç¬¬4éƒ¨åˆ†ä¸­åˆ›å»ºçš„Presenterçš„äº¤äº’ï¼Œæˆ‘ä»¬å°†åˆ›å»ºUIæ¥æ˜¾ç¤ºæœç´¢ç»“æœçš„åˆ—è¡¨ã€‚ åˆ›å»ºUIå¯¹äºç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç®€å•çš„åˆ—è¡¨æ¥æ˜¾ç¤ºåˆ—è¡¨ä¸­çš„avatarã€nameå’Œå…¶ä»–ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ç¬¬4éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªActivityåº”è¯¥å®ç°çš„è§†å›¾å¥‘çº¦ã€‚è¿™æ˜¯Androidä¸“ç”¨ä»£ç æ‰€åœ¨çš„ä½ç½®(è¯¸å¦‚å¯è§æ€§å˜åŒ–æˆ–ä»»ä½•UIæ›´æ”¹éƒ½å°†ä½äºæ­¤å¤„)ã€‚ä¸ºäº†æ›´æ–°ä½ çš„è®°å¿†ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„è§†å›¾å¥‘çº¦: 12345678910111213141516interface UserSearchContract &#123; interface View extends MvpView &#123; void showSearchResults(List&lt;User&gt; githubUserList); void showError(String message); void showLoading(); void hideLoading(); &#125; interface Presenter extends MvpPresenter&lt;View&gt; &#123; void search(String term); &#125;&#125; è®©æˆ‘ä»¬å®ç°è§†å›¾! åˆ›å»ºä¸€ä¸ªåä¸ºUserSearchActivityçš„ç±»ã€‚è¿™ä¸ªç±»å°†å®ç°UserSearchContract.Viewå¥‘çº¦å¹¶æ‰©å±•AppCompatActivityã€‚å®šä¹‰ä¸€ä¸ªå˜é‡userSearchPresenter UserSearchContract.Presenterç±»å‹ã€‚è¿™æ˜¯æˆ‘ä»¬å°†ä¸ä¹‹äº¤äº’çš„å¯¹è±¡ï¼Œä»¥æ‰§è¡Œæˆ‘ä»¬çš„ç½‘ç»œè°ƒç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839public class UserSearchActivity extends AppCompatActivity implements UserSearchContract.View &#123; private UserSearchContract.Presenter userSearchPresenter; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_user_search); userSearchPresenter = new UserSearchPresenter(Injection.provideUserRepo(), Schedulers.io(), AndroidSchedulers.mainThread()); userSearchPresenter.attachView(this); &#125; @Override protected void onDestroy() &#123; super.onDestroy(); userSearchPresenter.detachView(); &#125; @Override public void showSearchResults(List&lt;User&gt; githubUserList) &#123; &#125; @Override public void showError(String message) &#123; &#125; @Override public void showLoading() &#123; &#125; @Override public void hideLoading() &#123; &#125;&#125; åœ¨onCreate()ä¸­ï¼Œåˆ›å»ºpresenterå¯¹è±¡ã€‚æä¾›åœ¨æ³¨å…¥ç±»ä¸­å®šä¹‰çš„User repoã€‚é€šè¿‡io()è°ƒåº¦å™¨å’ŒAndroidSchedulers.mainThread()è°ƒåº¦å™¨,RxJavaè®¢é˜…ä»–ä»¬åº”è¯¥çŸ¥é“å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œä»–ä»¬çš„å·¥ä½œã€‚ ä¸‹ä¸€è¡Œ,ä½ å¯ä»¥çœ‹åˆ°æˆ‘è°ƒç”¨userSearchPresenter.attachView(this)ã€‚å®ƒå°†è§†å›¾é™„åŠ åˆ°presenterï¼Œä»¥ä¾¿presenterå¯ä»¥é€šçŸ¥è§†å›¾ä»»ä½•æ›´æ”¹ã€‚å› ä¸ºpresenterä¸çŸ¥é“activityçš„ç”Ÿå‘½å‘¨æœŸ,åœ¨onDestroy()æˆ‘ä»¬éœ€è¦é€šçŸ¥presenterä¸å¤å­˜åœ¨çš„è§‚ç‚¹æ˜¯,æˆ‘ä»¬åº”è¯¥å«userSearchPresenter.detachView()ã€‚è¿™å°†æ³¨é”€ä»»ä½•RxJavaè®¢é˜…ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ åˆ›å»ºactivity_user_search.xmlæ–‡ä»¶å¤¹ä¸­çš„xmlã€‚è¿™å°†åŒ…å«ä¸€ä¸ªRecyclerViewã€ä¸€ä¸ªProgressBarã€ä¸€ä¸ªé”™è¯¯TextViewå’Œä¸€ä¸ªToolbarã€‚æˆ‘ä½¿ç”¨äº†ConstraintLayoutæ¥è®¾è®¡æˆ‘çš„å±å¹•ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè¿‡å¤šåœ°è®²ç»†èŠ‚ï¼Œå› ä¸ºå®ƒä¸»è¦æ˜¯æ‹–æ”¾ã€‚(å¦‚æœä½ æƒ³è¯»æ›´å¤šå…³äºConstraintLayoutçš„æ–‡ç« ï¼Œè¯·å‚é˜…æˆ‘çš„åšå®¢æ–‡ç« ) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768 &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" xmlns:tools=\"http://schemas.android.com/tools\" android:id=\"@+id/activity_user_search\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" tools:context=\"za.co.riggaroo.gus.presentation.search.UserSearchActivity\"&gt; &lt;android.support.v7.widget.Toolbar android:id=\"@+id/toolbar\" android:layout_width=\"0dp\" android:layout_height=\"wrap_content\" android:background=\"?attr/colorPrimary\" android:minHeight=\"?attr/actionBarSize\" android:theme=\"?attr/actionBarTheme\" app:layout_constraintHorizontal_bias=\"0.0\" app:layout_constraintLeft_toLeftOf=\"@+id/activity_user_search\" app:layout_constraintRight_toRightOf=\"@+id/activity_user_search\" app:layout_constraintTop_toTopOf=\"@+id/activity_user_search\"&gt; &lt;/android.support.v7.widget.Toolbar&gt; &lt;android.support.v7.widget.RecyclerView android:id=\"@+id/recycler_view_users\" android:layout_width=\"0dp\" android:layout_height=\"0dp\" android:layout_marginBottom=\"16dp\" android:clipToPadding=\"false\" android:scrollbars=\"vertical\" app:layoutManager=\"android.support.v7.widget.LinearLayoutManager\" app:layout_constraintBottom_toBottomOf=\"@+id/activity_user_search\" app:layout_constraintLeft_toLeftOf=\"@+id/activity_user_search\" app:layout_constraintRight_toRightOf=\"@+id/activity_user_search\" app:layout_constraintTop_toBottomOf=\"@+id/toolbar\" tools:listitem=\"@layout/list_item_user\"&gt; &lt;/android.support.v7.widget.RecyclerView&gt; &lt;TextView android:id=\"@+id/text_view_error_msg\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginTop=\"16dp\" android:text=\"@string/search_for_some_users\" android:visibility=\"visible\" app:layout_constraintBottom_toBottomOf=\"@+id/recycler_view_users\" app:layout_constraintLeft_toLeftOf=\"@+id/toolbar\" app:layout_constraintRight_toRightOf=\"@+id/recycler_view_users\" app:layout_constraintTop_toBottomOf=\"@+id/toolbar\" tools:text=\"No Data has loaded\"/&gt; &lt;ProgressBar android:id=\"@+id/progress_bar\" style=\"@style/Widget.AppCompat.ProgressBar\" android:layout_width=\"60dp\" android:layout_height=\"60dp\" android:layout_marginBottom=\"16dp\" android:layout_marginTop=\"16dp\" android:visibility=\"gone\" app:layout_constraintBottom_toBottomOf=\"@+id/activity_user_search\" app:layout_constraintLeft_toLeftOf=\"@+id/recycler_view_users\" app:layout_constraintRight_toRightOf=\"@+id/recycler_view_users\" app:layout_constraintTop_toBottomOf=\"@+id/toolbar\" tools:visibility=\"visible\"/&gt; &lt;/android.support.constraint.ConstraintLayout&gt; æˆ‘ä»¬è¿˜éœ€è¦å‘å·¥å…·æ æ·»åŠ ä¸€ä¸ªSearchViewï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æŸä¸ªåœ°æ–¹è¾“å…¥ã€‚æ·»åŠ ä¸€ä¸ªmenu_user_search.xmlæ–‡ä»¶åˆ°èœå•èµ„æºæ–‡ä»¶å¤¹ã€‚åœ¨å®ƒé‡Œé¢ï¼Œä½ éœ€è¦æ·»åŠ ä¸€ä¸ªSearchView: 12345678910 &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt; &lt;item android:id=\"@+id/menu_search\" android:icon=\"@drawable/ic_search\" app:showAsAction=\"always|collapseActionView\" android:title=\"@string/search_icon_title\" app:actionViewClass=\"android.support.v7.widget.SearchView\"/&gt;&lt;/menu&gt; æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¸ƒå±€ï¼Œè¯¥å¸ƒå±€å°†ç”¨äºRecyclerViewä¸­çš„æ¯ä¸ªæ¡ç›®ã€‚å¸ƒå±€æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºlist_item_user.xmlçš„æ–‡ä»¶ã€‚æˆ‘ç”¨ConstraintLayoutåŒ…å«ä¸€ä¸ªImageViewå’Œä¸¤ä¸ªtextviewã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647 &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:app=\"http://schemas.android.com/apk/res-auto\" xmlns:tools=\"http://schemas.android.com/tools\" android:id=\"@+id/constraintLayout\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:orientation=\"vertical\"&gt; &lt;ImageView android:id=\"@+id/imageview_userprofilepic\" android:layout_width=\"50dp\" android:layout_height=\"50dp\" android:layout_marginLeft=\"16dp\" android:layout_marginStart=\"16dp\" android:layout_marginTop=\"16dp\" app:layout_constraintLeft_toLeftOf=\"@+id/constraintLayout\" app:layout_constraintTop_toTopOf=\"@+id/constraintLayout\" app:srcCompat=\"@mipmap/ic_launcher\"/&gt; &lt;TextView android:id=\"@+id/textview_username\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginLeft=\"16dp\" android:layout_marginStart=\"16dp\" android:layout_marginTop=\"16dp\" android:textAppearance=\"@style/TextAppearance.AppCompat.Medium\" app:layout_constraintLeft_toRightOf=\"@+id/imageview_userprofilepic\" app:layout_constraintTop_toTopOf=\"@+id/constraintLayout\" tools:text=\"Rebecca Franks\"/&gt; &lt;TextView android:id=\"@+id/textview_user_profile_info\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_marginEnd=\"16dp\" android:layout_marginLeft=\"16dp\" android:layout_marginRight=\"16dp\" android:layout_marginStart=\"16dp\" android:textAppearance=\"@style/TextAppearance.AppCompat.Caption\" app:layout_constraintBottom_toBottomOf=\"@+id/constraintLayout\" app:layout_constraintLeft_toRightOf=\"@+id/imageview_userprofilepic\" app:layout_constraintRight_toRightOf=\"@+id/constraintLayout\" app:layout_constraintTop_toBottomOf=\"@+id/textview_username\" tools:text=\"JHB, South Africa. Lots of code, lots and lots and lots of code.\"/&gt;&lt;/android.support.constraint.ConstraintLayout&gt; ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†æ‰€éœ€çš„æ‰€æœ‰å¸ƒå±€ï¼Œè®©æˆ‘ä»¬å°†XMLä¸Activityè”ç³»èµ·æ¥ã€‚é¦–å…ˆï¼Œåœ¨onCreate()ä¸­ï¼Œæˆ‘ä»¬å°†è·å¾—å¯¹æˆ‘ä»¬éœ€è¦çš„è§†å›¾çš„å¼•ç”¨ã€‚ 1234567891011121314151617181920private UsersAdapter usersAdapter; private SearchView searchView; private Toolbar toolbar; private ProgressBar progressBar; private RecyclerView recyclerViewUsers; private TextView textViewErrorMessage; @Override protected void onCreate(Bundle savedInstanceState) &#123; ... toolbar = (Toolbar) findViewById(R.id.toolbar); setSupportActionBar(toolbar); progressBar = (ProgressBar) findViewById(R.id.progress_bar); textViewErrorMessage = (TextView) findViewById(R.id.text_view_error_msg); recyclerViewUsers = (RecyclerView) findViewById(R.id.recycler_view_users); usersAdapter = new UsersAdapter(null, this); recyclerViewUsers.setAdapter(usersAdapter); &#125; æˆ‘ä»¬éœ€è¦å°†SearchViewè¿æ¥åˆ°æˆ‘ä»¬çš„activityä¸­ï¼Œä»¥ä½¿å®ƒè§¦å‘presenters search()æ–¹æ³•ã€‚åœ¨onCreateOptionsMenu()ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç : 1234567891011121314151617181920212223242526@Override public boolean onCreateOptionsMenu(Menu menu) &#123; super.onCreateOptionsMenu(menu); getMenuInflater().inflate(R.menu.menu_user_search, menu); final MenuItem searchActionMenuItem = menu.findItem(R.id.menu_search); searchView = (SearchView) searchActionMenuItem.getActionView(); searchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() &#123; @Override public boolean onQueryTextSubmit(String query) &#123; if (!searchView.isIconified()) &#123; searchView.setIconified(true); &#125; userSearchPresenter.search(query); toolbar.setTitle(query); searchActionMenuItem.collapseActionView(); return false; &#125; @Override public boolean onQueryTextChange(String s) &#123; return false; &#125; &#125;); searchActionMenuItem.expandActionView(); return true; &#125; è¿™å°†ä½¿æ­£ç¡®çš„èœå•inflateï¼Œæ‰¾åˆ°æœç´¢è§†å›¾å¹¶è®¾ç½®ä¸€ä¸ªæŸ¥è¯¢æ–‡æœ¬ä¾¦å¬å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰å½“æœ‰äººæŒ‰ä¸‹é”®ç›˜ä¸Šçš„æäº¤æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šä»¥æŸ¥è¯¢çš„æ–¹å¼è°ƒç”¨æœç´¢æä¾›å™¨ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨onQueryTextChangeä¸­å®Œæˆï¼Œä½†æ˜¯ç”±äºåœ¨Github APIä¸Šçš„é™åˆ¶ï¼Œæˆ‘å°†åšæŒonQueryTextSubmitã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®å°†è¢«æ‰©å±•ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ç°presenteråœ¨å®ŒæˆåŠ è½½æ—¶å°†è°ƒç”¨çš„å›è°ƒã€‚ 12345678910111213141516171819202122232425262728@Override public void showSearchResults(List&lt;User&gt; githubUserList) &#123; recyclerViewUsers.setVisibility(View.VISIBLE); textViewErrorMessage.setVisibility(View.GONE); usersAdapter.setItems(githubUserList); &#125; @Override public void showError(String message) &#123; textViewErrorMessage.setVisibility(View.VISIBLE); recyclerViewUsers.setVisibility(View.GONE); textViewErrorMessage.setText(message); &#125; @Override public void showLoading() &#123; progressBar.setVisibility(View.VISIBLE); recyclerViewUsers.setVisibility(View.GONE); textViewErrorMessage.setVisibility(View.GONE); &#125; @Override public void hideLoading() &#123; progressBar.setVisibility(View.GONE); recyclerViewUsers.setVisibility(View.VISIBLE); textViewErrorMessage.setVisibility(View.GONE); &#125; æˆ‘ä»¬åŸºæœ¬ä¸Šåªæ˜¯åœ¨è¿™é‡Œåˆ‡æ¢è§†å›¾çš„å¯è§æ€§ï¼Œå¹¶å°†usersAdapterè®¾ç½®ä¸ºæœåŠ¡è¿”å›çš„æ–°itemsã€‚ ä¸ºäº†å®Œæ•´èµ·è§ï¼Œè¿™é‡Œæ˜¯UserSearchAdapterç±»ï¼Œå®ƒç”¨äºactivityçš„RecyclerView: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455class UsersAdapter extends RecyclerView.Adapter&lt;UserViewHolder&gt; &#123; private final Context context; private List&lt;User&gt; items; UsersAdapter(List&lt;User&gt; items, Context context) &#123; this.items = items; this.context = context; &#125; @Override public UserViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.list_item_user, parent, false); return new UserViewHolder(v); &#125; @Override public void onBindViewHolder(UserViewHolder holder, int position) &#123; User item = items.get(position); holder.textViewBio.setText(item.getBio()); if (item.getName() != null) &#123; holder.textViewName.setText(item.getLogin() + \" - \" + item.getName()); &#125; else &#123; holder.textViewName.setText(item.getLogin()); &#125; Picasso.with(context).load(item.getAvatarUrl()).into(holder.imageViewAvatar); &#125; @Override public int getItemCount() &#123; if (items == null) &#123; return 0; &#125; return items.size(); &#125; void setItems(List&lt;User&gt; githubUserList) &#123; this.items = githubUserList; notifyDataSetChanged(); &#125;&#125; class UserViewHolder extends RecyclerView.ViewHolder &#123; final TextView textViewBio; final TextView textViewName; final ImageView imageViewAvatar; UserViewHolder(View v) &#123; super(v); imageViewAvatar = (ImageView) v.findViewById(R.id.imageview_userprofilepic); textViewName = (TextView) v.findViewById(R.id.textview_username); textViewBio = (TextView) v.findViewById(R.id.textview_user_profile_info); &#125;&#125; æ³¨å°„ç±» 12345678910111213141516171819202122232425262728293031323334353637383940public class Injection &#123; private static final String BASE_URL = \"https://api.github.com\"; private static OkHttpClient okHttpClient; private static GithubUserRestService userRestService; private static Retrofit retrofitInstance; public static UserRepository provideUserRepo() &#123; return new UserRepositoryImpl(provideGithubUserRestService()); &#125; static GithubUserRestService provideGithubUserRestService() &#123; if (userRestService == null) &#123; userRestService = getRetrofitInstance().create(GithubUserRestService.class); &#125; return userRestService; &#125; static OkHttpClient getOkHttpClient() &#123; if (okHttpClient == null) &#123; HttpLoggingInterceptor logging = new HttpLoggingInterceptor(); logging.setLevel(HttpLoggingInterceptor.Level.BASIC); okHttpClient = new OkHttpClient.Builder().addInterceptor(logging).build(); &#125; return okHttpClient; &#125; static Retrofit getRetrofitInstance() &#123; if (retrofitInstance == null) &#123; Retrofit.Builder retrofit = new Retrofit.Builder().client(Injection.getOkHttpClient()).baseUrl(BASE_URL) .addConverterFactory(GsonConverterFactory.create()) .addCallAdapterFactory(RxJavaCallAdapterFactory.create()); retrofitInstance = retrofit.build(); &#125; return retrofitInstance; &#125;&#125; ç°åœ¨ï¼Œå¦‚æœä½ è¿è¡Œè¿™æ¬¾åº”ç”¨ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨Githubä¸Šæœç´¢ç”¨æˆ·åï¼Œå¹¶æŸ¥çœ‹ç»“æœã€‚ è€¶!æˆ‘ä»¬æœ‰ä¸€ä¸ªå·¥ä½œåº”ç”¨ç¨‹åºã€‚è¿™ç¯‡æ–‡ç« çš„ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸ºåº”ç”¨ç¨‹åºç¼–å†™UIæµ‹è¯•ï¼","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"}]},{"title":"Android è‡ªåŠ¨åŒ–æµ‹è¯• - ç¬¬4éƒ¨åˆ†","slug":"introduction-android-testing-part-4","date":"2017-11-17T12:28:15.000Z","updated":"2020-07-25T02:57:18.208Z","comments":true,"path":"2017/11/17/introduction-android-testing-part-4/","link":"","permalink":"https://jigangduan.github.io/2017/11/17/introduction-android-testing-part-4/","excerpt":"åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªåä¸ºGithubç”¨æˆ·æœç´¢çš„Androidåº”ç”¨ç¨‹åºã€‚åœ¨ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä¸ºæµ‹è¯•åˆ›å»ºåº”ç”¨ç¨‹åºã€åˆ›å»ºAPIè°ƒç”¨å’Œç¼–å†™APIè½¬æ¢çš„ç¬¬ä¸€ä¸ªåŸºæœ¬æµ‹è¯•ã€‚é˜…è¯»ç¬¬1éƒ¨åˆ†ã€ç¬¬2éƒ¨åˆ†å’Œç¬¬3éƒ¨åˆ†ã€‚ è¿™ç¯‡æ–‡ç« å°†ç€çœ¼äºåˆ›å»ºä¸€ä¸ªä¸repositoryé€šä¿¡å¹¶å‘è§†å›¾ä¼ é€’ä¿¡æ¯çš„presenterã€‚è¿™è¿˜åŒ…æ‹¬ä¸ºpresenterç¼–å†™å•å…ƒæµ‹è¯•ã€‚è¿™ç¯‡åšæ–‡çš„ç¤ºä¾‹github repoå°†ä¼šåœ¨è¿™é‡Œæ‰¾åˆ°ã€‚","text":"åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªåä¸ºGithubç”¨æˆ·æœç´¢çš„Androidåº”ç”¨ç¨‹åºã€‚åœ¨ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä¸ºæµ‹è¯•åˆ›å»ºåº”ç”¨ç¨‹åºã€åˆ›å»ºAPIè°ƒç”¨å’Œç¼–å†™APIè½¬æ¢çš„ç¬¬ä¸€ä¸ªåŸºæœ¬æµ‹è¯•ã€‚é˜…è¯»ç¬¬1éƒ¨åˆ†ã€ç¬¬2éƒ¨åˆ†å’Œç¬¬3éƒ¨åˆ†ã€‚ è¿™ç¯‡æ–‡ç« å°†ç€çœ¼äºåˆ›å»ºä¸€ä¸ªä¸repositoryé€šä¿¡å¹¶å‘è§†å›¾ä¼ é€’ä¿¡æ¯çš„presenterã€‚è¿™è¿˜åŒ…æ‹¬ä¸ºpresenterç¼–å†™å•å…ƒæµ‹è¯•ã€‚è¿™ç¯‡åšæ–‡çš„ç¤ºä¾‹github repoå°†ä¼šåœ¨è¿™é‡Œæ‰¾åˆ°ã€‚ åˆ›å»ºPresenter ä¸ºäº†å¼€å§‹åˆ›å»ºï¼Œåˆ›å»ºç§°ä¸ºMvpViewå’ŒMvpPresenterçš„åŸºæœ¬æ¥å£ã€‚æ‰€æœ‰çš„MVPåŠŸèƒ½éƒ½å°†æ‰©å±•è¿™ä¸¤ä¸ªæ¥å£ã€‚ 12public interface MvpView &#123;&#125; 123456public interface MvpPresenter&lt;V extends MvpView&gt; &#123; void attachView(V mvpView); void detachView();&#125; åˆ›å»ºä¸€ä¸ªBasePresenterã€‚è¿™å°†æä¾›åŠŸèƒ½æ¥æ£€æŸ¥ä¸€ä¸ªè§†å›¾æ˜¯å¦é™„åŠ åˆ°presenterä¸Šï¼Œä»¥åŠç®¡ç†RxJavaè®¢é˜…çš„æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041 public class BasePresenter&lt;T extends MvpView&gt; implements MvpPresenter&lt;T&gt; &#123; private T view; private CompositeSubscription compositeSubscription = new CompositeSubscription(); @Override public void attachView(T mvpView) &#123; view = mvpView; &#125; @Override public void detachView() &#123; compositeSubscription.clear(); view = null; &#125; public T getView() &#123; return view; &#125; public void checkViewAttached() &#123; if (!isViewAttached()) &#123; throw new MvpViewNotAttachedException(); &#125; &#125; private boolean isViewAttached() &#123; return view != null; &#125; protected void addSubscription(Subscription subscription) &#123; this.compositeSubscription.add(subscription); &#125; protected static class MvpViewNotAttachedException extends RuntimeException &#123; public MvpViewNotAttachedException() &#123; super(\"Please call Presenter.attachView(MvpView) before\" + \" requesting data to the Presenter\"); &#125; &#125;&#125; æ­£å¦‚æ‚¨å¯ä»¥çœ‹åˆ°çš„ï¼Œåœ¨presenterä¸­æœ‰ä¸€ä¸ªCompositeSubscriptionã€‚è¯¥å¯¹è±¡å°†æŒæœ‰ä¸€ç»„RxJavaè®¢é˜…ã€‚detachView()æ–¹æ³•è°ƒç”¨compositeSubscription.clear()å°†ä»æ‰€æœ‰è®¢é˜…é€€è®¢,é˜²æ­¢å†…å­˜æ³„æ¼å’Œè§†å›¾å´©æºƒ(ä»£ç å°†ä¸ä¼šè¿è¡Œæ—¶è§†å›¾è¢«æ‘§æ¯,å› ä¸ºå®ƒæ˜¯unsubscribed)ã€‚å½“ä¸€ä¸ªpresenteråœ¨ä¸€ä¸ªå­ç±»ä¸­åˆ›å»ºä¸€ä¸ªè®¢é˜…å™¨æ—¶ï¼Œæˆ‘ä»¬å°†è°ƒç”¨addSubscription() åœ¨ä¸€ä¸ªåä¸ºUserSearchContractçš„ç±»ä¸­åˆ›å»ºè§†å›¾å’Œpresenterä¹‹é—´çš„å¥‘çº¦ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºè§†å›¾å’Œpresenterçš„ä¸¤ä¸ªæ¥å£ã€‚ 12345678910111213141516interface UserSearchContract &#123; interface View extends MvpView &#123; void showSearchResults(List&lt;User&gt; githubUserList); void showError(String message); void showLoading(); void hideLoading(); &#125; interface Presenter extends MvpPresenter&lt;View&gt; &#123; void search(String term); &#125;&#125; åœ¨viewä¸­ï¼Œæœ‰4ç§æ–¹æ³•ï¼ŒshowSearchResults()ã€showLoading()ã€hideLoading()ã€showError()ã€‚åœ¨presenterä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸ºsearch()çš„æ–¹æ³•ã€‚ presenterä¸å…³å¿ƒviewæ˜¯å¦‚ä½•æ˜¾ç¤ºç»“æœçš„ï¼Œä¹Ÿä¸å…³å¿ƒå®ƒå¦‚ä½•æ˜¾ç¤ºé”™è¯¯ã€‚ç±»ä¼¼åœ°ï¼Œä¸€ä¸ªviewå¹¶ä¸å…³å¿ƒä¸€ä¸ªpresenterå¦‚ä½•æœç´¢ï¼Œåªè¦å®ƒä½¿ç”¨è¿™äº›å›è°ƒæ¥é€šçŸ¥ï¼Œå®ç°å°±æ— å…³ç´§è¦äº†ã€‚ åˆ†ç¦»è§†å›¾å’Œpresenterä¹‹é—´çš„é€»è¾‘å¾ˆç®€å•ã€‚è€ƒè™‘ä¸ºå¦ä¸€ç§ç±»å‹çš„UIé‡ç”¨æ¼”ç¤ºç¨‹åºï¼Œè¿™å°†ä½¿æ‚¨æ„è¯†åˆ°ä»£ç åº”è¯¥åœ¨å“ªé‡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¿…é¡»ä½¿ç”¨Java Swingï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„æ¼”ç¤ºå™¨å¯ä»¥ä¿æŒä¸å˜ï¼Œåªæœ‰æ‚¨çš„è§†å›¾å®ç°ä¼šæœ‰æ‰€ä¸åŒã€‚è¿™å¯ä»¥å¸®åŠ©æ‚¨é€šè¿‡ç®€å•åœ°é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜æ¥æ”¾ç½®é€»è¾‘:å¦‚æœæˆ‘æœ‰ä¸åŒç±»å‹çš„UIï¼Œé‚£ä¹ˆpresenterä¸­çš„é€»è¾‘ä¼šæœ‰æ„ä¹‰å—? ç°åœ¨ï¼Œviewå’Œpresenterä¹‹é—´çš„å¥‘çº¦è¢«å®šä¹‰äº†ã€‚åˆ›å»º/å¯¼èˆªåˆ°UserSearchPresenterã€‚è¿™é‡Œå°†åˆ›å»ºUserRepositoryçš„è®¢é˜…ï¼Œå®ƒå°†è°ƒç”¨Github APIã€‚ 1234567891011class UserSearchPresenter extends BasePresenter&lt;UserSearchContract.View&gt; implements UserSearchContract.Presenter &#123; private final Scheduler mainScheduler, ioScheduler; private UserRepository userRepository; UserSearchPresenter(UserRepository userRepository, Scheduler ioScheduler, Scheduler mainScheduler) &#123; this.userRepository = userRepository; this.ioScheduler = ioScheduler; this.mainScheduler = mainScheduler; &#125;&#125; åœ¨è¿™é‡Œï¼Œpresenteræ‰©å±•äº†BasePresenterï¼Œå¹¶å®ç°äº†ç¬¬3æ­¥ä¸­å®šä¹‰çš„UserSearchContract.Presenterå¥‘çº¦ã€‚è¯¥ç±»å°†å®ç°search()æ–¹æ³•ã€‚ åœ¨å°è¯•è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼Œä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥å¯ä»¥è½»æ¾åœ°æ¨¡æ‹ŸUserRepositoryã€‚schedulersä¹Ÿè¢«æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œå› ä¸ºå•å…ƒæµ‹è¯•æ€»æ˜¯ä½¿ç”¨Schedulers.immediate()ï¼Œä½†æ˜¯åœ¨è§†å›¾ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹ã€‚ ç°åœ¨ï¼Œä¸ºäº†å®ç°search(): 1234567891011121314151617181920212223@Override public void search(String term) &#123; checkViewAttached(); getView().showLoading(); addSubscription(userRepository.searchUsers(term).subscribeOn(ioScheduler).observeOn(mainScheduler).subscribe(new Subscriber&lt;List&lt;User&gt;&gt;() &#123; @Override public void onCompleted() &#123; &#125; @Override public void onError(Throwable e) &#123; getView().hideLoading(); getView().showError(e.getMessage()); //TODO You probably don't want this error to show to users - Might want to show a friendlier message :) &#125; @Override public void onNext(List&lt;User&gt; users) &#123; getView().hideLoading(); getView().showSearchResults(users); &#125; &#125;)); &#125; é¦–å…ˆï¼Œè¿è¡ŒcheckViewAttached()ï¼Œå¦‚æœåœ¨æ–¹æ³•å¼€å§‹è¿è¡Œæ—¶æ²¡æœ‰é™„åŠ è§†å›¾ï¼Œå®ƒå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ç„¶åå‘Šè¯‰è§†å›¾ï¼Œå®ƒåº”è¯¥é€šè¿‡è°ƒç”¨showLoading()å¼€å§‹åŠ è½½ã€‚åˆ›å»ºuserRepository.searchUsers()çš„è®¢é˜…ã€‚å°†subscribeOn()è®¾ç½®ä¸ºioSchedulerå˜é‡ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨IOçº¿ç¨‹ä¸Šå‘ç”Ÿè¿™äº›ç½‘ç»œè°ƒç”¨ã€‚è®¾ç½®observeOn() mainSchedulerï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨ä¸»çº¿ç¨‹ä¸Šè§‚å¯Ÿåˆ°è¿™ä¸ªè®¢é˜…çš„ç»“æœã€‚ç„¶åé€šè¿‡è°ƒç”¨addSubscriptionï¼Œå°†è®¢é˜…æ·»åŠ åˆ°å¤åˆè®¢é˜…ä¸­ã€‚ åœ¨onNext()æ–¹æ³•ä¸­ï¼Œé€šè¿‡ä½¿ç”¨APIè¿”å›çš„ç”¨æˆ·åˆ—è¡¨è°ƒç”¨hideLoading()å’ŒshowSearchResults()æ¥å¤„ç†ç»“æœã€‚åœ¨onError()ä¸­ï¼Œåœæ­¢åŠ è½½ï¼Œå¹¶ä½¿ç”¨å¼‚å¸¸çš„æ¶ˆæ¯è°ƒç”¨showError()ã€‚ ä¸‹é¢æ˜¯UserSearchPresenterçš„å®Œæ•´ä»£ç : 123456789101112131415161718192021222324252627282930313233343536373839404142434445package za.co.riggaroo.gus.presentation.search;import java.util.List;import rx.Scheduler;import rx.Subscriber;import za.co.riggaroo.gus.data.UserRepository;import za.co.riggaroo.gus.data.remote.model.User;import za.co.riggaroo.gus.presentation.base.BasePresenter;class UserSearchPresenter extends BasePresenter&lt;UserSearchContract.View&gt; implements UserSearchContract.Presenter &#123; private final Scheduler mainScheduler, ioScheduler; private UserRepository userRepository; UserSearchPresenter(UserRepository userRepository, Scheduler ioScheduler, Scheduler mainScheduler) &#123; this.userRepository = userRepository; this.ioScheduler = ioScheduler; this.mainScheduler = mainScheduler; &#125; @Override public void search(String term) &#123; checkViewAttached(); getView().showLoading(); addSubscription(userRepository.searchUsers(term).subscribeOn(ioScheduler).observeOn(mainScheduler).subscribe(new Subscriber&lt;List&lt;User&gt;&gt;() &#123; @Override public void onCompleted() &#123; &#125; @Override public void onError(Throwable e) &#123; getView().hideLoading(); getView().showError(e.getMessage()); //TODO You probably don't want this error to show to users - Might want to show a friendlier message :) &#125; @Override public void onNext(List&lt;User&gt; users) &#123; getView().hideLoading(); getView().showSearchResults(users); &#125; &#125;)); &#125;&#125; ä¸ºUserSearchPresenterç¼–å†™å•å…ƒæµ‹è¯•ç°åœ¨å·²ç»å®šä¹‰äº†presenterï¼Œè®©æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºä¸€äº›å•å…ƒæµ‹è¯•ã€‚ é€‰æ‹©UserSearchPresenterç±»åã€‚æŒ‰â€œALT+Enterâ€å¹¶é€‰æ‹©â€œCreate Testâ€ã€‚é€‰æ‹©â€œapp/src/test/javaâ€æ–‡ä»¶å¤¹ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦Androidä¾èµ–çš„å•å…ƒæµ‹è¯•ã€‚ç»“æœæµ‹è¯•çš„ä½ç½®å¦‚ä¸‹:app/src/test/java/za/co/riggaroo/gus/presentation åœ¨UserSearchPresenterTestä¸­ï¼Œåˆ›å»ºsetupæ–¹æ³•ï¼Œå¹¶å®šä¹‰æµ‹è¯•æ‰€éœ€çš„å˜é‡ã€‚ 12345678910111213141516public class UserSearchPresenterTest &#123; @Mock UserRepository userRepository; @Mock UserSearchContract.View view; UserSearchPresenter userSearchPresenter; @Before public void setUp() throws Exception &#123; MockitoAnnotations.initMocks(this); userSearchPresenter = new UserSearchPresenter(userRepository, Schedulers.immediate(), Schedulers.immediate()); userSearchPresenter.attachView(view); &#125;&#125; é€šè¿‡åˆ›å»ºUserRepositoryå’ŒUserSearchContract.Viewçš„æ¨¡æ‹Ÿå®ä¾‹ï¼Œæˆ‘ä»¬å°†ç¡®ä¿æˆ‘ä»¬åªæ˜¯åœ¨æµ‹è¯•UserSearchPresenterã€‚åœ¨setUp()æ–¹æ³•ä¸­,æˆ‘ä»¬ç§°ä¹‹ä¸ºMockitoAnnotations.initMocks()ã€‚ç„¶åä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å’Œå³æ—¶è°ƒåº¦ç¨‹åºåˆ›å»ºæœç´¢æ¼”ç¤ºç¨‹åºã€‚ä½¿ç”¨æ¨¡æ‹Ÿè§†å›¾å¯¹è±¡è°ƒç”¨attachView()ï¼Œå› ä¸ºåªæœ‰å½“ä¸€ä¸ªè§†å›¾è¢«è¿æ¥æ—¶ï¼Œå®ƒæ‰ä¼šèµ·ä½œç”¨ã€‚ ç¬¬ä¸€ä¸ªæµ‹è¯•å°†æµ‹è¯•ä¸€ä¸ªæœ‰æ•ˆçš„æœç´¢è¯æ˜¯å¦æœ‰æ­£ç¡®çš„å›è°ƒ: 123456789101112131415161718192021222324252627282930private static final String USER_LOGIN_RIGGAROO = \"riggaroo\"; private static final String USER_LOGIN_2_REBECCA = \"rebecca\"; @Test public void search_ValidSearchTerm_ReturnsResults() &#123; UsersList userList = getDummyUserList(); when(userRepository.searchUsers(anyString())).thenReturn(Observable.&lt;List&lt;User&gt;&gt;just(userList.getItems())); userSearchPresenter.search(\"riggaroo\"); verify(view).showLoading(); verify(view).hideLoading(); verify(view).showSearchResults(userList.getItems()); verify(view, never()).showError(anyString()); &#125; UsersList getDummyUserList() &#123; List&lt;User&gt; githubUsers = new ArrayList&lt;&gt;(); githubUsers.add(user1FullDetails()); githubUsers.add(user2FullDetails()); return new UsersList(githubUsers); &#125; User user1FullDetails() &#123; return new User(USER_LOGIN_RIGGAROO, \"Rigs Franks\", \"avatar_url\", \"Bio1\"); &#125; User user2FullDetails() &#123; return new User(USER_LOGIN_2_REBECCA, \"Rebecca Franks\", \"avatar_url2\", \"Bio2\"); &#125; è¿™ä¸ªæµ‹è¯•æ–­è¨€:å‡å®š(Given)ç”¨æˆ·repositoryè¿”å›ä¸€ç»„ç”¨æˆ·ï¼Œå½“(when)åœ¨æ¼”ç¤ºç¨‹åºä¸­è°ƒç”¨search()æ—¶ï¼Œå°†(then)è°ƒç”¨showLoading()å’ŒshowSearchResults()ã€‚è¿™ä¸ªæµ‹è¯•è¿˜æ–­è¨€showError()æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚ ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯åœ¨UserRepositoryæŠ›å‡ºé”™è¯¯æ—¶æµ‹è¯•è´Ÿé¢åœºæ™¯çš„æµ‹è¯•ã€‚ 123456789101112@Test public void search_UserRepositoryError_ErrorMsg() &#123; String errorMsg = \"No internet\"; when(userRepository.searchUsers(anyString())).thenReturn(Observable.error(new IOException(errorMsg))); userSearchPresenter.search(\"bookdash\"); verify(view).showLoading(); verify(view).hideLoading(); verify(view, never()).showSearchResults(anyList()); verify(view).showError(errorMsg); &#125; è¿™ä¸ªæµ‹è¯•æ­£åœ¨æµ‹è¯•ä»¥ä¸‹å†…å®¹:å‡å®š(Given) userRepositoryè¿”å›ä¸€ä¸ªå¼‚å¸¸ï¼Œåœ¨è°ƒç”¨search()æ—¶ï¼Œåº”è¯¥è°ƒç”¨showError()ã€‚ æˆ‘ä»¬å°†æ·»åŠ çš„æœ€åä¸€ä¸ªæµ‹è¯•å°†æ–­è¨€ï¼Œå¦‚æœè§†å›¾æ²¡æœ‰é™„åŠ ï¼Œå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ 123456789@Test(expected = BasePresenter.MvpViewNotAttachedException.class) public void search_NotAttached_ThrowsMvpException() &#123; userSearchPresenter.detachView(); userSearchPresenter.search(\"test\"); verify(view, never()).showLoading(); verify(view, never()).showSearchResults(anyList()); &#125; è®©æˆ‘ä»¬è¿è¡Œæµ‹è¯•ï¼Œçœ‹çœ‹æˆ‘ä»¬æœ‰å¤šå°‘æµ‹è¯•è¦†ç›–ç‡ã€‚å³é”®å•å‡»æµ‹è¯•åç§°å¹¶å•å‡»â€œRun tests with coverageâ€ã€‚ æˆ‘ä»¬å¯¹UserSearchPresenteræœ‰100%çš„è¦†ç›–ç‡ï¼è€¶! ä¸‹ä¸€ç¯‡åšå®¢æ–‡ç« å°†è®¨è®ºåˆ›å»ºè§†å›¾å’Œä¸ºè§†å›¾ç¼–å†™æµ‹è¯•ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"}]},{"title":"Android è‡ªåŠ¨åŒ–æµ‹è¯• - ç¬¬3éƒ¨åˆ†","slug":"introduction-android-testing-part3","date":"2017-11-17T11:30:11.000Z","updated":"2020-07-25T02:57:18.208Z","comments":true,"path":"2017/11/17/introduction-android-testing-part3/","link":"","permalink":"https://jigangduan.github.io/2017/11/17/introduction-android-testing-part3/","excerpt":"åœ¨ä¹‹å‰çš„ä¸¤ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•åœ¨Androidä¸­è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ ·æœ¬åº”ç”¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­åœ¨è¿™ç¯‡åšæ–‡ä¸­ç»§ç»­å¼€å‘ã€‚å¦‚æœæ‚¨é”™è¿‡äº†è¿™ä¸¤ä¸ªå¸–å­ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»ç¬¬1éƒ¨åˆ†å’Œç¬¬2éƒ¨åˆ†ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»Github APIä¸­è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œå¹¶ä¸ºå…¶ç¼–å†™å•å…ƒæµ‹è¯•ã€‚æˆ‘ä»¬å°†ä»è¿™ä¸ªæ£€æŸ¥ç‚¹çš„ä¸‹ä¸€ä¸ªrepoå¼€å§‹ã€‚","text":"åœ¨ä¹‹å‰çš„ä¸¤ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•åœ¨Androidä¸­è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ ·æœ¬åº”ç”¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­åœ¨è¿™ç¯‡åšæ–‡ä¸­ç»§ç»­å¼€å‘ã€‚å¦‚æœæ‚¨é”™è¿‡äº†è¿™ä¸¤ä¸ªå¸–å­ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»ç¬¬1éƒ¨åˆ†å’Œç¬¬2éƒ¨åˆ†ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»Github APIä¸­è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œå¹¶ä¸ºå…¶ç¼–å†™å•å…ƒæµ‹è¯•ã€‚æˆ‘ä»¬å°†ä»è¿™ä¸ªæ£€æŸ¥ç‚¹çš„ä¸‹ä¸€ä¸ªrepoå¼€å§‹ã€‚ åˆ›å»ºWebæœåŠ¡è°ƒç”¨è¦ä½¿ç”¨Github APIï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¿»æ–°å’ŒRxJavaã€‚æˆ‘ä¸æ‰“ç®—åœ¨æœ¬ç³»åˆ—ä¸­è§£é‡ŠRxJavaæˆ–Retrofitã€‚å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰RxJavaï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»è¿™äº›æ–‡ç« ã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨è¿‡Retrofitï¼Œæˆ‘å»ºè®®é˜…è¯»è¿™é‡Œã€‚ ä¸ºäº†è·å¾—ä¸€ä¸ªæœç´¢è¯çš„ç”¨æˆ·åˆ—è¡¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„ç«¯ç‚¹: 1https://api.github.com/search/users?per_page=2&amp;q=rebecca è¦è·å¾—æ›´å¤šçš„ç”¨æˆ·ä¿¡æ¯(ä¾‹å¦‚ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯å’Œä½ç½®)ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œåç»­è°ƒç”¨: 1https://api.github.com/users/riggaroo è¦å¼€å§‹ä½¿ç”¨è¿™äº›ç«¯ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥åˆ›å»ºå®ƒä»¬æ­£åœ¨è¿”å›çš„JSONå¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬åŒ…å«åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚æˆ‘é€šå¸¸åœ¨åœ¨çº¿ç”Ÿæˆå®ƒä»¬ã€‚è®©æˆ‘ä»¬åˆ›å»ºä»¥ä¸‹ç±»:Userç±»å’ŒUsersListç±»: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package za.co.riggaroo.gus.data.remote.model;import com.google.gson.annotations.Expose;import com.google.gson.annotations.SerializedName;public class User &#123; @SerializedName(\"login\") @Expose private String login; @SerializedName(\"id\") @Expose private Integer id; @SerializedName(\"avatar_url\") @Expose private String avatarUrl; @SerializedName(\"gravatar_id\") @Expose private String gravatarId; @SerializedName(\"url\") @Expose @SerializedName(\"type\") @Expose private String type; @SerializedName(\"name\") @Expose private String name; @SerializedName(\"location\") @Expose private String location; @SerializedName(\"email\") @SerializedName(\"bio\") @Expose private String bio; @SerializedName(\"followers\") @Expose private Integer followers; @SerializedName(\"following\") @Expose private Integer following; @SerializedName(\"created_at\") @Expose private String createdAt; @SerializedName(\"updated_at\") @Expose private String updatedAt; ... //see more at https://github.com/riggaroo/GithubUsersSearchApp/blob/testing-tutorial-part3-complete/app/src/main/java/za/co/riggaroo/gus/data/remote/model/User.java&#125; 12345678910111213141516171819202122232425262728293031323334package za.co.riggaroo.gus.data.remote.model;import com.google.gson.annotations.Expose;import com.google.gson.annotations.SerializedName;import java.util.ArrayList;import java.util.List;public class UsersList &#123; @SerializedName(\"total_count\") @Expose private Integer totalCount; @SerializedName(\"items\") @Expose private List&lt;User&gt; items = new ArrayList&lt;User&gt;(); public Integer getTotalCount() &#123; return totalCount; &#125; public void setTotalCount(Integer totalCount) &#123; this.totalCount = totalCount; &#125; public List&lt;User&gt; getItems() &#123; return items; &#125; public void setItems(List&lt;User&gt; items) &#123; this.items = items; &#125;&#125; åˆ›å»ºæ¨¡å‹åï¼Œå¯¼èˆªåˆ°GithubUserRestServiceã€‚è¿™æ˜¯æˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„Retrofitè°ƒç”¨çš„åœ°æ–¹ã€‚ 123456789101112131415import retrofit2.http.GET;import retrofit2.http.Path;import retrofit2.http.Query;import rx.Observable;import za.co.riggaroo.gus.data.remote.model.User;import za.co.riggaroo.gus.data.remote.model.UsersList;public interface GithubUserRestService &#123; @GET(\"/search/users?per_page=2\") Observable&lt;UsersList&gt; searchGithubUsers(@Query(\"q\") String searchTerm); @GET(\"/users/&#123;username&#125;\") Observable&lt;User&gt; getUser(@Path(\"username\") String username);&#125; ç¬¬ä¸€ä¸ªç½‘ç»œè°ƒç”¨å°†æ‰§è¡Œæœç´¢ä»¥è·å¾—ç”¨æˆ·åˆ—è¡¨ï¼Œç¬¬äºŒä¸ªç½‘ç»œè°ƒç”¨å°†è·å¾—å…³äºç”¨æˆ·çš„æ›´å¤šä¿¡æ¯ã€‚ å¯¼èˆªåˆ°UserRepositoryImplã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æŠŠä¸¤ä¸ªç½‘ç»œè°ƒç”¨åˆå¹¶èµ·æ¥ï¼Œå¹¶å°†æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªå°†åœ¨å‰ç«¯ä½¿ç”¨çš„è§†å›¾ã€‚è¿™æ˜¯ä½¿ç”¨RxJavaé¦–å…ˆè·å–æœç´¢è¯çš„ç”¨æˆ·åˆ—è¡¨ï¼Œç„¶åä¸ºæ¯ä¸ªç”¨æˆ·æä¾›å¦ä¸€ä¸ªç½‘ç»œè°ƒç”¨ï¼Œä»¥æŸ¥æ‰¾æ›´å¤šçš„ç”¨æˆ·ä¿¡æ¯ã€‚(å¦‚æœæ‚¨è‡ªå·±å®ç°äº†è¿™ä¸ªAPIï¼Œæˆ‘å°†å°è¯•è®©ä¸€ä¸ªç½‘ç»œè°ƒç”¨è¿”å›æ‰€æœ‰å¿…éœ€çš„ä¿¡æ¯â€”â€”æ­£å¦‚æˆ‘åœ¨å‡å°‘ç§»åŠ¨æ•°æ®ä½¿ç”¨è°ˆè¯ä¸­æ‰€è®¨è®ºçš„é‚£æ ·)ã€‚ 1234567891011121314151617181920212223242526272829import java.io.IOException;import java.util.List;import rx.Observable;import za.co.riggaroo.gus.data.remote.GithubUserRestService;import za.co.riggaroo.gus.data.remote.model.User;public class UserRepositoryImpl implements UserRepository &#123; private GithubUserRestService githubUserRestService; public UserRepositoryImpl(GithubUserRestService githubUserRestService) &#123; this.githubUserRestService = githubUserRestService; &#125; @Override public Observable&lt;List&lt;User&gt;&gt; searchUsers(final String searchTerm) &#123; return Observable.defer(() -&gt; githubUserRestService.searchGithubUsers(searchTerm).concatMap( usersList -&gt; Observable.from(usersList.getItems()) .concatMap(user -&gt; githubUserRestService.getUser(user.getLogin())).toList())) .retryWhen(observable -&gt; observable.flatMap(o -&gt; &#123; if (o instanceof IOException) &#123; return Observable.just(null); &#125; return Observable.error(o); &#125;)); &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä½¿ç”¨Observable.defer()æ¥åˆ›å»ºä¸€ä¸ªobservableå¯¹è±¡ï¼Œè¿™æ„å‘³ç€åªæœ‰å½“å®ƒæœ‰ä¸€ä¸ªè®¢é˜…è€…(ä¸åƒObservable.create()åœ¨åˆ›å»ºæ—¶è¿è¡Œ)æ—¶ï¼Œæ‰ä¼šè¿è¡Œobservablesä»£ç ã€‚æ­£å¦‚ä¸‹é¢çš„æ³¨é‡Šæ‰€çº æ­£çš„é‚£æ ·ï¼ŒObservable.create()æ˜¯ä¸€ä¸ªä¸å®‰å…¨çš„RxJava APIï¼Œå®ƒä¸åº”è¯¥è¢«ä½¿ç”¨ã€‚ å½“æœ‰è®¢é˜…è€…æ—¶ï¼Œå°†è°ƒç”¨githubUserRestServiceæ¥æœç´¢æä¾›çš„searchTermã€‚ä»é‚£é‡Œ,æˆ‘ä½¿ç”¨concatMapç”¨æˆ·åˆ—è¡¨,å‘å‡ºä»–ä»¬ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿›å…¥ä¸€ä¸ªæ–°çš„è§‚å¯Ÿ,ç„¶åè°ƒç”¨githubUserRestService.getUser()ä¸ºæ¯ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚ç„¶åï¼Œè¿™ä¸ªå¯è§‚å¯Ÿåˆ°çš„ç”¨æˆ·å°±å˜æˆäº†ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚ åœ¨è¿™äº›ç½‘ç»œè°ƒç”¨ä¸Šä¹Ÿå®šä¹‰äº†ä¸€ä¸ªé‡è¯•æœºåˆ¶ã€‚retryWhen()å°†åœ¨æŠ›å‡ºIOExceptionæ—¶é‡æ–°å°è¯•å¯è§‚å¯Ÿçš„å¯¹è±¡ã€‚å½“ç”¨æˆ·æ²¡æœ‰ç½‘ç»œæ—¶(æ‚¨å¯èƒ½æƒ³è¦æ·»åŠ ä¸€ä¸ªç»ˆæ­¢æ¡ä»¶ï¼Œä¾‹å¦‚ä»…é‡æ–°å°è¯•æŸäº›æ¬¡æ•°)ï¼Œå°±ä¼šæŠ›å‡ºIOExceptionã€‚ æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘åœ¨ä»£ç ä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨æ–°çš„Jackå·¥å…·é“¾æ¥æ„å»ºåº”ç”¨ç¨‹åºã€‚è¯·é˜…è¯»æœ‰å…³å¦‚ä½•åœ¨Androidä¸Šå¯ç”¨Java 8çš„åŠŸèƒ½ã€‚ ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå­˜å‚¨åº“å’Œä¸¤ä¸ªç½‘ç»œè°ƒç”¨æ¥è·å¾—ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ï¼æˆ‘ä»¬åº”è¯¥ä¸ºåˆšåˆšç¼–å†™çš„ä»£ç ç¼–å†™æµ‹è¯• å•å…ƒæµ‹è¯• â€” Mockitoæ˜¯ä»€ä¹ˆ?ä¸ºäº†å¯¹repositoryå¯¹è±¡è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Mockitoã€‚Mockitoæ˜¯ä»€ä¹ˆ?æ ¹æ®MITè®¸å¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„Javaå¼€æºæµ‹è¯•æ¡†æ¶ã€‚è¯¥æ¡†æ¶å…è®¸åœ¨è‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•ä¸­åˆ›å»ºæµ‹è¯•åŒå¯¹è±¡(æ¨¡æ‹Ÿå¯¹è±¡)ã€‚(ç»´åŸºç™¾ç§‘) Mockitoå…è®¸ä½ stubæ–¹æ³•è°ƒç”¨ï¼Œå¹¶éªŒè¯ä¸å¯¹è±¡çš„äº¤äº’ã€‚ å½“æˆ‘ä»¬ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å•ç‹¬æµ‹è¯•æŸä¸ªç»„ä»¶ã€‚æˆ‘ä»¬ä¸åº”è¯¥æµ‹è¯•ä»»ä½•è¶…å‡ºè¿™ç±»èŒè´£çš„ä¸œè¥¿ã€‚Mockitoå¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€åˆ†ç¦» å¥½äº†ï¼Œè®©æˆ‘ä»¬å†™ä¸€äº›æµ‹è¯•å§ï¼ ä¸ºUserRepositoryImplç¼–å†™å•å…ƒæµ‹è¯• é€‰æ‹©UserRepositoryImplçš„ç±»åï¼Œå¹¶æŒ‰â€œALT+ENTERâ€é”®ã€‚å°†å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œé€‰æ‹©â€œCreate Testâ€é€‰é¡¹ã€‚é€‰æ‹©è¯¥é€‰é¡¹ï¼Œå°†å‡ºç°ä¸€ä¸ªæ–°çš„å¯¹è¯æ¡†: æ‚¨å¯ä»¥é€‰æ‹©ç”Ÿæˆæ–¹æ³•ï¼Œä½†æˆ‘é€šå¸¸ä¼šé€‰æ‹©æœªé€‰æ‹©çš„é€‰é¡¹ã€‚ç„¶åï¼Œå®ƒå°†è¦æ±‚æ‚¨é€‰æ‹©åº”è¯¥æ”¾ç½®æµ‹è¯•çš„ç›®å½•ã€‚åœ¨ç¼–å†™ä¸€ä¸ªä¸éœ€è¦Androidä¸Šä¸‹æ–‡çš„JUnitæµ‹è¯•æ—¶ï¼Œé€‰æ‹©app/src/testç›®å½•ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½è®¾ç½®å•å…ƒæµ‹è¯•äº†ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªUserRepositoryå¯¹è±¡ã€‚æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªGithubUserRestServiceçš„æ¨¡æ‹Ÿå®ä¾‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šç›´æ¥åœ¨è¿™ä¸ªæµ‹è¯•ä¸­å¯¹APIè¿›è¡Œæ”»å‡»ã€‚è¿™ä¸ªæµ‹è¯•å°†ç¡®è®¤åœ¨UserRepositoryä¸­æ­£ç¡®åœ°å®Œæˆäº†è½¬æ¢ã€‚ä¸‹é¢æ˜¯è®¾ç½®æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•çš„ä»£ç : 12345678910@Mock GithubUserRestService githubUserRestService; private UserRepository userRepository; @Before public void setUp() throws Exception &#123; MockitoAnnotations.initMocks(this); userRepository = new UserRepositoryImpl(githubUserRestService); &#125; æˆ‘ä»¬å°†ç¼–å†™çš„ç¬¬ä¸€ä¸ªæµ‹è¯•å°†æµ‹è¯•GithubUserRestServiceæ˜¯å¦å…·æœ‰æ­£ç¡®çš„å‚æ•°ã€‚å®ƒè¿˜å°†æµ‹è¯•å®ƒæ˜¯å¦è¿”å›é¢„æœŸçš„ç»“æœã€‚ä¸‹é¢æ˜¯æˆ‘æ‰€å†™çš„ç¤ºä¾‹æµ‹è¯•: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556@Test public void searchUsers_200OkResponse_InvokesCorrectApiCalls() &#123; //Given when(githubUserRestService.searchGithubUsers(anyString())).thenReturn(Observable.just(githubUserList())); when(githubUserRestService.getUser(anyString())) .thenReturn(Observable.just(user1FullDetails()), Observable.just(user2FullDetails())); //When TestSubscriber&lt;List&lt;User&gt;&gt; subscriber = new TestSubscriber&lt;&gt;(); userRepository.searchUsers(USER_LOGIN_RIGGAROO).subscribe(subscriber); //Then subscriber.awaitTerminalEvent(); subscriber.assertNoErrors(); List&lt;List&lt;User&gt;&gt; onNextEvents = subscriber.getOnNextEvents(); List&lt;User&gt; users = onNextEvents.get(0); Assert.assertEquals(USER_LOGIN_RIGGAROO, users.get(0).getLogin()); Assert.assertEquals(USER_LOGIN_2_REBECCA, users.get(1).getLogin()); verify(githubUserRestService).searchGithubUsers(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_2_REBECCA); &#125; private UsersList githubUserList() &#123; User user = new User(); user.setLogin(USER_LOGIN_RIGGAROO); User user2 = new User(); user2.setLogin(USER_LOGIN_2_REBECCA); List&lt;User&gt; githubUsers = new ArrayList&lt;&gt;(); githubUsers.add(user); githubUsers.add(user2); UsersList usersList = new UsersList(); usersList.setItems(githubUsers); return usersList; &#125; private User user1FullDetails() &#123; User user = new User(); user.setLogin(USER_LOGIN_RIGGAROO); user.setName(\"Rigs Franks\"); user.setAvatarUrl(\"avatar_url\"); user.setBio(\"Bio1\"); return user; &#125; private User user2FullDetails() &#123; User user = new User(); user.setLogin(USER_LOGIN_2_REBECCA); user.setName(\"Rebecca Franks\"); user.setAvatarUrl(\"avatar_url2\"); user.setBio(\"Bio2\"); return user; &#125; è¿™ä¸ªæµ‹è¯•åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†: ç»™å®š(given)ï¼Œä»€ä¹ˆæ—¶å€™(when)ï¼Œä»€ä¹ˆæ—¶å€™(then)ã€‚ æˆ‘å°†æˆ‘çš„æµ‹è¯•åˆ†ç¦»å¼€æ¥ï¼Œå› ä¸ºå®ƒç¡®ä¿æ‚¨çš„æµ‹è¯•æ˜¯ç»“æ„åŒ–çš„ï¼Œå¹¶è®©æ‚¨æ€è€ƒæ‚¨æ­£åœ¨æµ‹è¯•çš„ç‰¹å®šåŠŸèƒ½ã€‚ åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘æ­£åœ¨æµ‹è¯•ä»¥ä¸‹å†…å®¹:ç»™å®šGithubæœåŠ¡è¿”å›æŸäº›ç”¨æˆ·æ—¶ï¼Œå½“æˆ‘æœç´¢ç”¨æˆ·æ—¶ï¼Œç»“æœåº”è¯¥è¿”å›å¹¶æ­£ç¡®åœ°è½¬æ¢ã€‚ æˆ‘å‘ç°æµ‹è¯•çš„å‘½åä¹Ÿå¾ˆé‡è¦ã€‚æˆ‘å–œæ¬¢éµå¾ªçš„å‘½åç»“æ„å¦‚ä¸‹: [Name of method under test]_[Conditions of test case]_[Expected Result] åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–¹æ³•çš„åå­—æ˜¯ åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥æ–¹æ³•çš„åç§°æ˜¯searchUsers_200OkResponse_InvokesCorrectApiCalls()ã€‚ åœ¨è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œä¸€ä¸ªTestSubscriberè®¢é˜…äº†å¯è§‚å¯Ÿåˆ°çš„æœç´¢æŸ¥è¯¢ã€‚ ç„¶ååœ¨TestSubscriberä¸Šè¿›è¡Œæ–­è¨€ï¼Œä»¥ç¡®ä¿å®ƒå…·æœ‰é¢„æœŸçš„ç»“æœã€‚ ä¸‹ä¸€ä¸ªå•å…ƒæµ‹è¯•å°†æµ‹è¯•å¦‚æœä¸€ä¸ªIOExceptionè¢«æœç´¢æœåŠ¡è°ƒç”¨æŠ›å‡ºï¼Œé‚£ä¹ˆç½‘ç»œè°ƒç”¨å°†è¢«é‡è¯•ã€‚ 123456789101112131415161718192021@Test public void searchUsers_IOExceptionThenSuccess_SearchUsersRetried() &#123; //Given when(githubUserRestService.searchGithubUsers(anyString())) .thenReturn(getIOExceptionError(), Observable.just(githubUserList())); when(githubUserRestService.getUser(anyString())) .thenReturn(Observable.just(user1FullDetails()), Observable.just(user2FullDetails())); //When TestSubscriber&lt;List&lt;User&gt;&gt; subscriber = new TestSubscriber&lt;&gt;(); userRepository.searchUsers(USER_LOGIN_RIGGAROO).subscribe(subscriber); //Then subscriber.awaitTerminalEvent(); subscriber.assertNoErrors(); verify(githubUserRestService, times(2)).searchGithubUsers(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_2_REBECCA); &#125; åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ–­è¨€githubUserRestServiceè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œè€Œå…¶ä»–çš„ç½‘ç»œè°ƒç”¨ä¸€æ¬¡è¢«è°ƒç”¨ä¸€æ¬¡ã€‚æˆ‘ä»¬è¿˜æ–­è¨€è®¢é˜…è€…æ²¡æœ‰ç»ˆæ­¢é”™è¯¯ã€‚ UserRepositoryImplçš„æœ€ç»ˆå•å…ƒæµ‹è¯•ä»£ç æˆ‘å·²ç»æ·»åŠ äº†æ¯”ä¸Šé¢æè¿°çš„æ›´å¤šçš„æµ‹è¯•ã€‚å®ƒä»¬æµ‹è¯•ä¸åŒçš„æƒ…å†µï¼Œä½†æ˜¯å®ƒä»¬éµå¾ªä¸Šä¸€èŠ‚ä¸­æè¿°çš„ç›¸åŒçš„æ¦‚å¿µã€‚ä¸‹é¢æ˜¯UserRepositoryImplçš„å®Œæ•´æµ‹è¯•ç±»: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146public class UserRepositoryImplTest &#123; private static final String USER_LOGIN_RIGGAROO = \"riggaroo\"; private static final String USER_LOGIN_2_REBECCA = \"rebecca\"; @Mock GithubUserRestService githubUserRestService; private UserRepository userRepository; @Before public void setUp() &#123; MockitoAnnotations.initMocks(this); userRepository = new UserRepositoryImpl(githubUserRestService); &#125; @Test public void searchUsers_200OkResponse_InvokesCorrectApiCalls() &#123; //Given when(githubUserRestService.searchGithubUsers(anyString())).thenReturn(Observable.just(githubUserList())); when(githubUserRestService.getUser(anyString())) .thenReturn(Observable.just(user1FullDetails()), Observable.just(user2FullDetails())); //When TestSubscriber&lt;List&lt;User&gt;&gt; subscriber = new TestSubscriber&lt;&gt;(); userRepository.searchUsers(USER_LOGIN_RIGGAROO).subscribe(subscriber); //Then subscriber.awaitTerminalEvent(); subscriber.assertNoErrors(); List&lt;List&lt;User&gt;&gt; onNextEvents = subscriber.getOnNextEvents(); List&lt;User&gt; users = onNextEvents.get(0); Assert.assertEquals(USER_LOGIN_RIGGAROO, users.get(0).getLogin()); Assert.assertEquals(USER_LOGIN_2_REBECCA, users.get(1).getLogin()); verify(githubUserRestService).searchGithubUsers(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_2_REBECCA); &#125; private UsersList githubUserList() &#123; User user = new User(); user.setLogin(USER_LOGIN_RIGGAROO); User user2 = new User(); user2.setLogin(USER_LOGIN_2_REBECCA); List&lt;User&gt; githubUsers = new ArrayList&lt;&gt;(); githubUsers.add(user); githubUsers.add(user2); UsersList usersList = new UsersList(); usersList.setItems(githubUsers); return usersList; &#125; private User user1FullDetails() &#123; User user = new User(); user.setLogin(USER_LOGIN_RIGGAROO); user.setName(\"Rigs Franks\"); user.setAvatarUrl(\"avatar_url\"); user.setBio(\"Bio1\"); return user; &#125; private User user2FullDetails() &#123; User user = new User(); user.setLogin(USER_LOGIN_2_REBECCA); user.setName(\"Rebecca Franks\"); user.setAvatarUrl(\"avatar_url2\"); user.setBio(\"Bio2\"); return user; &#125; @Test public void searchUsers_IOExceptionThenSuccess_SearchUsersRetried() &#123; //Given when(githubUserRestService.searchGithubUsers(anyString())) .thenReturn(getIOExceptionError(), Observable.just(githubUserList())); when(githubUserRestService.getUser(anyString())) .thenReturn(Observable.just(user1FullDetails()), Observable.just(user2FullDetails())); //When TestSubscriber&lt;List&lt;User&gt;&gt; subscriber = new TestSubscriber&lt;&gt;(); userRepository.searchUsers(USER_LOGIN_RIGGAROO).subscribe(subscriber); //Then subscriber.awaitTerminalEvent(); subscriber.assertNoErrors(); verify(githubUserRestService, times(2)).searchGithubUsers(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_2_REBECCA); &#125; @Test public void searchUsers_GetUserIOExceptionThenSuccess_SearchUsersRetried() &#123; //Given when(githubUserRestService.searchGithubUsers(anyString())).thenReturn(Observable.just(githubUserList())); when(githubUserRestService.getUser(anyString())) .thenReturn(getIOExceptionError(), Observable.just(user1FullDetails()), Observable.just(user2FullDetails())); //When TestSubscriber&lt;List&lt;User&gt;&gt; subscriber = new TestSubscriber&lt;&gt;(); userRepository.searchUsers(USER_LOGIN_RIGGAROO).subscribe(subscriber); //Then subscriber.awaitTerminalEvent(); subscriber.assertNoErrors(); verify(githubUserRestService, times(2)).searchGithubUsers(USER_LOGIN_RIGGAROO); verify(githubUserRestService, times(2)).getUser(USER_LOGIN_RIGGAROO); verify(githubUserRestService).getUser(USER_LOGIN_2_REBECCA); &#125; @Test public void searchUsers_OtherHttpError_SearchTerminatedWithError() &#123; //Given when(githubUserRestService.searchGithubUsers(anyString())).thenReturn(get403ForbiddenError()); //When TestSubscriber&lt;List&lt;User&gt;&gt; subscriber = new TestSubscriber&lt;&gt;(); userRepository.searchUsers(USER_LOGIN_RIGGAROO).subscribe(subscriber); //Then subscriber.awaitTerminalEvent(); subscriber.assertError(HttpException.class); verify(githubUserRestService).searchGithubUsers(USER_LOGIN_RIGGAROO); verify(githubUserRestService, never()).getUser(USER_LOGIN_RIGGAROO); verify(githubUserRestService, never()).getUser(USER_LOGIN_2_REBECCA); &#125; private Observable getIOExceptionError() &#123; return Observable.error(new IOException()); &#125; private Observable&lt;UsersList&gt; get403ForbiddenError() &#123; return Observable.error(new HttpException( Response.error(403, ResponseBody.create(MediaType.parse(\"application/json\"), \"Forbidden\")))); &#125;&#125; è¿è¡Œå•å…ƒæµ‹è¯•åœ¨ç¼–å†™å®Œè¿™äº›æµ‹è¯•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œå®ƒä»¬ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦é€šè¿‡äº†æµ‹è¯•ï¼Œçœ‹çœ‹æœ‰å¤šå°‘ä»£ç è¢«æµ‹è¯•è¦†ç›–äº†ã€‚ è¦è¿è¡Œæµ‹è¯•ï¼Œæ‚¨å¯ä»¥å³é”®å•å‡»æµ‹è¯•ç±»åï¼Œå¹¶é€‰æ‹©â€œRun UserRepositoryImplTest with Coverageâ€ ç„¶åä½ ä¼šçœ‹åˆ°ç»“æœå‡ºç°åœ¨Android Studioçš„å³è¾¹ã€‚ æˆ‘ä»¬åœ¨UserRepositoryImplä¸Šæœ‰100%çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡ã€‚è€¶! åœ¨ä¸‹ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå®ç°UIä»¥æ˜¾ç¤ºæœç´¢ç»“æœé›†å¹¶ä¸ºå…¶ç¼–å†™æ›´å¤šçš„æµ‹è¯•ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"}]},{"title":"Android è‡ªåŠ¨åŒ–æµ‹è¯• - ç¬¬2éƒ¨åˆ† å®‰è£…","slug":"automated-android-testing-part-2-setup","date":"2017-11-17T10:34:14.000Z","updated":"2020-07-25T02:57:18.193Z","comments":true,"path":"2017/11/17/automated-android-testing-part-2-setup/","link":"","permalink":"https://jigangduan.github.io/2017/11/17/automated-android-testing-part-2-setup/","excerpt":"åœ¨æœ¬ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»è‡ªåŠ¨åŒ–çš„Androidæµ‹è¯•çš„ä»‹ç»ã€‚åœ¨è¿™ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç³»åˆ—çš„ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸ºä»€ä¹ˆè¦ç¼–å†™æµ‹è¯•ã€æµ‹è¯•æ–‡ä»¶å¤¹æ‰€åœ¨çš„ä½ç½®ä»¥åŠåœ¨Androidä¸­ä½¿ç”¨çš„ä¸åŒç±»å‹çš„æµ‹è¯•ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»Androidåº”ç”¨ç¨‹åºçš„å…¸å‹ç»“æ„å’Œè®¾ç½®ï¼Œä»¥ä¾¿è¿›è¡Œæµ‹è¯•ã€‚æˆ‘å°†åœ¨æœ¬ç³»åˆ—ä¸­ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œå¹¶é€æ­¥å®Œæˆæˆ‘çš„æ€æƒ³è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥ã€‚æˆ‘ä»¬å°†è¦åˆ›å»ºçš„åº”ç”¨æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œå®ƒå¯ä»¥ä¸ºç”¨æˆ·æœç´¢Githubçš„APIã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„ä¸€ä¸ªç²—ç•¥çš„æ¨¡å‹:","text":"åœ¨æœ¬ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»è‡ªåŠ¨åŒ–çš„Androidæµ‹è¯•çš„ä»‹ç»ã€‚åœ¨è¿™ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç³»åˆ—çš„ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸ºä»€ä¹ˆè¦ç¼–å†™æµ‹è¯•ã€æµ‹è¯•æ–‡ä»¶å¤¹æ‰€åœ¨çš„ä½ç½®ä»¥åŠåœ¨Androidä¸­ä½¿ç”¨çš„ä¸åŒç±»å‹çš„æµ‹è¯•ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»Androidåº”ç”¨ç¨‹åºçš„å…¸å‹ç»“æ„å’Œè®¾ç½®ï¼Œä»¥ä¾¿è¿›è¡Œæµ‹è¯•ã€‚æˆ‘å°†åœ¨æœ¬ç³»åˆ—ä¸­ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œå¹¶é€æ­¥å®Œæˆæˆ‘çš„æ€æƒ³è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥ã€‚æˆ‘ä»¬å°†è¦åˆ›å»ºçš„åº”ç”¨æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œå®ƒå¯ä»¥ä¸ºç”¨æˆ·æœç´¢Githubçš„APIã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„ä¸€ä¸ªç²—ç•¥çš„æ¨¡å‹: å¼€å§‹ä½¿ç”¨ä¸€æ¬¾æ–°åº”ç”¨ æ‰“å¼€Android Studioï¼Œé€‰æ‹©â€œStart a new Android Projectâ€ã€‚ æŠŠè¿™ä¸ªé¡¹ç›®å«åšâ€œGusâ€(Github User Search)å’Œå…¬å¸åŸŸåâ€œriggaroo.co.zaâ€ã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªåŒ…å â€”â€” za.co.riggaroo.gusã€‚å•å‡»nextã€‚ æ¥ä¸‹æ¥ï¼Œé€‰æ‹©æ‚¨å¸Œæœ›æ”¯æŒçš„Androidç‰ˆæœ¬(æˆ‘ä¸€èˆ¬ä¸ä¼šä½äºAPI 16ã€‚å¦‚æœæ‚¨é€‰æ‹©äº†API 16å’Œä»¥ä¸Šçš„APIï¼Œæ‚¨å°†è¦†ç›–95.2%çš„ç”¨æˆ·ã€‚é€‰æ‹©APIç‰ˆæœ¬16å¹¶å•å‡»â€œNextâ€ã€‚ é€‰æ‹©â€œEmpty Activityâ€å¹¶å•å‡»â€œNextâ€ã€‚ å°†activityçš„åç§°æ›´æ”¹ä¸ºUserSearchActivityå’Œå¸ƒå±€æ–‡ä»¶åˆ°activity_user_searchã€‚å•å‡»â€œFinishâ€ã€‚ å¦‚æœä½ è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œä½ åº”è¯¥çœ‹åˆ°å¦‚ä¸‹çš„ç©ºç™½activityã€‚ æ·»åŠ æµ‹è¯•ä¾èµ–å¯¼èˆªåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºbuild.gradleæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ã€‚éœ€è¦æ·»åŠ çš„æµ‹è¯•ä¾èµ–åŒ…æ‹¬Espressoã€Mockitoã€PowerMockå’ŒHamcrestã€‚Retrofitã€OkHttpã€RxJavaå’ŒRxAndroidä¹Ÿå°†è¢«æ·»åŠ ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæœ‰æ•ˆçš„ç½‘ç»œè¿æ¥ï¼Œå¹¶å®ç°æ›´ç®€æ´çš„ä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445compile &apos;com.squareup.okhttp3:logging-interceptor:3.4.0-RC1&apos; compile &apos;com.android.support:appcompat-v7:24.1.1&apos; compile &apos;com.android.support.constraint:constraint-layout:1.0.0-alpha4&apos; //Retrofit, RxJava and OkHttp. compile &apos;com.squareup.retrofit2:retrofit:2.1.0&apos; compile &apos;com.squareup.retrofit2:converter-gson:2.1.0&apos; compile &apos;com.squareup.okhttp3:okhttp:3.4.0-RC1&apos; compile &apos;com.squareup.retrofit2:adapter-rxjava:2.1.0&apos; compile &apos;io.reactivex:rxandroid:1.2.1&apos; compile &apos;io.reactivex:rxjava:1.1.6&apos; compile &apos;com.squareup.picasso:picasso:2.5.2&apos; //Dependencies for JUNit and unit tests. testCompile &quot;junit:junit:4.12&quot; testCompile &quot;org.mockito:mockito-all:1.10.19&quot; testCompile &quot;org.hamcrest:hamcrest-all:1.3&quot; testCompile(&quot;org.powermock:powermock-module-junit4:1.6.2&quot;) testCompile(&quot;org.powermock:powermock-api-mockito:1.6.2&quot;) testCompile &apos;com.squareup.okhttp3:mockwebserver:3.4.0-RC1&apos; //Dependencies for Espresso androidTestCompile &apos;com.android.support:appcompat-v7:24.1.1&apos; androidTestCompile(&apos;com.android.support.test.espresso:espresso-core:2.2.2&apos;, &#123; exclude group: &apos;com.android.support&apos;, module: &apos;support-annotations&apos; &#125;) androidTestCompile(&quot;com.android.support.test:runner:0.5&quot;) &#123; exclude module: &apos;support-annotations&apos; exclude module: &apos;support-v4&apos; &#125; androidTestCompile(&quot;com.android.support.test:rules:0.5&quot;) &#123; exclude module: &apos;support-annotations&apos; exclude module: &apos;support-v4&apos; &#125; androidTestCompile(&quot;com.android.support.test.espresso:espresso-intents:2.2.2&quot;) &#123; exclude module: &apos;recyclerview-v7&apos; exclude module: &apos;support-annotations&apos; exclude module: &apos;support-v4&apos; &#125; androidTestCompile(&apos;com.android.support.test.espresso:espresso-contrib:2.2.1&apos;) &#123; exclude module: &apos;recyclerview-v7&apos; exclude module: &apos;support-annotations&apos; exclude module: &apos;support-v4&apos; &#125; testCompileæ˜¯ç”¨äºå•å…ƒæµ‹è¯•çš„é…ç½®(ä½äºsrc/test)ï¼Œè€ŒandroidTestCompileç”¨äºäº¤äº’æµ‹è¯•(ä½äºsrc/androidTest)ã€‚è¿™ä¸¤ç§ç±»å‹çš„æµ‹è¯•ä¹‹é—´çš„å·®å¼‚å¯ä»¥åœ¨æœ¬ç³»åˆ—çš„ç¬¬1éƒ¨åˆ†ä¸­æ‰¾åˆ°ã€‚ ä½¿ç”¨Gradle Build Flavorsä½¿èƒ½Mockingä¸ºäº†æ–¹ä¾¿å¿«æ·åœ°å¯¹UIè¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬ä¸ä¼šå¯¹Githubæä¾›çš„APIsè¿›è¡Œè®¿é—®ã€‚æˆ‘ä»¬å°†æ¨¡æ‹Ÿå“åº”å¹¶æ¨¡æ‹Ÿä¸åŒç½‘ç»œçš„å“åº”ã€‚æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘è¦æ¼”ç¤ºçš„æ–¹æ³•æ˜¯ä½¿ç”¨Gradle product flavorsã€‚ Flavorså…è®¸ä½ æ„å»ºä¸åŒç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼Œæœ‰ä¸€äº›æºä»£ç å·®å¼‚æˆ–èµ„æºå·®å¼‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦åˆ¶ä½œä¸€ä¸ªå…è´¹ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºå’Œä¸€ä¸ªå¸¦æœ‰æ›´å¤šåŠŸèƒ½çš„ä»˜è´¹ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½¿ç”¨product flavorså°†æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„å¥½æ–¹æ³•ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªâ€œproductionâ€å’Œâ€œmockâ€çš„flavorã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªâ€œstagingâ€çš„flavorï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªèˆå°ç¯å¢ƒï¼Œæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„åº”ç”¨æŒ‡å‘å®ƒã€‚è¿™å°†å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªè®¾å¤‡ä¸Šå®‰è£…ä¸€ä¸ªproductionç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨mockç‰ˆæœ¬ä¸Šå®‰è£…ã€‚ ä¸ºäº†ä½¿ç”¨productFlavorsï¼Œå¯¼èˆªåˆ°ä½ çš„app build.gradleæ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°android{ }éƒ¨åˆ†ã€‚ä¸‹é¢çš„ä»£ç æ„å‘³ç€å¯¹äºmockå˜ä½“ï¼ŒapplicationIdå°†ä¸åŒï¼Œè¿™æ„å‘³ç€æˆ‘å¯ä»¥åŒæ—¶åœ¨ä¸€ä¸ªè®¾å¤‡ä¸Šå®‰è£…ã€‚å¯¹äºprodç‰ˆæœ¬ï¼ŒapplicationIdå°†ä»defaultConfigè®¾ç½®ä¸­è·å–ã€‚ 12345678productFlavors &#123; prod &#123; &#125; mock &#123; applicationId &quot;za.co.riggaroo.gus.mock&quot; &#125;&#125; è°ƒç”¨Gradle Syncï¼Œç„¶ååœ¨IDEçš„å·¦è¾¹ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªâ€œBuild Variantsâ€é€‰é¡¹å¡ã€‚æ‰“å¼€å®ƒï¼Œä½ å¯ä»¥çœ‹åˆ°ä½ çš„åº”ç”¨çš„ä¸åŒé£æ ¼ã€‚ å¦‚æœæ‚¨é€‰æ‹©äº†ä¸€ä¸ªä¸åŒçš„å˜ä½“ï¼Œå½“æ‚¨å•å‡»runæ—¶ï¼Œå°†éƒ¨ç½²åˆ°æ‚¨çš„è®¾å¤‡ä¸Šçš„æ„å»ºå°†ä½¿ç”¨è¯¥å˜é‡çš„æºç é›†å’ŒapplicationIdã€‚ è¿è¡Œå•å…ƒæµ‹è¯•ä¸ºäº†è¿è¡Œé¡¹ç›®ä¸­å­˜åœ¨çš„é»˜è®¤å•å…ƒæµ‹è¯•(ExampleUnitTest)ï¼Œæ‚¨å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼æ¥å®Œæˆ: åœ¨Android Studioä¸­ï¼Œå¯¼èˆªåˆ°app/src/test/javaæ–‡ä»¶å¤¹ï¼Œå³é”®å•å‡»ã€‚ç‚¹å‡»â€œRun Testsâ€ã€‚ ä½¿ç”¨Gradle: åœ¨ç»ˆç«¯ä½ å¯ä»¥è¿è¡Œ ./gradlew check è¿è¡Œäº¤äº’æµ‹è¯•(éœ€è¦è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨)ä¸ºäº†è¿è¡Œè¿è¡Œé¡¹ç›®ä¸­é»˜è®¤äº¤äº’æµ‹è¯•(ExampleInstrumentationTest),ä½ å¯ä»¥åœ¨ä»¥ä¸‹æ–¹é¢: åœ¨Android Studioä¸­ï¼Œå¯¼èˆªåˆ°app/src/androidTest/javaæ–‡ä»¶å¤¹ï¼Œå³é”®å•å‡»ã€‚å•å‡»â€œRun All Testsâ€ã€‚ ä½¿ç”¨Gradle: åœ¨ç»ˆç«¯ä½ å¯ä»¥è¿è¡Œ ./gradlew connectedAndroidTest å¦‚ä½•æ„é€ æ‚¨çš„ä»£ç ä»¥å®ç°ç®€å•çš„æµ‹è¯•ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘å°†ä½¿ç”¨ä¾èµ–é¡¹æ³¨å…¥ã€‚æ‚¨å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•æ¡†æ¶çš„æƒ…å†µä¸‹å®ç°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯å¾ˆå¤šäººéƒ½æå€¡ä½¿ç”¨Dagger 2æ¥å®ç°å®ƒã€‚è¿™ç¯‡åšå®¢æ–‡ç« ä¸ä¼šä½¿ç”¨Daggerã€‚ åœ¨ä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„ä¸­åˆ›å»ºè¿™äº›ç±»: æˆ‘æœ‰4ä¸ªé¡¶çº§æ–‡ä»¶å¤¹ç”¨äºåº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ã€‚è¿™å¯èƒ½ä¼šè®©ä½ çš„åº”ç”¨å˜å¾—æ›´å¤æ‚ã€‚è¿™äº›æ˜¯æˆ‘å–œæ¬¢åˆ›å»ºçš„åŸºæœ¬æ–‡ä»¶å¤¹: presentation â€”â€” åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘é€šè¿‡ç‰¹æ€§åˆ›å»ºå­æ–‡ä»¶å¤¹å’Œç»„åŠŸèƒ½ã€‚åœ¨æ­¤æƒ…å†µï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸ºsearchçš„æ–‡ä»¶å¤¹ï¼Œå®ƒå°†ä¿å­˜æœç´¢å±å¹•çš„viewå’Œpresenterã€‚å®ƒè¿˜å°†åŒ…å«ç”¨äºæœç´¢å±å¹•çš„é€‚é…å™¨å’Œä»»ä½•å…¶ä»–è§†å›¾ç›¸å…³ä»£ç ã€‚ data â€”â€” è¿™å°†åŒ…å«ä»Github APIè·å–æ•°æ®çš„å­˜å‚¨åº“(repositories)ã€‚ model - åŒ…å«å°†åœ¨è¡¨ç¤ºå±‚ä¸Šä½¿ç”¨çš„æ¨¡å‹ï¼Œä»¥åŠæ¥è‡ªäºæœåŠ¡è°ƒç”¨çš„æ¨¡å‹ã€‚ injection â€”â€” å°†ç”¨äºä¾èµ–æ³¨å…¥çš„ç±»ã€‚ æˆ‘ä»¬å·²ç»ä»‹ç»äº†ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„è®¾ç½®ã€å¦‚ä½•è¿è¡Œä¸åŒç±»å‹çš„æµ‹è¯•ä»¥åŠæˆ‘ä»¬å°†éµå¾ªçš„æ–‡ä»¶å¤¹ç»“æ„ã€‚è¿™è®©æˆ‘ä»¬æœ‰äº†ä¸€æ¡å¾ˆå¥½çš„é€”å¾„æ¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå†™æµ‹è¯•ï¼Œå¦‚æœä½ æƒ³çœ‹çœ‹è¿™ç¯‡åšæ–‡çš„ç»“æœï¼Œå°±çœ‹çœ‹è¿™ç¯‡åšæ–‡å¯¹åº”çš„å®Œæ•´ä»£ç å§ã€‚ æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡åšæ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡æµ‹è¯•å®ç°è¯¥ç‰¹æ€§ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"}]},{"title":"Android è‡ªåŠ¨åŒ–æµ‹è¯• - ç¬¬1éƒ¨åˆ† ä»‹ç»","slug":"introduction-automated-android-testing","date":"2017-11-17T09:29:12.000Z","updated":"2020-07-25T02:57:18.209Z","comments":true,"path":"2017/11/17/introduction-automated-android-testing/","link":"","permalink":"https://jigangduan.github.io/2017/11/17/introduction-automated-android-testing/","excerpt":"å¾ˆå¤šäººå¯¹å¦‚ä½•åœ¨Androidä¸­è¿›è¡Œæµ‹è¯•æ„Ÿåˆ°å›°æƒ‘å’Œä¸ç¡®å®šã€‚åœ¨è¿‡å»ï¼Œæµ‹è¯•Androidåº”ç”¨ç¨‹åºæ˜¯éå¸¸å›°éš¾çš„ï¼Œå¹¶æ²¡æœ‰å¤ªå¤šçš„æ–¹å‘ã€‚åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œå°†å°è¯•è®©ä½ çš„æµ‹è¯•æ›´å®¹æ˜“ä¸€äº›ã€‚è¿™ç¬¬ä¸€ç¯‡æ–‡ç« åªæ˜¯ä¸ºäº†è®©ä½ å¼€å§‹æµ‹è¯•ï¼Œæ¥ä¸‹æ¥çš„å‡ ç« å°†æ·±å…¥Androidçš„æµ‹è¯•ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼","text":"å¾ˆå¤šäººå¯¹å¦‚ä½•åœ¨Androidä¸­è¿›è¡Œæµ‹è¯•æ„Ÿåˆ°å›°æƒ‘å’Œä¸ç¡®å®šã€‚åœ¨è¿‡å»ï¼Œæµ‹è¯•Androidåº”ç”¨ç¨‹åºæ˜¯éå¸¸å›°éš¾çš„ï¼Œå¹¶æ²¡æœ‰å¤ªå¤šçš„æ–¹å‘ã€‚åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œå°†å°è¯•è®©ä½ çš„æµ‹è¯•æ›´å®¹æ˜“ä¸€äº›ã€‚è¿™ç¬¬ä¸€ç¯‡æ–‡ç« åªæ˜¯ä¸ºäº†è®©ä½ å¼€å§‹æµ‹è¯•ï¼Œæ¥ä¸‹æ¥çš„å‡ ç« å°†æ·±å…¥Androidçš„æµ‹è¯•ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼ ä¸ºä»€ä¹ˆè¦æµ‹è¯•å‘¢ï¼Ÿ æµ‹è¯•è¿«ä½¿ä½ ä»¥ä¸åŒçš„æ–¹å¼æ€è€ƒï¼Œå¹¶éšå«åœ°ä½¿ä½ çš„ä»£ç æ›´æ¸…æ™°ã€‚ å¦‚æœæ‚¨çš„ä»£ç æœ‰æµ‹è¯•ï¼Œæ‚¨ä¼šå¯¹è‡ªå·±çš„ä»£ç æ›´æœ‰ä¿¡å¿ƒã€‚ é—ªäº®çš„ç»¿è‰²çŠ¶æ€æ å’Œè¯¦ç»†çš„æŠ¥å‘Šè¯¦ç»†ï¼Œè¯´æ˜ç¼–å†™æµ‹è¯•çš„åæœè¦†ç›–äº†ä½ å¤šå°‘çš„ä»£ç ã€‚ å›å½’æµ‹è¯•å˜å¾—å®¹æ˜“å¾ˆå¤šï¼Œå› ä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•ä¼šé¦–å…ˆæ”¶é›†é”™è¯¯ã€‚ å›å½’æµ‹è¯•å¯¹æˆ‘æ¥è¯´æ˜¯æœ€å¤§çš„å¥½å¤„ã€‚å¦‚æœä½ é‡æ„ä»£ç ï¼Œä¸”æµ‹è¯•ä»ç„¶é€šè¿‡ï¼Œä½ ä¼šç›¸ä¿¡ä½ æ²¡æœ‰é€ æˆä»»ä½•ç ´åã€‚æµ‹è¯•çš„é—®é¢˜åœ¨äºï¼Œæ‚¨å¯èƒ½ä¸ä¼šç«‹å³çœ‹åˆ°æµ‹è¯•çš„å¥½å¤„ï¼Œå› ä¸ºçœŸæ­£çš„ä»·å€¼åªä¼šåœ¨éœ€è¦é‡æ„çš„å‡ ä¸ªæœˆåæ‰ä¼šæ˜¾ç°å‡ºæ¥ã€‚ Androidä¸­æœ‰å“ªäº›ç±»å‹çš„æµ‹è¯•ï¼Ÿå•å…ƒæµ‹è¯•å•å…ƒæµ‹è¯•é€šå¸¸ä»¥å¯é‡å¤çš„æ–¹å¼å®ç°å°½å¯èƒ½å°çš„ä»£ç å•å…ƒï¼ˆå¯ä»¥æ˜¯æ–¹æ³•ï¼Œç±»æˆ–ç»„ä»¶ï¼‰çš„åŠŸèƒ½ã€‚ ç”¨äºæ‰§è¡Œæ­¤æµ‹è¯•çš„å·¥å…·ï¼š JUnit - æ­£å¸¸çš„æµ‹è¯•æ–­è¨€ã€‚ Mockito - æ¨¡æ‹Ÿå…¶ä»–æœªç»æµ‹è¯•çš„ç±»ã€‚ PowerMock - æ¨¡æ‹Ÿé™æ€ç±»ï¼Œå¦‚Androidç¯å¢ƒç±»ç­‰ã€‚ UIæµ‹è¯• - äº¤äº’æµ‹è¯•UIæµ‹è¯•æˆ–äº¤äº’æµ‹è¯•æ¨¡æ‹Ÿå…¸å‹çš„ç”¨æˆ·ä¸æ‚¨çš„åº”ç”¨ç¨‹åºçš„äº¤äº’ã€‚ç‚¹å‡»æŒ‰é’®ï¼Œè¾“å…¥æ–‡æœ¬æ˜¯UIæµ‹è¯•å¯ä»¥å®Œæˆçš„ä¸€äº›äº‹æƒ…ã€‚ ç”¨äºæ‰§è¡Œæ­¤æµ‹è¯•çš„å·¥å…·ï¼š Espresso - ç”¨äºåœ¨ä½ çš„åº”ç”¨ä¸­è¿›è¡Œæµ‹è¯•ï¼Œé€‰æ‹©é¡¹ç›®ï¼Œç¡®ä¿æŸäº›ä¸œè¥¿æ˜¯å¯è§çš„ã€‚ UIAutomator - ç”¨äºæµ‹è¯•ä¸åŒåº”ç”¨ä¹‹é—´çš„äº¤äº’ã€‚ è¿˜æœ‰å…¶ä»–å·¥å…·å¯ç”¨äºæ­¤ç±»æµ‹è¯•ï¼Œå¦‚ Robotiumï¼Œ Appiumï¼Œ Calabashï¼Œ Robolectricã€‚ å¼€å§‹è‡ªåŠ¨åŒ–æµ‹è¯•æˆ‘éœ€è¦åšä»€ä¹ˆ?ä¸ºäº†è®©ä½ åœ¨åº”ç”¨ä¸­å¼€å§‹è‡ªåŠ¨æµ‹è¯•ï¼Œä½ åº”è¯¥éµå¾ªæŸç§æ¶æ„æ¨¡å¼ï¼Œå¸®åŠ©ä½ ä»¥ä¸€ç§ç®€æ´ã€å¯æµ‹è¯•çš„æ–¹å¼æµ‹è¯•å’Œæ„å»ºä½ çš„åº”ç”¨ç¨‹åºã€‚å¾ˆå®¹æ˜“è¿›è¡Œæµ‹è¯•çš„ä¸€ä¸ªæ¨¡å¼æ˜¯æ¨¡å‹è§†å›¾å±•ç¤ºè€…(MVP)ï¼Œç”¨äºæŸ¥çœ‹ç½‘ç»œå’Œæ•°æ®åº“è®¿é—®çš„è§†å›¾å’Œå­˜å‚¨åº“æ¨¡å¼ã€‚ å½“ç„¶ï¼Œè¿™ä¸æ˜¯æ‚¨ä½œä¸ºAndroidå¼€å‘è€…å”¯ä¸€çš„é€‰æ‹©ï¼Œå®ƒæ˜¯æ‚¨å¯ä»¥æ¢ç´¢çš„è®¸å¤šæ–¹æ³•ä¹‹ä¸€ï¼Œä»¥ä¾¿è·å¾—æµ‹è¯•è¦†ç›–ç‡å’Œç®€æ´çš„æ¶æ„ã€‚ æˆ‘å‘ç°åœ¨æ²¡æœ‰å®šä¹‰ç»“æ„çš„æƒ…å†µä¸‹å®ç°æµ‹è¯•éå¸¸å›°éš¾ï¼Œé€šå¸¸æˆ‘çš„æµ‹è¯•æ˜¯æ— ç”¨çš„ï¼Œæˆ‘ä¸çŸ¥é“è¦æµ‹è¯•ä»€ä¹ˆï¼Œåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­è·å–ä»£ç ä¹Ÿå¾ˆå›°éš¾ã€‚æˆ‘çš„UIæµ‹è¯•ä¹Ÿä¸æ˜¯å¾ˆå¯é ï¼Œå› ä¸ºä»–ä»¬æ­£åœ¨å¯¹ç”Ÿäº§æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ã€‚å¸Œæœ›æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªåšå®¢ç³»åˆ—ä¸­è§£å†³è¿™äº›é—®é¢˜ã€‚ ä»¥å¯æµ‹è¯•çš„æ–¹å¼æ„å»ºåº”ç”¨ç¨‹åºä¸‹é¢æ˜¯ä¸€ä¸ªå›¾è¡¨ï¼Œæè¿°äº†æˆ‘å°†ç”¨ä½œåšå®¢ç³»åˆ—æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†çš„æŒ‡å¯¼åŸåˆ™: è§†å›¾(Views) - Activitieså’ŒFragmentsã€‚è¿™æ˜¯æˆ‘ä»¬è®¾ç½®æ–‡æœ¬å¹¶è¿›è¡ŒUIæ›´æ”¹çš„åœ°æ–¹ã€‚æˆ‘é€šå¸¸å–œæ¬¢åœ¨è¿™éƒ¨åˆ†ä¸­ä¿ç•™Androidç‰¹å®šçš„ä»£ç ï¼Œå¹¶å°½é‡ä¸ä¼ é€’æ¯”è§†å›¾æ›´æ·±å…¥çš„å†…å®¹ï¼Œæ˜¾ç„¶è¿™å¹¶ä¸æ€»æ˜¯å®¹æ˜“çš„ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŒ‡å¯¼ï¼Œå¯ä»¥å°è¯•éµå¾ªã€‚è§†å›¾åº”è¯¥åªä¸presenterså¯¹è¯ã€‚ å±•ç¤ºè€…(Presenters) - è¿™æ˜¯å†³å®šåœ¨è§†å›¾ä¸­åº”è¯¥æ˜¾ç¤ºä»€ä¹ˆå†…å®¹çš„ä¸šåŠ¡é€»è¾‘ã€‚Presentersä¸Repositoriesäº¤äº’ä»¥è·å–ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯ä¼ è¾¾ç»™è§†å›¾ã€‚å¦‚æœä½ å¯ä»¥é¿å…ä½¿ç”¨Androidç‰¹æœ‰çš„ä»£ç ï¼Œå°½é‡é¿å…ä½¿ç”¨Androidçš„ä»£ç ï¼Œå› ä¸ºè¿™ä¼šä½¿å•å…ƒæµ‹è¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚ å­˜å‚¨åº“(Repositories) â€” å†³å®šä»å“ªé‡Œè·å–æ•°æ®ï¼Œå®ƒä»¬æ˜¯å¦æ¥è‡ªæœ¬åœ°æŒä¹…åŒ–çš„æ•°æ®?è¿˜æ˜¯åº”è¯¥ä»ç½‘ç»œä¸­è·å¾—æ•°æ®?Repositorieså’Œpresentersäº¤è°ˆ æ¨¡å‹(Models) â€” é€šå¸¸æ˜¯POJOsï¼Œè¿™äº›æ¨¡å‹è¢«Presenterå’ŒViewä½¿ç”¨ï¼Œä»¥ä¾¿å°†ä¿¡æ¯ä»Presenterä¸­ä¼ é€’ç»™Viewã€‚ å•å…ƒæµ‹è¯•å°†æµ‹è¯•Presenterså’ŒRepositoriesã€‚UIæµ‹è¯•å°†æµ‹è¯•è§†å›¾ä¸€ç›´åˆ°Repositoriesã€‚ æœ‰å¾ˆå¤šå¾ˆå¥½çš„æ–‡ç« æè¿°äº†MVPå’Œå…¶ä»–æ¶æ„é€‰é¡¹â€”â€”è¿™ç¯‡åšå®¢æ–‡ç« ä¸ä¼šè¯¦ç»†ä»‹ç»è¿™äº›ç»†èŠ‚ã€‚è¯·é˜…è¯»æ›´å¤šå…³äºAndroidæ¶æ„çš„æ–‡ç« ï¼Œè¿™é‡Œ,è¿™é‡Œå’Œè¿™é‡Œã€‚ åœ¨æˆ‘çš„Androidåº”ç”¨ä¸­ï¼Œè‡ªåŠ¨æµ‹è¯•åœ¨å“ªé‡Œ?åœ¨ä½ çš„Androidåº”ç”¨æ–‡ä»¶å¤¹ç»“æ„ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹å¯ä»¥å­˜æ”¾æµ‹è¯•: testå’ŒandroidTest androidTest â€”â€” Androidäº¤äº’æµ‹è¯•å°±åœ¨è¿™é‡Œã€‚è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æµ‹è¯•éœ€è¦è¿è¡Œåœ¨Androidæ¨¡æ‹Ÿå™¨æˆ–ç‰©ç†è®¾å¤‡ä¸Šã€‚ test/ â€“ å•å…ƒæµ‹è¯•è¢«æ”¾ç½®åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚å•å…ƒæµ‹è¯•è¿è¡Œåœ¨æœ¬åœ°æœºå™¨ä¸Šçš„JVMä¸Šï¼Œä¸è¿è¡Œåœ¨Androidè®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šã€‚è¿™æ„å‘³ç€ä»–ä»¬ä¸èƒ½è®¿é—®Androidç±»(ä¾‹å¦‚Contextç±»)ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä¸åŒç§ç±»çš„æµ‹è¯•ä»¥åŠåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­æ”¾ç½®å®ƒä»¬çš„ä½ç½®ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°†æ·±å…¥ä»‹ç»å¦‚ä½•æ„é€ ä»£ç ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚è¯·çœ‹è¿™é‡Œçš„ç¬¬2éƒ¨åˆ†ï¼","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"}]},{"title":"ç°ä»£ANDROIDå¼€å‘å…¥é—¨èµ„æº","slug":"resources-getting-started-android-development","date":"2017-11-14T01:54:31.000Z","updated":"2020-07-25T02:57:18.228Z","comments":true,"path":"2017/11/14/resources-getting-started-android-development/","link":"","permalink":"https://jigangduan.github.io/2017/11/14/resources-getting-started-android-development/","excerpt":"åŸæ–‡åœ°å€ ä½œè€…ï¼šRebecca åœ¨ä¸ºDVTçš„ç§»åŠ¨å¼€å‘è€…ç ”ç©¶ç”Ÿé¡¹ç›®æ±‡é›†äº†èµ„æºä¹‹åï¼Œæˆ‘æ„è¯†åˆ°æˆ‘æ‰€å¼•ç”¨çš„å†…å®¹å¯ä»¥æˆä¸ºç°ä»£Androidå¼€å‘å…¥é—¨çš„é‡è¦æŒ‡å¯¼ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸å®é™…çš„æ–¹æ³•æ¥åŸ¹å…»DVTçš„æ¯•ä¸šç”Ÿã€‚æˆ‘ä»¬ä¸¾åŠå·¥ä½œåŠå’Œå®é™…é¡¹ç›®ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„æ¯•ä¸šç”Ÿå¯¹Androidçš„å‘å±•æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†è§£ã€‚ éšç€ç½‘ä¸Šå¤§é‡çš„å†…å®¹å¯ç”¨ï¼Œå½“æˆ‘å¼€å§‹Androidå¼€å‘æ—¶ï¼Œæˆ‘ä¸çŸ¥é“åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶åº”è¯¥æ³¨æ„å“ªäº›åœ°æ–¹æˆ–ä»€ä¹ˆã€‚æœ‰ä¸€ä¸ªç®€æ´çš„åˆ—è¡¨ï¼Œå°±åƒè¿™ä¸ªåšå®¢æ–‡ç« ä¸­çš„é‚£ä¸ªï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯éå¸¸å®è´µçš„ã€‚æˆ‘å¸Œæœ›ä½ ä¹Ÿèƒ½æ‰¾åˆ°å®ƒçš„ä»·å€¼ã€‚ è¿™é‡Œæ˜¯ä¸€ä¸ªé“¾æ¥ï¼Œä»£ç å®éªŒå®¤å’Œå‚è€ƒèµ„æ–™çš„åˆ—è¡¨ï¼Œè¿™å¯¹ä»»ä½•æƒ³è¦å¼€å§‹Androidå¼€å‘çš„å¼€å‘äººå‘˜éƒ½æ˜¯æœ‰ç”¨çš„ã€‚","text":"åŸæ–‡åœ°å€ ä½œè€…ï¼šRebecca åœ¨ä¸ºDVTçš„ç§»åŠ¨å¼€å‘è€…ç ”ç©¶ç”Ÿé¡¹ç›®æ±‡é›†äº†èµ„æºä¹‹åï¼Œæˆ‘æ„è¯†åˆ°æˆ‘æ‰€å¼•ç”¨çš„å†…å®¹å¯ä»¥æˆä¸ºç°ä»£Androidå¼€å‘å…¥é—¨çš„é‡è¦æŒ‡å¯¼ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸å®é™…çš„æ–¹æ³•æ¥åŸ¹å…»DVTçš„æ¯•ä¸šç”Ÿã€‚æˆ‘ä»¬ä¸¾åŠå·¥ä½œåŠå’Œå®é™…é¡¹ç›®ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„æ¯•ä¸šç”Ÿå¯¹Androidçš„å‘å±•æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†è§£ã€‚ éšç€ç½‘ä¸Šå¤§é‡çš„å†…å®¹å¯ç”¨ï¼Œå½“æˆ‘å¼€å§‹Androidå¼€å‘æ—¶ï¼Œæˆ‘ä¸çŸ¥é“åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶åº”è¯¥æ³¨æ„å“ªäº›åœ°æ–¹æˆ–ä»€ä¹ˆã€‚æœ‰ä¸€ä¸ªç®€æ´çš„åˆ—è¡¨ï¼Œå°±åƒè¿™ä¸ªåšå®¢æ–‡ç« ä¸­çš„é‚£ä¸ªï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯éå¸¸å®è´µçš„ã€‚æˆ‘å¸Œæœ›ä½ ä¹Ÿèƒ½æ‰¾åˆ°å®ƒçš„ä»·å€¼ã€‚ è¿™é‡Œæ˜¯ä¸€ä¸ªé“¾æ¥ï¼Œä»£ç å®éªŒå®¤å’Œå‚è€ƒèµ„æ–™çš„åˆ—è¡¨ï¼Œè¿™å¯¹ä»»ä½•æƒ³è¦å¼€å§‹Androidå¼€å‘çš„å¼€å‘äººå‘˜éƒ½æ˜¯æœ‰ç”¨çš„ã€‚ ä¸€èˆ¬ç¼–ç¨‹å®è·µä¸€èˆ¬ç¼–ç¨‹å®è·µæ˜¯å¼€å‘èŒä¸šç”Ÿæ¶¯å¼€å§‹æˆåŠŸçš„å…³é”®ã€‚è¿™äº›åšæ³•åŒ…æ‹¬ï¼š æºä»£ç ç®¡ç†ï¼ˆGitï¼‰ - æºä»£ç ç®¡ç†æ˜¯ä¸€ç§ç®¡ç†ä»£ç ç‰ˆæœ¬çš„å·¥å…·ï¼Œå®ƒå¯ä»¥ååŒç¼–å†™è½¯ä»¶ã€‚ Gitå·¥ä½œæµç¨‹ - åœ¨ä½¿ç”¨æºä»£ç ç®¡ç†æ—¶ï¼Œæœ‰å¾ˆå¤šä¸åŒçš„æ–¹å¼æ¥ç®¡ç†è½¯ä»¶ã€‚æµè¡Œçš„æ–¹æ³•åŒ…æ‹¬ï¼šGitflowå·¥ä½œæµç¨‹ï¼Œé›†ä¸­å¼å·¥ä½œæµç¨‹ï¼Œåˆ†å‰å·¥ä½œæµç¨‹ç­‰ æŒç»­é›†æˆ - æŒç»­é›†æˆå¯ç¡®ä¿æ‚¨çš„ä»£ç åœ¨ä¸å±äºæ‚¨è‡ªå·±çš„è®¡ç®—æœºçš„æœåŠ¡å™¨ä¸Šæ„å»ºã€‚çœ‹çœ‹ä½¿ç”¨åƒJenkinsï¼ŒBuddybuildï¼ŒCircle CIï¼ŒTravisç­‰æ„å»ºæœåŠ¡å™¨ã€‚ åˆå¹¶è¯·æ±‚ - åˆå¹¶è¯·æ±‚æ˜¯è·å¾—æ‚¨å¼€å‘çš„ä»£ç éå¸¸è¯¦ç»†çš„åé¦ˆçš„å¥½æ–¹æ³•ã€‚ æ•æ·/Scrumæ–¹æ³• - å¤§å¤šæ•°ç°ä»£è½¯ä»¶å¼€å‘å›¢é˜Ÿéµå¾ªScrumæ–¹æ³•è¿›è¡Œå·¥ä½œã€‚ ä»£ç è´¨é‡å·¥å…· - å…¬å¸ç”¨è®¸å¤šå·¥å…·æ¥è¡¡é‡ä»£ç è´¨é‡å’Œä»£ç åº“çš„å¥åº·çŠ¶å†µã€‚è¯¸å¦‚æµ‹è¯•è¦†ç›–èŒƒå›´çš„è¡Œæ•°æˆ–ä»£ç åº“æ‰€å…·æœ‰çš„æŠ€æœ¯å€ºåŠ¡ç­‰åº¦é‡æ ‡å‡†æ˜¯å¯è§çš„ã€‚ä¸€äº›ç»å¸¸ä½¿ç”¨çš„å·¥å…·ï¼šSonarï¼ŒFindBugsï¼ŒCheckstyleå’ŒAndroid Lintã€‚ AndroidåŸºç¡€ä»‹ç»æœ‰ä¸€å¤§å †ç½‘ç«™æä¾›äº†Androidå¼€å‘å…¥é—¨çš„åŸºç¡€çŸ¥è¯†ã€‚æˆ‘çš„å»ºè®®æ˜¯éµå¾ªå®˜æ–¹æ–‡æ¡£æ¥ç†è§£åŸºç¡€çŸ¥è¯†ï¼Œç„¶ååœ¨è¿›å…¥åº”ç”¨ç¨‹åºè®¾è®¡çš„æ›´å¤šæŠ€æœ¯æ–¹é¢ï¼ˆå‚è§æœ¬æ–‡åé¢çš„éƒ¨åˆ†ï¼‰ä¸­æŸ¥çœ‹å…¶ä»–èµ„æºï¼ˆå¦‚åšå®¢ç­‰ï¼‰ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ ä¸€äº›å…¥é—¨èµ„æºï¼š Androidåº”ç”¨åŸºç¡€ Androidä¸­çš„ä¸€äº›ä¸»è¦ç»„ä»¶ï¼š Activities, Fragments, Services, Broadcast Receiversã€‚ Androidåº”ç”¨ç¨‹åºæ¸…å• ä»£ç å®éªŒå®¤ - å»ºç«‹æ‚¨çš„ç¬¬ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åº æŒæ¡Androidä¸­çš„å¸ƒå±€Androidä¸­æœ‰å¾ˆå¤šä¸åŒçš„å¸ƒå±€ç±»å‹ï¼Œä»FrameLayoutåˆ°RelativeLayoutåˆ°ConstraintLayoutã€‚ç¡®ä¿ä½ å¯¹è¿™äº›å¸¸ç”¨çš„å¸ƒå±€ç±»å‹æ„Ÿåˆ°æ»¡æ„ï¼šFrameLayoutï¼ŒRelativeLayoutï¼ŒLinearLayoutï¼ŒConstraintLayoutï¼ŒCoordinatorLayoutã€‚ èµ„æºï¼š æ”¯æŒä¸åŒçš„å±å¹•å°ºå¯¸ ä»£ç å®éªŒå®¤ - ConstraintLayout ä»£ç å®éªŒå®¤ - CoordinatorLayout æ„å»ºç³»ç»Ÿ - ä½¿ç”¨Gradleä½¿ç”¨Gradleåœ¨å¼€å‘Androidåº”ç”¨ç¨‹åºæ—¶å¯èƒ½ä¼šè¢«å¿½è§†ã€‚ç¡®ä¿ä½ äº†è§£åŸºç¡€çŸ¥è¯†ï¼Œç”šè‡³æ›´å¥½ - å­¦ä¹ å¦‚ä½•ç¼–å†™è‡ªå·±çš„gradleä»»åŠ¡ï¼ èµ„æºï¼š Gradleæ–‡æ¡£ é…ç½®ä½ çš„æ„å»º Androidä¸­çš„ç½‘ç»œå°½ç®¡å¤§éƒ¨åˆ†Androidæ–‡æ¡£éƒ½æ²¡æœ‰å¼•ç”¨Retrofitæˆ–OkHttpï¼Œä½†åœ¨Androidä¸­è¿›è¡Œè”ç½‘æ—¶ï¼Œè¿™äº›æ˜¯æœ€å¸¸ç”¨çš„åº“ã€‚ç†Ÿæ‚‰Android Studioä¸­æä¾›çš„ä¸åŒåˆ†æå·¥å…·ä¹Ÿæ˜¯å¾ˆå¥½çš„åšæ³•ã€‚ èµ„æºï¼š äº†è§£RESTfulæœåŠ¡ Retrofit - é€‚ç”¨äºAndroidå’ŒJavaçš„ç±»å‹å®‰å…¨çš„HTTPå®¢æˆ·ç«¯ OkHttp - ç”¨äºAndroidå’ŒJavaåº”ç”¨ç¨‹åºçš„HTTPå’ŒHTTP/2å®¢æˆ·ç«¯ Androidä¸­çš„ç½‘ç»œåˆ†æå™¨ - Android Studioä¸­çš„ä¸€æ¬¾å·¥å…·ï¼Œå¯ç”¨äºåˆ†ææ‚¨çš„ç½‘ç»œå‘¼å«ã€‚ Charles Proxy - ç”¨äºåœ¨æµ‹è¯•æ—¶æ‹¦æˆªç½‘ç»œå‘¼å«ã€‚ æ¶æ„æ‚¨çš„Androidåº”ç”¨ç¨‹åºä¸å¹¸çš„æ˜¯ï¼Œç¼–å†™ä»£ç å¹¶è®©åº”ç”¨ç¨‹åºç¼–è¯‘å¹¶ä¸æ˜¯çŸ¥é“å¦‚ä½•ç¼–å†™å¯ç»´æŠ¤çš„Androidåº”ç”¨ç¨‹åºçš„ç»“æŸã€‚å¤§è§„æ¨¡çš„Androidåº”ç”¨ç¨‹åºéœ€è¦éµå¾ªè‰¯å¥½çš„æ¶æ„è®¾è®¡ï¼Œä»¥ä½¿å…¶å¯ç»´æŠ¤å’Œå¯æµ‹è¯•ã€‚ç¼–å†™Androidåº”ç”¨ç¨‹åºæ—¶å¯ä»¥éµå¾ªè®¸å¤šä¸åŒçš„æ¨¡å¼ã€‚é€šå¸¸ä½¿ç”¨MVPï¼ŒMVVMå’ŒClean Architectureç­‰æ¨¡å¼ã€‚ç¡®ä¿ä½ äº†è§£æ¨¡å¼ä¹‹é—´çš„å·®å¼‚ï¼Œå› ä¸ºä½ ä¼šåœ¨å¤–é‡åˆ°è®¸å¤šä¸åŒçš„æ¨¡å¼ã€‚ èµ„æºï¼š Androidä½“ç³»ç»“æ„ç»„ä»¶æŒ‡å— æˆ‘åœ¨Androidä½“ç³»ç»“æ„ç»„ä»¶3éƒ¨åˆ†ç»„æˆçš„ç³»åˆ—ï¼ˆéƒ¨åˆ†1ï¼Œ2ï¼Œ3ï¼‰ Androidä½“ç³»ç»“æ„ç»„ä»¶è§†é¢‘ä»‹ç» Google Sample App Githubå­˜å‚¨åº“ ä»£ç å®éªŒå®¤ - æŒä¹…æ€§ ä»£ç å®éªŒå®¤ - ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ æµ‹è¯•ä½ çš„Androidåº”ç”¨ç¨‹åºä¸€æ—¦ä½ æŒæ¡äº†åˆ›å»ºAndroidåº”ç”¨ç¨‹åºçš„æœºä¼šï¼Œä½ å°†éœ€è¦è€ƒè™‘å¦‚ä½•æµ‹è¯•å®ƒä»¬ã€‚å•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•æ˜¯éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œæ‚¨éœ€è¦ç¡®ä¿è‡ªå·±ç†è§£ã€‚æœ‰å¾ˆå¤šä¸åŒçš„å·¥å…·å¯ä»¥ç”¨æ¥ç¼–å†™UIæµ‹è¯•ã€‚å¤§å¤šæ•°Androidå¼€å‘äººå‘˜ä½¿ç”¨Espressoå’ŒJUnitç¼–å†™æµ‹è¯•ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…¶ä»–å·¥å…·ï¼Œä¾‹å¦‚Robotiumï¼ŒCalabashï¼ŒAppiumç­‰ç­‰ã€‚æˆ‘æ¨èä½¿ç”¨Espressoå’ŒJUnitã€‚ èµ„æºï¼š Androidæµ‹è¯•æ”¯æŒåº“ Espresso JUnit Mockito ä»£ç å®éªŒ - Androidæµ‹è¯• ä»£ç å®éªŒ - Androidæ€§èƒ½æµ‹è¯• å‘å¸ƒæ‚¨çš„Androidåº”ç”¨ç¨‹åº å‡†å¤‡æ‚¨çš„åº”ç”¨ç¨‹åºçš„å‘å¸ƒ åº”ç”¨ç¨‹åºç­¾å ç‰ˆæœ¬åŒ–æ‚¨çš„åº”ç”¨ç¨‹åº ProGuard å®‰å…¨ä¸ºäº†ä¿æŠ¤æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œç¡®ä¿æ²¡æœ‰äººèƒ½å¤Ÿè®¿é—®æœªç»æˆæƒçš„å†…å®¹ï¼Œåº”è¯¥åšå¾ˆå¤šäº‹æƒ…ã€‚ç¡®ä¿ä½ æ­£åœ¨ä½¿ç”¨ProGuardï¼ˆå‰é¢æåˆ°è¿‡ï¼‰ã€‚äº†è§£ä¸­é—´è€…æ˜¯ä»€ä¹ˆæ ·ã€‚äº†è§£ä¸åŒçš„åŠ å¯†æ–¹æ³•ä»¥åŠå®‰å…¨åœ°å°†ä¿¡æ¯å­˜å‚¨åœ¨Androidåº”ç”¨ç¨‹åºä¸­çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¿æŠ¤æ‚¨çš„APIä»¤ç‰Œï¼Œè¯ä¹¦é”å®šç­‰ã€‚ èµ„æºï¼š Androidçš„å®‰å…¨æç¤º è¯ä¹¦é”å®š SafetyNet API Androidå¯†é’¥åº“ç³»ç»Ÿ é«˜çº§Androidä¸»é¢˜ä¸€æ—¦ä½ å·²ç»æ¶µç›–äº†ç¼–å†™Androidåº”ç”¨ç¨‹åºçš„æ‰€æœ‰åŸºç¡€çŸ¥è¯†ï¼Œæœ‰å‡ ä¸ªé«˜çº§ä¸»é¢˜ï¼Œä½ å¯èƒ½éœ€è¦è¦†ç›–ï¼Œä»¥ä¾¿è´¡çŒ®ç»™ä¸€äº›ä»£ç åº“ï¼š Kotlin - Kotlinæ˜¯Androidçš„æ–°ç¼–ç¨‹è¯­è¨€ï¼Œå¼€å‘äººå‘˜æ­£åœ¨Kotlinç§¯æç¼–å†™ä»–ä»¬çš„ä»£ç ã€‚å€¼å¾—å…³æ³¨Kotlinå¹¶ç©¿è¿‡Kotlin Koansã€‚è¿˜æœ‰ä¸€ä¸ªKotlinä»£ç å®éªŒå®¤ã€‚ RxJava - RxJavaæ˜¯ç”¨äºåŸºäºäº‹ä»¶çš„å¼‚æ­¥ç¼–ç¨‹çš„åº“ã€‚å®ƒå…è®¸æ‚¨å°†æ“ä½œç»„åˆåœ¨ä¸€èµ·ä»¥æ‰§è¡Œå¤æ‚çš„ä»»åŠ¡ï¼ˆå¦‚å°†å¤šä¸ªç½‘ç»œè°ƒç”¨ç»„åˆåœ¨ä¸€èµ·ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥éå¸¸æœ‰ç”¨åœ°ç®¡ç†æ‚¨çš„ä»£ç åœ¨å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚æœ‰ä¸€ä¸ªä¼Ÿå¤§çš„è§†é¢‘æ¥è‡ªæ°å…‹Â·æ²ƒé¡¿ï¼Œæè¿°å¦‚ä½•ä½¿ç”¨RxJavaå’Œä½¿ç”¨å®ƒçš„å¥½å¤„ã€‚ Daggerï¼ˆä¾èµ–æ³¨å…¥ï¼‰ - ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§åœ¨åº”ç”¨ç¨‹åºä¸­ç®¡ç†å¯¹è±¡åŠå…¶ä¾èµ–å…³ç³»çš„æ–¹æ³•ã€‚DIçš„æ¦‚å¿µä¸æ˜¯ä¸€ä¸ªAndroidçš„æ¦‚å¿µï¼Œä½†ä¹Ÿå¯ä»¥åœ¨è®¸å¤šå…¶ä»–æ¡†æ¶ä¸­ä½¿ç”¨ã€‚DIå¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´æœ‰æ•ˆåœ°æé«˜å†…å­˜å¹¶æé«˜å¯æµ‹è¯•æ€§ã€‚Dagger 2æ˜¯æœ€å—æ¬¢è¿çš„Android DIæ¡†æ¶ã€‚ Material Design - å¤§å¤šæ•°Androidåº”ç”¨ç¨‹åºéƒ½éµå¾ªGoogleçš„ææ–™è®¾è®¡æŒ‡å—ã€‚æŒ‡å—æ˜¯ä»¥ç”¨æˆ·ç†Ÿæ‚‰çš„æ ‡å‡†æ–¹å¼è®¾è®¡æ‚¨çš„åº”ç”¨ç¨‹åºçš„ä¸€ç§æ–¹å¼ã€‚ Androidæ”¯æŒåº“ - Androidä¸­çš„æ”¯æŒåº“å¯¹äºç¡®ä¿æ‚¨çš„åº”ç”¨åœ¨å¤šä¸ªAndroidç‰ˆæœ¬ä¸­çš„å¤–è§‚å’Œè¡Œä¸ºä¿æŒä¸€è‡´éå¸¸é‡è¦ã€‚æœ‰å‡ ä¸ªä¸åŒçš„åº“æœ‰ä¸åŒçš„ç›®çš„ã€‚é“¾æ¥çš„æ–‡ç« æè¿°äº†å›¾ä¹¦é¦†èƒŒåçš„æ¨ç†ã€‚ å†…å­˜æ³„æ¼ - åœ¨Androidä¸­ï¼Œåˆ›å»ºå†…å­˜æ³„æ¼éå¸¸å®¹æ˜“ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯è¡Œä¸ºï¼ˆéšæœºå´©æºƒï¼‰ã€‚é˜…è¯»æœ‰å…³å†…å­˜æ³„æ¼çš„ä¿¡æ¯ã€‚å¾ˆå¤šå¼€å‘äººå‘˜åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨LeakCanaryæ¥ç¡®ä¿æ²¡æœ‰ä»»ä½•å†…å­˜æ³„æ¼ã€‚ è·Ÿä¸Šç°ä»£Androidå¼€å‘çš„æœ€æ–°è¿›å±•æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è·Ÿä¸ŠAndroidç¤¾åŒºçš„æœ€æ–°å˜åŒ–å’Œå‘å±•ã€‚æˆ‘è§‰å¾—æœ‰ç”¨çš„ä¸€äº›æ–¹æ³•æ˜¯ï¼š è®¢é˜…Android Weeklyç®€è®¯ åœ¨Redditä¸Šå…³æ³¨/r/androiddev åœ¨Twitterä¸Šå…³æ³¨Android Google Developer Experts åœ¨Twitterä¸Šå…³æ³¨Android Studioï¼ŒAndroid Dev å¬Androidå¼€å‘æ’­å®¢(Fragmented, Android Developers Backstage, The Context, Android Snacks) ä½œä¸ºä¸€åAndroidå¼€å‘äººå‘˜ï¼Œæ‚¨ä¼šé‡åˆ°è®¸å¤šæ¦‚å¿µï¼Œä¾‹å¦‚å¤„ç†é€šçŸ¥ï¼Œå°éƒ¨ä»¶ï¼Œä¸»é¢˜å’Œæ ·å¼åŒ–åº”ç”¨ç¨‹åºç­‰ã€‚æ­¤åˆ—è¡¨æ¶µç›–äº†æˆ‘è®¤ä¸ºæœ‰å¿…è¦æˆä¸ºå“è¶Šçš„Androidå¼€å‘äººå‘˜çš„ä¸»è¦ä¸»é¢˜ï¼Œå¤§éƒ¨åˆ†å…¶ä»–ä¸»é¢˜ä½ å¯ä»¥è‡ªå·±å»ç†è§£ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"}]},{"title":"ReactorKit ä»‹ç»","slug":"ReactorKit","date":"2017-11-09T10:40:18.000Z","updated":"2020-07-25T02:57:18.161Z","comments":true,"path":"2017/11/09/ReactorKit/","link":"","permalink":"https://jigangduan.github.io/2017/11/09/ReactorKit/","excerpt":"ReactorKitæ˜¯ä¸€ä¸ªå“åº”å¼å’Œå•å‘çš„Swiftåº”ç”¨ç¨‹åºæ¶æ„çš„æ¡†æ¶ã€‚è¿™ä¸ªæ–‡ç« ä»‹ç»äº†ReactorKitçš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶æè¿°äº†å¦‚ä½•ä½¿ç”¨ReactorKitæ„å»ºåº”ç”¨ç¨‹åºã€‚ å¦‚æœæ‚¨å¸Œæœ›çœ‹åˆ°å®é™…çš„ä»£ç ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é¦–å…ˆçœ‹åˆ°ç¤ºä¾‹éƒ¨åˆ†ã€‚è®¿é—®APIå‚è€ƒçš„ä»£ç çº§æ–‡æ¡£ã€‚","text":"ReactorKitæ˜¯ä¸€ä¸ªå“åº”å¼å’Œå•å‘çš„Swiftåº”ç”¨ç¨‹åºæ¶æ„çš„æ¡†æ¶ã€‚è¿™ä¸ªæ–‡ç« ä»‹ç»äº†ReactorKitçš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶æè¿°äº†å¦‚ä½•ä½¿ç”¨ReactorKitæ„å»ºåº”ç”¨ç¨‹åºã€‚ å¦‚æœæ‚¨å¸Œæœ›çœ‹åˆ°å®é™…çš„ä»£ç ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é¦–å…ˆçœ‹åˆ°ç¤ºä¾‹éƒ¨åˆ†ã€‚è®¿é—®APIå‚è€ƒçš„ä»£ç çº§æ–‡æ¡£ã€‚ åŸºæœ¬æ¦‚å¿µReactorKitæ˜¯Fluxå’Œå“åº”å¼ç¼–ç¨‹çš„ç»“åˆã€‚user actionså’Œview statesé€šè¿‡å¯è§‚å¯Ÿçš„æµä¼ é€’åˆ°æ¯ä¸€å±‚ã€‚è¿™äº›æµæ˜¯å•å‘çš„: viewåªèƒ½å‘å°„actionsï¼Œreactoråªèƒ½å‘å°„statesã€‚ è®¾è®¡ç›®æ ‡ å¯æµ‹è¯•æ€§ï¼šReactorKitçš„ç¬¬ä¸€ä¸ªç›®çš„æ˜¯å°†ä¸šåŠ¡é€»è¾‘ä»è§†å›¾ä¸­åˆ†ç¦»å‡ºæ¥ã€‚è¿™å¯ä»¥ä½¿ä»£ç å¯æµ‹è¯•ã€‚ä¸€ä¸ªreactorå¯¹è§†å›¾æ²¡æœ‰ä»»ä½•ä¾èµ–æ€§ã€‚åªéœ€è¦æµ‹è¯•reactorså’Œæµ‹è¯•è§†å›¾ç»‘å®šã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æµ‹è¯•éƒ¨åˆ†ã€‚ ä»å°å¤„å¼€å§‹: ReactorKitå¹¶ä¸è¦æ±‚æ•´ä¸ªåº”ç”¨ç¨‹åºéµå¾ªå•ä¸€çš„æ¶æ„ã€‚å¯¹äºä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„è§†å›¾ï¼Œå¯ä»¥éƒ¨åˆ†åœ°é‡‡ç”¨ReactorKitã€‚ä½ ä¸éœ€è¦é‡å†™æ‰€æœ‰çš„ä¸œè¥¿æ¥åœ¨ä½ ç°æœ‰çš„é¡¹ç›®ä¸­ä½¿ç”¨ReactorKitã€‚ æ›´å°‘çš„æˆæœ¬: ReactorKitä¸“æ³¨äºé¿å…å¤æ‚çš„ä»£ç ä¸ºç®€å•çš„äº‹æƒ…ã€‚ä¸å…¶ä»–æ¶æ„ç›¸æ¯”ï¼ŒReactorKitçš„ä»£ç éœ€è¦æ›´å°‘çš„ä»£ç ã€‚å¼€å§‹ç®€å•ï¼Œæ‰©å¤§è§„æ¨¡ ViewViewæ˜¾ç¤ºæ•°æ®ã€‚view controllerå’Œcellè¢«è§†ä¸ºviewã€‚viewå°†ç”¨æˆ·è¾“å…¥ç»‘å®šåˆ°actionæµï¼Œå¹¶å°†view statesç»‘å®šåˆ°æ¯ä¸ªUIç»„ä»¶ã€‚viewå±‚ä¸­æ²¡æœ‰ä¸šåŠ¡é€»è¾‘ã€‚viewå®šä¹‰äº†å¦‚ä½•æ˜ å°„actionæµå’Œstateæµã€‚ è¦å®šä¹‰ä¸€ä¸ªviewï¼Œåªéœ€è®©ç°æœ‰çš„ç±»éµå¾ªä¸€ä¸ªåä¸ºViewçš„åè®®ã€‚ç„¶åï¼Œä½ çš„ç±»ä¼šè‡ªåŠ¨åœ°æœ‰ä¸€ä¸ªåä¸ºreactorçš„å±æ€§ã€‚è¿™ä¸ªå±æ€§é€šå¸¸æ˜¯åœ¨viewä¹‹å¤–è®¾ç½®çš„ã€‚ 12345class ProfileViewController: UIViewController, View &#123; var disposeBag = DisposeBag()&#125;profileViewController.reactor = UserViewReactor() // inject reactor å½“reactorå±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šè°ƒç”¨bind(reactor:)ã€‚å®ç°è¿™ä¸ªæ–¹æ³•æ¥å®šä¹‰actionæµå’Œstateæµçš„ç»‘å®šã€‚ 1234567891011func bind(reactor: ProfileViewReactor) &#123; // action (View -&gt; Reactor) refreshButton.rx.tap.map &#123; Reactor.Action.refresh &#125; .bind(to: reactor.action) .disposed(by: self.disposeBag) // state (Reactor -&gt; View) reactor.state.map &#123; $0.isFollowing &#125; .bind(to: followButton.rx.isSelected) .disposed(by: self.disposeBag)&#125; æ”¯æŒ Storyboardå¦‚æœä½¿ç”¨storyboardæ¥åˆå§‹åŒ–view controllersï¼Œä½¿ç”¨StoryboardViewåè®®ã€‚æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œåœ¨è§†å›¾åŠ è½½ä¹‹åï¼ŒStoryboardViewæ‰§è¡Œç»‘å®šã€‚ 12345678let viewController = MyViewController()viewController.reactor = MyViewReactor() // ä¸ä¼šç«‹å³æ‰§è¡Œ`bind(reactor:)`class MyViewController: UIViewController, StoryboardView &#123; func bind(reactor: MyViewReactor) &#123; // åœ¨è§†å›¾åŠ è½½å(viewDidLoad)è°ƒç”¨ &#125;&#125; ReactorReactoræ˜¯ä¸€ä¸ªç‹¬ç«‹äºUIçš„å±‚ï¼Œå®ƒè´Ÿè´£ç®¡ç†è§†å›¾çš„çŠ¶æ€ã€‚reactoræœ€é‡è¦çš„ä½œç”¨æ˜¯å°†æ§åˆ¶æµä»ä¸€ä¸ªè§†å›¾ä¸­åˆ†ç¦»å‡ºæ¥ã€‚æ¯ä¸ªè§†å›¾éƒ½æœ‰å¯¹åº”çš„reactorï¼Œå¹¶æŠŠæ‰€æœ‰çš„é€»è¾‘éƒ½å§”æ‰˜ç»™å®ƒçš„reactorã€‚reactorä¸ä¾èµ–äºè§†å›¾ï¼Œå› æ­¤å¯ä»¥å¾ˆå®¹æ˜“åœ°æµ‹è¯•å®ƒã€‚ ç¬¦åˆReactoråè®®æ¥å®šä¹‰ä¸€ä¸ªreactorã€‚è¯¥åè®®éœ€è¦å®šä¹‰ä¸‰ç§ç±»å‹: Actionã€Mutationå’ŒStateã€‚å®ƒè¿˜éœ€è¦ä¸€ä¸ªåä¸ºinitialStateçš„å±æ€§ã€‚ 12345678910111213141516171819class ProfileViewReactor: Reactor &#123; // represent user actions enum Action &#123; case refreshFollowingStatus(Int) case follow(Int) &#125; // represent state changes enum Mutation &#123; case setFollowing(Bool) &#125; // represents the current view state struct State &#123; var isFollowing: Bool = false &#125; let initialState: State = State()&#125; ä¸€ä¸ªActionä»£è¡¨ä¸€ä¸ªç”¨æˆ·äº¤äº’ï¼Œè€ŒStateä»£è¡¨ä¸€ä¸ªè§†å›¾çŠ¶æ€ã€‚Mutationæ˜¯Actionä¸Stateä¹‹é—´çš„_æ¡¥æ¢_ã€‚ä¸€ä¸ªreactorå°†actionæµè½¬æ¢æˆstateæµçš„ä¸¤ä¸ªæ­¥éª¤:mutate()å’Œreduce()ã€‚ mutate() mutate()æ¥æ”¶åˆ°ä¸€ä¸ªActionå¹¶äº§ç”Ÿä¸€ä¸ªObservable&lt;Mutation&gt;ã€‚ 1func mutate(action: Action) -&gt; Observable&lt;Mutation&gt; æ¯ä¸ªå‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¼‚æ­¥æ“ä½œæˆ–APIè°ƒç”¨ï¼Œéƒ½æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œçš„ã€‚ 123456789101112131415func mutate(action: Action) -&gt; Observable&lt;Mutation&gt; &#123; switch action &#123; case let .refreshFollowingStatus(userID): // receive an action return UserAPI.isFollowing(userID) // create an API stream .map &#123; (isFollowing: Bool) -&gt; Mutation in return Mutation.setFollowing(isFollowing) // convert to Mutation stream &#125; case let .follow(userID): return UserAPI.follow() .map &#123; _ -&gt; Mutation in return Mutation.setFollowing(true) &#125; &#125;&#125; reduce() reduce()ä»ä»¥å‰çš„Stateå’ŒMutationä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„Stateã€‚ 1func reduce(state: State, mutation: Mutation) -&gt; State è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚å®ƒåº”è¯¥ä»¥åŒæ­¥æ–¹å¼è¿”å›ä¸€ä¸ªæ–°Stateã€‚ä¸è¦åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ‰§è¡Œä»»ä½•å‰¯ä½œç”¨ã€‚ 12345678func reduce(state: State, mutation: Mutation) -&gt; State &#123; var state = state // create a copy of the old state switch mutation &#123; case let .setFollowing(isFollowing): state.isFollowing = isFollowing // manipulate the state, creating a new state return state // return the new state &#125;&#125; transform() transform()å˜æ¢æ¯ä¸ªæµã€‚æœ‰ä¸‰ä¸ªtransform()å‡½æ•°: 123func transform(action: Observable&lt;Action&gt;) -&gt; Observable&lt;Action&gt;func transform(mutation: Observable&lt;Mutation&gt;) -&gt; Observable&lt;Mutation&gt;func transform(state: Observable&lt;State&gt;) -&gt; Observable&lt;State&gt; å®ç°è¿™äº›æ–¹æ³•æ¥è½¬æ¢å’Œåˆå¹¶å…¶ä»–å¯è§‚å¯Ÿçš„æµã€‚ä¾‹å¦‚ï¼Œtransform(mutation:)æ˜¯å°†å…¨å±€äº‹ä»¶æµä¸mutationæµç›¸ç»“åˆçš„æœ€ä½³ä½ç½®ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§å…¨å±€çŠ¶æ€éƒ¨åˆ†ã€‚ è¿™äº›æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºè°ƒè¯•ç›®çš„: 123func transform(action: Observable&lt;Action&gt;) -&gt; Observable&lt;Action&gt; &#123; return action.debug(\"action\") // Use RxSwift's debug() operator&#125; é«˜çº§ServiceReactorKitæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±‚å‘½åä¸ºServiceã€‚serviceå±‚æ‰§è¡Œå®é™…çš„ä¸šåŠ¡é€»è¾‘ã€‚reactoræ˜¯è§†å›¾å’Œç®¡ç†äº‹ä»¶æµçš„æœåŠ¡ä¹‹é—´çš„ä¸­é—´å±‚ã€‚å½“ä¸€ä¸ªreactorä»è§†å›¾æ¥æ”¶åˆ°ç”¨æˆ·æ“ä½œæ—¶ï¼Œreactorå°†è°ƒç”¨serviceé€»è¾‘ã€‚è¯¥serviceå‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¹¶å°†å“åº”å‘é€å›reactorã€‚ç„¶åï¼Œreactoråˆ›å»ºä¸€ä¸ªå¸¦æœ‰æœåŠ¡å“åº”çš„mutationæµã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªæœåŠ¡çš„ä¾‹å­: 1234567891011121314protocol UserServiceType &#123; func user(id: Int) -&gt; Observable&lt;User&gt; func follow(id: Int) -&gt; Observable&lt;Void&gt;&#125;final class UserService: Service, UserServiceType &#123; func user(id: Int) -&gt; Observable&lt;User&gt; &#123; return foo() &#125; func follow(id: Int) -&gt; Observable&lt;Void&gt; &#123; return bar() &#125;&#125; å…¨å±€çŠ¶æ€ä¸åƒReduxï¼ŒReactorKitå¹¶æ²¡æœ‰å®šä¹‰ä¸€ä¸ªå…¨å±€åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•ä¸œè¥¿æ¥ç®¡ç†ä¸€ä¸ªå…¨å±€çŠ¶æ€ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªVariableï¼Œä¸€ä¸ªPublishSubjectï¼Œç”šè‡³ä¸€ä¸ªreactorã€‚ReactorKitä¸éœ€è¦æœ‰ä¸€ä¸ªå…¨å±€çŠ¶æ€ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨ReactorKitåœ¨ä¸€ä¸ªç‰¹å®šçš„ç‰¹æ€§ã€‚ åœ¨Action â†’ Mutation â†’ Stateæµä¸­æ²¡æœ‰å…¨å±€çŠ¶æ€ã€‚æ‚¨åº”è¯¥ä½¿ç”¨transform(mutation:)æ¥å°†å…¨å±€çŠ¶æ€è½¬æ¢ä¸ºä¸€ä¸ªmutationã€‚è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå…¨å±€Variableï¼Œè¯¥Variableå­˜å‚¨å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚å¦‚æœæ‚¨æƒ³å‘å‡ºMutation.setUser(User?)å½“currentUserè¢«æ›´æ”¹æ—¶ï¼Œæ‚¨å¯ä»¥å¦‚ä¸‹æ‰€åš: 12345var currentUser: Variable&lt;User&gt; // global statefunc transform(mutation: Observable&lt;Mutation&gt;) -&gt; Observable&lt;Mutation&gt; &#123; return Observable.merge(mutation, currentUser.map(Mutation.setUser))&#125; ç„¶åï¼Œæ¯å½“è§†å›¾å‘reactorå‘é€ä¸€ä¸ªactionï¼Œè€ŒcurrentUserè¢«æ”¹å˜æ—¶ï¼Œè¿™ä¸ªmutationå°±ä¼šè¢«é‡Šæ”¾å‡ºæ¥ã€‚ Viewäº¤æµåœ¨å¤šä¸ªè§†å›¾ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œæ‚¨å¿…é¡»ç†Ÿæ‚‰å›è°ƒé—­åŒ…æˆ–å§”æ‰˜æ¨¡å¼ã€‚ååº”å †å»ºè®®ä½ ä½¿ç”¨reactiveçš„æ‰©å±•ã€‚æœ€å¸¸è§çš„æ§åˆ¶å®ä¾‹æ˜¯UIButton.rx.tapã€‚å…³é”®çš„æ¦‚å¿µæ˜¯å°†æ‚¨çš„è‡ªå®šä¹‰è§†å›¾è§†ä¸ºUIButtonæˆ–UILabelã€‚ è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ˜¾ç¤ºæ¶ˆæ¯çš„ChatViewControllerã€‚ChatViewControlleræ‹¥æœ‰ä¸€ä¸ªMessageInputViewã€‚å½“ç”¨æˆ·åœ¨MessageInputViewä¸Šç‚¹å‡»å‘é€æŒ‰é’®æ—¶ï¼Œæ–‡æœ¬å°†è¢«å‘é€åˆ°ChatViewControllerï¼Œè€ŒChatViewControllerå°†ç»‘å®šåˆ°ååº”å™¨çš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹:MessageInputViewçš„Rxæ‰©å±•: 123456extension Reactive where Base: MessageInputView &#123; var sendButtonTap: ControlEvent&lt;String&gt; &#123; let source = base.sendButton.rx.tap.withLatestFrom(...) return ControlEvent(events: source) &#125;&#125; ä½ å¯ä»¥åœ¨ChatViewControllerä¸­ä½¿ç”¨é‚£ä¸ªæ‰©å±•ã€‚ä¾‹å¦‚: 123messageInputView.rx.sendButtonTap .map(Reactor.Action.send) .bind(to: reactor.action) æµ‹è¯•ReactorKitæœ‰ä¸€ä¸ªå†…ç½®çš„æµ‹è¯•åŠŸèƒ½ã€‚æ‚¨å°†èƒ½å¤Ÿè½»æ¾åœ°æµ‹è¯•ä¸€ä¸ªviewå’Œä¸€ä¸ªreactorï¼Œå¹¶ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤ã€‚ ä»€ä¹ˆæµ‹è¯•é¦–å…ˆï¼Œä½ å¿…é¡»å†³å®šè¦æµ‹è¯•ä»€ä¹ˆã€‚æœ‰ä¸¤ä»¶äº‹è¦æµ‹è¯•:ä¸€ä¸ªviewå’Œä¸€ä¸ªreactorã€‚ View Action:ä¸€ä¸ªé€‚å½“çš„actionè¢«å‘é€åˆ°ä¸€ä¸ªæŒ‡å®šç”¨æˆ·äº¤äº’çš„reactorä¸Šå—? State: viewå±æ€§æ˜¯å¦æ­£ç¡®åœ°æŒ‰stateè®¾ç½®å‘¢? Reactor State:ä¸€ä¸ªstateéšç€actionè€Œæ”¹å˜å—? Viewæµ‹è¯•ä¸€ä¸ªviewå¯ä»¥ç”¨ä¸€ä¸ªstub reactorè¿›è¡Œæµ‹è¯•ã€‚reactoræœ‰ä¸€ä¸ªstubå±æ€§ï¼Œå®ƒå¯ä»¥è®°å½•actionså¹¶å¼ºåˆ¶æ”¹å˜statesã€‚å¦‚æœå¯ç”¨äº†ä¸€ä¸ªreactorçš„stubï¼Œmutate() å’Œreduce()éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚ä¸€ä¸ªstubæœ‰è¿™äº›å±æ€§: 1234var isEnabled: Bool &#123; get set &#125;var state: Variable&lt;Reactor.State&gt; &#123; get &#125;var action: ActionSubject&lt;Reactor.Action&gt; &#123; get &#125;var actions: [Reactor.Action] &#123; get &#125; // recorded actions ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹æµ‹è¯•æ¡ˆä¾‹: 12345678910111213141516171819202122232425262728293031func testAction_refresh() &#123; // 1. prepare a stub reactor let reactor = MyReactor() reactor.stub.isEnabled = true // 2. prepare a view with a stub reactor let view = MyView() view.reactor = reactor // 3. send an user interaction programatically view.refreshControl.sendActions(for: .valueChanged) // 4. assert actions XCTAssertEqual(reactor.stub.actions.last, .refresh)&#125;func testState_isLoading() &#123; // 1. prepare a stub reactor let reactor = MyReactor() reactor.stub.isEnabled = true // 2. prepare a view with a stub reactor let view = MyView() view.reactor = reactor // 3. set a stub state reactor.stub.state.value = MyReactor.State(isLoading: true) // 4. assert view properties XCTAssertEqual(view.activityIndicator.isAnimating, true)&#125; Reactoræµ‹è¯•ä¸€ä¸ªreactorå¯ä»¥ç‹¬ç«‹æµ‹è¯•ã€‚ 1234567func testIsBookmarked() &#123; let reactor = MyReactor() reactor.action.onNext(.toggleBookmarked) XCTAssertEqual(reactor.currentState.isBookmarked, true) reactor.action.onNext(.toggleBookmarked) XCTAssertEqual(reactor.currentState.isBookmarked, false)&#125; æœ‰æ—¶ï¼Œä¸€ä¸ªstateä¼šè¢«å¤šä¸ªactionæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª.refreshçš„åŠ¨ä½œå°†ç¬¬state.isLoadingä¸ªè®¾ç½®ä¸ºtrueï¼Œå¹¶åœ¨åˆ·æ–°åè®¾ç½®ä¸ºfalseã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¾ˆéš¾ç”¨currentStateæµ‹è¯•state.isLoadingï¼Œæ‰€ä»¥æ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨RxTestæˆ–RxExpectã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨RxExpectçš„ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹: 1234567891011121314func testIsLoading() &#123; RxExpect(\"it should change isLoading\") &#123; test in let reactor = test.retain(MyReactor()) test.input(reactor.action, [ next(100, .refresh) // send .refresh at 100 scheduler time ]) test.assert(reactor.state.map &#123; $0.isLoading &#125;) .since(100) // values since 100 scheduler time .assert([ true, // just after .refresh false, // after refreshing ]) &#125;&#125; çº¦å®šReactorKitæä¾›äº†ä¸€äº›çº¦å®šæ¥ç¼–å†™å¹²å‡€ç®€æ´çš„ä»£ç ã€‚ æ‚¨å¿…é¡»åœ¨viewä¹‹å¤–åˆ›å»ºreactorï¼Œå¹¶å°†å…¶ä¼ é€’ç»™viewçš„reactorå±æ€§ã€‚ Good 12let view = MyView()view.reactor = MyViewReactor(provider: provider) Bad 12345class MyView: UIView, View &#123; init() &#123; self.reactor = MyViewReactor() &#125;&#125; ç¤ºä¾‹ Counter: æœ€ç®€å•å’Œæœ€åŸºæœ¬çš„ReactorKitä¾‹å­ GitHub Search:ä¸€ä¸ªæä¾›GitHubåº“æœç´¢çš„ç®€å•åº”ç”¨ç¨‹åº RxTodo: ä½¿ç”¨ReactorKitçš„iOSå¾…åŠäº‹é¡¹ Cleverbot: ä½¿ç”¨Cleverbotå’ŒReactorKitçš„iOSæ¶ˆæ¯åº”ç”¨ Drrrible: Dribbble iOSä½¿ç”¨ReactorKit(App Store)å¯¹ Passcode:iOS RxSwiftã€ReactorKitå’ŒIGListKitç¤ºä¾‹çš„Passcode","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"iOSç¬¬ä¸‰æ–¹åº“","slug":"iOS/iOSç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/iOS/iOSç¬¬ä¸‰æ–¹åº“/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"}]},{"title":"Android æ¶æ„ç»„ä»¶ - åˆ†é¡µåº“","slug":"architecture-paging","date":"2017-11-09T06:45:09.000Z","updated":"2020-07-25T02:57:18.192Z","comments":true,"path":"2017/11/09/architecture-paging/","link":"","permalink":"https://jigangduan.github.io/2017/11/09/architecture-paging/","excerpt":"åˆ†é¡µåº“ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ›´å®¹æ˜“åœ°æ ¹æ®éœ€è¦ä»æ•°æ®æºåŠ è½½ä¿¡æ¯ï¼Œè€Œä¸ä¼šä½¿è®¾å¤‡è¶…è½½ï¼Œæˆ–è€…ç­‰å¾…ä¸€ä¸ªå¤§çš„æ•°æ®åº“æŸ¥è¯¢ç­‰å¾…å¤ªé•¿çš„æ—¶é—´ã€‚","text":"åˆ†é¡µåº“ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ›´å®¹æ˜“åœ°æ ¹æ®éœ€è¦ä»æ•°æ®æºåŠ è½½ä¿¡æ¯ï¼Œè€Œä¸ä¼šä½¿è®¾å¤‡è¶…è½½ï¼Œæˆ–è€…ç­‰å¾…ä¸€ä¸ªå¤§çš„æ•°æ®åº“æŸ¥è¯¢ç­‰å¾…å¤ªé•¿çš„æ—¶é—´ã€‚ æ¦‚è¿°è®¸å¤šåº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨å¤§é‡çš„æ•°æ®ï¼Œä½†åªéœ€è¦åœ¨ä»»ä½•æ—¶å€™åŠ è½½å’Œæ˜¾ç¤ºä¸€å°éƒ¨åˆ†æ•°æ®ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½ä¼šæœ‰æ•°åƒä¸ªå¯èƒ½æ˜¾ç¤ºçš„é¡¹ç›®ï¼Œä½†å®ƒå¯èƒ½åªéœ€è¦ä¸€æ¬¡è®¿é—®å…¶ä¸­çš„å‡ åä¸ªã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸å°å¿ƒï¼Œå®ƒå¯èƒ½æœ€ç»ˆä¼šè¯·æ±‚å®ƒå®é™…ä¸Šä¸éœ€è¦çš„æ•°æ®ï¼Œä»è€Œç»™è®¾å¤‡å’Œç½‘ç»œå¸¦æ¥æ€§èƒ½è´Ÿæ‹…ã€‚å¦‚æœæ•°æ®è¢«å­˜å‚¨æˆ–ä¸è¿œç¨‹æ•°æ®åº“åŒæ­¥ï¼Œè¿™ä¹Ÿä¼šé™ä½åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ï¼Œå¹¶æµªè´¹ç”¨æˆ·çš„æ•°æ®è®¡åˆ’ã€‚ å°½ç®¡ç°æœ‰çš„Android apiå…è®¸åœ¨å†…å®¹ä¸­è¿›è¡Œåˆ†é¡µï¼Œä½†å®ƒä»¬å¸¦æ¥äº†å·¨å¤§çš„é™åˆ¶å’Œç¼ºç‚¹: CursorAdapterä½¿å°†æ•°æ®åº“æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°ListViewé¡¹å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œä½†æ˜¯å®ƒåœ¨UIçº¿ç¨‹ä¸Šè¿è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¹¶ä¸”åœ¨é¡µé¢å†…å®¹ä¸­ä½¿ç”¨Cursoræ•ˆç‡ä¸é«˜ã€‚æœ‰å…³ä½¿ç”¨CursorAdapterçš„ç¼ºç‚¹çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§è¯¥åšå®¢åœ¨Androidä¸Šå‘å¸ƒå¤§å‹æ•°æ®åº“æŸ¥è¯¢ã€‚ AsyncListUtilå…è®¸å°†åŸºäºä½ç½®çš„æ•°æ®è½¬æ¢ä¸ºRecyclerViewï¼Œä½†ä¸å…è®¸éä½ç½®åˆ†é¡µï¼Œå®ƒåœ¨å¯æ•°çš„æ•°æ®é›†ä¸­å¼ºåˆ¶nullä½œä¸ºå ä½ç¬¦ã€‚ æ–°çš„åˆ†é¡µåº“è§£å†³äº†è¿™äº›é—®é¢˜ã€‚è¿™ä¸ªåº“åŒ…å«å‡ ä¸ªç±»ï¼Œå¯ä»¥ç®€åŒ–è¯·æ±‚æ•°æ®çš„è¿‡ç¨‹ã€‚è¿™äº›ç±»è¿˜å¯ä»¥ä¸ç°æœ‰çš„ä½“ç³»ç»“æ„ç»„ä»¶æ— ç¼åä½œï¼Œæ¯”å¦‚Roomã€‚ ç±»åˆ†é¡µåº“æä¾›äº†ä»¥ä¸‹ç±»ï¼Œä»¥åŠé™„åŠ çš„æ”¯æŒç±»: DataSource ä½¿ç”¨è¿™ä¸ªç±»æ¥å®šä¹‰ä¸€ä¸ªæ•°æ®æºï¼Œæ‚¨éœ€è¦ä»å®ƒè·å–åˆ†é¡µæ•°æ®ã€‚æ ¹æ®æ‚¨éœ€è¦è®¿é—®æ•°æ®çš„æ–¹å¼ï¼Œæ‚¨å°†æ‰©å±•å®ƒçš„ä¸¤ä¸ªå­ç±»ä¸­çš„ä¸€ä¸ª: ä½¿ç”¨KeyedDataSourceï¼Œå¦‚æœæ‚¨éœ€è¦ä½¿ç”¨æ¥è‡ªitem Nçš„æ•°æ®æ¥è·å–item N+1ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä¸ºä¸€ä¸ªè®¨è®ºåº”ç”¨ç¨‹åºè·å–çº¿ç¨‹è¯„è®ºï¼Œæ‚¨å¯èƒ½éœ€è¦ä¼ é€’ä¸€ä¸ªè¯„è®ºçš„IDæ¥è·å–ä¸‹ä¸€ä¸ªè¯„è®ºçš„å†…å®¹ã€‚ ä½¿ç”¨TiledDataSourceï¼Œå¦‚æœæ‚¨éœ€è¦ä»æ‚¨åœ¨æ•°æ®å­˜å‚¨ä¸­é€‰æ‹©çš„ä»»ä½•ä½ç½®è·å–æ•°æ®é¡µã€‚è¿™ä¸ªç±»æ”¯æŒä»æ‚¨é€‰æ‹©çš„ä»»ä½•ä½ç½®å¼€å§‹è¯·æ±‚ä¸€ç»„æ•°æ®é¡¹ï¼Œæ¯”å¦‚â€œè¿”å›ä»ä½ç½®1200å¼€å§‹çš„20ä¸ªæ•°æ®é¡¹â€ã€‚ å¦‚æœæ‚¨ä½¿ç”¨RoomæŒä¹…æ€§åº“æ¥ç®¡ç†æ‚¨çš„æ•°æ®ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªTiledDataSourceï¼Œä¾‹å¦‚: 12@Query(\"select * from users WHERE age &gt; :age order by name DESC, id ASC\")TiledDataSource&lt;User&gt; usersOlderThan(int age); PagedList è¿™ä¸ªç±»ä»ä¸€ä¸ªæ•°æ®æºåŠ è½½æ•°æ®ã€‚æ‚¨å¯ä»¥é…ç½®ä¸€æ¬¡åŠ è½½äº†å¤šå°‘æ•°æ®ï¼Œä»¥åŠåº”è¯¥é¢„å…ˆè·å–å¤šå°‘æ•°æ®ï¼Œä»è€Œæœ€å°åŒ–äº†ç”¨æˆ·ç­‰å¾…æ•°æ®åŠ è½½çš„æ—¶é—´ã€‚è¿™ä¸ªç±»å¯ä»¥å‘å…¶ä»–ç±»æä¾›æ›´æ–°ä¿¡å·ï¼Œæ¯”å¦‚RecyclerView.Adapterï¼Œå…è®¸æ‚¨åœ¨æ•°æ®åŠ è½½åˆ°é¡µé¢æ—¶æ›´æ–°RecyclerViewçš„å†…å®¹ã€‚ PagedListAdapter è¿™ä¸ªç±»æ˜¯RecyclerView.Adapterçš„å®ç°ï¼Œå®ƒæ˜¾ç¤ºäº†PagedListçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“åŠ è½½ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼ŒPagedListAdapterè¡¨ç¤ºæ•°æ®å·²ç»åˆ°è¾¾çš„RecyclerView;è¿™æ ·ï¼ŒRecyclerViewå°±å¯ä»¥ç”¨å®é™…çš„æ¡ç›®æ›¿æ¢ä»»ä½•å ä½ç¬¦ï¼Œæ‰§è¡Œé€‚å½“çš„åŠ¨ç”»ã€‚ PagedListAdapterè¿˜ä½¿ç”¨ä¸€ä¸ªåå°çº¿ç¨‹æ¥è®¡ç®—PagedListä¸‹ä¸€æ¬¡çš„æ›´æ”¹(ä¾‹å¦‚ï¼Œå½“æ•°æ®åº“æ›´æ”¹ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰æ›´æ–°æ•°æ®çš„æ–°PagedListæ—¶)ï¼Œå¹¶æ ¹æ®éœ€è¦è°ƒç”¨notifyItemâ€¦()) æ–¹æ³•æ¥æ›´æ–°åˆ—è¡¨çš„å†…å®¹ã€‚ç„¶åï¼ŒRecyclerViewæ‰§è¡Œå¿…è¦çš„æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®æ”¹å˜äº†PagedListç‰ˆæœ¬ä¹‹é—´çš„ä½ç½®ï¼Œé‚£ä¹ˆRecyclerViewå°†ä½¿è¯¥é¡¹ç›®ç§»åŠ¨åˆ°åˆ—è¡¨ä¸­çš„æ–°ä½ç½®ã€‚ LivePagedListProvider è¿™ä¸ªç±»ä»æ‚¨æä¾›çš„DataSourceç”ŸæˆLiveData&lt;PagedList&gt;ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä½¿ç”¨RoomæŒä¹…æ€§åº“æ¥ç®¡ç†æ•°æ®åº“ï¼Œé‚£ä¹ˆDAOå¯ä»¥ä½¿ç”¨TiledDataSourceä¸ºæ‚¨ç”ŸæˆLivePagedListProviderï¼Œä¾‹å¦‚: 12@Query(\"SELECT * from users order WHERE age &gt; :age order by name DESC, id ASC\")public abstract LivePagedListProvider&lt;Integer, User&gt; usersOlderThan(int age); æ•´æ•°å‚æ•°å‘Šè¯‰Roomä½¿ç”¨TiledDataSourceï¼Œä»¥åŸºäºä½ç½®çš„è´Ÿè½½ä¸ºåŸºç¡€ã€‚ ç´§æŒ¨ç€ï¼Œåˆ†é¡µåº“çš„ç»„ä»¶ç»„ç»‡äº†æ¥è‡ªåå°çº¿ç¨‹çš„æ•°æ®æµï¼Œä»¥åŠUIçº¿ç¨‹çš„è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå½“åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€ä¸ªæ–°é¡¹æ—¶ï¼Œæ•°æ®æºå°±ä¼šå¤±æ•ˆï¼Œè€ŒLivePagedListProviderä¼šåœ¨åå°çº¿ç¨‹ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„PagedListã€‚ å›¾1æ‰€ç¤º åˆ†é¡µåº“ç»„ä»¶åœ¨åå°çº¿ç¨‹ä¸­å®Œæˆäº†å¤§éƒ¨åˆ†å·¥ä½œï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šè´Ÿæ‹…UIçº¿ç¨‹ è¿™ä¸ªæ–°åˆ›å»ºçš„PagedListè¢«å‘é€åˆ°UIçº¿ç¨‹ä¸Šçš„PagedListAdapterã€‚ç„¶åï¼ŒPagedListAdapterä¼šåœ¨åå°çº¿ç¨‹ä¸Šä½¿ç”¨DiffUtilæ¥è®¡ç®—å½“å‰åˆ—è¡¨å’Œæ–°åˆ—è¡¨ä¹‹é—´çš„å·®å¼‚ã€‚å½“å®Œæˆæ¯”è¾ƒ,PagedListAdapterä½¿ç”¨å·®å¼‚åˆ—è¡¨ä¿¡æ¯åšå‡ºé€‚å½“çš„è°ƒç”¨RecyclerView.Adapter.notifyItemInserted())ä¿¡å·,æ’å…¥ä¸€ä¸ªæ–°é¡¹ã€‚ åœ¨UIçº¿ç¨‹ä¸Šçš„RecyclerViewçŸ¥é“å®ƒåªéœ€è¦ç»‘å®šä¸€ä¸ªæ–°æ¡ç›®ï¼Œå¹¶å°†å®ƒæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ˜¾ç¤ºäº†æ‰€æœ‰çš„ç‰‡æ®µä¸€èµ·å·¥ä½œã€‚å½“ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹æ—¶ï¼ŒRecyclerViewçš„å†…å®¹ä¼šè‡ªåŠ¨ä¸”æœ‰æ•ˆåœ°æ›´æ–°: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859@Daointerface UserDao &#123; @Query(\"SELECT * FROM user ORDER BY lastName ASC\") public abstract LivePagedListProvider&lt;Integer, User&gt; usersByLastName();&#125;class MyViewModel extends ViewModel &#123; public final LiveData&lt;PagedList&lt;User&gt;&gt; usersList; public MyViewModel(UserDao userDao) &#123; usersList = userDao.usersByLastName().create( /* initial load position */ 0, new PagedList.Config.Builder() .setPageSize(50) .setPrefetchDistance(50) .build()); &#125;&#125;class MyActivity extends AppCompatActivity &#123; @Override public void onCreate(Bundle savedState) &#123; super.onCreate(savedState); MyViewModel viewModel = ViewModelProviders.of(this).get(MyViewModel.class); RecyclerView recyclerView = findViewById(R.id.user_list); UserAdapter&lt;User&gt; adapter = new UserAdapter(); viewModel.usersList.observe(this, pagedList -&gt; adapter.setList(pagedList)); recyclerView.setAdapter(adapter); &#125;&#125;class UserAdapter extends PagedListAdapter&lt;User, UserViewHolder&gt; &#123; public UserAdapter() &#123; super(DIFF_CALLBACK); &#125; @Override public void onBindViewHolder(UserViewHolder holder, int position) &#123; User user = getItem(position); if (user != null) &#123; holder.bindTo(user); &#125; else &#123; // Null defines a placeholder item - PagedListAdapter will automatically invalidate // this row when the actual object is loaded from the database holder.clear(); &#125; &#125; public static final DiffCallback&lt;User&gt; DIFF_CALLBACK = new DiffCallback&lt;User&gt;() &#123; @Override public boolean areItemsTheSame(@NonNull User oldUser, @NonNull User newUser) &#123; // User properties may have changed if reloaded from the DB, but ID is fixed return oldUser.getId() == newUser.getId(); &#125; @Override public boolean areContentsTheSame(@NonNull User oldUser, @NonNull User newUser) &#123; // NOTE: if you use equals, your object must properly override Object#equals() // Incorrectly returning false here will result in too many animations. return oldUser.equals(newUser); &#125; &#125;&#125;","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶ - RoomæŒä¹…æ€§åº“","slug":"architecture-room","date":"2017-11-09T06:03:04.000Z","updated":"2020-07-25T02:57:18.193Z","comments":true,"path":"2017/11/09/architecture-room/","link":"","permalink":"https://jigangduan.github.io/2017/11/09/architecture-room/","excerpt":"","text":"RoomæŒä¹…æ€§åº“ä¸ºSQLiteæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä»¥ä¾¿åœ¨å……åˆ†åˆ©ç”¨SQLiteçš„åŒæ—¶ï¼Œå…è®¸æµç•…çš„æ•°æ®åº“è®¿é—®ã€‚ è¯¥åº“å¸®åŠ©ç”¨æˆ·åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„è®¾å¤‡ä¸Šåˆ›å»ºåº”ç”¨ç¨‹åºçš„æ•°æ®ç¼“å­˜ï¼Œè¯¥ç¼“å­˜ä½œä¸ºåº”ç”¨ç¨‹åºçš„å•ä¸€æ¥æºï¼Œå…è®¸ç”¨æˆ·åœ¨åº”ç”¨å†…æŸ¥çœ‹å…³é”®ä¿¡æ¯çš„ä¸€è‡´å‰¯æœ¬ï¼Œè€Œä¸ç®¡ç”¨æˆ·æ˜¯å¦æœ‰äº’è”ç½‘è¿æ¥ã€‚ è¦å°†Roomå¯¼å…¥åˆ°æ‚¨çš„Androidé¡¹ç›®ä¸­ï¼Œè¯·å‚è§å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ç»„ä»¶ã€‚ è¦æƒ³åœ¨åº”ç”¨ç¨‹åºçš„æ•°æ®å­˜å‚¨æŒä¹…æ€§è§£å†³æ–¹æ¡ˆä¸­åº”ç”¨Roomçš„åŠŸèƒ½ï¼Œè¯·å‚é˜…RoomåŸ¹è®­æŒ‡å—ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶ - ä¿å­˜ç•Œé¢çŠ¶æ€","slug":"architecture-saving-states","date":"2017-11-09T05:12:41.000Z","updated":"2020-07-25T02:57:18.193Z","comments":true,"path":"2017/11/09/architecture-saving-states/","link":"","permalink":"https://jigangduan.github.io/2017/11/09/architecture-saving-states/","excerpt":"æ‚¨æ‰€åšçš„æˆ–è€…ä¸åšçš„ï¼Œä¿æŒUIçŠ¶æ€æ˜¯ç”¨æˆ·ä½“éªŒçš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†ã€‚æ— è®ºç”¨æˆ·æ˜¯æ—‹è½¬è®¾å¤‡ï¼Œç”¨æˆ·é‡æ–°å¯åŠ¨åº”ç”¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿå…³é—­åº”ç”¨ï¼Œé‡è¦çš„æ˜¯ä½ çš„activityä¿æŒäº†ç”¨æˆ·æ‰€æœŸæœ›çš„çŠ¶æ€ å¦‚æœè¦ä¿å­˜çš„UIæ•°æ®æ˜¯ç®€å•è€Œè½»é‡çº§çš„ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å•ç‹¬ä½¿ç”¨onSaveInstanceState()æ¥ä¿å­˜æ‚¨çš„çŠ¶æ€æ•°æ®ã€‚ å¦‚æœè¦ä¿å­˜çš„æ˜¯å¤æ‚æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ViewModelå¯¹è±¡ã€onSaveInstanceState()æ–¹æ³•å’ŒæŒä¹…åŒ–æœ¬åœ°å­˜å‚¨çš„ç»„åˆã€‚ æœ¬é¡µè®¨è®ºäº†è¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸€ä¸ªã€‚","text":"æ‚¨æ‰€åšçš„æˆ–è€…ä¸åšçš„ï¼Œä¿æŒUIçŠ¶æ€æ˜¯ç”¨æˆ·ä½“éªŒçš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†ã€‚æ— è®ºç”¨æˆ·æ˜¯æ—‹è½¬è®¾å¤‡ï¼Œç”¨æˆ·é‡æ–°å¯åŠ¨åº”ç”¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿå…³é—­åº”ç”¨ï¼Œé‡è¦çš„æ˜¯ä½ çš„activityä¿æŒäº†ç”¨æˆ·æ‰€æœŸæœ›çš„çŠ¶æ€ å¦‚æœè¦ä¿å­˜çš„UIæ•°æ®æ˜¯ç®€å•è€Œè½»é‡çº§çš„ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å•ç‹¬ä½¿ç”¨onSaveInstanceState()æ¥ä¿å­˜æ‚¨çš„çŠ¶æ€æ•°æ®ã€‚ å¦‚æœè¦ä¿å­˜çš„æ˜¯å¤æ‚æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ViewModelå¯¹è±¡ã€onSaveInstanceState()æ–¹æ³•å’ŒæŒä¹…åŒ–æœ¬åœ°å­˜å‚¨çš„ç»„åˆã€‚ æœ¬é¡µè®¨è®ºäº†è¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸€ä¸ªã€‚ ç®¡ç†ç®€å•çš„æƒ…å†µ: onSaveInstanceState()onSaveInstanceState())å›è°ƒè¢«è®¾è®¡ç”¨æ¥å­˜å‚¨ç›¸å¯¹å°‘é‡çš„æ•°æ®ï¼Œä»¥ä¾¿è½»æ¾åœ°é‡æ–°åŠ è½½UIæ§åˆ¶å™¨çš„çŠ¶æ€ï¼Œå¦‚activityæˆ–fragmentï¼Œå¦‚æœç³»ç»Ÿåœæ­¢å¹¶ç¨åé‡æ–°åˆ›å»ºè¯¥æ§åˆ¶å™¨ã€‚è¿™ä¸ªå›è°ƒæ˜¯ä¸ºäº†å¤„ç†ä¸¤ç§æƒ…å†µ: ç”±äºå†…å­˜é™åˆ¶ï¼Œè¯¥åº”ç”¨ç¨‹åºåœ¨åå°è¿è¡Œæ—¶ä¼šæ€æ­»åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ã€‚ å‘ç”Ÿé…ç½®æ›´æ”¹ï¼Œä¾‹å¦‚å±å¹•æ—‹è½¬æˆ–æ›´æ”¹ä¸ºè¾“å…¥è¯­è¨€ã€‚ ç”±äºè¿™ä¸¤ç§æƒ…å†µéƒ½æš—ç¤ºï¼Œåœ¨ç³»ç»Ÿä¸­activityåœæ­¢ï¼Œä½†æœªå®Œæˆçš„æƒ…å†µä¸‹ï¼ŒonSaveInstanceState()å°†è¢«è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·ç¦»å¼€åº”ç”¨ç¨‹åºå‡ ä¸ªå°æ—¶ï¼Œç³»ç»Ÿä¼šä»å†…å­˜ä¸­å¼¹å‡ºç›¸å…³çš„è¿›ç¨‹ï¼Œç³»ç»Ÿä¼šè°ƒç”¨onSaveInstanceState()çš„é»˜è®¤å®ç°æ¥ä¿å­˜å…·æœ‰IDçš„æ¯ä¸ªUIæ§åˆ¶å™¨ã€‚ç¨åï¼Œå½“ç”¨æˆ·è¿”å›åˆ°åº”ç”¨ç¨‹åºæ—¶ï¼Œç³»ç»Ÿå°†ç”¨ä¿å­˜çš„çŠ¶æ€æ¢å¤activityã€‚ æ³¨æ„:onSaveInstanceState()åœ¨ç”¨æˆ·æ˜¾å¼å…³é—­è¯¥æ´»åŠ¨æ—¶ï¼Œæˆ–è€…åœ¨è°ƒç”¨finish()æ—¶ï¼Œä¸ä¼šè°ƒç”¨onSaveInstanceState()ã€‚ ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜å¹¶ä¸ºæ‚¨æ¢å¤å¤§é‡çš„UIæ•°æ®:onSaveInstanceState()çš„é»˜è®¤å®ç°ä¿å­˜äº†activityçš„è§†å›¾å±‚æ¬¡ç»“æ„çš„ä¿¡æ¯ï¼Œæ¯”å¦‚EditTextå°éƒ¨ä»¶ä¸­çš„æ–‡æœ¬æˆ–ListViewå°éƒ¨ä»¶çš„æ»šåŠ¨ä½ç½®ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡é‡å†™onSaveInstanceState()å›è°ƒæ¥å°†è‡ªå®šä¹‰æ•°æ®ä¿å­˜åˆ°è¿™ä¸ªåŒ…ä¸­ã€‚å¦‚æœæ‚¨é‡å†™è¯¥æ–¹æ³•ï¼Œä»¥ä¿å­˜æ¯ä¸ªå•ç‹¬å®ä½“æœªæ•è·çš„é™„åŠ ä¿¡æ¯ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥è°ƒç”¨ç¼ºçœå®ç°ï¼Œé™¤éæ‚¨å‡†å¤‡å¥½ä¿å­˜æ¯ä¸ªå®ä½“çš„çŠ¶æ€ã€‚ onSaveInstanceState()ä¸æ˜¯ç”¨æ¥å­˜å‚¨å¤§é‡æ•°æ®çš„ï¼Œæ¯”å¦‚ä½å›¾ï¼Œæˆ–è€…å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„éœ€è¦é•¿æ—¶é—´çš„åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ã€‚å¦‚æœåºåˆ—åŒ–çš„å¯¹è±¡æ˜¯å¤æ‚çš„ï¼Œä¸²è¡ŒåŒ–å¯ä»¥æ¶ˆè€—å¤§é‡çš„å†…å­˜ã€‚ç”±äºè¿™ä¸ªè¿‡ç¨‹åœ¨é…ç½®æ›´æ”¹æœŸé—´å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œå› æ­¤åºåˆ—åŒ–å¯èƒ½ä¼šå¯¼è‡´åˆ é™¤å¸§å’Œè§†è§‰å£åƒï¼Œå¦‚æœæ—¶é—´è¿‡é•¿çš„è¯ã€‚å› æ­¤ï¼Œä¸è¦åœ¨å¤æ‚çš„æ•°æ®ç»“æ„ä¸­ä½¿ç”¨onSaveInstanceState()ï¼Œè€Œæ˜¯è¦ç¡®ä¿å°†è¿™äº›ç»“æ„å­˜å‚¨åœ¨æœ¬åœ°æŒä¹…å­˜å‚¨ä¸­;åœ¨åˆ›å»ºæ•°æ®çš„æ—¶å€™å­˜å‚¨æ•°æ®æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·å¯ä»¥æœ€å°åŒ–ä¸¢å¤±æ•°æ®çš„æœºä¼šã€‚ç„¶åï¼Œä½¿ç”¨onSaveInstanceState()ä¸ºæ¯ä¸ªå¯¹è±¡å­˜å‚¨å”¯ä¸€çš„idã€‚ æœ¬æ–‡æ¡£çš„ä¸‹ä¸€éƒ¨åˆ†æä¾›äº†å…³äºä¿å­˜æ›´å¤æ‚æ•°æ®çš„æ›´å¤šç»†èŠ‚ã€‚ ç®¡ç†æ›´å¤æ‚çš„çŠ¶æ€:åˆ†è€Œæ²»ä¹‹å½“ä¸€ä¸ªactivityç»“æŸæ—¶éœ€è¦ä¿å­˜æ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é€šè¿‡å°†å·¥ä½œåˆ’åˆ†ä¸ºå‡ ç§ç±»å‹çš„å­˜å‚¨æœºåˆ¶ï¼Œä»è€Œæœ‰æ•ˆåœ°ä¿å­˜å’Œæ¢å¤UIçŠ¶æ€ã€‚ æœ‰ä¸¤ç§ä¸€èˆ¬çš„æ–¹æ³•å¯ä»¥è®©ç”¨æˆ·ç¦»å¼€activityï¼Œå¯¼è‡´ç”¨æˆ·å¯èƒ½æœŸæœ›çš„ä¸¤ç§ä¸åŒç»“æœ: ç”¨æˆ·å®Œå…¨å…³é—­è¯¥activityã€‚ç”¨æˆ·å¯ä»¥å®Œå…¨å…³é—­è¯¥activityï¼Œå¦‚æœä»–ä»¬å°†activityä»å±å¹•ä¸Šåˆ’æ‰ï¼Œå¯¼èˆªå‡ºå»ï¼Œæˆ–è€…é€€å‡ºactivityã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå‡è®¾ç”¨æˆ·å·²ç»æ°¸ä¹…åœ°ç¦»å¼€äº†activityï¼Œå¹¶ä¸”å¦‚æœä»–ä»¬é‡æ–°æ‰“å¼€äº†activityï¼Œä»–ä»¬å°†æœŸæœ›ä»ä¸€ä¸ªå¹²å‡€çš„çŠ¶æ€å¼€å§‹ã€‚ ç”¨æˆ·å¯ä»¥æ—‹è½¬æ‰‹æœºï¼Œæˆ–è€…æŠŠactivityæ”¾åœ¨åå°ï¼Œç„¶åå†å›åˆ°å®ƒä¸Šé¢ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ‰§è¡Œæœç´¢ï¼Œç„¶åæŒ‰ä¸‹homeé”®æˆ–æ¥å¬ä¸€ä¸ªç”µè¯ã€‚å½“ä»–ä»¬è¿”å›åˆ°æœç´¢activityæ—¶ï¼Œä»–ä»¬æœŸæœ›æ‰¾åˆ°æœç´¢å…³é”®å­—å’Œç»“æœï¼Œå°±åƒä»¥å‰ä¸€æ ·ã€‚ è¦åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹å®ç°å¤æ‚æ•°æ®ç»“æ„çš„è¡Œä¸ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ¬åœ°æŒä¹…æ€§ã€ViewModelç±»å’ŒonSaveInstanceState()æ–¹æ³•ã€‚æ¯ç§æ–¹æ³•éƒ½å­˜å‚¨äº†activityä¸­ä½¿ç”¨çš„ä¸åŒç±»å‹çš„æ•°æ®ã€‚ æœ¬åœ°æŒä¹…æ€§:å¦‚æœæ‚¨æ‰“å¼€å¹¶å…³é—­è¯¥activityï¼Œåˆ™å­˜å‚¨æ‰€æœ‰æ‚¨ä¸æƒ³ä¸¢å¤±çš„æ•°æ®ã€‚ ç¤ºä¾‹:ä¸€ä¸ªåŒ…å«éŸ³é¢‘æ–‡ä»¶å’Œå…ƒæ•°æ®çš„æ­Œæ›²å¯¹è±¡é›†åˆã€‚ ViewModel:å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä»¥æ˜¾ç¤ºç›¸å…³çš„UIæ§åˆ¶å™¨ã€‚ ç¤ºä¾‹:æœ€è¿‘æœç´¢çš„æ­Œæ›²å¯¹è±¡å’Œæœ€è¿‘çš„æœç´¢æŸ¥è¯¢ã€‚ onSaveInstanceState():å¦‚æœç³»ç»Ÿåœæ­¢ï¼Œç„¶åé‡æ–°åˆ›å»ºUIæ§åˆ¶å™¨ï¼Œå°±éœ€è¦å­˜å‚¨å°‘é‡çš„æ•°æ®ï¼Œä»¥ä¾¿è½»æ¾åœ°é‡æ–°åŠ è½½æ´»åŠ¨çŠ¶æ€ã€‚è¿™é‡Œä¸å†å­˜å‚¨å¤æ‚çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†å¤æ‚çš„å¯¹è±¡æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨onSaveInstanceState()ä¸­ä¸ºè¿™äº›å¯¹è±¡å­˜å‚¨ä¸€ä¸ªæƒŸä¸€çš„IDã€‚ ç¤ºä¾‹:å­˜å‚¨æœ€è¿‘çš„æœç´¢æŸ¥è¯¢ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸ªå…è®¸ä½ æœç´¢ä½ çš„æ­Œæ›²åº“çš„activityã€‚ä¸‹é¢æ˜¯å¦‚ä½•å¤„ç†ä¸åŒçš„äº‹ä»¶ï¼š å½“ç”¨æˆ·æ·»åŠ ä¸€é¦–æ­Œæ—¶ï¼ŒViewModelä¼šç«‹å³ä»£è¡¨æœ¬åœ°ä¿å­˜è¿™äº›æ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ–°æ·»åŠ çš„æ­Œæ›²æ˜¯åº”è¯¥åœ¨UIä¸­æ˜¾ç¤ºçš„ï¼Œé‚£ä¹ˆæ‚¨è¿˜åº”è¯¥æ›´æ–°ViewModelå¯¹è±¡ä¸­çš„æ•°æ®ï¼Œä»¥åæ˜ è¿™é¦–æ­Œçš„æ·»åŠ ã€‚è®°ä½è¦ä»ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œæ‰€æœ‰çš„æ•°æ®åº“æ’å…¥æ“ä½œã€‚ å½“ç”¨æˆ·æœç´¢æ­Œæ›²æ—¶ï¼Œæ— è®ºä»æ•°æ®åº“ä¸­åŠ è½½çš„ç”¨äºUIæ§åˆ¶å™¨çš„å¤æ‚æ­Œæ›²æ•°æ®éƒ½åº”è¯¥ç«‹å³å­˜å‚¨åœ¨ViewModelå¯¹è±¡ä¸­ã€‚æ‚¨è¿˜åº”è¯¥åœ¨ViewModelå¯¹è±¡ä¸­ä¿å­˜æœç´¢æŸ¥è¯¢æœ¬èº«ã€‚ å½“activityè¿›å…¥åå°æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨onSaveInstanceState()ã€‚æ‚¨åº”è¯¥åœ¨onSaveInstanceState()åŒ…ä¸­ä¿å­˜æœç´¢æŸ¥è¯¢ã€‚è¿™å°‘é‡çš„æ•°æ®å¾ˆå®¹æ˜“ä¿å­˜ã€‚å®ƒä¹Ÿæ˜¯å°†activityæ¢å¤åˆ°å½“å‰çŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ æ¢å¤å¤æ‚çŠ¶æ€: é‡ç»„éƒ¨ä»¶å½“ç”¨æˆ·è¿”å›activityçš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§å¯èƒ½çš„åœºæ™¯æ¥é‡å»ºactivity: è¯¥activityåœ¨è¢«ç³»ç»Ÿåœæ­¢ä¹‹åé‡æ–°åˆ›å»ºã€‚è¯¥activityåœ¨onSaveInstanceState()åŒ…ä¸­ä¿å­˜äº†æŸ¥è¯¢ï¼Œå¹¶ä¸”åº”è¯¥å°†æŸ¥è¯¢ä¼ é€’ç»™ViewModelã€‚ViewModelçœ‹åˆ°å®ƒæ²¡æœ‰ç¼“å­˜çš„æœç´¢ç»“æœï¼Œå¹¶ä¸”ä½¿ç”¨ç»™å®šçš„æœç´¢æŸ¥è¯¢æ¥è£…è½½æœç´¢ç»“æœã€‚ è¯¥activityæ˜¯åœ¨é…ç½®æ›´æ”¹ä¹‹ååˆ›å»ºçš„ã€‚è¯¥activityåœ¨onSaveInstanceState()åŒ…ä¸­ä¿å­˜äº†æŸ¥è¯¢ï¼Œå¹¶ä¸”ViewModelå·²ç»ç¼“å­˜äº†æœç´¢ç»“æœã€‚æ‚¨å°†æŸ¥è¯¢ä»onSaveInstanceState()bundleä¼ é€’åˆ°ViewModelï¼Œè¿™å°±å†³å®šäº†å®ƒå·²ç»åŠ è½½äº†å¿…è¦çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸éœ€è¦é‡æ–°æŸ¥è¯¢æ•°æ®åº“ âš ï¸:å½“ä¸€ä¸ªactivityæœ€åˆåˆ›å»ºæ—¶ï¼ŒonSaveInstanceState() bundleä¸åŒ…å«æ•°æ®ï¼ŒViewModelå¯¹è±¡æ˜¯ç©ºçš„ã€‚å½“æ‚¨åˆ›å»ºViewModelå¯¹è±¡æ—¶ï¼Œæ‚¨å°†ä¼ é€’ä¸€ä¸ªç©ºæŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å°†å‘Šè¯‰ViewModelå¯¹è±¡ï¼Œç›®å‰è¿˜æ²¡æœ‰æ•°æ®å¯åŠ è½½ã€‚å› æ­¤ï¼Œactivityä»ä¸€ä¸ªç©ºçš„çŠ¶æ€å¼€å§‹ã€‚ æ ¹æ®æ‚¨çš„activityå®ç°ï¼Œæ‚¨å¯èƒ½ä¸éœ€è¦ä½¿ç”¨onSaveInstanceState()ã€‚ä¾‹å¦‚ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šå°†ç”¨æˆ·è¿”å›åˆ°ä»–ä»¬åœ¨æµè§ˆå™¨é€€å‡ºä¹‹å‰æ‰€çœ‹åˆ°çš„ç²¾ç¡®çš„ç½‘é¡µã€‚å¦‚æœæ‚¨çš„activityä»¥è¿™ç§æ–¹å¼è¿è¡Œï¼Œæ‚¨å¯ä»¥æ”¾å¼ƒä½¿ç”¨onSaveInstanceState()ï¼Œè€Œæ˜¯åœ¨æœ¬åœ°ä¿å­˜æ‰€æœ‰å†…å®¹ã€‚åœ¨æœç´¢ç¤ºä¾‹ä¸­ï¼Œè¿™å¯èƒ½æ„å‘³ç€åœ¨å…±äº«é¦–é€‰é¡¹ä¸­æŒä¹…åŒ–æœ€è¿‘çš„æŸ¥è¯¢ã€‚ æ­¤å¤–ï¼Œå½“æ‚¨ä»ä¸€ä¸ªintentæ‰“å¼€ä¸€ä¸ªactivityæ—¶ï¼Œå½“é…ç½®æ›´æ”¹å’Œç³»ç»Ÿæ¢å¤activityæ—¶ï¼Œé™„åŠ çš„é™„åŠ éƒ¨åˆ†å°†è¢«äº¤ä»˜åˆ°activityä¸­ã€‚å¦‚æœå°†æœç´¢æŸ¥è¯¢ä½œä¸ºä¸€ä¸ªintent extraä¼ é€’ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨extras bundleè€Œä¸æ˜¯onSaveInstanceState() bundleã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæ‚¨ä»ç„¶ä¼šä½¿ç”¨ViewModelæ¥é¿å…åœ¨é…ç½®æ›´æ”¹æœŸé—´ä»æ•°æ®åº“ä¸­é‡æ–°åŠ è½½æ•°æ®çš„å¾ªç¯ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶ - ViewModel","slug":"architecture-viewmodel","date":"2017-11-09T03:26:10.000Z","updated":"2020-07-25T02:57:18.193Z","comments":true,"path":"2017/11/09/architecture-viewmodel/","link":"","permalink":"https://jigangduan.github.io/2017/11/09/architecture-viewmodel/","excerpt":"ViewModelç±»æ—¨åœ¨ä»¥ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼å­˜å‚¨å’Œç®¡ç†ä¸uiç›¸å…³çš„æ•°æ®ã€‚ViewModelç±»å…è®¸æ•°æ®åœ¨è¯¸å¦‚å±å¹•æ—‹è½¬ä¹‹ç±»çš„é…ç½®æ›´æ”¹ä¸­å­˜æ´»ã€‚ æ³¨æ„:è¦å°†ViewModelå¯¼å…¥åˆ°æ‚¨çš„Androidé¡¹ç›®ä¸­ï¼Œè¯·å‚è§å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ç»„ä»¶ã€‚ Androidæ¡†æ¶ç®¡ç†UIæ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚activitieså’Œfragmentsã€‚è¯¥æ¡†æ¶å¯èƒ½ä¼šå†³å®šé”€æ¯æˆ–é‡æ–°åˆ›å»ºUIæ§åˆ¶å™¨ï¼Œä»¥å“åº”å®Œå…¨è¶…å‡ºæ‚¨æ§åˆ¶çš„æŸäº›ç”¨æˆ·æ“ä½œæˆ–è®¾å¤‡äº‹ä»¶ã€‚ å¦‚æœç³»ç»Ÿç ´åæˆ–é‡æ–°åˆ›å»ºä¸€ä¸ªUIæ§åˆ¶å™¨ï¼Œé‚£ä¹ˆå­˜å‚¨åœ¨å…¶ä¸­çš„ä»»ä½•ä¸UIç›¸å…³çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼Œä½ çš„åº”ç”¨å¯èƒ½ä¼šåœ¨å…¶ä¸­ä¸€ä¸ªactivityä¸­åŒ…å«ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚å½“ä¸ºé…ç½®æ›´æ”¹é‡æ–°åˆ›å»ºactivityæ—¶ï¼Œæ–°activityå¿…é¡»é‡æ–°è·å–ç”¨æˆ·åˆ—è¡¨ã€‚å¯¹äºç®€å•çš„æ•°æ®ï¼Œè¯¥activityå¯ä»¥ä½¿ç”¨onSaveInstanceState())æ–¹æ³•ï¼Œå¹¶ä»onCreate())ä¸­çš„bundleä¸­æ¢å¤å…¶æ•°æ®ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•åªé€‚ç”¨äºå°‘é‡çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥åºåˆ—åŒ–ç„¶åååºåˆ—åŒ–ï¼Œè€Œä¸æ˜¯åƒç”¨æˆ·åˆ—è¡¨æˆ–ä½å›¾é‚£æ ·çš„æ½œåœ¨çš„å¤§é‡æ•°æ®ã€‚ å¦ä¸€ä¸ªé—®é¢˜æ˜¯UIæ§åˆ¶å™¨ç»å¸¸éœ€è¦è¿›è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½è¿”å›ã€‚UIæ§åˆ¶å™¨éœ€è¦ç®¡ç†è¿™äº›è°ƒç”¨ï¼Œå¹¶ç¡®ä¿ç³»ç»Ÿåœ¨è¢«é”€æ¯åæ¸…é™¤å®ƒä»¬ï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚è¿™ç§ç®¡ç†éœ€è¦å¤§é‡çš„ç»´æŠ¤ï¼Œå¹¶ä¸”åœ¨ä¸ºé…ç½®æ›´æ”¹é‡æ–°åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œç”±äºå¯¹è±¡å¯èƒ½ä¸å¾—ä¸é‡æ–°å‘å‡ºå·²ç»å‘å‡ºçš„è°ƒç”¨ï¼Œè¿™æ˜¯å¯¹èµ„æºçš„æµªè´¹ã€‚ è¯¸å¦‚activitieså’Œfragmentsä¹‹ç±»çš„UIæ§åˆ¶å™¨ä¸»è¦æ˜¯ç”¨æ¥æ˜¾ç¤ºUIæ•°æ®ã€å¯¹ç”¨æˆ·æ“ä½œä½œå‡ºååº”ï¼Œæˆ–è€…å¤„ç†æ“ä½œç³»ç»Ÿé€šä¿¡ï¼Œæ¯”å¦‚æƒé™è¯·æ±‚ã€‚è¦æ±‚UIæ§åˆ¶å™¨ä¹Ÿè´Ÿè´£ä»æ•°æ®åº“æˆ–ç½‘ç»œåŠ è½½æ•°æ®ï¼Œè¿™å¢åŠ äº†ç±»çš„è†¨èƒ€ã€‚ç»™UIæ§åˆ¶å™¨åˆ†é…è¿‡å¤šçš„è´£ä»»ä¼šå¯¼è‡´ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œå®ƒè¯•å›¾ç‹¬è‡ªå¤„ç†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å·¥ä½œï¼Œè€Œä¸æ˜¯å°†å·¥ä½œå§”æ‰˜ç»™å…¶ä»–ç±»ã€‚ä»¥è¿™ç§æ–¹å¼ä¸ºUIæ§åˆ¶å™¨åˆ†é…è¿‡å¤šçš„è´£ä»»ä¹Ÿä¼šä½¿æµ‹è¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚ å°†è§†å›¾æ•°æ®æ‰€æœ‰æƒä¸UIæ§åˆ¶å™¨é€»è¾‘åˆ†ç¦»æ˜¯æ›´å®¹æ˜“ã€æ›´é«˜æ•ˆçš„ã€‚","text":"ViewModelç±»æ—¨åœ¨ä»¥ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼å­˜å‚¨å’Œç®¡ç†ä¸uiç›¸å…³çš„æ•°æ®ã€‚ViewModelç±»å…è®¸æ•°æ®åœ¨è¯¸å¦‚å±å¹•æ—‹è½¬ä¹‹ç±»çš„é…ç½®æ›´æ”¹ä¸­å­˜æ´»ã€‚ æ³¨æ„:è¦å°†ViewModelå¯¼å…¥åˆ°æ‚¨çš„Androidé¡¹ç›®ä¸­ï¼Œè¯·å‚è§å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ç»„ä»¶ã€‚ Androidæ¡†æ¶ç®¡ç†UIæ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚activitieså’Œfragmentsã€‚è¯¥æ¡†æ¶å¯èƒ½ä¼šå†³å®šé”€æ¯æˆ–é‡æ–°åˆ›å»ºUIæ§åˆ¶å™¨ï¼Œä»¥å“åº”å®Œå…¨è¶…å‡ºæ‚¨æ§åˆ¶çš„æŸäº›ç”¨æˆ·æ“ä½œæˆ–è®¾å¤‡äº‹ä»¶ã€‚ å¦‚æœç³»ç»Ÿç ´åæˆ–é‡æ–°åˆ›å»ºä¸€ä¸ªUIæ§åˆ¶å™¨ï¼Œé‚£ä¹ˆå­˜å‚¨åœ¨å…¶ä¸­çš„ä»»ä½•ä¸UIç›¸å…³çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼Œä½ çš„åº”ç”¨å¯èƒ½ä¼šåœ¨å…¶ä¸­ä¸€ä¸ªactivityä¸­åŒ…å«ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚å½“ä¸ºé…ç½®æ›´æ”¹é‡æ–°åˆ›å»ºactivityæ—¶ï¼Œæ–°activityå¿…é¡»é‡æ–°è·å–ç”¨æˆ·åˆ—è¡¨ã€‚å¯¹äºç®€å•çš„æ•°æ®ï¼Œè¯¥activityå¯ä»¥ä½¿ç”¨onSaveInstanceState())æ–¹æ³•ï¼Œå¹¶ä»onCreate())ä¸­çš„bundleä¸­æ¢å¤å…¶æ•°æ®ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•åªé€‚ç”¨äºå°‘é‡çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥åºåˆ—åŒ–ç„¶åååºåˆ—åŒ–ï¼Œè€Œä¸æ˜¯åƒç”¨æˆ·åˆ—è¡¨æˆ–ä½å›¾é‚£æ ·çš„æ½œåœ¨çš„å¤§é‡æ•°æ®ã€‚ å¦ä¸€ä¸ªé—®é¢˜æ˜¯UIæ§åˆ¶å™¨ç»å¸¸éœ€è¦è¿›è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½è¿”å›ã€‚UIæ§åˆ¶å™¨éœ€è¦ç®¡ç†è¿™äº›è°ƒç”¨ï¼Œå¹¶ç¡®ä¿ç³»ç»Ÿåœ¨è¢«é”€æ¯åæ¸…é™¤å®ƒä»¬ï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚è¿™ç§ç®¡ç†éœ€è¦å¤§é‡çš„ç»´æŠ¤ï¼Œå¹¶ä¸”åœ¨ä¸ºé…ç½®æ›´æ”¹é‡æ–°åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œç”±äºå¯¹è±¡å¯èƒ½ä¸å¾—ä¸é‡æ–°å‘å‡ºå·²ç»å‘å‡ºçš„è°ƒç”¨ï¼Œè¿™æ˜¯å¯¹èµ„æºçš„æµªè´¹ã€‚ è¯¸å¦‚activitieså’Œfragmentsä¹‹ç±»çš„UIæ§åˆ¶å™¨ä¸»è¦æ˜¯ç”¨æ¥æ˜¾ç¤ºUIæ•°æ®ã€å¯¹ç”¨æˆ·æ“ä½œä½œå‡ºååº”ï¼Œæˆ–è€…å¤„ç†æ“ä½œç³»ç»Ÿé€šä¿¡ï¼Œæ¯”å¦‚æƒé™è¯·æ±‚ã€‚è¦æ±‚UIæ§åˆ¶å™¨ä¹Ÿè´Ÿè´£ä»æ•°æ®åº“æˆ–ç½‘ç»œåŠ è½½æ•°æ®ï¼Œè¿™å¢åŠ äº†ç±»çš„è†¨èƒ€ã€‚ç»™UIæ§åˆ¶å™¨åˆ†é…è¿‡å¤šçš„è´£ä»»ä¼šå¯¼è‡´ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œå®ƒè¯•å›¾ç‹¬è‡ªå¤„ç†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å·¥ä½œï¼Œè€Œä¸æ˜¯å°†å·¥ä½œå§”æ‰˜ç»™å…¶ä»–ç±»ã€‚ä»¥è¿™ç§æ–¹å¼ä¸ºUIæ§åˆ¶å™¨åˆ†é…è¿‡å¤šçš„è´£ä»»ä¹Ÿä¼šä½¿æµ‹è¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚ å°†è§†å›¾æ•°æ®æ‰€æœ‰æƒä¸UIæ§åˆ¶å™¨é€»è¾‘åˆ†ç¦»æ˜¯æ›´å®¹æ˜“ã€æ›´é«˜æ•ˆçš„ã€‚ å®ç°ViewModelæ¶æ„ç»„ä»¶ä¸ºUIæ§åˆ¶å™¨æä¾›ViewModelåŠ©æ‰‹ç±»ï¼Œè´Ÿè´£ä¸ºUIå‡†å¤‡æ•°æ®ã€‚åœ¨é…ç½®æ›´æ”¹æœŸé—´ï¼ŒViewModelå¯¹è±¡å°†è‡ªåŠ¨ä¿ç•™ï¼Œä»¥ä¾¿å®ƒä»¬ä¿å­˜çš„æ•°æ®ç«‹å³å¯ç”¨åˆ°ä¸‹ä¸€ä¸ªactivityæˆ–fragmentå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ï¼Œè¯·ç¡®ä¿å°†è´£ä»»åˆ†é…ç»™ä¸€ä¸ªViewModelï¼Œè€Œä¸æ˜¯ä¸€ä¸ªactivityæˆ–fragmentï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ‰€ç¤º: 1234567891011121314public class MyViewModel extends ViewModel &#123; private MutableLiveData&lt;List&lt;User&gt;&gt; users; public LiveData&lt;List&lt;User&gt;&gt; getUsers() &#123; if (users == null) &#123; users = new MutableLiveData&lt;List&lt;Users&gt;&gt;(); loadUsers(); &#125; return users; &#125; private void loadUsers() &#123; // æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œæ¥è·å–ç”¨æˆ·. &#125;&#125; ç„¶åï¼Œæ‚¨å¯ä»¥ä»ä»¥ä¸‹activityä¸­è®¿é—®è¯¥åˆ—è¡¨: 1234567891011public class MyActivity extends AppCompatActivity &#123; public void onCreate(Bundle savedInstanceState) &#123; // Create a ViewModel the first time the system calls an activity's onCreate() method. // Re-created activities receive the same MyViewModel instance created by the first activity. MyViewModel model = ViewModelProviders.of(this).get(MyViewModel.class); model.getUsers().observe(this, users -&gt; &#123; // update UI &#125;); &#125;&#125; å¦‚æœè¯¥activityè¢«é‡æ–°åˆ›å»ºï¼Œå®ƒå°†æ”¶åˆ°ç¬¬ä¸€ä¸ªactivityåˆ›å»ºçš„MyViewModelå®ä¾‹ã€‚å½“æ‰€æœ‰è€…activityå®Œæˆåï¼Œæ¡†æ¶è°ƒç”¨ViewModelå¯¹è±¡çš„onCleared())æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¸…ç†èµ„æºã€‚ âš ï¸:ViewModelæ°¸è¿œä¸èƒ½å¼•ç”¨è§†å›¾ã€Lifecycleæˆ–ä»»ä½•å¯èƒ½å¼•ç”¨activityä¸Šä¸‹æ–‡çš„ç±»ã€‚ ViewModelå¯¹è±¡çš„è®¾è®¡æ˜¯ä¸ºäº†æ¯”å…·ä½“çš„è§†å›¾å®ä¾‹æˆ–LifecycleOwnerså®ä¾‹æ´»å¾—æ›´æ´»ã€‚è¿™ä¸ªè®¾è®¡è¿˜æ„å‘³ç€æ‚¨å¯ä»¥æ›´å®¹æ˜“åœ°ç¼–å†™æµ‹è¯•æ¥è¦†ç›–ViewModelï¼Œå› ä¸ºå®ƒä¸çŸ¥é“è§†å›¾å’Œç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ViewModelå¯¹è±¡å¯ä»¥åŒ…å«LifecycleObserversï¼Œæ¯”å¦‚LiveDataå¯¹è±¡ã€‚ç„¶è€Œï¼ŒViewModelå¯¹è±¡æ°¸è¿œä¸èƒ½è§‚å¯Ÿå¯¹ç”Ÿå‘½å‘¨æœŸæ•æ„Ÿçš„è§‚å¯Ÿå¯¹è±¡çš„å˜åŒ–ï¼Œä¾‹å¦‚LiveDataå¯¹è±¡ã€‚å¦‚æœViewModeléœ€è¦Application contextï¼Œä¾‹å¦‚æ‰¾åˆ°ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œå®ƒå¯ä»¥æ‰©å±•AndroidViewModelç±»ï¼Œå¹¶æ‹¥æœ‰ä¸€ä¸ªåœ¨æ„é€ å‡½æ•°ä¸­æ¥æ”¶åˆ°Applicationçš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºApplicationç±»æ‰©å±•äº†Contextã€‚ ViewModelçš„ç”Ÿå‘½å‘¨æœŸViewModelå¯¹è±¡æ˜¯åœ¨è·å¾—ViewModelæ—¶è¢«ä¼ é€’åˆ°ViewModelProviderçš„ç”Ÿå‘½å‘¨æœŸçš„èŒƒå›´ã€‚ViewModelä»ç„¶å­˜åœ¨äºå†…å­˜ä¸­ï¼Œç›´åˆ°å®ƒè¢«é™å®šçš„ç”Ÿå‘½å‘¨æœŸæ°¸ä¹…åœ°æ¶ˆå¤±:åœ¨activityçš„æƒ…å†µä¸‹ï¼Œå½“å®ƒfinishesæ—¶ï¼Œåœ¨ä¸€ä¸ªfragmentä¸­ï¼Œå½“å®ƒè¢«detachedæ—¶ã€‚ å›¾1æ¼”ç¤ºäº†ä¸€ä¸ªactivityçš„å„ä¸ªç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œå½“å®ƒè¿›è¡Œè½®è½¬ï¼Œç„¶åç»“æŸã€‚æ’å›¾è¿˜æ˜¾ç¤ºäº†ä¸ç›¸å…³æ´»åŠ¨ç”Ÿå‘½å‘¨æœŸç›¸é‚»çš„ViewModelçš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªç‰¹æ®Šçš„å›¾è¯´æ˜äº†activityçš„çŠ¶æ€ã€‚åŒæ ·çš„åŸºæœ¬çŠ¶æ€ä¹Ÿé€‚ç”¨äºfragmentçš„ç”Ÿå‘½å‘¨æœŸã€‚ åœ¨ç³»ç»Ÿè°ƒç”¨activityå¯¹è±¡çš„onCreate()æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦ä¸€ä¸ªViewModelã€‚ç³»ç»Ÿå¯ä»¥åœ¨activityçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å¤šæ¬¡è°ƒç”¨onCreate()ï¼Œä¾‹å¦‚åœ¨è®¾å¤‡å±å¹•è¢«æ—‹è½¬æ—¶ã€‚ViewModelå­˜åœ¨äºæ‚¨ç¬¬ä¸€æ¬¡è¯·æ±‚ViewModelæ—¶ï¼Œç›´åˆ°activityå®Œæˆå¹¶é”€æ¯ã€‚ fragmentsä¹‹é—´å…±äº«æ•°æ®åœ¨ä¸€ä¸ªactivityä¸­ï¼Œä¸¤ä¸ªæˆ–å¤šä¸ªfragmentséœ€è¦ç›¸äº’é€šä¿¡æ˜¯å¾ˆå¸¸è§çš„ã€‚è®¾æƒ³ä¸€ä¸ªå¸¸è§çš„master-detail fragmentsï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªfragmentï¼Œç”¨æˆ·ä»ä¸€ä¸ªåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œå¦ä¸€ä¸ªfragmentæ˜¾ç¤ºæ‰€é€‰é¡¹çš„å†…å®¹ã€‚è¿™ä¸ªæ¡ˆä¾‹å¹¶ä¸ç®€å•ï¼Œå› ä¸ºä¸¤ä¸ªfragmentséƒ½éœ€è¦å®šä¹‰ä¸€äº›æ¥å£æè¿°ï¼Œè€Œæ‰€æœ‰è€…activityå¿…é¡»å°†ä¸¤è€…ç»“åˆåœ¨ä¸€èµ·ã€‚æ­¤å¤–ï¼Œä¸¤ä¸ªfragmentså¿…é¡»å¤„ç†å¦ä¸€ä¸ªfragmentå°šæœªåˆ›å»ºæˆ–å¯è§çš„åœºæ™¯ã€‚ è¿™ä¸ªå¸¸è§çš„ç—›ç‚¹å¯ä»¥é€šè¿‡ä½¿ç”¨ViewModelå¯¹è±¡æ¥è§£å†³ã€‚è¿™äº›fragmentså¯ä»¥ä½¿ç”¨å®ƒä»¬çš„activityèŒƒå›´æ¥å…±äº«ä¸€ä¸ªè§†å›¾æ¨¡å‹ï¼Œä»¥å¤„ç†è¿™ç§é€šä¿¡ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ‰€ç¤º: 1234567891011121314151617181920212223242526272829303132public class SharedViewModel extends ViewModel &#123; private final MutableLiveData&lt;Item&gt; selected = new MutableLiveData&lt;Item&gt;(); public void select(Item item) &#123; selected.setValue(item); &#125; public LiveData&lt;Item&gt; getSelected() &#123; return selected; &#125;&#125;public class MasterFragment extends Fragment &#123; private SharedViewModel model; public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); model = ViewModelProviders.of(getActivity()).get(SharedViewModel.class); itemSelector.setOnClickListener(item -&gt; &#123; model.select(item); &#125;); &#125;&#125;public class DetailFragment extends Fragment &#123; public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); SharedViewModel model = ViewModelProviders.of(getActivity()).get(SharedViewModel.class); model.getSelected().observe(this, &#123; item -&gt; // Update the UI. &#125;); &#125;&#125; è¯·æ³¨æ„ï¼Œåœ¨è·å–ViewModelProvideræ—¶ï¼Œä¸¤ä¸ªfragmentséƒ½ä½¿ç”¨getActivity()ã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªfragmentséƒ½æ¥æ”¶ç›¸åŒçš„SharedViewModelå®ä¾‹ï¼Œè¯¥å®ä¾‹çš„ä½œç”¨åŸŸæ˜¯activityã€‚ è¿™ç§æ–¹æ³•æä¾›äº†ä»¥ä¸‹å¥½å¤„: activityä¸éœ€è¦åšä»»ä½•äº‹æƒ…ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ä»»ä½•å…³äºè¿™ç§é€šä¿¡çš„ä¿¡æ¯ã€‚ é™¤äº†SharedViewModelåˆåŒä¹‹å¤–ï¼ŒFragmentsä¸éœ€è¦ç›¸äº’äº†è§£ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªfragmentsæ¶ˆå¤±äº†ï¼Œå¦ä¸€ä¸ªåˆ™ç»§ç»­æ­£å¸¸å·¥ä½œã€‚ æ¯ä¸ªfragmentéƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”ä¸å—å¦ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçš„å½±å“ã€‚å¦‚æœä¸€ä¸ªfragmentæ›¿æ¢å¦ä¸€ä¸ªfragmentï¼ŒUIå°†ç»§ç»­å·¥ä½œï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ ç”¨ViewModelæ›¿æ¢LoadersåƒCursorLoaderè¿™æ ·çš„Loaderç±»ç»å¸¸ç”¨äºåŒæ­¥æ•°æ®åº“æ•°æ®ä¿æŒåº”ç”¨ç¨‹åºçš„UIã€‚æ‚¨å¯ä»¥ä½¿ç”¨ViewModelï¼Œä»¥åŠå…¶ä»–ä¸€äº›ç±»æ¥æ›¿æ¢loaderã€‚ä½¿ç”¨ViewModelå°†UIæ§åˆ¶å™¨ä¸æ•°æ®åŠ è½½æ“ä½œåˆ†ç¦»ï¼Œè¿™æ„å‘³ç€ç±»ä¹‹é—´çš„å¼ºå¼•ç”¨è¾ƒå°‘ã€‚ åœ¨ä½¿ç”¨loadersçš„ä¸€ç§å¸¸è§æ–¹æ³•ä¸­ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä½¿ç”¨ä¸€ä¸ªCursorLoaderæ¥è§‚å¯Ÿæ•°æ®åº“çš„å†…å®¹ã€‚å½“æ•°æ®åº“ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œloaderä¼šè‡ªåŠ¨è§¦å‘æ•°æ®çš„é‡æ–°åŠ è½½ï¼Œå¹¶æ›´æ–°UI: ViewModelä½¿ç”¨Roomå’ŒLiveDataæ¥æ›¿æ¢loaderã€‚ViewModelç¡®ä¿æ•°æ®åœ¨è®¾å¤‡é…ç½®æ›´æ”¹ä¸­å¾—ä»¥ä¿å­˜ã€‚å½“æ•°æ®åº“å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒRoomä¼šé€šçŸ¥æ‚¨çš„LiveDataï¼Œè€ŒLiveDataåˆ™ä¼šç”¨ä¿®æ”¹åçš„æ•°æ®æ›´æ–°æ‚¨çš„UIã€‚ è¿™ç¯‡åšå®¢æ–‡ç« æè¿°äº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰LiveDataçš„ViewModelæ¥æ›¿æ¢ä¸€ä¸ªAsyncTaskLoaderã€‚ éšç€æ‚¨çš„æ•°æ®å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæ‚¨å¯èƒ½ä¼šé€‰æ‹©ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥åŠ è½½æ•°æ®ã€‚ViewModelçš„ç›®çš„æ˜¯å°è£…UIæ§åˆ¶å™¨çš„æ•°æ®ï¼Œä½¿æ•°æ®èƒ½å¤Ÿåœ¨é…ç½®æ›´æ”¹ä¸­å­˜æ´»ã€‚æœ‰å…³å¦‚ä½•åœ¨é…ç½®æ›´æ”¹ä¸­åŠ è½½ã€æŒä¹…åŒ–å’Œç®¡ç†æ•°æ®çš„ä¿¡æ¯ï¼Œè¯·å‚è§ä¿å­˜UIçŠ¶æ€ã€‚ Androidåº”ç”¨ç¨‹åºæ¶æ„çš„æŒ‡å—å»ºè®®æ„å»ºä¸€ä¸ªå­˜å‚¨åº“ç±»æ¥å¤„ç†è¿™äº›å‡½æ•°ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶ - LiveData","slug":"architecture-livedata","date":"2017-11-08T10:47:44.000Z","updated":"2020-07-25T02:57:18.192Z","comments":true,"path":"2017/11/08/architecture-livedata/","link":"","permalink":"https://jigangduan.github.io/2017/11/08/architecture-livedata/","excerpt":"LiveDataæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®æŒæœ‰è€…ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿåˆ°çš„ä¸åŒï¼ŒLiveDataæ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒå°Šé‡å…¶ä»–åº”ç”¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚activitiesã€fragmentsæˆ–servicesã€‚è¿™ä¸€è®¤è¯†ç¡®ä¿äº†LiveDataåªæ›´æ–°äº†å¤„äºæ´»åŠ¨ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç¨‹åºç»„ä»¶è§‚å¯Ÿè€…ã€‚","text":"LiveDataæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®æŒæœ‰è€…ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿåˆ°çš„ä¸åŒï¼ŒLiveDataæ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒå°Šé‡å…¶ä»–åº”ç”¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚activitiesã€fragmentsæˆ–servicesã€‚è¿™ä¸€è®¤è¯†ç¡®ä¿äº†LiveDataåªæ›´æ–°äº†å¤„äºæ´»åŠ¨ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç¨‹åºç»„ä»¶è§‚å¯Ÿè€…ã€‚ æ³¨æ„:è¦å°†LiveDataç»„ä»¶å¯¼å…¥åˆ°æ‚¨çš„Androidé¡¹ç›®ä¸­ï¼Œè¯·å‚è§å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ç»„ä»¶ã€‚ LiveDataè€ƒè™‘ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå®ƒç”±Observerç±»è¡¨ç¤ºï¼Œå¦‚æœå®ƒçš„ç”Ÿå‘½å‘¨æœŸå¤„äºSTARTEDæˆ–RESUMEDçŠ¶æ€ï¼Œåˆ™å¤„äºæ´»è·ƒçŠ¶æ€ã€‚LiveDataåªä¼šé€šçŸ¥æ´»åŠ¨çš„è§‚å¯Ÿè€…å…³äºæ›´æ–°çš„ä¿¡æ¯ã€‚ä¸æ´»è·ƒçš„è§‚å¯Ÿè€…åœ¨è§‚å¯ŸLiveDataå¯¹è±¡çš„æƒ…å†µä¸‹ä¸ä¼šè¢«é€šçŸ¥æ›´æ”¹ã€‚ æ‚¨å¯ä»¥å‘ä¸€ä¸ªå®ç°LifecycleOwneræ¥å£çš„å¯¹è±¡æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€…ã€‚å½“å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„çŠ¶æ€æ›´æ”¹ä¸ºDESTROYEDæ—¶ï¼Œè¯¥å…³ç³»å…è®¸è§‚å¯Ÿè€…è¢«åˆ é™¤ã€‚è¿™å¯¹äºæ´»åŠ¨å’Œç‰‡æ®µå°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å®‰å…¨åœ°è§‚å¯ŸLiveDataå¯¹è±¡ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ³„æ¼æ´»åŠ¨ï¼Œå½“å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸè¢«é”€æ¯æ—¶ï¼Œå®ƒä»¬ä¼šç«‹å³è¢«å–æ¶ˆè®¢é˜…ã€‚ æœ‰å…³å¦‚ä½•ä½¿ç”¨LiveDataçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨LiveDataå¯¹è±¡ ä½¿ç”¨LiveDataçš„ä¼˜ç‚¹ä½¿ç”¨LiveDataæä¾›ä»¥ä¸‹ä¼˜ç‚¹: ç¡®ä¿UIä¸æ•°æ®çŠ¶æ€åŒ¹é… LiveDataéµå¾ªè§‚å¯Ÿè€…æ¨¡å¼ã€‚å½“ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒLiveDataä¼šé€šçŸ¥è§‚å¯Ÿè€…å¯¹è±¡ã€‚æ‚¨å¯ä»¥é€šè¿‡åˆå¹¶ä»£ç æ¥æ›´æ–°è¿™äº›è§‚å¯Ÿè€…å¯¹è±¡ä¸­çš„UIã€‚æ¯æ¬¡å½“åº”ç”¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½ çš„è§‚å¯Ÿè€…éƒ½å¯ä»¥æ›´æ–°UIï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ›´æ–°æ—¶éƒ½æ›´æ–°UIã€‚ æ²¡æœ‰å†…å­˜æ³„æ¼ è§‚å¯Ÿè€…è¢«ç»‘å®šåˆ°Lifecycleå¯¹è±¡ï¼Œå½“ä»–ä»¬çš„ç›¸å…³ç”Ÿå‘½å‘¨æœŸè¢«ç ´åæ—¶ï¼Œä»–ä»¬å°†è‡ªå·±æ¸…ç†å¹²å‡€ã€‚ ä¸ä¼šå› ä¸ºåœæ­¢activitiesè€Œå´©æºƒ å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸æ´»è·ƒçš„ï¼Œä¾‹å¦‚åœ¨åå°å †æ ˆä¸­çš„activityï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šæ¥æ”¶ä»»ä½•LiveDataäº‹ä»¶ã€‚ ä¸ç”¨æ‰‹åŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ UIç»„ä»¶åªæ˜¯è§‚å¯Ÿç›¸å…³æ•°æ®ï¼Œä¸ç”¨åœæ­¢æˆ–æ¢å¤è§‚å¯Ÿã€‚LiveDataè‡ªåŠ¨ç®¡ç†æ‰€æœ‰è¿™äº›ï¼Œå› ä¸ºå®ƒåœ¨è§‚å¯Ÿæ—¶çŸ¥é“ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€å˜åŒ–ã€‚ ä¸€ç›´åˆ°æœ€æ–°æ•°æ® å¦‚æœä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå˜å¾—ä¸æ´»è·ƒï¼Œå†æ¬¡æ´»è·ƒå®ƒå°±ä¼šæ¥æ”¶åˆ°æœ€æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåœ¨åå°çš„activityåœ¨å®ƒè¿”å›åˆ°å‰å°åæ¥æ”¶åˆ°æœ€æ–°çš„æ•°æ® é€‚å½“çš„é…ç½®æ›´æ”¹ å¦‚æœä¸€ä¸ªactivityæˆ–fragmentç”±äºé…ç½®æ›´æ”¹è€Œè¢«é‡æ–°åˆ›å»ºï¼Œæ¯”å¦‚è®¾å¤‡æ—‹è½¬ï¼Œå®ƒä¼šç«‹å³æ¥æ”¶åˆ°æœ€æ–°å¯ç”¨çš„æ•°æ®ã€‚ å…±äº«èµ„æº æ‚¨å¯ä»¥ä½¿ç”¨singletonæ¨¡å¼æ‰©å±•ä¸€ä¸ªLiveDataå¯¹è±¡ï¼Œä»¥åŒ…è£…ç³»ç»ŸæœåŠ¡ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å…±äº«ã€‚LiveDataå¯¹è±¡è¿æ¥åˆ°ç³»ç»ŸæœåŠ¡ä¸€æ¬¡ï¼Œç„¶åä»»ä½•éœ€è¦èµ„æºçš„è§‚å¯Ÿè€…éƒ½å¯ä»¥çœ‹åˆ°LiveDataå¯¹è±¡ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ‰©å±•LiveDataã€‚ ä½¿ç”¨LiveDataå¯¹è±¡æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨LiveDataå¯¹è±¡: åˆ›å»ºä¸€ä¸ªLiveDataå®ä¾‹æ¥ä¿å­˜æŸç§ç±»å‹çš„æ•°æ®ã€‚è¿™é€šå¸¸åœ¨æ‚¨çš„ViewModelç±»ä¸­å®Œæˆ åˆ›å»ºä¸€ä¸ªObserverå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å®šä¹‰onChanged()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ§åˆ¶åœ¨LiveDataå¯¹è±¡çš„æ•°æ®æ›´æ”¹æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚æ‚¨é€šå¸¸åœ¨UIæ§åˆ¶å™¨ä¸­åˆ›å»ºä¸€ä¸ªObserverå¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªactivityæˆ–fragmentã€‚ ä½¿ç”¨observe())æ–¹æ³•å°†è§‚å¯Ÿè€…å¯¹è±¡è¿æ¥åˆ°LiveDataå¯¹è±¡ã€‚observe()æ–¹æ³•æ¥å—ä¸€ä¸ªLifecycleOwnerå¯¹è±¡ã€‚å®ƒå°†Observerå¯¹è±¡è®¢é˜…åˆ°LiveDataå¯¹è±¡ï¼Œä»¥ä¾¿é€šçŸ¥æ›´æ”¹ã€‚æ‚¨é€šå¸¸å°†Observerå¯¹è±¡é™„åŠ åœ¨UIæ§åˆ¶å™¨ä¸­ï¼Œä¾‹å¦‚activityæˆ–fragmentã€‚ æ³¨æ„:æ‚¨å¯ä»¥ä½¿ç”¨observeForever(Observer)æ–¹æ³•æ³¨å†Œä¸€ä¸ªæ²¡æœ‰å…³è”çš„LifecycleOwnerå¯¹è±¡çš„è§‚å¯Ÿè€…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§‚å¯Ÿè€…è¢«è®¤ä¸ºæ€»æ˜¯å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå› æ­¤æ€»æ˜¯è¢«å‘ŠçŸ¥ä¿®æ”¹ã€‚æ‚¨å¯ä»¥è°ƒç”¨removeObserver(Observer)æ–¹æ³•åˆ é™¤è§‚å¯Ÿå™¨ã€‚ å½“æ‚¨æ›´æ–°å­˜å‚¨åœ¨LiveDataå¯¹è±¡ä¸­çš„å€¼æ—¶ï¼Œåªè¦é™„åŠ çš„LifecycleOwnerå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå®ƒå°±ä¼šè§¦å‘æ‰€æœ‰å·²æ³¨å†Œçš„è§‚å¯Ÿè€…ã€‚ LiveDataå…è®¸ç”¨æˆ·ç•Œé¢æ§åˆ¶å™¨çš„è§‚å¯Ÿè€…è®¢é˜…æ›´æ–°ã€‚å½“LiveDataå¯¹è±¡æ‰€æŒæœ‰çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒUIä¼šè‡ªåŠ¨æ›´æ–°å“åº”ã€‚ åˆ›å»ºLiveDataå¯¹è±¡LiveDataæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨äºä»»ä½•æ•°æ®çš„åŒ…è£…å™¨ï¼ŒåŒ…æ‹¬å®ç°Collectionsçš„å¯¹è±¡ï¼Œå¦‚Listã€‚LiveDataå¯¹è±¡é€šå¸¸å­˜å‚¨åœ¨ViewModelå¯¹è±¡ä¸­ï¼Œå¹¶é€šè¿‡getteræ–¹æ³•è®¿é—®ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º: 1234567891011121314public class NameViewModel extends ViewModel &#123;// Create a LiveData with a Stringprivate MutableLiveData&lt;String&gt; mCurrentName; public MutableLiveData&lt;String&gt; getCurrentName() &#123; if (mCurrentName == null) &#123; mCurrentName = new MutableLiveData&lt;String&gt;(); &#125; return mCurrentName; &#125;// Rest of the ViewModel...&#125; æœ€åˆï¼ŒLiveDataå¯¹è±¡ä¸­çš„æ•°æ®æ²¡æœ‰è®¾ç½®ã€‚ æ³¨æ„:ç¡®ä¿å­˜å‚¨LiveDataå¯¹è±¡åœ¨ViewModelå¯¹è±¡ä¸­æ›´æ–°UIï¼Œè€Œä¸æ˜¯activityæˆ–fragmentï¼ŒåŸå› å¦‚ä¸‹: é¿å…è†¨èƒ€çš„æ´»åŠ¨å’Œç¢ç‰‡ã€‚ç°åœ¨ï¼Œè¿™äº›UIæ§åˆ¶å™¨è´Ÿè´£æ˜¾ç¤ºæ•°æ®ï¼Œè€Œä¸æ˜¯ä¿å­˜æ•°æ®çŠ¶æ€ã€‚ å°†LiveDataå®ä¾‹ä¸ç‰¹å®šæ´»åŠ¨æˆ–ç‰‡æ®µå®ä¾‹åˆ†ç¦»ï¼Œå¹¶å…è®¸LiveDataå¯¹è±¡åœ¨é…ç½®æ›´æ”¹ä¸­å­˜æ´»ã€‚ æ‚¨å¯ä»¥åœ¨ViewModelæŒ‡å—ä¸­æ›´å¤šåœ°äº†è§£ViewModelç±»çš„å¥½å¤„å’Œä½¿ç”¨æƒ…å†µ è§‚å¯ŸLiveDataå¯¹è±¡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºç»„ä»¶çš„onCreate())æ–¹æ³•æ˜¯å¼€å§‹è§‚å¯ŸLiveDataå¯¹è±¡çš„æ­£ç¡®ä½ç½®ï¼ŒåŸå› å¦‚ä¸‹: ç¡®ä¿ç³»ç»Ÿä¸ä¼šä»activityæˆ–fragmentçš„onResume()æ–¹æ³•ä¸­å‘å‡ºå†—ä½™çš„è°ƒç”¨ã€‚ ä¸ºäº†ç¡®ä¿activityæˆ–fragmentæ‹¥æœ‰æ•°æ®ï¼Œå®ƒå¯ä»¥åœ¨æ´»åŠ¨å¼€å§‹æ—¶æ˜¾ç¤ºã€‚ä¸€æ—¦åº”ç”¨ç¨‹åºç»„ä»¶å¤„äºSTARTEDçŠ¶æ€ï¼Œå®ƒå°±ä¼šä»å®ƒæ‰€è§‚å¯Ÿåˆ°çš„LiveDataå¯¹è±¡ä¸­æ¥æ”¶åˆ°æœ€æ–°çš„å€¼ã€‚åªæœ‰åœ¨å·²ç»è®¾ç½®äº†LiveDataå¯¹è±¡æ—¶æ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒLiveDataåªåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ‰æä¾›æ›´æ–°ï¼Œè€Œä¸”åªå¯¹æ´»åŠ¨çš„è§‚å¯Ÿè€…è¿›è¡Œæ›´æ–°ã€‚è¿™ç§è¡Œä¸ºçš„ä¸€ä¸ªä¾‹å¤–æ˜¯ï¼Œå½“è§‚å¯Ÿè€…ä»ä¸€ä¸ªéæ´»åŠ¨çŠ¶æ€è½¬å˜ä¸ºä¸€ä¸ªæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œä¹Ÿä¼šæ”¶åˆ°ä¸€ä¸ªæ›´æ–°ã€‚æ­¤å¤–ï¼Œå¦‚æœè§‚å¯Ÿè€…ç¬¬äºŒæ¬¡ä»éæ´»åŠ¨çŠ¶æ€å˜ä¸ºæ´»åŠ¨çŠ¶æ€ï¼Œå®ƒåªä¼šæ”¶åˆ°ä¸€ä¸ªæ›´æ–°ï¼Œå¦‚æœè¯¥å€¼åœ¨ä¸Šä¸€æ¬¡æ¿€æ´»æ—¶å‘ç”Ÿäº†å˜åŒ–ã€‚ ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•å¼€å§‹è§‚å¯Ÿä¸€ä¸ªLiveDataå¯¹è±¡: 1234567891011121314151617181920212223242526public class NameActivity extends AppCompatActivity &#123; private NameViewModel mModel; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); // Other code to setup the activity... // Get the ViewModel. mModel = ViewModelProviders.of(this).get(NameViewModel.class); // Create the observer which updates the UI. final Observer&lt;String&gt; nameObserver = new Observer&lt;String&gt;() &#123; @Override public void onChanged(@Nullable final String newName) &#123; // Update the UI, in this case, a TextView. mNameTextView.setText(newName); &#125; &#125;; // Observe the LiveData, passing in this activity as the LifecycleOwner and the observer. mModel.getCurrentName().observe(this, nameObserver); &#125;&#125; åœ¨è°ƒç”¨äº†observe())ä¹‹åï¼ŒnameObserverè¢«ä½œä¸ºå‚æ•°ä¼ é€’ï¼ŒonChanged())ç«‹å³è¢«è°ƒç”¨ï¼Œæä¾›äº†å½“å‰åœ¨mCurrentNameä¸­å­˜å‚¨çš„æœ€æ–°å€¼ã€‚å¦‚æœLiveDataå¯¹è±¡æ²¡æœ‰åœ¨mCurrentNameä¸­è®¾ç½®å€¼ï¼Œåˆ™ä¸ä¼šè°ƒç”¨onChanged()ã€‚ æ›´æ–°LiveDataå¯¹è±¡LiveDataæ²¡æœ‰å…¬å¼€å¯ç”¨çš„æ–¹æ³•æ¥æ›´æ–°å­˜å‚¨çš„æ•°æ®ã€‚MutableLiveDataç±»å…¬å¼€äº†setValue(T))å’ŒpostValue(T))æ–¹æ³•ï¼Œå¦‚æœéœ€è¦ç¼–è¾‘å­˜å‚¨åœ¨LiveDataå¯¹è±¡ä¸­çš„å€¼ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚é€šå¸¸åœ¨ViewModelä¸­ä½¿ç”¨MutableLiveDataï¼Œç„¶åViewModelåªå‘è§‚å¯Ÿè€…å…¬å¼€ä¸å¯å˜çš„LiveDataå¯¹è±¡ã€‚ åœ¨è®¾ç½®äº†è§‚å¯Ÿè€…å…³ç³»ä¹‹åï¼Œæ‚¨å¯ä»¥æ›´æ–°LiveDataå¯¹è±¡çš„å€¼ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œå½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œå®ƒä¼šè§¦å‘æ‰€æœ‰è§‚å¯Ÿè€…: 1234567mButton.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; String anotherName = \"John Doe\"; mModel.getCurrentName().setValue(anotherName); &#125;&#125;); åœ¨ç¤ºä¾‹ä¸­è°ƒç”¨setValue(T)çš„ç»“æœæ˜¯è§‚å¯Ÿè€… è¢«è°ƒç”¨äº†æœ‰John Doeå€¼çš„onChanged()æ–¹æ³• ã€‚ç¤ºä¾‹æ˜¾ç¤ºäº†æŒ‰é’®æŒ‰ä¸‹ï¼Œä½†æ˜¯setValue()æˆ–postValue()çš„è¢«è°ƒç”¨å¯ä»¥æ˜¯å„ç§æ›´æ–°mNameçš„åŸå› ï¼ŒåŒ…æ‹¬å“åº”ç½‘ç»œè¯·æ±‚æˆ–æ•°æ®åº“åŠ è½½å®Œæˆ;åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå¯¹setValue()æˆ–postValue()çš„è°ƒç”¨ä¼šè§¦å‘è§‚å¯Ÿè€…å¹¶æ›´æ–°UIã€‚ æ³¨æ„:æ‚¨å¿…é¡»è°ƒç”¨setValue(T)æ–¹æ³•æ¥ä»ä¸»çº¿ç¨‹æ›´æ–°LiveDataå¯¹è±¡ã€‚å¦‚æœä»£ç æ˜¯åœ¨ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨postValue(T)æ–¹æ³•æ¥æ›´æ–°LiveDataå¯¹è±¡ã€‚ ä½¿ç”¨LiveData RoomRoomæŒä¹…åŒ–åº“æ”¯æŒå¯è§‚å¯Ÿçš„æŸ¥è¯¢ï¼Œè¿™äº›æŸ¥è¯¢è¿”å›äº†LiveDataå¯¹è±¡ã€‚å¯è§‚å¯Ÿçš„æŸ¥è¯¢æ˜¯ä½œä¸ºæ•°æ®åº“è®¿é—®å¯¹è±¡(DAO)çš„ä¸€éƒ¨åˆ†ç¼–å†™çš„ã€‚ å½“æ•°æ®åº“è¢«æ›´æ–°æ—¶ï¼ŒRoomä¼šç”Ÿæˆæ‰€æœ‰å¿…è¦çš„ä»£ç æ¥æ›´æ–°LiveDataå¯¹è±¡ã€‚å½“éœ€è¦æ—¶ï¼Œç”Ÿæˆçš„ä»£ç åœ¨åå°çº¿ç¨‹ä¸Šå¼‚æ­¥åœ°è¿è¡ŒæŸ¥è¯¢ã€‚æ­¤æ¨¡å¼æœ‰åŠ©äºå°†æ•°æ®æ˜¾ç¤ºåœ¨UIä¸­ï¼Œä¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒåŒæ­¥ã€‚æ‚¨å¯ä»¥åœ¨RoomæŒä¹…åŒ–åº“æŒ‡å—ä¸­äº†è§£æ›´å¤šå…³äºRoomå’ŒDAOçš„å†…å®¹ã€‚ æ‰©å±•LiveDataLiveDataè®¤ä¸ºï¼Œå¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äºSTARTEDæˆ–RESUMEDçŠ¶æ€ï¼Œé‚£ä¹ˆè§‚å¯Ÿè€…å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œä»¥ä¸‹ç¤ºä¾‹ä»£ç è¯´æ˜äº†å¦‚ä½•æ‰©å±•LiveDataç±»: 123456789101112131415161718192021222324public class StockLiveData extends LiveData&lt;BigDecimal&gt; &#123; private StockManager mStockManager; private SimplePriceListener mListener = new SimplePriceListener() &#123; @Override public void onPriceChanged(BigDecimal price) &#123; setValue(price); &#125; &#125;; public StockLiveData(String symbol) &#123; mStockManager = new StockManager(symbol); &#125; @Override protected void onActive() &#123; mStockManager.requestPriceUpdates(mListener); &#125; @Override protected void onInactive() &#123; mStockManager.removeUpdates(mListener); &#125;&#125; åœ¨æœ¬ä¾‹ä¸­ï¼Œä»·æ ¼listenerçš„å®ç°åŒ…æ‹¬ä»¥ä¸‹é‡è¦æ–¹æ³•: onActive())æ–¹æ³•è°ƒç”¨ï¼Œå½“LiveDataå¯¹è±¡æœ‰ä¸€ä¸ªæ´»è·ƒçš„è§‚å¯Ÿè€…æ—¶ã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦ä»è¿™ä¸ªæ–¹æ³•å¼€å§‹è§‚å¯Ÿè‚¡ç¥¨ä»·æ ¼çš„æ›´æ–°ã€‚ onInactive())æ–¹æ³•è°ƒç”¨ï¼Œå½“LiveDataå¯¹è±¡æ²¡æœ‰ä»»ä½•æ´»è·ƒçš„è§‚å¯Ÿè€…æ—¶ã€‚ç”±äºæ²¡æœ‰è§‚å¯Ÿäººå‘˜åœ¨ç›‘å¬ï¼Œå› æ­¤æ²¡æœ‰ç†ç”±ä¸StockManageræœåŠ¡ä¿æŒè”ç³»ã€‚ setValue(T))æ–¹æ³•æ›´æ–°LiveDataå®ä¾‹çš„å€¼ï¼Œå¹¶é€šçŸ¥ä»»ä½•æ´»è·ƒçš„è§‚å¯Ÿè€…å…³äºè¿™ä¸ªå˜åŒ–ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨StockLiveDataç±»å¦‚ä¸‹: 12345678910public class MyFragment extends Fragment &#123; @Override public void onActivityCreated(Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); LiveData&lt;BigDecimal&gt; myPriceListener = ...; myPriceListener.observe(this, price -&gt; &#123; // Update the UI. &#125;); &#125;&#125; observe())æ–¹æ³•å°†ç‰‡æ–­ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œå®ƒæ˜¯LifecycleOwnerçš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·åšæ„å‘³ç€è¿™ä¸ªè§‚å¯Ÿè€…è¢«ç»‘å®šåˆ°ä¸æ‰€æœ‰è€…ç›¸å…³çš„Lifecycleå¯¹è±¡ï¼Œè¿™æ„å‘³ç€: å¦‚æœLifecycleå¯¹è±¡ä¸æ˜¯å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œé‚£ä¹ˆå³ä½¿å€¼å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸ä¼šè°ƒç”¨è§‚å¯Ÿè€…ã€‚ åœ¨Lifecycleå¯¹è±¡è¢«é”€æ¯ä¹‹åï¼Œè§‚å¯Ÿè€…ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ LiveDataå¯¹è±¡æ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„äº‹å®ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨å¤šä¸ªactivitiesã€fragmentså’Œservicesä¹‹é—´å…±äº«å®ƒä»¬ã€‚ä¸ºäº†ä¿æŒè¿™ä¸ªç¤ºä¾‹çš„ç®€å•æ€§ï¼Œæ‚¨å¯ä»¥å°†LiveDataç±»ä½œä¸ºä¸€ä¸ªå•ä¾‹å¯¹è±¡æ¥å®ç°: 123456789101112131415161718192021222324252627282930313233public class StockLiveData extends LiveData&lt;BigDecimal&gt; &#123; private static StockLiveData sInstance; private StockManager mStockManager; private SimplePriceListener mListener = new SimplePriceListener() &#123; @Override public void onPriceChanged(BigDecimal price) &#123; setValue(price); &#125; &#125;; @MainThread public static StockLiveData get(String symbol) &#123; if (sInstance == null) &#123; sInstance = new StockLiveData(symbol); &#125; return sInstance; &#125; private StockLiveData(String symbol) &#123; mStockManager = new StockManager(symbol); &#125; @Override protected void onActive() &#123; mStockManager.requestPriceUpdates(mListener); &#125; @Override protected void onInactive() &#123; mStockManager.removeUpdates(mListener); &#125;&#125; ä½ å¯ä»¥åœ¨fragmentä¸­ä½¿ç”¨å®ƒï¼Œå¦‚ä¸‹: 12345678public class MyFragment extends Fragment &#123; @Override public void onActivityCreated(Bundle savedInstanceState) &#123; StockLiveData.get(getActivity()).observe(this, price -&gt; &#123; // Update the UI. &#125;); &#125;&#125; å¤šä¸ªfragmentså’Œactivitieså¯ä»¥è§‚å¯Ÿåˆ°MyPriceListenerå®ä¾‹ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…·æœ‰å¯è§æ€§å’Œæ´»è·ƒæ€§ï¼ŒLiveDataåªè¿æ¥åˆ°ç³»ç»ŸæœåŠ¡ã€‚ å˜æ¢LiveDataæ‚¨å¯èƒ½æƒ³è¦å¯¹LiveDataå¯¹è±¡ä¸­å­˜å‚¨çš„å€¼è¿›è¡Œæ›´æ”¹ï¼Œç„¶åå°†å…¶å‘é€ç»™è§‚å¯Ÿè€…ï¼Œæˆ–è€…æ‚¨å¯èƒ½éœ€è¦æ ¹æ®å¦ä¸€ä¸ªå¯¹è±¡çš„å€¼è¿”å›ä¸€ä¸ªä¸åŒçš„LiveDataå®ä¾‹ã€‚LifecycleåŒ…æä¾›äº†Transformationsç±»ï¼Œå…¶ä¸­åŒ…æ‹¬æ”¯æŒè¿™äº›åœºæ™¯çš„è¾…åŠ©æ–¹æ³•ã€‚ Transformations.map()) å¯¹å­˜å‚¨åœ¨LiveDataå¯¹è±¡ä¸­çš„å€¼åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°†ç»“æœä¼ æ’­åˆ°ä¸‹æ¸¸ã€‚ 1234LiveData&lt;User&gt; userLiveData = ...;LiveData&lt;String&gt; userName = Transformations.map(userLiveData, user -&gt; &#123; user.name + \" \" + user.lastName&#125;); Transformations.switchMap()) ä¸map()ç±»ä¼¼ï¼Œå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°LiveDataå¯¹è±¡ä¸­å­˜å‚¨çš„å€¼ï¼Œå¹¶å°†ç»“æœå‘é€åˆ°ä¸‹æ¸¸ã€‚ä¼ é€’ç»™switchMap()çš„å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªLiveDataå¯¹è±¡ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º: 123456private LiveData&lt;User&gt; getUser(String id) &#123; ...;&#125;LiveData&lt;String&gt; userId = ...;LiveData&lt;User&gt; user = Transformations.switchMap(userId, id -&gt; getUser(id) ); æ‚¨å¯ä»¥ä½¿ç”¨è½¬æ¢æ–¹æ³•åœ¨è§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸä¸­æºå¸¦ä¿¡æ¯ã€‚é™¤éè§‚å¯Ÿè€…åœ¨è§‚å¯Ÿè¿”å›çš„LiveDataå¯¹è±¡ï¼Œå¦åˆ™è¿™äº›è½¬æ¢ä¸ä¼šè¢«è®¡ç®—ã€‚å› ä¸ºè½¬æ¢æ˜¯æƒ°æ€§åœ°è®¡ç®—çš„ï¼Œæ‰€ä»¥ä¸ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„è¡Œä¸ºåœ¨ä¸éœ€è¦é¢å¤–çš„æ˜¾å¼è°ƒç”¨æˆ–ä¾èµ–é¡¹çš„æƒ…å†µä¸‹è¢«éšå¼åœ°ä¼ é€’ä¸‹å»ã€‚ å¦‚æœæ‚¨è®¤ä¸ºåœ¨ViewModelå¯¹è±¡ä¸­éœ€è¦ä¸€ä¸ªLifecycleå¯¹è±¡ï¼Œé‚£ä¹ˆè½¬æ¢å¯èƒ½æ˜¯æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªUIç»„ä»¶ï¼Œè¯¥ç»„ä»¶æ¥å—ä¸€ä¸ªåœ°å€ï¼Œå¹¶è¿”å›è¯¥åœ°å€çš„é‚®æ”¿ç¼–ç ã€‚æ‚¨å¯ä»¥ä¸ºè¯¥ç»„ä»¶å®ç°ç®€å•çš„ViewModelï¼Œå¦‚ä¸‹ç¤ºä¾‹ä»£ç æ‰€ç¤º: 1234567891011class MyViewModel extends ViewModel &#123; private final PostalCodeRepository repository; public MyViewModel(PostalCodeRepository repository) &#123; this.repository = repository; &#125; private LiveData&lt;String&gt; getPostalCode(String address) &#123; // DON'T DO THIS return repository.getPostCode(address); &#125;&#125; ç„¶åï¼ŒUIç»„ä»¶éœ€è¦ä»å…ˆå‰çš„LiveDataå¯¹è±¡ä¸­å–æ¶ˆæ³¨å†Œï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨getPostalCode()æ—¶æ³¨å†Œæ–°å®ä¾‹ã€‚æ­¤å¤–ï¼Œå¦‚æœUIç»„ä»¶è¢«é‡æ–°åˆ›å»ºï¼Œå®ƒå°†è§¦å‘å¦ä¸€ä¸ªrepository.getPostCode()æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä»¥å‰çš„è°ƒç”¨çš„ç»“æœ ç›¸åï¼Œæ‚¨å¯ä»¥å°†é‚®æ”¿ç¼–ç æŸ¥è¯¢ä½œä¸ºåœ°å€è¾“å…¥çš„è½¬æ¢å®ç°ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º: 12345678910111213141516class MyViewModel extends ViewModel &#123; private final PostalCodeRepository repository; private final MutableLiveData&lt;String&gt; addressInput = new MutableLiveData(); public final LiveData&lt;String&gt; postalCode = Transformations.switchMap(addressInput, (address) -&gt; &#123; return repository.getPostCode(address); &#125;); public MyViewModel(PostalCodeRepository repository) &#123; this.repository = repository &#125; private void setInput(String address) &#123; addressInput.setValue(address); &#125;&#125; åœ¨æœ¬ä¾‹ä¸­ï¼ŒpostalCodeå­—æ®µæ˜¯publicçš„å’Œfinalï¼Œå› ä¸ºå­—æ®µæ°¸è¿œä¸ä¼šæ›´æ”¹ã€‚postalCodeå­—æ®µå®šä¹‰ä¸ºaddressInputçš„è½¬æ¢ï¼Œè¿™æ„å‘³ç€åœ¨addressInputæ›´æ”¹æ—¶è°ƒç”¨repository.getPostCode()æ–¹æ³•ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ´»åŠ¨çš„è§‚å¯Ÿè€…ï¼Œå¦‚æœåœ¨repository.getPostCode()è¢«è°ƒç”¨æ—¶æ²¡æœ‰æ´»åŠ¨çš„è§‚å¯Ÿè€…ï¼Œé‚£ä¹ˆåœ¨è§‚å¯Ÿè€…è¢«æ·»åŠ ä¹‹å‰æ²¡æœ‰è®¡ç®—ã€‚ è¯¥æœºåˆ¶å…è®¸åº”ç”¨ç¨‹åºåœ¨è¾ƒä½çº§åˆ«åˆ›å»ºåŸºäºéœ€æ±‚çš„å»¶è¿Ÿè®¡ç®—çš„LiveDataå¯¹è±¡ã€‚ViewModelå¯¹è±¡å¯ä»¥å¾ˆå®¹æ˜“åœ°è·å¾—å¯¹LiveDataå¯¹è±¡çš„å¼•ç”¨ï¼Œç„¶ååœ¨å®ƒä»¬ä¸Šé¢å®šä¹‰è½¬æ¢è§„åˆ™ã€‚ åˆ›å»ºæ–°çš„è½¬æ¢åœ¨ä½ çš„åº”ç”¨ä¸­æœ‰åå‡ ä¸ªä¸åŒçš„å…·ä½“çš„è½¬æ¢ï¼Œä½†å®ƒä»¬ä¸æ˜¯é»˜è®¤æä¾›çš„ã€‚ä¸ºäº†å®ç°æ‚¨è‡ªå·±çš„è½¬æ¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨MediatorLiveDataç±»ï¼Œå®ƒä¾¦å¬å…¶ä»–çš„LiveDataå¯¹è±¡ï¼Œå¹¶å¤„ç†å®ƒä»¬å‘å‡ºçš„äº‹ä»¶ã€‚MediatorLiveDataæ­£ç¡®åœ°å°†å…¶çŠ¶æ€ä¼ æ’­åˆ°æºLiveDataå¯¹è±¡ã€‚è¦äº†è§£æ›´å¤šå…³äºæ­¤æ¨¡å¼çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…Transformationsç±»çš„å‚è€ƒæ–‡æ¡£ã€‚ åˆå¹¶å¤šä¸ªLiveDataæºMediatorLiveDataæ˜¯LiveDataçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒå…è®¸æ‚¨åˆå¹¶å¤šä¸ªliveæ•°æ®æºã€‚å½“ä»»ä½•åŸå§‹çš„LiveDataæºå¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒMediatorLiveDataå¯¹è±¡çš„è§‚å¯Ÿè€…å°±ä¼šè¢«è§¦å‘ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„UIä¸­æœ‰ä¸€ä¸ªLiveDataå¯¹è±¡ï¼Œå¯ä»¥ä»æœ¬åœ°æ•°æ®åº“æˆ–ç½‘ç»œæ›´æ–°ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°†ä»¥ä¸‹æºæ·»åŠ åˆ°MediatorLiveDataå¯¹è±¡: ä¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ç›¸å…³è”çš„LiveDataå¯¹è±¡ã€‚ ä¸ä»ç½‘ç»œè®¿é—®çš„æ•°æ®ç›¸å…³è”çš„LiveDataå¯¹è±¡ã€‚ æ‚¨çš„activityåªéœ€è¦è§‚å¯ŸMediatorLiveDataå¯¹è±¡æ¥æ¥æ”¶æ¥è‡ªä¸¤ä¸ªæºçš„æ›´æ–°ã€‚å¯¹äºä¸€ä¸ªè¯¦ç»†çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜… åº”ç”¨ç¨‹åºæ¶æ„æŒ‡å—çš„é™„å½•:ç½‘ç»œçŠ¶æ€éƒ¨åˆ†ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶ - ä½¿ç”¨Lifecycleç»„ä»¶æ¥å¤„ç†ç”Ÿå‘½å‘¨æœŸ","slug":"architecture-lifecycle","date":"2017-11-08T08:50:06.000Z","updated":"2020-07-25T02:57:18.173Z","comments":true,"path":"2017/11/08/architecture-lifecycle/","link":"","permalink":"https://jigangduan.github.io/2017/11/08/architecture-lifecycle/","excerpt":"Lifecycleç»„ä»¶æ‰§è¡Œæ“ä½œä»¥å“åº”å¦ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„å˜åŒ–ï¼Œä¾‹å¦‚activitieså’Œfragmentsã€‚è¿™äº›ç»„ä»¶å¯ä»¥å¸®åŠ©æ‚¨ç”Ÿæˆæ›´æœ‰ç»„ç»‡çš„ã€æ›´è½»çš„ä»£ç ï¼Œè¿™æ ·æ›´å®¹æ˜“ç»´æŠ¤ã€‚ ä¸€ä¸ªå¸¸è§çš„æ¨¡å¼æ˜¯åœ¨activitieså’Œfragmentsçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å®ç°ç›¸å…³ç»„ä»¶çš„æ“ä½œã€‚ç„¶è€Œï¼Œè¿™ç§æ¨¡å¼å¯¼è‡´äº†ä»£ç çš„ç³Ÿç³•ç»„ç»‡å’Œé”™è¯¯çš„æ‰©æ•£ã€‚é€šè¿‡ä½¿ç”¨lifecycleç»„ä»¶ï¼Œæ‚¨å¯ä»¥å°†ä¾èµ–ç»„ä»¶çš„ä»£ç ä»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è½¬ç§»åˆ°æœ¬èº«ç»„ä»¶ä¸­ android.arch.lifecycleåŒ…æä¾›äº†ç±»å’Œæ¥å£ï¼Œå…è®¸æ‚¨æ„å»ºåŸºäºç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥æ ¹æ®activityæˆ–fragmentçš„å½“å‰ç”Ÿå‘½å‘¨æœŸçŠ¶æ€è‡ªåŠ¨è°ƒæ•´å®ƒä»¬çš„è¡Œä¸ºã€‚ âš ï¸:å¯¼å…¥android.arch.lifecycleåœ¨æ‚¨çš„Androidé¡¹ç›®ï¼Œè¯·å‚è§å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ç»„ä»¶ã€‚","text":"Lifecycleç»„ä»¶æ‰§è¡Œæ“ä½œä»¥å“åº”å¦ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„å˜åŒ–ï¼Œä¾‹å¦‚activitieså’Œfragmentsã€‚è¿™äº›ç»„ä»¶å¯ä»¥å¸®åŠ©æ‚¨ç”Ÿæˆæ›´æœ‰ç»„ç»‡çš„ã€æ›´è½»çš„ä»£ç ï¼Œè¿™æ ·æ›´å®¹æ˜“ç»´æŠ¤ã€‚ ä¸€ä¸ªå¸¸è§çš„æ¨¡å¼æ˜¯åœ¨activitieså’Œfragmentsçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å®ç°ç›¸å…³ç»„ä»¶çš„æ“ä½œã€‚ç„¶è€Œï¼Œè¿™ç§æ¨¡å¼å¯¼è‡´äº†ä»£ç çš„ç³Ÿç³•ç»„ç»‡å’Œé”™è¯¯çš„æ‰©æ•£ã€‚é€šè¿‡ä½¿ç”¨lifecycleç»„ä»¶ï¼Œæ‚¨å¯ä»¥å°†ä¾èµ–ç»„ä»¶çš„ä»£ç ä»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è½¬ç§»åˆ°æœ¬èº«ç»„ä»¶ä¸­ android.arch.lifecycleåŒ…æä¾›äº†ç±»å’Œæ¥å£ï¼Œå…è®¸æ‚¨æ„å»ºåŸºäºç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥æ ¹æ®activityæˆ–fragmentçš„å½“å‰ç”Ÿå‘½å‘¨æœŸçŠ¶æ€è‡ªåŠ¨è°ƒæ•´å®ƒä»¬çš„è¡Œä¸ºã€‚ âš ï¸:å¯¼å…¥android.arch.lifecycleåœ¨æ‚¨çš„Androidé¡¹ç›®ï¼Œè¯·å‚è§å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ç»„ä»¶ã€‚ å¤§å¤šæ•°åœ¨Androidæ¡†æ¶ä¸­å®šä¹‰çš„åº”ç”¨ç¨‹åºç»„ä»¶éƒ½æœ‰ç”Ÿå‘½å‘¨æœŸã€‚ç”Ÿå‘½å‘¨æœŸç”±æ“ä½œç³»ç»Ÿæˆ–åœ¨æ‚¨çš„è¿‡ç¨‹ä¸­è¿è¡Œçš„æ¡†æ¶ä»£ç æ¥ç®¡ç†ã€‚å®ƒä»¬æ˜¯Androidå¦‚ä½•å·¥ä½œçš„æ ¸å¿ƒï¼Œä½ çš„åº”ç”¨å¿…é¡»å°Šé‡å®ƒä»¬ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå¯èƒ½ä¼šè§¦å‘å†…å­˜æ³„æ¼æˆ–åº”ç”¨ç¨‹åºå´©æºƒã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªactivityï¼Œåœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„è®¾å¤‡ä½ç½®ã€‚ä¸€ä¸ªå¸¸è§çš„å®ç°å¯èƒ½å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940class MyLocationListener &#123; public MyLocationListener(Context context, Callback callback) &#123; // ... &#125; void start() &#123; // connect to system location service &#125; void stop() &#123; // disconnect from system location service &#125;&#125;class MyActivity extends AppCompatActivity &#123; private MyLocationListener myLocationListener; @Override public void onCreate(...) &#123; myLocationListener = new MyLocationListener(this, (location) -&gt; &#123; // update UI &#125;); &#125; @Override public void onStart() &#123; super.onStart(); myLocationListener.start(); // manage other components that need to respond // to the activity lifecycle &#125; @Override public void onStop() &#123; super.onStop(); myLocationListener.stop(); // manage other components that need to respond // to the activity lifecycle &#125;&#125; å°½ç®¡è¿™ä¸ªç¤ºä¾‹çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨æœ€ç»ˆä¼šæœ‰å¤ªå¤šçš„è°ƒç”¨æ¥ç®¡ç†UIå’Œå…¶ä»–ç»„ä»¶ä»¥å“åº”ç”Ÿå‘½å‘¨æœŸçš„å½“å‰çŠ¶æ€ã€‚ç®¡ç†å¤šä¸ªç»„ä»¶åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ”¾ç½®äº†ç›¸å½“æ•°é‡çš„ä»£ç ï¼Œä¾‹å¦‚onStart()å’ŒonStop()ï¼Œè¿™ä½¿å¾—å®ƒä»¬éš¾ä»¥ç»´æŠ¤ã€‚ 1234567891011121314151617181920212223242526class MyActivity extends AppCompatActivity &#123; private MyLocationListener myLocationListener; public void onCreate(...) &#123; myLocationListener = new MyLocationListener(this, location -&gt; &#123; // update UI &#125;); &#125; @Override public void onStart() &#123; super.onStart(); Util.checkUserStatus(result -&gt; &#123; // what if this callback is invoked AFTER activity is stopped? if (result) &#123; myLocationListener.start(); &#125; &#125;); &#125; @Override public void onStop() &#123; super.onStop(); myLocationListener.stop(); &#125;&#125; android.arch.lifecycleåŒ…æä¾›äº†ç±»å’Œæ¥å£ï¼Œå¸®åŠ©æ‚¨ä»¥ä¸€ç§å¼¹æ€§å’Œéš”ç¦»çš„æ–¹å¼æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚ LifecycleLifecycleæ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒåŒ…å«ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„ä¿¡æ¯(æ¯”å¦‚activityæˆ–fragment)ï¼Œå¹¶å…è®¸å…¶ä»–å¯¹è±¡è§‚å¯Ÿè¿™ä¸ªçŠ¶æ€ã€‚ Lifecycleä½¿ç”¨ä¸¤ä¸ªä¸»è¦æšä¸¾æ¥è·Ÿè¸ªå…¶ç›¸å…³ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€: Event ä»æ¡†æ¶å’Œç”Ÿå‘½å‘¨æœŸç±»ä¸­åˆ†æ´¾çš„lifecycleäº‹ä»¶ã€‚è¿™äº›äº‹ä»¶æ˜ å°„åˆ°activitieså’Œfragmentsä¸­çš„å›è°ƒäº‹ä»¶ã€‚ State Lifecycleå¯¹è±¡è·Ÿè¸ªçš„ç»„ä»¶çš„å½“å‰çŠ¶æ€ã€‚ å¯ä»¥å°†statesçœ‹ä½œå›¾å’Œäº‹ä»¶çš„èŠ‚ç‚¹ï¼Œå°±åƒè¿™äº›èŠ‚ç‚¹ä¹‹é—´çš„è¾¹æ²¿ã€‚ ä¸€ä¸ªç±»å¯ä»¥é€šè¿‡å‘å…¶æ–¹æ³•æ·»åŠ æ³¨é‡Šæ¥ç›‘è§†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨Lifecycleç±»çš„addObserver())æ–¹æ³•æ·»åŠ ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªè§‚å¯Ÿè€…çš„å®ä¾‹ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º: 12345678910111213public class MyObserver implements LifecycleObserver &#123; @OnLifecycleEvent(Lifecycle.Event.ON_RESUME) public void connectListener() &#123; ... &#125; @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE) public void disconnectListener() &#123; ... &#125;&#125;myLifecycleOwner.getLifecycle().addObserver(new MyObserver()); åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒmyLifecycleOwnerå¯¹è±¡å®ç°äº†LifecycleOwneræ¥å£ï¼Œè¿™å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­è§£é‡Šã€‚ LifecycleOwnerLifecycleOwneræ˜¯ä¸€ä¸ªè¡¨ç¤ºç±»å…·æœ‰Lifecycleçš„å•ä¸€æ–¹æ³•æ¥å£ã€‚å®ƒæœ‰ä¸€ä¸ªæ–¹æ³•getLifecycle())ï¼Œå®ƒå¿…é¡»ç”±ç±»æ¥å®ç°ã€‚å¦‚æœæ‚¨è¯•å›¾ç®¡ç†æ•´ä¸ªåº”ç”¨ç¨‹åºè¿‡ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¯·å‚è§ProcessLifecycleOwnerã€‚ è¿™ä¸ªæ¥å£ä»å•ä¸ªç±»ä¸­æŠ½è±¡å‡ºLifecycleçš„æ‰€æœ‰æƒï¼Œä¾‹å¦‚Fragmentå’ŒAppCompatActivityï¼Œå¹¶å…è®¸ç¼–å†™ä¸å®ƒä»¬ä¸€èµ·å·¥ä½œçš„ç»„ä»¶ã€‚ä»»ä½•å®šåˆ¶çš„åº”ç”¨ç¨‹åºç±»éƒ½å¯ä»¥å®ç°LifecycleOwneræ¥å£ã€‚ å®ç°LifecycleObserverçš„ç»„ä»¶ä¸å®ç°LifecycleOwnerçš„ç»„ä»¶æ— ç¼åœ°å·¥ä½œï¼Œå› ä¸ºæ‰€æœ‰è€…å¯ä»¥æä¾›ä¸€ä¸ªlifecycleï¼Œä¸€ä¸ªè§‚å¯Ÿè€…å¯ä»¥æ³¨å†Œè§‚å¯Ÿã€‚ å¯¹äºä½ç½®è·Ÿè¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è®©MyLocationListenerç±»å®ç°LifecycleObserverï¼Œç„¶åç”¨onCreate()æ–¹æ³•ä¸­çš„activityç”Ÿå‘½å‘¨æœŸåˆå§‹åŒ–å®ƒã€‚è¿™ä½¿å¾—MyLocationListenerç±»èƒ½å¤Ÿè‡ªç»™è‡ªè¶³ï¼Œè¿™æ„å‘³ç€åœ¨MyLocationListenerä¸­å£°æ˜äº†å¯¹lifecycleçŠ¶æ€å˜åŒ–çš„å“åº”ï¼Œè€Œä¸æ˜¯activityã€‚è®©å•ç‹¬çš„ç»„ä»¶å­˜å‚¨å®ƒä»¬è‡ªå·±çš„é€»è¾‘ï¼Œå¯ä»¥ä½¿æ´»åŠ¨å’Œç‰‡æ®µé€»è¾‘æ›´å®¹æ˜“ç®¡ç†ã€‚ 1234567891011121314class MyActivity extends AppCompatActivity &#123; private MyLocationListener myLocationListener; public void onCreate(...) &#123; myLocationListener = new MyLocationListener(this, getLifecycle(), location -&gt; &#123; // update UI &#125;); Util.checkUserStatus(result -&gt; &#123; if (result) &#123; myLocationListener.enable(); &#125; &#125;); &#125;&#125; ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å¦‚æœç”Ÿå‘½å‘¨æœŸå¤„äºä¸è‰¯å¥½çŠ¶æ€ï¼Œå°±é¿å…è°ƒç”¨æŸäº›å›è°ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœå›è°ƒåœ¨activityçŠ¶æ€ä¿å­˜åè¿è¡Œä¸€ä¸ªfragmentäº‹åŠ¡ï¼Œå®ƒå°†è§¦å‘å´©æºƒï¼Œå› æ­¤æˆ‘ä»¬æ°¸è¿œä¸å¸Œæœ›è°ƒç”¨é‚£ä¸ªå›è°ƒã€‚ ä¸ºäº†ä½¿è¿™ä¸ªç”¨ä¾‹ç®€å•ï¼ŒLifecycleç±»å…è®¸å…¶ä»–å¯¹è±¡æŸ¥è¯¢å½“å‰çŠ¶æ€ã€‚ 12345678910111213141516171819202122232425class MyLocationListener implements LifecycleObserver &#123; private boolean enabled = false; public MyLocationListener(Context context, Lifecycle lifecycle, Callback callback) &#123; ... &#125; @OnLifecycleEvent(Lifecycle.Event.ON_START) void start() &#123; if (enabled) &#123; // connect &#125; &#125; public void enable() &#123; enabled = true; if (lifecycle.getCurrentState().isAtLeast(STARTED)) &#123; // connect if not connected &#125; &#125; @OnLifecycleEvent(Lifecycle.Event.ON_STOP) void stop() &#123; // disconnect if connected &#125;&#125; æœ‰äº†è¿™ä¸ªå®ç°ï¼Œæˆ‘ä»¬çš„LocationListenerç±»å®Œå…¨æ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä»å¦ä¸€ä¸ªactivityæˆ–fragmentä¸­ä½¿ç”¨LocationListenerï¼Œæˆ‘ä»¬åªéœ€è¦åˆå§‹åŒ–å®ƒã€‚æ‰€æœ‰çš„å®‰è£…å’Œæ‹†å¸æ“ä½œéƒ½æ˜¯ç”±ç±»æœ¬èº«ç®¡ç†çš„ã€‚ å¦‚æœä¸€ä¸ªåº“æä¾›äº†éœ€è¦ä½¿ç”¨Androidç”Ÿå‘½å‘¨æœŸçš„ç±»ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨lifecycleç»„ä»¶ã€‚æ‚¨çš„åº“å®¢æˆ·ç«¯å¯ä»¥è½»æ¾åœ°é›†æˆè¿™äº›ç»„ä»¶ï¼Œè€Œæ— éœ€åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ‰‹åŠ¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ å®ç°è‡ªå®šä¹‰LifecycleOwneræ”¯æŒåº“26.1.0çš„Fragmentså’ŒActivitieså·²ç»å®ç°äº†LifecycleOwneræ¥å£ã€‚ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå®šåˆ¶çš„ç±»ï¼Œæ‚¨æƒ³è¦åˆ›å»ºä¸€ä¸ªLifecycleOwnerï¼Œæ‚¨å¯ä»¥ä½¿ç”¨LifecycleRegistryç±»ï¼Œä½†æ˜¯æ‚¨éœ€è¦å°†äº‹ä»¶è½¬å‘åˆ°è¿™ä¸ªç±»ä¸­ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ‰€ç¤º: 1234567891011121314151617181920212223public class MyActivity extends Activity implements LifecycleOwner &#123; private LifecycleRegistry mLifecycleRegistry; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); mLifecycleRegistry = new LifecycleRegistry(this); mLifecycleRegistry.markState(Lifecycle.State.CREATED); &#125; @Override public void onStart() &#123; super.onStart(); mLifecycleRegistry.markState(Lifecycle.State.STARTED); &#125; @NonNull @Override public Lifecycle getLifecycle() &#123; return mLifecycleRegistry; &#125;&#125; lifecycleç»„ä»¶çš„æœ€ä½³å®è·µLifecycleç»„ä»¶å¯ä»¥ä½¿æ‚¨åœ¨å„ç§æƒ…å†µä¸‹æ›´å®¹æ˜“åœ°ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚å‡ ä¸ªä¾‹å­: åœ¨ç²—ç²’åº¦å’Œç»†ç²’åº¦çš„ä½ç½®æ›´æ–°ä¹‹é—´åˆ‡æ¢ã€‚ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶æ¥æ”¯æŒç»†ç²’åº¦çš„ä½ç½®æ›´æ–°ï¼Œè€Œä½ çš„ä½ç½®åº”ç”¨æ˜¯å¯è§çš„ï¼Œå½“åº”ç”¨åœ¨åå°æ—¶åˆ‡æ¢åˆ°ç²—ç²’åº¦çš„æ›´æ–°ã€‚LiveDataï¼Œä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ï¼Œå…è®¸ä½ çš„åº”ç”¨åœ¨ä½ çš„ä½¿ç”¨æ”¹å˜ä½ç½®æ—¶è‡ªåŠ¨æ›´æ–°UI åœæ­¢å¹¶å¯åŠ¨è§†é¢‘ç¼“å†²ã€‚ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ç»„ä»¶å°½å¿«å¯åŠ¨è§†é¢‘ç¼“å†²ï¼Œä½†æ˜¯å»¶è¿Ÿæ’­æ”¾ç›´åˆ°åº”ç”¨ç¨‹åºå®Œå…¨å¯åŠ¨ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶åœ¨åº”ç”¨ç¨‹åºè¢«é”€æ¯æ—¶ç»ˆæ­¢ç¼“å†²ã€‚ å¯åŠ¨å’Œåœæ­¢ç½‘ç»œè¿æ¥ã€‚ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶æ¥æ”¯æŒç½‘ç»œæ•°æ®çš„å®æ—¶æ›´æ–°(æµ)ï¼Œå½“åº”ç”¨å¤„äºå‰å°æ—¶ï¼Œå½“åº”ç”¨è¿›å…¥åå°æ—¶è‡ªåŠ¨æš‚åœã€‚ æš‚åœå¹¶æ¢å¤åŠ¨ç”»ç»˜å›¾ã€‚å½“åº”ç”¨åœ¨åå°æ—¶ï¼Œä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ç»„ä»¶æ¥å¤„ç†æš‚åœçš„åŠ¨ç”»ï¼Œå½“åº”ç”¨ç¨‹åºå¤„äºå‰å°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒã€‚ å¤„ç†on stopäº‹ä»¶å½“Lifecycleå±äºAppCompatActivityæˆ–Fragmentï¼ŒonSaveInstanceState()è¢«è°ƒç”¨æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸçš„çŠ¶æ€ä¼šå˜åŒ–åˆ°CREATEDï¼ŒON_STOPäº‹ä»¶å°†æ´¾å‘ã€‚ å½“ä¸€ä¸ªFragmentæˆ–AppCompatActivityçš„çŠ¶æ€é€šè¿‡onSaveInstanceState()ä¿å­˜æ—¶ï¼Œå®ƒçš„UIè¢«è®¤ä¸ºæ˜¯ä¸å¯å˜çš„ï¼Œç›´åˆ°ON_STARTè¢«è°ƒç”¨ã€‚åœ¨ä¿å­˜çŠ¶æ€åå°è¯•ä¿®æ”¹UIå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„å¯¼èˆªçŠ¶æ€å‡ºç°ä¸ä¸€è‡´ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¿å­˜çŠ¶æ€åï¼Œå¦‚æœåº”ç”¨ç¨‹åºè¿è¡Œäº†FragmentTransactionï¼Œé‚£ä¹ˆFragmentManagerä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯,è¯·å‚é˜…commit())ã€‚ å¦‚æœè§‚å¯Ÿè€…çš„å…³è”Lifecycleä¸æ˜¯STARTEDï¼ŒLiveDataé˜»æ­¢è¿™ä¸ªè¾¹ç•Œæƒ…å†µçš„å‘ç”Ÿï¼Œå°±é¿å…è°ƒç”¨å®ƒçš„è§‚å¯Ÿè€…ã€‚åœ¨å¹•åï¼Œå®ƒè°ƒç”¨isAtLeast()ï¼Œç„¶åå†³å®šè°ƒç”¨å®ƒçš„è§‚å¯Ÿè€…ã€‚ ä¸å¹¸çš„æ˜¯ï¼ŒAppCompatActivityçš„onStop()æ–¹æ³•æ˜¯åœ¨onSaveInstanceState()ä¹‹åè°ƒç”¨çš„ï¼Œå®ƒåœ¨UIçŠ¶æ€æ›´æ”¹ä¸è¢«å…è®¸çš„æƒ…å†µä¸‹ç•™ä¸‹äº†ä¸€ä¸ªç©ºç™½ï¼Œä½†æ˜¯Lifecycleè¿˜æ²¡æœ‰è¢«è½¬ç§»åˆ°CREATEDçš„çŠ¶æ€ã€‚ ä¸ºäº†é˜²æ­¢è¿™ä¸€é—®é¢˜ï¼Œbeta2ç‰ˆæœ¬ä¸­çš„Lifecycleç±»å¹¶å°†çŠ¶æ€æ ‡è®°ä¸ºCREATEDï¼Œè€Œæ— éœ€å‘é€äº‹ä»¶ï¼Œä»¥ä¾¿ä»»ä½•æ£€æŸ¥å½“å‰çŠ¶æ€çš„ä»£ç éƒ½èƒ½è·å¾—çœŸæ­£çš„å€¼ï¼Œå³ä½¿äº‹ä»¶ç›´åˆ°onStop()è¢«ç³»ç»Ÿè°ƒç”¨æ—¶æ‰ä¼šè¢«å‘é€ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜: åœ¨APIçº§åˆ«23å’Œæ›´ä½çš„æƒ…å†µä¸‹ï¼ŒAndroidç³»ç»Ÿå®é™…ä¸Šå¯ä»¥èŠ‚çœactivityçš„çŠ¶æ€ï¼Œå³ä½¿å®ƒè¢«å¦ä¸€ä¸ªactivityæ‰€è¦†å†™ã€‚æ¢å¥è¯è¯´ï¼ŒAndroidç³»ç»Ÿè°ƒç”¨onSaveInstanceState()ï¼Œä½†å®ƒä¸ä¸€å®šè°ƒç”¨onStop()ã€‚è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªæ½œåœ¨çš„å¾ˆé•¿çš„æ—¶é—´é—´éš”ï¼Œè§‚å¯Ÿè€…ä»ç„¶è®¤ä¸ºç”Ÿå‘½å‘¨æœŸæ˜¯æ´»åŠ¨çš„ï¼Œå³ä½¿å®ƒçš„UIçŠ¶æ€ä¸èƒ½è¢«ä¿®æ”¹ã€‚ ä»»ä½•æƒ³è¦å‘LiveDataç±»å…¬å¼€ç±»ä¼¼è¡Œä¸ºçš„ç±»éƒ½å¿…é¡»å®ç°Lifecycle beta 2ç‰ˆæœ¬å’Œæ›´ä½ç‰ˆæœ¬æä¾›çš„è§£å†³æ–¹æ¡ˆã€‚ æ³¨æ„:ä¸ºäº†ä½¿è¿™ä¸ªæµæ›´ç®€å•ï¼Œå¹¶æä¾›æ›´å¥½çš„å…¼å®¹æ€§ï¼Œä»ç‰ˆæœ¬1.0-rc1å¼€å§‹ï¼Œç”Ÿå‘½å‘¨æœŸå¯¹è±¡è¢«æ ‡è®°ä¸ºCREATEDå’ŒON_STOPå·²è¢«æ´¾å‘ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨onSaveInstanceState()æ—¶ä¸ç­‰å¾…å¯¹onStop()æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™ä¸å¤ªå¯èƒ½å½±å“æ‚¨çš„ä»£ç ï¼Œä½†æ˜¯æ‚¨éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒä¸ç¬¦åˆAPIçº§åˆ«26å’Œæ›´ä½çš„æ´»åŠ¨ç±»ä¸­çš„è°ƒç”¨é¡ºåºã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Androidæ¶æ„ç»„ä»¶ æ·»åŠ åˆ°ä½ çš„é¡¹ç›®","slug":"adding-components","date":"2017-11-08T08:24:19.000Z","updated":"2020-07-25T02:57:18.172Z","comments":true,"path":"2017/11/08/adding-components/","link":"","permalink":"https://jigangduan.github.io/2017/11/08/adding-components/","excerpt":"","text":"æ¶æ„ç»„ä»¶å¯ä»¥ä»Googleçš„Mavenå­˜å‚¨åº“ä¸­è·å¾—ã€‚è¦ä½¿ç”¨è¿™äº›æ­¥éª¤ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤: æ·»åŠ Google Mavenå­˜å‚¨åº“åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒAndroid Studioé¡¹ç›®ä¸ä¼šè¢«é…ç½®ä¸ºè®¿é—®è¿™ä¸ªå­˜å‚¨åº“ã€‚ è¦å°†å®ƒæ·»åŠ åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼Œä¸ºæ‚¨çš„é¡¹ç›®æ‰“å¼€ build.gradleæ–‡ä»¶(è€Œä¸æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºæˆ–æ¨¡å—)ï¼Œå¦‚ä¸‹æ‰€ç¤º: 123456allprojects &#123; repositories &#123; jcenter() maven &#123; url 'https://maven.google.com' &#125; &#125;&#125; æ·»åŠ æ¶æ„ç»„ä»¶æ‰“å¼€æ‚¨çš„åº”ç”¨ç¨‹åºæˆ–æ¨¡å—build.gradleæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä¾èµ–é¡¹: Lifecycles: implementation &quot;android.arch.lifecycle:runtime:1.0.3&quot; //ä½¿ç”¨ç€lifecycle:extensions or lifecycle:common-java8 å°±ä¸éœ€ annotationProcessor &quot;android.arch.lifecycle:compiler:1.0.0&quot; //å¦‚æœæ‚¨ä½¿ç”¨common-java8ä¸­çš„DefaultLifecycleObserverï¼Œåˆ™ä¸éœ€è¦ å¯¹äºLifecyclesçš„Java8 Lanaguageæ”¯æŒï¼Œæ·»åŠ : implementation &quot;android.arch.lifecycle:common-java8:1.0.0&quot; LiveDataå’ŒViewModelï¼š implementation &quot;android.arch.lifecycle:extensions:1.0.0&quot; è¦åœ¨æµ‹è¯•ä¸­æ§åˆ¶LiveDataåå°çº¿ç¨‹ï¼Œè¯·æ·»åŠ : testImplementation &quot;android.arch.core:core-testing:1.0.0&quot; è¦ä½¿ç”¨ReactiveStreams APIçš„LiveDataï¼Œè¯·æ·»åŠ : implementation &quot;android.arch.lifecycle:reactivestreams:1.0.0&quot; Room implementation &quot;android.arch.persistence.room:runtime:1.0.0&quot; annotationProcessor &quot;android.arch.persistence.room:compiler:1.0.0&quot; å¯¹äºæµ‹è¯•Roomè¿ç§»ï¼Œæ·»åŠ : testImplementation &quot;android.arch.persistence.room:testing:1.0.0&quot; å¯¹Room RxJavaçš„æ”¯æŒï¼Œæ·»åŠ : implementation &quot;android.arch.persistence.room:rxjava2:1.0.0&quot; Paging implementation &quot;android.arch.paging:runtime:1.0.0-alpha3&quot; è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ·»åŠ æ„å»ºä¾èµ–é¡¹ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶æŒ‡å—","slug":"GuidetoAppArchitecture","date":"2017-11-08T03:23:22.000Z","updated":"2020-07-25T02:57:18.153Z","comments":true,"path":"2017/11/08/GuidetoAppArchitecture/","link":"","permalink":"https://jigangduan.github.io/2017/11/08/GuidetoAppArchitecture/","excerpt":"æœ¬æŒ‡å—é€‚ç”¨äºå¼€å‘appçš„å¼€å‘äººå‘˜ï¼Œç°åœ¨å¸Œæœ›äº†è§£æœ€ä½³å®è·µå’Œæ¨èçš„ä½“ç³»ç»“æ„ï¼Œæ„å»ºå¥å£®ã€é«˜è´¨é‡çš„appsã€‚ æ³¨æ„:æœ¬æŒ‡å—å‡å®šè¯»è€…ç†Ÿæ‚‰Androidæ¡†æ¶ã€‚å¦‚æœä½ æ˜¯åº”ç”¨å¼€å‘çš„æ–°æ‰‹ï¼Œè¯·æŸ¥çœ‹å…¥é—¨åŸ¹è®­ç³»åˆ—ï¼Œå…¶ä¸­åŒ…å«äº†æœ¬æŒ‡å—çš„å¿…å¤‡ä¸»é¢˜ã€‚","text":"æœ¬æŒ‡å—é€‚ç”¨äºå¼€å‘appçš„å¼€å‘äººå‘˜ï¼Œç°åœ¨å¸Œæœ›äº†è§£æœ€ä½³å®è·µå’Œæ¨èçš„ä½“ç³»ç»“æ„ï¼Œæ„å»ºå¥å£®ã€é«˜è´¨é‡çš„appsã€‚ æ³¨æ„:æœ¬æŒ‡å—å‡å®šè¯»è€…ç†Ÿæ‚‰Androidæ¡†æ¶ã€‚å¦‚æœä½ æ˜¯åº”ç”¨å¼€å‘çš„æ–°æ‰‹ï¼Œè¯·æŸ¥çœ‹å…¥é—¨åŸ¹è®­ç³»åˆ—ï¼Œå…¶ä¸­åŒ…å«äº†æœ¬æŒ‡å—çš„å¿…å¤‡ä¸»é¢˜ã€‚ appå¼€å‘äººå‘˜é¢ä¸´çš„å¸¸è§é—®é¢˜ä¸ä¼ ç»Ÿçš„æ¡Œé¢åº”ç”¨ä¸åŒï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå•ä¸€å…¥å£ç‚¹ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå•ä¸€çš„æ•´ä½“æµç¨‹è¿è¡Œï¼Œè€ŒAndroidåº”ç”¨ç¨‹åºçš„ç»“æ„è¦å¤æ‚å¾—å¤šã€‚ä¸€ä¸ªå…¸å‹çš„Androidåº”ç”¨ç¨‹åºæ˜¯ç”±å¤šä¸ªåº”ç”¨ç»„ä»¶ç»„æˆçš„ï¼ŒåŒ…æ‹¬activitiesã€fragmentsã€servicesã€content providerså’Œbroadcast receiversã€‚ å¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºç»„ä»¶éƒ½æ˜¯åœ¨åº”ç”¨ç¨‹åºæ¸…å•ä¸­å£°æ˜çš„ï¼ŒAndroidæ“ä½œç³»ç»Ÿä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å†³å®šå¦‚ä½•å°†ä½ çš„åº”ç”¨é›†æˆåˆ°ç”¨æˆ·ä½“éªŒä¸­ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæ¡Œé¢åº”ç”¨ç¨‹åºä¼ ç»Ÿä¸Šæ˜¯ä¸€ä¸ªå•ä¸€çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªæ­£ç¡®ç¼–å†™çš„Androidåº”ç”¨ç¨‹åºéœ€è¦æ›´åŠ çµæ´»ï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥é€šè¿‡è®¾å¤‡ä¸Šçš„ä¸åŒåº”ç”¨ç¨‹åºï¼Œä¸æ–­åœ°åˆ‡æ¢æµé‡å’Œä»»åŠ¡ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸‹å½“ä½ åœ¨ä½ æœ€å–œæ¬¢çš„ç¤¾äº¤ç½‘ç»œåº”ç”¨ä¸­åˆ†äº«ä¸€å¼ ç…§ç‰‡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™æ¬¾åº”ç”¨ä¼šè§¦å‘ä¸€ä¸ªæ‘„åƒå¤´çš„intentï¼ŒAndroidæ“ä½œç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ªæ‘„åƒå¤´åº”ç”¨æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç”¨æˆ·ç¦»å¼€äº†ç¤¾äº¤ç½‘ç»œåº”ç”¨ï¼Œä½†ä»–ä»¬çš„ä½“éªŒæ˜¯æ— ç¼çš„ã€‚åè¿‡æ¥ï¼Œæ‘„åƒå¤´åº”ç”¨å¯èƒ½ä¼šè§¦å‘å…¶ä»–intentsï¼Œæ¯”å¦‚å¯åŠ¨æ–‡ä»¶é€‰æ‹©å™¨ï¼Œè¿™å¯èƒ½ä¼šå¯åŠ¨å¦ä¸€ä¸ªåº”ç”¨ã€‚æœ€ç»ˆç”¨æˆ·ä¼šå›åˆ°ç¤¾äº¤ç½‘ç»œåº”ç”¨ï¼Œåˆ†äº«ç…§ç‰‡ã€‚å¦å¤–ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹çš„ä»»ä½•æ—¶å€™è¢«ä¸€ä¸ªç”µè¯æ‰“æ–­ï¼Œç„¶ååœ¨å®Œæˆç”µè¯å‘¼å«åè¿”å›æ¥åˆ†äº«ç…§ç‰‡ã€‚ åœ¨Androidä¸­ï¼Œè¿™ç§åº”ç”¨ç¨‹åºçš„è¡Œä¸ºæ˜¯å¾ˆå¸¸è§çš„ï¼Œæ‰€ä»¥ä½ çš„åº”ç”¨ç¨‹åºå¿…é¡»æ­£ç¡®å¤„ç†è¿™äº›æµç¨‹ã€‚è¯·è®°ä½ï¼Œç§»åŠ¨è®¾å¤‡æ˜¯èµ„æºå—é™çš„ï¼Œå› æ­¤åœ¨ä»»ä½•æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½éœ€è¦æ€æ­»ä¸€äº›åº”ç”¨ç¨‹åºæ¥ä¸ºæ–°çš„åº”ç”¨ç¨‹åºè…¾å‡ºç©ºé—´ã€‚ è¿™ä¸€åˆ‡çš„å…³é”®åœ¨äºï¼Œä½ çš„åº”ç”¨ç¨‹åºç»„ä»¶å¯ä»¥å•ç‹¬å¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‰é¡ºåºå¯åŠ¨ï¼Œå¯ä»¥éšæ—¶è¢«ç”¨æˆ·æˆ–ç³»ç»Ÿæ‘§æ¯ã€‚å› ä¸ºåº”ç”¨ç»„ä»¶æ˜¯çŸ­æš‚çš„ï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸ(å½“å®ƒä»¬è¢«åˆ›å»ºå’Œé”€æ¯æ—¶)ä¸åœ¨ä½ çš„æ§åˆ¶ä¹‹ä¸‹ï¼Œä½ ä¸åº”è¯¥åœ¨åº”ç”¨ç¨‹åºç»„ä»¶ä¸­å­˜å‚¨ä»»ä½•åº”ç”¨æ•°æ®æˆ–çŠ¶æ€ï¼Œè€Œåº”ç”¨ç¨‹åºç»„ä»¶ä¸åº”è¯¥ç›¸äº’ä¾èµ–ã€‚ å¸¸è§çš„æ¶æ„åŸåˆ™å¦‚æœä½ ä¸èƒ½ä½¿ç”¨åº”ç”¨ç¨‹åºç»„ä»¶æ¥å­˜å‚¨åº”ç”¨æ•°æ®å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåº”è¯¥å¦‚ä½•æ„å»ºå‘¢? ä½ åº”è¯¥å…³æ³¨çš„æœ€é‡è¦çš„äº‹æƒ…æ˜¯ä½ çš„åº”ç”¨ä¸­å…³æ³¨ç‚¹çš„åˆ†ç¦»ã€‚ åœ¨Activityæˆ–Fragmentä¸­ç¼–å†™æ‰€æœ‰ä»£ç æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ã€‚ä»»ä½•ä¸å¤„ç†UIæˆ–æ“ä½œç³»ç»Ÿäº¤äº’çš„ä»£ç éƒ½ä¸åº”è¯¥åœ¨è¿™äº›ç±»ä¸­ã€‚è®©ä»–ä»¬å°½å¯èƒ½åœ°ç²¾ç®€ï¼Œè¿™æ ·å¯ä»¥é¿å…è®¸å¤šä¸ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„é—®é¢˜ã€‚ä¸è¦å¿˜è®°ä½ ä¸æ‹¥æœ‰è¿™äº›ç±»ï¼Œå®ƒä»¬åªæ˜¯åœ¨æ“ä½œç³»ç»Ÿå’Œä½ çš„åº”ç”¨ä¹‹é—´ä½“ç°å¥‘çº¦çš„èƒ¶ç±»ã€‚Androidæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šåœ¨ä»»ä½•æ—¶å€™åŸºäºç”¨æˆ·äº¤äº’æˆ–ä½å†…å­˜ç­‰å…¶ä»–å› ç´ ç ´åå®ƒä»¬ã€‚æœ€å¥½æ˜¯å‡å°‘å¯¹å®ƒä»¬çš„ä¾èµ–ï¼Œä»¥æä¾›å¯é çš„ç”¨æˆ·ä½“éªŒã€‚ ç¬¬äºŒä¸ªé‡è¦åŸåˆ™æ˜¯ï¼Œåº”è¯¥æ¨¡å‹é©±åŠ¨UIï¼Œæœ€å¥½æ˜¯æŒä¹…æ¨¡å‹ã€‚ æŒä¹…æ€§æ˜¯ç†æƒ³çš„ä¸¤ä¸ªåŸå› :å¦‚æœæ“ä½œç³»ç»Ÿç ´åäº†ä½ çš„åº”ç”¨ç¨‹åºæ¥é‡Šæ”¾èµ„æºï¼Œä½ çš„ç”¨æˆ·ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œå³ä½¿ç½‘ç»œè¿æ¥å¾ˆè„†å¼±æˆ–æ²¡æœ‰è¿æ¥ï¼Œä½ çš„åº”ç”¨ä¹Ÿä¼šç»§ç»­å·¥ä½œã€‚æ¨¡å‹æ˜¯è´Ÿè´£å¤„ç†åº”ç”¨ç¨‹åºæ•°æ®çš„ç»„ä»¶ã€‚å®ƒä»¬ç‹¬ç«‹äºåº”ç”¨ç¨‹åºä¸­çš„è§†å›¾å’Œåº”ç”¨ç¨‹åºç»„ä»¶ï¼Œå› æ­¤å®ƒä»¬ä¸è¿™äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜æ˜¯éš”ç¦»çš„ã€‚ä¿æŒUIä»£ç çš„ç®€å•æ€§å’Œåº”ç”¨ç¨‹åºé€»è¾‘çš„è‡ªç”±ä½¿ç®¡ç†å˜å¾—æ›´åŠ å®¹æ˜“ã€‚å°†ä½ çš„åº”ç”¨ç¨‹åºå»ºç«‹åœ¨å…·æœ‰æ˜ç¡®è´£ä»»ç®¡ç†æ•°æ®çš„æ¨¡å‹ç±»ä¸Šï¼Œè¿™å°†ä½¿å®ƒä»¬å…·æœ‰å¯æµ‹è¯•æ€§ï¼Œå¹¶ä¸”ä½ çš„åº”ç”¨ç¨‹åºæ˜¯ä¸€è‡´çš„ã€‚ æ¨èåº”ç”¨æ¶æ„åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•é€šè¿‡ä½¿ç”¨ç”¨ä¾‹æ¥æ„é€ åº”ç”¨ç¨‹åºçš„ç»“æ„ç»„ä»¶ã€‚ æ³¨æ„:è¦æœ‰ä¸€ç§ç¼–å†™åº”ç”¨ç¨‹åºæ‰€æœ‰åœºæ™¯ä¸­æœ€å¥½çš„æ–¹å¼æ˜¯ä¸å¯èƒ½çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´ï¼Œæ¨èçš„ä½“ç³»ç»“æ„åº”è¯¥æ˜¯ä¸€ä¸ªè‰¯å¥½çš„èµ·ç‚¹ã€‚å¦‚æœä½ å·²ç»æœ‰äº†ç¼–å†™Androidåº”ç”¨ç¨‹åºçš„å¥½æ–¹æ³•ï¼Œä½ å°±ä¸éœ€è¦æ”¹å˜äº†ã€‚ å‡è®¾æˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªæ˜¾ç¤ºç”¨æˆ·é…ç½®æ–‡ä»¶çš„UIã€‚è¿™ä¸ªç”¨æˆ·é…ç½®æ–‡ä»¶å°†ä»æˆ‘ä»¬è‡ªå·±çš„ç§æœ‰åç«¯ä½¿ç”¨REST APIè·å–ã€‚ æ„å»ºç”¨æˆ·ç•Œé¢UIå°†ç”±ä¸€ä¸ªfragment UserProfileFragment.java åŠå…¶ç›¸åº”çš„å¸ƒå±€æ–‡ä»¶user_profile_layout.xmlç»„æˆã€‚ ä¸ºäº†é©±åŠ¨UIï¼Œæˆ‘ä»¬çš„æ•°æ®æ¨¡å‹éœ€è¦ä¿å­˜ä¸¤ä¸ªæ•°æ®å…ƒç´ ã€‚ ç”¨æˆ·ID: ç”¨æˆ·çš„æ ‡è¯†ç¬¦ã€‚æœ€å¥½æ˜¯ä½¿ç”¨fragmentå‚æ•°å°†è¿™äº›ä¿¡æ¯ä¼ é€’åˆ°fragmentä¸­ã€‚å¦‚æœAndroidæ“ä½œç³»ç»Ÿç ´åäº†ä½ çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿¡æ¯å°±ä¼šè¢«ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥å½“ä½ çš„åº”ç”¨é‡æ–°å¯åŠ¨æ—¶ï¼Œidè¿˜å¯ä»¥ä½¿ç”¨ã€‚ Userå¯¹è±¡: ä¿å­˜ç”¨æˆ·æ•°æ®çš„POJOã€‚ æˆ‘ä»¬å°†åŸºäºViewModelç±»åˆ›å»ºä¸€ä¸ªUserProfileViewModelï¼Œä¿å­˜æ­¤ä¿¡æ¯ã€‚ ViewModelä¸ºç‰¹å®šçš„UIç»„ä»¶æä¾›æ•°æ®ï¼Œä¾‹å¦‚fragmentæˆ–activityï¼Œå¹¶å¤„ç†ä¸æ•°æ®å¤„ç†ä¸šåŠ¡éƒ¨åˆ†çš„é€šä¿¡ï¼Œä¾‹å¦‚è°ƒç”¨å…¶ä»–ç»„ä»¶æ¥åŠ è½½æ•°æ®æˆ–è½¬å‘ç”¨æˆ·ä¿®æ”¹ã€‚ViewModelä¸çŸ¥é“è§†å›¾ï¼Œä¹Ÿä¸å—é…ç½®æ›´æ”¹çš„å½±å“ï¼Œæ¯”å¦‚ç”±äºæ—‹è½¬é€ æˆçš„é‡æ–°åˆ›å»ºä¸€ä¸ªactivityã€‚ ç°åœ¨æˆ‘ä»¬æœ‰3ä¸ªæ–‡ä»¶ï¼š user_profile.xml: å±å¹•çš„UIå®šä¹‰ UserProfileViewModel.java: ä¸ºUIå‡†å¤‡æ•°æ®ç±» UserProfileFragment.java: åœ¨ViewModelä¸­æ˜¾ç¤ºæ•°æ®å¹¶å¯¹ç”¨æˆ·äº¤äº’ä½œå‡ºååº”çš„UIæ§åˆ¶å™¨ ä¸‹é¢å¼€å§‹æˆ‘ä»¬çš„å®ç°(ä¸ºäº†ç®€å•èµ·è§ï¼Œçœç•¥å¸ƒå±€æ–‡ä»¶): 1234567891011public class UserProfileViewModel extends ViewModel &#123; private String userId; private User user; public void init(String userId) &#123; this.userId = userId; &#125; public User getUser() &#123; return user; &#125;&#125; 123456789101112131415161718public class UserProfileFragment extends Fragment &#123; private static final String UID_KEY = \"uid\"; private UserProfileViewModel viewModel; @Override public void onActivityCreated(@Nullable Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); String userId = getArguments().getString(UID_KEY); viewModel = ViewModelProviders.of(this).get(UserProfileViewModel.class); viewModel.init(userId); &#125; @Override public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123; return inflater.inflate(R.layout.user_profile, container, false); &#125;&#125; ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†è¿™ä¸‰ä¸ªä»£ç æ¨¡å—ï¼Œæˆ‘ä»¬å¦‚ä½•è¿æ¥å®ƒä»¬?æ¯•ç«Ÿï¼Œå½“ViewModelçš„userå­—æ®µè¢«è®¾ç½®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥é€šçŸ¥UIã€‚è¿™å°±æ˜¯LiveDataç±»çš„ç”¨æ­¦ä¹‹åœ°ã€‚ LiveDataæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®æŒæœ‰è€…ã€‚å®ƒè®©åº”ç”¨ç¨‹åºä¸­çš„ç»„ä»¶å¯ä»¥åœ¨ä¸åˆ›å»ºæ˜¾å¼å’Œä¸¥æ ¼çš„ä¾èµ–è·¯å¾„çš„æƒ…å†µä¸‹ï¼Œè§‚å¯ŸLiveDataå¯¹è±¡çš„å˜åŒ–ã€‚LiveDataè¿˜å°Šé‡åº”ç”¨ç¨‹åºç»„ä»¶(activitiesã€fragmentsã€services)çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œå¹¶åšæ­£ç¡®çš„äº‹æƒ…æ¥é˜²æ­¢å¯¹è±¡æ³„æ¼ï¼Œè¿™æ ·æ‚¨çš„åº”ç”¨ç¨‹åºå°±ä¸ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ æ³¨æ„:å¦‚æœæ‚¨å·²ç»åœ¨ä½¿ç”¨RxJavaæˆ–Ageraè¿™æ ·çš„åº“ï¼Œæ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨å®ƒä»¬ï¼Œè€Œä¸æ˜¯ä½¿ç”¨LiveDataã€‚ä½†æ˜¯å½“æ‚¨ä½¿ç”¨å®ƒä»¬æˆ–å…¶ä»–æ–¹æ³•æ—¶ï¼Œè¯·ç¡®ä¿æ‚¨æ­£ç¡®åœ°å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ ·å½“ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…è¢«åœæ­¢æ—¶ï¼Œæ‚¨çš„æ•°æ®æµå°±ä¼šæš‚åœï¼Œè€Œå½“ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…è¢«é”€æ¯æ—¶ï¼Œæµå°±ä¼šè¢«é”€æ¯ã€‚æ‚¨è¿˜å¯ä»¥æ·»åŠ android.arch.lifecycle:reactivestreamséƒ¨ä»¶ä»¥ä½¿ç”¨LiveDataä¸å¦ä¸€ä¸ªå“åº”å¼æµåº“(ä¾‹å¦‚RxJava2)ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨UserProfileViewModelä¸­ä½¿ç”¨LiveData&lt;User&gt;å­—æ®µæ›¿æ¢Userå­—æ®µï¼Œä»¥ä¾¿åœ¨æ•°æ®æ›´æ–°æ—¶å¯ä»¥é€šçŸ¥fragmentã€‚LiveDataæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ï¼Œå½“ä¸å†éœ€è¦æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨æ¸…é™¤å¼•ç”¨ã€‚ 12345678public class UserProfileViewModel extends ViewModel &#123; ... //private User user; private LiveData&lt;User&gt; user; public LiveData&lt;User&gt; getUser() &#123; return user; &#125;&#125; ç°åœ¨ï¼Œæˆ‘ä»¬ä¿®æ”¹UserProfileFragmentæ¥è§‚å¯Ÿæ•°æ®å¹¶æ›´æ–°UIã€‚ 1234567@Overridepublic void onActivityCreated(@Nullable Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); viewModel.getUser().observe(this, user -&gt; &#123; // update UI &#125;);&#125; æ¯æ¬¡æ›´æ–°ç”¨æˆ·æ•°æ®æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨onChanged)çš„å›è°ƒï¼Œå¹¶åˆ·æ–°UIã€‚ å¦‚æœæ‚¨ç†Ÿæ‚‰ä½¿ç”¨observableå›è°ƒå‡½æ•°çš„å…¶ä»–åº“ï¼Œæ‚¨å¯èƒ½å·²ç»æ„è¯†åˆ°ï¼Œæˆ‘ä»¬ä¸å¿…è¦†å†™ç‰‡æ®µçš„onStop()æ–¹æ³•æ¥åœæ­¢è§‚å¯Ÿæ•°æ®ã€‚è¿™å¯¹äºLiveDataæ¥è¯´æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼Œè¿™æ„å‘³ç€é™¤éfragmentå¤„äºæ´»åŠ¨çŠ¶æ€(æ¥æ”¶åˆ°onStart()ï¼Œä½†æ˜¯æ²¡æœ‰æ¥æ”¶onStop())ï¼Œå¦åˆ™å®ƒå°†ä¸ä¼šè°ƒç”¨å›è°ƒã€‚å½“ç‰‡æ®µæ¥æ”¶åˆ°onDestroy()æ—¶ï¼ŒLiveDataä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤è§‚å¯Ÿè€…ã€‚ æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åšä»»ä½•ç‰¹åˆ«çš„äº‹æƒ…æ¥å¤„ç†é…ç½®æ›´æ”¹(ä¾‹å¦‚ï¼Œç”¨æˆ·æ—‹è½¬å±å¹•)ã€‚å½“é…ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒViewModelä¼šè‡ªåŠ¨æ¢å¤ï¼Œå› æ­¤å½“æ–°fragmentå‡ºç°æ—¶ï¼Œå®ƒå°†æ¥æ”¶åˆ°ç›¸åŒçš„ViewModelå®ä¾‹ï¼Œå¹¶ä¸”å°†ç«‹å³ä½¿ç”¨å½“å‰æ•°æ®è°ƒç”¨å›è°ƒã€‚è¿™å°±æ˜¯viewmodelä¸ç›´æ¥å¼•ç”¨è§†å›¾çš„åŸå› ;å®ƒä»¬å¯ä»¥æ¯”è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸæ´»çš„é•¿ã€‚æŸ¥çœ‹ä¸€ä¸ªViewModelçš„ç”Ÿå‘½å‘¨æœŸã€‚ è·å–æ•°æ®ç°åœ¨æˆ‘ä»¬å·²ç»å°†ViewModelè¿æ¥åˆ°fragmentï¼Œä½†æ˜¯ViewModelå¦‚ä½•è·å–ç”¨æˆ·æ•°æ®å‘¢?åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„åç«¯æä¾›äº†ä¸€ä¸ªREST APIã€‚æˆ‘ä»¬å°†ä½¿ç”¨Retrofitåº“æ¥è®¿é—®æˆ‘ä»¬çš„åç«¯ï¼Œå°½ç®¡æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„åº“æ¥å®ç°ç›¸åŒçš„ç›®çš„ã€‚ è¿™æ˜¯æˆ‘ä»¬çš„retrofit Webserviceä¸æˆ‘ä»¬çš„åç«¯é€šä¿¡: 123456789public interface Webservice &#123; /** * @GET å£°æ˜ä¸€ä¸ªHTTP GETè¯·æ±‚ * @Path(\"user\") åœ¨userIdå‚æ•°ä¸Šçš„æ³¨é‡Š * æ›¿æ¢ @GETè·¯å¾„ä¸­&#123;user&#125;å ä½ç¬¦ */ @GET(\"/users/&#123;user&#125;\") Call&lt;User&gt; getUser(@Path(\"user\") String userId);&#125; ViewModelçš„ä¸€ä¸ªå¹¼ç¨šçš„å®ç°æ˜¯ç›´æ¥è°ƒç”¨Webserviceæ¥è·å–æ•°æ®å¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·å¯¹è±¡ã€‚å³ä½¿å®ƒå¾ˆå¥½ç”¨ï¼Œä½†ä½ çš„åº”ç”¨ä¹Ÿå¾ˆéš¾åœ¨æˆé•¿çš„è¿‡ç¨‹ä¸­ç»´æŠ¤ã€‚å®ƒç»™ViewModelç±»å¸¦æ¥äº†å¤ªå¤šçš„è´£ä»»ï¼Œè¿™è¿èƒŒäº†æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å…³æ³¨ç‚¹åˆ†ç¦»åŸåˆ™ã€‚æ­¤å¤–ï¼ŒViewModelçš„èŒƒå›´ä¸Activityæˆ–Fragmentç”Ÿå‘½å‘¨æœŸç›¸å…³è”ï¼Œå› æ­¤åœ¨å…¶ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ä¸¢å¤±æ‰€æœ‰æ•°æ®æ˜¯ä¸€ä¸ªç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚ç›¸åï¼Œæˆ‘ä»¬çš„ViewModelå°†æŠŠè¿™ä¸ªå·¥ä½œå§”æ‰˜ç»™ä¸€ä¸ªæ–°çš„Repositoryæ¨¡å—ã€‚ Repositoryæ¨¡å— è´Ÿè´£å¤„ç†æ•°æ®æ“ä½œã€‚ä»–ä»¬ä¸ºåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†æä¾›äº†ä¸€ä¸ªå¹²å‡€çš„APIï¼Œä»–ä»¬çŸ¥é“ä»å“ªé‡Œè·å–æ•°æ®ï¼Œä»¥åŠåœ¨æ•°æ®æ›´æ–°æ—¶è¦åšä»€ä¹ˆAPIè°ƒç”¨ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬è§†ä¸ºä¸åŒæ•°æ®æºä¹‹é—´çš„ä¸­ä»‹(æŒä¹…æ¨¡å‹ã€webæœåŠ¡ã€ç¼“å­˜ç­‰)ã€‚ ä¸‹é¢çš„UserRepositoryç±»ä½¿ç”¨WebServiceæ¥è·å–ç”¨æˆ·æ•°æ®é¡¹ã€‚ 12345678910111213141516public class UserRepository &#123; private Webservice webservice; // ... public LiveData&lt;User&gt; getUser(int userId) &#123; // This is not an optimal implementation, we'll fix it below final MutableLiveData&lt;User&gt; data = new MutableLiveData&lt;&gt;(); webservice.getUser(userId).enqueue(new Callback&lt;User&gt;() &#123; @Override public void onResponse(Call&lt;User&gt; call, Response&lt;User&gt; response) &#123; // error case is left out for brevity data.setValue(response.body()); &#125; &#125;); return data; &#125;&#125; å°½ç®¡Repositoryæ¨¡å—çœ‹èµ·æ¥æ²¡æœ‰å¿…è¦ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé‡è¦çš„ç›®çš„;å®ƒä»åº”ç”¨çš„å…¶ä½™éƒ¨åˆ†ä¸­æå–æ•°æ®æºã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„ViewModelä¸çŸ¥é“æ•°æ®æ˜¯ç”±Webserviceè·å–çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦å°†å…¶äº¤æ¢åˆ°å…¶ä»–å®ç°ã€‚ æ³¨æ„:ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬çœç•¥äº†ç½‘ç»œé”™è¯¯çš„ä¾‹å­ã€‚å¯¹äºæš´éœ²é”™è¯¯å’ŒåŠ è½½çŠ¶æ€çš„å¦ä¸€ç§å®ç°ï¼Œè¯·å‚é˜…é™„å½•:æš´éœ²ç½‘ç»œçŠ¶æ€ã€‚ ç®¡ç†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»:ä¸Šé¢çš„UserRepositoryç±»éœ€è¦ä¸€ä¸ªWebserviceçš„å®ä¾‹æ¥å®Œæˆå®ƒçš„å·¥ä½œã€‚å®ƒå¯ä»¥ç®€å•åœ°åˆ›å»ºå®ƒï¼Œä½†æ˜¯è¦è¿™æ ·åšï¼Œæ„é€ å®ƒè¿˜éœ€è¦çŸ¥é“Webserviceç±»çš„ä¾èµ–é¡¹ã€‚è¿™å°†å¤§å¤§å¤æ‚åŒ–å¹¶å¤åˆ¶ä»£ç (ä¾‹å¦‚ï¼Œéœ€è¦ä¸€ä¸ªWebserviceå®ä¾‹çš„æ¯ä¸ªç±»éƒ½éœ€è¦çŸ¥é“å¦‚ä½•ä½¿ç”¨å®ƒçš„ä¾èµ–é¡¹æ¥æ„é€ å®ƒ)ã€‚æ­¤å¤–ï¼ŒUserRepositoryå¯èƒ½ä¸æ˜¯å”¯ä¸€éœ€è¦Webserviceçš„ç±»ã€‚å¦‚æœæ¯ä¸ªç±»éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„Webserviceï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯éå¸¸èµ„æºéå¸¸é‡çš„ã€‚ æœ‰ä¸¤ç±»æ¨¡å¼å¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜: ä¾èµ–æ³¨å…¥: ä¾èµ–æ³¨å…¥å…è®¸ç±»åœ¨ä¸æ„é€ å®ƒä»¬çš„æƒ…å†µä¸‹å®šä¹‰å®ƒä»¬çš„ä¾èµ–å…³ç³»ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªç±»è´Ÿè´£æä¾›è¿™äº›ä¾èµ–é¡¹ã€‚æˆ‘ä»¬æ¨èGoogleçš„Dagger 2åº“ï¼Œç”¨äºåœ¨Androidåº”ç”¨ä¸­å®ç°ä¾èµ–æ³¨å…¥ã€‚Dagger 2é€šè¿‡ä½¿ç”¨ä¾èµ–æ ‘æ¥è‡ªåŠ¨æ„é€ å¯¹è±¡ï¼Œå¹¶æä¾›å¯¹ä¾èµ–é¡¹çš„ç¼–è¯‘æ—¶é—´ä¿è¯ æœåŠ¡å®šä½å™¨: æœåŠ¡å®šä½å™¨æä¾›ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œåœ¨è¿™ä¸ªæ³¨å†Œè¡¨ä¸­ï¼Œç±»å¯ä»¥è·å¾—å®ƒä»¬çš„ä¾èµ–ï¼Œè€Œä¸æ˜¯æ„å»ºå®ƒä»¬ã€‚å®ƒæ¯”ä¾èµ–é¡¹æ³¨å…¥(DI)è¦å®¹æ˜“å¾—å¤šï¼Œæ‰€ä»¥å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰DIï¼Œé‚£ä¹ˆä½¿ç”¨æœåŠ¡å®šä½å™¨ä»£æ›¿ã€‚ è¿™äº›æ¨¡å¼å…è®¸æ‚¨æ‰©å±•æ‚¨çš„ä»£ç ï¼Œå› ä¸ºå®ƒä»¬ä¸ºç®¡ç†ä¾èµ–å…³ç³»æä¾›äº†æ¸…æ™°çš„æ¨¡å¼ï¼Œè€Œä¸éœ€è¦å¤åˆ¶ä»£ç æˆ–å¢åŠ å¤æ‚æ€§ã€‚å®ƒä»¬éƒ½å…è®¸äº¤æ¢å®ç°è¿›è¡Œæµ‹è¯•;è¿™æ˜¯ä½¿ç”¨å®ƒä»¬çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Dagger 2æ¥ç®¡ç†ä¾èµ–å…³ç³»ã€‚ è¿æ¥ViewModelå’ŒRepositoryç°åœ¨ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨repositoryä¿®æ”¹UserProfileViewModelã€‚ 123456789101112131415161718192021public class UserProfileViewModel extends ViewModel &#123; private LiveData&lt;User&gt; user; private UserRepository userRepo; @Inject // UserRepositoryå‚æ•°ç”±Dagger 2æä¾› public UserProfileViewModel(UserRepository userRepo) &#123; this.userRepo = userRepo; &#125; public void init(String userId) &#123; if (this.user != null) &#123; // ViewModelæ˜¯æ¯ä¸ªç‰‡æ®µFragmentçš„ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“userIdä¸ä¼šæ”¹å˜ return; &#125; user = userRepo.getUser(userId); &#125; public LiveData&lt;User&gt; getUser() &#123; return this.user; &#125;&#125; ç¼“å­˜æ•°æ®ä¸Šé¢çš„repositoryå®ç°å¾ˆå¥½åœ°æå–äº†å¯¹webæœåŠ¡çš„è°ƒç”¨ï¼Œä½†æ˜¯å› ä¸ºå®ƒåªä¾èµ–äºä¸€ä¸ªæ•°æ®æºï¼Œæ‰€ä»¥å®ƒä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚ ä¸Šé¢çš„UserRepositoryå®ç°çš„é—®é¢˜æ˜¯ï¼Œåœ¨è·å–æ•°æ®ä¹‹åï¼Œå®ƒå¹¶æ²¡æœ‰å°†æ•°æ®ä¿å­˜åœ¨ä»»ä½•åœ°æ–¹ã€‚å¦‚æœç”¨æˆ·ç¦»å¼€UserProfileFragmentå¹¶è¿”å›åˆ°å®ƒï¼Œè¯¥åº”ç”¨ç¨‹åºå°†é‡æ–°è·å–æ•°æ®ã€‚è¿™æœ‰ä¸¤ä¸ªåŸå› :å®ƒæµªè´¹äº†å®è´µçš„ç½‘ç»œå¸¦å®½ï¼Œå¹¶è¿«ä½¿ç”¨æˆ·ç­‰å¾…æ–°çš„æŸ¥è¯¢å®Œæˆã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†å‘æˆ‘ä»¬çš„UserRepositoryæ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®æºï¼Œè¯¥æ•°æ®æºå°†åœ¨å†…å­˜ä¸­ç¼“å­˜Userå¯¹è±¡ã€‚ 123456789101112131415161718192021222324@Singleton // é€šçŸ¥Daggerï¼Œè¿™ä¸ªç±»åº”è¯¥è¢«æ„é€ ä¸€æ¬¡public class UserRepository &#123; private Webservice webservice; // åœ¨å†…å­˜ç¼“å­˜ä¸­å¾ˆç®€å•ï¼Œä¸ºäº†ç®€æ´è€Œçœç•¥äº†ç»†èŠ‚ private UserCache userCache; public LiveData&lt;User&gt; getUser(String userId) &#123; LiveData&lt;User&gt; cached = userCache.get(userId); if (cached != null) &#123; return cached; &#125; final MutableLiveData&lt;User&gt; data = new MutableLiveData&lt;&gt;(); userCache.put(userId, data); // è¿™ä»ç„¶æ˜¯æ¬¡ä¼˜çš„ï¼Œä½†æ¯”ä»¥å‰æ›´å¥½. // ä¸€ä¸ªå®Œæ•´çš„å®ç°è¿˜å¿…é¡»å¤„ç†é”™è¯¯æ¡ˆä¾‹. webservice.getUser(userId).enqueue(new Callback&lt;User&gt;() &#123; @Override public void onResponse(Call&lt;User&gt; call, Response&lt;User&gt; response) &#123; data.setValue(response.body()); &#125; &#125;); return data; &#125;&#125; æŒä¹…åŒ–æ•°æ®åœ¨æˆ‘ä»¬å½“å‰çš„å®ç°ä¸­ï¼Œå¦‚æœç”¨æˆ·æ—‹è½¬å±å¹•æˆ–ç¦»å¼€å¹¶è¿”å›åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆç°æœ‰çš„UIå°†ç«‹å³å¯è§ï¼Œå› ä¸ºrepositoryä»å†…å­˜ç¼“å­˜ä¸­æ£€ç´¢æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·ç¦»å¼€äº†åº”ç”¨ï¼Œå‡ ä¸ªå°æ—¶ååˆå›æ¥äº†ï¼Œåœ¨Androidæ“ä½œç³»ç»Ÿæ‰¼æ€äº†è¿™ä¸ªè¿‡ç¨‹ä¹‹åï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? ä½¿ç”¨å½“å‰çš„å®ç°ï¼Œæˆ‘ä»¬å°†éœ€è¦ä»ç½‘ç»œè·å–æ•°æ®ã€‚è¿™ä¸ä»…æ˜¯ä¸€ç§ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸”ä¹Ÿæ˜¯ä¸€ç§æµªè´¹ï¼Œå› ä¸ºå®ƒå°†ä½¿ç”¨ç§»åŠ¨æ•°æ®æ¥é‡æ–°è·å–ç›¸åŒçš„æ•°æ®ã€‚æ‚¨å¯ä»¥ç®€å•åœ°é€šè¿‡ç¼“å­˜webè¯·æ±‚æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å®ƒä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ã€‚å¦‚æœç›¸åŒçš„ç”¨æˆ·æ•°æ®æ¥è‡ªå¦ä¸€ç§ç±»å‹çš„è¯·æ±‚(ä¾‹å¦‚ï¼Œè·å–å¥½å‹åˆ—è¡¨)ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µ?ç„¶åï¼Œä½ çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ˜¾ç¤ºä¸ä¸€è‡´çš„æ•°æ®ï¼Œè¿™æ˜¯æœ€ä»¤äººå›°æƒ‘çš„ç”¨æˆ·ä½“éªŒã€‚ä¾‹å¦‚ï¼Œç›¸åŒç”¨æˆ·çš„æ•°æ®å¯èƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼å‡ºç°ï¼Œå› ä¸ºå¥½å‹è¯·æ±‚å’Œç”¨æˆ·è¯·æ±‚å¯ä»¥åœ¨ä¸åŒçš„æ—¶é—´æ‰§è¡Œã€‚ä½ çš„åº”ç”¨éœ€è¦å°†å®ƒä»¬åˆå¹¶ï¼Œä»¥é¿å…æ˜¾ç¤ºä¸ä¸€è‡´çš„æ•°æ®ã€‚ å¤„ç†è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæŒä¹…åŒ–æ¨¡å‹ã€‚è¿™å°±æ˜¯RoomæŒä¹…åŒ–åº“æ¥æ‹¯æ•‘çš„åœ°æ–¹ã€‚ Roomæ˜¯ä¸€ä¸ªå¯¹è±¡æ˜ å°„åº“ï¼Œå®ƒä¸ºæœ¬åœ°æ•°æ®æŒä¹…åŒ–æä¾›äº†æœ€å°çš„æ ·æ¿ä»£ç ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œå®ƒä¼šæ ¹æ®æ¨¡å¼éªŒè¯æ¯ä¸ªæŸ¥è¯¢ï¼Œå› æ­¤ï¼ŒæŸåçš„SQLæŸ¥è¯¢ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å¤±è´¥ã€‚RoomæŠ½è±¡äº†å¤„ç†åŸå§‹SQLè¡¨å’ŒæŸ¥è¯¢çš„ä¸€äº›åº•å±‚å®ç°ç»†èŠ‚ã€‚å®ƒè¿˜å…è®¸å¯¹æ•°æ®åº“æ•°æ®è¿›è¡Œæ›´æ”¹(åŒ…æ‹¬é›†åˆå’Œè¿æ¥æŸ¥è¯¢)ï¼Œé€šè¿‡LiveDataå¯¹è±¡å…¬å¼€è¿™äº›æ›´æ”¹ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æ˜¾å¼åœ°å®šä¹‰äº†è§£å†³å¸¸è§é—®é¢˜çš„çº¿ç¨‹çº¦æŸï¼Œä¾‹å¦‚è®¿é—®ä¸»çº¿ç¨‹ä¸Šçš„å­˜å‚¨ã€‚ æ³¨æ„:å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå·²ç»ä½¿ç”¨äº†å¦ä¸€ä¸ªæŒä¹…æ€§è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚SQLiteå¯¹è±¡å…³ç³»æ˜ å°„(ORM)ï¼Œé‚£ä¹ˆæ‚¨å°±ä¸éœ€è¦ç”¨Roomæ¥æ›¿æ¢ç°æœ‰çš„è§£å†³æ–¹æ¡ˆäº†ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ­£åœ¨å†™ä¸€æ¬¾æ–°åº”ç”¨æˆ–é‡æ„ç°æœ‰çš„åº”ç”¨ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨æˆ¿é—´æ¥ä¿å­˜ä½ çš„åº”ç”¨çš„æ•°æ®ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥åˆ©ç”¨è¯¥åº“çš„æŠ½è±¡å’ŒæŸ¥è¯¢éªŒè¯åŠŸèƒ½ã€‚ ä½¿ç”¨Roomï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬çš„æœ¬åœ°æ¨¡å¼ã€‚é¦–å…ˆï¼Œç”¨@Entityæ³¨é‡ŠUserç±»ï¼Œå°†å…¶æ ‡è®°ä¸ºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚ 12345678@Entityclass User &#123; @PrimaryKey private int id; private String name; private String lastName; // getters and setters for fields&#125; ç„¶åï¼Œé€šè¿‡ä¸ºåº”ç”¨ç¨‹åºæ‰©å±•RoomDatabaseæ¥åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ç±»: 123@Database(entities = &#123;User.class&#125;, version = 1)public abstract class MyDatabase extends RoomDatabase &#123;&#125; æ³¨æ„ï¼ŒMyDatabaseæ˜¯æŠ½è±¡çš„ã€‚Roomè‡ªåŠ¨æä¾›å®ƒçš„å®ç°ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Roomæ–‡æ¡£ã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å°†ç”¨æˆ·æ•°æ®æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ•°æ®è®¿é—®å¯¹è±¡(DAO)ã€‚ 1234567@Daopublic interface UserDao &#123; @Insert(onConflict = REPLACE) void save(User user); @Query(\"SELECT * FROM user WHERE id = :userId\") LiveData&lt;User&gt; load(String userId);&#125; ç„¶åï¼Œä»æˆ‘ä»¬çš„æ•°æ®åº“ç±»å¼•ç”¨DAOã€‚ 1234@Database(entities = &#123;User.class&#125;, version = 1)public abstract class MyDatabase extends RoomDatabase &#123; public abstract UserDao userDao();&#125; è¯·æ³¨æ„ï¼Œloadæ–¹æ³•è¿”å›ä¸€ä¸ªLiveData&lt;User&gt;ã€‚RoomçŸ¥é“æ•°æ®åº“ä½•æ—¶è¢«ä¿®æ”¹ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é€šçŸ¥æ‰€æœ‰çš„æ´»åŠ¨è§‚å¯Ÿè€…ã€‚å› ä¸ºå®ƒä½¿ç”¨LiveDataï¼Œæ‰€ä»¥è¿™å°†æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸ºåªæœ‰åœ¨è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨è§‚å¯Ÿè€…çš„æƒ…å†µä¸‹ï¼Œå®ƒæ‰ä¼šæ›´æ–°æ•°æ®ã€‚ æ³¨æ„:åŸºäºè¡¨ä¿®æ”¹çš„Roomæ£€æŸ¥å¤±æ•ˆï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šå‘é€é”™è¯¯çš„æ­£å‘é€šçŸ¥ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„UserRepositoryæ¥åˆå¹¶Roomæ•°æ®æºã€‚ 1234567891011121314151617181920212223242526272829303132333435@Singletonpublic class UserRepository &#123; private final Webservice webservice; private final UserDao userDao; private final Executor executor; @Inject public UserRepository(Webservice webservice, UserDao userDao, Executor executor) &#123; this.webservice = webservice; this.userDao = userDao; this.executor = executor; &#125; public LiveData&lt;User&gt; getUser(String userId) &#123; refreshUser(userId); // ä»æ•°æ®åº“ç›´æ¥è¿”å›ä¸€ä¸ªLiveData. return userDao.load(userId); &#125; private void refreshUser(final String userId) &#123; executor.execute(() -&gt; &#123; // åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œ // æ£€æŸ¥ç”¨æˆ·æœ€è¿‘æ˜¯å¦è¢«è·å– boolean userExists = userDao.hasUser(FRESH_TIMEOUT); if (!userExists) &#123; // åˆ·æ–°æ•°æ® Response response = webservice.getUser(userId).execute(); // TODO æ£€æŸ¥é”™è¯¯ç­‰. // æ›´æ–°æ•°æ®åº“ã€‚LiveDataä¼šè‡ªåŠ¨åˆ·æ–° // é™¤äº†æ›´æ–°æ•°æ®åº“ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšå…¶ä»–ä»»ä½•äº‹æƒ… userDao.save(response.body()); &#125; &#125;); &#125;&#125; è¯·æ³¨æ„ï¼Œå³ä½¿æˆ‘ä»¬æ›´æ”¹äº†æ¥è‡ªUserRepositoryçš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦æ›´æ”¹UserProfileViewModelæˆ–UserProfileFragmentã€‚è¿™æ˜¯æŠ½è±¡æä¾›çš„çµæ´»æ€§ã€‚è¿™å¯¹äºæµ‹è¯•æ¥è¯´ä¹Ÿå¾ˆå¥½ï¼Œå› ä¸ºæ‚¨å¯ä»¥åœ¨æµ‹è¯•æ‚¨çš„UserProfileViewModelæ—¶æä¾›ä¸€ä¸ªå‡çš„UserRepositoryã€‚ ç°åœ¨æˆ‘ä»¬çš„ä»£ç å·²ç»å®Œæˆäº†ã€‚å¦‚æœç”¨æˆ·åœ¨å‡ å¤©åè¿”å›ç›¸åŒçš„UIï¼Œä»–ä»¬å°†ç«‹å³çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æŒä¹…åŒ–äº†å®ƒã€‚åŒæ—¶ï¼Œå¦‚æœæ•°æ®é™ˆæ—§ï¼Œæˆ‘ä»¬çš„å­˜å‚¨åº“å°†æ›´æ–°èƒŒæ™¯ä¸­çš„æ•°æ®ã€‚å½“ç„¶ï¼Œæ ¹æ®æ‚¨çš„ç”¨ä¾‹ï¼Œå¦‚æœå®ƒå¤ªè€äº†ï¼Œæ‚¨å¯èƒ½ä¸æ„¿æ„æ˜¾ç¤ºæŒä¹…çš„æ•°æ®ã€‚ åœ¨ä¸€äº›ç”¨ä¾‹ä¸­ï¼Œä¾‹å¦‚â€œä¸‹æ‹‰åˆ·æ–°â€ï¼Œå¦‚æœå½“å‰æœ‰ç½‘ç»œæ“ä½œæ­£åœ¨è¿›è¡Œä¸­ï¼Œé‚£ä¹ˆUIå‘ç”¨æˆ·æ˜¾ç¤ºæ˜¯å¾ˆé‡è¦çš„ã€‚å°†UIæ“ä½œä¸å®é™…æ•°æ®åˆ†å¼€æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› è€Œè¢«æ›´æ–°(ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è·å–ä¸€ä¸ªæœ‹å‹åˆ—è¡¨ï¼ŒåŒæ ·çš„ç”¨æˆ·å¯èƒ½ä¼šè¢«å†æ¬¡è·å–ï¼Œä»è€Œè§¦å‘ä¸€ä¸ªLiveDataæ›´æ–°)ã€‚ä»UIçš„è§’åº¦æ¥çœ‹ï¼Œåœ¨é£è¡Œä¸­æœ‰è¯·æ±‚çš„äº‹å®åªæ˜¯å¦ä¸€ä¸ªæ•°æ®ç‚¹ï¼Œç±»ä¼¼äºä»»ä½•å…¶ä»–çš„ç‰‡æ®µæ•°æ®(æ¯”å¦‚Userå¯¹è±¡)ã€‚ å¯¹äºè¿™ä¸ªç”¨ä¾‹æœ‰ä¸¤ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆ: æ›´æ”¹getUserä»¥è¿”å›åŒ…å«ç½‘ç»œæ“ä½œçŠ¶æ€çš„LiveDataã€‚æä¾›äº†ä¸€ä¸ªç¤ºä¾‹å®ç°:é™„å½•:æš´éœ²ç½‘ç»œçŠ¶æ€ éƒ¨åˆ†ã€‚ åœ¨repositoryç±»ä¸­æä¾›å¦ä¸€ä¸ªpublicå‡½æ•°ï¼Œå¯ä»¥è¿”å›ç”¨æˆ·çš„åˆ·æ–°çŠ¶æ€ã€‚å¦‚æœæ‚¨æƒ³åœ¨UIä¸­æ˜¾ç¤ºç½‘ç»œçŠ¶æ€ï¼Œåªåœ¨å¯¹æ˜¾å¼çš„ç”¨æˆ·æ“ä½œ(å¦‚æ‹‰åˆ°åˆ·æ–°)çš„å“åº”ä¸­æ˜¾ç¤ºç½‘ç»œçŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å°±æ›´å¥½äº†ã€‚ å•ä¸€æ¥æºçš„çœŸç›¸ä¸åŒREST APIç«¯ç‚¹è¿”å›ç›¸åŒçš„æ•°æ®æ˜¯å¾ˆå¸¸è§çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„åç«¯æœ‰å¦ä¸€ä¸ªè¿”å›å¥½å‹åˆ—è¡¨çš„ç«¯ç‚¹ï¼Œé‚£ä¹ˆç›¸åŒçš„ç”¨æˆ·å¯¹è±¡å¯èƒ½æ¥è‡ªä¸¤ä¸ªä¸åŒçš„APIç«¯ç‚¹ï¼Œå¯èƒ½æ˜¯ä¸åŒçš„ç²’åº¦ã€‚å¦‚æœUserRepositoryæŒ‰åŸæ ·è¿”å›æ¥è‡ªWebserviceè¯·æ±‚çš„å“åº”ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„UIså¯èƒ½ä¼šæ˜¾ç¤ºä¸ä¸€è‡´çš„æ•°æ®ï¼Œå› ä¸ºæ•°æ®å¯èƒ½ä¼šåœ¨è¿™äº›è¯·æ±‚ä¹‹é—´çš„æœåŠ¡å™¨ç«¯å‘ç”Ÿå˜åŒ–ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨UserRepositoryå®ç°ä¸­ï¼ŒWebserviceå›è°ƒåªæ˜¯å°†æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ç„¶åï¼Œå¯¹æ•°æ®åº“çš„æ›´æ”¹å°†è§¦å‘å¯¹LiveDataå¯¹è±¡å›è°ƒçš„æ´»åŠ¨ã€‚ åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ•°æ®åº“ä½œä¸ºå”¯ä¸€çš„çœŸç†æ¥æºï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†é€šè¿‡å­˜å‚¨åº“è®¿é—®å®ƒã€‚ä¸ç®¡æ‚¨æ˜¯å¦ä½¿ç”¨ç£ç›˜ç¼“å­˜ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å°†å­˜å‚¨åº“æ•°æ®æºæŒ‡å®šä¸ºæ‚¨åº”ç”¨ç¨‹åºå…¶ä½™éƒ¨åˆ†çš„å”¯ä¸€æ¥æºã€‚ æµ‹è¯•æˆ‘ä»¬å·²ç»æåˆ°åˆ†ç¦»çš„å¥½å¤„ä¹‹ä¸€æ˜¯å¯æµ‹è¯•æ€§ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æµ‹è¯•æ¯ä¸ªä»£ç æ¨¡å—ã€‚ ç”¨æˆ·ç•Œé¢å’Œäº¤äº’: è¿™å°†æ˜¯ä½ å”¯ä¸€éœ€è¦Android UI Instrumentation testçš„æ—¶å€™ã€‚æµ‹è¯•UIä»£ç çš„æœ€ä½³æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªEspressoæµ‹è¯•ã€‚æ‚¨å¯ä»¥åˆ›å»ºfragmentå¹¶æä¾›ä¸€ä¸ªmock ViewModelã€‚ç”±äºfragmentåªä¸ViewModelè¿›è¡Œå¯¹è¯ï¼Œå› æ­¤å¯¹å…¶è¿›è¡Œæ¨¡æ‹Ÿå°†è¶³ä»¥å……åˆ†æµ‹è¯•æ­¤UIã€‚ ViewModel: å¯ä»¥ä½¿ç”¨JUnitå¯¹ViewModelè¿›è¡Œæµ‹è¯•ã€‚æ‚¨åªéœ€è¦æ¨¡æ‹ŸUserRepositoryæ¥æµ‹è¯•å®ƒã€‚ UserRepository: æ‚¨è¿˜å¯ä»¥ä½¿ç”¨JUnitæ¥æµ‹è¯•UserRepositoryã€‚æ‚¨éœ€è¦æ¨¡æ‹ŸWebserviceå’ŒDAOã€‚æ‚¨å¯ä»¥æµ‹è¯•å®ƒæ˜¯å¦æä¾›äº†æ­£ç¡®çš„Webserviceè°ƒç”¨ï¼Œå°†ç»“æœä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”å¦‚æœæ•°æ®è¢«ç¼“å­˜å’Œæ›´æ–°ï¼Œå°±ä¸ä¼šäº§ç”Ÿä»»ä½•ä¸å¿…è¦çš„è¯·æ±‚ã€‚ç”±äºWebserviceå’ŒUserDaoéƒ½æ˜¯æ¥å£ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥æ¨¡æ‹Ÿå®ƒä»¬ï¼Œæˆ–è€…ä¸ºæ›´å¤æ‚çš„æµ‹è¯•ç”¨ä¾‹åˆ›å»ºå‡çš„å®ç°ã€‚ UserDao: æµ‹è¯•DAOç±»çš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨instrumentationæµ‹è¯•ã€‚ç”±äºè¿™äº›instrumentationæµ‹è¯•ä¸éœ€è¦ä»»ä½•UIï¼Œæ‰€ä»¥å®ƒä»¬ä»ç„¶ä¼šè¿è¡Œå¾—å¾ˆå¿«ã€‚å¯¹äºæ¯ä¸€ä¸ªæµ‹è¯•ï¼Œæ‚¨éƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“ï¼Œä»¥ç¡®ä¿æµ‹è¯•æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨(æ¯”å¦‚æ›´æ”¹ç£ç›˜ä¸Šçš„æ•°æ®åº“æ–‡ä»¶)ã€‚ Roomè¿˜å…è®¸æŒ‡å®šæ•°æ®åº“å®ç°ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥é€šè¿‡æä¾›SupportSQLiteOpenHelperçš„JUnitå®ç°æ¥æµ‹è¯•å®ƒã€‚é€šå¸¸ä¸å»ºè®®é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºåœ¨è®¾å¤‡ä¸Šè¿è¡Œçš„SQLiteç‰ˆæœ¬å¯èƒ½ä¸ä¸»æœºä¸Šçš„SQLiteç‰ˆæœ¬ä¸åŒã€‚ Webservice: é‡è¦çš„æ˜¯è¦ä½¿æµ‹è¯•ç‹¬ç«‹äºå¤–éƒ¨ä¸–ç•Œï¼Œå› æ­¤å³ä½¿æ‚¨çš„Webserviceæµ‹è¯•ä¹Ÿåº”è¯¥é¿å…å¯¹åç«¯è¿›è¡Œç½‘ç»œè°ƒç”¨ã€‚æœ‰å¾ˆå¤šåº“å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒMockWebServeræ˜¯ä¸€ä¸ªå¾ˆæ£’çš„åº“ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ‚¨ä¸ºæµ‹è¯•åˆ›å»ºä¸€ä¸ªå‡çš„æœ¬åœ°æœåŠ¡å™¨ã€‚ æµ‹è¯•å·¥ä»¶: æ¶æ„ç»„ä»¶æä¾›äº†ä¸€ä¸ªmavenå·¥ä»¶æ¥æ§åˆ¶å®ƒçš„åå°çº¿ç¨‹ã€‚åœ¨android.arch.core:core-testingå·¥ä»¶ï¼Œæœ‰ä¸¤ä¸ªJUnitè§„åˆ™: InstantTaskExecutorRule: æ­¤è§„åˆ™å¯ç”¨äºå¼ºåˆ¶ä½“ç³»ç»“æ„ç»„ä»¶ç«‹å³æ‰§è¡Œè°ƒç”¨çº¿ç¨‹ä¸Šçš„ä»»ä½•åå°æ“ä½œã€‚ CountingTaskExecutorRule: è¿™ä¸ªè§„åˆ™å¯ä»¥åœ¨instrumentationæµ‹è¯•ä¸­ä½¿ç”¨ï¼Œç­‰å¾…æ¶æ„ç»„ä»¶çš„åå°æ“ä½œï¼Œæˆ–è€…å°†å®ƒä½œä¸ºä¸€ä¸ªç©ºé—²çš„èµ„æºè¿æ¥åˆ°Espressoã€‚ æœ€ç»ˆçš„æ¶æ„ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬æ¨èçš„ä½“ç³»ç»“æ„ä¸­çš„æ‰€æœ‰æ¨¡å—ä»¥åŠå®ƒä»¬ä¹‹é—´çš„äº¤äº’æ–¹å¼: æŒ‡å¯¼åŸåˆ™ç¼–ç¨‹æ˜¯ä¸€ä¸ªæœ‰åˆ›æ„çš„é¢†åŸŸï¼Œå¼€å‘Androidåº”ç”¨ä¹Ÿä¸æ˜¯ä¸€ä¸ªä¾‹å¤–ã€‚è§£å†³ä¸€ä¸ªé—®é¢˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚åœ¨å¤šä¸ªactivitiesæˆ–fragmentsä¹‹é—´é€šä¿¡æ•°æ®ï¼Œæ£€ç´¢è¿œç¨‹æ•°æ®ï¼Œå¹¶åœ¨æœ¬åœ°è¿›è¡Œè„±æœºæ¨¡å¼ï¼Œæˆ–è€…å…¶ä»–ä¸€äº›å¸¸è§çš„åº”ç”¨ç¨‹åºé‡åˆ°çš„å…¶ä»–å¸¸è§åœºæ™¯ã€‚ è™½ç„¶ä¸‹é¢çš„å»ºè®®ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æ˜¯æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œä»é•¿è¿œæ¥çœ‹ï¼Œéµå¾ªè¿™äº›å»ºè®®å°†ä½¿æ‚¨çš„ä»£ç åŸºç¡€æ›´åŠ å¥å£®ã€å¯æµ‹è¯•å’Œå¯ç»´æŠ¤ã€‚ åœ¨æ¸…å•ä¸­å®šä¹‰çš„å…¥å£ç‚¹ â€” activitiesã€servicesã€broadcast receiversç­‰ â€” ä¸æ˜¯æ•°æ®çš„æ¥æºã€‚ç›¸åï¼Œå®ƒä»¬åº”è¯¥åªåè°ƒä¸è¯¥å…¥å£ç‚¹ç›¸å…³çš„æ•°æ®å­é›†ã€‚ç”±äºæ¯ä¸ªåº”ç”¨ç¨‹åºç»„ä»¶éƒ½å¾ˆçŸ­ï¼Œå–å†³äºç”¨æˆ·ä¸è®¾å¤‡çš„äº¤äº’ä»¥åŠè¿è¡Œæ—¶çš„æ•´ä½“å¥åº·çŠ¶å†µï¼Œæ‰€ä»¥æ‚¨ä¸å¸Œæœ›è¿™äº›å…¥å£ç‚¹æˆä¸ºæ•°æ®çš„æ¥æºã€‚ æ— æƒ…åœ°åœ¨ä½ çš„åº”ç”¨ç¨‹åºçš„ä¸åŒæ¨¡å—ä¹‹é—´åˆ›å»ºæ˜ç¡®çš„è´£ä»»ç•Œé™ã€‚ä¾‹å¦‚ï¼Œä¸è¦å°†ä»£ç ä»ç½‘ç»œä¸­è·¨å¤šä¸ªç±»æˆ–åŒ…åŠ è½½åˆ°æ‚¨çš„ä»£ç åº“ä¸­ã€‚ç±»ä¼¼åœ°ï¼Œä¸è¦æŠŠä¸ç›¸å…³çš„èŒè´£â€”â€”æ¯”å¦‚æ•°æ®ç¼“å­˜å’Œæ•°æ®ç»‘å®šâ€”â€”æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ã€‚ å°½å¯èƒ½å°‘åœ°æš´éœ²äºæ¯ä¸ªæ¨¡å—ã€‚ä¸è¦è¯•å›¾åˆ›å»ºä¸€ä¸ªä»ä¸€ä¸ªæ¨¡å—ä¸­æš´éœ²å†…éƒ¨å®ç°ç»†èŠ‚çš„â€œåªæœ‰é‚£ä¸ªâ€çš„å¿«æ·æ–¹å¼ã€‚ä½ å¯èƒ½ä¼šåœ¨çŸ­æœŸå†…è·å¾—ä¸€äº›æ—¶é—´ï¼Œä½†éšç€ä»£ç åº“çš„ä¸æ–­å‘å±•ï¼Œä½ å°†ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´æ¥æ”¯ä»˜æŠ€æœ¯å€ºåŠ¡ã€‚ å½“æ‚¨å®šä¹‰æ¨¡å—ä¹‹é—´çš„äº¤äº’æ—¶ï¼Œè¯·è€ƒè™‘å¦‚ä½•ä½¿æ¯ä¸ªæ¨¡å—ç‹¬ç«‹åœ°è¿›è¡Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„APIä»ç½‘ç»œä¸­è·å–æ•°æ®ï¼Œè¿™å°†ä½¿æµ‹è¯•åœ¨æœ¬åœ°æ•°æ®åº“ä¸­æŒä¹…å­˜å‚¨æ•°æ®çš„æ¨¡å—å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ç›¸åï¼Œå¦‚æœæ‚¨å°†è¿™ä¸¤ä¸ªæ¨¡å—çš„é€»è¾‘æ··åˆåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ–è€…å°†æ‚¨çš„ç½‘ç»œä»£ç æ´’åœ¨æ•´ä¸ªä»£ç åº“ä¸­ï¼Œé‚£ä¹ˆè¦è¿›è¡Œæµ‹è¯•å°†ä¼šå›°éš¾å¾—å¤šã€‚ ä½ çš„åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒæ˜¯è®©å®ƒè„±é¢–è€Œå‡ºçš„åŸå› ã€‚ä¸è¦æŠŠæ—¶é—´èŠ±åœ¨é‡æ–°å‘æ˜è½®å­ä¸Šï¼Œæˆ–è€…ä¸€æ¬¡åˆä¸€æ¬¡åœ°ç¼–å†™ç›¸åŒçš„æ ·æ¿ä»£ç ã€‚ç›¸åï¼ŒæŠŠä½ çš„ç²¾åŠ›é›†ä¸­åœ¨è®©ä½ çš„åº”ç”¨ç‹¬ä¸€æ— äºŒçš„ä¸œè¥¿ä¸Šï¼Œè®©Androidæ¶æ„ç»„ä»¶å’Œå…¶ä»–æ¨èçš„åº“å¤„ç†é‡å¤çš„æ ·æ¿æ–‡ä»¶ã€‚ ä¿æŒå°½å¯èƒ½å¤šçš„ç›¸å…³å’Œæ–°é²œçš„æ•°æ®ï¼Œè¿™æ ·å½“è®¾å¤‡å¤„äºè„±æœºçŠ¶æ€æ—¶ï¼Œä½ çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨äº†ã€‚è™½ç„¶ä½ å¯èƒ½å–œæ¬¢æŒç»­çš„é«˜é€Ÿè¿æ¥ï¼Œä½†ä½ çš„ç”¨æˆ·å¯èƒ½ä¸ä¼šã€‚ æ‚¨çš„repositoryåº”è¯¥æŒ‡å®šä¸€ä¸ªæ•°æ®æºä½œä¸ºäº‹å®çš„å•ä¸€æ¥æºã€‚å½“ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®è¿™æ®µæ•°æ®æ—¶ï¼Œå®ƒåº”è¯¥æ€»æ˜¯æ¥è‡ªäºå•ä¸€çš„çœŸç›¸æ¥æºã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å•ä¸€æ¥æºçš„çœŸç›¸ã€‚ é™„å½•:æš´éœ²ç½‘ç»œçŠ¶æ€åœ¨ä¸Šé¢æ¨èåº”ç”¨æ¶æ„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ•…æ„çœç•¥äº†ç½‘ç»œé”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥ä¿æŒç¤ºä¾‹çš„ç®€å•æ€§ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Resourceç±»å…¬å¼€ç½‘ç»œçŠ¶æ€ï¼Œä»¥å°è£…æ•°æ®åŠå…¶çŠ¶æ€ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹å®ç°: 1234567891011121314151617181920212223//æè¿°å…·æœ‰çŠ¶æ€çš„æ•°æ®çš„æ³›å‹ç±»public class Resource&lt;T&gt; &#123; @NonNull public final Status status; @Nullable public final T data; @Nullable public final String message; private Resource(@NonNull Status status, @Nullable T data, @Nullable String message) &#123; this.status = status; this.data = data; this.message = message; &#125; public static &lt;T&gt; Resource&lt;T&gt; success(@NonNull T data) &#123; return new Resource&lt;&gt;(SUCCESS, data, null); &#125; public static &lt;T&gt; Resource&lt;T&gt; error(String msg, @Nullable T data) &#123; return new Resource&lt;&gt;(ERROR, data, msg); &#125; public static &lt;T&gt; Resource&lt;T&gt; loading(@Nullable T data) &#123; return new Resource&lt;&gt;(LOADING, data, null); &#125;&#125; å› ä¸ºä»ç½‘ç»œä¸­åŠ è½½æ•°æ®æ˜¯ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŠ©æ‰‹ç±»NetworkBoundResourceï¼Œå®ƒå¯ä»¥åœ¨å¤šä¸ªä½ç½®é‡ç”¨ã€‚ä¸‹é¢æ˜¯NetworkBoundResourceçš„å†³ç­–æ ‘: å®ƒé¦–å…ˆé€šè¿‡å¯¹resourceçš„æ•°æ®åº“è¿›è¡Œè§‚å¯Ÿã€‚å½“ç¬¬ä¸€æ¬¡ä»æ•°æ®åº“åŠ è½½æ¡ç›®æ—¶ï¼ŒNetworkBoundResourceä¼šæ£€æŸ¥ç»“æœæ˜¯å¦è¶³å¤Ÿå¥½ï¼Œæ˜¯å¦å¯ä»¥ä»ç½‘ç»œä¸­è·å–ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½å¯èƒ½åŒæ—¶å‘ç”Ÿï¼Œå› ä¸ºæ‚¨å¯èƒ½æƒ³è¦åœ¨ä»ç½‘ç»œä¸­æ›´æ–°ç¼“å­˜æ•°æ®åŒæ—¶æ˜¾ç¤ºç¼“å­˜çš„æ•°æ® å¦‚æœç½‘ç»œè°ƒç”¨æˆåŠŸå®Œæˆï¼Œå®ƒä¼šå°†å“åº”ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶é‡æ–°åˆå§‹åŒ–æµã€‚å¦‚æœç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬å°†ç›´æ¥å‘é€å¤±è´¥ã€‚ æ³¨æ„:åœ¨å°†æ–°æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¹‹åï¼Œæˆ‘ä»¬å°†ä»æ•°æ®åº“é‡æ–°åˆå§‹åŒ–æµï¼Œä½†æ˜¯é€šå¸¸æˆ‘ä»¬ä¸éœ€è¦è¿™æ ·åšï¼Œå› ä¸ºæ•°æ®åº“å°†ä¼šåˆ†æ´¾æ›´æ”¹ã€‚å¦ä¸€æ–¹é¢ï¼Œä¾èµ–äºæ•°æ®åº“æ¥è°ƒåº¦æ›´æ”¹å°†ä¾èµ–äºä¸å¥½çš„å‰¯ä½œç”¨ï¼Œå› ä¸ºå¦‚æœæ•°æ®åº“èƒ½å¤Ÿé¿å…åœ¨æ•°æ®æ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹å‘é€æ›´æ”¹ï¼Œåˆ™å¯èƒ½ä¼šä¸­æ–­ã€‚æˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›å°†æ¥è‡ªç½‘ç»œçš„ç»“æœå‘é€å‡ºå»ï¼Œå› ä¸ºè¿™å°†ä¸å•ä¸€çš„çœŸç›¸æ¥æºç›¸è¿èƒŒ(ä¹Ÿè®¸æ•°æ®åº“ä¸­æœ‰ä¸€äº›è§¦å‘å™¨å°†æ”¹å˜ä¿å­˜çš„å€¼)ã€‚æˆ‘ä»¬ä¹Ÿä¸æƒ³åœ¨æ²¡æœ‰æ–°æ•°æ®çš„æƒ…å†µä¸‹åˆ†æ´¾SUCCESSï¼Œå› ä¸ºå®ƒä¼šå‘å®¢æˆ·å‘é€é”™è¯¯çš„ä¿¡æ¯ã€‚ ä¸‹é¢æ˜¯NetworkBoundResourceç±»ä¸ºå…¶å­©å­æä¾›çš„å…¬å…±APIï¼š 123456789101112131415161718192021222324252627// ResultType: Resourceæ•°æ®ç±»å‹// RequestType: API responseç±»å‹public abstract class NetworkBoundResource&lt;ResultType, RequestType&gt; &#123; // è°ƒç”¨å°†APIå“åº”çš„ç»“æœä¿å­˜åˆ°æ•°æ®åº“ä¸­ @WorkerThread protected abstract void saveCallResult(@NonNull RequestType item); // è°ƒç”¨æ•°æ®åº“ä¸­çš„æ•°æ®æ¥å†³å®šæ˜¯å¦åº”è¯¥ä»ç½‘ç»œä¸­è·å–æ•°æ®ã€‚ @MainThread protected abstract boolean shouldFetch(@Nullable ResultType data); // è°ƒç”¨ä»æ•°æ®åº“ä¸­è·å–ç¼“å­˜çš„æ•°æ® @NonNull @MainThread protected abstract LiveData&lt;ResultType&gt; loadFromDb(); // åˆ›å»ºAPIè°ƒç”¨. @NonNull @MainThread protected abstract LiveData&lt;ApiResponse&lt;RequestType&gt;&gt; createCall(); // fetchå¤±è´¥æ—¶ã€‚å­ç±»å¯èƒ½å¸Œæœ›é‡æ–°è®¾ç½®è¯¸å¦‚é€Ÿç‡é™åˆ¶å™¨ä¹‹ç±»çš„ç»„ä»¶ @MainThread protected void onFetchFailed() &#123; &#125; // è¿”å›ä¸€ä¸ªä»£è¡¨resourceçš„LiveDataï¼Œåœ¨åŸºç±»ä¸­å®ç° public final LiveData&lt;Resource&lt;ResultType&gt;&gt; getAsLiveData();&#125; æ³¨æ„ï¼Œä¸Šé¢çš„ç±»å®šä¹‰äº†ä¸¤ä¸ªç±»å‹å‚æ•°(ResultTypeï¼ŒRequestType)ï¼Œå› ä¸ºä»APIè¿”å›çš„æ•°æ®ç±»å‹å¯èƒ½ä¸æœ¬åœ°ä½¿ç”¨çš„æ•°æ®ç±»å‹ä¸åŒ¹é…ã€‚ è¿˜è¦æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†ç½‘ç»œè¯·æ±‚çš„ApiResponseã€‚ApiResponseæ˜¯ä¸€ä¸ªå›´ç»•Retrofit2.Callç±»çš„ç®€å•åŒ…è£…å™¨ï¼Œç”¨äºå°†å…¶å“åº”è½¬æ¢ä¸ºLiveDataã€‚ ä¸‹é¢æ˜¯NetworkBoundResourceç±»çš„å…¶ä½™å®ç°: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public abstract class NetworkBoundResource&lt;ResultType, RequestType&gt; &#123; private final MediatorLiveData&lt;Resource&lt;ResultType&gt;&gt; result = new MediatorLiveData&lt;&gt;(); @MainThread NetworkBoundResource() &#123; result.setValue(Resource.loading(null)); LiveData&lt;ResultType&gt; dbSource = loadFromDb(); result.addSource(dbSource, data -&gt; &#123; result.removeSource(dbSource); if (shouldFetch(data)) &#123; fetchFromNetwork(dbSource); &#125; else &#123; result.addSource(dbSource, newData -&gt; result.setValue(Resource.success(newData))); &#125; &#125;); &#125; private void fetchFromNetwork(final LiveData&lt;ResultType&gt; dbSource) &#123; LiveData&lt;ApiResponse&lt;RequestType&gt;&gt; apiResponse = createCall(); // æˆ‘ä»¬å°†dbSourceä½œä¸ºæ–°çš„æºé‡æ–°è¿æ¥, // å®ƒå°†å¾ˆå¿«åœ°å‘å¸ƒæœ€æ–°çš„ä»·å€¼ result.addSource(dbSource, newData -&gt; result.setValue(Resource.loading(newData))); result.addSource(apiResponse, response -&gt; &#123; result.removeSource(apiResponse); result.removeSource(dbSource); //noinspection ConstantConditions if (response.isSuccessful()) &#123; saveResultAndReInit(response); &#125; else &#123; onFetchFailed(); result.addSource(dbSource, newData -&gt; result.setValue( Resource.error(response.errorMessage, newData))); &#125; &#125;); &#125; @MainThread private void saveResultAndReInit(ApiResponse&lt;RequestType&gt; response) &#123; new AsyncTask&lt;Void, Void, Void&gt;() &#123; @Override protected Void doInBackground(Void... voids) &#123; saveCallResult(response.body); return null; &#125; @Override protected void onPostExecute(Void aVoid) &#123; // we specially request a new live data, // otherwise we will get immediately last cached value, // which may not be updated with latest results received from network. result.addSource(loadFromDb(), newData -&gt; result.setValue(Resource.success(newData))); &#125; &#125;.execute(); &#125; public final LiveData&lt;Resource&lt;ResultType&gt;&gt; getAsLiveData() &#123; return result; &#125;&#125; ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨NetworkBoundResourceæ¥åœ¨å­˜å‚¨åº“ä¸­ç¼–å†™ç£ç›˜å’Œç½‘ç»œç»‘å®šç”¨æˆ·å®ç°ã€‚ 12345678910111213141516171819202122232425262728class UserRepository &#123; Webservice webservice; UserDao userDao; public LiveData&lt;Resource&lt;User&gt;&gt; loadUser(final String userId) &#123; return new NetworkBoundResource&lt;User,User&gt;() &#123; @Override protected void saveCallResult(@NonNull User item) &#123; userDao.insert(item); &#125; @Override protected boolean shouldFetch(@Nullable User data) &#123; return rateLimiter.canFetch(userId) &amp;&amp; (data == null || !isFresh(data)); &#125; @NonNull @Override protected LiveData&lt;User&gt; loadFromDb() &#123; return userDao.load(userId); &#125; @NonNull @Override protected LiveData&lt;ApiResponse&lt;User&gt;&gt; createCall() &#123; return webservice.getUser(userId); &#125; &#125;.getAsLiveData(); &#125;&#125;","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"Android æ¶æ„ç»„ä»¶ç®€ä»‹","slug":"AndroidArchitectectureComponents","date":"2017-11-08T01:35:45.000Z","updated":"2020-07-25T02:57:18.147Z","comments":true,"path":"2017/11/08/AndroidArchitectectureComponents/","link":"","permalink":"https://jigangduan.github.io/2017/11/08/AndroidArchitectectureComponents/","excerpt":"","text":"ä¸€ç»„å¸®åŠ©æ‚¨è®¾è®¡å¥å£®çš„ã€å¯æµ‹è¯•çš„å’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºåº“ã€‚ç®¡ç†UIç»„ä»¶ç”Ÿå‘½å‘¨æœŸå’Œå¤„ç†æ•°æ®æŒä¹…æ€§ã€‚ åº”ç”¨æ¶æ„æŒ‡å— æ·»åŠ ç»„ä»¶åˆ°ä½ çš„é¡¹ç›® ä½¿ç”¨Lifecycleç»„ä»¶æ¥å¤„ç†ç”Ÿå‘½å‘¨æœŸ LiveData ViewModel ä¿å­˜UIçŠ¶æ€ RoomæŒä¹…æ€§åº“ åˆ†é¡µåº“ è½»æ¾ç®¡ç†appçš„ç”Ÿå‘½å‘¨æœŸæ–°çš„lifecycleç»„ä»¶æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å¸®åŠ©æ‚¨ç®¡ç†æ‚¨çš„æ´»åŠ¨å’Œç‰‡æ®µç”Ÿå‘½å‘¨æœŸã€‚ä¿å­˜é…ç½®æ›´æ”¹ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼Œå¹¶ä½¿ç”¨LiveDataã€ViewModelã€LifecycleObserverå’ŒLifecycleOwnerï¼Œè½»æ¾åœ°å°†æ•°æ®åŠ è½½åˆ°UIä¸­ã€‚ è¯•ä¸€è¯•codelab æŸ¥çœ‹æ–‡æ¡£ è·å¾—ç¤ºä¾‹é¡¹ç›® Room:SQLiteå¯¹è±¡æ˜ å°„åº“ä½¿ç”¨Room é¿å…ä½¿ç”¨æ ·æ¿ä»£ç ï¼Œå¹¶è½»æ¾åœ°å°†SQLiteè¡¨æ•°æ®è½¬æ¢ä¸ºJavaå¯¹è±¡ã€‚Roomæä¾›äº†SQLiteè¯­å¥çš„ç¼–è¯‘æ—¶é—´æ£€æŸ¥ï¼Œå¹¶å¯ä»¥è¿”å›RxJavaã€Flowableå’ŒLiveData observablesã€‚ è¯•ä¸€è¯•codelab æŸ¥çœ‹æ–‡æ¡£ è·å¾—ç¤ºä¾‹é¡¹ç›®","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"}]},{"title":"ä½¿ç”¨åç¨‹çš„UIç¼–ç¨‹æŒ‡å—","slug":"GuideUIProgrammingCoroutines","date":"2017-11-06T11:08:01.000Z","updated":"2020-07-25T02:57:18.152Z","comments":true,"path":"2017/11/06/GuideUIProgrammingCoroutines/","link":"","permalink":"https://jigangduan.github.io/2017/11/06/GuideUIProgrammingCoroutines/","excerpt":"æœ¬æŒ‡å—å‡å®šè¯»è€…ç†Ÿæ‚‰åŸºæœ¬çš„åç¨‹æ¦‚å¿µï¼Œå¹¶ç»™å‡ºäº†åœ¨UIåº”ç”¨ç¨‹åºä¸­å¦‚ä½•ä½¿ç”¨kotlinx.coroutinesçš„å…·ä½“ç¤ºä¾‹ã€‚ æ‰€æœ‰çš„UIåº”ç”¨ç¨‹åºåº“éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ã€‚å®ƒä»¬æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰UIçš„çŠ¶æ€éƒ½è¢«é™åˆ¶ï¼Œæ‰€æœ‰çš„UIæ›´æ–°éƒ½å¿…é¡»åœ¨è¿™ä¸ªç‰¹å®šçš„çº¿ç¨‹ä¸­å‘ç”Ÿã€‚å¯¹äºåç¨‹ï¼Œè¿™æ„å‘³ç€æ‚¨éœ€è¦ä¸€ä¸ªé€‚å½“çš„åç¨‹åˆ†æ´¾å™¨ä¸Šä¸‹æ–‡ï¼Œå®ƒå°†åç¨‹æ‰§è¡Œé™åˆ¶åœ¨è¿™ä¸ªUIçº¿ç¨‹ä¸­ã€‚ ç‰¹åˆ«æ˜¯ï¼Œkotlinx.coroutines æœ‰ä¸‰ä¸ªæ¨¡å—ä¸ºä¸åŒçš„UIåº”ç”¨ç¨‹åºåº“æä¾›äº†åç¨‹ä¸Šä¸‹æ–‡: kotlinx-coroutines-android â€“ Androidåº”ç”¨ç¨‹åºçš„UIä¸Šä¸‹æ–‡ kotlinx-coroutines-javafx â€“ JavaFx UIåº”ç”¨ç¨‹åºçš„JavaFxä¸Šä¸‹æ–‡ kotlinx-coroutines-swing â€“ Swing UIåº”ç”¨ç¨‹åºçš„Swingä¸Šä¸‹æ–‡ è¿™ä¸ªæŒ‡å—åŒæ—¶æ¶µç›–äº†æ‰€æœ‰çš„UIåº“ï¼Œå› ä¸ºæ¯ä¸ªæ¨¡å—åªåŒ…å«ä¸€ä¸ªå¯¹è±¡å®šä¹‰ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å®šä¹‰åªæœ‰å‡ é¡µé•¿ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªä½œä¸ºç¤ºä¾‹ï¼Œä¸ºæ‚¨æœ€å–œæ¬¢çš„UIåº“ç¼–å†™ç›¸åº”çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå³ä½¿å®ƒæ²¡æœ‰åŒ…å«åœ¨è¿™ä¸ªæ¡†ä¸­","text":"æœ¬æŒ‡å—å‡å®šè¯»è€…ç†Ÿæ‚‰åŸºæœ¬çš„åç¨‹æ¦‚å¿µï¼Œå¹¶ç»™å‡ºäº†åœ¨UIåº”ç”¨ç¨‹åºä¸­å¦‚ä½•ä½¿ç”¨kotlinx.coroutinesçš„å…·ä½“ç¤ºä¾‹ã€‚ æ‰€æœ‰çš„UIåº”ç”¨ç¨‹åºåº“éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ã€‚å®ƒä»¬æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰UIçš„çŠ¶æ€éƒ½è¢«é™åˆ¶ï¼Œæ‰€æœ‰çš„UIæ›´æ–°éƒ½å¿…é¡»åœ¨è¿™ä¸ªç‰¹å®šçš„çº¿ç¨‹ä¸­å‘ç”Ÿã€‚å¯¹äºåç¨‹ï¼Œè¿™æ„å‘³ç€æ‚¨éœ€è¦ä¸€ä¸ªé€‚å½“çš„åç¨‹åˆ†æ´¾å™¨ä¸Šä¸‹æ–‡ï¼Œå®ƒå°†åç¨‹æ‰§è¡Œé™åˆ¶åœ¨è¿™ä¸ªUIçº¿ç¨‹ä¸­ã€‚ ç‰¹åˆ«æ˜¯ï¼Œkotlinx.coroutines æœ‰ä¸‰ä¸ªæ¨¡å—ä¸ºä¸åŒçš„UIåº”ç”¨ç¨‹åºåº“æä¾›äº†åç¨‹ä¸Šä¸‹æ–‡: kotlinx-coroutines-android â€“ Androidåº”ç”¨ç¨‹åºçš„UIä¸Šä¸‹æ–‡ kotlinx-coroutines-javafx â€“ JavaFx UIåº”ç”¨ç¨‹åºçš„JavaFxä¸Šä¸‹æ–‡ kotlinx-coroutines-swing â€“ Swing UIåº”ç”¨ç¨‹åºçš„Swingä¸Šä¸‹æ–‡ è¿™ä¸ªæŒ‡å—åŒæ—¶æ¶µç›–äº†æ‰€æœ‰çš„UIåº“ï¼Œå› ä¸ºæ¯ä¸ªæ¨¡å—åªåŒ…å«ä¸€ä¸ªå¯¹è±¡å®šä¹‰ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å®šä¹‰åªæœ‰å‡ é¡µé•¿ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªä½œä¸ºç¤ºä¾‹ï¼Œä¸ºæ‚¨æœ€å–œæ¬¢çš„UIåº“ç¼–å†™ç›¸åº”çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå³ä½¿å®ƒæ²¡æœ‰åŒ…å«åœ¨è¿™ä¸ªæ¡†ä¸­ ç›®å½• è®¾ç½® JavaFx Android åŸºæœ¬çš„UIåç¨‹ å¯åŠ¨UIåç¨‹ å–æ¶ˆUIåç¨‹ åœ¨UIä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å‚ä¸è€… æ‰©å±•åç¨‹ æœ€å¤šåç¨‹job äº‹ä»¶åˆå¹¶ é˜»å¡æ“ä½œ UIå†»ç»“çš„é—®é¢˜ é˜»å¡æ“ä½œ é«˜çº§çš„ä¸»é¢˜ ç”Ÿå‘½å‘¨æœŸå’Œåç¨‹çˆ¶å­å±‚æ¬¡ç»“æ„ åœ¨æ²¡æœ‰åˆ†æ´¾çš„æƒ…å†µä¸‹ï¼Œåœ¨UIäº‹ä»¶å¤„ç†ç¨‹åºä¸­å¯åŠ¨åç¨‹ è®¾ç½®æœ¬æŒ‡å—ä¸­çš„å¯è¿è¡Œç¤ºä¾‹æ˜¯ä¸ºJavaFxæä¾›çš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ‰€æœ‰çš„ç¤ºä¾‹éƒ½å¯ä»¥ç›´æ¥åœ¨ä»»ä½•OSä¸Šå¯åŠ¨ï¼Œè€Œä¸éœ€è¦æ¨¡æ‹Ÿå™¨æˆ–ç±»ä¼¼çš„æ“ä½œï¼Œè€Œä¸”å®ƒä»¬æ˜¯å®Œå…¨è‡ªåŒ…å«çš„(æ¯ä¸ªç¤ºä¾‹éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­)ã€‚å¯¹äºéœ€è¦åœ¨Androidä¸Šè¿›è¡Œå¤åˆ¶(å¦‚æœæœ‰çš„è¯)éœ€è¦åšä»€ä¹ˆæ”¹å˜ï¼Œæœ‰ä¸€äº›å•ç‹¬çš„æ³¨é‡Šã€‚ JavaFxJavaFxçš„åŸºæœ¬ç¤ºä¾‹åº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªçª—å£ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸ºhelloçš„æ–‡æœ¬æ ‡ç­¾ï¼Œå®ƒæœ€åˆåŒ…å«â€œhello Worldï¼â€åœ¨å³ä¸‹è§’çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªç²‰çº¢è‰²çš„åœ†åœˆå‘½åä¸ºfab(æµ®åŠ¨æ“ä½œæŒ‰é’®) JavaFXåº”ç”¨ç¨‹åºçš„startå‡½æ•°è°ƒç”¨setupå‡½æ•°ï¼Œå°†å…¶å¼•ç”¨ä¼ é€’ç»™helloå’ŒfabèŠ‚ç‚¹ã€‚è¿™å°±æ˜¯åœ¨æœ¬æŒ‡å—çš„å…¶ä»–éƒ¨åˆ†ä¸­æ”¾ç½®å„ç§ä»£ç çš„åœ°æ–¹: 123fun setup(hello: Text, fab: Circle) &#123; // placeholder&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æ‚¨å¯ä»¥ä»GitHubä¸Šå¤åˆ¶kotlinx.coroutinesé¡¹ç›®åˆ°æ‚¨çš„å·¥ä½œç«™ï¼Œå¹¶åœ¨IDEä¸­æ‰“å¼€é¡¹ç›®ã€‚æœ¬æŒ‡å—çš„æ‰€æœ‰ç¤ºä¾‹éƒ½åœ¨ui/kotlinx-coroutinjavafx-javafxæ¨¡å—çš„æµ‹è¯•æ–‡ä»¶å¤¹ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å°†èƒ½å¤Ÿè¿è¡Œå¹¶æŸ¥çœ‹æ¯ä¸ªç¤ºä¾‹çš„å·¥ä½œæ–¹å¼ï¼Œå¹¶é€šè¿‡è¿›è¡Œæ›´æ”¹æ¥è¿›è¡Œè¯•éªŒã€‚ AndroidæŒ‰ç…§Androidå’ŒKotlinçš„å…¥é—¨æŒ‡å¯¼ï¼Œåœ¨Android Studioä¸­åˆ›å»ºKotliné¡¹ç›®ã€‚æ‚¨è¿˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ Kotlin Androidæ‰©å±•ã€‚ åœ¨Android Studio 2.3ä¸­ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªä¸ä¸‹å›¾ç›¸ä¼¼çš„åº”ç”¨ç¨‹åº: è½¬åˆ°åº”ç”¨ç¨‹åºçš„context_main.xmlï¼Œå¹¶å°†â€œhelloâ€çš„IDåˆ†é…ç»™text viewï¼Œâ€œhello Worldï¼â€stringï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨ä½ çš„åº”ç”¨ä¸­ä½œä¸ºhelloï¼Œä¸Kotlin Androidæ‰©å±•ä¸€èµ·ä½¿ç”¨ã€‚åœ¨åˆ›å»ºçš„é¡¹ç›®æ¨¡æ¿ä¸­ï¼Œç²‰çº¢è‰²çš„æµ®åŠ¨æ“ä½œæŒ‰é’®å·²ç»è¢«å‘½åä¸ºfabã€‚ åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºçš„MainActivity.ktä¸­ï¼Œåˆ é™¤äº†å—fab.setOnClickListener { ... }ï¼Œå¹¶å°†setup(helloï¼Œfab)è°ƒç”¨æ·»åŠ ä¸ºonCreateå‡½æ•°çš„æœ€åä¸€è¡Œã€‚åœ¨æ–‡ä»¶çš„æœ«å°¾åˆ›å»ºä¸€ä¸ªå ä½ç¬¦è®¾ç½®å‡½æ•°ã€‚è¿™å°±æ˜¯åœ¨æœ¬æŒ‡å—çš„å…¶ä»–éƒ¨åˆ†ä¸­æ”¾ç½®å„ç§ä»£ç çš„åœ°æ–¹: 123fun setup(hello: TextView, fab: FloatingActionButton) &#123; // placeholder&#125; å°†å¯¹kotlinx-coroutines-androidæ¨¡å—çš„ä¾èµ–å…³ç³»æ·»åŠ åˆ°app/build.gradleæ–‡ä»¶çš„dependencies { â€¦ } éƒ¨åˆ†: 1compile &quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:0.19.3&quot; åç¨‹æ˜¯Kotlinçš„å®éªŒç‰¹å¾ã€‚æ‚¨éœ€è¦åœ¨Kotlinç¼–è¯‘å™¨ä¸­å¯ç”¨åç¨‹ï¼Œå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°gradle.propertiesæ–‡ä»¶: 1kotlin.coroutines=enable æ‚¨å¯ä»¥ä»GitHubä¸Šå…‹éš†kotlinx.coroutinesé¡¹ç›®åˆ°æ‚¨çš„å·¥ä½œç«™ã€‚Androidçš„æœ€ç»ˆæ¨¡æ¿é¡¹ç›®æ˜¯åœ¨ui/kotlinx-coroutines-android/exam-appç›®å½•ä¸­ã€‚ä½ å¯ä»¥åœ¨Android Studioä¸­åŠ è½½å®ƒï¼Œä»¥éµå¾ªAndroidçš„è¿™ä¸ªæŒ‡å—ã€‚ åŸºæœ¬çš„UIåç¨‹æœ¬èŠ‚å±•ç¤ºäº†åœ¨UIåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨åç¨‹çš„åŸºæœ¬ç”¨æ³•ã€‚ å¯åŠ¨UIåç¨‹kotlinx-coroutines- JavaFxæ¨¡å—åŒ…å«JavaFxä¸Šä¸‹æ–‡ï¼Œå®ƒå°†åç¨‹æ‰§è¡Œåˆ†æ´¾ç»™JavaFxåº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚æˆ‘ä»¬å°†å…¶å¯¼å…¥ä¸ºUIï¼Œä»¥ä½¿æ‰€æœ‰ç¤ºä¾‹æ˜“äºç§»æ¤åˆ°Android: 1import kotlinx.coroutines.experimental.javafx.JavaFx as UI è¢«é™åˆ¶åœ¨UIçº¿ç¨‹çš„åç¨‹å¯ä»¥è‡ªç”±åœ°åœ¨UIä¸­æ›´æ–°ä»»ä½•ä¸œè¥¿ï¼Œå¹¶åœ¨ä¸é˜»å¡UIçº¿ç¨‹çš„æƒ…å†µä¸‹æŒ‚èµ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‘½ä»¤å¼çš„æ–¹å¼ç¼–å†™åŠ¨ç”»ã€‚ä»¥ä¸‹ä»£ç ä»¥æ¯ç§’10åˆ°1ç§’çš„æ—¶é—´æ›´æ–°æ–‡æœ¬ï¼Œä½¿ç”¨launch åç¨‹æ„å»ºå™¨: 123456789fun setup(hello: Text, fab: Circle) &#123; launch(UI) &#123; // launch coroutine in UI context for (i in 10 downTo 1) &#123; // countdown from 10 to 1 hello.text = \"Countdown $i ...\" // update text delay(500) // wait half a second &#125; hello.text = \"Done!\" &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æ‰€ä»¥,è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ?å› ä¸ºæˆ‘ä»¬åœ¨UIä¸Šä¸‹æ–‡ä¸­å¯åŠ¨äº†åç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªåç¨‹ä¸­è‡ªç”±åœ°æ›´æ–°UIï¼Œå¹¶è°ƒç”¨å»¶è¿Ÿçš„å‡½æ•°ï¼Œæ¯”å¦‚å»¶è¿Ÿã€‚å½“å»¶è¿Ÿç­‰å¾…æ—¶ï¼ŒUIä¸ä¼šè¢«å†»ç»“ï¼Œå› ä¸ºå®ƒä¸ä¼šé˜»å¡UIçº¿ç¨‹â€”â€”å®ƒåªæ˜¯æŒ‚èµ·äº†åç¨‹ã€‚ Androidåº”ç”¨ç¨‹åºçš„ç›¸åº”ä»£ç æ˜¯ç›¸åŒçš„ã€‚æ‚¨åªéœ€è¦å°†setupå‡½æ•°çš„ä¸»ä½“å¤åˆ¶åˆ°Androidé¡¹ç›®çš„ç›¸åº”å‡½æ•°ä¸­ã€‚ å–æ¶ˆUIåç¨‹æˆ‘ä»¬å¯ä»¥å¯¹launchå‡½æ•°è¿”å›çš„Jobå¯¹è±¡è¿›è¡Œå¼•ç”¨ï¼Œå½“æˆ‘ä»¬æƒ³è¦åœæ­¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å–æ¶ˆåç¨‹ã€‚å½“ç‚¹å‡»æ¡ƒè‰²çš„åœ†åœˆæ—¶ï¼Œè®©æˆ‘ä»¬å–æ¶ˆåç¨‹: 12345678910fun setup(hello: Text, fab: Circle) &#123; val job = launch(UI) &#123; // launch coroutine in UI context for (i in 10 downTo 1) &#123; // countdown from 10 to 1 hello.text = \"Countdown $i ...\" // update text delay(500) // wait half a second &#125; hello.text = \"Done!\" &#125; fab.onMouseClicked = EventHandler &#123; job.cancel() &#125; // cancel coroutine on click&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ç°åœ¨ï¼Œå¦‚æœåœ¨å€’è®¡æ—¶è¿˜åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œåœ†åœˆè¢«å•å‡»ï¼Œå€’è®¡æ—¶å°±åœæ­¢äº†ã€‚æ³¨æ„,Job.cancelæ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨çš„å’Œéé˜»å¡çš„ã€‚å®ƒåªæ˜¯å‘åç¨‹å‘å‡ºä¿¡å·ï¼Œä»¥å–æ¶ˆå®ƒçš„å·¥ä½œï¼Œè€Œä¸ç­‰å¾…å®ƒçœŸæ­£ç»ˆæ­¢ã€‚å®ƒå¯ä»¥ä»ä»»ä½•åœ°æ–¹è°ƒç”¨ã€‚åœ¨å·²ç»å–æ¶ˆæˆ–å·²ç»å®Œæˆçš„åç¨‹ä¸Šè°ƒç”¨å®ƒï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚ Androidå¯¹åº”çš„çº¿å¦‚ä¸‹å›¾æ‰€ç¤º: 1fab.setOnClickListener &#123; job.cancel() &#125; // åœ¨ç‚¹å‡»å–æ¶ˆåç¨‹ åœ¨UIä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å‚ä¸è€…åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºUIåº”ç”¨ç¨‹åºå¦‚ä½•åœ¨å…¶UIä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å‚ä¸è€…(actors)ï¼Œç¡®ä¿åœ¨å¯åŠ¨çš„åç¨‹sçš„æ•°é‡ä¸Šæ²¡æœ‰æ— é™åˆ¶çš„å¢é•¿ã€‚ æ‰©å±•åç¨‹æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç¼–å†™ä¸€ä¸ªåä¸ºonClickçš„æ‰©å±•åç¨‹æ„å»ºå™¨å‡½æ•°ï¼Œè¿™æ ·æ¯å½“å•å‡»æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œè¿™ä¸ªç®€å•ä»£ç å€’è®¡æ—¶åŠ¨ç”»: 123456789fun setup(hello: Text, fab: Circle) &#123; fab.onClick &#123; // start coroutine when the circle is clicked for (i in 10 downTo 1) &#123; // countdown from 10 to 1 hello.text = \"Countdown $i ...\" // update text delay(500) // wait half a second &#125; hello.text = \"Done!\" &#125;&#125; onClickçš„ç¬¬ä¸€ä¸ªå®ç°æ˜¯åœ¨æ¯ä¸ªé¼ æ ‡äº‹ä»¶ä¸Šå¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ï¼Œå¹¶å°†ç›¸åº”çš„é¼ æ ‡äº‹ä»¶ä¼ é€’ç»™æ‰€æä¾›çš„æ“ä½œ(ä»¥é˜²æˆ‘ä»¬éœ€è¦å®ƒ): 1234567fun Node.onClick(action: suspend (MouseEvent) -&gt; Unit) &#123; onMouseClicked = EventHandler &#123; event -&gt; launch(UI) &#123; action(event) &#125; &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æ³¨æ„ï¼Œæ¯æ¬¡å•å‡»åœ†åœˆæ—¶ï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ï¼Œå®ƒä»¬éƒ½åœ¨ç«äº‰æ›´æ–°æ–‡æœ¬ã€‚è¯•ä¸€è¯•ã€‚çœ‹èµ·æ¥ä¸å¤ªå¥½ã€‚ä»¥åæˆ‘ä»¬ä¼šä¿®å¤å®ƒã€‚ åœ¨Androidä¸Šï¼Œå¯ä»¥ä¸ºè§†å›¾ç±»ç¼–å†™ç›¸åº”çš„æ‰©å±•ï¼Œè¿™æ ·åœ¨ä¸Šé¢æ‰€ç¤ºçš„setupå‡½æ•°ä¸­çš„ä»£ç å¯ä»¥ä¸ç”¨ä¿®æ”¹å°±å¯ä»¥ä½¿ç”¨ã€‚Androidä¸Šæ²¡æœ‰MouseEventï¼Œæ‰€ä»¥çœç•¥äº†ã€‚ 1234567fun View.onClick(action: suspend () -&gt; Unit) &#123; setOnClickListener &#123; launch(UI) &#123; action() &#125; &#125;&#125; æœ€å¤šåç¨‹jobåœ¨å¼€å§‹æ–°çš„Jobä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆä¸€ä»½ç§¯æçš„Jobï¼Œä»¥ç¡®ä¿åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåç¨‹æ­£åœ¨å¯¹å€’è®¡æ—¶è¿›è¡ŒåŠ¨ç”»ã€‚ç„¶è€Œï¼Œè¿™é€šå¸¸ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ã€‚cancelå‡½æ•°åªæ˜¯ä½œä¸ºä¸€ä¸ªä¿¡å·æ¥ä¸­æ­¢ä¸€ä¸ªåç¨‹ã€‚å–æ¶ˆæ˜¯åˆä½œçš„ï¼Œè€Œåç¨‹æ­¤æ—¶å¯èƒ½æ­£åœ¨åšä¸€äº›ä¸å¯æ’¤é”€çš„äº‹æƒ…ï¼Œæˆ–è€…å¿½ç•¥äº†ä¸€ä¸ªå–æ¶ˆä¿¡å·ã€‚æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å‚ä¸è€…(actor)æ¥æ‰§è¡Œä¸åº”è¯¥åŒæ—¶æ‰§è¡Œçš„ä»»åŠ¡ã€‚è®©æˆ‘ä»¬æ”¹å˜onClickæ‰©å±•å®ç°: 12345678910fun Node.onClick(action: suspend (MouseEvent) -&gt; Unit) &#123; // launch one actor to handle all events on this node val eventActor = actor&lt;MouseEvent&gt;(UI) &#123; for (event in channel) action(event) // pass event to action &#125; // install a listener to offer events to this actor onMouseClicked = EventHandler &#123; event -&gt; eventActor.offer(event) &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ä¸‹é¢çš„å…³é”®æ€æƒ³æ˜¯ä¸€ä¸ªå‚ä¸è€…(actor)åç¨‹å’Œä¸€ä¸ªå¸¸è§„äº‹ä»¶å¤„ç†ç¨‹åºçš„é›†æˆï¼Œé‚£å°±æ˜¯åœ¨SendChannelä¸Šæœ‰ä¸€ä¸ªä¸ç­‰å¾…çš„offerå‡½æ•°ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œå®ƒä¼šç«‹å³å‘å‚ä¸è€…(actor)å‘é€ä¸€ä¸ªå…ƒç´ ï¼Œå¦åˆ™å°±ä¼šä¸¢å¼ƒä¸€ä¸ªå…ƒç´ ã€‚ä¸€ä¸ªofferå®é™…ä¸Šè¿”å›ä¸€ä¸ªæˆ‘ä»¬å¿½ç•¥çš„å¸ƒå°”ç»“æœã€‚ åœ¨Androidä¸Šï¼Œæ²¡æœ‰MouseEventï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯å°†ä¸€ä¸ªUnitå‘é€ç»™actorä½œä¸ºä¸€ä¸ªä¿¡å·ã€‚è§†å›¾ç±»çš„ç›¸åº”æ‰©å±•å¦‚ä¸‹: 12345678910fun View.onClick(action: suspend () -&gt; Unit) &#123; // launch one actor val eventActor = actor&lt;Unit&gt;(UI) &#123; for (event in channel) action() &#125; // install a listener to activate this actor setOnClickListener &#123; eventActor.offer(Unit) &#125;&#125; äº‹ä»¶åˆå¹¶æœ‰æ—¶å¤„ç†æœ€è¿‘çš„äº‹ä»¶æ›´åˆé€‚ï¼Œè€Œä¸æ˜¯åœ¨æˆ‘ä»¬å¿™äºå¤„ç†å‰ä¸€ä¸ªäº‹ä»¶æ—¶å¿½ç•¥äº‹ä»¶ã€‚å‚ä¸è€…åç¨‹æ„å»ºå™¨æ¥å—ä¸€ä¸ªå¯é€‰çš„å®¹é‡å‚æ•°ï¼Œè¯¥å‚æ•°æ§åˆ¶è¯¥å‚ä¸è€…åœ¨å…¶é‚®ç®±ä¸­ä½¿ç”¨çš„é€šé“çš„å®ç°ã€‚åœ¨ Channel()å·¥å‚å‡½æ•°çš„æ–‡æ¡£ä¸­ç»™å‡ºäº†æ‰€æœ‰å¯ç”¨é€‰é¡¹çš„æè¿°ã€‚ è®©æˆ‘ä»¬ä¿®æ”¹ä»£ç ä»¥é€šè¿‡Channel.CONFLATEDå®¹é‡å€¼æ¥ä½¿ç”¨ConflatedChannelã€‚è¿™ç§å˜åŒ–åªä¼šäº§ç”Ÿä¸€ä¸ªå‚ä¸è€…: 12345678910fun Node.onClick(action: suspend (MouseEvent) -&gt; Unit) &#123; // launch one actor to handle all events on this node val eventActor = actor&lt;MouseEvent&gt;(UI, capacity = Channel.CONFLATED) &#123; // &lt;--- Changed here for (event in channel) action(event) // pass event to action &#125; // install a listener to offer events to this actor onMouseClicked = EventHandler &#123; event -&gt; eventActor.offer(event) &#125;&#125; æ‚¨å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„JavaFxä»£ç ã€‚åœ¨Androidä¸Šï¼Œä½ éœ€è¦æ›´æ–°val eventActor =â€¦ä»ä¸Šä¸€ä¸ªä¾‹å­ä¸­å¾—åˆ°çš„è¡Œã€‚ ç°åœ¨ï¼Œå¦‚æœåœ¨åŠ¨ç”»è¿è¡Œæ—¶å•å‡»åœ†ï¼Œå®ƒå°†åœ¨ç»“æŸåé‡æ–°å¯åŠ¨åŠ¨ç”»ã€‚åªæœ‰ä¸€æ¬¡ã€‚å½“åŠ¨ç”»è¿è¡Œæ—¶ï¼Œé‡å¤çš„ç‚¹å‡»é‡ä¼šè¢«åˆå¹¶ï¼Œåªæœ‰æœ€è¿‘çš„äº‹ä»¶æ‰ä¼šè¢«å¤„ç†ã€‚ è¿™ä¹Ÿæ˜¯UIåº”ç”¨ç¨‹åºéœ€è¦çš„ä¸€ç§è¡Œä¸ºï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¿…é¡»æ ¹æ®æœ€è¿‘æ”¶åˆ°çš„æ›´æ–°æ¥æ›´æ–°å®ƒä»¬çš„UIï¼Œä»è€Œå¯¹ä¼ å…¥çš„é«˜é¢‘äº‹ä»¶æµåšå‡ºååº”ã€‚ä½¿ç”¨ConflatedChannelçš„åç¨‹å¯ä»¥é¿å…ç”±äºç¼“å­˜äº‹ä»¶è€Œå¯¼è‡´çš„å»¶è¿Ÿã€‚ æ‚¨å¯ä»¥åœ¨ä¸Šé¢ä¸€è¡Œä¸­è¿›è¡Œcapacityå‚æ•°çš„å®éªŒï¼Œä»¥äº†è§£å®ƒå¦‚ä½•å½±å“ä»£ç çš„è¡Œä¸ºã€‚è®¾ç½®capacity = Channel.UNLIMITEDåˆ›å»ºä¸€ä¸ªä¸LinkedListChannelé‚®ç®±å…³è”çš„åç¨‹ï¼Œå®ƒå¯ä»¥ç¼“å†²æ‰€æœ‰äº‹ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŠ¨ç”»ä¼šåœ¨å•å‡»åœ†åœˆæ—¶å¤šæ¬¡è¿è¡Œã€‚ é˜»å¡æ“ä½œæœ¬èŠ‚è§£é‡Šå¦‚ä½•ä½¿ç”¨å¸¦æœ‰çº¿ç¨‹é˜»å¡æ“ä½œçš„UIåç¨‹ã€‚ UIå†»ç»“çš„é—®é¢˜å¦‚æœæ‰€æœ‰çš„apiéƒ½è¢«å†™ä¸ºæŒ‚èµ·æ‰§è¡Œçº¿ç¨‹çš„å‡½æ•°ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚ç„¶è€Œï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚æœ‰æ—¶æ‚¨éœ€è¦è¿›è¡Œcpuæ¶ˆè€—è®¡ç®—ï¼Œæˆ–è€…ä»…ä»…éœ€è¦è°ƒç”¨ä¸€äº›ç¬¬ä¸‰æ–¹apiæ¥è®¿é—®ç½‘ç»œï¼Œä¾‹å¦‚ï¼Œè¿™æ ·å¯ä»¥é˜»æ­¢è°ƒç”¨çº¿ç¨‹ã€‚æ‚¨ä¸èƒ½ç›´æ¥ä»UIçº¿ç¨‹æˆ–UIé™åˆ¶çš„åç¨‹å®Œæˆï¼Œå› ä¸ºè¿™ä¼šé˜»å¡UIçº¿ç¨‹å¹¶å¯¼è‡´UIçš„å†»ç»“ã€‚ ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å°†ä½¿ç”¨onClickæ‰©å±•å’Œä¸Šä¸€èŠ‚ä¸­ä½¿ç”¨UIé™åˆ¶ äº‹ä»¶åˆå¹¶ actoræ¥å¤„ç†UIçº¿ç¨‹ä¸­çš„æœ€åä¸€æ¬¡ç‚¹å‡»ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†å¯¹æ–æ³¢é‚£å¥‘æ•°è¿›è¡Œç®€å•çš„è®¡ç®—: 12fun fib(x: Int): Int = if (x &lt;= 1) 1 else fib(x - 1) + fib(x - 2) æ¯æ¬¡ç‚¹å‡»åœ†åœˆæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šè®¡ç®—æ›´å¤§çš„æ–æ³¢é‚£å¥‘æ•°ã€‚ä¸ºäº†ä½¿UIæ›´åŠ æ˜æ˜¾ï¼Œè¿˜æœ‰ä¸€ä¸ªå¿«é€Ÿè®¡æ•°åŠ¨ç”»ï¼Œå®ƒæ€»æ˜¯åœ¨è¿è¡Œï¼Œå¹¶ä¸”ä¸æ–­åœ°æ›´æ–°UIä¸Šä¸‹æ–‡ä¸­çš„æ–‡æœ¬: 1234567891011121314151617fun setup(hello: Text, fab: Circle) &#123; var result = \"none\" // the last result // counting animation launch(UI) &#123; var counter = 0 while (true) &#123; hello.text = \"$&#123;++counter&#125;: $result\" delay(100) // update the text every 100ms &#125; &#125; // compute the next fibonacci number of each click var x = 1 fab.onClick &#123; result = \"fib($x) = $&#123;fib(x)&#125;\" x++ &#125;&#125; æ‚¨å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„JavaFxä»£ç ã€‚ä½ å¯ä»¥å°†fibå‡½æ•°å’Œsetupå‡½æ•°çš„ä¸»ä½“å¤åˆ¶åˆ°Androidé¡¹ç›®ä¸­ã€‚ è¯•ç€åœ¨è¿™ä¸ªä¾‹å­ä¸­ç‚¹å‡»åœ†åœˆã€‚åœ¨å¤§çº¦30 - 40æ¬¡ç‚¹å‡»ä¹‹åï¼Œæˆ‘ä»¬çš„å¤©çœŸè®¡ç®—å°†ä¼šå˜å¾—éå¸¸ç¼“æ…¢ï¼Œä½ ä¼šç«‹åˆ»çœ‹åˆ°UIçº¿ç¨‹æ˜¯å¦‚ä½•å†»ç»“çš„ï¼Œå› ä¸ºåŠ¨ç”»åœ¨UIå†»ç»“æœŸé—´åœæ­¢è¿è¡Œã€‚ é˜»å¡æ“ä½œåœ¨UIçº¿ç¨‹ä¸Šçš„é˜»å¡æ“ä½œçš„ä¿®å¤éå¸¸ç®€å•ï¼Œç”¨åç¨‹ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„â€œé˜»å¡â€fibå‡½æ•°è½¬æ¢ä¸ºä¸€ä¸ªéé˜»å¡çš„æŒ‚èµ·å‡½æ•°ï¼Œé€šè¿‡ä½¿ç”¨runå‡½æ•°å°†å®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡æ›´æ”¹åˆ°åå°çº¿ç¨‹çš„CommonPoolï¼Œä»è€Œåœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè®¡ç®—ã€‚æ³¨æ„ï¼Œfibå‡½æ•°ç°åœ¨è¢«æ ‡è®°ä¸ºsuspendä¿®é¥°ç¬¦ã€‚å®ƒä¸ä¼šé˜»å¡å·²è¢«è°ƒç”¨çš„åç¨‹ï¼Œä½†åœ¨åå°çº¿ç¨‹çš„è®¡ç®—å·¥ä½œæ—¶æš‚åœæ‰§è¡Œã€‚ 123suspend fun fib(x: Int): Int = run(CommonPool) &#123; if (x &lt;= 1) 1 else fib(x - 1) + fib(x - 2)&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æ‚¨å¯ä»¥è¿è¡Œæ­¤ä»£ç ï¼Œå¹¶éªŒè¯UIä¸æ˜¯å†»ç»“çš„ï¼Œè€Œå¤§é‡çš„æ–æ³¢é‚£å¥‘æ•°å­—æ­£åœ¨è®¡ç®—ä¸­ã€‚ç„¶è€Œï¼Œè¿™æ®µä»£ç è®¡ç®—fibç¨å¾®æ…¢ä¸€äº›ï¼Œå› ä¸ºå¯¹fibçš„æ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ç»è¿‡äº†runã€‚è¿™åœ¨å®è·µä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸ºè¿è¡Œè¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥æ£€æŸ¥åç¨‹å·²ç»åœ¨æ‰€éœ€çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œå¹¶ä¸”é¿å…äº†å°†åç¨‹åˆ†æ´¾åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šçš„å¼€é”€ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªå¼€é”€ï¼Œåœ¨è¿™ä¸ªåŸå§‹ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåªåœ¨è°ƒç”¨ä¹‹é—´å¢åŠ äº†runçš„æ•´æ•°ã€‚å¯¹äºä¸€äº›æ›´é‡è¦çš„ä»£ç ï¼Œé¢å¤–runè°ƒç”¨çš„å¼€é”€ä¸ä¼šå¾ˆå¤§ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ªç‰¹æ®Šçš„fibå®ç°å¯ä»¥åƒä»¥å‰ä¸€æ ·å¿«é€Ÿåœ°è¿è¡Œï¼Œä½†æ˜¯åœ¨åå°çº¿ç¨‹ä¸­ï¼Œé€šè¿‡å°†åŸæ¥çš„fibå‡½æ•°é‡å‘½åä¸ºfibBlockingï¼Œå¹¶åœ¨fibBlockingä¸Šå®šä¹‰fibå’ŒrunåŒ…è£…: 123456suspend fun fib(x: Int): Int = run(CommonPool) &#123; fibBlocking(x)&#125;fun fibBlocking(x: Int): Int = if (x &lt;= 1) 1 else fibBlocking(x - 1) + fibBlocking(x - 2) ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æ‚¨ç°åœ¨å¯ä»¥åœ¨ä¸é˜»å¡UIçº¿ç¨‹çš„æƒ…å†µä¸‹äº«å—å…¨é€Ÿå¤©çœŸçš„æ–æ³¢é‚£å¥‘è¿ç®—ã€‚æˆ‘ä»¬åªéœ€è¦è¿è¡Œ(CommonPool)ã€‚ æ³¨æ„ï¼Œç”±äºfibå‡½æ•°æ˜¯ç”±ä»£ç ä¸­çš„å•ä¸ªå‚ä¸è€…è°ƒç”¨çš„ï¼Œå› æ­¤åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´å†…éƒ½æœ‰ä¸€ä¸ªå¹¶å‘è®¡ç®—ï¼Œå› æ­¤è¿™æ®µä»£ç å¯¹èµ„æºçš„åˆ©ç”¨ç‡æœ‰ä¸€ä¸ªè‡ªç„¶çš„é™åˆ¶ã€‚å®ƒå¯ä»¥åœ¨å¤§å¤šæ•°CPUæ ¸å¿ƒä¸­é¥±å’Œã€‚ é«˜çº§çš„ä¸»é¢˜æœ¬èŠ‚ä»‹ç»å„ç§é«˜çº§ä¸»é¢˜ã€‚ ç”Ÿå‘½å‘¨æœŸå’Œåç¨‹çˆ¶å­å±‚æ¬¡ç»“æ„ä¸€ä¸ªå…¸å‹çš„UIåº”ç”¨ç¨‹åºæœ‰è®¸å¤šå…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„å…ƒç´ ã€‚Windowsã€UIæ§ä»¶ã€activitiesã€viewsã€fragmentså’Œå…¶ä»–å¯è§†åŒ–å…ƒç´ è¢«åˆ›å»ºå’Œé”€æ¯ã€‚ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„åç¨‹ï¼Œæ‰§è¡Œä¸€äº›IOæˆ–åå°è®¡ç®—ï¼Œå¯ä»¥ä¿ç•™å¯¹ç›¸åº”UIå…ƒç´ çš„å¼•ç”¨ï¼Œæ—¶é—´è¶…è¿‡æ‰€éœ€çš„æ—¶é—´ï¼Œé˜²æ­¢æ‰€æœ‰å·²è¢«ç ´åä¸”ä¸å†æ˜¾ç¤ºçš„UIå¯¹è±¡æ ‘çš„åƒåœ¾å›æ”¶ã€‚ è¿™ä¸ªé—®é¢˜çš„è‡ªç„¶è§£å†³æ–¹æ¡ˆæ˜¯å°†ä¸€ä¸ªJobå¯¹è±¡ä¸æ¯ä¸ªå…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„UIå¯¹è±¡ç›¸å…³è”ï¼Œå¹¶åœ¨è¯¥Jobçš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºæ‰€æœ‰çš„åç¨‹ã€‚ ä¾‹å¦‚ï¼Œåœ¨Androidåº”ç”¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªActivityæœ€åˆè¢«åˆ›å»ºï¼Œå½“å®ƒä¸å†éœ€è¦æ—¶è¢«é”€æ¯ï¼Œå½“å®ƒçš„å†…å­˜å¿…é¡»è¢«é‡Šæ”¾æ—¶è¢«é”€æ¯ã€‚ä¸€ä¸ªè‡ªç„¶çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†Jobçš„å®ä¾‹é™„åŠ åˆ°Activityçš„å®ä¾‹ä¸Šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ä»¥ä¸‹JobHolderæ¥å£æ¥åˆ›å»ºä¸€ä¸ªå°å‹æ¡†æ¶: 123interface JobHolder &#123; val job: Job&#125; ç°åœ¨ï¼Œä¸€ä¸ªä¸jobç›¸å…³çš„activityéœ€è¦å®ç°è¿™ä¸ªJobHolderæ¥å£ï¼Œå¹¶å®šä¹‰å…¶onDestroyå‡½æ•°æ¥å–æ¶ˆå¯¹åº”çš„ä½œä¸š: 12345678910class MainActivity : AppCompatActivity(), JobHolder &#123; override val job: Job = Job() // è¯¥æ´»åŠ¨çš„jobå®ä¾‹ override fun onDestroy() &#123; super.onDestroy() job.cancel() // å½“activityè¢«ç ´åæ—¶å–æ¶ˆjob &#125; // the rest of code&#125; æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•æ¥æ£€ç´¢åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•è§†å›¾çš„Jobã€‚è¿™å¾ˆç®€å•ï¼Œå› ä¸ºä¸€ä¸ªJobæ˜¯å®ƒçš„è§†å›¾çš„ä¸€ä¸ªAndroidä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹çš„View.contextJobæ‰©å±•å±æ€§: 12val View.contextJob: Job get() = (context as? JobHolder)?.job ?: NonCancellable åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨NonCancellableçš„Jobå®ç°ä½œä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬çš„contextJobæ‰©å±•å±æ€§æ˜¯åœ¨æ²¡æœ‰é™„åŠ Jobçš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çš„ã€‚ æœ‰ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„contextJobçš„ä¾¿åˆ©æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨å®ƒæ¥å¯åŠ¨æ‰€æœ‰çš„åç¨‹ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ˜¾å¼åœ°ç»´æŠ¤æˆ‘ä»¬å·²ç»å¼€å§‹çš„åç¨‹çš„åˆ—è¡¨ã€‚æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å°†ç”±Jobä¹‹é—´çš„äº²å­å…³ç³»çš„æœºåˆ¶æ¥å¤„ç†ã€‚ ä¾‹å¦‚ï¼Œä¸Šä¸€èŠ‚çš„View.onClickæ‰©å±•ç°åœ¨å¯ä»¥ä½¿ç”¨contextJobæ¥å®šä¹‰: 12345678910fun View.onClick(action: suspend () -&gt; Unit) &#123; // launch one actor as a parent of the context job val eventActor = actor&lt;Unit&gt;(contextJob + UI, capacity = Channel.CONFLATED) &#123; for (event in channel) action() &#125; // install a listener to activate this actor setOnClickListener &#123; eventActor.offer(Unit) &#125;&#125; æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­å¦‚ä½•ä½¿ç”¨contextJob + UIè¡¨è¾¾å¼æ¥å¯åŠ¨ä¸€ä¸ªå‚ä¸è€…ã€‚å®ƒä¸ºæˆ‘ä»¬çš„æ–°å‚ä¸è€…å®šä¹‰äº†ä¸€ä¸ªåç¨‹ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬jobå’ŒUIåˆ†æ´¾å™¨ã€‚ç”±è¿™ä¸ªactor(contextJob + UI)è¡¨è¾¾å¼å¯åŠ¨çš„åç¨‹å°†ä¼šæˆä¸ºç›¸åº”ä¸Šä¸‹æ–‡ä½œä¸šçš„ä¸€ä¸ªå­©å­ã€‚å½“æ´»åŠ¨è¢«ç ´åï¼Œå®ƒçš„å·¥ä½œè¢«å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰çš„å­©å­éƒ½è¢«å–æ¶ˆäº†ã€‚ jobsä¹‹é—´çš„çˆ¶å­å…³ç³»å½¢æˆäº†ä¸€ä¸ªå±‚æ¬¡ç»“æ„ã€‚ä»£è¡¨è§†å›¾å’Œåœ¨å…¶ä¸Šä¸‹æ–‡ä¸­æ‰§è¡ŒæŸäº›åå°Jobçš„åç¨‹å¯ä»¥åˆ›å»ºæ›´å¤šçš„å­èŠ‚ç‚¹ã€‚å½“çˆ¶jobè¢«å–æ¶ˆæ—¶ï¼Œæ•´æ£µæ ‘éƒ½è¢«å–æ¶ˆäº†ã€‚å…¶ä¸­ä¸€ä¸ªä¾‹å­æ˜¯åœ¨ã€Šåç¨‹æŒ‡å—ã€‹çš„â€œå­åç¨‹â€éƒ¨åˆ†ã€‚ åœ¨æ²¡æœ‰åˆ†æ´¾çš„æƒ…å†µä¸‹ï¼Œåœ¨UIäº‹ä»¶å¤„ç†ç¨‹åºä¸­å¯åŠ¨åç¨‹è®©æˆ‘ä»¬åœ¨è®¾ç½®ä¸­ç¼–å†™ä¸‹é¢çš„ä»£ç ï¼Œä»¥å¯è§†åŒ–ä»UIçº¿ç¨‹å¯åŠ¨åç¨‹æ—¶æ‰§è¡Œçš„é¡ºåº: 1234567891011fun setup(hello: Text, fab: Circle) &#123; fab.onMouseClicked = EventHandler &#123; println(\"Before launch\") launch(UI) &#123; println(\"Inside coroutine\") delay(100) println(\"After delay\") &#125; println(\"After launch\") &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å½“æˆ‘ä»¬å¯åŠ¨è¿™æ®µä»£ç å¹¶ç‚¹å‡»ä¸€ä¸ªç²‰çº¢è‰²çš„åœ†åœˆæ—¶ï¼Œä»¥ä¸‹æ¶ˆæ¯è¢«æ‰“å°åˆ°æ§åˆ¶å°: 1234Before launchAfter launchInside coroutineAfter delay æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œlaunchä¹‹åç«‹å³æ‰§è¡Œï¼Œè€Œcoroutineåˆ™è¢«å‘å¸ƒåˆ°UIçº¿ç¨‹ä¸Šï¼Œä»¥ä¾¿ç¨åæ‰§è¡Œã€‚kotlinx.coroutinesçš„æ‰€æœ‰UIè°ƒåº¦ç¨‹åºéƒ½æ˜¯è¿™æ ·å®ç°çš„ã€‚ä¸ºä»€ä¹ˆå¦‚æ­¤? åŸºæœ¬ä¸Šï¼Œè¿™é‡Œçš„é€‰æ‹©æ˜¯â€œjsé£æ ¼â€çš„å¼‚æ­¥æ–¹æ³•(å¼‚æ­¥æ“ä½œæ€»æ˜¯å»¶è¿Ÿåˆ°ç¨ååœ¨è°ƒåº¦çº¿ç¨‹ä¸­æ‰§è¡Œ)å’Œâ€œc#é£æ ¼â€çš„æ–¹æ³•(åœ¨invokerçº¿ç¨‹ä¸­æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªæŒ‚èµ·ç‚¹)ã€‚c#æ–¹æ³•ä¼¼ä¹æ›´æœ‰æ•ˆç‡,å®ƒæœ€ç»ˆå»ºè®®åƒâ€œä½¿ç”¨æ”¶ç›Šç‡å¦‚æœéœ€è¦â€¦.â€ã€‚è¿™æ˜¯å®¹æ˜“å‡ºé”™çš„ã€‚jsé£æ ¼çš„æ–¹æ³•æ›´ä¸€è‡´ï¼Œä¸éœ€è¦ç¨‹åºå‘˜è€ƒè™‘æ˜¯å¦éœ€è¦è®©æ­¥ã€‚ ç„¶è€Œï¼Œåœ¨è¿™ä¸ªç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå½“åç¨‹ä»ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå¼€å§‹ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–çš„ä»£ç æ—¶ï¼Œè¿™ä¸ªé¢å¤–çš„åˆ†æ´¾ç¡®å®å¢åŠ äº†é¢å¤–çš„å¼€é”€è€Œä¸å¸¦æ¥ä»»ä½•é¢å¤–çš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„CoroutineStartå‚æ•°å¯åŠ¨ï¼Œasyncå’Œactoråç¨‹æ„å»ºå™¨å¯ä»¥ç”¨äºæ€§èƒ½ä¼˜åŒ–ã€‚å°†å…¶è®¾ç½®ä¸ºCoroutineStart.UNDISPATCHEDçš„å€¼ï¼Œå°†ç«‹å³å¼€å§‹æ‰§è¡Œåç¨‹ï¼Œç›´åˆ°å…¶ç¬¬ä¸€ä¸ªæŒ‚èµ·ç‚¹ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤º: 1234567891011fun setup(hello: Text, fab: Circle) &#123; fab.onMouseClicked = EventHandler &#123; println(\"Before launch\") launch(UI, CoroutineStart.UNDISPATCHED) &#123; // &lt;--- Notice this change println(\"Inside coroutine\") delay(100) // &lt;--- And this is where coroutine suspends println(\"After delay\") &#125; println(\"After launch\") &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å½“æˆ‘ä»¬å¯åŠ¨è¿™æ®µä»£ç å¹¶ç‚¹å‡»ä¸€ä¸ªç²‰çº¢è‰²çš„åœ†åœˆæ—¶ï¼Œä»¥ä¸‹æ¶ˆæ¯è¢«æ‰“å°åˆ°æ§åˆ¶å°: 1234Before launchInside coroutineAfter launchAfter delay","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"},{"name":"kotlinx.coroutines","slug":"kotlinx-coroutines","permalink":"https://jigangduan.github.io/tags/kotlinx-coroutines/"}]},{"title":"kotlinx.coroutineså…¥é—¨æŒ‡å—ç¤ºä¾‹","slug":"GuideToKotlinxCoroutinesByExample","date":"2017-11-06T11:01:27.000Z","updated":"2020-07-25T02:57:18.152Z","comments":true,"path":"2017/11/06/GuideToKotlinxCoroutinesByExample/","link":"","permalink":"https://jigangduan.github.io/2017/11/06/GuideToKotlinxCoroutinesByExample/","excerpt":"è¿™æ˜¯ä¸€ä¸ªå…³äºkotlinx.coroutinesæ ¸å¿ƒç‰¹æ€§çš„ç®€çŸ­æŒ‡å—ï¼Œæœ‰ä¸€ç³»åˆ—çš„ä¾‹å­ã€‚ ä»‹ç»å’Œè®¾ç½®ä½œä¸ºä¸€ç§è¯­è¨€ï¼ŒKotlinåœ¨å…¶æ ‡å‡†åº“ä¸­åªæä¾›äº†æœ€ä½é™åº¦çš„ä½çº§apiï¼Œä»¥ä½¿å„ç§å…¶ä»–åº“èƒ½å¤Ÿåˆ©ç”¨è¿™äº›åº“ã€‚ä¸å…¶ä»–å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„è¯­è¨€ä¸åŒï¼Œasyncå’Œawaitåœ¨Kotlinä¸­ä¸æ˜¯å…³é”®å­—ï¼Œç”šè‡³éƒ½ä¸æ˜¯å®ƒçš„æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚ kotlinx.coroutinesæ˜¯ä¸€ä¸ªå¦‚æ­¤ä¸°å¯Œçš„åº“ã€‚å®ƒåŒ…å«äº†è®¸å¤šé«˜çº§çš„å¯æ”¯æŒå†…æ ¸çš„åŸè¯­ï¼ŒåŒ…æ‹¬asyncå’Œawaitã€‚æ‚¨éœ€è¦æ·»åŠ å¯¹kotlinx-coroutines-coreæ¨¡å—çš„ä¾èµ–ï¼Œè¿™æ˜¯åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨æœ¬æŒ‡å—ä¸­çš„åŸºç¡€ã€‚ ç›®å½• åç¨‹åŸºç¡€ ä½ çš„ç¬¬ä¸€ä¸ªåç¨‹ æ¡¥æ¥é˜»å¡å’Œéé˜»å¡çš„ä¸–ç•Œ ç­‰å¾…job æå–å‡½æ•°é‡æ„ åç¨‹æ˜¯è½»é‡çº§çš„ åç¨‹å°±åƒå®ˆæŠ¤çº¿ç¨‹ å–æ¶ˆå’Œè¶…æ—¶ å–æ¶ˆåç¨‹æ‰§è¡Œ å–æ¶ˆæ˜¯éœ€è¦åä½œçš„ ä½¿è®¡ç®—ä»£ç å¯å–æ¶ˆ åœ¨finallyå…³é—­èµ„æº è¿è¡Œä¸å¯å–æ¶ˆå— è¶…æ—¶ ç»„ç»‡æŒ‚èµ·å‡½æ•° é»˜è®¤é¡ºåº ä½¿ç”¨asyncå¹¶å‘ æ‡’å¯åŠ¨async å¼‚æ­¥å¼å‡½æ•° åç¨‹contextå’Œåˆ†æ´¾å™¨ åˆ†æ´¾å™¨å’Œçº¿ç¨‹ éé™åˆ¶ vs é™åˆ¶ åˆ†æ´¾å™¨ è°ƒè¯•åç¨‹å’Œçº¿ç¨‹ çº¿ç¨‹ä¹‹é—´è·³è½¬ contextä¸­çš„job å­åç¨‹ ç»“åˆcontexts çˆ¶åç¨‹è´£ä»» å‘½ååç¨‹çš„è°ƒè¯• å–æ¶ˆæ˜¾å¼å·¥ä½œ é€šé“ é€šé“åŸºç¡€çŸ¥è¯† é€šé“çš„å…³é—­å’Œè¿­ä»£ æ„å»ºé€šé“ç”Ÿæˆå™¨ ç®¡é“ ç”¨ç®¡é“æ±‚ç´ æ•° æ‰‡å‡º æ‰‡å…¥ ç¼“å†²é€šé“ é€šé“æ˜¯å…¬å¹³çš„ å…±äº«çš„å¯å˜çŠ¶æ€å’Œå¹¶å‘æ€§ è¿™ä¸ªé—®é¢˜ Volatilesæ¯«æ— ç”¨å¤„ çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ ç»†ç²’åº¦çº¿ç¨‹çº¦æŸ ç²—ç²’åº¦çº¿ç¨‹çº¦æŸ Mutex å‚ä¸è€… Selectè¡¨è¾¾å¼ é€‰æ‹©é€šé“ å…³é—­æ—¶çš„select é€‰æ‹©å‘é€ é€‰æ‹©deferredå€¼ åˆ‡æ¢åˆ°deferredå€¼çš„é€šé“ è¿›ä¸€æ­¥çš„é˜…è¯»","text":"è¿™æ˜¯ä¸€ä¸ªå…³äºkotlinx.coroutinesæ ¸å¿ƒç‰¹æ€§çš„ç®€çŸ­æŒ‡å—ï¼Œæœ‰ä¸€ç³»åˆ—çš„ä¾‹å­ã€‚ ä»‹ç»å’Œè®¾ç½®ä½œä¸ºä¸€ç§è¯­è¨€ï¼ŒKotlinåœ¨å…¶æ ‡å‡†åº“ä¸­åªæä¾›äº†æœ€ä½é™åº¦çš„ä½çº§apiï¼Œä»¥ä½¿å„ç§å…¶ä»–åº“èƒ½å¤Ÿåˆ©ç”¨è¿™äº›åº“ã€‚ä¸å…¶ä»–å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„è¯­è¨€ä¸åŒï¼Œasyncå’Œawaitåœ¨Kotlinä¸­ä¸æ˜¯å…³é”®å­—ï¼Œç”šè‡³éƒ½ä¸æ˜¯å®ƒçš„æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚ kotlinx.coroutinesæ˜¯ä¸€ä¸ªå¦‚æ­¤ä¸°å¯Œçš„åº“ã€‚å®ƒåŒ…å«äº†è®¸å¤šé«˜çº§çš„å¯æ”¯æŒå†…æ ¸çš„åŸè¯­ï¼ŒåŒ…æ‹¬asyncå’Œawaitã€‚æ‚¨éœ€è¦æ·»åŠ å¯¹kotlinx-coroutines-coreæ¨¡å—çš„ä¾èµ–ï¼Œè¿™æ˜¯åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨æœ¬æŒ‡å—ä¸­çš„åŸºç¡€ã€‚ ç›®å½• åç¨‹åŸºç¡€ ä½ çš„ç¬¬ä¸€ä¸ªåç¨‹ æ¡¥æ¥é˜»å¡å’Œéé˜»å¡çš„ä¸–ç•Œ ç­‰å¾…job æå–å‡½æ•°é‡æ„ åç¨‹æ˜¯è½»é‡çº§çš„ åç¨‹å°±åƒå®ˆæŠ¤çº¿ç¨‹ å–æ¶ˆå’Œè¶…æ—¶ å–æ¶ˆåç¨‹æ‰§è¡Œ å–æ¶ˆæ˜¯éœ€è¦åä½œçš„ ä½¿è®¡ç®—ä»£ç å¯å–æ¶ˆ åœ¨finallyå…³é—­èµ„æº è¿è¡Œä¸å¯å–æ¶ˆå— è¶…æ—¶ ç»„ç»‡æŒ‚èµ·å‡½æ•° é»˜è®¤é¡ºåº ä½¿ç”¨asyncå¹¶å‘ æ‡’å¯åŠ¨async å¼‚æ­¥å¼å‡½æ•° åç¨‹contextå’Œåˆ†æ´¾å™¨ åˆ†æ´¾å™¨å’Œçº¿ç¨‹ éé™åˆ¶ vs é™åˆ¶ åˆ†æ´¾å™¨ è°ƒè¯•åç¨‹å’Œçº¿ç¨‹ çº¿ç¨‹ä¹‹é—´è·³è½¬ contextä¸­çš„job å­åç¨‹ ç»“åˆcontexts çˆ¶åç¨‹è´£ä»» å‘½ååç¨‹çš„è°ƒè¯• å–æ¶ˆæ˜¾å¼å·¥ä½œ é€šé“ é€šé“åŸºç¡€çŸ¥è¯† é€šé“çš„å…³é—­å’Œè¿­ä»£ æ„å»ºé€šé“ç”Ÿæˆå™¨ ç®¡é“ ç”¨ç®¡é“æ±‚ç´ æ•° æ‰‡å‡º æ‰‡å…¥ ç¼“å†²é€šé“ é€šé“æ˜¯å…¬å¹³çš„ å…±äº«çš„å¯å˜çŠ¶æ€å’Œå¹¶å‘æ€§ è¿™ä¸ªé—®é¢˜ Volatilesæ¯«æ— ç”¨å¤„ çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ ç»†ç²’åº¦çº¿ç¨‹çº¦æŸ ç²—ç²’åº¦çº¿ç¨‹çº¦æŸ Mutex å‚ä¸è€… Selectè¡¨è¾¾å¼ é€‰æ‹©é€šé“ å…³é—­æ—¶çš„select é€‰æ‹©å‘é€ é€‰æ‹©deferredå€¼ åˆ‡æ¢åˆ°deferredå€¼çš„é€šé“ è¿›ä¸€æ­¥çš„é˜…è¯» åç¨‹åŸºç¡€æœ¬èŠ‚ä»‹ç»åŸºæœ¬çš„åç¨‹æ¦‚å¿µã€‚ ä½ çš„ç¬¬ä¸€ä¸ªåç¨‹è¿è¡Œä¸‹é¢çš„ä»£ç : 12345678fun main(args: Array&lt;String&gt;) &#123; launch &#123; // å¯åŠ¨æ–°åç¨‹ delay(1000L) // éé˜»å¡å»¶è¿Ÿ1ç§’ (é»˜è®¤æ—¶é—´å•ä½æ˜¯ms) println(\"World!\") // æ‰“å°åœ¨å»¶è¿Ÿå &#125; println(\"Hello,\") // ä¸»å‡½æ•°ç»§ç»­ï¼Œè€Œåç¨‹å»¶è¿Ÿ Thread.sleep(2000L) // é˜»å¡ä¸»çº¿ç¨‹2ç§’ï¼Œä»¥ä¿æŒJVMçš„ç”Ÿå‘½&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿è¡Œè¿™æ®µä»£ç : 12Hello,World! æœ¬è´¨ä¸Šï¼Œåç¨‹æ˜¯è½»é‡çš„çº¿ç¨‹ã€‚å®ƒä»¬æ˜¯ç”±launch åç¨‹æ„å»ºå™¨å¯åŠ¨çš„ã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„ç»“æœå–ä»£launch { ... }ï¼Œç”¨thread { ... } å’Œdelay(â€¦)ï¼Œç”¨Thread.sleep(â€¦)ã€‚è¯•ä¸€è¯•ã€‚ å¦‚æœæ‚¨å¼€å§‹ç”¨threadæ›¿æ¢launchï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿä»¥ä¸‹é”™è¯¯: 1é”™è¯¯:Kotlin:æŒ‚èµ·å‡½æ•°åªå…è®¸ä»ä¸€ä¸ªåç¨‹æˆ–å¦ä¸€ä¸ªæŒ‚èµ·å‡½æ•°è°ƒç”¨ è¿™æ˜¯å› ä¸ºdelayæ˜¯ä¸€ç§ç‰¹æ®Šçš„æŒ‚èµ·å‡½æ•°ï¼Œå®ƒä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œè€Œæ˜¯æŒ‚èµ·äº†åç¨‹ï¼Œå®ƒåªèƒ½åœ¨ä¸€ä¸ªåç¨‹ä¸­ä½¿ç”¨ã€‚ æ¡¥æ¥é˜»å¡å’Œéé˜»å¡çš„ä¸–ç•Œç¬¬ä¸€ä¸ªä¾‹å­æ··åˆäº†éé˜»å¡delay(...)å’Œé˜»å¡Thread.sleep(...)åœ¨ç›¸åŒçš„mianä»£ç ä¸­ã€‚å¾ˆå®¹æ˜“è¿·è·¯ã€‚è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨runBlockingæ¥æ¸…æ¥šåœ°åˆ†ç¦»é˜»å¡å’Œéé˜»å¡çš„ä¸–ç•Œã€‚ 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; // å¼€å§‹ä¸»åç¨‹ launch &#123; // å¯åŠ¨æ–°åç¨‹ delay(1000L) println(\"World!\") &#125; println(\"Hello,\") // å½“å­©å­è¢«å»¶è¿Ÿæ—¶ï¼Œä¸»åç¨‹ä»åœ¨ç»§ç»­ delay(2000L) // éé˜»å¡å»¶è¿Ÿ2ç§’ä½¿JVMå­˜æ´»&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™æ®µä»£ç åªä½¿ç”¨éé˜»å¡çš„delayã€‚ runBlocking { ... } ä½œä¸ºä¸€ä¸ªé€‚é…å™¨ï¼Œåœ¨è¿™é‡Œä½¿ç”¨å®ƒæ¥å¯åŠ¨é¡¶çº§çš„ä¸»åç¨‹ã€‚runBlockingå—ä¹‹å¤–çš„å¸¸è§„ä»£ç ,ç›´åˆ°runBlockingå†…éƒ¨çš„åç¨‹æ´»è·ƒã€‚ è¿™ä¹Ÿæ˜¯ä¸ºæŒ‚èµ·å‡½æ•°ç¼–å†™å•å…ƒæµ‹è¯•çš„ä¸€ç§æ–¹æ³•: 123456class MyTest &#123; @Test fun testMySuspendingFunction() = runBlocking&lt;Unit&gt; &#123; // è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•æˆ‘ä»¬å–œæ¬¢çš„æ–­è¨€æ ·å¼æ¥ä½¿ç”¨æŒ‚èµ·å‡½æ•° &#125;&#125; ç­‰å¾…jobæ‹–å»¶ä¸€æ®µæ—¶é—´ï¼Œè€Œå¦ä¸€ç§åç¨‹æ­£åœ¨å·¥ä½œï¼Œè¿™ä¸æ˜¯ä¸€ç§å¥½æ–¹æ³•ã€‚è®©æˆ‘ä»¬æ˜ç¡®åœ°ç­‰å¾…(ä»¥éé˜»å¡æ–¹å¼)ç›´åˆ°æˆ‘ä»¬å¯åŠ¨çš„åå°ä»»åŠ¡å®Œæˆ: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = launch &#123; // å¯åŠ¨æ–°çš„åç¨‹ï¼Œå¹¶ä¿æŒjobçš„å¼•ç”¨ delay(1000L) println(\"World!\") &#125; println(\"Hello,\") job.join() // ç­‰åˆ°å­©å­åç¨‹å®Œæˆ&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ç°åœ¨çš„ç»“æœä»ç„¶æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ä¸»åç¨‹çš„ä»£ç å¹¶æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼ä¸åå°ä½œä¸šçš„æŒç»­æ—¶é—´ç›¸å…³è”ã€‚å¥½å¤šäº†ã€‚ æå–å‡½æ•°é‡æ„è®©æˆ‘ä»¬åœ¨launch { ... } ä¸­æå–ä»£ç å—åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ã€‚å½“æ‚¨åœ¨è¿™æ®µä»£ç ä¸­æ‰§è¡Œâ€Extract functionâ€é‡æ„æ—¶ï¼Œæ‚¨å°†å¾—åˆ°ä¸€ä¸ªå¸¦æœ‰suspendä¿®é¥°ç¬¦çš„æ–°å‡½æ•°ã€‚è¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ã€‚æŒ‚èµ·å‡½æ•°å¯ä»¥åƒæ™®é€šå‡½æ•°ä¸€æ ·åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒä»¬çš„é™„åŠ åŠŸèƒ½æ˜¯ï¼Œå®ƒä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æŒ‚èµ·å‡½æ•°ï¼Œæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„delayï¼ŒæŒ‚èµ·æ‰§è¡Œçš„åç¨‹ã€‚ 1234567891011fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = launch &#123; doWorld() &#125; println(\"Hello,\") job.join()&#125;// è¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªæŒ‚èµ·å‡½æ•°suspend fun doWorld() &#123; delay(1000L) println(\"World!\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  åç¨‹æ˜¯è½»é‡çº§çš„è¿è¡Œä¸‹é¢çš„ä»£ç : 123456789fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val jobs = List(100_000) &#123; // å¯åŠ¨å¤§é‡çš„åç¨‹å’Œä»–ä»¬çš„jobsåˆ—è¡¨ launch &#123; delay(1000L) print(\".\") &#125; &#125; jobs.forEach &#123; it.join() &#125; // ç­‰å¾…æ‰€æœ‰çš„jobså®Œæˆ&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒå¯åŠ¨äº†100Kçš„åç¨‹ï¼Œä¸€ç§’é’Ÿä¹‹åï¼Œæ¯ä¸€ä¸ªåç¨‹å°±ä¼šæ‰“å°ä¸€ä¸ªç‚¹ã€‚ç°åœ¨ï¼Œç”¨çº¿ç¨‹æ¥è¯•ä¸€ä¸‹ã€‚å°†ä¼šå‘ç”Ÿä»€ä¹ˆ?(å¾ˆå¯èƒ½ä½ çš„ä»£ç ä¼šäº§ç”ŸæŸç§å†…å­˜æº¢å‡ºé”™è¯¯) åç¨‹å°±åƒå®ˆæŠ¤çº¿ç¨‹ä¸‹é¢çš„ä»£ç å¯åŠ¨äº†ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„åç¨‹ï¼Œå®ƒæ¯ç§’æ‰“å°ä¸¤æ¬¡â€Iâ€™m sleepingâ€ï¼Œç„¶ååœ¨ä¸€äº›delayä¹‹åè¿”å›mainå‡½æ•°: 123456789fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; launch &#123; repeat(1000) &#123; i -&gt; println(\"I'm sleeping $i ...\") delay(500L) &#125; &#125; delay(1300L) // åœ¨å»¶è¿Ÿä¹‹åé€€å‡º&#125; æ‚¨å¯ä»¥è¿è¡Œå¹¶çœ‹åˆ°å®ƒæ‰“å°äº†ä¸‰è¡Œå¹¶ç»ˆæ­¢: 123I&apos;m sleeping 0 ...I&apos;m sleeping 1 ...I&apos;m sleeping 2 ... æ´»è·ƒçš„åç¨‹å¹¶ä¸èƒ½ä½¿æ•´ä¸ªè¿‡ç¨‹ä¿æŒæ´»è·ƒã€‚å®ƒä»¬å°±åƒå®ˆæŠ¤è¿›ç¨‹çº¿ç¨‹ã€‚ å–æ¶ˆå’Œè¶…æ—¶æœ¬èŠ‚ä»‹ç»åç¨‹å–æ¶ˆå’Œè¶…æ—¶ã€‚ å–æ¶ˆåç¨‹æ‰§è¡Œåœ¨å°åº”ç”¨ç¨‹åºä¸­ï¼Œâ€mainâ€æ–¹æ³•çš„è¿”å›å¬èµ·æ¥ä¼¼ä¹æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå¯ä»¥è®©æ‰€æœ‰çš„åç¨‹éšå¼ç»ˆæ­¢ã€‚åœ¨ä¸€ä¸ªè¾ƒå¤§çš„ã€é•¿æœŸè¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚launchå‡½æ•°è¿”å›ä¸€ä¸ªå¯ä»¥ç”¨æ¥å–æ¶ˆè¿è¡Œçš„åç¨‹çš„Job: 12345678910111213fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = launch &#123; repeat(1000) &#123; i -&gt; println(\"I'm sleeping $i ...\") delay(500L) &#125; &#125; delay(1300L) // å»¶è¿Ÿä¸€ç‚¹ println(\"main: I'm tired of waiting!\") job.cancel() // å–æ¶ˆjob job.join() // ç­‰å¾…jobçš„å®Œæˆ println(\"main: Now I can quit.\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿä»¥ä¸‹è¾“å‡º: 12345678910111213141516171819202122232425262728293031323334353637I&apos;m sleeping 0 ...I&apos;m sleeping 1 ...I&apos;m sleeping 2 ...main: I&apos;m tired of waiting!main: Now I can quit.``` åªè¦mainè°ƒç”¨äº†`job.cancel`ï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°å…¶ä»–åç¨‹çš„è¾“å‡ºï¼Œå› ä¸ºå®ƒè¢«å–æ¶ˆäº†ã€‚è¿˜æœ‰ä¸€ä¸ª[Job](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-job/index.html)æ‰©å±•å‡½æ•°[cancelAndJoin](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/cancel-and-join.html)ï¼Œå®ƒç»“åˆäº†[cancel](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-job/cancel.html)å’Œ[join](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-job/join.html)è°ƒç”¨ã€‚### &lt;a name=&quot;cancellation_cooperative&quot;&gt;&lt;/a&gt;å–æ¶ˆæ˜¯éœ€è¦åä½œçš„åç¨‹å–æ¶ˆæ˜¯éœ€è¦åä½œçš„ã€‚ä¸€ä¸ªå–æ¶ˆçš„ä»£ç å¿…é¡»è¿›è¡Œåä½œã€‚æ‰€æœ‰çš„æŒ‚èµ·å‡½æ•°åœ¨`kotlinx.coroutines`éƒ½æ˜¯å¯å–æ¶ˆçš„ã€‚ä»–ä»¬æ£€æµ‹åç¨‹çš„å–æ¶ˆï¼Œå–æ¶ˆæ—¶æŠ›å‡º[CancellationException](https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-cancellation-exception.html)ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªåç¨‹æ­£åœ¨è®¡ç®—å¹¶ä¸”æ²¡æœ‰æ£€æŸ¥å–æ¶ˆï¼Œé‚£ä¹ˆå®ƒå°±ä¸èƒ½è¢«å–æ¶ˆï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:```kotlinfun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val startTime = System.currentTimeMillis() val job = launch &#123; var nextPrintTime = startTime var i = 0 while (i &lt; 5) &#123; // å¾ªç¯è®¡ç®—ï¼Œåªæ˜¯æµªè´¹CPU // æ¯ç§’æ‰“å°æ¶ˆæ¯ä¸¤æ¬¡ if (System.currentTimeMillis() &gt;= nextPrintTime) &#123; println(&quot;I&apos;m sleeping $&#123;i++&#125; ...&quot;) nextPrintTime += 500L &#125; &#125; &#125; delay(1300L) // å»¶è¿Ÿä¸€ç‚¹ println(&quot;main: I&apos;m tired of waiting!&quot;) job.cancelAndJoin() // å–æ¶ˆjobå¹¶ç­‰å¾…å…¶å®Œæˆ println(&quot;main: Now I can quit.&quot;)&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿è¡Œå®ƒï¼Œçœ‹å®ƒä¼šç»§ç»­æ‰“å°â€Iâ€™m sleepingâ€ï¼Œå³ä½¿æ˜¯åœ¨å–æ¶ˆä¹‹åï¼Œç›´åˆ°å·¥ä½œå®Œæˆäº†äº”ä¸ªè¿­ä»£ä¹‹åã€‚ ä½¿è®¡ç®—ä»£ç å¯å–æ¶ˆæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿è®¡ç®—ä»£ç å¯ä»¥è¢«å–æ¶ˆã€‚ç¬¬ä¸€ä¸ªæ˜¯å‘¨æœŸæ€§åœ°è°ƒç”¨ä¸€ä¸ªæŒ‚èµ·å‡½æ•°æ¥æ£€æŸ¥å–æ¶ˆã€‚yieldå‡½æ•°æ˜¯è¿™ä¸ªç›®çš„çš„ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å¦ä¸€ä¸ªæ˜¯æ˜¾å¼åœ°æ£€æŸ¥å–æ¶ˆçŠ¶æ€ã€‚è®©æˆ‘ä»¬æ¥è¯•è¯•åé¢çš„æ–¹æ³•ã€‚ åœ¨å‰é¢çš„ä¾‹å­ä¸­ç”¨while (isActive)æ›¿æ¢while (i &lt; 5)å¹¶é‡æ–°è¿è¡Œå®ƒã€‚ 123456789101112131415161718fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val startTime = System.currentTimeMillis() val job = launch &#123; var nextPrintTime = startTime var i = 0 while (isActive) &#123; // å¯å–æ¶ˆçš„è®¡ç®—å¾ªç¯ // æ¯ç§’æ‰“å°æ¶ˆæ¯ä¸¤æ¬¡ if (System.currentTimeMillis() &gt;= nextPrintTime) &#123; println(\"I'm sleeping $&#123;i++&#125; ...\") nextPrintTime += 500L &#125; &#125; &#125; delay(1300L) // å»¶è¿Ÿä¸€ç‚¹ println(\"main: I'm tired of waiting!\") job.cancelAndJoin() // å–æ¶ˆjobå¹¶ç­‰å¾…å…¶å®Œæˆ println(\"main: Now I can quit.\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨è¿™ä¸ªå¾ªç¯è¢«å–æ¶ˆäº†ã€‚isActiveæ˜¯é€šè¿‡CoroutineScopeå¯¹è±¡åœ¨åç¨‹ä»£ç ä¸­å¯ç”¨çš„å±æ€§ã€‚ åœ¨finallyå…³é—­èµ„æºå¯å–æ¶ˆçš„æŒ‚èµ·å‡½æ•°åœ¨åç¨‹ä¸­æŠ›å‡ºCancellationExceptionçš„åœ°æ–¹å¯ä»¥ç”¨é€šå¸¸çš„æ–¹å¼æ¥å¤„ç†ã€‚ä¾‹å¦‚,try {...} finally {â€¦} è¡¨è¾¾å¼å’ŒKotlin useå‡½æ•°æ‰§è¡Œå®ƒä»¬çš„ç»ˆç»“åŠ¨ä½œï¼Œå½“åç¨‹è¢«å–æ¶ˆæ—¶ï¼š 12345678910111213141516fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = launch &#123; try &#123; repeat(1000) &#123; i -&gt; println(\"I'm sleeping $i ...\") delay(500L) &#125; &#125; finally &#123; println(\"I'm running finally\") &#125; &#125; delay(1300L) // å»¶è¿Ÿä¸€ç‚¹ println(\"main: I'm tired of waiting!\") job.cancelAndJoin() // å–æ¶ˆjobå¹¶ç­‰å¾…å…¶å®Œæˆ println(\"main: Now I can quit.\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  joinå’ŒcancelAndJoinç­‰å¾…æ‰€æœ‰çš„ç»ˆç»“æ“ä½œå®Œæˆï¼Œå› æ­¤ä¸Šé¢çš„ç¤ºä¾‹äº§ç”Ÿä»¥ä¸‹è¾“å‡º: 123456I&apos;m sleeping 0 ...I&apos;m sleeping 1 ...I&apos;m sleeping 2 ...main: I&apos;m tired of waiting!I&apos;m running finallymain: Now I can quit. è¿è¡Œä¸å¯å–æ¶ˆå—åœ¨å‰ä¸€ä¸ªç¤ºä¾‹çš„finallyå—ä¸­ä½¿ç”¨æŒ‚èµ·å‡½æ•°çš„ä»»ä½•å°è¯•éƒ½ä¼šå¯¼è‡´CancellationExceptionï¼Œå› ä¸ºè¿è¡Œè¯¥ä»£ç çš„åç¨‹è¢«å–æ¶ˆäº†ã€‚é€šå¸¸ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºæ‰€æœ‰è¡Œä¸ºè‰¯å¥½çš„å…³é—­æ“ä½œ(å…³é—­æ–‡ä»¶ã€å–æ¶ˆjobæˆ–å…³é—­ä»»ä½•é€šä¿¡é€šé“)é€šå¸¸æ˜¯éé˜»å¡çš„ï¼Œå¹¶ä¸”ä¸æ¶‰åŠä»»ä½•æŒ‚èµ·å‡½æ•°ã€‚ç„¶è€Œï¼Œåœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œå½“æ‚¨éœ€è¦åœ¨è¢«å–æ¶ˆçš„åç¨‹ æŒ‚èµ·æ—¶ï¼Œæ‚¨å¯ä»¥å°†ç›¸åº”çš„ä»£ç æ‰“åŒ…åœ¨run(NonCancellable) {...}ä½¿ç”¨runå‡½æ•°å’ŒNonCancellable contextï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º: 1234567891011121314151617181920fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = launch &#123; try &#123; repeat(1000) &#123; i -&gt; println(\"I'm sleeping $i ...\") delay(500L) &#125; &#125; finally &#123; run(NonCancellable) &#123; println(\"I'm running finally\") delay(1000L) println(\"And I've just delayed for 1 sec because I'm non-cancellable\") &#125; &#125; &#125; delay(1300L) // å»¶è¿Ÿä¸€ç‚¹ println(\"main: I'm tired of waiting!\") job.cancelAndJoin() // å–æ¶ˆjobå¹¶ç­‰å¾…å…¶å®Œæˆ println(\"main: Now I can quit.\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¶…æ—¶åœ¨å®è·µä¸­å–æ¶ˆåç¨‹æ‰§è¡Œçš„æœ€æ˜æ˜¾çš„åŸå› æ˜¯å®ƒçš„æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†ä¸€äº›è¶…æ—¶ã€‚è™½ç„¶æ‚¨å¯ä»¥æ‰‹åŠ¨è·Ÿè¸ªå¯¹åº”Jobçš„å¼•ç”¨ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„åç¨‹ï¼Œä»¥ä¾¿åœ¨å»¶è¿Ÿä¹‹åå–æ¶ˆè·Ÿè¸ªï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨withTimeoutå‡½æ•°æ¥æ‰§è¡Œå®ƒã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; withTimeout(1300L) &#123; repeat(1000) &#123; i -&gt; println(\"I'm sleeping $i ...\") delay(500L) &#125; &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿä»¥ä¸‹è¾“å‡º: 1234I&apos;m sleeping 0 ...I&apos;m sleeping 1 ...I&apos;m sleeping 2 ...Exception in thread &quot;main&quot; kotlinx.coroutines.experimental.TimeoutCancellationException: Timed out waiting for 1300 MILLISECONDS withTimeoutæŠ›å‡ºçš„TimeoutCancellationExceptionæ˜¯CancellationExceptionçš„å­ç±»ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰çœ‹åˆ°å®ƒçš„å †æ ˆè·Ÿè¸ªåœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‡ºæ¥ã€‚è¿™æ˜¯å› ä¸ºåœ¨è¢«å–æ¶ˆçš„åç¨‹é‡ŒCancellationExceptionè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ­£å¸¸çš„åŸå› ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨mainå‡½æ•°ä¸­ä½¿ç”¨äº†withTimeoutã€‚ å› ä¸ºå–æ¶ˆåªæ˜¯ä¸€ä¸ªå¼‚å¸¸ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½å°†ä»¥é€šå¸¸çš„æ–¹å¼å…³é—­ã€‚å¦‚æœä½ éœ€è¦åœ¨ä»»ä½•ç±»å‹çš„è¶…æ—¶ä¸Šåšä¸€äº›é¢å¤–çš„åŠ¨ä½œ,æ‚¨å¯ä»¥åœ¨try {...} catch (e: TimeoutCancellationException) {...}å—ä¸­ä½¿ç”¨è¶…æ—¶æ¥åŒ…è£…ä»£ç ,è€…ä½¿ç”¨ç±»ä¼¼äºwithTimeoutçš„withTimeoutOrNullå‡½æ•°ï¼Œä½†åœ¨è¶…æ—¶æ—¶å®ƒè¿”å›nullï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼š 12345678910fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val result = withTimeoutOrNull(1300L) &#123; repeat(1000) &#123; i -&gt; println(\"I'm sleeping $i ...\") delay(500L) &#125; \"Done\" // will get cancelled before it produces this result &#125; println(\"Result is $result\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿è¡Œè¿™æ®µä»£ç æ—¶ä¸å†å‡ºç°å¼‚å¸¸: 1234I&apos;m sleeping 0 ...I&apos;m sleeping 1 ...I&apos;m sleeping 2 ...Result is null ç»„æˆæŒ‚èµ·å‡½æ•°è¿™ä¸€èŠ‚ä»‹ç»äº†å„ç§æŒ‚èµ·å‡½æ•°çš„ç»„æˆã€‚ é»˜è®¤é¡ºåºå‡è®¾æˆ‘ä»¬åœ¨å…¶ä»–åœ°æ–¹å®šä¹‰äº†ä¸¤ä¸ªæŒ‚èµ·çš„å‡½æ•°ï¼Œå®ƒä»¬åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¿œç¨‹æœåŠ¡è°ƒç”¨æˆ–è®¡ç®—ã€‚æˆ‘ä»¬åªæ˜¯å‡è£…å®ƒä»¬å¾ˆæœ‰ç”¨ï¼Œä½†å®é™…ä¸Šæ¯ä¸€ä¸ªéƒ½åªæ˜¯ä¸ºäº†è¿™ä¸ªä¾‹å­çš„ç›®çš„å»¶è¿Ÿäº†ä¸€ç§’é’Ÿï¼š 123456789suspend fun doSomethingUsefulOne(): Int &#123; delay(1000L) // å‡è£…æˆ‘ä»¬åœ¨åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ… return 13&#125;suspend fun doSomethingUsefulTwo(): Int &#123; delay(1000L) // å‡è£…æˆ‘ä»¬åœ¨åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ… return 29&#125; å¦‚æœéœ€è¦æŒ‰é¡ºåºè°ƒç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦åšä»€ä¹ˆ?é¦–å…ˆæ˜¯doSomethingUsefulOneï¼Œç„¶åæ˜¯doSomethingUsefulTwoï¼Œç„¶åè®¡ç®—å®ƒä»¬çš„ç»“æœçš„æ€»å’Œ?åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å°±ä¼šè¿™æ ·åšï¼Œæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ä¸ªå‡½æ•°çš„ç»“æœæ¥å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°ï¼Œæˆ–è€…å†³å®šå¦‚ä½•è°ƒç”¨å®ƒã€‚ æˆ‘ä»¬åªæ˜¯ä½¿ç”¨å¸¸è§„çš„é¡ºåºè°ƒç”¨ï¼Œå› ä¸ºåœ¨åç¨‹ä¸­çš„ä»£ç ï¼Œå°±åƒå¸¸è§„ä»£ç ä¸€æ ·ï¼Œæ˜¯é»˜è®¤çš„é¡ºåºã€‚ä¸‹é¢çš„ä¾‹å­é€šè¿‡æµ‹é‡æ‰§è¡Œä¸¤ä¸ªæŒ‚èµ·å‡½æ•°çš„æ€»æ—¶é—´æ¥æ¼”ç¤ºå®ƒ: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val time = measureTimeMillis &#123; val one = doSomethingUsefulOne() val two = doSomethingUsefulTwo() println(\"The answer is $&#123;one + two&#125;\") &#125; println(\"Completed in $time ms\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿäº†è¿™æ ·çš„ä¸œè¥¿: 12The answer is 42Completed in 2017 ms ä½¿ç”¨asyncå¹¶å‘å¦‚æœåœ¨è°ƒç”¨doSomethingUsefulOneå’ŒdoSomethingUsefulTwoä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›é€šè¿‡åŒæ—¶æ‰§è¡Œè¿™ä¸¤ç§æ–¹æ³•æ¥è·å¾—æ›´å¿«çš„ç­”æ¡ˆ?è¿™å°±æ˜¯asyncæä¾›å¸®åŠ©çš„åœ°æ–¹ã€‚ åœ¨æ¦‚å¿µä¸Šï¼Œasyncå°±åƒlaunchä¸€æ ·ã€‚å®ƒå¯åŠ¨äº†ä¸€ä¸ªå•ç‹¬çš„åç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çš„çº¿ç¨‹ï¼Œå®ƒå¯ä»¥å’Œæ‰€æœ‰å…¶ä»–çš„ååŒå·¥ä½œã€‚ä¸åŒçš„æ˜¯ï¼Œlaunchè¿”å›ä¸€ä¸ªJobï¼Œå¹¶ä¸”ä¸å¸¦ä»»ä½•ç»“æœå€¼ï¼Œè€Œasyncè¿”å›ä¸€ä¸ªDeferredâ€”â€”ä¸€ä¸ªè½»é‡çº§çš„éé˜»å¡futureï¼Œå®ƒä»£è¡¨äº†ç¨åæä¾›ä¸€ä¸ªç»“æœçš„æ‰¿è¯ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨.await()åœ¨ä¸€ä¸ªdeferredå€¼ä¸Šè·å¾—å®ƒçš„æœ€ç»ˆç»“æœï¼Œä½†æ˜¯Deferredä¹Ÿæ˜¯ä¸€é¡¹Jobï¼Œæ‰€ä»¥æ‚¨å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å–æ¶ˆå®ƒã€‚ 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val time = measureTimeMillis &#123; val one = async &#123; doSomethingUsefulOne() &#125; val two = async &#123; doSomethingUsefulTwo() &#125; println(\"The answer is $&#123;one.await() + two.await()&#125;\") &#125; println(\"Completed in $time ms\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿäº†è¿™æ ·çš„ä¸œè¥¿: 12The answer is 42Completed in 1017 ms é€Ÿåº¦æ˜¯ä¸¤å€ï¼Œå› ä¸ºæˆ‘ä»¬åŒæ—¶æ‰§è¡Œäº†ä¸¤ä¸ªåç¨‹ã€‚æ³¨æ„ï¼Œä¸åç¨‹çš„å¹¶å‘æ€§æ€»æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚ æ‡’å¯åŠ¨asyncä½¿ç”¨ä¸€ä¸ªå…·æœ‰CoroutineStart.LAZYå€¼çš„å¯é€‰startå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨æƒ°æ€§é€‰é¡¹æ¥ä½¿ç”¨asyncã€‚åªæœ‰å½“æŸä¸ªawaitæˆ–æŸä¸ªstartå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒæ‰ä¼šå¯åŠ¨å®ƒçš„åç¨‹ã€‚è¿è¡Œä»¥ä¸‹ç¤ºä¾‹ä¸ä¹‹å‰çš„ç¤ºä¾‹ä¸åŒï¼Œä»…é€šè¿‡æ­¤é€‰é¡¹: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val time = measureTimeMillis &#123; val one = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulOne() &#125; val two = async(start = CoroutineStart.LAZY) &#123; doSomethingUsefulTwo() &#125; println(\"The answer is $&#123;one.await() + two.await()&#125;\") &#125; println(\"Completed in $time ms\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿäº†è¿™æ ·çš„ä¸œè¥¿: 12The answer is 42Completed in 2017 ms å› æ­¤ï¼Œæˆ‘ä»¬å›åˆ°äº†é¡ºåºæ‰§è¡Œï¼Œå› ä¸ºæˆ‘ä»¬é¦–å…ˆstartå’Œawait oneï¼Œç„¶åæ˜¯twoã€‚å®ƒä¸æ˜¯ç”¨äºæ‡’æƒ°ç›®çš„çš„ç”¨ä¾‹ã€‚å½“è®¡ç®—å€¼æ¶‰åŠåˆ°æŒ‚èµ·å‡½æ•°æ—¶ï¼Œå®ƒè¢«è®¾è®¡ä¸ºæ›¿ä»£æ ‡å‡†çš„æƒ°æ€§å‡½æ•°ã€‚ å¼‚æ­¥å¼å‡½æ•°æˆ‘ä»¬å¯ä»¥å®šä¹‰å¼‚æ­¥å¼çš„å‡½æ•°ï¼Œä½¿ç”¨asyncåç¨‹æ„å»ºå™¨æ¥å¼‚æ­¥è°ƒç”¨doSomethingUsefulOneå’ŒdoSomethingUsefulTwoã€‚ç”¨â€asyncâ€å‰ç¼€æ¥å‘½åè¿™æ ·çš„å‡½æ•°æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œä»¥å¼ºè°ƒå®ƒä»¬åªå¯åŠ¨å¼‚æ­¥è®¡ç®—ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨äº§ç”Ÿçš„å»¶è¿Ÿå€¼æ¥è·å¾—ç»“æœã€‚ 123456789// asyncSomethingUsefulOneçš„ç»“æœç±»å‹æ˜¯Deferred&lt;Int&gt;fun asyncSomethingUsefulOne() = async &#123; doSomethingUsefulOne()&#125;// asyncSomethingUsefulTwoçš„ç»“æœç±»å‹æ˜¯Deferred&lt;Int&gt;fun asyncSomethingUsefulTwo() = async &#123; doSomethingUsefulTwo()&#125; æ³¨æ„ï¼Œè¿™äº›asyncXXXå‡½æ•°ä¸æ˜¯æŒ‚èµ·å‡½æ•°ã€‚å®ƒä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚ç„¶è€Œï¼Œå®ƒä»¬çš„ä½¿ç”¨æ€»æ˜¯æ„å‘³ç€å¯¹è°ƒç”¨ä»£ç çš„å¼‚æ­¥(è¿™é‡Œå³å¹¶å‘)æ‰§è¡Œã€‚ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä»–ä»¬åœ¨åç¨‹å¤–çš„ä½¿ç”¨: 1234567891011121314// æ³¨æ„ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å°†`runBlocking`æ”¾åœ¨`main`çš„å³è¾¹fun main(args: Array&lt;String&gt;) &#123; val time = measureTimeMillis &#123; // æˆ‘ä»¬å¯ä»¥åœ¨åç¨‹å¤–å¯åŠ¨å¼‚æ­¥æ“ä½œ val one = asyncSomethingUsefulOne() val two = asyncSomethingUsefulTwo() // ä½†æ˜¯ç­‰å¾…ç»“æœå¿…é¡»åŒ…æ‹¬æŒ‚èµ·æˆ–é˜»å¡. // è¿™é‡Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨`runBlocking &#123; ... &#125;`å—ç­‰å¾…ç»“æœ runBlocking &#123; println(\"The answer is $&#123;one.await() + two.await()&#125;\") &#125; &#125; println(\"Completed in $time ms\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  åç¨‹contextå’Œåˆ†æ´¾å™¨åç¨‹æ€»æ˜¯åœ¨æŸäº›contextä¸­æ‰§è¡Œï¼Œè¿™äº›contextç”±CoroutineContextç±»å‹çš„å€¼æ¥è¡¨ç¤ºï¼Œè¿™æ˜¯åœ¨Kotlinæ ‡å‡†åº“ä¸­å®šä¹‰çš„ã€‚ åç¨‹contextæ˜¯ä¸€ç»„ä¸åŒçš„å…ƒç´ ã€‚ä¸»è¦çš„å…ƒç´ æ˜¯æˆ‘ä»¬ä¹‹å‰è§è¿‡çš„åç¨‹çš„Jobï¼Œä»¥åŠå®ƒçš„åˆ†æ´¾å™¨ï¼Œå®ƒåœ¨è¿™ä¸€èŠ‚ä¸­ä»‹ç»ã€‚ åˆ†æ´¾å™¨å’Œçº¿ç¨‹åç¨‹contextåŒ…æ‹¬ä¸€ä¸ªåç¨‹åˆ†æ´¾å™¨(è¯·å‚é˜…CoroutineDispatcher)ï¼Œå®ƒå†³å®šäº†ç›¸åº”çš„åç¨‹æ‰§è¡Œçš„çº¿ç¨‹æˆ–çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µã€‚åç¨‹åˆ†æ´¾å™¨å¯ä»¥å°†åç¨‹æ‰§è¡Œé™åˆ¶åœ¨ç‰¹å®šçš„çº¿ç¨‹ä¸­ï¼Œå°†å…¶åˆ†æ´¾åˆ°çº¿ç¨‹æ± ä¸­ï¼Œæˆ–è€…è®©å®ƒä¸å—é™åˆ¶åœ°è¿è¡Œã€‚ åƒlaunchå’Œasyncè¿™æ ·çš„æ„å»ºå™¨éƒ½å¯ä»¥æ¥å—ä¸€ä¸ªå¯é€‰çš„CoroutineContextå‚æ•°ï¼Œè¯¥å‚æ•°å¯ç”¨äºæ˜¾å¼åœ°ä¸ºæ–°çš„åç¨‹å’Œå…¶ä»–contextå…ƒç´ æŒ‡å®šåˆ†æ´¾å™¨ã€‚ è¯•è¯•ä¸‹é¢çš„ä¾‹å­: 12345678910111213141516fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val jobs = arrayListOf&lt;Job&gt;() jobs += launch(Unconfined) &#123; // ä¸å—é™åˆ¶â€”â€”å°†å·¥ä½œåœ¨ä¸»çº¿ç¨‹ println(\" 'Unconfined': I'm working in thread $&#123;Thread.currentThread().name&#125;\") &#125; jobs += launch(coroutineContext) &#123; // çˆ¶ccontextï¼ŒrunBlocking åç¨‹ println(\"'coroutineContext': I'm working in thread $&#123;Thread.currentThread().name&#125;\") &#125; jobs += launch(CommonPool) &#123; // å°†è¢«åˆ†æ´¾åˆ°ForkJoinPool.commonPool(æˆ–åŒç­‰çš„) println(\" 'CommonPool': I'm working in thread $&#123;Thread.currentThread().name&#125;\") &#125; jobs += launch(newSingleThreadContext(\"MyOwnThread\")) &#123; // å°†å¾—åˆ°å®ƒè‡ªå·±çš„æ–°çº¿ç¨‹ println(\" 'newSTC': I'm working in thread $&#123;Thread.currentThread().name&#125;\") &#125; jobs.forEach &#123; it.join() &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿä»¥ä¸‹è¾“å‡º(å¯èƒ½é¡ºåºä¸åŒ): 1234 &apos;Unconfined&apos;: I&apos;m working in thread main &apos;CommonPool&apos;: I&apos;m working in thread ForkJoinPool.commonPool-worker-1 &apos;newSTC&apos;: I&apos;m working in thread MyOwnThread&apos;coroutineContext&apos;: I&apos;m working in thread main æˆ‘ä»¬åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­ä½¿ç”¨çš„ç¼ºçœåˆ†æ´¾å™¨æ˜¯DefaultDispatcherï¼Œå®ƒç­‰äºå½“å‰å®ç°ä¸­çš„CommonPoolã€‚å› æ­¤ï¼Œlaunch { ... } ä¸launch(DefaultDispather) { ... }ç›¸åŒï¼Œä¸launch(CommonPool) { ... }ç›¸åŒã€‚ ç¨åå°†æ˜¾ç¤ºcoroutineContextçˆ¶ç±»ä¸éçº¦æŸcontextä¹‹é—´çš„åŒºåˆ« æ³¨æ„ï¼ŒnewSingleThreadContextåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜‚è´µçš„èµ„æºã€‚åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒå¿…é¡»åœ¨ä¸å†éœ€è¦æ—¶é‡Šæ”¾ï¼Œä½¿ç”¨closeå‡½æ•°ï¼Œæˆ–è€…å­˜å‚¨åœ¨é¡¶çº§å˜é‡ä¸­ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­é‡ç”¨ã€‚ éé™åˆ¶ vs é™åˆ¶ åˆ†æ´¾å™¨éé™åˆ¶(Unconfined)çš„åç¨‹åˆ†æ´¾å™¨åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­å¯åŠ¨äº†åç¨‹ï¼Œä½†ç›´åˆ°ç¬¬ä¸€ä¸ªæŒ‚èµ·ç‚¹æ‰å¼€å§‹ã€‚æŒ‚èµ·ä¹‹åï¼Œå®ƒåœ¨è¢«è°ƒç”¨çš„æŒ‚èµ·å‡½æ•°å®Œå…¨ç¡®å®šçš„çº¿ç¨‹ä¸­æ¢å¤ã€‚å½“åç¨‹ä¸æ¶ˆè€—CPUæ—¶é—´æˆ–æ›´æ–°ä»»ä½•é™åˆ¶åœ¨ç‰¹å®šçº¿ç¨‹çš„å…±äº«æ•°æ®(å¦‚UI)æ—¶ï¼Œéé™åˆ¶åˆ†æ´¾å™¨æ˜¯åˆé€‚çš„ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥é€šè¿‡CoroutineScopeæ¥å£åœ¨ä»»ä½•åç¨‹çš„å—ä¸­ä½¿ç”¨çš„coroutineContextå±æ€§ï¼Œæ˜¯å¯¹è¿™ä¸ªç‰¹å®šçš„åç¨‹çš„contextçš„å¼•ç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ç»§æ‰¿çˆ¶contextã€‚ç‰¹åˆ«æ˜¯ï¼ŒrunBlocking åç¨‹çš„ç¼ºçœè°ƒåº¦ç¨‹åºè¢«é™åˆ¶åœ¨è°ƒç”¨ç¨‹åºçº¿ç¨‹ä¸­ï¼Œå› æ­¤ç»§æ‰¿å®ƒçš„ä½œç”¨æ˜¯å°†æ‰§è¡Œé™åˆ¶åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­ï¼Œå¹¶å…·æœ‰å¯é¢„æµ‹çš„FIFOè°ƒåº¦ã€‚ 1234567891011121314fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val jobs = arrayListOf&lt;Job&gt;() jobs += launch(Unconfined) &#123; // ä¸å—é™åˆ¶â€”â€”ä¸»è¦çº¿ç¨‹çš„å·¥ä½œ println(\" 'Unconfined': I'm working in thread $&#123;Thread.currentThread().name&#125;\") delay(500) println(\" 'Unconfined': After delay in thread $&#123;Thread.currentThread().name&#125;\") &#125; jobs += launch(coroutineContext) &#123; // çˆ¶ccontextï¼ŒrunBlocking åç¨‹ println(\"'coroutineContext': I'm working in thread $&#123;Thread.currentThread().name&#125;\") delay(1000) println(\"'coroutineContext': After delay in thread $&#123;Thread.currentThread().name&#125;\") &#125; jobs.forEach &#123; it.join() &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒäº§ç”Ÿä»¥ä¸‹è¾“å‡º(å¯èƒ½é¡ºåºä¸åŒ): 1234 &apos;Unconfined&apos;: I&apos;m working in thread main&apos;coroutineContext&apos;: I&apos;m working in thread main &apos;Unconfined&apos;: After delay in thread kotlinx.coroutines.DefaultExecutor&apos;coroutineContext&apos;: After delay in thread main å› æ­¤ï¼Œç»§æ‰¿äº†runBlocking {â€¦} åç¨‹çš„coroutineContext ç»§ç»­åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè€Œæœªé™åˆ¶çš„çº¿ç¨‹åˆ™åœ¨é»˜è®¤çš„æ‰§è¡Œç¨‹åºçº¿ç¨‹ä¸­æ¢å¤ï¼Œè€Œdelayå‡½æ•°æ­£åœ¨ä½¿ç”¨è¯¥çº¿ç¨‹ã€‚ è°ƒè¯•åç¨‹å’Œçº¿ç¨‹åç¨‹å¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸ŠæŒ‚èµ·ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šä½¿ç”¨éé™åˆ¶(Unconfined)åˆ†æ´¾å™¨æˆ–é»˜è®¤çš„å¤šçº¿ç¨‹åˆ†æ´¾å™¨ã€‚å³ä½¿æ˜¯å•çº¿ç¨‹çš„åˆ†æ´¾å™¨ï¼Œä¹Ÿå¾ˆéš¾å¼„æ¸…æ¥šåç¨‹åœ¨åšä»€ä¹ˆï¼Œåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œä»€ä¹ˆæ—¶å€™åšä»€ä¹ˆã€‚ä½¿ç”¨çº¿ç¨‹è°ƒè¯•åº”ç”¨ç¨‹åºçš„å¸¸ç”¨æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ—¥å¿—è¯­å¥çš„æ—¥å¿—æ–‡ä»¶ä¸­æ‰“å°çº¿ç¨‹åã€‚è¿™ä¸ªç‰¹æ€§å¾—åˆ°äº†æ—¥å¿—æ¡†æ¶çš„å¹¿æ³›æ”¯æŒã€‚åœ¨ä½¿ç”¨åç¨‹æ—¶ï¼Œçº¿ç¨‹åç§°æœ¬èº«å¹¶æ²¡æœ‰æä¾›å¤ªå¤šcontextï¼Œæ‰€ä»¥kotlinx.coroutinesåŒ…æ‹¬è°ƒè¯•å·¥å…·ï¼Œä½¿å…¶æ›´å®¹æ˜“ã€‚ è¿è¡Œä¸‹é¢çš„ä»£ç ä½¿ç”¨-Dkotlinx.coroutines.debug JVMé€‰é¡¹: 12345678910111213fun log(msg: String) = println(\"[$&#123;Thread.currentThread().name&#125;] $msg\")fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val a = async(coroutineContext) &#123; log(\"I'm computing a piece of the answer\") 6 &#125; val b = async(coroutineContext) &#123; log(\"I'm computing another piece of the answer\") 7 &#125; log(\"The answer is $&#123;a.await() * b.await()&#125;\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æœ‰ä¸‰ä¸ªåç¨‹ã€‚ä¸»è¦çš„åç¨‹(#1)â€”â€” ä¸€ä¸ªrunBlockingï¼Œå’Œä¸¤ä¸ªåç¨‹è®¡ç®—deferredå€¼a(#2)å’Œb(#3)ã€‚å®ƒä»¬éƒ½æ˜¯åœ¨runBlockingä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä»…é™äºä¸»çº¿ç¨‹ã€‚è¿™æ®µä»£ç çš„è¾“å‡ºæ˜¯: 123[main @coroutine#2] I&apos;m computing a piece of the answer[main @coroutine#3] I&apos;m computing another piece of the answer[main @coroutine#1] The answer is 42 æ—¥å¿—å‡½æ•°åœ¨æ–¹æ‹¬å·ä¸­æ‰“å°å‡ºçº¿ç¨‹çš„åç§°ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ˜¯ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯å½“å‰æ‰§è¡Œçš„åç¨‹çš„æ ‡è¯†ç¬¦è¢«é™„åŠ ã€‚å½“æ‰“å¼€è°ƒè¯•æ¨¡å¼æ—¶ï¼Œè¿™ä¸ªæ ‡è¯†ç¬¦è¢«è¿ç»­åœ°åˆ†é…ç»™æ‰€æœ‰åˆ›å»ºçš„åç¨‹ã€‚ æ‚¨å¯ä»¥åœ¨newCoroutineContextå‡½æ•°çš„æ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šå…³äºè°ƒè¯•å·¥å…·çš„ä¿¡æ¯ã€‚ çº¿ç¨‹ä¹‹é—´è·³è½¬è¿è¡Œä¸‹é¢çš„ä»£ç ä½¿ç”¨-Dkotlinx.coroutines.debug JVMé€‰é¡¹: 123456789101112131415fun log(msg: String) = println(\"[$&#123;Thread.currentThread().name&#125;] $msg\")fun main(args: Array&lt;String&gt;) &#123; newSingleThreadContext(\"Ctx1\").use &#123; ctx1 -&gt; newSingleThreadContext(\"Ctx2\").use &#123; ctx2 -&gt; runBlocking(ctx1) &#123; log(\"Started in ctx1\") run(ctx2) &#123; log(\"Working in ctx2\") &#125; log(\"Back to ctx1\") &#125; &#125; &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒæ¼”ç¤ºäº†å‡ ç§æ–°æŠ€æœ¯ã€‚ä¸€ä¸ªæ˜¯ä½¿ç”¨runBlockingå’Œä¸€ä¸ªæ˜¾å¼æŒ‡å®šçš„contextï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨runå‡½æ•°æ¥æ›´æ”¹ä¸€ä¸ªåç¨‹çš„ä¸Šä¸‹æ–‡ï¼ŒåŒæ—¶ä»ç„¶ä¿æŒåœ¨ç›¸åŒçš„åç¨‹ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º: 123[Ctx1 @coroutine#1] Started in ctx1[Ctx2 @coroutine#1] Working in ctx2[Ctx1 @coroutine#1] Back to ctx1 æ³¨æ„ï¼Œè¿™ä¸ªä¾‹å­ä¹Ÿä½¿ç”¨äº†æ¥è‡ªKotlinæ ‡å‡†åº“çš„useå‡½æ•°æ¥é‡Šæ”¾é‚£äº›åœ¨ä¸éœ€è¦æ—¶åˆ›å»ºçš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹æ˜¯ç”¨newSingleThreadContextåˆ›å»ºçš„ã€‚ contextä¸­çš„jobåç¨‹çš„Jobæ˜¯å…¶contextçš„ä¸€éƒ¨åˆ†ã€‚åç¨‹å¯ä»¥ä½¿ç”¨coroutineContext[Job]è¡¨è¾¾å¼ä»è‡ªå·±çš„contextä¸­æ£€ç´¢å®ƒï¼š 123fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; println(\"My job is $&#123;coroutineContext[Job]&#125;\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å½“åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿè¿™æ ·çš„ä¸œè¥¿: 1My job is &quot;coroutine#1&quot;:BlockingCoroutine&#123;Active&#125;@6d311334 å› æ­¤ï¼Œåœ¨CoroutineScopeä¸­ï¼ŒisActiveæ˜¯coroutineContext[Job]çš„ä¸€ä¸ªä¾¿æ·çš„å¿«æ·æ–¹å¼!! å­åç¨‹å½“ä¸€ä¸ªåç¨‹çš„coroutineContextè¢«ç”¨æ¥launchå¦ä¸€ä¸ªåç¨‹æ—¶ï¼Œæ–°çš„åç¨‹jobå°±å˜æˆäº†çˆ¶æ¯çš„å­Jobã€‚å½“çˆ¶åç¨‹è¢«å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰çš„å­åç¨‹ä¹Ÿä¼šè¢«é€’å½’åœ°å–æ¶ˆã€‚ 123456789101112131415161718192021222324fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; // launch a coroutine to process some kind of incoming request val request = launch &#123; // it spawns two other jobs, one with its separate context val job1 = launch &#123; println(\"job1: I have my own context and execute independently!\") delay(1000) println(\"job1: I am not affected by cancellation of the request\") &#125; // and the other inherits the parent context val job2 = launch(coroutineContext) &#123; println(\"job2: I am a child of the request coroutine\") delay(1000) println(\"job2: I will not execute this line if my parent request is cancelled\") &#125; // request completes when both its sub-jobs complete: job1.join() job2.join() &#125; delay(500) request.cancel() // cancel processing of the request delay(1000) // delay a second to see what happens println(\"main: Who has survived request cancellation?\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„è¾“å‡ºæ˜¯: 1234567891011121314151617181920212223242526272829job1: I have my own context and execute independently!job2: I am a child of the request coroutinejob1: I am not affected by cancellation of the requestmain: Who has survived request cancellation?``` ### &lt;a name=&quot;combining_contexts&quot;&gt;&lt;/a&gt;ç»„åˆcontextsä½¿ç”¨`+`æ“ä½œç¬¦å¯ä»¥ç»„åˆä½¿ç”¨åç¨‹contextsã€‚å³è¾¹çš„contextsæ›¿æ¢äº†å·¦è¾¹çš„contextsçš„ç›¸å…³æ¡ç›®ã€‚ä¾‹å¦‚ï¼Œçˆ¶Jobå¯ä»¥è¢«ç»§æ‰¿ï¼Œè€Œå®ƒçš„åˆ†æ´¾å™¨æ›¿æ¢äº†:```kotlinfun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; // å¯åŠ¨ä¸€ä¸ªåç¨‹æ¥å¤„ç†æŸç§ç±»å‹çš„ä¼ å…¥è¯·æ±‚ val request = launch(coroutineContext) &#123; // ä½¿ç”¨`runBlocking`context // åœ¨CommonPoolä¸­ç”Ÿæˆcpuå¯†é›†å‹çš„å­job !!! val job = launch(coroutineContext + CommonPool) &#123; println(&quot;job: I am a child of the request coroutine, but with a different dispatcher&quot;) delay(1000) println(&quot;job: I will not execute this line if my parent request is cancelled&quot;) &#125; job.join() // å½“å®ƒçš„å­jobå®Œæˆæ—¶ï¼Œè¯·æ±‚å°±å®Œæˆäº† &#125; delay(500) request.cancel() // å–æ¶ˆå¯¹è¯·æ±‚çš„å¤„ç† delay(1000) // å»¶è¿Ÿä¸€ç§’çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ println(&quot;main: Who has survived request cancellation?&quot;)&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„é¢„æœŸç»“æœæ˜¯: 12job: I am a child of the request coroutine, but with a different dispatchermain: Who has survived request cancellation? çˆ¶åç¨‹è´£ä»»ä¸€ä¸ªçˆ¶åç¨‹æ€»æ˜¯ç­‰å¾…æ‰€æœ‰å­©å­çš„å®Œæˆã€‚çˆ¶åç¨‹ä¸å¿…æ˜¾å¼åœ°è·Ÿè¸ªå®ƒå¯åŠ¨çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå®ƒä¹Ÿä¸å¿…ä½¿ç”¨Job.joinåœ¨æœ€åç­‰å¾…å®ƒä»¬: 1234567891011121314fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; // launch a coroutine to process some kind of incoming request val request = launch &#123; repeat(3) &#123; i -&gt; // launch a few children jobs launch(coroutineContext) &#123; delay((i + 1) * 200L) // variable delay 200ms, 400ms, 600ms println(\"Coroutine $i is done\") &#125; &#125; println(\"request: I'm done and I don't explicitly join my children that are still active\") &#125; request.join() // wait for completion of the request, including all its children println(\"Now processing of the request is complete\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ç»“æœå°†æ˜¯: 12345request: I&apos;m done and I don&apos;t explicitly join my children that are still activeCoroutine 0 is doneCoroutine 1 is doneCoroutine 2 is doneNow processing of the request is complete å‘½ååç¨‹çš„è°ƒè¯•è‡ªåŠ¨åˆ†é…çš„idé€šå¸¸éƒ½å¾ˆå¥½ï¼Œè€Œä¸”æ‚¨åªéœ€è¦å°†æ¥è‡ªç›¸åŒçš„åç¨‹çš„æ—¥å¿—è®°å½•å…³è”èµ·æ¥ã€‚ç„¶è€Œï¼Œå½“åç¨‹ä¸ç‰¹å®šçš„è¯·æ±‚æˆ–ç‰¹å®šçš„åå°ä»»åŠ¡ç»‘å®šæ—¶ï¼Œä¸ºè°ƒè¯•çš„ç›®çš„ï¼Œæœ€å¥½å°†å…¶å‘½åã€‚CoroutineName contextå…ƒç´ æä¾›äº†ä¸çº¿ç¨‹åç§°ç›¸åŒçš„åŠŸèƒ½ã€‚å½“è°ƒè¯•æ¨¡å¼æ‰“å¼€æ—¶ï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨çº¿ç¨‹åç§°ä¸­ï¼Œè¯¥åç§°å°†æ‰§è¡Œè¿™ä¸ªåç¨‹ã€‚ ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†è¿™ä¸ªæ¦‚å¿µ: 1234567891011121314151617fun log(msg: String) = println(\"[$&#123;Thread.currentThread().name&#125;] $msg\")fun main(args: Array&lt;String&gt;) = runBlocking(CoroutineName(\"main\")) &#123; log(\"Started main coroutine\") // run two background value computations val v1 = async(CoroutineName(\"v1coroutine\")) &#123; delay(500) log(\"Computing v1\") 252 &#125; val v2 = async(CoroutineName(\"v2coroutine\")) &#123; delay(1000) log(\"Computing v2\") 6 &#125; log(\"The answer for v1 / v2 = $&#123;v1.await() / v2.await()&#125;\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¾“å‡ºå®ƒäº§ç”Ÿä½¿ç”¨-Dkotlinx.coroutines.debug JVMé€‰é¡¹ç±»ä¼¼äº: 1234[main @main#1] Started main coroutine[ForkJoinPool.commonPool-worker-1 @v1coroutine#2] Computing v1[ForkJoinPool.commonPool-worker-2 @v2coroutine#3] Computing v2[main @main#1] The answer for v1 / v2 = 42 æ˜¾å¼å–æ¶ˆJobè®©æˆ‘ä»¬æŠŠå…³äºcontextsã€childrenå’Œjobsçš„çŸ¥è¯†æ”¾åœ¨ä¸€èµ·ã€‚å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªå…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡ä¸æ˜¯ä¸€ä¸ªåç¨‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨Android activityçš„ç¯å¢ƒä¸­launchå„ç§å„æ ·çš„åç¨‹ï¼Œä»¥æ‰§è¡Œå¼‚æ­¥æ“ä½œæ¥è·å–å’Œæ›´æ–°æ•°æ®ã€æ‰§è¡ŒåŠ¨ç”»ç­‰ç­‰ã€‚å½“æ´»åŠ¨è¢«ç ´åä»¥é¿å…å†…å­˜æ³„æ¼æ—¶ï¼Œå¿…é¡»å–æ¶ˆæ‰€æœ‰è¿™äº›åç¨‹ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„Jobå®ä¾‹æ¥ç®¡ç†æˆ‘ä»¬çš„åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸€ä¸ªjobå®ä¾‹æ˜¯ä½¿ç”¨job()å·¥å‚å‡½æ•°åˆ›å»ºçš„ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿æ‰€æœ‰çš„åç¨‹éƒ½æ˜¯åœ¨è¿™ä¸ªjobçš„contextä¸‹å¯åŠ¨çš„ã€‚ç„¶åï¼Œä¸€æ¬¡Job.cancelè°ƒç”¨å°±ä¼šç»ˆæ­¢å®ƒä»¬ã€‚æ­¤å¤–,Job.joinç­‰å¾…å®ƒä»¬æ‰€æœ‰å®Œæˆï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æœ¬ä¾‹ä¸­ä½¿ç”¨cancelAndJoin: 123456789101112131415fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val job = Job() // åˆ›å»ºä¸€ä¸ªjobå¯¹è±¡æ¥ç®¡ç†æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸ // ç°åœ¨launch 10ä¸ªcoroutinesï¼Œæ¯ä¸ªéƒ½åœ¨ä¸åŒçš„æ—¶é—´å·¥ä½œ val coroutines = List(10) &#123; i -&gt; // ä»–ä»¬éƒ½æ˜¯æˆ‘ä»¬å·¥ä½œå¯¹è±¡çš„å­©å­ launch(coroutineContext + job) &#123; // æˆ‘ä»¬ä½¿ç”¨main runBlockingçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„jobå¯¹è±¡ delay((i + 1) * 200L) // variable delay 200ms, 400ms, ... etc println(\"Coroutine $i is done\") &#125; &#125; println(\"Launched $&#123;coroutines.size&#125; coroutines\") delay(500L) // å»¶è¿ŸåŠç§’ println(\"Cancelling the job!\") job.cancelAndJoin() // å–æ¶ˆæ‰€æœ‰çš„åç¨‹ï¼Œç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆ&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™ä¸ªä¾‹å­çš„è¾“å‡ºæ˜¯: 1234Launched 10 coroutinesCoroutine 0 is doneCoroutine 1 is doneCancelling the job! æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œåªæœ‰å‰ä¸‰ä¸ªåç¨‹æ‰“å°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œå…¶ä»–çš„åˆ™è¢«å•æ¬¡è°ƒç”¨job.cancelAndJoin()å–æ¶ˆäº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å‡æƒ³çš„Androidåº”ç”¨ç¨‹åºä¸­æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨åˆ›å»ºactivityæ—¶åˆ›å»ºçˆ¶Jobå¯¹è±¡ï¼Œå°†å…¶ç”¨äºå­èŠ‚ç‚¹ï¼Œå¹¶åœ¨æ´»åŠ¨destroyedæ—¶å–æ¶ˆå®ƒã€‚æˆ‘ä»¬ä¸èƒ½åœ¨Androidç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µä¸‹joinå®ƒä»¬ï¼Œå› ä¸ºå®ƒæ˜¯åŒæ­¥çš„ï¼Œä½†æ˜¯å½“æ„å»ºåç«¯æœåŠ¡ä»¥ç¡®ä¿æœ‰ç•Œçš„èµ„æºä½¿ç”¨æ—¶ï¼Œè¿™ç§è¿æ¥èƒ½åŠ›æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ é€šé“Deferredå€¼æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨åç¨‹ä¹‹é—´ä¼ é€’å•ä¸ªå€¼ã€‚é€šé“æä¾›äº†ä¸€ç§ä¼ è¾“æ•°æ®æµçš„æ–¹æ³•ã€‚ é€šé“åŸºç¡€çŸ¥è¯†ä¸€ä¸ªé€šé“åœ¨æ¦‚å¿µä¸Šéå¸¸ç±»ä¼¼äºBlockingQueueã€‚ä¸€ä¸ªå…³é”®çš„åŒºåˆ«æ˜¯ï¼Œå®ƒç”¨æŒ‚èµ·çš„sendæ›¿ä»£é˜»å¡çš„putæ“ä½œï¼Œç”¨æŒ‚èµ·çš„receive æ›¿ä»£é˜»å¡çš„takeæ“ä½œã€‚ 12345678910fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val channel = Channel&lt;Int&gt;() launch &#123; // this might be heavy CPU-consuming computation or async logic, we'll just send five squares for (x in 1..5) channel.send(x * x) &#125; // here we print five received integers: repeat(5) &#123; println(channel.receive()) &#125; println(\"Done!\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„è¾“å‡ºæ˜¯: 1234561491625Done! é€šé“çš„å…³é—­å’Œè¿­ä»£ä¸é˜Ÿåˆ—ä¸åŒçš„æ˜¯ï¼Œé€šé“å¯ä»¥å…³é—­ï¼Œä»¥æŒ‡ç¤ºä¸å†æœ‰æ›´å¤šçš„å…ƒç´ å‡ºç°ã€‚åœ¨æ¥æ”¶ç«¯ï¼Œä½¿ç”¨å¸¸è§„çš„forå¾ªç¯ä»é€šé“æ¥æ”¶å…ƒç´ æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ ä»æ¦‚å¿µä¸Šè¯´ï¼Œcloseå°±åƒå‘é€šé“å‘é€ä¸€ä¸ªç‰¹æ®Šçš„å…³é—­ä»¤ç‰Œã€‚å½“æ¥æ”¶åˆ°è¿™ä¸ªå…³é—­ä»¤ç‰Œæ—¶ï¼Œè¿­ä»£å°±åœæ­¢äº†ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ‰€æœ‰ä¹‹å‰å‘é€çš„å…ƒç´ éƒ½è¢«æ¥æ”¶åˆ°: 12345678910fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val channel = Channel&lt;Int&gt;() launch &#123; for (x in 1..5) channel.send(x * x) channel.close() // we're done sending &#125; // here we print received values using `for` loop (until the channel is closed) for (y in channel) println(y) println(\"Done!\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æ„å»ºé€šé“ç”Ÿæˆå™¨åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ç§åç¨‹ç”Ÿæˆä¸€ç³»åˆ—å…ƒç´ çš„æ¨¡å¼æ˜¯å¾ˆå¸¸è§çš„ã€‚è¿™æ˜¯åœ¨å¹¶å‘ä»£ç ä¸­ç»å¸¸å‘ç°çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥å°†è¿™æ ·ä¸€ä¸ªç”Ÿæˆå™¨æŠ½è±¡ä¸ºä¸€ä¸ªä»¥é€šé“ä¸ºå‚æ•°çš„å‡½æ•°ï¼Œä½†è¿™ä¸é€šå¸¸çš„ç»“æœç›¸åï¼Œå³å¿…é¡»ä»å‡½æ•°è¿”å›ç»“æœã€‚æœ‰ä¸€ä¸ªåä¸ºproduceçš„ä¾¿åˆ©çš„åç¨‹æ„å»ºå™¨ï¼Œå®ƒä½¿å¾—åœ¨ç”Ÿäº§è€…ç«¯å¾ˆå®¹æ˜“åšï¼Œå¹¶ä¸”ä¸€ä¸ªæ‰©å±•å‡½æ•°consumeEachï¼Œå®ƒæ›¿ä»£äº†æ¶ˆè´¹è€…ç«¯çš„forå¾ªç¯: 123456789fun produceSquares() = produce&lt;Int&gt; &#123; for (x in 1..5) send(x * x)&#125;fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val squares = produceSquares() squares.consumeEach &#123; println(it) &#125; println(\"Done!\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ç®¡é“ç®¡é“æ˜¯ä¸€ç§æ¨¡å¼ï¼Œå…¶ä¸­ä¸€ç§å¯èƒ½æ˜¯æ— é™çš„å€¼æµ: 1234fun produceNumbers() = produce&lt;Int&gt; &#123; var x = 1 while (true) send(x++) // ä»1å¼€å§‹çš„æ— é™æ•´æ•°æµ&#125; å¦ä¸€ä¸ªåç¨‹æˆ–å¤šä¸ªåç¨‹æ­£åœ¨æ¶ˆè€—è¿™ä¸€æµï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œå¹¶äº§ç”Ÿä¸€äº›å…¶ä»–çš„ç»“æœã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ•°å­—æ˜¯å¹³æ–¹: 123fun square(numbers: ReceiveChannel&lt;Int&gt;) = produce&lt;Int&gt; &#123; for (x in numbers) send(x * x)&#125; ä¸»ç¨‹åºå¯åŠ¨å¹¶è¿æ¥æ•´ä¸ªç®¡é“: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val numbers = produceNumbers() // ä»1å’Œonç”Ÿæˆæ•´æ•° val squares = square(numbers) // æ•´æ•°å¹³æ–¹ for (i in 1..5) println(squares.receive()) // æ‰“å°å‰äº” println(\"Done!\") // we are done squares.cancel() // éœ€è¦åœ¨æ›´å¤§çš„åº”ç”¨ç¨‹åºä¸­å–æ¶ˆè¿™äº›åç¨‹ numbers.cancel()&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  æˆ‘ä»¬ä¸å¿…åœ¨è¿™ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­å–æ¶ˆè¿™äº›åç¨‹ï¼Œå› ä¸ºåç¨‹å°±åƒå®ˆæŠ¤çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªæ›´å¤§çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¸å†éœ€è¦å®ƒï¼Œæˆ‘ä»¬å°±éœ€è¦åœæ­¢æˆ‘ä»¬çš„ç®¡é“ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢çš„ä¾‹å­ä¸­æ¼”ç¤ºçš„é‚£æ ·ï¼Œå°†ç®¡é“åç¨‹ä½œä¸ºä¸»åç¨‹çš„å­©å­è¿è¡Œã€‚ ç”¨ç®¡é“æ±‚è´¨æ•°è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ç®¡é“çš„æç«¯æƒ…å†µï¼Œè¿™ä¸ªä¾‹å­å¯ä»¥ç”¨ä¸€ä¸ªç®¡é“æ¥ç”Ÿæˆè´¨æ•°ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªæ— é™çš„æ•°å­—åºåˆ—å¼€å§‹ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ˜¾å¼çš„contextå‚æ•°å¹¶å°†å…¶ä¼ é€’ç»™produceå»ºé€ è€…ï¼Œä»¥ä¾¿è°ƒç”¨è€…å¯ä»¥æ§åˆ¶æˆ‘ä»¬çš„åä½œç¨‹åºçš„è¿è¡Œä½ç½®: 1234fun numbersFrom(context: CoroutineContext, start: Int) = produce&lt;Int&gt;(context) &#123; var x = start while (true) send(x++) // ä»startå¼€å§‹çš„æ— é™æ•´æ•°æµ&#125; ä¸‹é¢çš„ç®¡é“é˜¶æ®µå°†è¿‡æ»¤ä¼ å…¥çš„æ•°å­—æµï¼Œåˆ é™¤å¯ä»¥è¢«ç»™å®šçš„ç´ æ•°æ•´é™¤çš„æ‰€æœ‰æ•°å­—: 123fun filter(context: CoroutineContext, numbers: ReceiveChannel&lt;Int&gt;, prime: Int) = produce&lt;Int&gt;(context) &#123; for (x in numbers) if (x % prime != 0) send(x)&#125; ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä»2å¯åŠ¨ä¸€ä¸ªæ•°å­—æµæ¥æ„å»ºæˆ‘ä»¬çš„ç®¡é“ï¼Œä»å½“å‰é€šé“ä¸­è·å–ä¸€ä¸ªè´¨æ•°ï¼Œå¹¶ä¸ºæ¯ä¸ªæ‰¾åˆ°çš„ç´ æ•°å¯åŠ¨æ–°çš„ç®¡é“é˜¶æ®µ: 1numbersFrom(2) -&gt; filter(2) -&gt; filter(3) -&gt; filter(5) -&gt; filter(7) ... ä¸‹é¢çš„ä¾‹å­è¾“å‡ºäº†å‰10ä¸ªç´ æ•°ï¼Œåœ¨ä¸»çº¿ç¨‹çš„contextä¸­è¿è¡Œæ•´ä¸ªç®¡é“ã€‚å› ä¸ºæ‰€æœ‰çš„åç¨‹éƒ½æ˜¯åœ¨coroutineContextä¸­ä½œä¸ºä¸»è¦çš„runBlockingåç¨‹çš„å­©å­å‘å¸ƒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å¯¹æˆ‘ä»¬å·²ç»å¼€å§‹çš„æ‰€æœ‰çš„åç¨‹æœ‰ä¸€ä¸ªæ˜ç¡®çš„åˆ—è¡¨ã€‚æˆ‘ä»¬ä½¿ç”¨cancelChildrenæ‰©å±•å‡½æ•°æ¥å–æ¶ˆæ‰€æœ‰çš„å­åç¨‹ã€‚ 123456789fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; var cur = numbersFrom(coroutineContext, 2) for (i in 1..10) &#123; val prime = cur.receive() println(prime) cur = filter(coroutineContext, cur, prime) &#125; coroutineContext.cancelChildren() // cancel all children to let main finish&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„è¾“å‡ºæ˜¯: 123456789102357111317192329 æ³¨æ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ªæ ‡å‡†åº“çš„æ„å»ºå™¨buildIteratoræ„å»ºç›¸åŒçš„ç®¡é“ã€‚ç”¨produceæ¢æˆbuildIteratorï¼Œsendæ¢æˆyieldï¼Œreceiveæ¢æˆnextï¼ŒReceiveChannel æ¢æˆIteratorï¼Œå¹¶æ‘†è„±contextã€‚æ‚¨ä¹Ÿä¸éœ€è¦runBlockingã€‚ä½†æ˜¯ï¼Œä½¿ç”¨é€šé“çš„ç®¡é“çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœåœ¨CommonPool contextä¸­è¿è¡Œå®ƒï¼Œå®ƒå®é™…ä¸Šå¯ä»¥ä½¿ç”¨å¤šä¸ªCPUå†…æ ¸ã€‚ æ— è®ºå¦‚ä½•ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸ä¸åˆ‡å®é™…çš„æ±‚è´¨æ•°çš„æ–¹æ³•ã€‚åœ¨å®è·µä¸­,ç®¡é“æ¶‰åŠä¸€äº›å…¶ä»–æŒ‚èµ·è°ƒç”¨(å¦‚å¼‚æ­¥è°ƒç”¨è¿œç¨‹æœåŠ¡),è¿™äº›ç®¡é“ä¸èƒ½ä½¿ç”¨buildSeqeunce/buildIterator,å› ä¸ºä»–ä»¬ä¸å…è®¸ä»»æ„æŒ‚èµ·,åƒproduce,è¿™æ˜¯å®Œå…¨å¼‚æ­¥çš„ã€‚ æ‰‡å‡ºå¤šä¸ªåç¨‹å¯ä»¥ä»ç›¸åŒçš„é€šé“æ¥æ”¶ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åˆ†é…å·¥ä½œã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªå®šæœŸäº§ç”Ÿæ•´æ•°çš„ç”Ÿäº§è€…(æ¯ç§’é’Ÿ10ä¸ªæ•°å­—)å¼€å§‹ã€‚ 1234567fun produceNumbers() = produce&lt;Int&gt; &#123; var x = 1 // start from 1 while (true) &#123; send(x++) // produce next delay(100) // wait 0.1s &#125;&#125; ç„¶åæˆ‘ä»¬å¯ä»¥æœ‰å‡ ä¸ªå¤„ç†å™¨çš„åç¨‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä»–ä»¬åªæ‰“å°ä»–ä»¬çš„idå’Œæ¥æ”¶çš„å·ç : 12345fun launchProcessor(id: Int, channel: ReceiveChannel&lt;Int&gt;) = launch &#123; channel.consumeEach &#123; println(\"Processor #$id received $it\") &#125; &#125; ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯åŠ¨5ä¸ªå¤„ç†å™¨ï¼Œè®©å®ƒä»¬å·¥ä½œå¤§çº¦ä¸€ç§’é’Ÿã€‚çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ: 123456fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val producer = produceNumbers() repeat(5) &#123; launchProcessor(it, producer) &#125; delay(950) producer.cancel() // cancel producer coroutine and thus kill them all&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¾“å‡ºå°†ç±»ä¼¼äºä¸‹é¢ä¸€ä¸ªï¼Œå°½ç®¡æ¥æ”¶æ¯ä¸ªç‰¹å®šæ•´æ•°çš„å¤„ç†å™¨idå¯èƒ½ä¸åŒ: 12345678910Processor #2 received 1Processor #4 received 2Processor #0 received 3Processor #1 received 4Processor #3 received 5Processor #2 received 6Processor #4 received 7Processor #0 received 8Processor #1 received 9Processor #3 received 10 è¯·æ³¨æ„ï¼Œå–æ¶ˆä¸€ä¸ªç”Ÿäº§å•†çš„åç¨‹ä¼šå…³é—­å®ƒçš„é€šé“ï¼Œä»è€Œæœ€ç»ˆç»ˆæ­¢å¤„ç†å™¨åç¨‹æ­£åœ¨è¿›è¡Œçš„é€šé“çš„è¿­ä»£ã€‚ æ‰‡å…¥å¤šä¸ªåç¨‹å¯ä»¥å‘é€åˆ°ç›¸åŒçš„é€šé“ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„é€šé“ï¼Œä»¥åŠä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå®ƒé€šè¿‡æŒ‡å®šçš„å»¶è¿Ÿå°†æŒ‡å®šçš„å­—ç¬¦ä¸²å‘é€åˆ°è¿™ä¸ªé€šé“ã€‚ 123456suspend fun sendString(channel: SendChannel&lt;String&gt;, s: String, time: Long) &#123; while (true) &#123; delay(time) channel.send(s) &#125;&#125; ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœæˆ‘ä»¬å¯åŠ¨äº†ä¸€å¯¹å‘é€å­—ç¬¦ä¸²çš„åç¨‹(åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­ä½œä¸ºä¸»åç¨‹çš„å­åç¨‹å¯åŠ¨å®ƒä»¬): 123456789fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val channel = Channel&lt;String&gt;() launch(coroutineContext) &#123; sendString(channel, \"foo\", 200L) &#125; launch(coroutineContext) &#123; sendString(channel, \"BAR!\", 500L) &#125; repeat(6) &#123; // æ¥æ”¶å‰å…­ println(channel.receive()) &#125; coroutineContext.cancelChildren() // cancel all children to let main finish&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒçš„è¾“å‡ºæ˜¯: 123456foofooBAR!foofooBAR! ç¼“å†²é€šé“åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€å±•ç¤ºçš„é€šé“æ²¡æœ‰ä»»ä½•ç¼“å†²ã€‚å½“å‘é€æ–¹å’Œæ¥æ”¶æ–¹ç›¸é‡æ—¶ï¼Œæ²¡æœ‰ç¼“å†²çš„é€šé“ä¼ è¾“å…ƒç´ (ä¹Ÿå°±æ˜¯ä¼šåˆç‚¹)ã€‚å¦‚æœé¦–å…ˆè°ƒç”¨sendï¼Œé‚£ä¹ˆå®ƒå°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°receiveè¢«è°ƒç”¨ï¼Œå¦‚æœé¦–å…ˆè°ƒç”¨receiveï¼Œå®ƒå°†è¢«æŒ‚èµ·ï¼Œç›´åˆ°sendè¢«è°ƒç”¨ã€‚ Channel()å·¥å‚å‡½æ•°å’Œproduceæ„å»ºå™¨éƒ½ä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„capacityå‚æ•°æ¥æŒ‡å®šç¼“å†²åŒºå¤§å°ã€‚ç¼“å†²åŒºå…è®¸å‘é€è€…åœ¨æŒ‚èµ·ä¹‹å‰å‘é€å¤šä¸ªå…ƒç´ ï¼Œç±»ä¼¼äºå…·æœ‰æŒ‡å®šå®¹é‡çš„BlockingQueueï¼Œåœ¨ç¼“å†²åŒºæ»¡æ—¶é˜»å¡ã€‚ çœ‹çœ‹ä»¥ä¸‹ä»£ç çš„è¡Œä¸º: 123456789101112fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val channel = Channel&lt;Int&gt;(4) // create buffered channel val sender = launch(coroutineContext) &#123; // launch sender coroutine repeat(10) &#123; println(\"Sending $it\") // print before sending each element channel.send(it) // will suspend when buffer is full &#125; &#125; // don't receive anything... just wait.... delay(1000) sender.cancel() // cancel sender coroutine&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒç”¨ä¸€ä¸ªæœ‰å››ä¸ªå®¹é‡çš„ç¼“å†²é€šé“æ‰“å°â€œå‘é€â€5æ¬¡: 12345Sending 0Sending 1Sending 2Sending 3Sending 4 å‰4ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ï¼Œå½“å‘é€ç¬¬5ä¸ªå…ƒç´ æ—¶ï¼Œå‘é€å™¨ä¼šæŒ‚èµ·ã€‚ é€šé“æ˜¯å…¬å¹³çš„å¯¹é€šé“çš„å‘é€å’Œæ¥æ”¶æ“ä½œæ˜¯å…¬å¹³çš„ï¼Œè¿™ä¸å®ƒä»¬ä»å¤šä¸ªåç¨‹è°ƒç”¨çš„é¡ºåºæ˜¯å…¬å¹³çš„ã€‚å®ƒä»¬ä»¥å…ˆå…¥å…ˆå‡ºçš„é¡ºåºæœåŠ¡ï¼Œä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªè°ƒç”¨æ¥æ”¶çš„åç¨‹è·å–å…ƒç´ ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªâ€œpingâ€å’Œâ€œpongâ€ä»å…±äº«çš„â€œtableâ€é€šé“æ¥æ”¶åˆ°â€œballâ€å¯¹è±¡ã€‚ 12345678910111213141516171819data class Ball(var hits: Int)fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val table = Channel&lt;Ball&gt;() // a shared table launch(coroutineContext) &#123; player(\"ping\", table) &#125; launch(coroutineContext) &#123; player(\"pong\", table) &#125; table.send(Ball(0)) // serve the ball delay(1000) // delay 1 second coroutineContext.cancelChildren() // game over, cancel them&#125;suspend fun player(name: String, table: Channel&lt;Ball&gt;) &#123; for (ball in table) &#123; // receive the ball in a loop ball.hits++ println(\"$name $ball\") delay(300) // wait a bit table.send(ball) // send the ball back &#125;&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  â€œpingâ€åç¨‹æ˜¯å…ˆå¼€å§‹çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯ç¬¬ä¸€ä¸ªæ”¶åˆ°çƒçš„ã€‚å³ä½¿åœ¨æŠŠçƒé€å›åˆ°tableçš„æ—¶å€™ï¼Œâ€pingâ€ åç¨‹é©¬ä¸Šåˆå¼€å§‹æ¥çƒï¼Œçƒå´è¢«â€pongâ€ åç¨‹ æ‰€æ¥æ”¶ï¼Œå› ä¸ºå®ƒå·²ç»åœ¨ç­‰å¾…å®ƒäº†ã€‚ 1234ping Ball(hits=1)pong Ball(hits=2)ping Ball(hits=3)pong Ball(hits=4) è¯·æ³¨æ„ï¼Œæœ‰æ—¶é€šé“å¯èƒ½ä¼šäº§ç”Ÿç”±äºæ­£åœ¨ä½¿ç”¨çš„æ‰§è¡Œå™¨çš„æ€§è´¨è€Œçœ‹èµ·æ¥ä¸å…¬å¹³çš„æ‰§è¡Œã€‚è¯·å‚é˜…è¿™ä¸ªé—®é¢˜çš„è¯¦ç»†ä¿¡æ¯ã€‚ å…±äº«çš„å¯å˜çŠ¶æ€å’Œå¹¶å‘æ€§å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹çš„åˆ†æ´¾å™¨å¹¶å‘åœ°æ‰§è¡Œåç¨‹ï¼Œæ¯”å¦‚é»˜è®¤çš„CommonPoolã€‚å®ƒå±•ç¤ºäº†æ‰€æœ‰å¸¸è§çš„å¹¶å‘é—®é¢˜ã€‚ä¸»è¦é—®é¢˜æ˜¯å¯¹å…±äº«æ˜“å˜çŠ¶æ€çš„è®¿é—®åŒæ­¥ã€‚è§£å†³è¿™ä¸€é—®é¢˜çš„æ–¹æ³•ä¸å¤šçº¿ç¨‹ä¸–ç•Œä¸­çš„è§£å†³æ–¹æ¡ˆç±»ä¼¼ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›æ˜¯ç‹¬ç‰¹çš„ã€‚ è¿™ä¸ªé—®é¢˜è®©æˆ‘ä»¬å‘åŠ¨ä¸€åƒæ¬¡çš„åç¨‹ï¼Œä¸€åƒæ¬¡åšåŒæ ·çš„æ“ä½œ(æ€»å…±æœ‰100ä¸‡æ¬¡æ‰§è¡Œ)ã€‚æˆ‘ä»¬è¿˜å°†æµ‹é‡ä»–ä»¬çš„å®Œæˆæ—¶é—´æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„æ¯”è¾ƒ: 12345678910111213suspend fun massiveRun(context: CoroutineContext, action: suspend () -&gt; Unit) &#123; val n = 1000 // number of coroutines to launch val k = 1000 // times an action is repeated by each coroutine val time = measureTimeMillis &#123; val jobs = List(n) &#123; launch(context) &#123; repeat(k) &#123; action() &#125; &#125; &#125; jobs.forEach &#123; it.join() &#125; &#125; println(\"Completed $&#123;n * k&#125; actions in $time ms\") &#125; æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸ç®€å•çš„åŠ¨ä½œå¼€å§‹ï¼Œå®ƒä½¿ç”¨å¤šçº¿ç¨‹çš„CommonPool contextæ¥å¢åŠ ä¸€ä¸ªå…±äº«çš„å¯å˜å˜é‡ã€‚ 12345678var counter = 0fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(CommonPool) &#123; counter++ &#125; println(\"Counter = $counter\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å®ƒæœ€åä¼šæ‰“å°ä»€ä¹ˆ?å®ƒä¸å¤ªå¯èƒ½æ‰“å°â€œè®¡æ•°å™¨=1000000â€ï¼Œå› ä¸º1000ä¸ªcoroutineså¯ä»¥åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹å¹¶è¡Œåœ°å¢åŠ è®¡æ•°å™¨ï¼Œè€Œä¸éœ€è¦ä»»ä½•åŒæ­¥ã€‚ æ³¨æ„:å¦‚æœæ‚¨çš„æ—§ç³»ç»Ÿä¸­æœ‰2ä¸ªæˆ–æ›´å°‘çš„cpuï¼Œé‚£ä¹ˆæ‚¨å°†å§‹ç»ˆçœ‹åˆ°1000000ï¼Œå› ä¸ºåœ¨æœ¬ä¾‹ä¸­ï¼ŒCommonPoolåªè¿è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚ä¸ºäº†é‡ç°è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦åšå‡ºä»¥ä¸‹çš„æ”¹å˜: 123456789val mtContext = newFixedThreadPoolContext(2, \"mtPool\") // explicitly define context with two threadsvar counter = 0fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(mtContext) &#123; // use it instead of CommonPool in this sample and below counter++ &#125; println(\"Counter = $counter\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  Volatilesæ¯«æ— ç”¨å¤„æœ‰ä¸€ç§å¸¸è§çš„è¯¯è§£æ˜¯ï¼Œvolatileå˜é‡å¯ä»¥è§£å†³å¹¶å‘æ€§é—®é¢˜ã€‚è®©æˆ‘ä»¬è¯•ä¸€è¯•: 123456789@Volatile // in Kotlin `volatile` is an annotation var counter = 0fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(CommonPool) &#123; counter++ &#125; println(\"Counter = $counter\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„å·¥ä½œé€Ÿåº¦è¾ƒæ…¢ï¼Œä½†æœ€ç»ˆæˆ‘ä»¬ä»ç„¶ä¸èƒ½å¾—åˆ°â€œCounter=1000000â€ï¼Œå› ä¸ºvolatileå˜é‡å¯ä»¥ä¿è¯çº¿æ€§åŒ–(è¿™æ˜¯â€œåŸå­â€çš„æŠ€æœ¯æœ¯è¯­)ï¼Œå¹¶å¯¹ç›¸åº”çš„å˜é‡è¿›è¡Œè¯»å†™æ“ä½œï¼Œä½†æ˜¯ä¸æä¾›æ›´å¤§çš„æ“ä½œçš„åŸå­æ€§(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯å¢åŠ çš„)ã€‚ çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„å¯¹äºçº¿ç¨‹å’Œåç¨‹å·¥ä½œçš„é€šç”¨è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„(å³åŒæ­¥çš„ã€çº¿æ€§åŒ–çš„æˆ–åŸå­çš„)æ•°æ®ç»“æ„ï¼Œä¸ºéœ€è¦åœ¨å…±äº«çŠ¶æ€ä¸Šæ‰§è¡Œçš„ç›¸åº”æ“ä½œæä¾›æ‰€æœ‰å¿…è¦çš„åŒæ­¥ã€‚åœ¨ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨AtomicIntegerç±»ï¼Œå®ƒå…·æœ‰åŸå­çš„é€’å¢æ“ä½œ: 12345678var counter = AtomicInteger()fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(CommonPool) &#123; counter.incrementAndGet() &#125; println(\"Counter = $&#123;counter.get()&#125;\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å¯¹äºè¿™ä¸ªç‰¹æ®Šçš„é—®é¢˜ï¼Œè¿™æ˜¯æœ€å¿«çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒé€‚ç”¨äºæ™®é€šçš„è®¡æ•°å™¨ã€é›†åˆã€é˜Ÿåˆ—å’Œå…¶ä»–æ ‡å‡†æ•°æ®ç»“æ„å’ŒåŸºæœ¬æ“ä½œã€‚ä½†æ˜¯ï¼Œå®ƒä¸å®¹æ˜“æ‰©å±•åˆ°å¤æ‚çš„çŠ¶æ€ï¼Œä¹Ÿä¸å®¹æ˜“æ‰©å±•åˆ°æ²¡æœ‰ç°æˆçš„çº¿ç¨‹å®‰å…¨å®ç°çš„å¤æ‚æ“ä½œã€‚ ç»†ç²’åº¦çº¿ç¨‹çº¦æŸçº¿ç¨‹çº¦æŸæ˜¯ä¸€ç§è§£å†³å…±äº«å¯å˜çŠ¶æ€é—®é¢˜çš„æ–¹æ³•ï¼Œåœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰å¯¹ç‰¹å®šå…±äº«çŠ¶æ€çš„è®¿é—®éƒ½è¢«é™åˆ¶åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚å®ƒé€šå¸¸åœ¨UIåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ‰€æœ‰çš„UIçŠ¶æ€éƒ½è¢«é™åˆ¶åœ¨å•ä¸€äº‹ä»¶åˆ†æ´¾/åº”ç”¨ç¨‹åºçº¿ç¨‹ä¸­ã€‚ä½¿ç”¨å•çº¿ç¨‹ä¸Šä¸‹æ–‡å¯ä»¥å¾ˆå®¹æ˜“åœ°åº”ç”¨äºåç¨‹ã€‚ 1234567891011val counterContext = newSingleThreadContext(\"CounterContext\")var counter = 0fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(CommonPool) &#123; // run each coroutine in CommonPool run(counterContext) &#123; // but confine each increment to the single-threaded context counter++ &#125; &#125; println(\"Counter = $counter\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç è¿è¡Œéå¸¸ç¼“æ…¢ï¼Œå› ä¸ºå®ƒæ‰§è¡Œç»†ç²’åº¦çš„çº¿ç¨‹é™åˆ¶ã€‚æ¯ä¸ªå•ç‹¬çš„é€’å¢ä»å¤šçº¿ç¨‹çš„CommonPoolä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°ä½¿ç”¨runå—çš„å•çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚ ç²—ç²’åº¦çº¿ç¨‹çº¦æŸåœ¨å®è·µä¸­ï¼Œçº¿ç¨‹çº¦æŸæ˜¯åœ¨å¤§å—ä¸­æ‰§è¡Œçš„ï¼Œä¾‹å¦‚ï¼ŒçŠ¶æ€æ›´æ–°ä¸šåŠ¡é€»è¾‘çš„å¤§ç‰‡æ®µè¢«é™åˆ¶åœ¨å•ä¸ªçº¿ç¨‹ä¸­ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯è¿™æ ·çš„ï¼Œåœ¨å•çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ¯ä¸ªåç¨‹ã€‚ 123456789val counterContext = newSingleThreadContext(\"CounterContext\")var counter = 0fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(counterContext) &#123; // run each coroutine in the single-threaded context counter++ &#125; println(\"Counter = $counter\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  ç°åœ¨çš„å·¥ä½œé€Ÿåº¦æ›´å¿«ï¼Œäº§ç”Ÿäº†æ­£ç¡®çš„ç»“æœã€‚ Mutexå¯¹äºè¿™ä¸ªé—®é¢˜çš„äº’æ–¥è§£å†³æ–¹æ¡ˆæ˜¯ä¿æŠ¤å…±äº«çŠ¶æ€çš„æ‰€æœ‰ä¿®æ”¹ï¼Œè€Œè¿™ä¸€å…³é”®éƒ¨åˆ†ä¸ä¼šåŒæ—¶æ‰§è¡Œã€‚åœ¨ä¸€ä¸ªé˜»å¡çš„ä¸–ç•Œä¸­ï¼Œæ‚¨é€šå¸¸ä¼šä½¿ç”¨synchronizedæˆ–ReentrantLockã€‚åç¨‹çš„é€‰æ‹©è¢«ç§°ä¸º Mutexã€‚å®ƒæœ‰lockå’Œunlockå‡½æ•°ï¼Œä»¥é™åˆ¶ä¸´ç•ŒåŒºã€‚å…³é”®çš„åŒºåˆ«åœ¨äºMutex.lockæ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ã€‚å®ƒä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚ è¿˜æœ‰withLockæ‰©å±•å‡½æ•°ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿åœ°è¡¨ç¤ºmutex.lock(); try { â€¦ } finally { mutex.unlock() } æ¨¡å¼: 1234567891011val mutex = Mutex()var counter = 0fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; massiveRun(CommonPool) &#123; mutex.withLock &#123; counter++ &#125; &#125; println(\"Counter = $counter\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™ä¸ªä¾‹å­ä¸­çš„é”å®šæ˜¯ç»†ç²’åº¦çš„ï¼Œå› æ­¤å®ƒä¼šä»˜å‡ºä»£ä»·ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œæ‚¨å¿…é¡»å®šæœŸä¿®æ”¹æŸäº›å…±äº«çŠ¶æ€ï¼Œä½†æ˜¯è¿™ä¸ªçŠ¶æ€å¹¶æ²¡æœ‰è¢«é™åˆ¶çš„è‡ªç„¶çº¿ç¨‹ã€‚ å‚ä¸è€…å‚ä¸è€…(actor)æ˜¯ä¸€ç§ç»“åˆåœ¨ä¸€èµ·çš„åç¨‹ï¼Œè¢«é™åˆ¶å’Œå‹ç¼©åˆ°è¿™ä¸ªåç¨‹çš„çŠ¶æ€ï¼Œä»¥åŠä¸€ä¸ªå¤–è”çš„æ²Ÿé€šæ¸ é“ã€‚ä¸€ä¸ªç®€å•çš„å‚ä¸è€…å¯ä»¥è¢«ç¼–å†™ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ä¸€ä¸ªå…·æœ‰å¤æ‚çŠ¶æ€çš„å‚ä¸è€…æ›´é€‚åˆäºä¸€ä¸ªç±»ã€‚ æœ‰ä¸€ä¸ªå‚ä¸è€…(actor)åç¨‹æ„å»ºå™¨ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿åœ°å°†å‚ä¸è€…çš„é‚®ç®±é€šé“ä¸å®ƒçš„èŒƒå›´ç›¸ç»“åˆï¼Œæ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶å°†å‘é€é€šé“ç»„åˆåˆ°äº§ç”Ÿçš„jobå¯¹è±¡ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å°†å•ä¸ªå¼•ç”¨ä½œä¸ºå®ƒçš„å¥æŸ„è¿›è¡Œä¼ é€’ã€‚ ä½¿ç”¨actorçš„ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰ä¸€ä¸ªå‚ä¸è€…å°†è¦å¤„ç†çš„æ¶ˆæ¯ç±»ã€‚Kotlinçš„sealed classeséå¸¸é€‚åˆè¿™ä¸ªç›®çš„ã€‚æˆ‘ä»¬å®šä¹‰CounterMsg sealedç±»ï¼Œå¹¶ä½¿ç”¨IncCounteræ¶ˆæ¯å¢åŠ è®¡æ•°å™¨å’ŒGetCounteræ¶ˆæ¯ä»¥è·å–å…¶å€¼ã€‚ç¨åéœ€è¦å‘é€å“åº”ã€‚ä¸€ä¸ªCompletableDeferredé€šä¿¡åŸè¯­ï¼Œè¡¨ç¤ºå°†æ¥ä¼šè¢«çŸ¥é“(é€šä¿¡)çš„ä¸€ä¸ªå•ä¸€å€¼ï¼Œç”¨äºæ­¤ç›®çš„ã€‚ 1234// æ¶ˆæ¯ç±»å‹ä¸ºcounterActorsealed class CounterMsgobject IncCounter : CounterMsg() // å¢é‡è®¡æ•°å™¨å•å‘æ¶ˆæ¯class GetCounter(val response: CompletableDeferred&lt;Int&gt;) : CounterMsg() // ä¸€ä¸ªè¯·æ±‚ä¸åº”ç­” ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨å‚ä¸è€…åç¨‹æ„å»ºå™¨å¯åŠ¨ä¸€ä¸ªå‚ä¸è€…: 12345678910// è¿™ä¸ªå‡½æ•°å°†å¯åŠ¨ä¸€ä¸ªæ–°çš„è®¡æ•°å™¨å‚ä¸è€…fun counterActor() = actor&lt;CounterMsg&gt; &#123; var counter = 0 // actor state for (msg in channel) &#123; // éå†ä¼ å…¥çš„æ¶ˆæ¯ when (msg) &#123; is IncCounter -&gt; counter++ is GetCounter -&gt; msg.response.complete(counter) &#125; &#125;&#125; ä¸»ç¨‹åºå¾ˆç®€å•: 1234567891011fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val counter = counterActor() // create the actor massiveRun(CommonPool) &#123; counter.send(IncCounter) &#125; // send a message to get a counter value from an actor val response = CompletableDeferred&lt;Int&gt;() counter.send(GetCounter(response)) println(\"Counter = $&#123;response.await()&#125;\") counter.close() // shutdown the actor&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  å‚ä¸è€…è‡ªå·±åœ¨ä»€ä¹ˆç¯å¢ƒä¸­è¢«æ‰§è¡Œ,è¿™å¹¶ä¸é‡è¦(å¯¹äºæ­£ç¡®æ€§)ã€‚ä¸€ä¸ªå‚ä¸è€…æ˜¯ä¸€ä¸ªåç¨‹ï¼Œè€Œä¸€ä¸ªåç¨‹æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œå› æ­¤å°†çŠ¶æ€é™åˆ¶åˆ°ç‰¹å®šçš„åç¨‹æ˜¯è§£å†³å…±äº«å¯å˜çŠ¶æ€é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚ Actoræ¯”åœ¨è´Ÿè½½ä¸‹é”å®šæ›´æœ‰æ•ˆï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ€»æ˜¯æœ‰å·¥ä½œè¦åšï¼Œè€Œä¸”å®ƒä¸éœ€è¦åˆ‡æ¢åˆ°ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªå‚ä¸è€…çš„åç¨‹æ„å»ºå™¨æ˜¯ä¸€ä¸ªç”Ÿäº§åç¨‹æ„å»ºå™¨çš„åŒé‡è§’è‰²ã€‚ä¸€ä¸ªå‚ä¸è€…ä¸å®ƒæ¥æ”¶æ¶ˆæ¯çš„é€šé“ç›¸å…³è”ï¼Œè€Œä¸€ä¸ªç”Ÿäº§è€…ä¸å®ƒå‘é€å…ƒç´ çš„é€šé“ç›¸å…³è”ã€‚ Selectè¡¨è¾¾å¼Selectè¡¨è¾¾å¼ä½¿å¾—å¯ä»¥åŒæ—¶ç­‰å¾…å¤šä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå¹¶é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„å‡½æ•°ã€‚ é€‰æ‹©é€šé“è®©æˆ‘ä»¬ä½œä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç”Ÿäº§è€…: fizzå’Œbuzzã€‚fizzç”Ÿäº§è€…æ¯300æ¯«ç§’å°±ä¼šäº§ç”Ÿâ€Fizzâ€çš„å­—ç¬¦ä¸²: 123456fun fizz(context: CoroutineContext) = produce&lt;String&gt;(context) &#123; while (true) &#123; // sends \"Fizz\" every 300 ms delay(300) send(\"Fizz\") &#125;&#125; buzzç”Ÿäº§è€…æ¯500æ¯«ç§’å°±ä¼šäº§ç”Ÿâ€Buzzâ€çš„å­—ç¬¦ä¸²: 123456fun buzz(context: CoroutineContext) = produce&lt;String&gt;(context) &#123; while (true) &#123; // sends \"Buzz!\" every 500 ms delay(500) send(\"Buzz!\") &#125;&#125; æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªé€šé“æˆ–å¦ä¸€ä¸ªé€šé“æ¥æ”¶æŒ‚èµ·å‡½æ•°ã€‚ä½†selectè¡¨è¾¾å¼å…è®¸æˆ‘ä»¬åŒæ—¶ä½¿ç”¨å®ƒçš„onReceiveå­å¥: 12345678910suspend fun selectFizzBuzz(fizz: ReceiveChannel&lt;String&gt;, buzz: ReceiveChannel&lt;String&gt;) &#123; select&lt;Unit&gt; &#123; // &lt;Unit&gt; means that this select expression does not produce any result fizz.onReceive &#123; value -&gt; // this is the first select clause println(\"fizz -&gt; '$value'\") &#125; buzz.onReceive &#123; value -&gt; // this is the second select clause println(\"buzz -&gt; '$value'\") &#125; &#125;&#125; è®©æˆ‘ä»¬æ¥è¿è¡Œå®ƒä¸ƒæ¬¡: 12345678fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val fizz = fizz(coroutineContext) val buzz = buzz(coroutineContext) repeat(7) &#123; selectFizzBuzz(fizz, buzz) &#125; coroutineContext.cancelChildren() // cancel fizz &amp; buzz coroutines &#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„ç»“æœæ˜¯: 1234567fizz -&gt; &apos;Fizz&apos;buzz -&gt; &apos;Buzz!&apos;fizz -&gt; &apos;Fizz&apos;fizz -&gt; &apos;Fizz&apos;buzz -&gt; &apos;Buzz!&apos;fizz -&gt; &apos;Fizz&apos;buzz -&gt; &apos;Buzz!&apos; å…³é—­æ—¶çš„selectå½“é€šé“å…³é—­æ—¶ï¼Œselectä¸­çš„onReceiveå­å¥å¤±è´¥ï¼Œç›¸åº”çš„selectæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å½“é€šé“å…³é—­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨onReceiveOrNullå­å¥æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚ä¸‹é¢çš„ç¤ºä¾‹è¿˜æ˜¾ç¤ºäº†selectæ˜¯è¿”å›å…¶æ‰€é€‰å­å¥çš„ç»“æœçš„è¡¨è¾¾å¼: 123456789101112131415suspend fun selectAorB(a: ReceiveChannel&lt;String&gt;, b: ReceiveChannel&lt;String&gt;): String = select&lt;String&gt; &#123; a.onReceiveOrNull &#123; value -&gt; if (value == null) \"Channel 'a' is closed\" else \"a -&gt; '$value'\" &#125; b.onReceiveOrNull &#123; value -&gt; if (value == null) \"Channel 'b' is closed\" else \"b -&gt; '$value'\" &#125; &#125; è®©æˆ‘ä»¬ç”¨é€šé“aç”Ÿæˆâ€œHelloâ€å­—ç¬¦ä¸²4æ¬¡ï¼Œè€Œbé€šé“ç”Ÿæˆâ€œWorldâ€4æ¬¡: 12345678910111213fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; // we are using the context of the main thread in this example for predictability ... val a = produce&lt;String&gt;(coroutineContext) &#123; repeat(4) &#123; send(\"Hello $it\") &#125; &#125; val b = produce&lt;String&gt;(coroutineContext) &#123; repeat(4) &#123; send(\"World $it\") &#125; &#125; repeat(8) &#123; // print first eight results println(selectAorB(a, b)) &#125; coroutineContext.cancelChildren() &#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¿™æ®µä»£ç çš„ç»“æœéå¸¸æœ‰è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨æ¨¡å¼ç»†èŠ‚ä¸Šè¿›è¡Œåˆ†æ: 12345678a -&gt; &apos;Hello 0&apos;a -&gt; &apos;Hello 1&apos;b -&gt; &apos;World 0&apos;a -&gt; &apos;Hello 2&apos;a -&gt; &apos;Hello 3&apos;b -&gt; &apos;World 1&apos;Channel &apos;a&apos; is closedChannel &apos;a&apos; is closed æœ‰å‡ æ¡è§‚å¯Ÿç»“æœå¯ä»¥è¯æ˜è¿™ä¸€ç‚¹ã€‚ é¦–å…ˆï¼Œselectå¯¹ç¬¬ä¸€ä¸ªå­å¥æœ‰åçˆ±ã€‚å½“å¤šä¸ªå­å¥åŒæ—¶å¯é€‰æ—¶ï¼Œå…¶ä¸­çš„ç¬¬ä¸€ä¸ªå­å¥è¢«é€‰ä¸­ã€‚åœ¨è¿™é‡Œï¼Œä¸¤ä¸ªé€šé“éƒ½åœ¨ä¸æ–­åœ°ç”Ÿæˆå­—ç¬¦ä¸²ï¼Œå› æ­¤ä¸€ä¸ªé€šé“ï¼Œä½œä¸ºselectä¸­çš„ç¬¬ä¸€ä¸ªå­å¥è·èƒœã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯éç¼“å†²é€šé“ï¼Œæ‰€ä»¥aåœ¨å‘é€è°ƒç”¨æ—¶è¢«æš‚æ—¶æŒ‚èµ·ï¼Œå¹¶ç»™bå‘é€äº†ä¸€ä¸ªæœºä¼šã€‚ ç¬¬äºŒä¸ªè§‚å¯Ÿç»“æœæ˜¯ï¼Œå½“é€šé“å·²ç»å…³é—­æ—¶ï¼ŒonReceiveOrNullä¼šç«‹å³è¢«é€‰ä¸­ã€‚ é€‰æ‹©å‘é€Selectè¡¨è¾¾å¼æœ‰onSendå­å¥ï¼Œå®ƒå¯ä»¥ç”¨äºå¾ˆå¥½çš„ç»„åˆå’Œé€‰æ‹©çš„åç½®æ€§ã€‚ è®©æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªä¾‹å­ï¼Œå½“åœ¨ä¸»é€šé“ä¸Šçš„æ¶ˆè´¹è€…æ— æ³•è·Ÿä¸Šæ—¶ï¼Œå°†å®ƒçš„å€¼å‘é€åˆ°ä¸€ä¸ªä¾§é€šé“çš„æ•´æ•°çš„ç”Ÿäº§è€…ã€‚ 123456789fun produceNumbers(context: CoroutineContext, side: SendChannel&lt;Int&gt;) = produce&lt;Int&gt;(context) &#123; for (num in 1..10) &#123; // ä»1åˆ°10äº§ç”Ÿ10ä¸ªæ•°å­— delay(100) // every 100 ms select&lt;Unit&gt; &#123; onSend(num) &#123;&#125; // å‘é€åˆ°ä¸»é€šé“ side.onSend(num) &#123;&#125; // æˆ–è€…æ˜¯ä¾§é€šé“ &#125; &#125;&#125; æ¶ˆè´¹è€…å°†ä¼šéå¸¸ç¼“æ…¢ï¼ŒèŠ±è´¹250æ¯«ç§’æ¥å¤„ç†æ¯ä¸€ä¸ªæ•°å­—: 123456789101112fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val side = Channel&lt;Int&gt;() // allocate side channel launch(coroutineContext) &#123; // è¿™æ˜¯ä¾§è¾¹é€šé“çš„ä¸€ä¸ªéå¸¸å¿«çš„æ¶ˆè´¹è€… side.consumeEach &#123; println(\"Side channel has $it\") &#125; &#125; produceNumbers(coroutineContext, side).consumeEach &#123; println(\"Consuming $it\") delay(250) // è®©æˆ‘ä»¬é€‚å½“åœ°æ¶ˆåŒ–æ‰€æ¶ˆè€—çš„æ•°å­—ï¼Œä¸è¦ç€æ€¥ &#125; println(\"Done consuming\") coroutineContext.cancelChildren() &#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è®©æˆ‘ä»¬çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ: 1234567891011Consuming 1Side channel has 2Side channel has 3Consuming 4Side channel has 5Side channel has 6Consuming 7Side channel has 8Side channel has 9Consuming 10Done consuming é€‰æ‹©deferredå€¼deferredå€¼å¯ä»¥ä½¿ç”¨onAwaitå­å¥æ¥é€‰æ‹©ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªå¼‚æ­¥å‡½æ•°å¼€å§‹ï¼Œè¯¥å‡½æ•°åœ¨éšæœºå»¶è¿Ÿä¹‹åè¿”å›deferredå­—ç¬¦ä¸²å€¼: 1234fun asyncString(time: Int) = async &#123; delay(time.toLong()) \"Waited for $time ms\"&#125; è®©æˆ‘ä»¬ç”¨éšæœºçš„å»¶è¿Ÿæ¥å¯åŠ¨ä¸€æ‰“: 1234fun asyncStringsList(): List&lt;Deferred&lt;String&gt;&gt; &#123; val random = Random(3) return List(12) &#123; asyncString(random.nextInt(1000)) &#125;&#125; ç°åœ¨ï¼Œä¸»å‡½æ•°å°†ç­‰å¾…ç¬¬ä¸€ä¸ªå‡½æ•°å®Œæˆå¹¶è®¡ç®—ä»ç„¶å¤„äºæ´»åŠ¨çŠ¶æ€çš„deferredå€¼çš„æ•°é‡ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»åœ¨è¿™é‡Œä½¿ç”¨äº†selectè¡¨è¾¾å¼æ˜¯ä¸€ä¸ªKotlin DSLï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„ä»£ç ä¸ºå®ƒæä¾›å­å¥ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿­ä»£äº†deferredå€¼çš„åˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªå»¶è¿Ÿå€¼æä¾›onAwaitå­å¥ã€‚ 12345678910111213fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val list = asyncStringsList() val result = select&lt;String&gt; &#123; list.withIndex().forEach &#123; (index, deferred) -&gt; deferred.onAwait &#123; answer -&gt; \"Deferred $index produced answer '$answer'\" &#125; &#125; &#125; println(result) val countActive = list.count &#123; it.isActive &#125; println(\"$countActive coroutines are still active\")&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¾“å‡ºæ˜¯: 12Deferred 4 produced answer &apos;Waited for 128 ms&apos;11 coroutines are still active åˆ‡æ¢åˆ°deferredå€¼çš„é€šé“è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªé€šé“ç”Ÿæˆå™¨å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨ä¸€ä¸ªdeferredå­—ç¬¦ä¸²å€¼çš„é€šé“ï¼Œç­‰å¾…æ¯ä¸ªæ¥æ”¶åˆ°çš„deferredå€¼ï¼Œä½†ç›´åˆ°ä¸‹ä¸€æ¬¡deferredæˆ–é€šé“è¢«å…³é—­æ—¶æ‰ä¼šå‡ºç°ã€‚è¿™ä¸ªç¤ºä¾‹å°†onReceiveOrNullå’ŒonAwaitå­å¥æ”¾åœ¨åŒä¸€ä¸ªselectå­å¥ä¸­: 1234567891011121314151617181920fun switchMapDeferreds(input: ReceiveChannel&lt;Deferred&lt;String&gt;&gt;) = produce&lt;String&gt; &#123; var current = input.receive() // start with first received deferred value while (isActive) &#123; // loop while not cancelled/closed val next = select&lt;Deferred&lt;String&gt;?&gt; &#123; // return next deferred value from this select or null input.onReceiveOrNull &#123; update -&gt; update // replaces next value to wait &#125; current.onAwait &#123; value -&gt; send(value) // send value that current deferred has produced input.receiveOrNull() // and use the next deferred from the input channel &#125; &#125; if (next == null) &#123; println(\"Channel was closed\") break // out of loop &#125; else &#123; current = next &#125; &#125;&#125; ä¸ºäº†æµ‹è¯•å®ƒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„asyncå‡½æ•°ï¼Œå®ƒåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åè§£æä¸ºæŒ‡å®šçš„å­—ç¬¦ä¸²: 1234fun asyncString(str: String, time: Long) = async &#123; delay(time) str&#125; ä¸»å‡½æ•°æ˜¯å¯åŠ¨ä¸€ä¸ªåç¨‹æ¥æ‰“å°å¼€å…³çš„ç»“æœï¼Œå¹¶å‘é€ä¸€äº›æµ‹è¯•æ•°æ®ç»™å®ƒ: 1234567891011121314151617fun main(args: Array&lt;String&gt;) = runBlocking&lt;Unit&gt; &#123; val chan = Channel&lt;Deferred&lt;String&gt;&gt;() // the channel for test launch(coroutineContext) &#123; // launch printing coroutine for (s in switchMapDeferreds(chan)) println(s) // print each received string &#125; chan.send(asyncString(\"BEGIN\", 100)) delay(200) // enough time for \"BEGIN\" to be produced chan.send(asyncString(\"Slow\", 500)) delay(100) // not enough time to produce slow chan.send(asyncString(\"Replace\", 100)) delay(500) // give it time before the last one chan.send(asyncString(\"END\", 500)) delay(1000) // give it time to process chan.close() // close the channel ... delay(500) // and wait some time to let it finish&#125; ä½ å¯ä»¥åœ¨è¿™é‡Œå¾—åˆ°å®Œæ•´çš„ä»£ç  è¾“å‡ºæ˜¯: 1234BEGINReplaceENDChannel was closed è¿›ä¸€æ­¥çš„é˜…è¯» ä½¿ç”¨åç¨‹çš„UIç¼–ç¨‹æŒ‡å— ä½¿ç”¨åç¨‹å“åº”å¼æµçš„æŒ‡å— åç¨‹è®¾è®¡æ–‡æ¡£(ä¿æŒ) å®Œæ•´çš„kotlinx.coroutines APIå‚è€ƒ","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"},{"name":"kotlinx.coroutines","slug":"kotlinx-coroutines","permalink":"https://jigangduan.github.io/tags/kotlinx-coroutines/"}]},{"title":"Anko åç¨‹","slug":"Anko-Coroutines","date":"2017-11-03T05:14:08.000Z","updated":"2020-07-25T02:57:18.148Z","comments":true,"path":"2017/11/03/Anko-Coroutines/","link":"","permalink":"https://jigangduan.github.io/2017/11/03/Anko-Coroutines/","excerpt":"ç›®å½• åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨Ankoåç¨‹ ListeneråŠ©æ‰‹ asReference() bg()","text":"ç›®å½• åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨Ankoåç¨‹ ListeneråŠ©æ‰‹ asReference() bg() åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨Ankoåç¨‹æ·»åŠ anko-coroutines åˆ°ä½ çš„build.gradleï¼š 123dependencies &#123; compile &quot;org.jetbrains.anko:anko-coroutines:$anko_version&quot;&#125; ListeneråŠ©æ‰‹asReference()å¦‚æœæ‚¨çš„å¼‚æ­¥APIä¸æ”¯æŒå–æ¶ˆï¼Œä½ çš„åç¨‹å¯èƒ½ä¼šè¢«æ— é™æœŸæŒ‚èµ·ã€‚ç”±äºåç¨‹æŒæœ‰å¯¹è¢«æ•è·å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œæ•è·çš„Activityæˆ–Fragmentå®ä¾‹å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨asReference()è€Œä¸æ˜¯ç›´æ¥æ•è·: 1234567891011121314151617suspend fun getData(): Data &#123; ... &#125;class MyActivity : Activity() &#123; fun loadAndShowData() &#123; // Ref&lt;T&gt; uses the WeakReference under the hood val ref: Ref&lt;MyActivity&gt; = this.asReference() async(UI) &#123; val data = getData() // Use ref() instead of this@MyActivity ref().showData() &#125; &#125; fun showData(data: Data) &#123; ... &#125;&#125; bg()æ‚¨å¯ä»¥ä½¿ç”¨bg()è½»æ¾åœ°åœ¨åå°çº¿ç¨‹ä¸Šæ‰§è¡Œæ‚¨çš„ä»£ç : 123456789101112fun getData(): Data &#123; ... &#125;fun showData(data: Data) &#123; ... &#125;async(UI) &#123; val data: Deferred&lt;Data&gt; = bg &#123; // è¿è¡Œåœ¨åå° getData() &#125; // è¯¥ä»£ç åœ¨UIçº¿ç¨‹ä¸Šæ‰§è¡Œ showData(data.await())&#125;","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"},{"name":"Anko","slug":"Kotlin/Anko","permalink":"https://jigangduan.github.io/categories/Kotlin/Anko/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"anko","slug":"anko","permalink":"https://jigangduan.github.io/tags/anko/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"}]},{"title":"Anko SQLite","slug":"Anko-SQLite","date":"2017-11-03T03:05:26.000Z","updated":"2020-07-25T02:57:18.148Z","comments":true,"path":"2017/11/03/Anko-SQLite/","link":"","permalink":"https://jigangduan.github.io/2017/11/03/Anko-SQLite/","excerpt":"æ‚¨æ˜¯å¦åŒå€¦äº†ä½¿ç”¨Android Cursorè§£æSQLiteæŸ¥è¯¢ç»“æœ?æ‚¨å¿…é¡»ç¼–å†™å¤§é‡çš„æ ·æ¿ä»£ç æ¥è§£ææŸ¥è¯¢ç»“æœè¡Œï¼Œå¹¶å°†å…¶å°è£…åœ¨æ— æ•°çš„try..finallyå—ä¸­ï¼Œä»¥ä¾¿æ­£ç¡®åœ°å…³é—­æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚ Ankoæä¾›äº†è®¸å¤šæ‰©å±•åŠŸèƒ½ï¼Œä»¥ç®€åŒ–ä¸SQLiteæ•°æ®åº“çš„å·¥ä½œã€‚ ç›®å½• åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Anko SQLite è®¿é—®æ•°æ®åº“ åˆ›å»ºå’Œåˆ é™¤è¡¨ æ’å…¥æ•°æ® æŸ¥è¯¢æ•°æ® è§£ææŸ¥è¯¢ç»“æœ è‡ªå®šä¹‰è¡Œè§£æå™¨ Cursoræµ æ›´æ–°å€¼ äº‹åŠ¡","text":"æ‚¨æ˜¯å¦åŒå€¦äº†ä½¿ç”¨Android Cursorè§£æSQLiteæŸ¥è¯¢ç»“æœ?æ‚¨å¿…é¡»ç¼–å†™å¤§é‡çš„æ ·æ¿ä»£ç æ¥è§£ææŸ¥è¯¢ç»“æœè¡Œï¼Œå¹¶å°†å…¶å°è£…åœ¨æ— æ•°çš„try..finallyå—ä¸­ï¼Œä»¥ä¾¿æ­£ç¡®åœ°å…³é—­æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚ Ankoæä¾›äº†è®¸å¤šæ‰©å±•åŠŸèƒ½ï¼Œä»¥ç®€åŒ–ä¸SQLiteæ•°æ®åº“çš„å·¥ä½œã€‚ ç›®å½• åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Anko SQLite è®¿é—®æ•°æ®åº“ åˆ›å»ºå’Œåˆ é™¤è¡¨ æ’å…¥æ•°æ® æŸ¥è¯¢æ•°æ® è§£ææŸ¥è¯¢ç»“æœ è‡ªå®šä¹‰è¡Œè§£æå™¨ Cursoræµ æ›´æ–°å€¼ äº‹åŠ¡ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Anko SQLiteå°†anko-sqliteçš„ä¾èµ–æ·»åŠ åˆ°æ‚¨çš„build.gradle: 123dependencies &#123; compile \"org.jetbrains.anko:anko-sqlite:$anko_version\"&#125; è®¿é—®æ•°æ®åº“å¦‚æœä½¿ç”¨SQLiteOpenHelperï¼Œé€šå¸¸ä¼šè°ƒç”¨getReadableDatabase()æˆ–getWritableDatabase()(åœ¨ç”Ÿäº§ä»£ç ä¸­ç»“æœæ˜¯ç›¸åŒçš„)ï¼Œä½†æ˜¯å¿…é¡»ç¡®ä¿åœ¨æ¥æ”¶åˆ°çš„SQLiteDatabaseä¸Šè°ƒç”¨close()æ–¹æ³•ã€‚å¦å¤–ï¼Œæ‚¨å¿…é¡»åœ¨æŸä¸ªåœ°æ–¹ç¼“å­˜helperç±»ï¼Œå¦‚æœæ‚¨åœ¨å‡ ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»çŸ¥é“å¹¶å‘è®¿é—®ã€‚è¿™ä¸€åˆ‡éƒ½å¾ˆè‰°éš¾ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆAndroidå¼€å‘äººå‘˜å¹¶ä¸çƒ­è¡·äºä½¿ç”¨é»˜è®¤çš„SQLite APIï¼Œè€Œæ˜¯æ›´å–œæ¬¢ä½¿ç”¨è¯¸å¦‚ORMsä¹‹ç±»çš„ç›¸å½“æ˜‚è´µçš„åŒ…è£…å™¨ã€‚ Ankoæä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„ç±»ManagedSQLiteOpenHelperï¼Œå®ƒå¯ä»¥æ— ç¼åœ°æ›¿æ¢ç¼ºçœå€¼ã€‚ä»¥ä¸‹æ˜¯ä½ å¦‚ä½•ä½¿ç”¨å®ƒ: 123456789101112131415161718192021222324252627282930class MyDatabaseOpenHelper(ctx: Context) : ManagedSQLiteOpenHelper(ctx, &quot;MyDatabase&quot;, null, 1) &#123; companion object &#123; private var instance: MyDatabaseOpenHelper? = null @Synchronized fun getInstance(ctx: Context): MyDatabaseOpenHelper &#123; if (instance == null) &#123; instance = MyDatabaseOpenHelper(ctx.getApplicationContext()) &#125; return instance!! &#125; &#125; override fun onCreate(db: SQLiteDatabase) &#123; // è¿™é‡Œåˆ›å»ºè¡¨ db.createTable(&quot;Customer&quot;, ifNotExists = true, &quot;id&quot; to INTEGER + PRIMARY_KEY + UNIQUE, &quot;name&quot; to TEXT, &quot;photo&quot; to BLOB) &#125; override fun onUpgrade(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) &#123; // åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥åƒå¾€å¸¸ä¸€æ ·åˆ é™¤è¡¨ db.dropTable(&quot;User&quot;, true) &#125;&#125;// è®¿é—®å±æ€§çš„Contextval Context.database: MyDatabaseOpenHelper get() = MyDatabaseOpenHelper.getInstance(getApplicationContext()) ä»€ä¹ˆæ„Ÿè§‰?ä¸è¦å°†ä½ çš„ä»£ç å°è£…åˆ°tryå—ä¸­ï¼Œç°åœ¨ä½ å¯ä»¥è¿™æ ·å†™: 123database.use &#123; // `this` is a SQLiteDatabase instance&#125; åœ¨{}é‡Œæ‰§è¡Œäº†æ‰€æœ‰çš„ä»£ç ä¹‹åï¼Œæ•°æ®åº“å°†ä¼šè¢«å…³é—­ã€‚ å¼‚æ­¥è°ƒç”¨çš„ä¾‹å­: 12345678910class SomeActivity : Activity() &#123; private fun loadAsync() &#123; async(UI) &#123; val result = bg &#123; database.use &#123; ... &#125; &#125; loadComplete(result) &#125; &#125;&#125; ğŸ§ ä¸‹é¢æåˆ°çš„è¿™äº›æ–¹æ³•å’Œæ‰€æœ‰æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºSQLiteExceptionã€‚ä½ å¿…é¡»è‡ªå·±å¤„ç†ï¼Œå› ä¸ºAnkoå‡è£…é”™è¯¯ä¸ä¼šå‘ç”Ÿï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚ åˆ›å»ºå’Œåˆ é™¤è¡¨å¯¹äºAnkoï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºæ–°çš„è¡¨ï¼Œå¹¶åˆ é™¤ç°æœ‰çš„è¡¨ã€‚è¯­æ³•å¾ˆç®€å•ã€‚ 123456database.use &#123; createTable(&quot;Customer&quot;, true, &quot;id&quot; to INTEGER + PRIMARY_KEY + UNIQUE, &quot;name&quot; to TEXT, &quot;photo&quot; to BLOB)&#125; åœ¨SQLiteä¸­ï¼Œæœ‰5ç§ä¸»è¦ç±»å‹:NULLã€INTEGERã€REALã€TEXTå’ŒBLOBã€‚ä½†æ˜¯æ¯ä¸€åˆ—å¯èƒ½éƒ½æœ‰ä¸€äº›ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚ä¸»é”®(PRIMARY KEY)æˆ–æƒŸä¸€(UNIQUE)çš„ã€‚æ‚¨å¯ä»¥å°†è¿™äº›ä¿®é¥°ç¬¦é™„åŠ åˆ°ä¸»ç±»å‹åä¸­ã€‚ è¦åˆ é™¤ä¸€ä¸ªè¡¨ï¼Œä½¿ç”¨dropTableå‡½æ•°: 1dropTable(&quot;User&quot;, true) æ’å…¥æ•°æ®é€šå¸¸ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªContentValueså®ä¾‹æ¥å°†è¡Œæ’å…¥åˆ°è¡¨ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­: 12345val values = ContentValues()values.put(&quot;id&quot;, 5)values.put(&quot;name&quot;, &quot;John Smith&quot;)values.put(&quot;email&quot;, &quot;user@domain.org&quot;)db.insert(&quot;User&quot;, null, values) Ankoå…è®¸æ¶ˆé™¤è¿™äº›ä»ªå¼,é€šè¿‡ç›´æ¥æŠŠå€¼ä½œä¸ºinsert()å‡½æ•°çš„å‚æ•°: 1234567// Where db is an SQLiteDatabase// eg: val db = database.writeableDatabasedb.insert(&quot;User&quot;, &quot;id&quot; to 42, &quot;name&quot; to &quot;John&quot;, &quot;email&quot; to &quot;user@domain.org&quot;) æˆ–è€…ä½¿ç”¨database.use: 123456database.use &#123; insert(&quot;User&quot;, &quot;id&quot; to 42, &quot;name&quot; to &quot;John&quot;, &quot;email&quot; to &quot;user@domain.org&quot;&#125; è¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œdatabaseæ˜¯ä¸€ä¸ªæ•°æ®åº“åŠ©æ‰‹å®ä¾‹ï¼Œè€Œdbæ˜¯ä¸€ä¸ªSQLiteDatabaseå¯¹è±¡ å‡½æ•°insertOrThrow(), replace(), replaceOrThrow()ä¹Ÿå­˜åœ¨å¹¶å…·æœ‰ç±»ä¼¼çš„è¯­ä¹‰ã€‚ æŸ¥è¯¢æ•°æ®Ankoæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æŸ¥è¯¢æ„å»ºå™¨ã€‚å®ƒå¯èƒ½æ˜¯ç”¨db.select(tableName, vararg columns)ï¼Œdbæ˜¯SQLiteDatabaseçš„ä¸€ä¸ªå®ä¾‹ã€‚ æ–¹æ³• æè¿° column(String) æ·»åŠ ä¸€ä¸ªç”¨äºé€‰æ‹©æŸ¥è¯¢çš„åˆ— distinct(Boolean) ä¸åŒçš„æŸ¥è¯¢ whereArgs(String) æŒ‡å®šåŸå§‹å­—ç¬¦ä¸²whereæŸ¥è¯¢ whereArgs(String, args) âœ¨ æŒ‡å®šå¸¦æœ‰å‚æ•°çš„whereæŸ¥è¯¢ whereSimple(String, args) æŒ‡å®šå¸¦æœ‰?æ ‡å¿—å‚æ•°çš„whereæŸ¥è¯¢ orderBy(String, [ASC/DESC]) æŒ‰åˆ—æ’åº groupBy(String) æŒ‰åˆ—åˆ†ç»„ limit(count: Int) é™åˆ¶æŸ¥è¯¢ç»“æœè¡Œæ•° limit(offset: Int, count: Int) ç”¨åç§»é‡é™åˆ¶æŸ¥è¯¢ç»“æœè¡Œæ•° having(String) æŒ‡å®šåŸå§‹havingè¡¨è¾¾å¼ having(String, args) âœ¨ æŒ‡å®šå¸¦æœ‰å‚æ•°çš„havingè¡¨è¾¾å¼ å‡½æ•°æ ‡è®°âœ¨ä»¥ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼è§£æå®ƒçš„å‚æ•°ã€‚å®ƒä»¬å…è®¸æ‚¨ä»¥ä»»ä½•é¡ºåºæä¾›å€¼ï¼Œå¹¶æ”¯æŒæ— ç¼åœ°è½¬ä¹‰ã€‚ 1234db.select(&quot;User&quot;, &quot;name&quot;) .whereArgs(&quot;(_id &gt; &#123;userId&#125;) and (name = &#123;userName&#125;)&quot;, &quot;userName&quot; to &quot;John&quot;, &quot;userId&quot; to 42) åœ¨è¿™é‡Œï¼Œ{userId}éƒ¨åˆ†å°†è¢«42æ›¿æ¢ï¼Œ{userName}æ›¿æ¢ä¸º&#39;John&#39;ã€‚å¦‚æœå®ƒçš„ç±»å‹ä¸æ˜¯æ•°å€¼(Intã€Floatç­‰)æˆ–Booleanï¼Œåˆ™è¯¥å€¼å°†è¢«è½¬ä¹‰ã€‚å¯¹äºå…¶ä»–ç±»å‹ï¼Œå°†è¢«ä½¿ç”¨toString()è¡¨ç¤ºã€‚ whereSimpleå‡½æ•°æ¥å—Stringç±»å‹çš„å‚æ•°ã€‚å®ƒä¸SQLiteDatabaseä¸­çš„query()ç›¸åŒ(é—®å·?å°†ä¼šè¢«å®å€¼çš„å®å€¼æ‰€å–ä»£) æˆ‘ä»¬å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢?ä½¿ç”¨exec()å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå®ƒçš„ç±»å‹æ˜¯Cursor.() -&gt; Tã€‚å®ƒåªæ˜¯å¯åŠ¨æ¥æ”¶çš„æ‰©å±•å‡½æ•°ï¼Œç„¶åå…³é—­Cursorï¼Œè¿™æ ·æ‚¨å°±ä¸éœ€è¦è‡ªå·±åŠ¨æ‰‹äº†: 123db.select(&quot;User&quot;, &quot;email&quot;).exec &#123; // ç”¨ç”µå­é‚®ä»¶åšä¸€äº›äº‹æƒ…&#125; è§£ææŸ¥è¯¢ç»“æœå› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›Cursorï¼Œæˆ‘ä»¬å¦‚ä½•å°†å®ƒè§£æä¸ºæ™®é€šç±»å‘¢?Ankoæä¾›äº†ä¸€äº›åŠŸèƒ½parseSingle, parseOptå’ŒparseListï¼Œè¿™æ ·åšæ›´å®¹æ˜“ã€‚ æ–¹æ³• æè¿° parseSingle(rowParser): T è§£æ1è¡Œ parseOpt(rowParser): T? è§£æ0æˆ–1è¡Œ parseList(rowParser): List&lt;T&gt; è§£æ0æˆ–å¤šè¡Œ æ³¨æ„ï¼ŒparseSingle()å’ŒparseOpt()å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœæ¥æ”¶åˆ°çš„CursoråŒ…å«è¶…è¿‡ä¸€è¡Œã€‚ ç°åœ¨çš„é—®é¢˜æ˜¯:ä»€ä¹ˆæ˜¯rowParser?æ¯ä¸ªå‡½æ•°éƒ½æ”¯æŒä¸¤ç§ä¸åŒç±»å‹çš„è§£æå™¨: RowParserå’ŒMapRowParser: 1234567interface RowParser&lt;T&gt; &#123; fun parseRow(columns: Array&lt;Any&gt;): T&#125;interface MapRowParser&lt;T&gt; &#123; fun parseRow(columns: Map&lt;String, Any&gt;): T&#125; å¦‚æœæ‚¨æƒ³ä»¥ä¸€ç§éå¸¸æœ‰æ•ˆçš„æ–¹å¼ç¼–å†™æŸ¥è¯¢ï¼Œè¯·ä½¿ç”¨RowParser(ä½†æ˜¯æ‚¨å¿…é¡»çŸ¥é“æ¯ä¸ªåˆ—çš„ç´¢å¼•)ã€‚parseRowæ¥å—äº†ä¸€ä¸ªAnyåˆ—è¡¨(Anyç±»å‹å®é™…ä¸Šéƒ½å¯ä»¥æ˜¯Longã€Doubleã€Stringæˆ–ByteArray)ã€‚å¦ä¸€æ–¹é¢ï¼ŒMapRowParserå…è®¸ä½¿ç”¨åˆ—åæ¥è·å–è¡Œå€¼ã€‚ Ankoå·²ç»æœ‰äº†ç®€å•çš„å•åˆ—è¡Œçš„è§£æå™¨: ShortParser IntParser LongParser FloatParser DoubleParser StringParser BlobParser åŒæ ·ï¼Œæ‚¨å¯ä»¥ä»ç±»æ„é€ å‡½æ•°åˆ›å»ºrowè§£æå™¨ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªclass: 1class Person(val firstName: String, val lastName: String, val age: Int) è§£æå™¨å°†éå¸¸ç®€å•: 1val rowParser = classParser&lt;Person&gt;() ç°åœ¨ï¼Œå¦‚æœä¸»æ„é€ å‡½æ•°æœ‰å¯é€‰çš„å‚æ•°ï¼Œé‚£ä¹ˆAnkoä¸æ”¯æŒåˆ›å»ºè¿™æ ·çš„è§£æå™¨ã€‚å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œæ„é€ å‡½æ•°å°†ä½¿ç”¨Javaåå°„æ¥è°ƒç”¨ï¼Œå› æ­¤ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„RowParserå¯¹äºå¤§å‹æ•°æ®é›†æ¥è¯´æ˜¯æ›´åˆç†çš„ã€‚ å¦‚æœä½¿ç”¨Anko db.select()æ„å»ºå™¨ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨parseSingleã€parseOptæˆ–parseListï¼Œå¹¶ä¼ é€’ä¸€ä¸ªé€‚å½“çš„è§£æå™¨ã€‚ è‡ªå®šä¹‰è¡Œè§£æå™¨ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ä¸ºcolumns (Int, String, String)åˆ›å»ºä¸€ä¸ªæ–°çš„è§£æå™¨ã€‚æœ€å¹¼ç¨šçš„åšæ³•æ˜¯: 12345class MyRowParser : RowParser&lt;Triple&lt;Int, String, String&gt;&gt; &#123; override fun parseRow(columns: Array&lt;Any&gt;): Triple&lt;Int, String, String&gt; &#123; return Triple(columns[0] as Int, columns[1] as String, columns[2] as String) &#125;&#125; ç°åœ¨ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸­æœ‰ä¸‰ä¸ªæ˜¾å¼çš„ç±»å‹è½¬æ¢ã€‚è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨rowParserå‡½æ•°æ¥æ‘†è„±å®ƒä»¬: 123val parser = rowParser &#123; id: Int, name: String, email: String -&gt; Triple(id, name, email)&#125; æ˜¯å®ƒ!rowParserå°†æ‰€æœ‰çš„ç±»å‹è½¬æ¢ä¸ºåº•å±‚ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ‚¨çš„éœ€è¦æ¥å‘½ålambdaå‚æ•°ã€‚ CursoræµAnkoæä¾›äº†ä¸€ç§ä»¥åŠŸèƒ½æ–¹å¼è®¿é—®SQLite Cursorçš„æ–¹æ³•ã€‚åªéœ€è°ƒç”¨cursor.assequence()æˆ–cursormap.asmapsequence()æ‰©å±•å‡½æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¡Œåºåˆ—ã€‚ä¸è¦å¿˜è®°å…³é—­Cursor :) æ›´æ–°å€¼è®©æˆ‘ä»¬ç»™æˆ‘ä»¬çš„ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ªæ–°åå­—: 123update(&quot;User&quot;, &quot;name&quot; to &quot;Alice&quot;) .where(&quot;_id = &#123;userId&#125;&quot;, &quot;userId&quot; to 42) .exec() æ›´æ–°è¿˜æœ‰ä¸€ä¸ªwhereSimple()æ–¹æ³•ï¼Œä»¥é˜²æ‚¨æƒ³è¦ä»¥ä¼ ç»Ÿæ–¹å¼æä¾›æŸ¥è¯¢: 123update(&quot;User&quot;, &quot;name&quot; to &quot;Alice&quot;) .whereSimple(&quot;_id = ?&quot;, 42) .exec() äº‹åŠ¡æœ‰ä¸€ä¸ªåä¸ºtransaction()çš„ç‰¹æ®Šå‡½æ•°ï¼Œå®ƒå…è®¸æ‚¨å°†å¤šä¸ªæ•°æ®åº“æ“ä½œå°è£…åœ¨ä¸€ä¸ªSQLiteäº‹åŠ¡ä¸­ã€‚ 123transaction &#123; // ä½ çš„äº‹åŠ¡ä»£ç &#125; å¦‚æœåœ¨{}å—ä¸­æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡å°†è¢«æ ‡è®°ä¸ºæˆåŠŸã€‚ ğŸ§ å¦‚æœä½ æƒ³ä¸­æ­¢äº‹åŠ¡å‡ºäºæŸç§åŸå› ,æŠ›å‡ºTransactionAbortExceptionã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦è‡ªå·±å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"},{"name":"Anko","slug":"Kotlin/Anko","permalink":"https://jigangduan.github.io/categories/Kotlin/Anko/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"anko","slug":"anko","permalink":"https://jigangduan.github.io/tags/anko/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"}]},{"title":"Anko å¸ƒå±€","slug":"Anko-Layouts","date":"2017-11-02T10:56:23.000Z","updated":"2020-07-25T02:57:18.148Z","comments":true,"path":"2017/11/02/Anko-Layouts/","link":"","permalink":"https://jigangduan.github.io/2017/11/02/Anko-Layouts/","excerpt":"ä¸ºä»€ä¹ˆAnkoå¸ƒå±€? DSLçš„åŸå› ? æ”¯æŒç°æœ‰çš„ä»£ç  å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å®ƒæ˜¯å¯æ‰©å±•çš„å—? åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨Anko Layouts ç†è§£Anko åŸºç¡€çŸ¥è¯† AnkoComponent è¾…åŠ©å— ä¸»é¢˜å— å¸ƒå±€å’ŒLayoutParams Listeners å®šåˆ¶çš„åç¨‹ä¸Šä¸‹æ–‡ ä½¿ç”¨èµ„æºæ ‡è¯†ç¬¦ å®ä¾‹ç®€åŒ–ç¬¦å· UIåŒ…è£… Includeæ ‡ç­¾ Ankoæ”¯æŒæ’ä»¶ å®‰è£…Ankoæ”¯æŒæ’ä»¶ ä½¿ç”¨æ’ä»¶ XML DSLè½¬æ¢å™¨","text":"ä¸ºä»€ä¹ˆAnkoå¸ƒå±€? DSLçš„åŸå› ? æ”¯æŒç°æœ‰çš„ä»£ç  å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ å®ƒæ˜¯å¯æ‰©å±•çš„å—? åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨Anko Layouts ç†è§£Anko åŸºç¡€çŸ¥è¯† AnkoComponent è¾…åŠ©å— ä¸»é¢˜å— å¸ƒå±€å’ŒLayoutParams Listeners å®šåˆ¶çš„åç¨‹ä¸Šä¸‹æ–‡ ä½¿ç”¨èµ„æºæ ‡è¯†ç¬¦ å®ä¾‹ç®€åŒ–ç¬¦å· UIåŒ…è£… Includeæ ‡ç­¾ Ankoæ”¯æŒæ’ä»¶ å®‰è£…Ankoæ”¯æŒæ’ä»¶ ä½¿ç”¨æ’ä»¶ XML DSLè½¬æ¢å™¨ ä¸ºä»€ä¹ˆAnkoå¸ƒå±€?DSLçš„åŸå› ?é»˜è®¤æƒ…å†µä¸‹ï¼ŒAndroidä¸­çš„UIæ˜¯ç”¨XMLç¼–å†™çš„ã€‚è¿™åœ¨ä»¥ä¸‹æ–¹é¢æ˜¯ä¸æ–¹ä¾¿çš„: ä¸æ˜¯ç±»å‹å®‰å…¨; ä¸æ˜¯ç©ºå€¼å®‰å…¨; å®ƒè¿«ä½¿æ‚¨ä¸ºæ¯ä¸€ä¸ªå¸ƒå±€ç¼–å†™å‡ ä¹ç›¸åŒçš„ä»£ç ; åœ¨è®¾å¤‡ä¸Šè§£æXMLï¼Œæµªè´¹CPUæ—¶é—´å’Œç”µæ± ; æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒä¸å…è®¸ä»£ç é‡ç”¨ã€‚ è™½ç„¶æ‚¨å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼åˆ›å»ºUIï¼Œä½†è¿™å‡ ä¹æ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œå› ä¸ºå®ƒæœ‰ç‚¹éš¾çœ‹ï¼Œå¾ˆéš¾ç»´æŠ¤ã€‚è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„Kotlinç‰ˆæœ¬(Javaä¸­çš„ä¸€ä¸ªæ›´é•¿çš„ç‰ˆæœ¬): 1234567891011val act = thisval layout = LinearLayout(act)layout.orientation = LinearLayout.VERTICALval name = EditText(act)val button = Button(act)button.text = \"Say Hello\"button.setOnClickListener &#123; Toast.makeText(act, \"Hello, $&#123;name.text&#125;!\", Toast.LENGTH_SHORT).show()&#125;layout.addView(name)layout.addView(button) DSLä½¿ç›¸åŒçš„é€»è¾‘æ˜“äºé˜…è¯»ï¼Œæ˜“äºç¼–å†™ï¼Œå¹¶ä¸”æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€ã€‚è¿™é‡Œåˆæœ‰äº†: 123456verticalLayout &#123; val name = editText() button(\"Say Hello\") &#123; onClick &#123; toast(\"Hello, $&#123;name.text&#125;!\") &#125; &#125;&#125; æ³¨æ„ï¼ŒonClick()æ”¯æŒåç¨‹(æ¥å—suspending lambda)ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æ²¡æœ‰æ˜¾å¼çš„async(UI)è°ƒç”¨çš„æƒ…å†µä¸‹ç¼–å†™å¼‚æ­¥ä»£ç ã€‚ æ”¯æŒç°æœ‰çš„ä»£ç ä½ ä¸éœ€è¦é‡å†™Ankoçš„æ‰€æœ‰UIã€‚æ‚¨å¯ä»¥ç”¨Javaç¼–å†™æ—§çš„ç±»ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä»ç„¶å¸Œæœ›(æˆ–æœ‰)ç¼–å†™ä¸€ä¸ªKotlin activityç±»ï¼Œå¹¶å‡ºäºæŸç§åŸå› ä½¿XMLå¸ƒå±€è†¨èƒ€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è§†å›¾å±æ€§ï¼Œè¿™å°†ä½¿äº‹æƒ…å˜å¾—æ›´ç®€å•: 1234// ä¸findViewById()ç›¸åŒï¼Œä½†ä½¿ç”¨èµ·æ¥æ›´ç®€å•val name = find&lt;TextView&gt;(R.id.name)name.hint = \"Enter your name\"name.onClick &#123; /*do something*/ &#125; é€šè¿‡ä½¿ç”¨Kotlinçš„Androidæ‰©å±•ï¼Œæ‚¨å¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´åŠ ç´§å‡‘ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„æ²¡æœ‰ğŸ©ã€‚Ankoç”±ä¸€äº›Kotlinçš„æ‰©å±•å‡½æ•°å’Œå±æ€§ç»„æˆäº†ç±»å‹å®‰å…¨çš„æ„é€ å™¨ï¼Œå°±åƒç±»å‹å®‰å…¨çš„æ„å»ºå™¨æ‰€æè¿°çš„é‚£æ ·ã€‚ ç”±äºæ‰‹å·¥ç¼–å†™æ‰€æœ‰è¿™äº›æ‰©å±•æœ‰ç‚¹ä¹å‘³ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ç”±Android SDKä¸­çš„android.jaræ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ å®ƒæ˜¯å¯æ‰©å±•çš„å—?ç®€çŸ­çš„å›ç­”:æ˜¯çš„ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æƒ³è¦åœ¨DSLä¸­ä½¿ç”¨MapViewã€‚ç„¶åæŠŠå®ƒå†™åœ¨ä»»ä½•å¯ä»¥å¯¼å…¥çš„Kotlinæ–‡ä»¶ä¸­: 12345inline fun ViewManager.mapView() = mapView(theme = 0) &#123;&#125;inline fun ViewManager.mapView(init: MapView.() -&gt; Unit): MapView &#123; return ankoView(&#123; MapView(it) &#125;, theme = 0, init = init)&#125; { MapView(it) }æ˜¯æ‚¨è‡ªå®šä¹‰Viewçš„å·¥å‚å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªContextå®ä¾‹ ç°åœ¨ä½ å¯ä»¥è¿™æ ·å†™äº†: 123frameLayout &#123; val mapView = mapView().lparams(width = matchParent)&#125; å¦‚æœä½ æƒ³è®©ä½ çš„ç”¨æˆ·èƒ½å¤Ÿåº”ç”¨ä¸€ä¸ªå®šåˆ¶çš„ä¸»é¢˜ï¼Œä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™: 12345inline fun ViewManager.mapView(theme: Int = 0) = mapView(theme) &#123;&#125;inline fun ViewManager.mapView(theme: Int = 0, init: MapView.() -&gt; Unit): MapView &#123; return ankoView(&#123; MapView(it) &#125;, theme, init)&#125; åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨Anko Layoutsè¿™äº›åº“ä¾èµ–å…³ç³»åŒ…æ‹¬: 123456789dependencies &#123; // Anko Layouts compile \"org.jetbrains.anko:anko-sdk25:$anko_version\" // sdk15, sdk19, sdk21, sdk23 are also available compile \"org.jetbrains.anko:anko-appcompat-v7:$anko_version\" // Coroutine listeners for Anko Layouts compile \"org.jetbrains.anko:anko-sdk25-coroutines:$anko_version\" compile \"org.jetbrains.anko:anko-appcompat-v7-coroutines:$anko_version\"&#125; è¯·é˜…è¯»åŸºäºGradleçš„é¡¹ç›®éƒ¨åˆ†ï¼Œä»¥è·å¾—è¯¦ç»†ä¿¡æ¯ã€‚ ç†è§£AnkoåŸºç¡€çŸ¥è¯†åœ¨Ankoï¼Œä½ ä¸éœ€è¦ä»ä»»ä½•ç‰¹æ®Šçš„ç±»ç»§æ‰¿:ä»…ä»…ä½¿ç”¨æ ‡å‡†çš„Activityã€Fragmentã€FragmentActivityæˆ–ä»»ä½•ä½ æƒ³è¦çš„ä¸œè¥¿ã€‚ é¦–å…ˆï¼Œå¯¼å…¥org.jetbrains.anko.*ã€‚åœ¨æ‚¨çš„ç±»ä¸­ä½¿ç”¨Ankoå¸ƒå±€DSLã€‚ åœ¨onCreate()ä¸­å¯ä»¥ä½¿ç”¨DSL: 123456789101112131415161718override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) verticalLayout &#123; padding = dip(30) editText &#123; hint = \"Name\" textSize = 24f &#125; editText &#123; hint = \"Password\" textSize = 24f &#125; button(\"Login\") &#123; textSize = 26f &#125; &#125;&#125; ğŸ§ æ²¡æœ‰æ˜ç¡®çš„è°ƒç”¨setContentView(R.layout.something): Ankoä¸ºActivitiesè‡ªåŠ¨è®¾ç½®å†…å®¹è§†å›¾(ä½†åªå¯¹ä»–ä»¬)ã€‚ hintå’ŒtextSizeæ˜¯ä¸javaé£æ ¼çš„getterå’Œsetterç»‘å®šçš„åˆæˆæ‰©å±•å±æ€§ï¼Œpaddingæ˜¯Ankoçš„æ‰©å±•å±æ€§ã€‚è¿™äº›éƒ½å­˜åœ¨äºå‡ ä¹æ‰€æœ‰Viewå±æ€§ä¸­ï¼Œå…è®¸æ‚¨ç¼–å†™text = &quot;Some text&quot;è€Œä¸æ˜¯setText(&quot;Some text&quot;)ã€‚ verticalLayout(ä¸€ä¸ªçº¿æ€§å¸ƒå±€ï¼Œä½†å·²ç»æœ‰äº†LinearLayout.VERTICALæ–¹å‘)ã€editTextå’Œbuttonæ˜¯æ„é€ æ–°Viweå®ä¾‹å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çˆ¶ç±»çš„æ‰©å±•å‡½æ•°ã€‚æˆ‘ä»¬å°†å¼•ç”¨è¿™äº›å‡½æ•°ä½œä¸ºå—ã€‚ åœ¨Androidæ¡†æ¶ä¸­å‡ ä¹æ‰€æœ‰çš„è§†å›¾éƒ½å­˜åœ¨å—ï¼Œå®ƒä»¬åœ¨Activitiesã€Fragments(é»˜è®¤æƒ…å†µä¸‹å’Œandroid.support package)ç”šè‡³æ˜¯Contextã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªAnkoContextå®ä¾‹ï¼Œæ‚¨å¯ä»¥ç¼–å†™è¿™æ ·çš„å—: 12345val name: EditText = with(ankoContext) &#123; editText &#123; hint = \"Name\" &#125;&#125; AnkoComponentå°½ç®¡æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨DSL(åœ¨onCreate()æˆ–å…¶ä»–ä»»ä½•åœ°æ–¹)ï¼Œä½†ä¸éœ€è¦åˆ›å»ºä»»ä½•é¢å¤–çš„ç±»ï¼Œåœ¨å•ç‹¬çš„ç±»ä¸­ä½¿ç”¨UIé€šå¸¸æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚å¦‚æœæ‚¨ä½¿ç”¨äº†æä¾›çš„AnkoComponentæ¥å£ï¼Œé‚£ä¹ˆæ‚¨è¿˜å¯ä»¥å…è´¹è·å¾—DSLå¸ƒå±€é¢„è§ˆåŠŸèƒ½ã€‚ 1234567891011121314151617class MyActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?, persistentState: PersistableBundle?) &#123; super.onCreate(savedInstanceState, persistentState) MyActivityUI().setContentView(this) &#125;&#125;class MyActivityUI : AnkoComponent&lt;MyActivity&gt; &#123; override fun createView(ui: AnkoContext&lt;MyActivity&gt;) = with(ui) &#123; verticalLayout &#123; val name = editText() button(\"Say Hello\") &#123; onClick &#123; ctx.toast(\"Hello, $&#123;name.text&#125;!\") &#125; &#125; &#125; &#125;&#125; è¾…åŠ©å—æ­£å¦‚æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°çš„ï¼Œå‰ä¸€èŠ‚ä¸­çš„button()å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ã€‚å¯¹äºå¸¸ç”¨çš„Viewï¼Œä¾‹å¦‚TextViewã€EditTextã€Buttonæˆ–ImageViewï¼Œéƒ½å­˜åœ¨è¿™æ ·çš„è¾…åŠ©å—ã€‚ å¦‚æœæ‚¨ä¸éœ€è¦ä¸ºæŸä¸ªç‰¹å®šViewè®¾ç½®ä»»ä½•å±æ€§ï¼Œæ‚¨å¯ä»¥çœç•¥ {}ï¼Œç¼–å†™button(â€œOkâ€)ï¼Œç”šè‡³åªæ˜¯button(): 1234verticalLayout &#123; button(\"Ok\") button(R.string.cancel)&#125; ä¸»é¢˜å—Ankoæä¾›äº†â€œthemeableâ€ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬è¾…åŠ©å—: 123verticalLayout &#123; themedButton(\"Ok\", theme = R.style.myTheme)&#125; å¸ƒå±€å’ŒLayoutParamså¯ä»¥ä½¿ç”¨LayoutParamså¯¹çˆ¶å®¹å™¨ä¸­çš„å°éƒ¨ä»¶è¿›è¡Œå®šä½ã€‚åœ¨XMLä¸­ï¼Œå®ƒæ˜¯è¿™æ ·çš„: 123456&lt;ImageView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginLeft=\"5dip\" android:layout_marginTop=\"10dip\" android:src=\"@drawable/something\" /&gt; åœ¨Ankoä¸­ï¼Œä½¿ç”¨lparams()åœ¨Viewæè¿°åï¼ŒæŒ‡å®šäº†LayoutParamsã€‚ 12345678linearLayout &#123; button(\"Login\") &#123; textSize = 26f &#125;.lparams(width = wrapContent) &#123; horizontalMargin = dip(5) topMargin = dip(10) &#125;&#125; å¦‚æœæ‚¨æŒ‡å®šäº†lparams()ï¼Œä½†æ˜¯çœç•¥äº†widthå’Œ/æˆ–heightï¼Œå®ƒä»¬çš„é»˜è®¤å€¼éƒ½æ˜¯wrapContentã€‚ä½†æ˜¯æ‚¨æ€»æ˜¯å¯ä»¥æ˜¾å¼åœ°ä¼ é€’å®ƒä»¬:ä½¿ç”¨å‘½åå‚æ•°ã€‚ ä¸€äº›æ–¹ä¾¿çš„è¾…åŠ©å±æ€§å¯ä»¥æ³¨æ„åˆ°: horizontalMargin è®¾ç½®å·¦å’Œå³çš„è¾¹è· verticalMargin è®¾ç½®é¡¶éƒ¨å’Œåº•éƒ¨çš„è¾¹è· margin åŒæ—¶è®¾ç½®äº†æ‰€æœ‰å››ä¸ªè¾¹è· æ³¨æ„ï¼Œå¯¹äºä¸åŒçš„å¸ƒå±€ï¼Œlparams()æ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ï¼Œåœ¨ç›¸å¯¹å¸ƒå±€çš„æƒ…å†µä¸‹: 123456789val ID_OK = 1relativeLayout &#123; button(\"Ok\") &#123; id = ID_OK &#125;.lparams &#123; alignParentTop() &#125; button(\"Cancel\").lparams &#123; below(ID_OK) &#125;&#125; ListenersAnkoæœ‰ä¸€åç›‘å¬å™¨çš„åŠ©æ‰‹ï¼Œä»–ä»¬å¯ä»¥æ— ç¼åœ°æ”¯æŒåç¨‹ã€‚æ‚¨å¯ä»¥åœ¨listenerå†…ç¼–å†™å¼‚æ­¥ä»£ç ï¼ 123456button(\"Login\") &#123; onClick &#123; val user = myRetrofitService.getUser().await() showUser(user) &#125;&#125; å‡ ä¹å’Œè¿™ä¸ªæ˜¯ä¸€æ ·çš„: 12345678button.setOnClickListener(object : OnClickListener &#123; override fun onClick(v: View) &#123; launch(UI) &#123; val user = myRetrofitService.getUser().await() showUser(user) &#125; &#125;&#125;) å½“ä½ æœ‰å¾ˆå¤šæ–¹æ³•çš„æ—¶å€™ï¼ŒAnkoæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼Œæ²¡æœ‰ä½¿ç”¨Anko: 1234567891011seekBar.setOnSeekBarChangeListener(object : OnSeekBarChangeListener &#123; override fun onProgressChanged(seekBar: SeekBar, progress: Int, fromUser: Boolean) &#123; // Something &#125; override fun onStartTrackingTouch(seekBar: SeekBar?) &#123; // Just an empty method &#125; override fun onStopTrackingTouch(seekBar: SeekBar) &#123; // Another empty method &#125;&#125;) ç°åœ¨,Anko: 1234567seekBar &#123; onSeekBarChangeListener &#123; onProgressChanged &#123; seekBar, progress, fromUser -&gt; // Something &#125; &#125;&#125; å¦‚æœæ‚¨ä¸ºç›¸åŒçš„Viewè®¾ç½®onProgressChanged()å’ŒonStartTrackingTouch()ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªâ€œéƒ¨åˆ†å®šä¹‰â€çš„listenerå°†è¢«åˆå¹¶ã€‚å¯¹äºç›¸åŒçš„listeneræ–¹æ³•ï¼Œæœ€åä¸€ä¸ªè·èƒœã€‚ å®šåˆ¶çš„åç¨‹ä¸Šä¸‹æ–‡æ‚¨å¯ä»¥å°†ä¸€ä¸ªå®šåˆ¶çš„åç¨‹contextä¼ é€’ç»™listeneråŠ©æ‰‹: 123456button(\"Login\") &#123; onClick(yourContext) &#123; val user = myRetrofitService.getUser().await() showUser(user) &#125;&#125; ä½¿ç”¨èµ„æºæ ‡è¯†ç¬¦å‰é¢å‡ ç« ä¸­çš„æ‰€æœ‰ä¾‹å­éƒ½ä½¿ç”¨äº†åŸå§‹Javaå­—ç¬¦ä¸²ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚é€šå¸¸ï¼Œæ‚¨å°†æ‰€æœ‰çš„å­—ç¬¦ä¸²æ•°æ®æ”¾å…¥res/values/ç›®å½•ä¸­ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨å®ƒï¼Œä¾‹å¦‚getString(R.string.login)ã€‚ å¹¸è¿çš„æ˜¯ï¼Œåœ¨Ankoä¸­ï¼Œæ‚¨å¯ä»¥å°†èµ„æºæ ‡è¯†ç¬¦ä¼ é€’ç»™åŠ©æ‰‹å—(button(R.string.login))å’Œæ‰©å±•å±æ€§(button { textResource = R.string.login })ã€‚ æ³¨æ„ï¼Œå±æ€§åä¸æ˜¯ç›¸åŒçš„: textã€hintã€imageï¼Œè€Œæ˜¯æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ˜¯textResourceã€hintResourceå’ŒimageResource ğŸ§ èµ„æºå±æ€§è¯»æ—¶æ€»æ˜¯æŠ›å‡ºAnkoExceptionã€‚ å®ä¾‹ç®€åŒ–ç¬¦å·æœ‰æ—¶å€™ï¼Œæ‚¨éœ€è¦ä»æ´»åŠ¨ä»£ç ä¸­ä¼ é€’ä¸€ä¸ªContextå®ä¾‹åˆ°æŸä¸ªAndroid SDKæ–¹æ³•ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥ä½¿ç”¨thisï¼Œä½†æ˜¯å¦‚æœä½ åœ¨ä¸€ä¸ªå†…éƒ¨ç±»é‡Œé¢å‘¢?å¦‚æœæ‚¨åœ¨Kotlinç¼–å†™ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨Javaå’Œthis@SomeActivityç”¨SomeActivity.thisã€‚ å¯¹Ankoï¼Œä½ å¯ä»¥å†™ctxã€‚å®ƒæ˜¯ä¸€ä¸ªæ‰©å±•å±æ€§ï¼Œæ—¢å¯ä»¥åœ¨Activityå’ŒServiceä¸­å·¥ä½œï¼Œä¹Ÿå¯ä»¥ä»Fragmentä¸­è®¿é—®(å®ƒçš„å¤–å£³æ˜¯ä½¿ç”¨getActivity()æ–¹æ³•)ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨actæ‰©å±•å±æ€§è·å¾—ä¸€ä¸ªActivityå®ä¾‹ã€‚ UIåŒ…è£…åœ¨å¼€å§‹ä¹‹å‰ï¼ŒAnkoæ€»æ˜¯ä½¿ç”¨UIæ ‡ç­¾ä½œä¸ºé¡¶çº§çš„DSLå…ƒç´ : 12345UI &#123; editText &#123; hint = \"Name\" &#125;&#125; å¦‚æœä½ æƒ³çš„è¯ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾ã€‚è€Œä¸”ï¼Œæ‰©å±•DSLè¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºæ‚¨å¿…é¡»åªå£°æ˜ä¸€ä¸ªViewManager.customViewå‡½æ•°ã€‚è¯·å‚è§æ‰©å±•Ankoè·å–æ›´å¤šä¿¡æ¯ã€‚ Includeæ ‡ç­¾å¯ä»¥å¾ˆå®¹æ˜“å°†XMLå¸ƒå±€æ’å…¥åˆ°DSLä¸­ã€‚ä½¿ç”¨include()å‡½æ•°: 123include&lt;View&gt;(R.layout.something) &#123; backgroundColor = Color.RED&#125;.lparams(width = matchParent) &#123; margin = dip(12) &#125; æ‚¨å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨lparams()ï¼Œå¦‚æœæ‚¨æä¾›äº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹è€Œä¸æ˜¯Viewï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»å‹: 123include&lt;TextView&gt;(R.layout.textfield) &#123; text = \"Hello, world!\"&#125; Ankoæ”¯æŒæ’ä»¶Ankoæ”¯æŒæ’ä»¶å¯ç”¨äºIntelliJ IDEAå’ŒAndroid Studioã€‚å®ƒå…è®¸ä½ åœ¨IDEå·¥å…·çª—å£ä¸­ç›´æ¥é¢„è§ˆä¸Ankoä¸€èµ·ç¼–å†™çš„AnkoComponentç±»ã€‚ âš ï¸ Ankoæ”¯æŒæ’ä»¶ç›®å‰åªæ”¯æŒAndroid Studio 2.4+ã€‚ å®‰è£…Ankoæ”¯æŒæ’ä»¶ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½Ankoçš„æ”¯æŒæ’ä»¶ã€‚ ä½¿ç”¨æ’ä»¶å‡è®¾ä½ ç”¨Ankoå†™äº†è¿™äº›classesï¼š 1234567891011121314151617class MyActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?, persistentState: PersistableBundle?) &#123; super.onCreate(savedInstanceState, persistentState) MyActivityUI().setContentView(this) &#125;&#125;class MyActivityUI : AnkoComponent&lt;MyActivity&gt; &#123; override fun createView(ui: AnkoContext&lt;MyActivity&gt;) = ui.apply &#123; verticalLayout &#123; val name = editText() button(\"Say Hello\") &#123; onClick &#123; ctx.toast(\"Hello, $&#123;name.text&#125;!\") &#125; &#125; &#125; &#125;.view&#125; å°†å…‰æ ‡æ”¾åœ¨MyActivityUIå£°æ˜çš„åœ°æ–¹ï¼Œæ‰“å¼€Ankoå¸ƒå±€é¢„è§ˆå·¥å…·çª—å£(â€œViewâ€ â†’ â€œTool Windowsâ€ â†’ â€œAnko Layout Previewâ€)ï¼Œå¹¶æŒ‰ä¸‹åˆ·æ–°ã€‚ è¿™éœ€è¦æ„å»ºé¡¹ç›®ï¼Œå› æ­¤åœ¨å®é™…æ˜¾ç¤ºå›¾åƒä¹‹å‰éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´ã€‚ XML DSLè½¬æ¢å™¨è¯¥æ’ä»¶è¿˜æ”¯æŒå°†XMLæ ¼å¼çš„å¸ƒå±€è½¬æ¢ä¸ºAnkoå¸ƒå±€ä»£ç ã€‚æ‰“å¼€ä¸€ä¸ªXMLæ–‡ä»¶å¹¶é€‰æ‹©â€Codeâ€ â†’ â€œConvert to Anko Layouts DSLâ€ã€‚æ‚¨å¯ä»¥åŒæ—¶è½¬æ¢å¤šä¸ªXMLå¸ƒå±€æ–‡ä»¶ã€‚","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"},{"name":"Anko","slug":"Kotlin/Anko","permalink":"https://jigangduan.github.io/categories/Kotlin/Anko/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"anko","slug":"anko","permalink":"https://jigangduan.github.io/tags/anko/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"}]},{"title":"Anko é€šç”¨æ¨¡å—","slug":"Anko-Commons","date":"2017-11-02T09:24:52.000Z","updated":"2020-07-25T02:57:18.148Z","comments":true,"path":"2017/11/02/Anko-Commons/","link":"","permalink":"https://jigangduan.github.io/2017/11/02/Anko-Commons/","excerpt":"ç›®å½• åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨anko-commonsåŠ©æ‰‹ Intents Intentæ„å»ºå™¨å‡½æ•° æœ‰ç”¨Intentè°ƒç”¨ Dialogs Toasts SnackBars Alerts Selectors è¿›åº¦dialogs æ—¥å¿— å¼ºé£æ ¼ æ—¥å¿—è®°å½•å™¨å¯¹è±¡é£æ ¼ Misc é¢œè‰² ç»´åº¦å€¼ applyRecursively()","text":"ç›®å½• åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨anko-commonsåŠ©æ‰‹ Intents Intentæ„å»ºå™¨å‡½æ•° æœ‰ç”¨Intentè°ƒç”¨ Dialogs Toasts SnackBars Alerts Selectors è¿›åº¦dialogs æ—¥å¿— å¼ºé£æ ¼ æ—¥å¿—è®°å½•å™¨å¯¹è±¡é£æ ¼ Misc é¢œè‰² ç»´åº¦å€¼ applyRecursively() åœ¨æ‚¨çš„é¡¹ç›®ä¸­ä½¿ç”¨anko-commonsåŠ©æ‰‹æ·»åŠ anko-commonsåˆ°å¯¹æ‚¨çš„build.gradleçš„ä¾èµ–: 1234dependencies &#123; compile \"org.jetbrains.anko:anko-commons:$anko_version\" compile \"org.jetbrains.anko:anko-design:$anko_version\" // For SnackBars&#125; IntentsIntentåŠ©æ‰‹ä½äºanko-commonså·¥ä»¶å†…ã€‚ Intentæ„å»ºå™¨å‡½æ•°é€šå¸¸ï¼Œæ‚¨å¿…é¡»ç¼–å†™å¤šè¡Œæ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„æ´»åŠ¨ã€‚å®ƒè¿˜è¦æ±‚ä½ ä¸ºä¼ è¾“é¢å¤–çš„å€¼å†™é¢å¤–çš„è¡Œã€‚ä¾‹å¦‚ï¼Œç”¨extra (â€œidâ€, 5)å’Œä¸€ä¸ªç‰¹æ®Šçš„æ ‡å¿—æ¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨çš„ä»£ç ï¼š 1234val intent = Intent(this, SomeOtherActivity::class.java)intent.putExtra(\"id\", 5)intent.setFlag(Intent.FLAG_ACTIVITY_SINGLE_TOP)startActivity(intent) å››è¡Œå¤ªè¿‡åˆ†äº†ã€‚Ankoå‘ä½ æä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•: 1startActivity(intentFor&lt;SomeOtherActivity&gt;(\"id\" to 5).singleTop()) å¦‚æœæ‚¨ä¸éœ€è¦ä¼ é€’ä»»ä½•æ ‡å¿—ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ›´ç®€å•äº†: 1startActivity&lt;SomeOtherActivity&gt;(\"id\" to 5) æœ‰ç”¨Intentè°ƒç”¨Ankoå¯¹ä¸€äº›å¹¿æ³›ä½¿ç”¨çš„æ„å›¾è¿›è¡Œäº†åŒ…è£…: ç›®æ ‡ è§£å†³æ–¹æ¡ˆ æ‰“ç”µè¯ makeCall(number) å‘é€çŸ­ä¿¡ sendSMS(number, [text]) æµè§ˆç½‘é¡µ browse(url) åˆ†äº«æ–‡æœ¬å†…å®¹ share(text, [subject]) å‘é€ç”µå­é‚®ä»¶ email(email, [subject], [text]) æ–¹æ‹¬å·ä¸­çš„å‚æ•°([])æ˜¯å¯é€‰çš„ã€‚å¦‚æœå‘é€äº†æ„å›¾ï¼Œæ–¹æ³•è¿”å›trueã€‚ DialogsDialogåŠ©æ‰‹ä½äºanko-commonså·¥ä»¶å†…ã€‚ Toastsç®€å•åœ°å±•ç¤ºä¸€ä¸ªToastçš„ä¿¡æ¯ã€‚ 123toast(\"Hi there!\")toast(R.string.message)longToast(\"Wow, such duration\") SnackBarsç®€å•åœ°æ˜¾ç¤ºä¸€æ¡SnackBaræ¶ˆæ¯ã€‚ 1234snackbar(view, \"Hi there!\")snackbar(view, R.string.message)longSnackbar(view, \"Wow, such duration\")snackbar(view, \"Action, reaction\", \"Click me!\") &#123; doStuff() &#125; Alertsä¸€ä¸ªç”¨äºæ˜¾ç¤ºalert dialogsçš„ç®€å•DSLã€‚ 1234alert(\"Hi, I'm Roy\", \"Have you tried turning it off and on again?\") &#123; yesButton &#123; toast(\"Ohâ€¦\") &#125; noButton &#123;&#125;&#125;.show() ä¸Šé¢çš„ä»£ç å°†æ˜¾ç¤ºé»˜è®¤çš„Androidè­¦å‘Šå¯¹è¯æ¡†ã€‚å¦‚æœæ‚¨æƒ³åˆ‡æ¢åˆ°appcompatå®ç°ï¼Œè¯·ä½¿ç”¨Appcompatå¯¹è¯æ¡†: 1alert(Appcompat, \"Some text message\").show() é»˜è®¤æƒ…å†µä¸‹åŒ…æ‹¬Androidå’ŒAppcompatå¯¹è¯æ¡†ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡å®ç°AlertBuilderFactoryæ¥å£æ¥åˆ›å»ºæ‚¨çš„å®šåˆ¶å·¥å‚ã€‚ alert()åŠŸèƒ½æ— ç¼åœ°æ”¯æŒAnkoçš„å¸ƒå±€ï¼Œä½œä¸ºè‡ªå®šä¹‰è§†å›¾: 12345alert &#123; customView &#123; editText() &#125;&#125;.show() Selectorsselector()æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰æ–‡æœ¬æ¡ç›®åˆ—è¡¨çš„è­¦å‘Šå¯¹è¯æ¡†: 1234val countries = listOf(\"Russia\", \"USA\", \"Japan\", \"Australia\")selector(\"Where are you from?\", countries, &#123; dialogInterface, i -&gt; toast(\"So you're living in $&#123;countries[i]&#125;, right?\")&#125;) è¿›åº¦dialogsprogressDialog()åˆ›å»ºå¹¶æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦å¯¹è¯æ¡†ã€‚ 1val dialog = progressDialog(message = \"Please wait a bitâ€¦\", title = \"Fetching data\") ä¸€ä¸ªä¸ç¡®å®šçš„è¿›åº¦å¯¹è¯æ¡†ä¹Ÿæœ‰(è§indeterminateProgressDialog())ã€‚ æ—¥å¿—AnkoLoggerä½äºanko-commonså·¥ä»¶å†…ã€‚ å¼ºé£æ ¼Android SDKæä¾›äº†android.util.Logç±»ï¼Œå¹¶æä¾›äº†ä¸€äº›æ—¥å¿—è®°å½•æ–¹æ³•ã€‚ä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯æ–¹æ³•è¦æ±‚æ‚¨ä¼ é€’ä¸€ä¸ªæ ‡è®°å‚æ•°ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨AnkoLoggerçš„æ¥å£æ¥æ¶ˆé™¤è¿™ä¸ªé—®é¢˜: 1234567class SomeActivity : Activity(), AnkoLogger &#123; private fun someMethod() &#123; info(\"London is the capital of Great Britain\") debug(5) // .toString() method will be executed warn(null) // \"null\" will be printed &#125;&#125; android.util.Log AnkoLogger v() verbose() d() debug() i() info() w() warn() e() error() wtf() wtf() é»˜è®¤çš„æ ‡è®°åæ˜¯ä¸€ä¸ªç±»å(åœ¨æœ¬ä¾‹ä¸­æ˜¯SomeActivity)ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡è¦†ç›–loggerTagå±æ€§æ¥è½»æ¾åœ°æ›´æ”¹å®ƒã€‚ æ¯ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªç‰ˆæœ¬:æ™®é€šå’Œæ‡’æƒ°(å†…è”): 12info(\"String \" + \"concatenation\")info &#123; \"String \" + \"concatenation\" &#125; åªæœ‰Log.isLoggable(tag, Log.INFO)æ˜¯trueï¼ŒLambdaç»“æœæ‰ä¼šè®¡ç®— æ—¥å¿—è®°å½•å™¨å¯¹è±¡é£æ ¼ä½ ä¹Ÿå¯ä»¥ç”¨AnkoLoggerä½œä¸ºä¸€ä¸ªç®€å•çš„å¯¹è±¡ã€‚ 12345678class SomeActivity : Activity() &#123; private val log = AnkoLogger&lt;SomeActivity&gt;(this) private val logWithASpecificTag = AnkoLogger(\"my_tag\") private fun someMethod() &#123; log.warning(\"Big brother is watching you!\") &#125;&#125; Miscé¢œè‰²ä¸¤ä¸ªç®€å•çš„æ‰©å±•å‡½æ•°ä½¿ä»£ç æ›´åŠ å¯è¯»ã€‚ å‡½æ•° ç»“æœ 0xff0000.opaque ä¸é€æ˜çš„çº¢è‰² 0x99.gray.opaque ç°è‰²ä¸é€æ˜çš„#999999 ç»´åº¦å€¼æ‚¨å¯ä»¥åœ¨dip(å¯†åº¦-ç‹¬ç«‹åƒç´ )æˆ–sp(ç‹¬ç«‹åƒç´ )ä¸­æŒ‡å®šç»´åº¦å€¼:dip(dipValue)æˆ–sp(spValue)ã€‚æ³¨æ„ï¼ŒtextSizeå±æ€§å·²ç»æ¥å—sp(textSize=16f)ã€‚ä½¿ç”¨px2dipå’Œpx2spè¿›è¡Œåå‘è½¬æ¢ã€‚ applyRecursively()applyRecursively()å°†lambdaè¡¨è¾¾å¼åº”ç”¨åˆ°ä¼ é€’Viewæœ¬èº«ï¼Œç„¶åé€’å½’åœ°å¯¹è§†å›¾ä¸­çš„æ¯ä¸ªå­è§†å›¾è¿›è¡Œé€’å½’ï¼Œå¦‚æœæ˜¯ViewGroupï¼š 12345678910verticalLayout &#123; editText &#123; hint = \"Name\" &#125; editText &#123; hint = \"Password\" &#125;&#125;.applyRecursively &#123; view -&gt; when(view) &#123; is EditText -&gt; view.textSize = 20f&#125;&#125;","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"},{"name":"Anko","slug":"Kotlin/Anko","permalink":"https://jigangduan.github.io/categories/Kotlin/Anko/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"anko","slug":"anko","permalink":"https://jigangduan.github.io/tags/anko/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"}]},{"title":"Anko ç®€ä»‹","slug":"anko","date":"2017-11-02T09:02:35.000Z","updated":"2020-07-25T02:57:18.173Z","comments":true,"path":"2017/11/02/anko/","link":"","permalink":"https://jigangduan.github.io/2017/11/02/anko/","excerpt":"","text":"Ankoæ˜¯ä¸€ä¸ªKotlinåº“ï¼Œå®ƒä½¿Androidåº”ç”¨ç¨‹åºå¼€å‘çš„é€Ÿåº¦æ›´å¿«ã€æ›´å®¹æ˜“ã€‚å®ƒä½¿æ‚¨çš„ä»£ç å¹²å‡€ã€æ˜“äºé˜…è¯»ï¼Œå¹¶ä¸”è®©æ‚¨å¿˜è®°äº†Android SDKçš„ç²—ç³™è¾¹ç¼˜ã€‚ Ankoç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆ: Anko Commons:ä¸€ä¸ªå…¨æ˜¯åŠ©æ‰‹çš„è½»é‡çº§çš„åº“: Intents; Dialogså’Œtoasts; Logging; èµ„æºå’Œå°ºå¯¸; Anko Layouts:ä¸€ç§å¿«é€Ÿå’Œç±»å‹å®‰å…¨çš„æ–¹å¼æ¥ç¼–å†™åŠ¨æ€çš„Androidå¸ƒå±€ Anko SQLite:ç”¨äºAndroid SQLiteçš„æŸ¥è¯¢DSLå’Œè§£æå™¨é›†åˆ Anko Coroutines:åŸºäºkotlinx.coroutinesåº“çš„å®ç”¨å·¥å…· Ankoç¤ºä¾‹é¡¹ç›®","categories":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"},{"name":"Anko","slug":"Kotlin/Anko","permalink":"https://jigangduan.github.io/categories/Kotlin/Anko/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"anko","slug":"anko","permalink":"https://jigangduan.github.io/tags/anko/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"}]},{"title":"ADB Shell","slug":"ADBShell","date":"2017-11-02T05:09:20.000Z","updated":"2020-07-25T02:57:18.147Z","comments":true,"path":"2017/11/02/ADBShell/","link":"","permalink":"https://jigangduan.github.io/2017/11/02/ADBShell/","excerpt":"Androidè°ƒè¯•æ¡¥(adb)æ˜¯ä¸€ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥è®©æ‚¨ä¸ä»¿çœŸå™¨æˆ–è¿æ¥çš„Androidè®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚æ‚¨å¯ä»¥åœ¨android sdk/platform-toolsä¸­æ‰¾åˆ°adbå·¥å…·ï¼Œæˆ–è€…ä¸‹è½½adbå·¥å…·åŒ…ã€‚ ç›®å½• ADBè°ƒè¯• æ— çº¿ åŒ…ç®¡ç†å™¨ æ–‡ä»¶ç®¡ç†å™¨ ç½‘ç»œ è°ƒè¯• æˆªå›¾ ç³»ç»Ÿ","text":"Androidè°ƒè¯•æ¡¥(adb)æ˜¯ä¸€ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥è®©æ‚¨ä¸ä»¿çœŸå™¨æˆ–è¿æ¥çš„Androidè®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚æ‚¨å¯ä»¥åœ¨android sdk/platform-toolsä¸­æ‰¾åˆ°adbå·¥å…·ï¼Œæˆ–è€…ä¸‹è½½adbå·¥å…·åŒ…ã€‚ ç›®å½• ADBè°ƒè¯• æ— çº¿ åŒ…ç®¡ç†å™¨ æ–‡ä»¶ç®¡ç†å™¨ ç½‘ç»œ è°ƒè¯• æˆªå›¾ ç³»ç»Ÿ ADBè°ƒè¯•adb devicesæ‰“å°æ‰€æœ‰é™„åŠ çš„æ¨¡æ‹Ÿå™¨/è®¾å¤‡çš„åˆ—è¡¨ 1adb devices æ‰“å°æ‰€æœ‰é™„åŠ çš„æ¨¡æ‹Ÿå™¨/è®¾å¤‡çš„åˆ—è¡¨ 12e4b25377 deviceemulator-5554 device adb forwardè®¾å¤‡çš„ç«¯å£è½¬å‘ adb forward &lt;local&gt; &lt;remote&gt; 1adb forward tcp:8000 tcp:9000 ##æŠŠPCç«¯8000ç«¯å£çš„æ•°æ®, è½¬å‘åˆ°Androidç«¯çš„9000ç«¯å£ä¸Š æ‰§è¡Œå‘½ä»¤å, PCç«¯çš„8000ç«¯å£ä¼šè¢« adbç›‘å¬, è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åªéœ€è¦å¾€8000ç«¯å£å†™æ•°æ®, è¿™ä¸ªæ•°æ®å°±ä¼šå‘é€åˆ°æ‰‹æœºç«¯çš„9000ç«¯å£ä¸Š. è¿™ä¸ªå‘½ä»¤å¯¹äºæˆ‘ä»¬åœ¨è°ƒè¯•çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«åœ¨ IDA è°ƒè¯•ä¸­ã€‚ å…ˆå†³æ¡ä»¶:åœ¨è®¾å¤‡ä¸Šå¯ç”¨USBè°ƒè¯•ã€‚ adb forwardæŸ¥çœ‹è®¾å¤‡ä¸­å¯ä»¥è¢«è°ƒè¯•çš„åº”ç”¨çš„è¿›ç¨‹å· adb jdwp è¿™ä¸ªå‘½ä»¤æˆ–è®¸ç”¨é€”ä¸æ˜¯å¾ˆå¤šï¼Œä½†æ˜¯å¯¹äºè°ƒè¯•çš„æ—¶å€™è¿˜æ˜¯æœ‰ç‚¹ç”¨é€”ã€‚å¯ä»¥å¿½ç•¥è¿™ä¸ªå‘½ä»¤ã€‚ adb kill-serverç»ˆæ­¢adbæœåŠ¡å™¨è¿›ç¨‹ 1adb kill-server æ³¨é‡Š:å¦‚æœæœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œå°±å°†å…¶æ€æ­»ã€‚(ç»ˆç«¯adb.exeè¿›ç¨‹) æ— çº¿adb connectä½¿ç”¨ADB Wi-Fi adb connect &lt;host&gt;[:&lt;port&gt;] æ­¥éª¤1 é€šè¿‡USBè¿æ¥åˆ°è®¾å¤‡ã€‚ æ­¥éª¤2 1adb devices é™„åŠ çš„è®¾å¤‡åˆ—è¡¨ 1######## device æ­¥éª¤3 1adb tcpip 5555 åœ¨TCPæ¨¡å¼ç«¯å£555é‡æ–°å¯åŠ¨ æ­¥éª¤4 æ‰¾å‡ºAndroidè®¾å¤‡çš„IPåœ°å€: Settings -&gt; About -&gt; Status -&gt; IP addressã€‚è®°ä½IPåœ°å€ #.#.#.# æ­¥éª¤5 1adb connect #.#.#.# è¿æ¥åˆ°#.#.#.#:5555 æ­¥éª¤6 ä»è®¾å¤‡ä¸­ç§»é™¤USBç”µç¼†ï¼Œå¹¶ç¡®è®¤ä½ ä»ç„¶å¯ä»¥è®¿é—®è®¾å¤‡: 1adb devices é™„åŠ çš„è®¾å¤‡åˆ—è¡¨ 1#.#.#.#:5555 device æ³¨æ„:ç¡®ä¿ä½ çš„ä¸»æœºä»ç„¶è¿æ¥åˆ°ä½ çš„Androidè®¾å¤‡ä¸Šçš„ç›¸åŒçš„wifiç½‘ç»œã€‚ adb usbä»¥USBæ¨¡å¼é‡æ–°å¯åŠ¨ADBã€‚ 1adb usb å‚è§:adb connect åŒ…ç®¡ç†å™¨adb installå®‰è£…ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åº(æŒ‡å®šä¸€ä¸ªå®Œæ•´è·¯å¾„çš„.apkæ–‡ä»¶)åˆ°ä¸€ä¸ªæ¨¡æ‹Ÿå™¨/è®¾å¤‡ã€‚ adb install [option] &lt;path&gt; 12345678910111213adb install test.apkadb install -l test.apk ##å®‰è£…é”å®šåº”ç”¨ç¨‹åºadb install -r test.apk ##æ›¿æ¢ç°æœ‰çš„åº”ç”¨ç¨‹åºadb install -t test.apk ##å…è®¸teståŒ…adb install -s test.apk ##sdcardä¸Šå®‰è£…åº”ç”¨ç¨‹åºadb install -d test.apk ##å…è®¸é™çº§ç‰ˆæœ¬ä»£ç adb install -p test.apk ##éƒ¨åˆ†åº”ç”¨ç¨‹åºå®‰è£… æ³¨æ„ï¼šå¦‚æœåº”ç”¨å·²ç»å®‰è£…äº†ï¼Œéœ€è¦ä½¿ç”¨ adb install â€“r [ apk æ–‡ä»¶] ç›¸å½“äºå‡çº§å®‰è£… adb uninstallä»æ¨¡æ‹Ÿå™¨/è®¾å¤‡ä¸­åˆ é™¤ä¸€ä¸ªåŒ…ã€‚ adb uninstall [options] &lt;PACKAGE&gt; 12adb uninstall com.test.appadb uninstall -k com.test.app ##åœ¨åŒ…åˆ é™¤åä¿ç•™æ•°æ®å’Œç¼“å­˜ç›®å½•. adb shell pm list packagesæ‰“å°æ‰€æœ‰åŒ…ï¼Œå¯é€‰çš„åªæœ‰é‚£äº›åŒ…ååŒ…å«æ–‡æœ¬çš„åŒ…ã€‚ adb shell pm list packages [options] &lt;FILTER&gt; 1234567891011121314151617adb shell pm list packagesadb shell pm list packages -f ##çœ‹åˆ°ä»–ä»¬çš„ç›¸å…³æ–‡ä»¶.adb shell pm list packages -d ##åªæ˜¾ç¤ºç¦ç”¨çš„åŒ….adb shell pm list packages -e ##è¿‡æ»¤ä»…æ˜¾ç¤ºå·²å¯ç”¨çš„åŒ….adb shell pm list packages -s ##åªæ˜¾ç¤ºç³»ç»ŸåŒ….adb shell pm list packages -3 ##ç­›é€‰åªæ˜¾ç¤ºç¬¬ä¸‰æ–¹åŒ….adb shell pm list packages -i ##æŸ¥çœ‹åŒ…çš„å®‰è£…ç¨‹åº.adb shell pm list packages -u ##è¿˜åŒ…æ‹¬å¸è½½åŒ….adb shell pm list packages --user &lt;USER_ID&gt; ##æŸ¥è¯¢ç”¨æˆ·ç©ºé—´. adb shell pm pathæ‰“å°ç»™å®šçš„APKçš„è·¯å¾„ã€‚ adb shell pm path &lt;PACKAGE&gt; 1adb shell pm path com.android.phone package:/system/priv-app/TeleService/TeleService.apk adb shell pm clearåˆ é™¤ä¸€ä¸ªåŒ…ç›¸å…³çš„æ‰€æœ‰æ•°æ®ã€‚ adb shell pm clear &lt;PACKAGE&gt; 1adb shell pm clear com.test.abc æ³¨æ„:æ¸…é™¤åº”ç”¨ç¨‹åºæ•°æ®ï¼Œç¼“å­˜ æ–‡ä»¶ç®¡ç†å™¨adb pullä»æ¨¡æ‹Ÿå™¨/è®¾å¤‡ä¸‹è½½æŒ‡å®šçš„æ–‡ä»¶åˆ°æ‚¨çš„è®¡ç®—æœº adb pull &lt;remote&gt; [local] 1adb pull /sdcard/demo.mp4 ä¸‹è½½/sdcard/demo.mp4 åˆ°/platform-toolsç›®å½•ã€‚ 1adb pull /sdcard/demo.mp4 e:\\ ä¸‹è½½/sdcard/demo.mp4 åˆ°Eç›˜ã€‚ adb pushä»ä½ çš„ç”µè„‘ä¸Šä¸Šä¼ ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶åˆ°ä¸€ä¸ªæ¨¡æ‹Ÿå™¨/è®¾å¤‡ã€‚ adb push &lt;local&gt; &lt;remote&gt; 1adb push test.apk /sdcard å¤åˆ¶ /platform-tools/test.apk åˆ° /sdcard ç›®å½• 1adb push d:\\test.apk /sdcard å¤åˆ¶ d:\\test.apk åˆ° /sdcard ç›®å½• adb shell lsåˆ—å‡ºç›®å½•çš„å†…å®¹ ls [options] &lt;directory&gt; æ­¥éª¤1 1adb shell æ­¥éª¤2 123456lsls -a ##ä¸éšè—æ¡ç›®ls -i ##æ¯ä¸ªæ–‡ä»¶çš„æ‰“å°ç´¢å¼•å·ls -s ##æ¯ä¸ªæ–‡ä»¶çš„æ‰“å°å¤§å°ï¼Œåœ¨å—ä¸­ls -n ##åˆ—å‡ºæ•°å­—uidå’Œgidls -R ##é€’å½’åœ°åˆ—å‡ºå­ç›®å½• æ³¨æ„:æŒ‰ Ctrl-Cåœæ­¢ adb shell cdæ”¹å˜å½“å‰å·¥ä½œç›®å½• æ­¥éª¤1 1adb shell æ­¥éª¤2 1cd /system adb shell rmåˆ é™¤æ–‡ä»¶æˆ–ç›®å½• æ­¥éª¤1 1adb shell æ­¥éª¤2 12345rm /sdcard/test.txtrm -f /sdcard/test.txt ## å¼ºåˆ¶åˆ é™¤æ²¡æœ‰æç¤ºrm -r /sdcard/tmp ## é€’å½’åœ°åˆ é™¤ç›®å½•çš„å†…å®¹rm -d /sdcard/tmp ## åˆ é™¤ç›®å½•ï¼Œå³ä½¿å®ƒæ˜¯ä¸€ä¸ªéç©ºç›®å½•rm -i /sdcard/test.txt ## æç¤ºç¬¦ä¹‹å‰åˆ é™¤ âš ï¸:rm -dç›¸å½“äºrmdirå‘½ä»¤ adb shell mkdiråˆ›å»ºç›®å½• mkdir [options] &lt;directory name&gt; 123mkdir /sdcard/tmpmkdir -m 777 /sdcard/tmp ## è®¾ç½®æƒé™æ¨¡å¼mkdir -p /sdcard/tmp/sub1/sub2 ## æ ¹æ®éœ€è¦åˆ›å»ºçˆ¶ç›®å½• adb shell touchåˆ›å»ºç©ºæ–‡ä»¶æˆ–æ›´æ”¹æ–‡ä»¶æ—¶é—´æˆ³ touch [options] &lt;file&gt; æ­¥éª¤1 1adb shell æ­¥éª¤2 1touch /sdcard/tmp/test.txt adb shell pwdæ‰“å°å½“å‰å·¥ä½œç›®å½•ä½ç½®ã€‚ 1pwd adb shell cpå¤åˆ¶æ–‡ä»¶å’Œç›®å½• cp [options] &lt;source&gt; &lt;dest&gt; æ­¥éª¤1 1adb shell æ­¥éª¤2 1cp /sdcard/test.txt /sdcard/demo.txt adb shell mvç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶ mv [options] &lt;source&gt; &lt;dest&gt; æ­¥éª¤1 1adb shell æ­¥éª¤2 12mv /sdcard/tmp /system/tmp ## ç§»åŠ¨mv /sdcard/tmp /sdcard/test ## é‡å‘½å ç½‘ç»œadb shell netstatç½‘ç»œç»Ÿè®¡ä¿¡æ¯ netstat æ­¥éª¤1 1adb shell æ­¥éª¤2 1netstat adb shell pingæµ‹è¯•ä¸¤ä¸ªç½‘ç»œè¿æ¥ä¹‹é—´çš„è¿æ¥å’Œå»¶è¿Ÿã€‚ ping [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface] [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos] [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option] [-w deadline] [-W timeout] [hop1 ...] destination æ­¥éª¤1 1adb shell æ­¥éª¤2 12ping www.google.comping www.google.com -c 4 adb shell netcfgé€šè¿‡é…ç½®æ–‡ä»¶é…ç½®å’Œç®¡ç†ç½‘ç»œè¿æ¥ netcfg [&lt;interface&gt; {dhcp|up|down}] æ­¥éª¤1 1adb shell æ­¥éª¤2 1netcfg adb shell ipæ˜¾ç¤ºã€æ“ä½œè·¯ç”±ã€è®¾å¤‡ã€ç­–ç•¥è·¯ç”±å’Œéš§é“ ip [ OPTIONS ] OBJECT OBJECT := { link | addr | addrlabel | route | rule | neigh | ntable |tunnel | tuntap | maddr | mroute | mrule | monitor | xfrm |netns | l2tp } OPTIONS := { -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] |-f[amily] { inet | inet6 | ipx | dnet | link } |-l[oops] { maximum-addr-flush-attempts } |-o[neline] | -t[imestamp] | -b[atch] [filename] |-rc[vbuf] [size]} æ­¥éª¤1 1adb shell æ­¥éª¤2 1ip -f inet addr show wlan0 ## æ˜¾ç¤ºWiFi IPåœ°å€ è°ƒè¯•adb logcatå°†æ—¥å¿—æ•°æ®æ‰“å°åˆ°å±å¹•ä¸Šã€‚ adb logcat [option] [filter-specs] 1adb logcat 1234567adb logcat *:V ## æœ€ä½ä¼˜å…ˆçº§ï¼Œè¿‡æ»¤åªæ˜¾ç¤ºè¯¦ç»†çº§åˆ«adb logcat *:D ## åªæ˜¾ç¤ºè°ƒè¯•çº§åˆ«adb logcat *:I ## åªæ˜¾ç¤ºä¿¡æ¯çº§åˆ«çš„è¿‡æ»¤å™¨adb logcat *:W ## åªæ˜¾ç¤ºè­¦å‘Šçº§åˆ«adb logcat *:E ## åªæ˜¾ç¤ºé”™è¯¯çº§åˆ«adb logcat *:F ## ä»…æ˜¾ç¤ºè‡´å‘½çº§åˆ«çš„è¿‡æ»¤å™¨adb logcat *:S ## æ— å£°çš„ï¼Œæœ€é«˜çš„ä¼˜å…ˆçº§ï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿è¢«æ‰“å°å‡ºæ¥ adb logcat -b &lt;Buffer&gt; 123adb logcat -b radio ## æŸ¥çœ‹åŒ…å«æ— çº¿/ç”µè¯ç›¸å…³æ¶ˆæ¯çš„ç¼“å†²åŒº.adb logcat -b event ## æŸ¥çœ‹åŒ…å«ä¸äº‹ä»¶ç›¸å…³çš„æ¶ˆæ¯çš„ç¼“å†²åŒº.adb logcat -b main ## é»˜è®¤çš„ 1234567adb logcat -c ## æ¸…é™¤æ•´ä¸ªæ—¥å¿—å’Œé€€å‡ºã€‚adb logcat -d ## å°†æ—¥å¿—è½¬å‚¨åˆ°å±å¹•å¹¶é€€å‡ºã€‚adb logcat -f ## test.logsè®°å½•æ—¥å¿—æ¶ˆæ¯è¾“å‡ºä»¥è¿›è¡Œtest.logsã€‚adb logcat -g ## æ‰“å°æŒ‡å®šçš„æ—¥å¿—ç¼“å†²åŒºå’Œé€€å‡ºçš„å¤§å°ã€‚adb logcat -n &lt;count&gt; ## å°†æ—‹è½¬æ—¥å¿—çš„æœ€å¤§æ•°é‡è®¾ç½®ä¸ºå¯æ•°ã€‚adb logcat -r &lt;kbytes&gt; ## å°†æ—¥å¿—æ–‡ä»¶æ—‹è½¬åˆ°è¾“å‡ºçš„æ¯ä¸€ä¸ªå­—èŠ‚ã€‚adb logcat -s ## è®¾ç½®é»˜è®¤çš„è¿‡æ»¤å™¨è§„èŒƒä¸ºé™é»˜ã€‚ adb logcat -v &lt;format&gt; 1234567adb logcat -v brief ## Dæ˜¾ç¤ºå‘é€æ¶ˆæ¯(é»˜è®¤æ ¼å¼)çš„è¿›ç¨‹çš„ä¼˜å…ˆçº§/æ ‡è®°å’ŒPID.adb logcat -v process ## åªæ˜¾ç¤ºPID)adb logcat -v tag ## åªæ˜¾ç¤ºä¼˜å…ˆçº§/æ ‡è®°ã€‚adb logcat -v raw ## æ˜¾ç¤ºåŸå§‹çš„æ—¥å¿—æ¶ˆæ¯ï¼Œæ²¡æœ‰å…¶ä»–çš„å…ƒæ•°æ®å­—æ®µã€‚adb logcat -v time ## æ˜¾ç¤ºå‘å‡ºæ¶ˆæ¯çš„æ—¥æœŸã€è°ƒç”¨æ—¶é—´ã€ä¼˜å…ˆçº§/æ ‡è®°å’ŒPIDã€‚adb logcat -v threadtime ## æ˜¾ç¤ºå‘å‡ºæ¶ˆæ¯çš„çº¿ç¨‹çš„æ—¥æœŸã€è°ƒç”¨æ—¶é—´ã€ä¼˜å…ˆçº§ã€æ ‡è®°å’ŒPIDå’ŒTIDã€‚adb logcat -v long ## æ˜¾ç¤ºæ‰€æœ‰å…ƒæ•°æ®å­—æ®µå’Œç”¨ç©ºè¡Œåˆ†éš”çš„æ¶ˆæ¯ã€‚ adb shell dumpsysè½¬å‚¨æ–‡ä»¶ç³»ç»Ÿæ•°æ® æŠŠå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨è¿è¡Œçš„å››å¤§ç»„ä»¶éƒ½ä¼šæ‰“å°å‡ºæ¥ adb shell dumpsys [options] 1234567adb shell dumpsysadb shell dumpsys meminfoadb shell dumpsys batteryadb shell dumpsys batterystats ## ä»ä½ çš„è®¾å¤‡æ”¶é›†ç”µæ± æ•°æ®adb shell dumpsys batterystats --reset ## æ¶ˆé™¤æ—§çš„æ”¶é›†æ•°æ®adb shell dumpsys activityadb shell dumpsys gfxinfo com.android.phone ## æµ‹é‡com.android.phone ç”¨æˆ·ç•Œé¢æ€§èƒ½ adb shell dumpsys activity topå¯ä»¥æŸ¥çœ‹å½“å‰åº”ç”¨çš„ activity ä¿¡æ¯ ç”¨æ³•ï¼š è¿è¡Œéœ€è¦æŸ¥çœ‹çš„åº”ç”¨ï¼Œç„¶åè¿è¡Œæ­¤å‘½ä»¤å³å¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960$ adb shell dumpsys activity topTASK com.android.settings id=513 ACTIVITY com.android.settings/.MainSettings f08d06d pid=7492 Local Activity d9b221 State: mResumed=true mStopped=false mFinished=false mChangingConfigurations=false mCurrentConfig=&#123;1.0 ?mcc?mnc zh_CN ldltr sw360dp w360dp h616dp 320dpi nrml long port finger -keyb/v/h -nav/h s.4 themeChanged=0 themeChangedFlags=0&#125; mLoadersStarted=true Active Fragments in c1729ea: #0: SettingsFragment&#123;99e54db #0 id=0x1020002&#125; mFragmentId=#1020002 mContainerId=#1020002 mTag=null mState=5 mIndex=0 mWho=android:fragment:0 mBackStackNesting=0 mAdded=true mRemoving=false mResumed=true mFromLayout=false mInLayout=false mHidden=false mDetached=false mMenuVisible=true mHasMenu=false mRetainInstance=false mRetaining=false mUserVisibleHint=true mFragmentManager=FragmentManager&#123;c1729ea in HostCallbacks&#123;2a70b78&#125;&#125; mHost=android.app.Activity$HostCallbacks@2a70b78 mContainer=android.widget.FrameLayout&#123;3f44a4f V.E...... ........ 0,128-720,1280 #1020002 android:id/content&#125; mView=com.miui.internal.widget.ActionBarOverlayLayout&#123;aa116cc V.E...... ........ 0,0-720,1152 #100b004e miui:id/action_bar_overlay_layout&#125; Child FragmentManager&#123;d6ea251 in SettingsFragment&#123;99e54db&#125;&#125;: FragmentManager misc state: mHost=android.app.Activity$HostCallbacks@2a70b78 mContainer=android.app.Fragment$1@935fab6 mParent=SettingsFragment&#123;99e54db #0 id=0x1020002&#125; mCurState=5 mStateSaved=false mDestroyed=false Added Fragments: #0: SettingsFragment&#123;99e54db #0 id=0x1020002&#125; FragmentManager misc state: mHost=android.app.Activity$HostCallbacks@2a70b78 mContainer=android.app.Activity$HostCallbacks@2a70b78 mCurState=5 mStateSaved=false mDestroyed=false ViewRoot: mAdded=true mRemoved=false mConsumeBatchedInputScheduled=false mConsumeBatchedInputImmediatelyScheduled=false mPendingInputEventCount=0 mProcessInputEventsScheduled=false mTraversalScheduled=false android.view.ViewRootImpl$NativePreImeInputStage: mQueueLength=0 android.view.ViewRootImpl$ImeInputStage: mQueueLength=0 android.view.ViewRootImpl$NativePostImeInputStage: mQueueLength=0 Choreographer: mFrameScheduled=false mLastFrameTime=113407 (34516 ms ago) View Hierarchy: com.android.internal.policy.PhoneWindow$DecorView&#123;430fc62 V.E...... R....... 0,0-720,1280&#125; com.miui.internal.widget.ActionBarOverlayLayout&#123;1267cae V.E...... ........ 0,0-720,1280 #100b004e miui:id/action_bar_overlay_layout&#125; android.widget.FrameLayout&#123;3f44a4f V.E...... ........ 0,128-720,1280 #1020002 android:id/content&#125; android.widget.FrameLayout&#123;9dc5534 V.E...... ........ 0,0-720,1152&#125; miui.view.ViewPager&#123;efe4f5d VFED..... ........ 0,0-720,1152 #100b0000 miui:id/view_pager&#125; android.widget.ListView&#123;8c295a3 G.ED.VC.. ......I. 0,0-0,0 #102000a android:id/list&#125; com.miui.internal.widget.ActionBarOverlayLayout&#123;aa116cc V.E...... ........ 0,0-720,1152 #100b004e miui:id/action_bar_overlay_layout&#125; android.widget.FrameLayout&#123;9510d15 V.E...... ........ 0,0-720,1152 #1020002 android:id/content&#125; android.widget.FrameLayout&#123;16c61d0 V.E...... ........ 0,0-720,1152&#125; android.widget.ListView&#123;7d335c9 VFED.VC.. .F...... 0,0-720,1152 #102000a android:id/list&#125; ... ... Looper (main, tid 1) &#123;d2363b7&#125; Message 0: &#123; when=+23s220ms what=1 target=com.xiaomi.mistatistic.sdk.controller.p$1 &#125; (Total messages: 1, polling=false, quitting=false) adb shell dumpsys packageå¯ä»¥æŸ¥çœ‹æŒ‡å®šåŒ…ååº”ç”¨çš„è¯¦ç»†ä¿¡æ¯(ç›¸å½“äºåº”ç”¨çš„ AndroidManifest.xml ä¸­çš„å†…å®¹) adb shell dumpsys package [pkgname] 123456789101112131415$ adb shell dumpsys package com.android.settingsActivity Resolver Table: Full MIME Types: vnd.android.cursor.item/telephony-carrier: 94d08b7 com.android.settings/.MiuiApnEditor vnd.android.document/root: 2fea824 com.android.settings/.Settings$PublicVolumeSettingsActivity vnd.android.cursor.dir/telephony-carrier: 94d08b7 com.android.settings/.MiuiApnEditor Base MIME Types: vnd.android.document: 2fea824 com.android.settings/.Settings$PublicVolumeSettingsActivity ... ... è¿™é‡Œçœ‹åˆ°å°±æ˜¯ç›¸å½“äºæŠŠåº”ç”¨çš„æ¸…å•æ–‡ä»¶æ‰“å°å‡ºæ¥è€Œå·²ã€‚ adb shell dumpsys meminfoå¯ä»¥æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹åæˆ–è€…æ˜¯è¿›ç¨‹ id çš„å†…å­˜ä¿¡æ¯ adb shell dumpsys meminfo [pname/pid] 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748$ adb shell dumpsys meminfo 7492Applications Memory Usage (kB):Uptime: 1360979 Realtime: 1360979** MEMINFO in pid 7492 [com.android.settings] ** Pss Private Private Swapped Heap Heap Heap Total Dirty Clean Dirty Size Alloc Free ------ ------ ------ ------ ------ ------ ------ Native Heap 4526 4440 0 0 8384 7508 875 Dalvik Heap 6077 6016 36 3872 15479 10500 4979 Dalvik Other 994 992 0 4 Stack 280 280 0 0 Ashmem 12 12 0 0 Gfx dev 3228 3180 0 0 Other dev 4 0 4 0 .so mmap 733 208 0 2516 .apk mmap 13 0 0 0 .dex mmap 260 32 116 20 .oat mmap 1101 200 200 4 .art mmap 1809 1564 28 104 Other mmap 11 8 0 0 Unknown 261 260 0 0 TOTAL 19309 17192 384 6520 23863 18008 5854 App Summary Pss(KB) ------ Java Heap: 7608 Native Heap: 4440 Code: 756 Stack: 280 Graphics: 3180 Private Other: 1312 System: 1733 TOTAL: 19309 TOTAL SWAP (KB): 6520 Objects Views: 122 ViewRootImpl: 1 AppContexts: 4 Activities: 1 Assets: 5 AssetManagers: 2 Local Binders: 49 Proxy Binders: 32 Parcel memory: 6 Parcel count: 27 Death Recipients: 2 OpenSSL Sockets: 0 SQL MEMORY_USED: 0 PAGECACHE_OVERFLOW: 0 MALLOC_SIZE: 62 åˆ©ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å½“å‰çš„å†…å­˜æƒ…å†µ adb shell dumpsys dbinfoå¯ä»¥æŸ¥çœ‹æŒ‡å®šåŒ…ååº”ç”¨çš„æ•°æ®åº“å­˜å‚¨ä¿¡æ¯(åŒ…æ‹¬å­˜å‚¨çš„sqlè¯­å¥) adb shell dumpsys dbinfo [packagename] 12345678910111213141516171819202122232425262728293031323334$ adb shell dumpsys dbinfo com.android.mmsApplications Database Info:** Database info for pid 11635 [com.android.mms] **Connection pool for /data/user/0/com.android.mms/databases/cache.db: Open: true Max connections: 1 Available primary connection: Connection #0: isPrimaryConnection: true onlyAllowReadOnlyOperations: true Most recently executed operations: 0: [2017-12-25 10:37:27.000] executeForCursorWindow took 1ms - succeeded, sql=\"SELECT action_id, action, timestamp FROM ad_cache\" 1: [2017-12-25 10:37:27.000] prepare took 0ms - succeeded, sql=\"SELECT action_id, action, timestamp FROM ad_cache\" 2: [2017-12-25 10:37:26.999] executeForLong took 1ms - succeeded, sql=\"PRAGMA user_version;\" 3: [2017-12-25 10:37:26.999] prepare took 0ms - succeeded, sql=\"PRAGMA user_version;\" 4: [2017-12-25 10:37:26.998] executeForString took 1ms - succeeded, sql=\"SELECT locale FROM android_metadata UNION SELECT NULL ORDER BY locale DESC LIMIT 1\" 5: [2017-12-25 10:37:26.995] execute took 3ms - succeeded, sql=\"CREATE TABLE IF NOT EXISTS android_metadata (locale TEXT)\" 6: [2017-12-25 10:37:26.995] executeForLong took 0ms - succeeded, sql=\"PRAGMA wal_autocheckpoint=100\" 7: [2017-12-25 10:37:26.995] executeForLong took 0ms - succeeded, sql=\"PRAGMA wal_autocheckpoint\" 8: [2017-12-25 10:37:26.995] executeForLong took 0ms - succeeded, sql=\"PRAGMA journal_size_limit=524288\" 9: [2017-12-25 10:37:26.995] executeForLong took 0ms - succeeded, sql=\"PRAGMA journal_size_limit\" 10: [2017-12-25 10:37:26.995] executeForString took 0ms - succeeded, sql=\"PRAGMA synchronous\" 11: [2017-12-25 10:37:26.995] executeForString took 0ms - succeeded, sql=\"PRAGMA journal_mode=PERSIST\" 12: [2017-12-25 10:37:26.994] executeForString took 1ms - succeeded, sql=\"PRAGMA journal_mode\" 13: [2017-12-25 10:37:26.994] executeForLong took 0ms - succeeded, sql=\"PRAGMA foreign_keys\" 14: [2017-12-25 10:37:26.993] executeForLong took 1ms - succeeded, sql=\"PRAGMA page_size\" Available non-primary connections: &lt;none&gt; Acquired connections: &lt;none&gt; Connection waiters: &lt;none&gt; è¿™é‡Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°åº”ç”¨æ‰§è¡Œè¿‡çš„ sql è¯­å¥ä¿¡æ¯ã€‚åœ¨å¯¹åº”ç”¨é€†å‘çš„æ—¶å€™å…·æœ‰ä¸€å®šç”¨é€”ã€‚æ¯•ç«Ÿå¯ä»¥æŸ¥çœ‹åº”ç”¨æ“ä½œæ•°æ®åº“ä¿¡æ¯äº†ã€‚ adb shell dumpstateè½¬å‚¨çŠ¶æ€ 12adb shell dumpstateadb shell dumpstate &gt; state.logs ## å°†çŠ¶æ€è½¬å‚¨åˆ°æ–‡ä»¶ä¸­ adb shell input textè¾“å…¥æ–‡æœ¬å†…å®¹ adb shell input text [éœ€è¦è¾“å…¥æ–‡æœ¬æ¡†å†…å®¹] æ¡ˆä¾‹ï¼š è®©éœ€è¦è¾“å…¥å†…å®¹çš„æ–‡æœ¬æ¡†è·å–ç„¦ç‚¹ï¼Œadb shell input text â€˜HelloWorldâ€™ æ³¨æ„ï¼šè¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥æ¨¡æ‹Ÿç‰©ç†æŒ‰é”®ï¼Œè™šæ‹Ÿé”®ç›˜ï¼Œæ»‘åŠ¨ï¼Œæ»šåŠ¨ç­‰äº‹ä»¶ å»¶ä¼¸ï¼šè¿™ä¸ªå‘½ä»¤å¯¹äºæˆ‘ä»¬åœ¨éœ€è¦è¾“å…¥ä¸€å¤§å †ä¿¡æ¯åˆ°æ–‡æœ¬æ¡†ä¸­çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ç°åœ¨ä½ åœ¨ PC ç«¯æœ‰ä¸€æ®µå†…å®¹ï¼Œæƒ³è¾“å…¥åˆ°æ‰‹æœºçš„æŸä¸ªæœç´¢æ¡†ä¸­ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡æŠŠè¿™æ®µå†…å®¹å‘é€åˆ°æ‰‹æœºï¼Œç„¶ååœ¨å¤åˆ¶æ“ä½œã€‚ä½†æ˜¯æœ‰äº†è¿™ä¸ªå‘½ä»¤å°±éå¸¸ç®€å•ï¼Œå…ˆè®©ä½ æƒ³è¦è¾“å…¥çš„æ–‡æœ¬æ¡†è·å–ç„¦ç‚¹ï¼Œç„¶åè¿è¡Œè¿™ä¸ªå‘½ä»¤å³å¯ã€‚ æˆªå›¾adb shell screencapæˆªå±æ“ä½œã€‚ adb shell screencap &lt;filename&gt; 1adb shell screencap /sdcard/screen.png ä»è®¾å¤‡ä¸­ä¸‹è½½æ–‡ä»¶ 1adb pull /sdcard/screen.png adb shell screenrecord [4.4+]å½•å±æ“ä½œ å½•å±è¿è¡ŒAndroid 4.4(APIçº§åˆ«19)æˆ–æ›´é«˜çš„è®¾å¤‡ã€‚ adb shell screenrecord [options] &lt;filename&gt; 1adb shell screenrecord /sdcard/demo.mp4 ä»è®¾å¤‡ä¸­ä¸‹è½½æ–‡ä»¶ 1adb pull /sdcard/demo.mp4 æ³¨æ„:æŒ‰ä¸‹Ctrl-Cåœæ­¢å±å¹•è®°å½•ï¼Œå¦åˆ™è®°å½•åœ¨ä¸‰åˆ†é’Ÿå†…è‡ªåŠ¨åœæ­¢ï¼Œæˆ–æŒ‰æ—¶é—´é™åˆ¶è®¾å®šçš„æ—¶é—´é™åˆ¶ã€‚ 1adb shell screenrecord --size &lt;WIDTHxHEIGHT&gt; è®¾ç½®è§†é¢‘å¤§å°:1280x720ã€‚é»˜è®¤å€¼æ˜¯è®¾å¤‡çš„æœ¬åœ°æ˜¾ç¤ºåˆ†è¾¨ç‡(å¦‚æœæ”¯æŒçš„è¯)ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œåˆ™æ˜¯1280x720ã€‚ä¸ºäº†å¾—åˆ°æœ€å¥½çš„ç»“æœï¼Œä½¿ç”¨ä½ çš„è®¾å¤‡çš„é«˜çº§è§†é¢‘ç¼–ç (AVC)ç¼–ç å™¨æ‰€æ”¯æŒçš„å°ºå¯¸ã€‚ 1adb shell screenrecord --bit-rate &lt;RATE&gt; è®¾ç½®è§†é¢‘çš„è§†é¢‘æ¯”ç‰¹ç‡ï¼Œä»¥æ¯ç§’å…†æ¯”ç‰¹çš„é€Ÿåº¦ã€‚é»˜è®¤å€¼æ˜¯4Mbpsã€‚ä½ å¯ä»¥å¢åŠ æ¯”ç‰¹ç‡æ¥æé«˜è§†é¢‘è´¨é‡ï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¯¼è‡´æ›´å¤§çš„ç”µå½±æ–‡ä»¶ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†è®°å½•æ¯”ç‰¹ç‡è®¾ç½®ä¸º5Mbps:adb shell screenrecord â€“bit-rate 5000000 /sdcard/demo.mp4 1adb shell screenrecord --time-limit &lt;TIME&gt; è®¾ç½®æœ€å¤§çš„è®°å½•æ—¶é—´ï¼Œä»¥ç§’è®¡ã€‚é»˜è®¤å€¼å’Œæœ€å¤§å€¼æ˜¯180(3åˆ†é’Ÿ)ã€‚ 1adb shell screenrecord --rotate å°†è¾“å‡ºæ—‹è½¬90åº¦ã€‚è¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ã€‚ 1adb shell screenrecord --verbose åœ¨å‘½ä»¤è¡Œå±å¹•ä¸Šæ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯ã€‚å¦‚æœæ‚¨ä¸è®¾ç½®æ­¤é€‰é¡¹ï¼Œåˆ™è¯¥å®ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶ä¸ä¼šæ˜¾ç¤ºä»»ä½•ä¿¡æ¯ã€‚ ç³»ç»Ÿadb rootä½¿ç”¨æ ¹æƒé™é‡æ–°å¯åŠ¨adbdå®ˆæŠ¤è¿›ç¨‹ 1adb root æ³¨æ„:adbdä¸èƒ½åœ¨ç”Ÿäº§æ„å»ºä¸­ä½œä¸ºrootè¿è¡Œ(åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿›è¡Œæµ‹è¯•) adb sideloadflashing/æ¢å¤ Android update.zipåŒ…ã€‚ 1adb sideload &lt;update.zip&gt; æ³¨æ„:adbé‡æ–°å¯åŠ¨Android M+ adb shell psæ‰“å°è¿›ç¨‹çŠ¶æ€ ps [options] æ­¥éª¤1 1adb shell æ­¥éª¤2 12psps -p adb shell topæ˜¾ç¤ºæœ€é«˜CPUè¿›ç¨‹ top [options] æ­¥éª¤1 1adb shell æ­¥éª¤2 12toptop -t ## æ˜¾ç¤ºçº¿ç¨‹è€Œä¸æ˜¯è¿›ç¨‹. adb shell getpropé€šè¿‡å®‰å“propertyæœåŠ¡è·å¾—property getprop [options] æ­¥éª¤1 1adb shell æ­¥éª¤2 1234getpropgetprop ro.build.version.sdkgetprop ro.chipnamegetprop | grep adb adb shell setpropè®¾ç½®propertyæœåŠ¡ setprop &lt;key&gt; &lt;value&gt; æ­¥éª¤1 1adb shell æ­¥éª¤2 1setprop service.adb.tcp.port 5555","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"ADB","slug":"Android/ADB","permalink":"https://jigangduan.github.io/categories/Android/ADB/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"adb","slug":"adb","permalink":"https://jigangduan.github.io/tags/adb/"}]},{"title":"æŒæ¡Android NDKæ„å»ºç³»ç»Ÿâ€”â€”ç¬¬2éƒ¨åˆ†:ç‹¬ç«‹çš„å·¥å…·é“¾","slug":"MasteringAndroidNDKBuildSystem2","date":"2017-11-02T03:31:23.000Z","updated":"2020-07-25T02:57:18.159Z","comments":true,"path":"2017/11/02/MasteringAndroidNDKBuildSystem2/","link":"","permalink":"https://jigangduan.github.io/2017/11/02/MasteringAndroidNDKBuildSystem2/","excerpt":"[ç¿»è¯‘]æŒæ¡Android NDKæ„å»ºç³»ç»Ÿâ€”â€”ç¬¬2éƒ¨åˆ†:ç‹¬ç«‹çš„å·¥å…·é“¾åŸè‹±æ–‡æ–‡ç«  è¿™æ˜¯â€œæŒæ¡NDKâ€çš„ç¬¬2éƒ¨åˆ†ã€‚åœ¨å‰é¢çš„éƒ¨åˆ†(ç¬¬1éƒ¨åˆ†)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ndk-buildæ„å»ºAndroidæœ¬åœ°é¡¹ç›®ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†ä¸€äº›é«˜çº§æŠ€æœ¯æ¥ç®¡ç†å’Œå®šåˆ¶å¤§å‹é¡¹ç›®çš„æ„å»ºè„šæœ¬ã€‚ å°½ç®¡å¯¹äºå¤§å¤šæ•°Androidæœ¬åœ°é¡¹ç›®æ¥è¯´ï¼Œndk-buildå¯èƒ½å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä»ç„¶å¯èƒ½éœ€è¦ç‹¬ç«‹çš„å·¥å…·é“¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªc/c++é¡¹ç›®ï¼Œå®ƒå¯èƒ½éå¸¸å¤æ‚ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå¤æ‚çš„makefileã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½è½¬æ¢æˆAndroid.mkå’ŒApplication.mkã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç‹¬ç«‹çš„å·¥å…·é“¾æ›´æœ‰æ„ä¹‰ï¼Œå®ƒå…è®¸æ‚¨ä¿ç•™æœ€åˆçš„makefileï¼Œæˆ–è€…é‡ç”¨å¤§å¤šæ•°åŸå§‹makefileã€‚å› æ­¤ï¼Œåœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†ç®€è¦ä»‹ç»ç‹¬ç«‹å·¥å…·é“¾çš„ç”¨æ³•ï¼Œå¹¶ç»™å‡ºä¸€äº›ä»£ç ç¤ºä¾‹ã€‚ æ‰€æœ‰ä¾‹å­çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:https://github.com/robertwgh/mastering-ndkã€‚","text":"[ç¿»è¯‘]æŒæ¡Android NDKæ„å»ºç³»ç»Ÿâ€”â€”ç¬¬2éƒ¨åˆ†:ç‹¬ç«‹çš„å·¥å…·é“¾åŸè‹±æ–‡æ–‡ç«  è¿™æ˜¯â€œæŒæ¡NDKâ€çš„ç¬¬2éƒ¨åˆ†ã€‚åœ¨å‰é¢çš„éƒ¨åˆ†(ç¬¬1éƒ¨åˆ†)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ndk-buildæ„å»ºAndroidæœ¬åœ°é¡¹ç›®ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†ä¸€äº›é«˜çº§æŠ€æœ¯æ¥ç®¡ç†å’Œå®šåˆ¶å¤§å‹é¡¹ç›®çš„æ„å»ºè„šæœ¬ã€‚ å°½ç®¡å¯¹äºå¤§å¤šæ•°Androidæœ¬åœ°é¡¹ç›®æ¥è¯´ï¼Œndk-buildå¯èƒ½å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä»ç„¶å¯èƒ½éœ€è¦ç‹¬ç«‹çš„å·¥å…·é“¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªc/c++é¡¹ç›®ï¼Œå®ƒå¯èƒ½éå¸¸å¤æ‚ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå¤æ‚çš„makefileã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½è½¬æ¢æˆAndroid.mkå’ŒApplication.mkã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç‹¬ç«‹çš„å·¥å…·é“¾æ›´æœ‰æ„ä¹‰ï¼Œå®ƒå…è®¸æ‚¨ä¿ç•™æœ€åˆçš„makefileï¼Œæˆ–è€…é‡ç”¨å¤§å¤šæ•°åŸå§‹makefileã€‚å› æ­¤ï¼Œåœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†ç®€è¦ä»‹ç»ç‹¬ç«‹å·¥å…·é“¾çš„ç”¨æ³•ï¼Œå¹¶ç»™å‡ºä¸€äº›ä»£ç ç¤ºä¾‹ã€‚ æ‰€æœ‰ä¾‹å­çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:https://github.com/robertwgh/mastering-ndkã€‚ ç›®å½• åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ ndk-buildå·¥ä½œæµ ä¸ºæ‚¨çš„é¡¹ç›®ä½¿ç”¨å®šåˆ¶çš„å·¥å…·é“¾ æ€»ç»“ åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰Android NDKå®˜æ–¹æ–‡æ¡£åŒ…å«ä¸€ç« â€œæ ‡å‡†å·¥å…·é“¾â€ï¼Œå®ƒæä¾›äº†å…³äºç‹¬ç«‹å·¥å…·é“¾çš„æœ‰ç”¨ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œè¯¥æ–‡æ¡£ç¼ºå°‘è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä¸”æ²¡æœ‰ç¤ºä¾‹æ¥æ¼”ç¤ºä½¿ç”¨æƒ…å†µã€‚å› æ­¤ï¼Œå¯èƒ½å¾ˆéš¾éµå¾ªå®˜æ–¹æ–‡ä»¶ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒã€‚ ndk-buildå·¥ä½œæµå®é™…ä¸Šï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ndk-buildæ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ç”¨è°ƒè¯•é€‰é¡¹V=1ï¼Œå¦‚ä¸‹: 1ndk-build V=1 æˆ‘ä»¬å°†çœ‹åˆ°ndk-buildå®é™…åšäº†ä»€ä¹ˆã€‚ä¸‹é¢çš„æ§åˆ¶å°æ‰“å°æ¥è‡ªäºç¤ºä¾‹1çš„ç¼–è¯‘ã€‚ 12345678910111213141516$ ndk-build V=1rm -f ./libs/arm64-v8a/lib*.so ./libs/armeabi/lib*.so ./libs/armeabi-v7a/lib*.so ./libs/armeabi-v7a-hard/lib*.so ./libs/mips/lib*.so ./libs/mips64/lib*.so ./libs/x86/lib*.so ./libs/x86_64/lib*.sorm -f ./libs/arm64-v8a/gdbserver ./libs/armeabi/gdbserver ./libs/armeabi-v7a/gdbserver ./libs/armeabi-v7a-hard/gdbserver ./libs/mips/gdbserver ./libs/mips64/gdbserver ./libs/x86/gdbserver ./libs/x86_64/gdbserverrm -f ./libs/arm64-v8a/gdb.setup ./libs/armeabi/gdb.setup ./libs/armeabi-v7a/gdb.setup ./libs/armeabi-v7a-hard/gdb.setup ./libs/mips/gdb.setup ./libs/mips64/gdb.setup ./libs/x86/gdb.setup ./libs/x86_64/gdb.setup[armeabi-v7a] Compile++ thumb: hello &lt;= hello.cpp/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-g++ -MMD -MP -MF ./obj/local/armeabi-v7a/objs-debug/hello/hello.o.d.org -fpic -ffunction-sections -funwind-tables -fstack-protector -no-canonical-prefixes -march=armv7-a -mfpu=vfpv3-d16 -mfloat-abi=softfp -fno-exceptions -fno-rtti -mthumb -Os -g -DNDEBUG -fomit-frame-pointer -fno-strict-aliasing -finline-limit=64 -O0 -UNDEBUG -marm -fno-omit-frame-pointer -ID:/development/android-ndk-r10d/sources/cxx-stl/stlport/stlport -ID:/development/android-ndk-r10d/sources/cxx-stl//gabi++/include -Ijni -DANDROID -Wa,--noexecstack -Wformat -Werror=format-security -fPIE -frtti -frtti -fexceptions -ID:/development/android-ndk-r10d/platforms/android-19/arch-arm/usr/include -c jni/hello.cpp -o ./obj/local/armeabi-v7a/objs-debug/hello/hello.o &amp;&amp; ./obj/convert-dependencies.sh ./obj/local/armeabi-v7a/objs-debug/hello/hello.o.d[armeabi-v7a] Executable : hello/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-g++ -Wl,--gc-sections -Wl,-z,nocopyreloc --sysroot=D:/development/android-ndk-r10d/platforms/android-19/arch-arm -Wl,-rpath-link=D:/development/android-ndk-r10d/platforms/android-19/arch-arm/usr/lib -Wl,-rpath-link=./obj/local/armeabi-v7a ./obj/local/armeabi-v7a/objs-debug/hello/hello.o D:/development/android-ndk-r10d/sources/cxx-stl/stlport/libs/armeabi-v7a/thumb/libstlport_static.a -lgcc -no-canonical-prefixes -march=armv7-a -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -fPIE -pie -lc -lm -o ./obj/local/armeabi-v7a/hello[armeabi-v7a] Install : hello =&gt; libs/armeabi-v7a/helloinstall -p ./obj/local/armeabi-v7a/hello ./libs/armeabi-v7a/hello/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-strip --strip-unneeded ./libs/armeabi-v7a/hello æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œndk-buildå®é™…ä¸Šåšäº†å¦‚ä¸‹çš„äº‹æƒ…: åœ¨è¾“å‡ºæ–‡ä»¶å¤¹libsä¸­åˆ é™¤ä»¥å‰æ„å»ºçš„æ–‡ä»¶ã€‚ ä»æºä»£ç æ„å»ºhello.oã€‚ ä»hello.oæ„å»ºå¯æ‰§è¡Œã€‚ æ ¹æ®ABIï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°å­æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å¤¹ã€‚ ä¸Šé¢çš„æ„å»ºä¿¡æ¯æ˜¾ç¤ºäº†ndk-buildå¦‚ä½•è°ƒç”¨å·¥å…·é“¾æ¥æ„å»ºé¡¹ç›®ã€‚åŸºæœ¬ä¸Š/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-g++æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·é“¾åœ¨NDKå®‰è£…ä¸­ã€‚å¦‚æœæˆ‘ä»¬è¯»å–æ•´ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¯¥å‘½ä»¤åªè°ƒç”¨äº†cross-compilationç‰ˆæœ¬çš„g++ï¼Œå¹¶å¸¦æœ‰è¯¸å¦‚includeè·¯å¾„ã€åº“è·¯å¾„ç­‰æ„å»ºå‚æ•°ã€‚ä½¿ç”¨ç‹¬ç«‹çš„å·¥å…·é“¾æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯æ¨¡ä»¿ndk-buildçš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ç›´æ¥æ ¹æ®ç›®æ ‡ä½“ç³»ç»“æ„å’Œå¹³å°è°ƒç”¨æ­£ç¡®çš„ç¼–è¯‘å™¨ã€‚ åœ¨NDK_ROOT/toolchainsç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ARMã€X86ã€x8664ã€MIPSç­‰ä¸åŒçš„å·¥å…·é“¾ã€‚è¿˜æœ‰ä¸åŒç¼–è¯‘å™¨çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚g++å’Œclangã€‚å› æ­¤ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥é€‰æ‹©é€‚åˆæˆ‘ä»¬é¡¹ç›®çš„ä»»ä½•ä¸œè¥¿ã€‚ ä¸ºæ‚¨çš„é¡¹ç›®ä½¿ç”¨å®šåˆ¶çš„å·¥å…·é“¾æ˜¾ç„¶ï¼Œä¸Šé¢çš„æ–¹æ³•æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯å®ƒéå¸¸å†—é•¿ï¼Œä¸é€‚åˆè¾ƒå¤§çš„é¡¹ç›®ã€‚æˆ‘ä»¬æ‰€èƒ½åšçš„æ˜¯ä¸ºç‰¹å®šçš„å¹³å°å’ŒABIåˆ›å»ºä¸€ä¸ªâ€œcustomizedâ€å·¥å…·é“¾ï¼Œå€ŸåŠ©NDKå®‰è£…ä¸­æä¾›çš„$NDK/build/tools/make-standalone-toolchain.shå·¥å…·çš„å¸®åŠ©ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹é…ç½®çš„é¡¹ç›®: æ”¯æŒandroid-19å¹³å°ã€‚ ä¸»æœºç³»ç»Ÿæ˜¯Windows 7 64ä½ã€‚ ç›®æ ‡æ¶æ„æ˜¯ARMã€‚ æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè„šæœ¬generate_standalone_toolchain.shå¸®åŠ©æˆ‘ä»¬è¾“å‡ºæˆ‘ä»¬éœ€è¦çš„å·¥å…·é“¾: 12345NDK=/cygdrive/d/development/android-ndk-r10dSYSROOT=$NDK/platforms/android-19/arch-arm/mkdir -p /cygdrive/d/development/standalone_toolchain/$NDK/build/tools/make-standalone-toolchain.sh --arch=arm --platform=android-19 --system=windows-x86_64 --install-dir=/cygdrive/d/development/standalone_toolchain/chmod -R 755 /cygdrive/d/development/standalone_toolchain è¾…åŠ©è„šæœ¬$NDK/build/tools/make-standalone-toolchain.shåœ¨/tmpä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œå°†æ–‡ä»¶å¤åˆ¶åˆ°è¯¥ç›®å½•ï¼Œå¹¶æœ€ç»ˆå°†æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ã€‚è¯·ç¡®ä¿æ‚¨æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå¦åˆ™åœ¨è®¿é—®/tmpç›®å½•æ—¶å°†é‡åˆ°â€œæƒé™æ‹’ç»â€é”™è¯¯ã€‚ å¦‚æœæ­£ç¡®é…ç½®äº†è·¯å¾„ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ§åˆ¶å°ä¿¡æ¯: 12345678$ ./generate_standalone_toolchain.shAuto-config: --toolchain=arm-linux-androideabi-4.8Copying prebuilt binaries...Copying sysroot headers and libraries...Copying c++ runtime headers and libraries...Copying files to: /cygdrive/d/development/standalone_toolchain/Cleaning up...Done. ä¸€æ—¦è¿™æ ·åš,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªå·¥å…·é“¾å¤åˆ¶ä»NDK_ROOT/toolchainsåˆ°/cygdrive/d/development/standalone_toolchain/ã€‚ ç¤ºä¾‹: helloworldä¸ºäº†æµ‹è¯•å®šåˆ¶çš„å·¥å…·é“¾ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®helloworldã€‚é¡¹ç›®ç»“æ„éå¸¸ç®€å•: 123+-- helloworld| +-- hello.cpp| +-- Makefile hello.cpp 12345#include &lt;iostream&gt;int main()&#123; std::cout &lt;&lt; \"Hello World!\" &lt;&lt; std::endl;&#125; Makefile 1234567891011121314151617STANDALONE_TOOLCHAIN=/cygdrive/d/development/standalone_toolchain/bin/CC=$(STANDALONE_TOOLCHAIN)/arm-linux-androideabi-gccCXX=$(STANDALONE_TOOLCHAIN)/arm-linux-androideabi-g++CFLAGS=-march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -c -WallLDFLAGS=-march=armv7-a -Wl,--fix-cortex-a8SOURCES=hello.cppOBJECTS=$(SOURCES:.cpp=.o)EXECUTABLE=helloall: $(SOURCES) $(EXECUTABLE)$(EXECUTABLE): $(OBJECTS) $(CXX) $(LDFLAGS) $(OBJECTS) -o $@.cpp.o: $(CXX) $(CFLAGS) $&lt; -o $@clean: rm *.o hello; æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ç¼–è¯‘ä»£ç ï¼Œæˆ‘ä»¬å°†å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶: 1234$ cd helloworld$ make/cygdrive/d/development/standalone_toolchain/bin//arm-linux-androideabi-g++ -march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -c -Wall hello.cpp -o hello.o/cygdrive/d/development/standalone_toolchain/bin//arm-linux-androideabi-g++ -march=armv7-a -Wl,--fix-cortex-a8 hello.o -o hello å¦ä¸€ä¸ªç¤ºä¾‹:clcomputeè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä¾‹å­ï¼Œä½¿ç”¨OpenCLè¿›è¡Œå¹³è¡ŒçŸ¢é‡åŠ æ³•ã€‚å‡è®¾æˆ‘ä»¬æœ‰CLå’Œåº“æ–‡ä»¶å¯ç”¨: 12345+-- D:\\opencl_lib| +-- include| +-- CL| +-- libs| +-- libOpenCL.so CLåŒ…å«å¤´æ–‡ä»¶å¯ä»¥ä»Khronosç»„ç½‘ç«™ä¸Šä¸‹è½½ã€‚è€Œlibopenclsoåº“æ–‡ä»¶å¯ä»¥ä»ä¸€ä¸ªå…·æœ‰openclåŠŸèƒ½çš„æ‰‹æœºä¸­æ£€ç´¢åˆ°ã€‚ä½ å¯ä»¥ä½¿ç”¨adb pullä»ä½ çš„æ‰‹æœº(æˆ–å¹³æ¿ç”µè„‘)ä¸­æ‹‰å‡ºå®ƒã€‚æ‚¨å¯ä»¥å‚è€ƒæœ¬æ–‡çš„ç¬¬1éƒ¨åˆ†ä¸­çš„è¡¨ï¼Œä»¥è·å¾—ibOpenCL.soçš„è¯¦ç»†ä½ç½®ã€‚å¯¹äºä¸åŒçš„SoCèŠ¯ç‰‡ç»„ã€‚ é¡¹ç›®ç»“æ„: 123+-- clcompute| +-- clcompute.cpp| +-- Makefile Makefile 12345678910111213141516171819STANDALONE_TOOLCHAIN=/cygdrive/d/development/standalone_toolchain/bin/OPENCL=/cygdrive/d/opencl_lib/CC=$(STANDALONE_TOOLCHAIN)/arm-linux-androideabi-gccCXX=$(STANDALONE_TOOLCHAIN)/arm-linux-androideabi-g++CFLAGS=-march=armv7-a -mfloat-abi=softfp -mfpu=vfpv3-d16 -c -I $(OPENCL)/inc/LDFLAGS=-march=armv7-a -Wl,--fix-cortex-a8 -L$(OPENCL)/libs/ -lOpenCLSOURCES=clcompute.cppOBJECTS=$(SOURCES:.cpp=.o)EXECUTABLE=clcomputeall: $(SOURCES) $(EXECUTABLE)$(EXECUTABLE): $(OBJECTS) $(CXX) $(LDFLAGS) $(OBJECTS) -o $@.cpp.o: $(CXX) $(CFLAGS) $&lt; -o $@clean: rm *.o $(EXECUTABLE); æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œä¸€æ—¦æ‚¨å¯¼å‡ºäº†ç‹¬ç«‹çš„å·¥å…·é“¾ï¼Œå½“æ‚¨æŒ‡å®šäº†é€šå¾€å·¥å…·é“¾çš„è·¯å¾„æ—¶ï¼ŒmakefileåŸºæœ¬ä¸Šä¸æ™®é€šçš„makefileç›¸åŒã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œé€šè¿‡ä½¿ç”¨ç‹¬ç«‹çš„å·¥å…·é“¾ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€äº›å¤æ‚çš„é¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®å¯èƒ½éœ€è¦å¤§é‡çš„å·¥ä½œï¼Œè¿™æ˜¯ä½¿ç”¨ndk-buildçš„ æ€»ç»“åœ¨è¿™ä¸ªæŠ€æœ¯è¯´æ˜(ç¬¬1éƒ¨åˆ†å’Œç¬¬2éƒ¨åˆ†)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸Androidæœ¬åœ°é¡¹ç›®ç¼–è¯‘ç›¸å…³çš„ä½¿ç”¨å’ŒæŠ€æœ¯ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"NDK","slug":"Android/NDK","permalink":"https://jigangduan.github.io/categories/Android/NDK/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"ndk","slug":"ndk","permalink":"https://jigangduan.github.io/tags/ndk/"},{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://jigangduan.github.io/tags/ç¿»è¯‘/"}]},{"title":"æŒæ¡Android NDKæ„å»ºç³»ç»Ÿâ€”â€”ç¬¬1éƒ¨åˆ†:ä½¿ç”¨ndk-buildæŠ€å·§","slug":"MasteringAndroidNDKBuildSystem1","date":"2017-11-01T10:31:23.000Z","updated":"2020-07-25T02:57:18.159Z","comments":true,"path":"2017/11/01/MasteringAndroidNDKBuildSystem1/","link":"","permalink":"https://jigangduan.github.io/2017/11/01/MasteringAndroidNDKBuildSystem1/","excerpt":"[ç¿»è¯‘]æŒæ¡Android NDKæ„å»ºç³»ç»Ÿâ€”â€”ç¬¬1éƒ¨åˆ†:ä½¿ç”¨ndk-buildæŠ€å·§åŸè‹±æ–‡æ–‡ç«  è¿™ç¯‡æ–‡ç« ä¸æ˜¯ä¸€ä¸ªâ€œHello world!â€ç±»å‹çš„NDKâ€æ•™ç¨‹ã€‚å°½ç®¡æˆ‘ä»å°†ç®€è¦ä»‹ç»ndkæ„å»ºçš„åŸºæœ¬çŸ¥è¯†ï¼Œä½†è¿™å¹¶ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚ç›¸åï¼Œæˆ‘å°†æ€»ç»“ä¸€äº›éå¸¸æœ‰ç”¨çš„NDKæŠ€å·§å’Œæˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æŠ€å·§ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹äºé‚£äº›æƒ³è¦å»ºç«‹ä¸€äº›å®é™…é¡¹ç›®çš„äººæ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­¦ä¹ NDKçš„ç©å…·é¡¹ç›®ã€‚å› æ­¤ï¼Œç›®æ ‡è¯»è€…æ˜¯ä¸­æˆ–é«˜çº§Androidå¼€å‘äººå‘˜ã€‚è¿™ç¯‡æ–‡ç« åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†: ç¬¬1éƒ¨åˆ†:ndk-build åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•çµæ´»åœ°ä½¿ç”¨ndk-buildæ¥æ„å»ºæ‚¨çš„é¡¹ç›®ï¼Œä»¥åŠå¦‚ä½•ç»„ç»‡æ‚¨çš„é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ã€‚ ç¬¬2éƒ¨åˆ†:ç‹¬ç«‹çš„å·¥å…·é“¾ åœ¨ç¬¬2éƒ¨åˆ†ä¸­ï¼Œå°†è®¨è®ºç‹¬ç«‹å·¥å…·é“¾çš„è®¾ç½®å’Œä½¿ç”¨ã€‚ æ‰€æœ‰ä¾‹å­çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:https://github.com/robertwgh/mastering-ndkã€‚","text":"[ç¿»è¯‘]æŒæ¡Android NDKæ„å»ºç³»ç»Ÿâ€”â€”ç¬¬1éƒ¨åˆ†:ä½¿ç”¨ndk-buildæŠ€å·§åŸè‹±æ–‡æ–‡ç«  è¿™ç¯‡æ–‡ç« ä¸æ˜¯ä¸€ä¸ªâ€œHello world!â€ç±»å‹çš„NDKâ€æ•™ç¨‹ã€‚å°½ç®¡æˆ‘ä»å°†ç®€è¦ä»‹ç»ndkæ„å»ºçš„åŸºæœ¬çŸ¥è¯†ï¼Œä½†è¿™å¹¶ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚ç›¸åï¼Œæˆ‘å°†æ€»ç»“ä¸€äº›éå¸¸æœ‰ç”¨çš„NDKæŠ€å·§å’Œæˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æŠ€å·§ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹äºé‚£äº›æƒ³è¦å»ºç«‹ä¸€äº›å®é™…é¡¹ç›®çš„äººæ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­¦ä¹ NDKçš„ç©å…·é¡¹ç›®ã€‚å› æ­¤ï¼Œç›®æ ‡è¯»è€…æ˜¯ä¸­æˆ–é«˜çº§Androidå¼€å‘äººå‘˜ã€‚è¿™ç¯‡æ–‡ç« åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†: ç¬¬1éƒ¨åˆ†:ndk-build åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•çµæ´»åœ°ä½¿ç”¨ndk-buildæ¥æ„å»ºæ‚¨çš„é¡¹ç›®ï¼Œä»¥åŠå¦‚ä½•ç»„ç»‡æ‚¨çš„é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ã€‚ ç¬¬2éƒ¨åˆ†:ç‹¬ç«‹çš„å·¥å…·é“¾ åœ¨ç¬¬2éƒ¨åˆ†ä¸­ï¼Œå°†è®¨è®ºç‹¬ç«‹å·¥å…·é“¾çš„è®¾ç½®å’Œä½¿ç”¨ã€‚ æ‰€æœ‰ä¾‹å­çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:https://github.com/robertwgh/mastering-ndkã€‚ ç›®å½• ä»‹ç» å…ˆå†³æ¡ä»¶ ndk-buildçš„åŸºæœ¬çŸ¥è¯† ä½¿ç”¨NDKæ„å»ºæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ æœ‰ç”¨çš„æŠ€æœ¯ å¦‚ä½•åœ¨jniç›®å½•ä¸­ç¼–è¯‘æºä»£ç  å»æ‰jniæ–‡ä»¶å¤¹ ä¸ºmakefileä½¿ç”¨è‡ªå®šä¹‰åç§° ä½¿ç”¨includeåµŒå…¥.mkæ–‡ä»¶ å…³äºLOCAL_PATHå’ŒCLEAR_VARS å¦‚ä½•è°ƒè¯•.mk makefile é’ˆå¯¹å¤šä¸ªç›®æ ‡ä½“ç³»ç»“æ„çš„æ„å»º æ€»ç»“ ä»‹ç»Android NDK(æœ¬åœ°å¼€å‘å·¥å…·åŒ…)æ˜¯Androidåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜çš„ä¸€ç§å¼ºå¤§å·¥å…·ï¼Œä»–ä»¬æƒ³è¦é«˜æ•ˆå’Œé«˜æ€§èƒ½çš„æœ¬åœ°ä»£ç ï¼Œæˆ–è€…éœ€è¦å¤„ç†åº•å±‚ç¡¬ä»¶ç»†èŠ‚(å¦‚OpenGLã€OpenCLç­‰)ã€‚ Android NDKå®˜æ–¹æ–‡æ¡£(åœ¨çº¿ç‰ˆæœ¬)æ˜¯OKçš„ï¼Œå¦‚æœä½ å·²ç»ä½¿ç”¨NDKå·¥ä½œè¿‡ä¸€æ®µæ—¶é—´äº†ã€‚ä¸è¿‡ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸“é—¨ä¸ºåˆšå¼€å§‹ä½¿ç”¨Android NDKå¼€å‘çš„äººè®¾è®¡çš„ã€‚å®˜æ–¹æ–‡ä»¶çš„é—®é¢˜æ˜¯æ²¡æœ‰é‡ç‚¹ï¼Œå› æ­¤é‡è¦çš„ä¿¡æ¯å¾ˆå®¹æ˜“è¢«å¿½è§†ã€‚ è¿˜æœ‰è®¸å¤šåœ¨çº¿æ•™ç¨‹å’Œæ–‡ç« å±•ç¤ºäº†NDKçš„åŸºç¡€å’ŒNDKæ„å»ºå·¥å…·çš„ä½¿ç”¨ã€‚ç„¶è€Œï¼Œè¿™äº›ä¿¡æ¯åˆ°å¤„éƒ½æ˜¯ã€‚æ²¡æœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥æ·±å…¥åœ°è®¨è®ºè¿™äº›ä¸»é¢˜å’ŒæŠ€æœ¯ã€‚å¸Œæœ›æœ¬æ–‡èƒ½æ¶µç›–å…¶ä¸­çš„ä¸€äº›å†…å®¹ã€‚ å…ˆå†³æ¡ä»¶åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æå‡ºä»¥ä¸‹å‡è®¾: ä½ çŸ¥é“NDKæ˜¯ä»€ä¹ˆ; ä½ äº†è§£C/C++; ä½ å·²ç»åœ¨ç”µè„‘ä¸Šå®‰è£…äº†Android NDKã€‚åœ¨æˆ‘çš„è®¾ç½®ä¸­ï¼Œæˆ‘å®‰è£…åœ¨D:\\development\\android-ndk-r10dä¸‹é¢ã€‚åœ¨æœ¬æ–‡çš„åé¢éƒ¨åˆ†ï¼Œæˆ‘å°†è°ƒç”¨è¿™æ¡è·¯å¾„NDK_ROOTã€‚ ä¸ºäº†é¿å…ä½¿ç”¨ndk-buildæ—¶çš„é•¿è·¯å¾„åï¼Œæˆ‘å°†NDK_ROOTæ·»åŠ åˆ°ç³»ç»ŸPATHç¯å¢ƒå˜é‡ä¸­ã€‚ ndk-buildçš„åŸºæœ¬çŸ¥è¯†å½“ç„¶ï¼Œä½¿ç”¨Android NDKçš„ç¬¬ä¸€æ­¥æ˜¯ä»Androidå¼€å‘è€…ç½‘ç»œä¸‹è½½NDKå®‰è£…åŒ…ã€‚åœ¨å®‰è£…NDKåŒ…ä¹‹åï¼Œè¿™äº›æ˜¯æ‚¨å¾—åˆ°çš„: NDK_ROOT\\ndk-build.cmdè„šæœ¬; NDK_ROOT\\docs æ–‡æ¡£; å·¥å…·é“¾å’Œç¼–è¯‘å™¨; ä¸€äº›æœ¬åœ°åº“çš„æºä»£ç ; ä¸€äº›ç¤ºä¾‹ä»£ç ã€‚ å¦‚æœæ‚¨æƒ³äº†è§£åŸºæœ¬çš„è®¾ç½®å’ŒNDKçš„makefileçš„è¯­æ³•ï¼Œé‚£ä¹ˆç¤ºä¾‹ä»£ç å¯èƒ½éå¸¸æœ‰ç”¨ã€‚é€šè¿‡NDKæä¾›çš„ç¤ºä¾‹ä»£ç ï¼Œæ‚¨å°†å‘ç°å¤§å¤šæ•°ä»£ç ç¤ºä¾‹ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åºé¡¹ç›®ï¼Œå¹¶å°†ä½¿ç”¨NDKæ¥æ„å»ºAndroidåº”ç”¨ç¨‹åºçš„JNIéƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨æ³¨æ„åˆ°æ‰€æœ‰çš„é¡¹ç›®éƒ½åœ¨jniæ–‡ä»¶å¤¹ä¸‹æ”¾ç½®c/c++æºä»£ç å’Œmakefileã€‚ ä»¥ä¸‹æ˜¯NDKç¤ºä¾‹çš„å…¸å‹æ–‡ä»¶ç»“æ„: structure1234567+-- project_root| +-- jni| +-- Android.mk| +-- Application.mk| +-- main.c| +-- obj| +-- libs å¦‚æ‚¨æ‰€è§ï¼Œjniç›®å½•æ˜¯æ•´ä¸ªNDKé¡¹ç›®çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«c/c++æºä»£ç ï¼Œä¸¤ä¸ªmakefile Android.mkå’ŒApplication.mkã€‚ç¨åå°†è®¨è®ºï¼Œæ‚¨å°†çœ‹åˆ°c/c++æºä»£ç å¹¶ä¸éœ€è¦æ”¾åœ¨jniæ–‡ä»¶å¤¹ä¸­ã€‚æ­¤å¤–ï¼Œæ‚¨ä¸éœ€è¦ä¸ºmakefileæä¾›å®Œå…¨ç›¸åŒçš„åç§°ã€‚ä½†ä½œä¸ºä¸€ä¸ªèµ·ç‚¹ï¼Œä½¿ç”¨ndroid.mkå’ŒApplication.mkå°†æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥ä¸ºä½ èŠ‚çœå¤§é‡çš„ç²¾åŠ›ï¼Œé™¤éä½ çœŸçš„ä¸å–œæ¬¢makefileçš„å½“å‰åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œndk-buildå°†å°è¯•å®šä½ å¦å¤–ä¸¤ä¸ªæ–‡ä»¶å¤¹objå’Œlibsæ˜¯ç”±NDKæ„å»ºç³»ç»Ÿç”Ÿæˆçš„ï¼Œå®ƒä»¬åˆ†åˆ«åŒ…å«ä¸­é—´æ–‡ä»¶å’Œæœ€ç»ˆçš„äºŒè¿›åˆ¶ä»£ç ã€‚ Android.mkå’ŒApplication.mkæ˜¯NDKé¡¹ç›®æœ€é‡è¦çš„makefileæ–‡ä»¶ã€‚ Android.mkæ›´åƒæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„makefileï¼Œå®šä¹‰æºä»£ç ã€åŒ…å«å¤´æ–‡ä»¶çš„è·¯å¾„ã€é“¾æ¥å™¨çš„è·¯å¾„æ¥å®šä½åº“ã€æ¨¡å—åã€æ„å»ºç±»å‹ç­‰ç­‰ã€‚ Application.mkå®šä¹‰äº†Androidåº”ç”¨ç¨‹åºç›¸å…³çš„å±æ€§ï¼Œå¦‚Android SDKç‰ˆæœ¬ã€è°ƒè¯•æˆ–å‘å¸ƒæ¨¡å¼ã€ç›®æ ‡å¹³å°ABI(æ¶æ„äºŒè¿›åˆ¶æ¥å£)ã€æ ‡å‡†c/c++åº“ç­‰ã€‚ ä¸€ä¸ªå…¸å‹çš„Android.mk 12345LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE := &lt;module_name&gt; # å‘½åä½ çš„æ¨¡å—.LOCAL_SRC_FILES := main.cinclude $(BUILD_SHARED_LIBRARY) æœ€å°Application.mk 1APP_ABI := all ä¸ºäº†æ„å»ºè¿™æ ·çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®project_rootï¼Œå¹¶è¾“å…¥ndk-build(å‡è®¾æ‚¨åœ¨ç³»ç»ŸPATHä¸­æœ‰NDK_ROOT)ï¼ŒNDKæ„å»ºè„šæœ¬å°†è‡ªåŠ¨æ‰¾åˆ°jniæ–‡ä»¶å¤¹ä¸‹çš„æœ¬åœ°ä»£ç ã€‚ 12$ cd project_root$ ndk-build å¦‚æœä»£ç ä¸­æ²¡æœ‰bugï¼Œé‚£ä¹ˆç¼–è¯‘åçš„å…±äº«åº“lib&lt;module_name&gt;.soå°†ä¼šåœ¨libs/&lt;abi&gt;/ ç›®å½•ä¸‹ç”Ÿæˆã€‚ä¸€æ—¦ä½ å¾—åˆ°äº†è¿™ä¸ªå…±äº«åº“æ–‡ä»¶ï¼Œä½ çš„Androidåº”ç”¨ç¨‹åºæ„å»ºç³»ç»Ÿå°†æŠŠå®ƒæ‰“åŒ…åˆ°æœ€ç»ˆçš„APKå®‰è£…æ–‡ä»¶ä¸­ã€‚æ‚¨å°†èƒ½å¤Ÿåœ¨JAVAä»£ç ä¸­ä½¿ç”¨JNIè°ƒç”¨æœ¬åœ°å‡½æ•°ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ›´å¤šåœ°å…³æ³¨å¦‚ä½•ä½¿ç”¨NDKæ„å»ºå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬å°†æ›´å®¹æ˜“ä»¥è¿™ç§æ–¹å¼æµ‹è¯•æˆ‘ä»¬çš„ç»“æœã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œè¿™é‡Œæ‰€è®¨è®ºçš„æ‰€æœ‰æŠ€æœ¯éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥åº”ç”¨åˆ°å…±äº«åº“é¡¹ç›®ä¸­ï¼Œè€Œä¸éœ€è¦ä»»ä½•æ›´æ”¹ã€‚ ä½¿ç”¨NDKæ„å»ºæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶è®©æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªâ€œHello Worldï¼â€â€æµ‹è¯•ã€‚é¡¹ç›®ç»“æ„å°†æ˜¯è¿™æ ·çš„: structure12345+-- ex1_helloworld| +-- jni| +-- Android.mk| +-- Application.mk| +-- hello.c Hello.cpp 1234567#include &lt;iostream&gt;int main()&#123; std::cout &lt;&lt; \"Hello World!\" &lt;&lt; std::endl; return 0;&#125; Android.mk è¯·æ³¨æ„ï¼Œåœ¨.mkæ–‡ä»¶æ³¨é‡Šä»¥â€œ#â€å¼€å¤´ã€‚ 123456LOCAL_PATH:= $(call my-dir) # è·å–é¡¹ç›®çš„æœ¬åœ°è·¯å¾„.include $(CLEAR_VARS) # ç”¨å‰ç¼€\"LOCAL_\"æ¸…é™¤æ‰€æœ‰å˜é‡LOCAL_SRC_FILES:=hello.cpp # åŒ…å«æºä»£ç .LOCAL_MODULE:= hello # äºŒè¿›åˆ¶çš„åç§°.include $(BUILD_EXECUTABLE) # å‘Šè¯‰ndk-buildï¼Œæˆ‘ä»¬æƒ³è¦æ„å»ºä¸€ä¸ªæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶. _ Application.mk_ 12345APP_OPTIM := debug # åœ¨è°ƒè¯•æ¨¡å¼ä¸‹æ„å»ºç›®æ ‡.APP_ABI := armeabi-v7a # å°†ç›®æ ‡æ¶æ„å®šä¹‰ä¸ºARM.APP_STL := stlport_static # æˆ‘ä»¬ä½¿ç”¨stlportä½œä¸ºæ ‡å‡†çš„c/c++åº“.APP_CPPFLAGS := -frtti -fexceptions # è¿™æ˜¯ä½ å¯ç”¨å¼‚å¸¸çš„åœ°æ–¹.APP_PLATFORM := android-19 # å®šä¹‰æœ¬åœ°åº”ç”¨ç¨‹åºçš„Androidç‰ˆæœ¬. æ‚¨å¯èƒ½å·²ç»å‘ç°ï¼Œå…±äº«åº“é¡¹ç›®å’Œæœ¬åœ°é¡¹ç›®ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ä»…ä»…æ˜¯Android.mkä¸­çš„ä¸€è¡Œã€‚ å¯¹äºä¸€ä¸ªå…±äº«çš„åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨: 1include $(BUILD_SHARED_LIBRARY) å¯¹äºå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨:1include $(BUILD_EXECUTABLE) åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæˆ‘ä»¬çš„â€œHello Worldï¼â€NDKé¡¹ç›®: 123456$ cd project_root$ ndk-build[armeabi-v7a] Cygwin : Generating dependency file converter script[armeabi-v7a] Compile++ thumb: hello &lt;= hello.cpp[armeabi-v7a] Executable : hello[armeabi-v7a] Install : hello =&gt; libs/armeabi-v7a/hello ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†helloæœ¬æœºç¨‹åºæ¨åˆ°Androidè®¾å¤‡ä¸Šè¿è¡Œå®ƒ(ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦Android ADBå·¥å…·ã€‚è¯·å®‰è£…Android SDKï¼Œå¹¶å°†ANDROID_SDK_ROOT/platform-toolsè®¾ç½®ä¸ºç³»ç»ŸPATHã€‚å½“ç„¶ï¼Œå¦‚æœæ‚¨ä¸æƒ³è´¹å¿ƒå®‰è£…Android SDKï¼Œä¹Ÿå¯ä»¥ä»ç½‘ä¸Šæ‰¾åˆ°ADBå®‰è£…åŒ…ã€‚) 12345$ adb root$ adb shell \"mkdir -p /data/mastering_ndk &amp;&amp; chmod 777 /data/mastering_ndk\"$ adb push ./libs/armeabi-v7a/hello /data/mastering_ndk$ adb shell \"cd /data/mastering_ndk &amp;&amp; chmod 777 ./hello &amp;&amp; ./hello\"$ Hello World! æç¤º:ä¸Šé¢çš„å‘½ä»¤åªé€‚ç”¨äºRootè®¾å¤‡ã€‚å¦‚æœä½ æ²¡æœ‰rootæƒé™è®¾å¤‡ï¼Œä½ å¯ä»¥ä½¿ç”¨AndroidåŸç”Ÿç¨‹åºå¯åŠ¨å·¥å…·åœ¨ä»»ä½•Androidè®¾å¤‡ä¸Šå¯åŠ¨æœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ æˆ‘ä»¬å·²ç»å›å¿†äº†ndk-buildçš„åŸºæœ¬çŸ¥è¯†ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºä¸€äº›æŠ€æœ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°åˆ©ç”¨NDKæ„å»ºç³»ç»Ÿæ¥å®Œæˆä¸€äº›æ›´å¤§çš„é¡¹ç›®ã€‚ æœ‰ç”¨çš„æŠ€æœ¯å¦‚ä½•åœ¨jniç›®å½•ä¸­ç¼–è¯‘æºä»£ç å‡è®¾æ‚¨æœ‰ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„é¡¹ç›®ï¼Œå› æ­¤å¾ˆå¯èƒ½æ‚¨æ— æ³•è½»æ¾åœ°å°†æ‰€æœ‰æºä»£ç ç§»åŠ¨åˆ°jniæ–‡ä»¶å¤¹ä¸‹ã€‚å®é™…ä¸Šéœ€è¦å¯¹ç°æœ‰çš„Android.mk makefileè¿›è¡Œäº†ä¸€äº›å°çš„ä¿®æ”¹ã€‚ä¸‹é¢çš„ä¾‹å­å°†å±•ç¤ºå¦‚ä½•å®ç°è¿™ä¸€ç‚¹ã€‚æ‚¨å¯ä»¥åœ¨ç¤ºä¾‹2ä¸­æ‰¾åˆ°å®Œæ•´çš„é¡¹ç›®:ex2_src_not_in_jni_folderã€‚ é¡¹ç›®ç»“æ„: structure123456+-- ex2_src_not_in_jni_folder| +-- jni| +-- Android.mk| +-- Application.mk| +-- src| +-- hello.c Android.mk 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_SRC_FILES:= ../src/hello.cppLOCAL_MODULE:= helloinclude $(BUILD_EXECUTABLE) Application.mkæ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬å¯ä»¥æ„å»ºé¡¹ç›®å¹¶ä½¿ç”¨ä¸ç¤ºä¾‹1ç›¸åŒçš„æ–¹å¼æ¥æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å»æ‰jniæ–‡ä»¶å¤¹jniæ–‡ä»¶å¤¹å¯¹äºAndroidåº”ç”¨ç¨‹åºé¡¹ç›®ä¸­çš„jniæœ¬æœºé¡¹ç›®æ›´æœ‰æ„ä¹‰ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹æˆ‘ä»¬çš„é¡¹ç›®æœ‰æ›´æœ‰æ„ä¹‰çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥å»æ‰é»˜è®¤çš„ndk-buildæ‰€ä½¿ç”¨çš„é‚£ä¸ªç‰¹å®šæ–‡ä»¶å¤¹ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦é€‚å½“åœ°è®¾ç½®makefileä¸­çš„å‡ ä¸ªå˜é‡ã€‚ä»¥ä¸‹æ­¥éª¤å°†å®ç°è¿™ä¸€ç›®æ ‡ã€‚å®Œæ•´çš„ç¤ºä¾‹é¡¹ç›®å¯ä»¥åœ¨ç¤ºä¾‹3ä¸­æ‰¾åˆ°ã€‚ é¡¹ç›®ç»“æ„: structure12345+-- ex3_get_rid_of_jni_folder| +-- Android.mk| +-- Application.mk| +-- src| +-- hello.c å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬åˆ é™¤äº†jniæ–‡ä»¶å¤¹ï¼Œå¹¶å°†Android.mkå’ŒApplication.mkç§»åˆ°project_rootæ–‡ä»¶å¤¹ä¸­ã€‚ æ–°çš„Android.mk 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_SRC_FILES:= src/hello.cpp # è¿™æ”¹å˜äº†!LOCAL_MODULE:= helloinclude $(BUILD_EXECUTABLE) æ–°çš„ Application.mk 123456APP_OPTIM := debugAPP_ABI := armeabi-v7aAPP_STL := stlport_staticAPP_CPPFLAGS := -frtti -fexceptionsAPP_PLATFORM := android-19APP_BUILD_SCRIPT := Android.mk # è¿™è¡Œæ˜¯æ–°çš„! è¯·æ³¨æ„ï¼ŒAPP_BUILD_SCRIPTæŒ‡ç¤ºæ•´ä¸ªåº”ç”¨ç¨‹åºçš„ä¸»è¦makefileæ¡ç›®ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯Android.mkã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆå¥½ï¼Œç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ„å»ºé¡¹ç›®ï¼Œè¯·æ³¨æ„æˆ‘ä»¬åœ¨ndk-buildå‘½ä»¤ä¸­æ·»åŠ äº†NDK_APPLICATION_MKå˜é‡ï¼Œå‘Šè¯‰ndk-buildåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°Application.mkã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤: 1$ ndk-build NDK_APPLICATION_MK=./Application.mk ç„¶è€Œï¼Œæˆ‘ä»¬å°†ä¼šæœ‰ä»¥ä¸‹é”™è¯¯: 1234$ ndk-build NDK_APPLICATION_MK=./Application.mkAndroid NDK: Could not find application project directory !Android NDK: Please define the NDK_PROJECT_PATH variable to point to it./cygdrive/d/development/android-ndk-r10d/build/core/build-local.mk:148: *** Android NDK: Aborting . Stop. NDK_PROJECT_PATHæ˜¯ä¸€ä¸ªç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚è®©æˆ‘ä»¬å°†å®ƒå®šä¹‰åˆ°Application.mkæ‰€åœ¨çš„ä½ç½®å¹¶é‡æ–°æ„å»ºã€‚ 123456$ export NDK_PROJECT_PATH=.$ ndk-build NDK_APPLICATION_MK=./Application.mk[armeabi-v7a] Cygwin : Generating dependency file converter script[armeabi-v7a] Compile++ thumb: hello &lt;= hello.cpp[armeabi-v7a] Executable : hello[armeabi-v7a] Install : hello =&gt; libs/armeabi-v7a/hello è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥ä¿®å¤ä¸Šé¢çš„æ„å»ºé”™è¯¯ã€‚è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸Application.mkç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªç©ºçš„AndroidManifest.xmlæ–‡ä»¶ åœ¨æ·»åŠ è¿™ä¸ªè™šæ‹Ÿçš„AndroidManifest.xmlæ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å®šä¹‰NDK_PROJECT_PATHå˜é‡çš„æƒ…å†µä¸‹æ„å»ºé¡¹ç›®ã€‚æœ€ç»ˆçš„é¡¹ç›®ç»“æ„æ˜¯: structure123456+-- ex3_get_rid_of_jni_folder| +-- Android.mk| +-- AndroidManifest.xml| +-- Application.mk| +-- src| +-- hello.c ä¸ºmakefileä½¿ç”¨è‡ªå®šä¹‰åç§°æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ¨è¿›å‰é¢çš„æŠ€æœ¯æ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„makefileã€‚ä¸‹é¢çš„ä¾‹å­å¯ä»¥åœ¨ç¤ºä¾‹4ä¸­æ‰¾åˆ°ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºmakefileé‡å‘½åä¸ºMyApplication.mkï¼Œå¹¶å°†æ¨¡å—makefileæ–‡ä»¶é‡å‘½åä¸ºMyAndroid.mkã€‚ é¡¹ç›®ç»“æ„: structure123456+-- ex4_custom_make_files| +-- MyAndroid.mk| +-- AndroidManifest.xml| +-- MyApplication.mk| +-- src| +-- hello.c MyAndroid.mkå’Œä¹‹å‰çš„Android.mkæ˜¯ä¸€æ ·çš„ã€‚ æ–°MyApplication.mk 123456APP_OPTIM := debugAPP_ABI := armeabi-v7aAPP_STL := stlport_staticAPP_CPPFLAGS := -frtti -fexceptionsAPP_PLATFORM := android-19APP_BUILD_SCRIPT := MyAndroid.mk æ„å»ºå‘½ä»¤å°±å˜æˆ: 1234$ ndk-build NDK_APPLICATION_MK=./MyApplication.mk[armeabi-v7a] Compile++ thumb: hello &lt;= hello.cpp[armeabi-v7a] Executable : hello[armeabi-v7a] Install : hello =&gt; libs/armeabi-v7a/hello ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å¾—åˆ°äº†äºŒè¿›åˆ¶çš„helloã€‚ ä½¿ç”¨includeåµŒå…¥.mkæ–‡ä»¶ä¸ºäº†æ›´å¥½åœ°å¤„ç†åŒ…å«å¤šä¸ªå­æ¨¡å—çš„å¤§å‹é¡¹ç›®ï¼Œä»¥é™æ€åº“ã€å…±äº«åº“æˆ–é¢„æ„å»ºæ–‡ä»¶çš„å½¢å¼ï¼ŒNDKæ„å»ºç³»ç»Ÿå…è®¸makefileåŒ…å«å¦ä¸€ä¸ªmakefileã€‚ä¸‹é¢æ˜¯è¯­æ³•: 1include PATH_TO_MK_FILE/Android.mk è¿™å°†åŒ…æ‹¬åœ¨PATH_TO_MK_FILEç›®å½•ä¸‹çš„Android.mkæ–‡ä»¶åˆ°å½“å‰makefileã€‚è¿™ä¸ªâ€œincludeâ€ç‰¹æ€§ä¸ºæˆ‘ä»¬æä¾›äº†å·¨å¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥åˆ›å»ºä¸€äº›éå¸¸æœ‰åˆ›æ„çš„æ–¹å¼æ¥åˆ©ç”¨å»ºç­‘ç³»ç»Ÿã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­(ç¤ºä¾‹5)ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹åŒ…å«ä¸€ä¸ªéå¸¸ç®€å•çš„makefileã€‚æœ‰äº†â€œincludeâ€çš„å¼ºå¤§åŠŸèƒ½ï¼Œæˆ‘ç›¸ä¿¡æ‚¨å¯ä»¥åˆ›å»ºæ›´åŠ å¤æ‚çš„æ„å»ºè„šæœ¬ï¼Œæ— è®ºé¡¹ç›®å¤šä¹ˆå¤æ‚ï¼Œå®ƒå‡ ä¹å¯ä»¥ä¸ºä»»ä½•é¡¹ç›®åšä»»ä½•äº‹æƒ…ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åœ¨æºæ–‡ä»¶compute.cppä¸­æœ‰ä¸€ä¸ªmain()å‡½æ•°ï¼Œå®ƒè°ƒç”¨add()å’Œmul()å‡½æ•°æ¥æ‰§è¡Œè¾“å…¥å·ä¸Šçš„æ·»åŠ å’Œä¹˜æ³•ã€‚æˆ‘ä»¬åœ¨ä¸¤ä¸ªå­æ¨¡å—ä¸­å®šä¹‰add()å’Œmul()å‡½æ•°ï¼Œå¹¶å°†å®ƒä»¬ç¼–è¯‘æˆä¸¤ä¸ªé™æ€åº“ã€‚æœ€åï¼Œå½“æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œé“¾æ¥å™¨å°†æŠŠæ‰€æœ‰å†…å®¹é“¾æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å› æ­¤ï¼Œä¸ºäº†æ›´å¥½åœ°å¤„ç†å­æ¨¡å—ï¼Œå¹¶å°†æ¯ä¸ªå­æ¨¡å—åˆ†å¼€ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªAndroid.mkã€‚æ­£å¦‚æ‚¨å°†å¾ˆå¿«çœ‹åˆ°çš„ï¼Œé€šè¿‡ä»¥è¿™ç§æ–¹å¼ç»„ç»‡makefileï¼Œé¡¹ç›®ç°åœ¨æœ‰äº†ä¸€ä¸ªéå¸¸å¯ä¼¸ç¼©çš„ç»“æ„ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå¦‚æœæ‚¨æƒ³è¦åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªå­å°éƒ¨ä»¶ï¼Œæ‚¨åªéœ€æ·»åŠ å¦ä¸€ä¸ªå­æ¨¡å—æ–‡ä»¶å¤¹(ä¸ç®¡å®ƒæ˜¯ä»€ä¹ˆï¼Œæ¯”æ–¹è¯´ï¼Œdivide)ï¼Œç„¶åä¸ºæ–°çš„å­æ¨¡å—â€œdivideâ€åˆ›å»ºä¸€ä¸ªæ–°çš„Android.mkã€‚ç„¶åï¼Œæ‚¨åªéœ€è¦åœ¨ä¸»æ¨¡å—çš„makefileä¸­æ›´æ”¹ä¸€è¡Œã€‚æ‰€æœ‰ç°æœ‰çš„å­æ¨¡å—éƒ½ä¿æŒä¸å˜ã€‚è¿™ä¸ªé¡¹ç›®å¾ˆå®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ï¼Œä»¥æ”¯æŒæ›´å¤šçš„åŠŸèƒ½ã€‚ é¡¶å±‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼Œå¹¶æœ‰ä¸€ä¸ªæ•´ä½“çš„å›¾æ™¯: structure1234567891011121314151617+-- ex5_using_include_to_embed_make_files| +-- makefiles| +-- Android.mk| +-- Application.mk| +-- src| +-- main| +-- compute.cpp| +-- Android.mk| +-- submodules| +-- add| +-- add.cpp| +-- Android.mk| +-- mul| +-- mul.cpp| +-- Android.mk | +-- Android.mk | +-- AndroidManifest.xml makefiles/Application.mk 123456APP_OPTIM := debugAPP_ABI := armeabi-v7aAPP_STL := stlport_staticAPP_CPPFLAGS := -frtti -fexceptionsAPP_PLATFORM := android-19APP_BUILD_SCRIPT := makefiles/Android.mk makefiles/Android.mk 12345TOP_LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)include $(TOP_LOCAL_PATH)/../src/submodules/Android.mkinclude $(TOP_LOCAL_PATH)/../src/main/Android.mk åœ¨è¿™é‡Œï¼Œè¿™ä¸ªAndroid.mkä½œä¸ºé¡¶çº§makefileï¼ŒåŒ…å«å¦å¤–ä¸¤ä¸ªAndroid.mkï¼Œä¸€ä¸ªç”¨äºå­æ¨¡å—ï¼Œå¦ä¸€ä¸ªç”¨äºä¸»æ¨¡å—ã€‚ ä¸»è¦æ¨¡å—: computeæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ä¸»æ¨¡å—ã€‚ src/main/`compute.cpp` 12345678910111213141516#include &lt;iostream&gt;int add(int a, int b);int mul(int a, int b);int main()&#123; int a = 2; int b = 3; std::cout &lt;&lt; \"a = \" &lt;&lt; a &lt;&lt; std::endl; std::cout &lt;&lt; \"b = \" &lt;&lt; b &lt;&lt; std::endl; std::cout &lt;&lt; \"add(a, b) = \" &lt;&lt; add(a, b) &lt;&lt; std::endl; std::cout &lt;&lt; \"mul(a, b) = \" &lt;&lt; mul(a, b) &lt;&lt; std::endl; return 0;&#125; src/main/`Android.mk` 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_SRC_FILES:= compute.cppLOCAL_MODULE:= computeLOCAL_STATIC_LIBRARIES:= add mulinclude $(BUILD_EXECUTABLE) æˆ‘ä»¬é€šè¿‡å®šä¹‰$include $(BUILD_EXECUTABLE)æ¥æ„å»ºä¸»æ¨¡å—ä½œä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†LOCAL_STATIC_LIBRARIES add mulï¼Œè¿™æ„å‘³ç€è¿™ä¸ªä¸»æ¨¡å—ä¾èµ–äºä¸¤ä¸ªé™æ€åº“ï¼Œåˆ†åˆ«ä½¿ç”¨æ¨¡å—åaddå’Œmulã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªæ¨¡å—çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹å­æ¨¡å—ã€‚ å­æ¨¡å—ï¼šaddå’Œmulsrc/submodules/`Android.mk` 1include $(call all-subdir-makefiles) è¿™é‡Œï¼Œåœ¨submodulesæ–‡ä»¶å¤¹ä¸­ï¼ŒmakefileåªåŒ…å«ä¸€è¡Œï¼Œå®ƒåœ¨NDKæ„å»ºç³»ç»Ÿä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‘½ä»¤åŒ…æ‹¬include $(call all-subdir-makefiles)ï¼ŒåŸºæœ¬ä¸Šç­‰åŒäºå°†æ‰€æœ‰çš„Android.mkæ–‡ä»¶æ‰‹åŠ¨åœ°åŒ…å«åœ¨æ‰€æœ‰å­ç›®å½•ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­,è¿™å°†å¸®åŠ©æˆ‘ä»¬åŒ…æ‹¬src/submodules/add/Android.mkå’Œsrc/submodules/mul/Android.mkã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å­æ¨¡å—addã€‚ src/submodules/add/`add.cpp` 1234int add(int a, int b)&#123; return a + b;&#125; src/submodules/add/`Android.mk` 12345LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_SRC_FILES:= ./add.cppLOCAL_MODULE:= addinclude $(BUILD_STATIC_LIBRARY) æˆ‘ä»¬å°†æ¨¡å—addå®šä¹‰ä¸ºä¸€ä¸ªé™æ€åº“ã€‚ ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬è¿˜æœ‰å­æ¨¡å—mulï¼Œå®ƒå‡ ä¹æ‹¥æœ‰ä¸addæ¨¡å—ç›¸åŒçš„makefileã€‚ src/submodules/mul/`mul.cpp` 1234int mul(int a, int b)&#123; return a * b;&#125; src/submodules/mul/`Android.mk` 12345LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_SRC_FILES:= ./mul.cppLOCAL_MODULE:= mulinclude $(BUILD_STATIC_LIBRARY) åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åˆ—å‡ºäº†é¡¹ç›®ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚æ„å»ºæµç¨‹æ¸…æ™°åœ°æ˜¾ç¤ºå¦‚ä¸‹: ä½¿ç”¨add.cppæ„å»ºé™æ€åº“add; ä½¿ç”¨mul.cppæ„å»ºé™æ€åº“mul; ä½¿ç”¨compute.cppæ„å»ºä¸»æ¨¡å—compute; å°†computeé“¾æ¥åˆ°é™æ€åº“libadd.aå’Œlibmul.aã€‚ç”Ÿæˆå¯æ‰§è¡Œçš„computeã€‚ æ„å»ºå’Œæ‰§è¡Œæˆ‘ä»¬ä½¿ç”¨å‰é¢ç¤ºä¾‹ä¸­çš„ç›¸åŒå‘½ä»¤æ¥æ„å»ºé¡¹ç›®ã€‚ 123456789$ ndk-build NDK_APPLICATION_MK=./makefiles/Application.mk[armeabi-v7a] Cygwin : Generating dependency file converter script[armeabi-v7a] Compile++ thumb: compute &lt;= compute.cpp[armeabi-v7a] Compile++ thumb: add &lt;= add.cpp[armeabi-v7a] StaticLibrary : libadd.a[armeabi-v7a] Compile++ thumb: mul &lt;= mul.cpp[armeabi-v7a] StaticLibrary : libmul.a[armeabi-v7a] Executable : compute[armeabi-v7a] Install : compute =&gt; libs/armeabi-v7a/compute æˆ‘ä»¬æ‰§è¡Œçš„äºŒè¿›åˆ¶ã€‚ 1234567$ adb shell \"mkdir -p /data/mastering_ndk &amp;&amp; chmod 777 /data/mastering_ndk\"$ adb push ./libs/armeabi-v7a/compute /data/mastering_ndk$ adb shell \"cd /data/mastering_ndk &amp;&amp; chmod 777 ./compute &amp;&amp; ./compute\"a = 2b = 3add(a, b) = 5mul(a, b) = 6 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœæ­£æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚æ˜¾ç„¶ï¼Œé€šè¿‡ä½¿ç”¨â€œincludeâ€ï¼Œé¡¹ç›®å˜å¾—æ›´åŠ ç»“æ„åŒ–ã€‚æ‰€æœ‰çš„æ¨¡å—éƒ½æ˜¯å•ç‹¬æ„å»ºçš„ï¼Œä½†æ˜¯æœ‰èƒ½åŠ›åœ¨makefileä¸­å…±äº«å˜é‡ã€‚å¯ä»¥æƒ³è±¡ï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå¿…é¡»æœ‰æ›´å¤šçš„è®¾ç½®ï¼Œæ¯”å¦‚LOCAL_C_INCLUDES, LOCAL_CFLAGS, LOCAL_LDFLAGS, LOCAL_LDLIBSç­‰ç­‰ã€‚è®¸å¤šå­å°ç®¡åœ¨è¿™äº›è®¾ç½®ä¸­å¯èƒ½å…·æœ‰ç›¸åŒçš„å€¼ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æå–å…¬å…±éƒ¨åˆ†å¹¶å°†å¸¸è§çš„éƒ¨åˆ†æ”¾å…¥ä¸€ä¸ªæ™®é€šmakefileä¸­ï¼Œç„¶åå°†å…¶åŒ…å«åˆ°æ¯ä¸ªå­æ¨¡å—çš„makefileä¸­ã€‚è¿™æ ·åšå¯ä»¥èŠ‚çœå¤§é‡çš„ç¼–ç å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥ä½¿makefileæ›´å®¹æ˜“ä¿®æ”¹å’Œç»´æŠ¤ã€‚åœ¨æ·»åŠ æ–°çš„å­æ¨¡å—æ—¶ï¼Œç¼–å†™æ–°çš„makefileçš„å·¥ä½œé‡å°†æ˜¯æœ€å°çš„ã€‚ å…³äºLOCAL_PATHå’ŒCLEAR_VARSä»¥ä¸‹ä¸¤ä¸ªNDKå†…ç½®å‡½æ•°éå¸¸é‡è¦: 12LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS) ç¬¬ä¸€ä¸ª(LOCAL_PATH:= $(call my-dir))æ£€ç´¢Android.mkæ–‡ä»¶çš„å½“å‰æœ¬åœ°è·¯å¾„ï¼Œä»¥ä¾¿åŒä¸€æ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜é‡éƒ½å¯ä»¥æ ¹æ®æœ¬åœ°è·¯å¾„ç”Ÿæˆç»å¯¹è·¯å¾„ã€‚å‘½ä»¤include $(CLEAR_VARS)æ¸…é™¤äº†ä»¥LOCAL_å¼€å¤´çš„æ‰€æœ‰NDKå†…ç½®å˜é‡ï¼Œå¦‚LOCAL_SRC_FILES, LOCAL_C_INCLUDES, LOCAL_CFLAGS, LOCAL_LDFLAGS, LOCAL_LDLIBSç­‰ï¼Œé™¤äº†LOCAL_PATHã€‚ å½“ä½ åœ¨è¿™ä¸ªé¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªAndroid.mkæ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½å°±éå¸¸å¥½äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨â€œincludeâ€æ¥å°†å¤šä¸ªmakefileæ”¾åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦æ³¨æ„ä¸Šé¢çš„ä¸¤ä¸ªå‘½ä»¤ã€‚ åŸå› æ˜¯LOCAL_PATHå˜é‡å¯ä»¥è¢«éšåçš„å‘½ä»¤è°ƒç”¨LOCAL_PATH:= $(call my-dir)è¦†ç›–ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹: 12345LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)include subfolder/Android.mkLOCAL_SRC_FILES:= $(LOCAL_PATH)/test.cpp ä¸Šè¿°makefileçš„é—®é¢˜åœ¨äºï¼Œåœ¨â€œincludeâ€ä¹‹åï¼Œåœ¨subfolder/Android.mkä¸­ï¼ŒLOCAL_PATHå¯èƒ½ä¼šè¢«åŒ…å«çš„Android.mkä¿®æ”¹ã€‚ç„¶åï¼Œå½“æ‚¨è¯•å›¾å®šä½test.cppï¼Œndk-buildå°†ä¼šå¤±è´¥ï¼Œå› ä¸ºç°åœ¨æ–‡ä»¶çš„è·¯å¾„æ˜¯é”™è¯¯çš„ã€‚ å¦‚æœæ‚¨å¯¹ç¤ºä¾‹5è¿›è¡Œäº†è¶³å¤Ÿçš„å…³æ³¨ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªå°æŠ€å·§å·²ç»åœ¨é‚£é‡Œä½¿ç”¨äº†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹5çš„é¡¶çº§makefileã€‚ ex5_using_include_to_embed_make_files/makefiles/`Android.mk` 12345TOP_LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)include $(TOP_LOCAL_PATH)/../src/submodules/Android.mkinclude $(TOP_LOCAL_PATH)/../src/main/Android.mk ä¸ºäº†é¿å…ä½¿ç”¨é”™è¯¯çš„LOCAL_PATHï¼Œæˆ‘å®šä¹‰äº†TOP_LOCAL_PATHï¼Œä»¥ä¿è¯è¿™ä¸¤ç§æ–¹æ³•åŒ…æ‹¬ä½¿ç”¨ç›¸åŒçš„æœ¬åœ°è·¯å¾„ã€‚ æœ‰äº›äººä½¿ç”¨äº†å¦ä¸€ä¸ªæŠ€å·§ï¼Œåœ¨include Android.mkä¸­ï¼Œç¬¬ä¸€ä»¶äº‹æ˜¯å°†LOCAL_PATHå˜é‡å¤‡ä»½åˆ°ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œåœ¨é€€å‡ºä¹‹å‰ï¼Œæ¢å¤LOCAL_PATHã€‚ä¾‹å¦‚: 12345LOCAL_PATH_BACK_UP := $(LOCAL_PATH)LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)...LOCAL_PATH:=$(LOCAL_PATH_BACK_UP ) ç±»ä¼¼åœ°ï¼Œå¦‚æœæ‚¨çš„æ¨¡å—å…±äº«ä¸€äº›å…¬å…±è®¾ç½®ï¼Œè¯·å°å¿ƒä½¿ç”¨include $(CLEAR_VARS)ï¼Œåªæœ‰å½“æ‚¨çŸ¥é“å®ƒæ˜¯å®‰å…¨ä¸”å¿…éœ€çš„æ—¶æ‰ä½¿ç”¨å®ƒã€‚ å¦‚ä½•è°ƒè¯•.mk makefileå¯¹äºä¸€ä¸ªå°é¡¹ç›®ï¼Œåœ¨makefileä¸­æŸ¥æ‰¾é—®é¢˜å¯èƒ½æ›´å®¹æ˜“ã€‚ç„¶è€Œï¼Œéšç€æ‚¨çš„é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œå°¤å…¶æ˜¯å½“æ‚¨åŒ…å«äº†å¤šä¸ªæ¨¡å—ï¼ŒåŒ…æ‹¬å…±äº«åº“ã€é™æ€åº“å’Œå¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œæƒ…å†µå˜å¾—æ›´åŠ å¤æ‚ã€‚æ‚¨å¯èƒ½ä¼šé‡åˆ°è¯¸å¦‚â€œæ— æ³•æ‰¾åˆ°æ„å»ºfooçš„è§„åˆ™â€æˆ–â€œä¸èƒ½é“¾æ¥åº“barâ€ä¹‹ç±»çš„é—®é¢˜ã€‚æœ‰æ—¶ï¼Œè¿™å¯èƒ½åªæ˜¯ç”±äºæŸä¸ªè§’è½å‡ºç°äº†æ‰“å°é”™è¯¯ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´æ‚¨èŠ±ä¸Šå‡ ä¸ªå°æ—¶æ¥æŸ¥æ‰¾ï¼Œå› ä¸ºndk-buildæä¾›çš„ä¿¡æ¯ç¡®å®éå¸¸æœ‰é™ï¼Œè€Œä¸”å¸¸å¸¸æ˜¯ä¸å¤Ÿçš„ã€‚ å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›éå¸¸æœ‰ç”¨çš„å·¥å…·: 123$(error error message)$(warning warning message)$(info information message) è¿™äº›å‘½ä»¤å¯ä»¥æ’å…¥åˆ°æ‚¨çš„Android.mkæˆ–Application.mkã€‚ è¿™ä¸‰ä¸ªå‘½ä»¤ä¹‹é—´æœ‰ä¸€äº›å·®å¼‚ã€‚ $(info)å‘½ä»¤ç®€å•åœ°æ‰“å°å‡ºä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚åœ¨cä¸­çš„printf()ã€‚ $(warning)å‘½ä»¤ä¸ä»…æ‰“å°ä¿¡æ¯ï¼Œè¿˜æ’å…¥è¡Œå·ï¼ŒæŒ‡ç¤ºå‘å‡ºè­¦å‘Šçš„ä½ç½®ã€‚ $(error)å‘½ä»¤å°†æ‰“å°ä¿¡æ¯ï¼Œå¹¶åœæ­¢åç»­çš„æ„å»ºè¿‡ç¨‹ã€‚ é€šå¸¸ï¼Œ$(info)è¶³ä»¥æ˜¾ç¤ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ£€æŸ¥å½“å‰LOCAL_PATHå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ: 1$(info LOCAL_PATH=$(LOCAL_PATH)) æˆ–è€…ï¼Œå¦‚æœæˆ‘ä»¬åœ¨androidmkæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ£€æŸ¥å®ƒçš„å€¼: 123BUILD_MODE:=NATIVE_MODEDEVICE_NAME:=NEXUS-5$(info BUILD_MODE is $(BUILD_MODE) for device $(BUILD_MODE)) å¦ä¸€ç§æ–¹æ³•å¦ä¸€ç§å¸®åŠ©è°ƒè¯•makefileçš„æœ‰ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨ndk-buildçš„V=1é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹5ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ndk-build V=1ï¼Œä»¥ä¸‹å°±æ˜¯æˆ‘ä»¬å°†çœ‹åˆ°çš„: 1234567$ ndk-build NDK_APPLICATION_MK=./MyApplication.mk V=1[Robert: Here I have skipped some print information...][armeabi-v7a] Executable : hello/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-g++ -Wl,--gc-sections -Wl,-z,nocopyreloc --sysroot=D:/development/android-ndk-r10d/platforms/android-19/arch-arm -Wl,-rpath-link=D:/development/android-ndk-r10d/platforms/android-19/arch-arm/usr/lib -Wl,-rpath-link=./obj/local/armeabi-v7a ./obj/local/armeabi-v7a/objs-debug/hello/src/hello.o D:/development/android-ndk-r10d/sources/cxx-stl/stlport/libs/armeabi-v7a/thumb/libstlport_static.a -lgcc -no-canonical-prefixes -march=armv7-a -Wl,--fix-cortex-a8 -Wl,--no-undefined -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -fPIE -pie -lc -lm -o ./obj/local/armeabi-v7a/hello[armeabi-v7a] Install : hello =&gt; libs/armeabi-v7a/helloinstall -p ./obj/local/armeabi-v7a/hello ./libs/armeabi-v7a/hello/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-strip --strip-unneeded ./libs/armeabi-v7a/hello æœ€æœ‰ç”¨çš„éƒ¨åˆ†æ˜¯ç›´æ¥èµ·åŠ¨/cygdrive/d/development/android-ndk-r10d/toolchains/arm-linux-androideabi-4.8/prebuilt/windows-x86_64/bin/arm-linux-androideabi-g++ã€‚è¿™åŸºæœ¬ä¸Šæ˜¾ç¤ºäº†ç”¨äºæ„å»ºç›®æ ‡è¾“å‡ºçš„å‘½ä»¤è¡Œã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ‰€æœ‰çš„ç¼–è¯‘å’Œé“¾æ¥ä¿¡æ¯ã€‚å¯¹äºä¸€ä¸ªå¤æ‚çš„é¡¹ç›®ï¼Œå°¤å…¶æ˜¯å¸¦æœ‰åµŒå…¥å¼makefileçš„é¡¹ç›®ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬æ£€æŸ¥åº“çš„è·¯å¾„ã€å¤´æ–‡ä»¶çš„è·¯å¾„å’Œé¡¹ç›®ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®è®¾ç½®ã€‚ é’ˆå¯¹å¤šä¸ªç›®æ ‡ä½“ç³»ç»“æ„çš„æ„å»ºæœ€åï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸ºå¤šä¸ªç›®æ ‡ABIs(AABI=Architecture Binary Interface)æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚å½“æ‚¨æƒ³è¦ä¸ºå¤šä¸ªå¹³å°å‘å¸ƒæ‚¨çš„æœ¬åœ°ç¨‹åºæ—¶ï¼Œè¿™å°†éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚arm v5ã€arm v7ã€x86ç­‰ç­‰ã€‚åœ¨ä¸ºAndroidåº”ç”¨ç¨‹åºæ„å»ºåŸç”ŸJNIå…±äº«åº“æ—¶ï¼Œè¿™å°†éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦è®¤çœŸè€ƒè™‘å¦‚ä½•å‘å¸ƒå’Œå‘å¸ƒæœ€ç»ˆçš„åº”ç”¨ç¨‹åºã€‚æ‚¨æ„å»ºæœ¬åœ°åº“å¹¶å‘å¸ƒå®ƒä»¬çš„æ–¹æ³•å°†å½±å“æ‚¨çš„åº”ç”¨ç¨‹åºçš„å…¼å®¹æ€§ã€‚ å¯¹äºä¸€ä¸ªæ²¡æœ‰è¿æ¥external/3rd-partyå…±äº«åº“çš„å…¸å‹é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡åœ¨Application.mkä¸­è®¾ç½®APP_ABIå˜é‡æ¥è½»æ¾å®ç°è¿™ä¸€ç‚¹ã€‚è¿™å·²ç»åœ¨å®˜æ–¹NDKæ–‡æ¡£ä¸­è¯¦ç»†è®¨è®ºäº†:Android Native CPU ABI Managementã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Application.mkçš„ä¸€è¡Œä¸­é€‰æ‹©ç›®æ ‡ABI: 1APP_ABI := armeabi armeabi-v7a mips x86 æ‚¨å¯ä»¥ç®€å•åœ°è®¾ç½®APP_ABI := allæ¥ä¸ºä¸Šé¢çš„ç›®æ ‡ABIsæ„å»ºæœ¬åœ°ä»£ç ã€‚ è¿™ç§æ–¹æ³•éå¸¸é€‚åˆé‚£äº›ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨åº“çš„é¡¹ç›®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€äº›ç°æœ‰çš„libsä¸æˆ‘ä»¬çš„é¡¹ç›®è”ç³»èµ·æ¥ã€‚è¿™æ„å‘³ç€æœ‰å¯èƒ½ä»¥äºŒè¿›åˆ¶æ ¼å¼æä¾›å¤–éƒ¨çš„libsã€‚è¿™å°†ä½¿é—®é¢˜å˜å¾—æ£˜æ‰‹ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ£€æµ‹å½“å‰æ„å»ºçš„å½“å‰ç›®æ ‡APP_ABIï¼Œç„¶åæ ¹æ®è¯¥æ¶æ„æ‰§è¡Œæ­£ç¡®çš„æ“ä½œã€‚ æˆ‘å°†ç”¨ä¸€ä¸ªéå¸¸å®é™…çš„é—®é¢˜ä½œä¸ºä¾‹å­æ¥è¯´æ˜ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ç®€å•çš„ã€‚æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯åœ¨å¼€å‘Androidåº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨äº†OpenCLåŠ é€Ÿçš„æœ¬åœ°ä»£ç ã€‚(å¯¹äºé‚£äº›ä¸çŸ¥é“OpenCLçš„äººæ¥è¯´:OpenCLæ˜¯ç”±Khronosç»„ç»‡ç»´æŠ¤çš„å¼‚æ„è®¡ç®—çš„å¼€æ”¾è§„èŒƒ;å¤§å¤šæ•°ç°ä»£æ¡Œé¢CPUï¼ŒGPUå’Œæœ€æ–°ä¸€ä»£çš„ç§»åŠ¨GPUæ”¯æŒOpenCLï¼Œå› æ­¤ï¼Œä½ å¯ä»¥åˆ©ç”¨OpenCLæ¥åˆ©ç”¨GPUå¹¶è¡Œæ¶æ„çš„å¼ºå¤§åŠŸèƒ½æ¥åŠ é€Ÿä½ çš„ç®—æ³•ã€‚)OpenCLçš„å·¥ä½œæ–¹å¼æ˜¯SoCèŠ¯ç‰‡ä¾›åº”å•†å®ç°OpenCLè½¯ä»¶å †æ ˆï¼ŒåŒ…æ‹¬é©±åŠ¨ç¨‹åºå’Œå…±äº«åº“ä¸­çš„ç¼–è¯‘å™¨ã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œå¯¹äºä¸åŒå‚å•†æä¾›çš„åº”ç”¨SoCèŠ¯ç‰‡ç»„çš„ä¸åŒè®¾å¤‡ï¼ŒOpenCLæ”¯æŒæ˜¯ç”±é©±åŠ¨ç¨‹åºåº“æ”¯æŒçš„ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå…±äº«çš„åº“ï¼Œé©»ç•™åœ¨ç›®å½•ä¸­ï¼Œå¦‚/system/vendor/lib, æˆ–/system/libï¼Œæˆ–å…¶ä»–ç›®å½•ã€‚å› æ­¤ï¼Œå¯¹äºåœ¨ç§»åŠ¨è®¾å¤‡(æ™ºèƒ½æ‰‹æœºæˆ–å¹³æ¿ç”µè„‘)ä¸­ä½¿ç”¨çš„ä¸åŒèŠ¯ç‰‡ç»„ï¼Œå…±äº«åº“å°†ä¼šéå¸¸ä¸åŒã€‚æ„å»ºOepnCLç¨‹åºçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ‚¨éœ€è¦åŠ¨æ€é“¾æ¥åˆ°è¿™äº›OpenCLé©±åŠ¨ç¨‹åºåº“ï¼Œè¿™æ ·ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºè°ƒç”¨çš„OpenCL APIå‡½æ•°å¯ä»¥åœ¨é“¾æ¥æ—¶è§£å†³ã€‚ ä¸‹è¡¨æ˜¾ç¤ºäº†ä¸€äº›ä¸»è¦çš„ç§»åŠ¨SoCèŠ¯ç‰‡å‚å•†çš„ç§»åŠ¨GPUçš„OpenCLåº“ã€‚ SoCèŠ¯ç‰‡ç»„ GPU Arch OpenCLåº“ ä¸‰æ˜ŸExynos(5420 æˆ– 5433) ARM Mali T628 æˆ– T760 ARM /system/vendor/lib/egl/libGLES_mali.so é«˜é€šéªé¾™800,801,805,810 Adreno A330, A420, A430 ARM /system/vendor/lib/libOpenCL.so è‹±ç‰¹å°”åŸå­Z3560 PowerVR G6430 x86 /system/vendor/lib/libPVROCL.so æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°ï¼Œå…±äº«åº“ä½äºAndroidç³»ç»Ÿçš„ä¸åŒä½ç½®ï¼Œå®ƒä»¬çš„åç§°ä¸åŒï¼Œç”šè‡³å…·æœ‰ä¸åŒçš„æ¶æ„ã€‚å¦‚æœæ‚¨æƒ³è¦æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥æ”¯æŒä»¥ä¸Šæ‰€æœ‰çš„å¹³å°ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨æ­£ç¡®çš„åŠ¨æ€é“¾æ¥æ¥æ„å»ºæœ¬åœ°éƒ¨åˆ†ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨TARGET_ARCHå˜é‡æˆ–TARGET_ARCH_ABIå˜é‡æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œè¿™äº›å˜é‡è¡¨ç¤ºå½“å‰çš„ç›®æ ‡ä½“ç³»ç»“æ„æˆ–ç›®æ ‡ä½“ç³»ç»“æ„ABIsã€‚ TARGET_ARCHå’ŒTARGET_ARCH_ABIç•¥æœ‰ä¸åŒ:TARGET_ARCHæŠ¥å‘Šä½“ç³»ç»“æ„åç§°;TARGET_ARCH_ABIæŠ¥å‘Šä½“ç³»ç»“æ„å’ŒæŒ‡ä»¤é›†ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰çš„APP_ABIæ˜¯â€œarmeabi-v7aâ€ï¼ŒTARGET_ARCHåªæ˜¾ç¤ºâ€œarmâ€ï¼Œè€ŒTARGET_ARCH_ABIå°†æ˜¯â€œarmeabi-v7aâ€ã€‚è¯·è®°ä½è¿™ä¸€ç‚¹ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å……åˆ†åˆ©ç”¨è¿™ä¸¤ä¸ªå˜é‡ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå…¶ä¸­æˆ‘ä»¬æ„å»ºä¸€ä¸ªæœ¬åœ°ç¨‹åº(æˆ–JNIä½¿ç”¨çš„å…±äº«åº“)ï¼Œç›®æ ‡æ˜¯æ”¯æŒå¤šä¸ªä½“ç³»ç»“æ„: 1234567891011121314151617181920212223242526272829ifeq ($(TARGET_ARCH),x86) GPU_FAMILY=powervr OPENCL_LIB := PVROCL OPENCL_INC_DIR := $(OPENCL_COMMON)/include/CL12/ OPENCL_LIB_DIR := $(OPENCL_COMMON)/libs/$(GPU_FAMILY)_$(TARGET_ARCH)/ LOCAL_LDLIBS := -llog -L$(OPENCL_LIB_DIR) -l$(OPENCL_LIB) MYMODULE_NAME:=mymodule_$(GPU_FAMILY) include OTHER_MK_FILES.mkendififeq ($(TARGET_ARCH),arm) #Adreno GPU_FAMILY:=adreno OPENCL_LIB := OpenCL OPENCL_INC_DIR := $(OPENCL_COMMON)/include/CL12/ OPENCL_LIB_DIR := $(OPENCL_COMMON)/libs/$(GPU_FAMILY)_$(TARGET_ARCH)/ LOCAL_LDLIBS := -llog -L$(OPENCL_LIB_DIR) -l$(OPENCL_LIB) MYMODULE_NAME:=mymodule_$(GPU_FAMILY) include OTHER_MK_FILES.mk #Mali GPU_FAMILY:=mali OPENCL_LIB := GLES_mali OPENCL_INC_DIR := $(OPENCL_COMMON)/include/CL11/ OPENCL_LIB_DIR := $(OPENCL_COMMON)/libs/$(GPU_FAMILY)_$(TARGET_ARCH)/ LOCAL_LDLIBS := -llog -L$(OPENCL_LIB_DIR) -l$(OPENCL_LIB) MYMODULE_NAME:=mymodule_$(GPU_FAMILY) include OTHER_MK_FILES.mkendif è¿™æ˜¯å®Œæ•´makefileçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåªæ˜¾ç¤ºäº†ä½¿ç”¨TARGET_ARCHå˜é‡çš„éƒ¨åˆ†ã€‚åœ¨æœ¬èŠ‚ä¹‹åï¼Œæˆ‘ä»¬å°†åŒ…å«ä¸€äº›makefileæ¥æ‰§è¡Œå¸¸è§„çš„æ„å»ºè¿‡ç¨‹ã€‚è¯·æ³¨æ„ï¼Œ$(OPENCL_COMMON)æ–‡ä»¶å¤¹åŒ…å«ç”¨äºä¸åŒç›®æ ‡æ¶æ„çš„å…±äº«åº“(æˆ‘ä»¬å¯ä»¥ä»å®é™…è®¾å¤‡ä¸­adb pullå®ƒä»¬)ã€‚ é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå®ç°äº†æœ¬åœ°ä»£ç çš„å‡ ä¸ªä¸åŒç‰ˆæœ¬ã€‚å‡å®šæœ¬åœ°ç¨‹åºçš„æ¨¡å—åæ˜¯â€œmymoduleâ€ã€‚ç„¶åï¼Œæœ€ç»ˆç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å°†å…·æœ‰ä»¥ä¸‹ç»“æ„ã€‚ structure123456+-- libs| +-- armeabi-v7a| +-- libmymodule_adreno.so| +-- libmymodule_mali.so| +-- x86| +-- libmymodule_powervr.so è¿™äº›åº“å°†è¢«æ‰“åŒ…åˆ°Android APKå®‰è£…ç¨‹åºä¸­ã€‚åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œæ­£ç¡®çš„æ¶æ„ç‰ˆæœ¬å°†åŸºäºç»™å®šè®¾å¤‡çš„ä¸»ABIå±æ€§(è¯·å‚é˜…è¿™é‡Œçš„è¯¦ç»†ä¿¡æ¯)å®‰è£…ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å°†APKå®‰è£…åœ¨å¸¦æœ‰ARM CPUçš„è®¾å¤‡ä¸Šï¼Œé‚£ä¹ˆå‰ä¸¤ä¸ª.soï¼Œæ–‡ä»¶å°†è¢«å®‰è£…ã€‚åœ¨æ‚¨çš„ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°æ£€æµ‹åˆ°è®¾å¤‡èŠ¯ç‰‡ä¾›åº”å•†ï¼Œå¹¶åŠ è½½ç›¸åº”çš„å…±äº«åº“ã€‚å¦‚æœAPKå®‰è£…åœ¨x86è®¾å¤‡ä¸Šï¼Œé‚£ä¹ˆå”¯ä¸€çš„x86åº“å°†è¢«å®‰è£…ï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶è‡ªåŠ¨åŠ è½½ã€‚ å½“ç„¶ï¼Œæ‚¨éœ€è¦åœ¨JAVAä»£ç ä¸­è°ƒç”¨System.loadLibrary()å‡½æ•°ï¼Œæˆ–è€…ä½¿ç”¨dlopen()å’Œdlsym()å‡½æ•°åœ¨æœ¬æœºä»£ç ä¸­åŠ¨æ€åœ°é“¾æ¥å…±äº«åº“ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†ä»¥ä¸Šçš„åº“ï¼ŒåŠ è½½æ­£ç¡®åº“çš„å·¥ä½œé‡å°±å˜å¾—å¾®ä¸è¶³é“äº†ã€‚ æ€»ç»“åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ndk-buildçš„åŸºç¡€çŸ¥è¯†ï¼Œæ¥ç€è®¨è®ºäº†ndk-buildç³»ç»Ÿä¸­çš„ä¸€äº›åŠéšè—ç‰¹æ€§æˆ–æŠ€æœ¯ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿™éå¸¸æœ‰ç”¨ã€‚æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹Android NDKå¼€å‘è€…æœ‰ç”¨ã€‚ å°½ç®¡æ¯ä¸€ç§æŠ€æœ¯éƒ½å¯èƒ½ç®€å•è€Œç›´æ¥ï¼Œä½†æ˜¯å½“æ‚¨å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œæˆ‘ç¡®ä¿¡æ‚¨å°†èƒ½å¤Ÿåˆ›å»ºä¸€äº›ä¸ä»…å¼ºå¤§è€Œä¸”é«˜æ•ˆçš„æ„å»ºè„šæœ¬ã€‚è¯·ä¸‹è½½githubä¸Šçš„ç¤ºä¾‹ï¼Œå¹¶å°è¯•ä¸€ä¸‹ï¼Œä½ éœ€è¦çš„åªæ˜¯Android NDKå’ŒAndroidè®¾å¤‡(æˆ–è€…åƒGenymotionè¿™æ ·çš„è™šæ‹Ÿè®¾å¤‡)ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"NDK","slug":"Android/NDK","permalink":"https://jigangduan.github.io/categories/Android/NDK/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"ndk","slug":"ndk","permalink":"https://jigangduan.github.io/tags/ndk/"},{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://jigangduan.github.io/tags/ç¿»è¯‘/"}]},{"title":"AndroidåŸç”Ÿç¨‹åºå¯åŠ¨å·¥å…·","slug":"AndroidNDKNativeProgramLauncher","date":"2017-11-01T08:38:27.000Z","updated":"2020-07-25T02:57:18.147Z","comments":true,"path":"2017/11/01/AndroidNDKNativeProgramLauncher/","link":"","permalink":"https://jigangduan.github.io/2017/11/01/AndroidNDKNativeProgramLauncher/","excerpt":"[ç¿»è¯‘]AndroidåŸç”Ÿç¨‹åºå¯åŠ¨å·¥å…· ä»‹ç» ä¸»è¦åŠŸèƒ½ å…¥é—¨æŒ‡å— ä¸‹è½½åœ°å€ æä¾›äº†ä»€ä¹ˆ? ä½¿ç”¨è¯´æ˜ ä¸€äº›ç»†èŠ‚ ç¤ºä¾‹ ç¤ºä¾‹1 ç¤ºä¾‹2","text":"[ç¿»è¯‘]AndroidåŸç”Ÿç¨‹åºå¯åŠ¨å·¥å…· ä»‹ç» ä¸»è¦åŠŸèƒ½ å…¥é—¨æŒ‡å— ä¸‹è½½åœ°å€ æä¾›äº†ä»€ä¹ˆ? ä½¿ç”¨è¯´æ˜ ä¸€äº›ç»†èŠ‚ ç¤ºä¾‹ ç¤ºä¾‹1 ç¤ºä¾‹2 ä»‹ç»åœ¨ä½¿ç”¨åŸç”Ÿä»£ç å¼€å‘Androidåº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä½¿ç”¨çº¯åŸç”Ÿæ¨¡å¼æ¥è°ƒè¯•å®ƒ(ä½¿ç”¨NDKç¼–è¯‘ä»£ç ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶é€šè¿‡adb shellæ‰§è¡Œå®ƒ)ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬ç”šè‡³ä¸æƒ³èŠ±æ—¶é—´å¼€å‘Androidåº”ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯æƒ³æµ‹è¯•ä¸€äº›åŸç”Ÿå‡½æ•°ã€‚ ä»¥å¤„ç†OpenCLå’ŒGPUä¸ºä¾‹ã€‚ç¼–å†™çš„ç¨‹åºä¸­è¶…è¿‡80%å°†æ˜¯æ€§èƒ½å’ŒåŸºå‡†ä»£ç ã€‚ç”±äºå®ƒä»¬ç›´æ¥æ“ä½œç³»ç»Ÿé©±åŠ¨ç¨‹åºæˆ–ç¡¬ä»¶ï¼Œæ‰€ä»¥é€šè¿‡ADBä»¥çº¯åŸç”Ÿæ¨¡å¼è¿è¡Œå®ƒä»¬éå¸¸è‡ªç„¶ã€‚æˆ‘äº«å—ç€åŸç”Ÿç¨‹åºå¸¦ç»™æˆ‘çš„æ•ˆç‡å’Œé€Ÿåº¦ã€‚ ä½†æ˜¯ï¼Œçº¯åŸç”Ÿä»£ç å¯èƒ½æ— æ³•åœ¨Androidè®¾å¤‡ä¸Šè¿è¡Œã€‚æ¯”å¦‚ä»¥ä¸‹é‡åˆ°çš„ä¸€äº›æƒ…å†µ: è®¾å¤‡æ²¡æœ‰è¢«ROOTã€‚å› æ­¤ï¼Œç”±äºç¼ºå°‘æƒé™ï¼Œæ‚¨ä¸èƒ½å°†åŸç”Ÿç¨‹åºæ¨åˆ°/data/æ–‡ä»¶å¤¹ä¸‹ã€‚æ‚¨ä¸èƒ½é€šè¿‡ä½¿ç”¨chmod+xæ–‡ä»¶æ¥ç»™åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æä¾›æ‰§è¡Œæƒé™ï¼Œå› æ­¤ï¼Œåœ¨è®¾å¤‡ä¸Šè¿è¡Œå®ƒæ˜¯ä¸å¯èƒ½çš„ã€‚ ä½ çš„è®¾å¤‡å·²ç»ROOTäº†ã€‚æ‚¨å¯ä»¥é€šè¿‡ADBæ¥è¿è¡Œä»£ç ã€‚ç„¶è€Œï¼Œå½“ä½¿ç”¨ADBè¿è¡Œä»£ç æ—¶ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨USBç”µç¼†å°†æ‚¨çš„è®¾å¤‡è¿æ¥åˆ°è®¡ç®—æœºã€‚å¦‚æœä½ ç”¨ä¸€äº›å¤–éƒ¨åŠŸç‡è®¡æ¥æµ‹é‡ç³»ç»ŸåŠŸè€—å‘¢?ç”±äºUSBç”µç¼†ä¸ºè®¾å¤‡æä¾›äº†é¢å¤–çš„ç”µæºè¾“å…¥ï¼Œæ‰€ä»¥è¿æ¥åˆ°USBç”µç¼†ä½¿åŠŸç‡æµ‹é‡å˜å¾—ä¸å¯èƒ½ã€‚ å¯¹äºæŸäº›è®¾å¤‡ï¼Œæ‚¨ç”šè‡³æ²¡æœ‰æ­£ç¡®çš„ADBé©±åŠ¨ç¨‹åºã€‚ ä¸€äº›æœªçŸ¥çš„æƒ…å†µä¸‹â€¦ åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹å®šçš„å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬åœ¨æ²¡æœ‰ROOTã€ç‹¬ç«‹çš„ã€æ²¡æœ‰usbè¿æ¥çš„è®¾å¤‡ä¸Šè¿è¡Œæœ¬æœºç¨‹åºã€‚ ä¸»è¦åŠŸèƒ½ ä¸éœ€è¦rootæƒé™ã€‚ ä½ å¯ä»¥åœ¨æ²¡æœ‰ADBå’ŒUSBè¿æ¥åˆ°ç”µè„‘çš„æƒ…å†µä¸‹è¿è¡ŒåŸç”Ÿä»£ç ã€‚ æ”¯æŒä»sdcardä¸­åŠ è½½æœ¬æœºç¨‹åºã€‚ æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ã€‚ å…è®¸ç”¨æˆ·è®¾ç½®LD_LIBRARY_PATHã€‚ æ”¯æŒå­ç›®å½•ã€‚åŸç”Ÿç¨‹åºè£…å…¥çš„è¾“å…¥æ–‡ä»¶å’Œé…ç½®å¯ä»¥æ”¾åœ¨å­ç›®å½•ä¸­ï¼Œåœ¨åŸç”Ÿç¨‹åºä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥è®¿é—®å®ƒä»¬ã€‚ è¾“å‡ºæ–‡ä»¶çš„æ”¯æŒã€‚å¯ä»¥ä»å·¥ä½œç›®å½•ä¸­æ£€ç´¢è¾“å‡ºæ–‡ä»¶ã€‚ å…¥é—¨æŒ‡å—ä¸‹è½½åœ°å€AndroidNativeLauncher@github. æä¾›äº†ä»€ä¹ˆ? ä¸€ä¸ªAPKå®‰è£…ç¨‹åºã€‚ ä¸€äº›ç¤ºä¾‹NDKé¡¹ç›®ï¼Œä»¥åŠæ„å»ºè„šæœ¬ã€‚ ä½¿ç”¨è¯´æ˜ å°†æ‚¨çš„åŸç”Ÿç¨‹åº(ç”±ndk-buildç¼–è¯‘)å¤åˆ¶åˆ°æ‚¨çš„sdcardä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œä¾‹å¦‚ /sdcard/test/ã€‚ å°†æ‰€æœ‰ä¾èµ–çš„å…±äº«åº“(.so)å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ã€‚ å°†è¾“å…¥æ–‡ä»¶å¤åˆ¶åˆ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ æŒ‰ä¸‹â€œè½½å…¥åŸç”Ÿç¨‹åºâ€æŒ‰é’®ã€‚ å¦‚æœæœ‰çš„è¯ï¼Œè®¾ç½®å‘½ä»¤è¡Œå‚æ•°ã€‚ æŒ‰ä¸‹â€œè¿è¡Œâ€æŒ‰é’®æ¥æ‰§è¡Œç¨‹åºã€‚ æ£€æŸ¥ä½ æ–‡ä»¶å¤¹ä¸‹çš„ç»“æœï¼Œä¾‹å¦‚/sdcard/test/ã€‚ ä¸€äº›ç»†èŠ‚ é—®:å·¥ä½œç›®å½•åœ¨å“ªé‡Œ? ç­”:å·¥ä½œç›®å½•æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•ã€‚ é—®:å¦‚ä½•è®¾ç½®LD_LIBRARY_PATH?åº“çš„è£…è½½é¡ºåºæ˜¯ä»€ä¹ˆ? ç­”:åœ¨texteditå­—æ®µä¸­ï¼Œé”®å…¥æ‚¨çš„è‡ªå®šä¹‰åº“è·¯å¾„ã€‚è¯·æ³¨æ„ï¼Œæ‚¨çš„å·¥ä½œç›®å½•å°†è‡ªåŠ¨æ·»åŠ åˆ°LD_LIBRARY_PATHã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨å­—æ®µä¸­è¾“å…¥â€œmylibâ€ï¼Œé‚£ä¹ˆLD_LIBRARY_PATHå°†è¢«è®¾ç½®ä¸ºLD_LIBRARY_PATH=mypath:workingdirectory:$LD_LIBRARY_PATHã€‚ é—®:å¦‚ä½•ä½¿ç”¨å­ç›®å½•? ç­”: å­æ–‡ä»¶å¤¹å¯ä»¥é€šè¿‡ç›¸å¯¹è·¯å¾„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å·¥ä½œç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸ºâ€œimageâ€çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè¾“å…¥å›¾ç‰‡â€œlena.pngâ€ã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡imag/lena.pngæ¥è®¿é—®å®ƒã€‚æ‚¨çš„è¾“å‡ºæ–‡ä»¶ä¹Ÿå°†åœ¨å·¥ä½œç›®å½•ä¸‹ã€‚ ç¤ºä¾‹æä¾›äº†ä¸¤ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºåŸç”Ÿç¨‹åºå¯åŠ¨ç¨‹åºçš„åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨binç›®å½•ä¸­æ‰¾åˆ°é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥ä½¿ç”¨NDKç¼–è¯‘ä»£ç ã€‚æˆ‘æä¾›ä¸€ä¸ªbuild_examples.shè„šæœ¬ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯·å®‰è£…NDKå¹¶ç¡®ä¿åœ¨ç³»ç»Ÿè·¯å¾„ä¸­è¿›è¡ŒNDKæ„å»ºï¼Œç„¶åæ‚¨å°±å¯ä»¥ä½¿ç”¨æ„å»ºä¸‹é¢çš„ç¤ºä¾‹: 12$ cd examples$ ./build_examples.sh ç¼–è¯‘å®Œä»£ç åï¼Œè®©æˆ‘ä»¬å°†äºŒè¿›åˆ¶æ–‡ä»¶æ¨å…¥åˆ°sdcardä¸­ 12$ adb shell \"mkdir -p /sdcard/examples\"$ adb push bin /sdcard/example ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨NativeLauncheråº”ç”¨ç¨‹åºæ¥åŠ è½½æœ¬åœ°ç¨‹åºå¹¶æ‰§è¡Œå®ƒã€‚ â€“ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ä¸ªä¾‹å­çš„ç»†èŠ‚ã€‚ ç¤ºä¾‹1test1.cpp 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;iostream&gt;#include &lt;fstream&gt;int main(int argc, char ** argv)&#123; if(argc &gt; 1) &#123; std::cout &lt;&lt; \"argc: \" &lt;&lt; argc &lt;&lt; std::endl; for(int i = 0; i &lt; argc; i ++) &#123; std::cout &lt;&lt; \"argv[\" &lt;&lt; i &lt;&lt; \"]: \" &lt;&lt; argv[i] &lt;&lt; std::endl; &#125; std::cout &lt;&lt; std::endl; &#125; std::cout &lt;&lt; \"cout: Hello world!\" &lt;&lt; std::endl; std::cerr &lt;&lt; \"cerr: Hello world!\" &lt;&lt; std::endl; std::cout &lt;&lt; \"\\nTest:\\n\" &lt;&lt; std::endl; for(int i = 0; i &lt; 20; i ++) &#123; for(int j = 0; j &lt; i; j ++) std::cout &lt;&lt; \"*\"; std::cout &lt;&lt; std::endl; &#125; std::ofstream ofs(\"results.txt\"); if(ofs.is_open())&#123; ofs &lt;&lt; \"This is just a test.\" &lt;&lt; std::endl; ofs.close(); std::cout &lt;&lt; \"results.txt is generated.\" &lt;&lt; std::endl; &#125; return 0;&#125; æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªæ¼”ç¤ºåŸºæœ¬ä¸Šæ‰“å°å‡ºå‘½ä»¤è¡Œå‚æ•°ã€ä¸€äº›æµ‹è¯•æ¶ˆæ¯ã€ä¸€ä¸ªä½¿ç”¨çš„ç®€å•å›¾å½¢ï¼Œæœ€åä¿å­˜ä¸€ä¸ªresults.txtæ–‡ä»¶åˆ°sdcardã€‚ æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹makefileç¼–è¯‘test1.cpp: Android.mk 12345678LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE := test1LOCAL_LDLIBS = -llogLOCAL_CFLAGS += -fPIELOCAL_LDFLAGS += -fPIE -pieLOCAL_SRC_FILES := test1.cppinclude $(BUILD_EXECUTABLE) ç¤ºä¾‹2è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¯¹å…±äº«åº“å’ŒLD_LIBRARY_PATHçš„æ”¯æŒã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªadd()å‡½æ•°å¹¶å°†å…¶ç¼–è¯‘æˆä¸€ä¸ªå…±äº«åº“ã€‚ç„¶ååœ¨main()å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä»å…±äº«åº“è°ƒç”¨add()å‡½æ•°æ¥æ‰§è¡Œè®¡ç®—ã€‚ addfunc.cpp 1234int add(int a, int b)&#123; return a + b;&#125; test2.cpp 1234567891011121314#include &lt;iostream&gt;extern int add(int, int);int main(int argc, char ** argv)&#123; std::cout &lt;&lt; \"Test shared library.\" &lt;&lt; std::endl; int a = 1; int b = 2; std::cout &lt;&lt; \"a=\" &lt;&lt; a &lt;&lt; std::endl &lt;&lt;\"b=\" &lt;&lt; b &lt;&lt; std::endl &lt;&lt; \"add(a, b)=\" &lt;&lt; add(a, b) &lt;&lt; std::endl; return 0;&#125; Android.mk 12345678910111213LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE := addfuncLOCAL_SRC_FILES := addfunc.cppinclude $(BUILD_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE := test2LOCAL_SRC_FILES := test2.cppLOCAL_CFLAGS := -fPIELOCAL_LDFLAGS := -fPIE -pieLOCAL_LDLIBS := -L$(LOCAL_PATH)/../libs/$(TARGET_ARCH_ABI)/ -laddfuncinclude $(BUILD_EXECUTABLE) å› ä¸ºlibaddfunc.soå’Œtest2åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå½“æ‚¨åŠ è½½test2å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå…±äº«åº“libaddfunc.soè‡ªåŠ¨åŠ è½½ã€‚å› æ­¤ï¼Œå½“æ‚¨è¿è¡Œç¨‹åºæ—¶ï¼Œæ‚¨å°†çœ‹åˆ°æ­£ç¡®çš„è¾“å‡º: 1234Test shared library.a=1b=2add(a,b)=3 ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç§»åŠ¨libaddfunc.soåˆ°ä¸€ä¸ªåä¸ºlibçš„å­ç›®å½•ï¼š 1234$ adb shell$ cd sdcard/example/example2$ mkdir lib$ mv libaddfunc.so lib/ ç„¶åï¼Œå¦‚æœæˆ‘ä»¬å†æ¬¡æ‰§è¡Œæœ¬æœºç¨‹åºï¼Œå› ä¸ºè¿™ä¸€æ¬¡å…±äº«åº“ä¸åœ¨æœç´¢è·¯å¾„ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯: 1CANNOT LINK EXECUTABLE: could not load library &quot;libaddfunc.so&quot; needed by &quot;.test2&quot;; caused by library &quot;libaddfunc.so&quot; not found. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨LD_LIBRARY_PATHæ–‡æœ¬å­—æ®µä¸­è¾“å…¥libã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çš„å›¾ä¹¦é¦†æœç´¢è·¯å¾„å˜æˆäº†: 1LD_LIBRARY_PATH=lib:working_directory:$LD_LIBRARY_PATH åœ¨è¿™é‡Œï¼Œå·¥ä½œç›®å½•æ˜¯æ‚¨çš„æœ¬æœºç¨‹åºæ‰€åœ¨çš„æ–‡ä»¶å¤¹ã€‚ é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡æŒ‰ä¸‹â€œRunâ€æŒ‰é’®è¿è¡ŒåŸç”Ÿç¨‹åºï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°æ­£ç¡®çš„è¾“å‡ºæ¶ˆæ¯ã€‚è¿™æ„å‘³ç€å·²ç»æ‰¾åˆ°å¹¶åŠ è½½äº†å…±äº«åº“ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"NDK","slug":"Android/NDK","permalink":"https://jigangduan.github.io/categories/Android/NDK/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"ndk","slug":"ndk","permalink":"https://jigangduan.github.io/tags/ndk/"},{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://jigangduan.github.io/tags/ç¿»è¯‘/"}]},{"title":"Appç ”å‘å½• ç¬”è®°äºŒ: Appå¼€å‘ä¸­çš„é«˜çº§æŠ€å·§","slug":"Appç ”å‘å½•-ç¬”è®°-äºŒ","date":"2017-10-27T09:50:58.000Z","updated":"2020-07-25T02:57:18.148Z","comments":true,"path":"2017/10/27/Appç ”å‘å½•-ç¬”è®°-äºŒ/","link":"","permalink":"https://jigangduan.github.io/2017/10/27/Appç ”å‘å½•-ç¬”è®°-äºŒ/","excerpt":"ç¬¬äºŒéƒ¨åˆ† Appå¼€å‘ä¸­çš„é«˜çº§æŠ€å·§","text":"ç¬¬äºŒéƒ¨åˆ† Appå¼€å‘ä¸­çš„é«˜çº§æŠ€å·§ Crash å¼‚å¸¸æ”¶é›†ä¸ç»Ÿè®¡å¼‚å¸¸æ”¶é›†UncaughtExceptionHandler - ç”¨äºå¤„ç†æœªæ•è·çš„å¼‚å¸¸ (Appçº§åˆ«) 1","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"Android/è¯»ä¹¦ç¬”è®°","permalink":"https://jigangduan.github.io/categories/Android/è¯»ä¹¦ç¬”è®°/"},{"name":"Appç ”å‘å½•","slug":"Android/è¯»ä¹¦ç¬”è®°/Appç ”å‘å½•","permalink":"https://jigangduan.github.io/categories/Android/è¯»ä¹¦ç¬”è®°/Appç ”å‘å½•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"notes","slug":"notes","permalink":"https://jigangduan.github.io/tags/notes/"},{"name":"app","slug":"app","permalink":"https://jigangduan.github.io/tags/app/"}]},{"title":"RxSwift è­¦å‘Š","slug":"RxSwift-Warnings","date":"2017-10-27T06:02:45.000Z","updated":"2020-07-25T02:57:18.163Z","comments":true,"path":"2017/10/27/RxSwift-Warnings/","link":"","permalink":"https://jigangduan.github.io/2017/10/27/RxSwift-Warnings/","excerpt":"è­¦å‘Š æœªä½¿ç”¨ disposable æœªä½¿ç”¨ observable åºåˆ—","text":"è­¦å‘Š æœªä½¿ç”¨ disposable æœªä½¿ç”¨ observable åºåˆ— æœªä½¿ç”¨ disposable (unused-disposable)ä¸‹é¢çš„å†…å®¹å¯¹äºsubscribe*ã€bind*å’Œdrive*å®¶æ—å‡½æ•° è¿”å›Disposableã€‚ ä½ ä¼šæ”¶åˆ°è¿™æ ·çš„è­¦å‘Š: 1234567891011let xs: Observable&lt;E&gt; ....xs .filter &#123; ... &#125; .map &#123; ... &#125; .switchLatest() .subscribe(onNext: &#123; ... &#125;, onError: &#123; ... &#125;) subscribeå‡½æ•°è¿”å›ä¸€ä¸ªDisposableï¼Œå¯ä»¥ç”¨æ¥å–æ¶ˆè®¡ç®—å’Œé‡Šæ”¾èµ„æºã€‚ä½†æ˜¯ï¼Œä¸ä½¿ç”¨å®ƒå°†å¯¼è‡´ä¸€ä¸ªé”™è¯¯ã€‚ ç»ˆæ­¢è¿™äº›æµç•…è°ƒç”¨çš„é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨DisposeBagï¼Œæˆ–è€…é€šè¿‡é“¾æ¥è°ƒç”¨.disposed(by: disposeBag)æˆ–è€…ç›´æ¥æŠŠdisposableåŠ åˆ°bagã€‚ 12345678910111213let xs: Observable&lt;E&gt; ....let disposeBag = DisposeBag()xs .filter &#123; ... &#125; .map &#123; ... &#125; .switchLatest() .subscribe(onNext: &#123; ... &#125;, onError: &#123; ... &#125;) .disposed(by: disposeBag) // &lt;--- note `.disposed(by:)` å½“disposeBagè¢«é‡Šæ”¾æ—¶ï¼Œå®ƒé‡Œé¢åŒ…å«çš„disposablesä¹Ÿä¼šè¢«è‡ªåŠ¨å¤„ç†æ‰ã€‚ å¦‚æœxsä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼ä»¥Completed æˆ– Errorçš„æ–¹å¼ç»ˆæ­¢ï¼Œä¸å¤„ç†è®¢é˜…Disposableä¸ä¼šæ³„æ¼ä»»ä½•èµ„æº. ç„¶è€Œï¼Œå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸€ä¸ªdisposeBagä»ç„¶æ˜¯å¤„ç†è®¢é˜…å¤„ç†é—®é¢˜çš„é¦–é€‰æ–¹æ³•. å®ƒç¡®ä¿äº†å…ƒç´ è®¡ç®—æ€»æ˜¯åœ¨å¯é¢„è§çš„æ—¶åˆ»ç»ˆæ­¢ï¼Œå¹¶ä¸”ä½¿æ‚¨çš„ä»£ç å¥å£®å’Œå°†æ¥çš„è¯æ˜ï¼Œå› ä¸ºå³ä½¿xsçš„å®ç°æ”¹å˜ï¼Œèµ„æºä¹Ÿä¼šå¾—åˆ°é€‚å½“çš„å¤„ç†. å¦ä¸€ç§ç¡®ä¿è®¢é˜…å’Œèµ„æºä¸æŸä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„æ–¹æ³•æ˜¯ä½¿ç”¨takeUntilæ“ä½œç¬¦ 12345678910111213let xs: Observable&lt;E&gt; ....let someObject: NSObject ..._ = xs .filter &#123; ... &#125; .map &#123; ... &#125; .switchLatest() .takeUntil(someObject.deallocated) // &lt;-- note the `takeUntil` operator .subscribe(onNext: &#123; ... &#125;, onError: &#123; ... &#125;) å¦‚æœå¿½ç•¥è®¢é˜…Disposableæ˜¯æœŸæœ›çš„è¡Œä¸ºï¼Œè¿™å°±æ˜¯å¦‚ä½•ä½¿ç¼–è¯‘å™¨è­¦å‘Šä¿æŒæ²‰é»˜ã€‚ 1234567891011let xs: Observable&lt;E&gt; ...._ = xs // &lt;-- note the underscore .filter &#123; ... &#125; .map &#123; ... &#125; .switchLatest() .subscribe(onNext: &#123; ... &#125;, onError: &#123; ... &#125;) æœªä½¿ç”¨ observable åºåˆ— (unused-observable)ä½ ä¼šæ”¶åˆ°è¿™æ ·çš„è­¦å‘Š: 12345let xs: Observable&lt;E&gt; ....xs .filter &#123; ... &#125; .map &#123; ... &#125; è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªobservableåºåˆ—ï¼Œè¯¥åºåˆ—ä»xsåºåˆ—ä¸­è¿‡æ»¤å¹¶æ˜ å°„ï¼Œä½†éšåå¿½ç•¥äº†ç»“æœã€‚ å› ä¸ºè¿™æ®µä»£ç åªå®šä¹‰äº†ä¸€ä¸ªobservableåºåˆ—ï¼Œç„¶åå¿½ç•¥å®ƒï¼Œå®ƒå®é™…ä¸Šä»€ä¹ˆä¹Ÿä¸åšã€‚ æ‚¨çš„æ„å›¾å¯èƒ½æ˜¯å­˜å‚¨observableåºåˆ—å®šä¹‰å¹¶éšåä½¿ç”¨å®ƒ â€¦ 12345let xs: Observable&lt;E&gt; ....let ys = xs // &lt;--- names definition as `ys` .filter &#123; ... &#125; .map &#123; ... &#125; â€¦ æˆ–è€…æ ¹æ®è¿™ä¸ªå®šä¹‰å¼€å§‹è®¡ç®— 1234567891011let xs: Observable&lt;E&gt; ....let disposeBag = DisposeBag()xs .filter &#123; ... &#125; .map &#123; ... &#125; .subscribe(onNext: &#123; nextElement in // &lt;-- note the `subscribe*` method // use the element print(nextElement) &#125;) .disposed(by: disposeBag)","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift ç‰¹å¾","slug":"RxSwift-Traits","date":"2017-10-27T03:26:51.000Z","updated":"2020-07-25T02:57:18.163Z","comments":true,"path":"2017/10/27/RxSwift-Traits/","link":"","permalink":"https://jigangduan.github.io/2017/10/27/RxSwift-Traits/","excerpt":"ç‰¹å¾(ä»¥å‰çš„å•ä½)æœ¬æ–‡å°†å°è¯•æè¿°ä»€ä¹ˆæ˜¯ç‰¹å¾ï¼Œä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å’Œåˆ›å»ºå®ƒä»¬ã€‚ æ¦‚æ‹¬ ä¸ºä»€ä¹ˆ å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ RxSwift ç‰¹å¾ Single åˆ›å»ºSingle Completable åˆ›å»ºCompletable Maybe åˆ›å»ºMaybe RxCocoa ç‰¹å¾ Driver ä¸ºä»€ä¹ˆå®ƒè¢«å‘½åä¸º Driver å®é™…ä½¿ç”¨çš„ä¾‹å­ ControlProperty / ControlEvent","text":"ç‰¹å¾(ä»¥å‰çš„å•ä½)æœ¬æ–‡å°†å°è¯•æè¿°ä»€ä¹ˆæ˜¯ç‰¹å¾ï¼Œä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å’Œåˆ›å»ºå®ƒä»¬ã€‚ æ¦‚æ‹¬ ä¸ºä»€ä¹ˆ å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ RxSwift ç‰¹å¾ Single åˆ›å»ºSingle Completable åˆ›å»ºCompletable Maybe åˆ›å»ºMaybe RxCocoa ç‰¹å¾ Driver ä¸ºä»€ä¹ˆå®ƒè¢«å‘½åä¸º Driver å®é™…ä½¿ç”¨çš„ä¾‹å­ ControlProperty / ControlEvent æ¦‚æ‹¬ä¸ºä»€ä¹ˆSwiftæœ‰ä¸€ä¸ªå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œå¯ä»¥ç”¨æ¥æé«˜åº”ç”¨ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ï¼Œå¹¶ä½¿ä½¿ç”¨Rxæ›´åŠ ç›´è§‚å’Œç›´è§‚. ç‰¹å¾æœ‰åŠ©äºæ²Ÿé€šå’Œç¡®ä¿observableåºåˆ—å±æ€§çš„æ¥å£è¾¹ç•Œï¼Œä»¥åŠæä¾›ä¸Šä¸‹æ–‡æ„ä¹‰ã€è¯­æ³•ç³–å’Œæ›´å…·ä½“çš„ç”¨ä¾‹ç›®æ ‡ã€‚ å‡ºäºè¿™ä¸ªåŸå› ï¼Œç‰¹å¾å®Œå…¨æ˜¯å¯é€‰çš„ã€‚åœ¨æ‚¨çš„ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨åŸå§‹çš„å¯è§‚å¯Ÿåºåˆ—ï¼Œå› ä¸ºæ‰€æœ‰çš„æ ¸å¿ƒrxswift/rxcocoa apiéƒ½æ”¯æŒå®ƒä»¬ã€‚ æ³¨æ„:æœ¬æ–‡æ¡£ä¸­æè¿°çš„ä¸€äº›ç‰¹å¾(å¦‚Driver)æ˜¯ç‰¹å®šåªå¯¹RxCocoaé¡¹ç›®,æœ‰äº›æ˜¯é€šç”¨çš„ä¸€éƒ¨åˆ†é¡¹ç›®RxSwiftã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰å¿…è¦ï¼ŒåŒæ ·çš„åŸåˆ™ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨å…¶ä»–Rxå®ç°ä¸­å®ç°ã€‚ä¸éœ€è¦ç§æœ‰API å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ç‰¹å¾ä»…ä»…æ˜¯ä¸€ä¸ªåŒ…è£…å™¨ç»“æ„ï¼Œå¸¦æœ‰ä¸€ä¸ªåªè¯»çš„Observableåºåˆ—å±æ€§ã€‚ 12345678struct Single&lt;Element&gt; &#123; let source: Observable&lt;Element&gt;&#125;struct Driver&lt;Element&gt; &#123; let source: Observable&lt;Element&gt;&#125;... æ‚¨å¯ä»¥å°†å®ƒä»¬çœ‹ä½œæ˜¯Observableåºåˆ—çš„æ„å»ºå™¨æ¨¡å¼å®ç°ã€‚å½“ä¸€ä¸ªç‰¹å¾è¢«å»ºç«‹èµ·æ¥æ—¶ï¼Œè°ƒç”¨.asObservable()å°†æŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªæ™®é€šçš„å¯è§‚å¯Ÿçš„åºåˆ—ã€‚ RxSwift traitsSingleSingleæ˜¯Observableçš„å˜ä½“ï¼Œä¸æ˜¯å‘å°„ä¸€ç³»åˆ—çš„å…ƒç´ ï¼Œå®ƒæ€»æ˜¯ä¿è¯ä¼šå‘å°„å•ä¸ªå…ƒç´ æˆ–ä¸€ä¸ªé”™è¯¯ã€‚ åªé‡Šæ”¾ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…ä¸€ä¸ªé”™è¯¯ ä¸å…±äº«å‰¯ä½œç”¨ ä½¿ç”¨Singleçš„ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯æ‰§è¡ŒHTTPè¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚åªèƒ½è¿”å›å“åº”æˆ–é”™è¯¯, ä½†æ˜¯ï¼ŒSingleå¯ä»¥ç”¨äºå¯¹ä»»ä½•åªå…³å¿ƒå•ä¸ªå…ƒç´ çš„æƒ…å†µè¿›è¡Œå»ºæ¨¡ï¼Œè€Œä¸æ˜¯å¯¹æ— é™çš„å…ƒç´ æµè¿›è¡Œå»ºæ¨¡. åˆ›å»ºSingleåˆ›å»ºä¸€ä¸ªSingleç±»ä¼¼äºåˆ›å»ºä¸€ä¸ªObservableã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­å°±æ˜¯è¿™æ ·çš„: 1234567891011121314151617181920212223func getRepo(_ repo: String) -&gt; Single&lt;[String: Any]&gt; &#123; return Single&lt;[String: Any]&gt;.create &#123; single in let task = URLSession.shared.dataTask(with: URL(string: \"https://api.github.com/repos/\\(repo)\")!) &#123; data, _, error in if let error = error &#123; single(.error(error)) return &#125; guard let data = data, let json = try? JSONSerialization.jsonObject(with: data, options: .mutableLeaves), let result = json as? [String: Any] else &#123; single(.error(DataError.cantParseJSON)) return &#125; single(.success(result)) &#125; task.resume() return Disposables.create &#123; task.cancel() &#125; &#125;&#125; ä¹‹åä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä½¿ç”¨å®ƒ: 12345678910getRepo(\"ReactiveX/RxSwift\") .subscribe &#123; event in switch event &#123; case .success(let json): print(\"JSON: \", json) case .error(let error): print(\"Error: \", error) &#125; &#125; .disposed(by: disposeBag) æˆ–è€…é€šè¿‡ä½¿ç”¨subscribe(onSuccess:onError:)å¦‚ä¸‹: 12345678getRepo(\"ReactiveX/RxSwift\") .subscribe(onSuccess: &#123; json in print(\"JSON: \", json) &#125;, onError: &#123; error in print(\"Error: \", error) &#125;) .disposed(by: disposeBag) è®¢é˜…æä¾›äº†SingleEventæšä¸¾ï¼Œå®ƒå¯ä»¥æ˜¯.successåŒ…å«Singleç±»å‹çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯.errorã€‚åœ¨ç¬¬ä¸€ä¸ªäº‹ä»¶ä¹‹åï¼Œä¸ä¼šå†å‘ç”Ÿè¿›ä¸€æ­¥çš„äº‹ä»¶ã€‚ åœ¨åŸå§‹çš„Observableåºåˆ—ä¸­ä½¿ç”¨.asSingle()ä¹Ÿå¯ä»¥å°†å…¶è½¬æ¢ä¸ºSingle. CompletableCompletableæ˜¯Observableçš„å˜ä½“ï¼Œå®ƒåªèƒ½completeæˆ–å‘å°„ä¸€ä¸ªerrorã€‚å®ƒä¿è¯ä¸ä¼šå‘å°„ä»»ä½•å…ƒç´ . å‘å°„é›¶å…ƒç´  å‘å°„ä¸€ä¸ªcompletionäº‹ä»¶æˆ–ä¸€ä¸ªerror ä¸å…±äº«å‰¯ä½œç”¨ Completableçš„ä¸€ä¸ªæœ‰ç”¨çš„äº‹ä¾‹ï¼Œæ˜¯å¯¹ä»»ä½•æˆ‘ä»¬åªå…³å¿ƒæ“ä½œå·²ç»å®Œæˆçš„äº‹å®çš„æƒ…å†µå»ºæ¨¡ï¼Œä½†æ˜¯ä¸å…³å¿ƒç”±è¯¥å®Œæˆæ‰€å¯¼è‡´çš„ä¸€ä¸ªå…ƒç´ .ä½ å¯ä»¥å°†å®ƒä¸ä¸èƒ½å‘å°„å…ƒç´ çš„Observable&lt;Void&gt;ç›¸æ¯”è¾ƒ. åˆ›å»ºCompletableåˆ›å»ºä¸€ä¸ªCompletableç±»ä¼¼äºåˆ›å»ºä¸€ä¸ªObservableã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­å°±æ˜¯è¿™æ ·çš„: 123456789101112131415func cacheLocally() -&gt; Completable &#123; return Completable.create &#123; completable in // Store some data locally ... ... guard success else &#123; completable(.error(CacheError.failedCaching)) return Disposables.create &#123;&#125; &#125; completable(.completed) return Disposables.create &#123;&#125; &#125;&#125; ä¹‹åä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä½¿ç”¨å®ƒ: 12345678910cacheLocally() .subscribe &#123; completable in switch completable &#123; case .completed: print(\"Completed with no error\") case .error(let error): print(\"Completed with an error: \\(error.localizedDescription)\") &#125; &#125; .disposed(by: disposeBag) æˆ–è€…é€šè¿‡ä½¿ç”¨subscribe(onSuccess:onError:)å¦‚ä¸‹: 12345678cacheLocally() .subscribe(onCompleted: &#123; print(\"Completed with no error\") &#125;, onError: &#123; error in print(\"Completed with an error: \\(error.localizedDescription)\") &#125;) .disposed(by: disposeBag) è®¢é˜…æä¾›äº†ä¸€ä¸ªCompletableEventæšä¸¾ï¼Œå¯ä»¥æ˜¯.completedè¡¨ç¤ºæ²¡æœ‰é”™è¯¯çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯.errorã€‚åœ¨ç¬¬ä¸€ä¸ªäº‹ä»¶ä¹‹åï¼Œä¸ä¼šå†å‘ç”Ÿè¿›ä¸€æ­¥çš„äº‹ä»¶ MaybeMaybeå¯èƒ½æ˜¯ä¸€ç§Observableçš„å˜ä½“ï¼Œåœ¨Singleå’ŒCompletableçš„ä¹‹é—´ã€‚å®ƒæ—¢å¯ä»¥é‡Šæ”¾å•ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯ä»¥é‡Šæ”¾completedå…ƒç´ ï¼Œä¹Ÿå¯ä»¥é‡Šæ”¾ä¸€ä¸ªé”™è¯¯. å‘å‡ºä¸€ä¸ªcompletedäº‹ä»¶ï¼Œä¸€ä¸ªå…ƒç´ æˆ–ä¸€ä¸ªé”™è¯¯ ä¸å…±äº«å‰¯ä½œç”¨ æ‚¨å¯ä»¥ä½¿ç”¨Maybeæ¥æ¨¡æ‹Ÿä»»ä½•å¯ä»¥é‡Šæ”¾å…ƒç´ çš„æ“ä½œï¼Œä½†æ˜¯ä¸ä¸€å®šè¦é‡Šæ”¾ä¸€ä¸ªå…ƒç´ ã€‚ åˆ›å»º Maybeåˆ›å»ºMaybeç±»ä¼¼äºåˆ›å»ºä¸€ä¸ªObservableã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­å°±æ˜¯è¿™æ ·çš„: 123456789101112131415func generateString() -&gt; Maybe&lt;String&gt; &#123; return Maybe&lt;String&gt;.create &#123; maybe in maybe(.success(\"RxSwift\")) // OR maybe(.completed) // OR maybe(.error(error)) return Disposables.create &#123;&#125; &#125;&#125; ä¹‹åä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä½¿ç”¨å®ƒ: 123456789101112generateString() .subscribe &#123; maybe in switch maybe &#123; case .success(let element): print(\"Completed with element \\(element)\") case .completed: print(\"Completed with no element\") case .error(let error): print(\"Completed with an error \\(error.localizedDescription)\") &#125; &#125; .disposed(by: disposeBag) æˆ–è€…é€šè¿‡ä½¿ç”¨subscribe(onSuccess:onError:)å¦‚ä¸‹: 1234567891011generateString() .subscribe(onSuccess: &#123; element in print(\"Completed with element \\(element)\") &#125;, onError: &#123; error in print(\"Completed with an error \\(error.localizedDescription)\") &#125;, onCompleted: &#123; print(\"Completed with no element\") &#125;) .disposed(by: disposeBag) åœ¨åŸå§‹çš„Observableåºåˆ—ä¸­ä½¿ç”¨. asMaybe()ä¹Ÿå¯ä»¥å°†å…¶è½¬æ¢ä¸ºMaybe. RxCocoa ç‰¹å¾Driverè¿™æ˜¯æœ€å¤æ‚çš„ç‰¹å¾ã€‚å®ƒçš„ç›®çš„æ˜¯æä¾›ä¸€ç§ç›´è§‚çš„æ–¹å¼æ¥åœ¨UIå±‚ä¸­ç¼–å†™å“åº”æ€§ä»£ç ï¼Œæˆ–è€…åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæ‚¨æƒ³è¦ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå»ºæ¨¡ Drivingçš„æ•°æ®æµã€‚ ä¸èƒ½é”™è¯¯ ä¸»è°ƒåº¦å™¨ä¸Šçš„è§‚å¯Ÿ å…±äº«å‰¯ä½œç”¨ (shareReplayLatestWhileConnected) ä¸ºä»€ä¹ˆå®ƒè¢«å‘½åä¸º Driverå®ƒçš„ç›®æ ‡ç”¨ä¾‹æ˜¯å¯¹é©±åŠ¨åº”ç”¨ç¨‹åºçš„åºåˆ—è¿›è¡Œå»ºæ¨¡ã€‚ å¦‚ é©±åŠ¨ UI ä»CoreData model ä½¿ç”¨æ¥è‡ªå…¶ä»–UIå…ƒç´ (ç»‘å®šçš„)çš„å€¼æ¥é©±åŠ¨UIâ€¦ ä¸æ­£å¸¸çš„æ“ä½œç³»ç»Ÿé©±åŠ¨ä¸€æ ·ï¼Œå¦‚æœå‡ºç°åºåˆ—é”™è¯¯ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°†åœæ­¢å“åº”ç”¨æˆ·è¾“å…¥ã€‚ åŒæ ·é‡è¦çš„æ˜¯ï¼Œè¿™äº›å…ƒç´ åœ¨ä¸»çº¿ç¨‹ä¸Šè¢«è§‚å¯Ÿåˆ°ï¼Œå› ä¸ºUIå…ƒç´ å’Œåº”ç”¨ç¨‹åºé€»è¾‘é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å¦å¤–ï¼Œä¸€ä¸ªDriveræ„å»ºä¸€ä¸ªobservableåºåˆ—ï¼Œå¹¶å…±äº«å‰¯ä½œç”¨ã€‚ å¦‚ å®é™…ä½¿ç”¨çš„ä¾‹å­è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆå­¦è€…ä¾‹å­. 12345678910111213141516let results = query.rx.text .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest &#123; query in fetchAutoCompleteItems(query) &#125;results .map &#123; \"\\($0.count)\" &#125; .bind(to: resultCount.rx.text) .disposed(by: disposeBag)results .bind(to: resultsTableView.rx.items(cellIdentifier: \"Cell\")) &#123; (_, result, cell) in cell.textLabel?.text = \"\\(result)\" &#125; .disposed(by: disposeBag) è¿™æ®µä»£ç çš„æ„å›¾æ˜¯: èŠ‚æµç”¨æˆ·è¾“å…¥ è¿æ¥æœåŠ¡å™¨ï¼Œè·å–ç”¨æˆ·ç»“æœåˆ—è¡¨(æ¯æ¬¡æŸ¥è¯¢ä¸€æ¬¡) å°†ç»“æœç»‘å®šåˆ°ä¸¤ä¸ªUIå…ƒç´ :ç»“æœè¡¨è§†å›¾å’Œä¸€ä¸ªæ˜¾ç¤ºç»“æœæ•°é‡çš„æ ‡ç­¾ é‚£ä¹ˆï¼Œè¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å‘¢?: å¦‚æœfetchAutoCompleteItemsobservableåºåˆ—é”™è¯¯(è¿æ¥å¤±è´¥æˆ–è§£æé”™è¯¯)ï¼Œè¿™ä¸ªé”™è¯¯å°†è§£ç»‘æ‰€æœ‰çš„ä¸œè¥¿ï¼ŒUIå°†ä¸ä¼šå¯¹æ–°çš„æŸ¥è¯¢ä½œå‡ºä»»ä½•å“åº”. å¦‚æœfetchAutoCompleteItemsè¿”å›ä¸€äº›åå°çº¿ç¨‹çš„ç»“æœï¼Œç»“æœå°†è¢«ç»‘å®šåˆ°åå°çº¿ç¨‹çš„UIå…ƒç´ ï¼Œè¿™äº›å…ƒç´ å¯èƒ½å¯¼è‡´éç¡®å®šæ€§å´©æºƒ. ç»“æœè¢«ç»‘å®šåˆ°ä¸¤ä¸ªUIå…ƒç´ ï¼Œè¿™æ„å‘³ç€å¯¹äºæ¯ä¸ªç”¨æˆ·æŸ¥è¯¢ï¼Œå°†åˆ›å»ºä¸¤ä¸ªHTTPè¯·æ±‚ï¼Œç”¨äºæ¯ä¸ªUIå…ƒç´ ï¼Œè¿™ä¸æ˜¯é¢„æœŸçš„è¡Œä¸º. æ›´åˆé€‚çš„ä»£ç ç‰ˆæœ¬åº”è¯¥æ˜¯è¿™æ ·çš„: 1234567891011121314151617181920let results = query.rx.text .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest &#123; query in fetchAutoCompleteItems(query) .observeOn(MainScheduler.instance) // åœ¨MainSchedulerè¿”å›ç»“æœ .catchErrorJustReturn([]) // åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä¼šå¤„ç†é”™è¯¯ &#125; .shareReplay(1) // HTTPè¯·æ±‚è¢«å…±äº«ï¼Œç»“æœè¢«é‡æ–°æ’­æ”¾ç»™æ‰€æœ‰UIå…ƒç´  //results .map &#123; \"\\($0.count)\" &#125; .bind(to: resultCount.rx.text) .disposed(by: disposeBag)results .bind(to: resultsTableView.rx.items(cellIdentifier: \"Cell\")) &#123; (_, result, cell) in cell.textLabel?.text = \"\\(result)\" &#125; .disposed(by: disposeBag) ç¡®ä¿åœ¨å¤§å‹ç³»ç»Ÿä¸­æ­£ç¡®åœ°å¤„ç†æ‰€æœ‰è¿™äº›éœ€æ±‚æ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ï¼Œä½†æ˜¯ä½¿ç”¨ç¼–è¯‘å™¨å’Œç‰¹æ€§æ¥è¯æ˜è¿™äº›éœ€æ±‚æ˜¯å¯ä»¥å®ç°çš„ï¼Œè¿™æ˜¯ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•. ä¸‹é¢çš„ä»£ç çœ‹èµ·æ¥å‡ ä¹æ˜¯ä¸€æ ·çš„: 1234567891011121314151617let results = query.rx.text.asDriver() // è¿™å°†ä¸€ä¸ªæ­£å¸¸çš„åºåˆ—è½¬æ¢ä¸ºä¸€ä¸ª`Driver`åºåˆ—. .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest &#123; query in fetchAutoCompleteItems(query) .asDriver(onErrorJustReturn: []) // æ„å»ºå™¨åªéœ€è¦çŸ¥é“åœ¨å‘ç”Ÿé”™è¯¯æ—¶éœ€è¦è¿”å›ä»€ä¹ˆä¿¡æ¯. &#125;results .map &#123; \"\\($0.count)\" &#125; .drive(resultCount.rx.text) // å¦‚æœæœ‰ä¸€ä¸ª`drive`æ–¹æ³•å¯ç”¨ï¼Œè€Œä¸æ˜¯bindTo, .disposed(by: disposeBag) // è¿™æ„å‘³ç€ç¼–è¯‘å™¨å·²ç»è¯æ˜äº†æ‰€æœ‰å±æ€§éƒ½æ˜¯æ»¡æ„çš„ //results .drive(resultsTableView.rx.items(cellIdentifier: \"Cell\")) &#123; (_, result, cell) in cell.textLabel?.text = \"\\(result)\" &#125; .disposed(by: disposeBag) é‚£ä¹ˆè¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ? ç¬¬ä¸€ä¸ªasDriveræ–¹æ³•å°†ControlPropertyç‰¹å¾è½¬æ¢ä¸ºDriverç‰¹å¾ã€‚ 1query.rx.text.asDriver() è¯·æ³¨æ„ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…éœ€è¦åšã€‚Driveræ‹¥æœ‰ControlPropertyç‰¹æ€§çš„æ‰€æœ‰å±æ€§ï¼Œå†åŠ ä¸Šä¸€äº›å±æ€§ã€‚æ½œåœ¨çš„å¯è§‚å¯Ÿåºåˆ—è¢«åŒ…è£…æˆä¸€ä¸ªDriverç‰¹å¾ï¼Œå°±æ˜¯è¿™æ ·ã€‚ ç¬¬äºŒä¸ªå˜åŒ–æ˜¯: 1.asDriver(onErrorJustReturn: []) ä»»ä½•observableåºåˆ—éƒ½å¯ä»¥è½¬æ¢ä¸ºDriverç‰¹æ€§ï¼Œåªè¦å®ƒæ»¡è¶³3ä¸ªå±æ€§: ä¸èƒ½é”™è¯¯ åœ¨ä¸»è°ƒåº¦å™¨ä¸Šè§‚å¯Ÿ å…±äº«å‰¯ä½œç”¨(shareReplayLatestWhileConnected) é‚£ä¹ˆå¦‚ä½•ç¡®ä¿è¿™äº›å±æ€§å¾—åˆ°æ»¡è¶³å‘¢?åªè¦ä½¿ç”¨æ™®é€šçš„Rxæ“ä½œç¬¦ã€‚asDriver(onErrorJustReturn: [])ç›¸å½“äºä¸‹é¢çš„ä»£ç ã€‚ 12345let safeSequence = xs .observeOn(MainScheduler.instance) // åœ¨ä¸»è°ƒåº¦å™¨ä¸Šè§‚å¯Ÿäº‹ä»¶ .catchErrorJustReturn(onErrorJustReturn) // ä¸èƒ½é”™è¯¯ .shareReplayLatestWhileConnected() // å‰¯ä½œç”¨åˆ†äº«return Driver(raw: safeSequence) // åŒ…èµ·æ¥ æœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯ä½¿ç”¨driveï¼Œè€Œä¸æ˜¯ä½¿ç”¨bindToã€‚ driveåªåœ¨Driverç‰¹æ€§ä¸Šå®šä¹‰ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨åœ¨ä»£ç çš„æŸä¸ªåœ°æ–¹çœ‹åˆ°driveï¼Œobservableåºåˆ—æ°¸è¿œä¸ä¼šå‡ºé”™ï¼Œå¹¶ä¸”å®ƒåœ¨ä¸»çº¿ç¨‹ä¸Šè§‚å¯Ÿåˆ°ï¼Œè¿™å¯¹äºç»‘å®šåˆ°UIå…ƒç´ æ˜¯å®‰å…¨çš„ã€‚ ä½†æ˜¯è¯·æ³¨æ„ï¼Œä»ç†è®ºä¸Šè®²ï¼Œæœ‰äººä»ç„¶å¯ä»¥å®šä¹‰ä¸€ä¸ªdriveæ–¹æ³•æ¥ä½¿ç”¨ObservableTypeæˆ–å…¶ä»–æ¥å£ï¼Œå› æ­¤ä¸ºäº†è·å¾—é¢å¤–çš„å®‰å…¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„å®šä¹‰let results: Driver&lt;[Results]&gt; = ...ã€‚åœ¨ç»‘å®šåˆ°UIå…ƒç´ ä¹‹å‰ï¼Œå¯¹äºå®Œæ•´çš„è¯æ˜æ˜¯å¿…è¦çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ç•™ç»™è¯»è€…æ¥å†³å®šè¿™æ˜¯å¦æ˜¯ä¸€ä¸ªç°å®çš„åœºæ™¯ã€‚ ControlProperty / ControlEvent ä¸èƒ½é”™è¯¯ åœ¨ä¸»è°ƒåº¦å™¨ä¸Šè¿›è¡Œè®¢é˜… ä¸»è°ƒåº¦å™¨ä¸Šçš„è§‚å¯Ÿ å…±äº«å‰¯ä½œç”¨","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift è°ƒåº¦å™¨","slug":"RxSwift-Schedulers","date":"2017-10-27T01:56:45.000Z","updated":"2020-07-25T02:57:18.162Z","comments":true,"path":"2017/10/27/RxSwift-Schedulers/","link":"","permalink":"https://jigangduan.github.io/2017/10/27/RxSwift-Schedulers/","excerpt":"è°ƒåº¦å™¨ ä¸²è¡Œå’Œå¹¶è¡Œè°ƒåº¦å™¨ å®šåˆ¶çš„è°ƒåº¦å™¨ å†…ç½®çš„è°ƒåº¦å™¨","text":"è°ƒåº¦å™¨ ä¸²è¡Œå’Œå¹¶è¡Œè°ƒåº¦å™¨ å®šåˆ¶çš„è°ƒåº¦å™¨ å†…ç½®çš„è°ƒåº¦å™¨ è°ƒåº¦å™¨æŠ½è±¡å‡ºæ‰§è¡Œå·¥ä½œçš„æœºåˆ¶. æ‰§è¡Œå·¥ä½œçš„ä¸åŒæœºåˆ¶åŒ…æ‹¬å½“å‰çº¿ç¨‹ã€è°ƒåº¦é˜Ÿåˆ—ã€æ“ä½œé˜Ÿåˆ—ã€æ–°çº¿ç¨‹ã€çº¿ç¨‹æ± å’Œè¿è¡Œå¾ªç¯. æœ‰ä¸¤ä¸ªä¸»è¦çš„æ“ä½œç¬¦ä¸è°ƒåº¦å™¨æœ‰å…³ï¼ŒobserveOnå’ŒsubscribeOn. å¦‚æœæ‚¨æƒ³åœ¨ä¸åŒçš„è°ƒåº¦å™¨ä¸Šæ‰§è¡Œå·¥ä½œï¼Œåªéœ€ä½¿ç”¨observeOn(scheduler)æ“ä½œç¬¦. ä½ é€šå¸¸ä¼šæ¯”subscribeOnæ›´é¢‘ç¹åœ°ä½¿ç”¨observeOn. å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šobserveOnï¼Œé‚£ä¹ˆå°†åœ¨ç”Ÿæˆçš„ä»»ä½•çº¿ç¨‹/è°ƒåº¦å™¨ä¸Šæ‰§è¡Œå·¥ä½œ. ä½¿ç”¨observeOnæ“ä½œç¬¦çš„ä¾‹å­: 123456789sequence1 .observeOn(backgroundScheduler) .map &#123; n in print(&quot;This is performed on the background scheduler&quot;) &#125; .observeOn(MainScheduler.instance) .map &#123; n in print(&quot;This is performed on the main scheduler&quot;) &#125; å¦‚æœæ‚¨æƒ³è¦å¯åŠ¨åºåˆ—ç”Ÿæˆ(subscribeæ–¹æ³•)å¹¶åœ¨ç‰¹å®šçš„è°ƒåº¦å™¨ä¸Šè°ƒç”¨å¤„ç†ï¼Œè¯·ä½¿ç”¨subscribeOn(scheduler). å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šsubscribeOnï¼Œåˆ™subscribeé—­åŒ…(é€šè¿‡Observable.createçš„é—­åŒ…)å°†åœ¨åŒä¸€çº¿ç¨‹/è°ƒåº¦å™¨ä¸Šè°ƒç”¨ï¼Œåœ¨subscribe(onNext:) æˆ– subscribeè¢«è°ƒç”¨. å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šsubscribeOnï¼Œåˆ™disposeæ–¹æ³•å°†åœ¨å¯åŠ¨å¤„ç†çš„åŒä¸€çº¿ç¨‹/è°ƒåº¦å™¨ä¸Šè°ƒç”¨ã€‚. ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœæ²¡æœ‰é€‰æ‹©æ˜¾å¼è°ƒåº¦å™¨ï¼Œè¿™äº›æ–¹æ³•å°†åœ¨å½“å‰çº¿ç¨‹/è°ƒåº¦å™¨ä¸­è°ƒç”¨. ä¸²è¡Œå’Œå¹¶è¡Œè°ƒåº¦å™¨å› ä¸ºè°ƒåº¦å™¨ç¡®å®å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œå¹¶ä¸”æ‰€æœ‰è½¬æ¢åºåˆ—çš„æ“ä½œç¬¦éƒ½éœ€è¦ä¿ç•™é¢å¤–çš„éšå¼ä¿è¯ï¼Œæ‰€ä»¥æ‚¨è¦åˆ›å»ºä»€ä¹ˆæ ·çš„è°ƒåº¦ç¨‹åºæ˜¯å¾ˆé‡è¦çš„ã€‚ å¦‚æœè°ƒåº¦å™¨æ˜¯å¹¶å‘çš„ï¼ŒRxçš„observeOnå’ŒsubscribeOnæ“ä½œç¬¦å°†ç¡®ä¿æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯å®Œç¾çš„. å¦‚æœæ‚¨ä½¿ç”¨çš„è°ƒåº¦å™¨ï¼ŒRxå¯ä»¥è¯æ˜æ˜¯ä¸²è¡Œçš„ï¼Œå®ƒå°†èƒ½å¤Ÿæ‰§è¡Œé¢å¤–çš„ä¼˜åŒ–. åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒåªå¯¹åˆ†æ´¾é˜Ÿåˆ—è°ƒåº¦å™¨æ‰§è¡Œè¿™äº›ä¼˜åŒ–. åœ¨ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—è°ƒåº¦å™¨çš„æƒ…å†µä¸‹ï¼ŒobserveOnä»…å¯¹ä¸€ä¸ªç®€å•çš„dispatch_asyncè°ƒç”¨è¿›è¡Œäº†ä¼˜åŒ–. å®šåˆ¶çš„è°ƒåº¦å™¨é™¤äº†å½“å‰çš„è°ƒåº¦å™¨ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ç¼–å†™è‡ªå·±çš„è°ƒåº¦å™¨. å¦‚æœæ‚¨åªæ˜¯æƒ³æè¿°è°éœ€è¦ç«‹å³æ‰§è¡Œå·¥ä½œï¼Œæ‚¨å¯ä»¥é€šè¿‡å®ç°ImmediateScheduleråè®®æ¥åˆ›å»ºè‡ªå·±çš„è°ƒåº¦å™¨. 123public protocol ImmediateScheduler &#123; func schedule&lt;StateType&gt;(state: StateType, action: (/*ImmediateScheduler,*/ StateType) -&gt; RxResult&lt;Disposable&gt;) -&gt; RxResult&lt;Disposable&gt;&#125; å¦‚æœæ‚¨æƒ³è¦åˆ›å»ºä¸€ä¸ªæ”¯æŒåŸºäºæ—¶é—´çš„æ“ä½œçš„æ–°è°ƒåº¦ç¨‹åºï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å®ç°Scheduleråè®®: 12345678910public protocol Scheduler: ImmediateScheduler &#123; associatedtype TimeInterval associatedtype Time var now : Time &#123; get &#125; func scheduleRelative&lt;StateType&gt;(state: StateType, dueTime: TimeInterval, action: (StateType) -&gt; RxResult&lt;Disposable&gt;) -&gt; RxResult&lt;Disposable&gt;&#125; å¦‚æœè°ƒåº¦å™¨åªæœ‰å‘¨æœŸæ€§è°ƒåº¦åŠŸèƒ½ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€šè¿‡å®ç°PeriodicScheduleråè®®é€šçŸ¥Rx: 123public protocol PeriodicScheduler : Scheduler &#123; func schedulePeriodic&lt;StateType&gt;(state: StateType, startAfter: TimeInterval, period: TimeInterval, action: (StateType) -&gt; StateType) -&gt; RxResult&lt;Disposable&gt;&#125; å¦‚æœè°ƒåº¦ç¨‹åºä¸æ”¯æŒPeriodicSchedulingåŠŸèƒ½ï¼Œé‚£ä¹ˆRxå°†ä¼šé€æ˜åœ°æ¨¡æ‹Ÿå‘¨æœŸæ€§è°ƒåº¦. å†…ç½®çš„è°ƒåº¦å™¨Rxå¯ä»¥ä½¿ç”¨æ‰€æœ‰ç±»å‹çš„è°ƒåº¦ç¨‹åºï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥æ‰§è¡Œä¸€äº›é¢å¤–çš„ä¼˜åŒ–ï¼Œå¦‚æœå®ƒèƒ½å¤Ÿè¯æ˜è°ƒåº¦ç¨‹åºæ˜¯ä¸²è¡Œçš„. è¿™äº›æ˜¯å½“å‰æ”¯æŒçš„è°ƒåº¦å™¨: CurrentThreadScheduler (ä¸²è¡Œè°ƒåº¦å™¨)åœ¨å½“å‰çº¿ç¨‹ä¸Šè°ƒåº¦å·¥ä½œå•å…ƒ.è¿™æ˜¯ç”¨äºç”Ÿæˆå…ƒç´ çš„æ“ä½œç¬¦çš„é»˜è®¤è°ƒåº¦å™¨. è¿™ä¸ªè°ƒåº¦å™¨æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºâ€trampoline schedulerâ€. å¦‚æœCurrentThreadScheduler.instance.schedule(state) { }ç¬¬ä¸€æ¬¡åœ¨ä¸€äº›çº¿ç¨‹è¢«è°ƒç”¨,é¢„å®šè¡Œä¸ºå°†ç«‹å³æ‰§è¡Œ,å°†ä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„é˜Ÿåˆ—,æ‰€æœ‰é€’å½’åœ°è¡ŒåŠ¨å°†ä¸´æ—¶åŠ å…¥é˜Ÿåˆ—. å¦‚æœè°ƒç”¨å †æ ˆä¸Šçš„ä¸€äº›çˆ¶æ¡†æ¶å·²ç»è¿è¡Œçš„CurrentThreadScheduler.instance.schedule(state) { },é¢„å®šè¡Œä¸ºå°†å…¥é˜Ÿå’Œå½“å‰è¿è¡Œæ—¶æ‰§è¡Œçš„è¡ŒåŠ¨å’Œå®Œæˆæ‰€æœ‰å…ˆå‰å…¥é˜Ÿæ“ä½œ. MainScheduler (ä¸²è¡Œè°ƒåº¦å™¨)æŠ½è±¡å·¥ä½œéœ€è¦åœ¨MainThreadä¸Šæ‰§è¡Œã€‚å¦‚æœscheduleæ–¹æ³•æ˜¯ä»ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨æ²¡æœ‰è°ƒåº¦çš„æƒ…å†µä¸‹ç«‹å³æ‰§è¡Œè¯¥æ“ä½œ. è¿™ä¸ªè°ƒåº¦å™¨é€šå¸¸ç”¨äºæ‰§è¡ŒUIå·¥ä½œ. SerialDispatchQueueScheduler (ä¸²è¡Œè°ƒåº¦å™¨)å¯¹éœ€è¦åœ¨ç‰¹å®šdispatch_queue_tä¸Šæ‰§è¡Œçš„æŠ½è±¡å·¥ä½œã€‚å®ƒå°†ç¡®ä¿å³ä½¿ä¸€ä¸ªå¹¶å‘è°ƒåº¦é˜Ÿåˆ—è¢«ä¼ é€’ï¼Œå®ƒä¹Ÿä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªä¸²è¡ŒåŒ–é˜Ÿåˆ—. ä¸²è¡Œè°ƒåº¦ç¨‹åºæ”¯æŒå¯¹observeOnçš„æŸäº›ä¼˜åŒ–. ä¸»è¦çš„è°ƒåº¦å™¨æ˜¯SerialDispatchQueueSchedulerçš„ä¸€ä¸ªå®ä¾‹`. ConcurrentDispatchQueueScheduler (å¹¶è¡Œè°ƒåº¦å™¨)å¯¹éœ€è¦åœ¨ç‰¹å®šdispatch_queue_tä¸Šæ‰§è¡Œçš„æŠ½è±¡å·¥ä½œã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ï¼Œå®ƒä¸åº”è¯¥å¼•èµ·ä»»ä½•é—®é¢˜. å½“éœ€è¦åœ¨åå°æ‰§è¡ŒæŸäº›å·¥ä½œæ—¶ï¼Œè¿™ä¸ªè°ƒåº¦å™¨æ˜¯åˆé€‚çš„. OperationQueueScheduler (å¹¶è¡Œè°ƒåº¦å™¨)æŠ½è±¡éœ€è¦åœ¨ç‰¹å®šçš„NSOperationQueueä¸Šæ‰§è¡Œçš„å·¥ä½œ. æ­¤è°ƒåº¦å™¨é€‚åˆæƒ…å†µæœ‰ä¸€äº›å¤§çš„å·¥ä½œéœ€è¦åœ¨åå°æ‰§è¡Œçš„,å¹¶ä¸”ä½ æƒ³è¦è°ƒæ•´å¹¶å‘å¤„ç†ä½¿ç”¨maxConcurrentOperationCount.","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift èƒŒåçš„æ•°å­¦","slug":"RxSwift-MathBehindRx","date":"2017-10-27T01:39:57.000Z","updated":"2020-07-25T02:57:18.162Z","comments":true,"path":"2017/10/27/RxSwift-MathBehindRx/","link":"","permalink":"https://jigangduan.github.io/2017/10/27/RxSwift-MathBehindRx/","excerpt":"RxèƒŒåçš„æ•°å­¦è§‚å¯Ÿè€…å’Œè¿­ä»£å™¨/è¿­ä»£å™¨/ç”Ÿæˆå™¨/åºåˆ—ä¹‹é—´çš„äºŒå…ƒæ€§","text":"RxèƒŒåçš„æ•°å­¦è§‚å¯Ÿè€…å’Œè¿­ä»£å™¨/è¿­ä»£å™¨/ç”Ÿæˆå™¨/åºåˆ—ä¹‹é—´çš„äºŒå…ƒæ€§ åœ¨è§‚å¯Ÿè€…å’Œç”Ÿæˆå™¨æ¨¡å¼ä¹‹é—´æœ‰ä¸€ä¸ªå¯¹å¶æ€§ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»å¼‚æ­¥å›è°ƒä¸–ç•Œè¿‡æ¸¡åˆ°åºåˆ—è½¬æ¢çš„åŒæ­¥ä¸–ç•Œ. ç®€è€Œè¨€ä¹‹ï¼Œè¿­ä»£å™¨å’Œè§‚å¯Ÿè€…æ¨¡å¼éƒ½æè¿°äº†åºåˆ—ã€‚ä¸ºä»€ä¹ˆè¿­ä»£å™¨å®šä¹‰ä¸€ä¸ªåºåˆ—æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½†æ˜¯è§‚å¯Ÿè€…ç¨å¾®å¤æ‚ä¸€ç‚¹. ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œä¸éœ€è¦å¤ªå¤šçš„æ•°å­¦çŸ¥è¯†ã€‚å‡è®¾åœ¨ç»™å®šçš„æ—¶é—´ï¼Œæ‚¨æ­£åœ¨è§‚å¯Ÿé¼ æ ‡å…‰æ ‡åœ¨å±å¹•ä¸Šçš„ä½ç½®ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº›é¼ æ ‡ä½ç½®å½¢æˆäº†ä¸€ä¸ªåºåˆ—ã€‚è¿™æ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„åºåˆ—. å¯ä»¥è®¿é—®ä¸€ä¸ªåºåˆ—çš„ä¸¤ç§åŸºæœ¬æ–¹æ³•: æ¨(Push)æ¥å£ - è§‚å¯Ÿè€…(è§‚å¯Ÿåˆ°çš„å…ƒç´ éšç€æ—¶é—´çš„æ¨ç§»å½¢æˆä¸€ä¸ªåºåˆ—) æ‹‰(Pull)æ¥å£-è¿­ä»£å™¨/æšä¸¾å™¨/ç”Ÿæˆå™¨ ä½ ä»¬ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªè§†é¢‘ä¸­çœ‹åˆ°æ›´æ­£å¼çš„è§£é‡Š: ä¸“å®¶:Erik Meijerå’ŒErik Meijerâ€”â€”.NETå“åº”æ¡†æ¶(Rx)çš„å†…éƒ¨(è§†é¢‘) å“åº”å¼ç¼–ç¨‹æ¦‚è¿°(æ¥è‡ªNetflixçš„Jafar Husain)","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift çƒ­&å†·Observables","slug":"RxSwift-HotAndColdObservables","date":"2017-10-27T01:14:19.000Z","updated":"2020-07-25T02:57:18.162Z","comments":true,"path":"2017/10/27/RxSwift-HotAndColdObservables/","link":"","permalink":"https://jigangduan.github.io/2017/10/27/RxSwift-HotAndColdObservables/","excerpt":"çƒ­&amp;å†· Observables","text":"çƒ­&amp;å†· Observables å»ºè®®æ›´å¤šåœ°æŠŠå®ƒçœ‹ä½œæ˜¯åºåˆ—çš„å±æ€§è€Œä¸æ˜¯å•ç‹¬çš„ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±ç›¸åŒçš„æŠ½è±¡æ¥è¡¨ç¤ºçš„ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç¬¦åˆObservableåºåˆ—. è¿™æ˜¯ReactiveX.ioçš„ä¸€ä¸ªå®šä¹‰ ä¸€ä¸ªObservableä»€ä¹ˆæ—¶å€™å¼€å§‹å‘å°„å®ƒçš„åºåˆ—?è¿™å–å†³äºè¿™ä¸ªObservableã€‚ä¸€ä¸ªâ€œçƒ­â€çš„Observableå¯ä»¥åœ¨å®ƒè¢«åˆ›å»ºçš„æ—¶å€™å°±å¼€å§‹å‘å°„ï¼Œæ‰€ä»¥ä»»ä½•åæ¥è®¢é˜…è¿™ä¸ªObservableçš„è§‚å¯Ÿè€…éƒ½å¯ä»¥å¼€å§‹åœ¨ä¸­é—´çš„æŸä¸ªåœ°æ–¹è§‚å¯Ÿè¿™ä¸ªåºåˆ—ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€ä¸ªâ€œå†·â€çš„Observableï¼Œåœ¨å®ƒå¼€å§‹å‘å‡ºå…ƒç´ ä¹‹å‰ï¼Œç­‰å¾…è§‚å¯Ÿè€…è®¢é˜…å®ƒï¼Œè¿™æ ·è§‚å¯Ÿè€…å°±èƒ½ä¿è¯ä»ä¸€å¼€å§‹å°±çœ‹åˆ°æ•´ä¸ªåºåˆ—. çƒ­ Observables å†· observables â€¦ æ˜¯åºåˆ— â€¦ æ˜¯åºåˆ— ä½¿ç”¨èµ„æº(â€œç”Ÿäº§çƒ­â€)æ— è®ºæ˜¯å¦æœ‰ä»»ä½•è§‚å¯Ÿè€…è®¢é˜…. åœ¨è§‚å¯Ÿè€…è®¢é˜…ä¹‹å‰ä¸è¦ä½¿ç”¨èµ„æº(ä¸è¦äº§ç”Ÿçƒ­). å˜é‡/å±æ€§/å¸¸é‡ï¼Œç‚¹å‡»åæ ‡ï¼Œé¼ æ ‡åæ ‡ï¼ŒUIæ§åˆ¶å€¼ï¼Œå½“å‰æ—¶é—´ å¼‚æ­¥æ“ä½œã€HTTPè¿æ¥ã€TCPè¿æ¥ã€æµ é€šå¸¸åŒ…å« ~ N ä¸ªå…ƒç´  é€šå¸¸åŒ…å«~ 1ä¸ªå…ƒç´  ä¸ç®¡æ˜¯å¦æœ‰è§‚å¯Ÿè€…è®¢é˜…ï¼Œåºåˆ—å…ƒç´ éƒ½æ˜¯è¢«ç”Ÿæˆçš„. åªæœ‰å½“æœ‰è®¢é˜…çš„è§‚å¯Ÿè€…æ‰ä¼šäº§ç”Ÿåºåˆ—å…ƒç´ . åºåˆ—è®¡ç®—èµ„æºé€šå¸¸åœ¨æ‰€æœ‰å·²è®¢é˜…çš„è§‚å¯Ÿè€…ä¹‹é—´å…±äº«. åºåˆ—è®¡ç®—èµ„æºé€šå¸¸åˆ†é…ç»™æ¯ä¸ªè®¢é˜…çš„è§‚å¯Ÿè€…. é€šå¸¸æœ‰çŠ¶æ€ é€šå¸¸æ— çŠ¶æ€","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift å…¥é—¨æŒ‡å—","slug":"RxSwift-GettingStarted","date":"2017-10-26T04:28:14.000Z","updated":"2020-07-25T02:57:18.162Z","comments":true,"path":"2017/10/26/RxSwift-GettingStarted/","link":"","permalink":"https://jigangduan.github.io/2017/10/26/RxSwift-GettingStarted/","excerpt":"RxSwiftè¯•å›¾ä¸ReactiveX.ioä¿æŒä¸€è‡´.åœ¨RxSwiftçš„æƒ…å†µä¸‹ï¼Œé€šç”¨è·¨å¹³å°çš„æ–‡æ¡£å’Œæ•™ç¨‹ä¹Ÿåº”è¯¥æ˜¯æœ‰æ•ˆçš„. Observablesåˆå«åºåˆ— Disposing Observableçš„éšå¼ä¿éšœ åˆ›é€ ä½ è‡ªå·±çš„ Observable (observableåºåˆ—) åˆ›é€ ä¸€ä¸ª Observable æ‰§è¡Œå·¥ä½œ å…±äº«è®¢é˜…å’ŒshareReplayæ“ä½œç¬¦ æ“ä½œç¬¦ Playgrounds è‡ªå®šä¹‰æ“ä½œç¬¦ é”™è¯¯å¤„ç† è°ƒè¯•ç¼–è¯‘é”™è¯¯ è°ƒè¯• è°ƒè¯•å†…å­˜æ³„æ¼ å¯ç”¨è°ƒè¯•æ¨¡å¼ KVO UIå±‚æç¤º HTTPè¯·æ±‚ RxDataSources Driver ç‰¹å¾: Driver, Single, Maybe, Completable ä¾‹å­","text":"RxSwiftè¯•å›¾ä¸ReactiveX.ioä¿æŒä¸€è‡´.åœ¨RxSwiftçš„æƒ…å†µä¸‹ï¼Œé€šç”¨è·¨å¹³å°çš„æ–‡æ¡£å’Œæ•™ç¨‹ä¹Ÿåº”è¯¥æ˜¯æœ‰æ•ˆçš„. Observablesåˆå«åºåˆ— Disposing Observableçš„éšå¼ä¿éšœ åˆ›é€ ä½ è‡ªå·±çš„ Observable (observableåºåˆ—) åˆ›é€ ä¸€ä¸ª Observable æ‰§è¡Œå·¥ä½œ å…±äº«è®¢é˜…å’ŒshareReplayæ“ä½œç¬¦ æ“ä½œç¬¦ Playgrounds è‡ªå®šä¹‰æ“ä½œç¬¦ é”™è¯¯å¤„ç† è°ƒè¯•ç¼–è¯‘é”™è¯¯ è°ƒè¯• è°ƒè¯•å†…å­˜æ³„æ¼ å¯ç”¨è°ƒè¯•æ¨¡å¼ KVO UIå±‚æç¤º HTTPè¯·æ±‚ RxDataSources Driver ç‰¹å¾: Driver, Single, Maybe, Completable ä¾‹å­ Observablesåˆå«åºåˆ—åŸºç¡€çŸ¥è¯†è§‚å¯Ÿè€…æ¨¡å¼(Observable&lt;Element&gt;åºåˆ—)å’Œæ™®é€šåºåˆ—(Sequence)çš„ç­‰ä»·æ€§æ˜¯ç†è§£Rxæœ€é‡è¦çš„ä¸œè¥¿ã€‚ æ¯ä¸€ä¸ªObservableåºåˆ—å°±åƒæ˜¯ä¸€ä¸ªåºåˆ—ã€‚Observable å¯¹æ¯” Swiftçš„ Sequenceçš„å…³é”®ä¼˜åŠ¿åœ¨äºï¼Œå®ƒè¿˜å¯ä»¥å¼‚æ­¥åœ°æ¥æ”¶å…ƒç´ ã€‚è¿™æ˜¯RxSwiftçš„æ ¸å¿ƒï¼Œè¿™é‡Œçš„æ–‡æ¡£æ˜¯å…³äºæˆ‘ä»¬å¦‚ä½•æ‰©å±•è¿™ä¸ªæƒ³æ³•çš„ã€‚ Observable(ObservableType) ç›¸å½“äº Sequence ObservableType.subscribe æ–¹æ³•æ˜¯ç›¸å½“äº Sequence.makeIterator æ–¹æ³•. è§‚å¯Ÿè€…(callback)éœ€è¦é€šè¿‡ObservableType.subscribeæ–¹æ³•æ¥æ”¶åºåˆ—å…ƒç´ ï¼Œè€Œä¸æ˜¯åœ¨è¿”å›çš„è¿­ä»£å™¨ä¸Šè°ƒç”¨next()ã€‚ åºåˆ—æ˜¯ä¸€ä¸ªç®€å•è€Œåˆç†Ÿæ‚‰çš„æ¦‚å¿µï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚ äººç±»æ˜¯æœ‰ç€å·¨å¤§è§†è§‰çº¹ç†çš„ç”Ÿç‰©ã€‚å½“æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°ä¸€ä¸ªæ¦‚å¿µæ—¶ï¼Œå®ƒå°±å®¹æ˜“å¤šäº†ã€‚ æˆ‘ä»¬å¯ä»¥ä»è¯•å›¾æ¨¡æ‹Ÿæ¯ä¸ªRxæ“ä½œç¬¦ä¸­çš„äº‹ä»¶çŠ¶æ€æœºåˆ°é«˜çº§åˆ«æ“ä½œï¼Œä»è€Œæå‡è®¸å¤šè®¤çŸ¥. å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨Rxï¼Œä½†åœ¨æ¨¡å‹å¼‚æ­¥ç³»ç»Ÿï¼Œè¿™å¯èƒ½æ„å‘³ç€æˆ‘ä»¬çš„ä»£ç ä¸­å……æ»¡äº†çŠ¶æ€æœºå’Œä¸´æ—¶çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿè€Œä¸æ˜¯æŠ½è±¡å‡ºæ¥. åˆ—è¡¨å’Œåºåˆ—å¯èƒ½æ˜¯æ•°å­¦å®¶å’Œç¨‹åºå‘˜å­¦ä¹ çš„ç¬¬ä¸€ä¸ªæ¦‚å¿µ. è¿™æ˜¯ä¸€ç³»åˆ—çš„æ•°å­—: 1--1--2--3--4--5--6--| // æ­£å¸¸ç»ˆæ­¢ å¦ä¸€ä¸ªåºåˆ—,å­—ç¬¦: 1--a--b--a--a--a---d---X // ç»ˆæ­¢åœ¨é”™è¯¯ä¸Š ä¸€äº›åºåˆ—æ˜¯æœ‰é™çš„ï¼Œè€Œå¦ä¸€äº›åˆ™æ˜¯æ— é™çš„ï¼Œå°±åƒä¸€ä¸ªæŒ‰é’®ç‚¹å‡»åºåˆ—: 1---tap-tap-------tap---&gt; è¿™äº›è¢«ç§°ä¸ºå¤§ç†çŸ³å›¾è¡¨ã€‚è¿˜æœ‰æ›´å¤šçš„å¤§ç†çŸ³å›¾è¡¨åœ¨ rxmarbles.com. å¦‚æœæˆ‘ä»¬æŠŠåºåˆ—è¯­æ³•æŒ‡å®šä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒçœ‹èµ·æ¥å°±åƒ: next* (error | completed)? æè¿°å¦‚ä¸‹: åºåˆ—å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªå…ƒç´ . ä¸€æ—¦æ¥æ”¶åˆ° error æˆ– completed çš„äº‹ä»¶, åºåˆ—å°±æ— æ³•ç”Ÿæˆä»»ä½•å…¶ä»–å…ƒç´ . Rxä¸­çš„åºåˆ—ç”±ä¸€ä¸ªpushæ¥å£(å³callback)æè¿°. 12345678910111213enum Event&lt;Element&gt; &#123; case next(Element) // åºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´  case error(Swift.Error) // åºåˆ—å¤±è´¥çš„é”™è¯¯ case completed // æˆåŠŸç»ˆæ­¢åºåˆ—&#125;class Observable&lt;Element&gt; &#123; func subscribe(_ observer: Observer&lt;Element&gt;) -&gt; Disposable&#125;protocol ObserverType &#123; func on(_ event: Event&lt;Element&gt;)&#125; å½“ä¸€ä¸ªåºåˆ—å‘é€completedæˆ–erroräº‹ä»¶æ—¶ï¼Œæ‰€æœ‰è®¡ç®—åºåˆ—å…ƒç´ çš„å†…éƒ¨èµ„æºå°†è¢«é‡Šæ”¾. è¦ç«‹å³å–æ¶ˆåºåˆ—å…ƒç´ å’Œé‡Šæ”¾èµ„æºçš„äº§ç”Ÿï¼Œè¯·åœ¨è¿”å›çš„è®¢é˜…ä¸­è°ƒç”¨dispose. å¦‚æœä¸€ä¸ªåºåˆ—åœ¨æœ‰é™çš„æ—¶é—´å†…ç»ˆæ­¢ï¼Œåˆ™ä¸è°ƒç”¨disposeæˆ–ä¸ä½¿ç”¨disposed(by: disposeBag)ä¸ä¼šé€ æˆä»»ä½•æ°¸ä¹…æ€§çš„èµ„æºæ³„æ¼ã€‚ä½†æ˜¯ï¼Œè¿™äº›èµ„æºå°†è¢«ä½¿ç”¨ï¼Œç›´åˆ°åºåˆ—å®Œæˆï¼Œè¦ä¹ˆå®Œæˆå…ƒç´ çš„ç”Ÿäº§ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ å¦‚æœä¸€ä¸ªåºåˆ—æ²¡æœ‰è‡ªåŠ¨ç»ˆæ­¢ï¼Œä¾‹å¦‚ä½¿ç”¨ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»çš„ç³»åˆ—ï¼Œèµ„æºå°†è¢«æ°¸ä¹…åœ°åˆ†é…ï¼Œé™¤éæ˜¯æ‰‹åŠ¨è°ƒç”¨disposeï¼Œè‡ªåŠ¨åœ°åœ¨disposeBagå†…ï¼Œä½¿ç”¨takeUntil æ“ä½œç¬¦,æˆ–è€…ä»¥å¦ä¸€ç§æ–¹å¼è¿›è¡Œæ“ä½œã€‚ ä½¿ç”¨disposeBagæˆ–takeUntilæ“ä½œç¬¦æ˜¯ä¸€ç§å¯é çš„æ–¹æ³•ï¼Œç¡®ä¿èµ„æºè¢«æ¸…ç†å¹²å‡€ã€‚æˆ‘ä»¬å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒä»¬,å³ä½¿åºåˆ—åœ¨æœ‰é™æ—¶é—´å†…ç»ˆæ­¢ å¦‚æœä½ å¥½å¥‡ä¸ºä»€ä¹ˆSwift.Errorä¸ä½¿ç”¨ä¸€èˆ¬çš„é”™è¯¯ç±»å‹ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è§£é‡Š. Disposingæœ‰ä¸€ç§é¢å¤–çš„æ–¹æ³•å¯ä»¥è¢«observedåºåˆ—ç»ˆæ­¢ã€‚å½“æˆ‘ä»¬å®Œæˆä¸€ä¸ªåºåˆ—ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦é‡Šæ”¾ åˆ†é…ç”¨æ¥è®¡ç®— å³å°†åˆ°æ¥çš„å…ƒç´ çš„æ‰€æœ‰èµ„æºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¢é˜…ä¸­è°ƒç”¨disposeã€‚ è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰intervalæ“ä½œç¬¦çš„ä¾‹å­. 123456789let scheduler = SerialDispatchQueueScheduler(qos: .default)let subscription = Observable&lt;Int&gt;.interval(0.3, scheduler: scheduler) .subscribe &#123; event in print(event) &#125;Thread.sleep(forTimeInterval: 2.0)subscription.dispose() å°†æ‰“å°: 123456012345 æ³¨æ„ï¼Œæ‚¨é€šå¸¸ä¸å¸Œæœ›æ‰‹åŠ¨è°ƒç”¨dispose;è¿™åªæ˜¯ä¸€ä¸ªæ•™è‚²çš„ä¾‹å­ã€‚æ‰‹åŠ¨è°ƒç”¨disposeé€šå¸¸æ˜¯ä¸€ç§ç³Ÿç³•çš„ä»£ç æ°”å‘³ã€‚æœ‰æ›´å¥½çš„æ–¹å¼æ¥å¤„ç†è®¢é˜…ï¼Œæ¯”å¦‚DisposeBagï¼Œæˆ–è€…takeUntilæ“ä½œç¬¦ï¼Œæˆ–è€…å…¶ä»–çš„ä¸€äº›æœºåˆ¶ã€‚ é‚£ä¹ˆï¼Œåœ¨æ‰§è¡Œäº†disposeè°ƒç”¨ä¹‹åï¼Œè¿™æ®µä»£ç å¯ä»¥æ‰“å°å‡ºä»€ä¹ˆä¸œè¥¿å—?ç­”æ¡ˆæ˜¯:è¿™å–å†³äº å¦‚æœ scheduler æ˜¯ä¸€ä¸ª ä¸²è¡Œè°ƒåº¦ç¨‹åºå™¨ (ex. MainScheduler) å¹¶ä¸” disposeè¢«è°ƒç”¨åœ¨ç›¸åŒçš„ä¸²è¡Œè°ƒåº¦ç¨‹åºå™¨, ç­”æ¡ˆæ˜¯no. å¦åˆ™å®ƒæ˜¯ yes. ä½ å¯ä»¥æ‰¾åˆ°æ›´å¤šå…³äºè°ƒåº¦å™¨çš„ä¿¡æ¯ è¿™é‡Œ. ä½ åªéœ€è¦å¹¶è¡Œåœ°è¿›è¡Œä¸¤ä¸ªè¿‡ç¨‹. ä¸€ä¸ªæ˜¯ç”Ÿäº§å…ƒç´  å¦ä¸€ç§æ˜¯å¤„ç†è®¢é˜… é—®é¢˜æ˜¯ä¸åŒçš„è°ƒåº¦å™¨åœ¨è¿™äº›ä¸åŒè¿‡ç¨‹ä¸­â€œä»€ä¹ˆä¸œè¥¿å¯ä»¥å°å‡ºæ¥?â€éƒ½æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ â€œåœ¨ä¸åŒçš„è°ƒåº¦ç¨‹åºä¸­ï¼Œè¿™äº›è¿‡ç¨‹æ˜¯ä¸åˆç†çš„ã€‚â€ å†æ¥å‡ ä¸ªä¾‹å­ (observeOn çš„è§£é‡Šåœ¨ è¿™é‡Œ). å¦‚æœæˆ‘ä»¬æœ‰ç±»ä¼¼çš„ä¸œè¥¿: 123456789let subscription = Observable&lt;Int&gt;.interval(0.3, scheduler: scheduler) .observeOn(MainScheduler.instance) .subscribe &#123; event in print(event) &#125;// ....subscription.dispose() // ä»ä¸»çº¿ç¨‹è°ƒç”¨ åœ¨disposeè°ƒç”¨è¿”å›ä¹‹åï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚è¿™æ˜¯ä¿è¯çš„. åŒæ—¶,åœ¨è¿™ç§æƒ…å†µä¸‹: 123456789let subscription = Observable&lt;Int&gt;.interval(0.3, scheduler: scheduler) .observeOn(serialScheduler) .subscribe &#123; event in print(event) &#125;// ...subscription.dispose() // æ‰§è¡Œåœ¨ç›¸åŒçš„`serialScheduler` åœ¨disposeè°ƒç”¨è¿”å›ä¹‹åï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚è¿™æ˜¯ä¿è¯çš„. Dispose BagsDispose bagså°±åƒRXçš„ARCè¡Œä¸º. å½“ä¸€ä¸ªDisposeBagè¢«é‡Šæ”¾æ—¶ï¼Œå®ƒå°†è°ƒç”¨dispose å¯¹æ¯ä¸€ä¸ªæ·»åŠ äº†disposablesé¡¹çš„è¿›è¡Œå¤„ç†. å®ƒæ²¡æœ‰disposeæ–¹æ³•ï¼Œå› æ­¤ä¸å…è®¸æ˜ç¡®åœ°æ˜¾å¼è°ƒç”¨ã€‚å¦‚æœéœ€è¦ç«‹å³è¿›è¡Œæ¸…ç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°bagã€‚ 1self.disposeBag = DisposeBag() è¿™å°†æ¸…é™¤æ—§çš„å¼•ç”¨ï¼Œå¹¶å¯¼è‡´èµ„æºçš„å¤„ç½®. If that explicit manual disposal is still wanted, use CompositeDisposable. It has the wanted behavior but once that dispose method is called, it will immediately dispose any newly added disposable. Take untilåœ¨deallocä¸­è‡ªåŠ¨å¤„ç†è®¢é˜…çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨takeUntilæ“ä½œç¬¦. 12345sequence .takeUntil(self.rx.deallocated) .subscribe &#123; print($0) &#125; Observableçš„éšå¼ä¿éšœè¿˜æœ‰ä¸€äº›é¢å¤–çš„ä¿è¯ï¼Œæ‰€æœ‰åºåˆ—çš„ç”Ÿäº§è€…(Observables)éƒ½å¿…é¡»éµå®ˆ. å®ƒä»¬åœ¨å“ªä¸ªçº¿ç¨‹ä¸Šç”Ÿæˆå…ƒç´ æ— å…³ç´§è¦ï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬ç”Ÿæˆä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶å‘é€ç»™è§‚å¯Ÿè€…observer.on(.next(nextElement)), å®ƒä»¬ä¸èƒ½å‘é€ä¸‹ä¸€ä¸ªå…ƒç´ ,ç›´åˆ°observer.onæ–¹æ³•å·²å®Œæˆ. ç”Ÿäº§è€…ä¹Ÿä¸èƒ½å‘é€ç»ˆæ­¢.completedæˆ–.erroråœ¨.next`äº‹ä»¶è¿˜æ²¡æœ‰ç»“æŸçš„æƒ…å†µ. ç®€è€Œè¨€ä¹‹ï¼Œè€ƒè™‘ä¸€ä¸‹è¿™ä¸ªä¾‹å­: 123456someObservable .subscribe &#123; (e: Event&lt;Element&gt;) in print(\"Event processing started\") // processing print(\"Event processing ended\") &#125; æ€»æ˜¯ä¼šæ‰“å°: 123456Event processing startedEvent processing endedEvent processing startedEvent processing endedEvent processing startedEvent processing ended å®ƒä¸èƒ½æ‰“å°: 1234Event processing startedEvent processing startedEvent processing endedEvent processing ended åˆ›é€ ä½ è‡ªå·±çš„ Observable (observableåºåˆ—)å…³äºobservablesæœ‰ä¸€ä»¶é‡è¦çš„äº‹æƒ…è¦ç†è§£. å½“ä¸€ä¸ªobservableè¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¸ä¼šä»…ä»…å› ä¸ºå®ƒå·²ç»è¢«åˆ›å»ºè€Œæ‰§è¡Œä»»ä½•å·¥ä½œ. çš„ç¡®ï¼ŒObservableå¯ä»¥æœ‰è®¸å¤šæ–¹æ³•äº§ç”Ÿå…ƒç´ ã€‚å®ƒä»¬ä¸­çš„ä¸€äº›ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå…¶ä¸­ä¸€äº›ä¼šåˆ©ç”¨ç°æœ‰çš„è¿è¡Œè¿‡ç¨‹ï¼Œæ¯”å¦‚ç‚¹å‡»é¼ æ ‡äº‹ä»¶ç­‰ç­‰. ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åªæ˜¯è°ƒç”¨ä¸€ä¸ªObservableçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‰§è¡Œä»»ä½•åºåˆ—ç”Ÿæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‰¯ä½œç”¨ã€‚Observableåªæ˜¯å®šä¹‰äº†åºåˆ—æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Œä»¥åŠä¸ºå…ƒç´ ç”Ÿæˆä½¿ç”¨äº†å“ªäº›å‚æ•°ã€‚å½“è°ƒç”¨äº†è®¢é˜…æ–¹æ³•æ—¶ï¼Œåºåˆ—ç”Ÿæˆæ‰å¼€å§‹. å‡è®¾ï¼Œä½ æœ‰ä¸€ä¸ªç±»ä¼¼prototypeçš„æ–¹æ³•: 1func searchWikipedia(searchTerm: String) -&gt; Observable&lt;Results&gt; &#123;&#125; 123456789let searchForMe = searchWikipedia(\"me\")// æ²¡æœ‰æ‰§è¡Œè¯·æ±‚ï¼Œæ²¡æœ‰å·¥ä½œï¼Œæ²¡æœ‰å‘é€URLè¯·æ±‚let cancel = searchForMe // åºåˆ—ç”Ÿæˆç°åœ¨å¼€å§‹ï¼ŒURLè¯·æ±‚è¢«è§¦å‘ .subscribe(onNext: &#123; results in print(results) &#125;) æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åˆ›å»ºä½ è‡ªå·±çš„Observable åºåˆ—ã€‚æœ€ç®€å•çš„æ–¹æ³•å¯èƒ½æ˜¯ä½¿ç”¨createå‡½æ•°. è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªåºåˆ—ï¼Œè¯¥åºåˆ—åœ¨è®¢é˜…æ—¶è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸ªå‡½æ•°è¢«ç§°ä¸ºâ€™justâ€™. è¿™æ˜¯å®é™…çš„å®ç° 123456789101112func myJust&lt;E&gt;(_ element: E) -&gt; Observable&lt;E&gt; &#123; return Observable.create &#123; observer in observer.on(.next(element)) observer.on(.completed) return Disposables.create() &#125;&#125;myJust(0) .subscribe(onNext: &#123; n in print(n) &#125;) å°†æ‰“å°: 10 é‚£ä¹ˆä»€ä¹ˆæ˜¯createå‡½æ•°å‘¢? å®ƒåªæ˜¯ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ï¼Œå®ƒä½¿æ‚¨èƒ½å¤Ÿä½¿ç”¨Swifté—­åŒ…æ–¹ä¾¿åœ°å®ç°subscribeæ–¹æ³•ã€‚å°±åƒ subscribeæ–¹æ³•ä¸€æ ·ï¼Œå®ƒéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªobserverï¼Œç„¶åè¿”å›disposable. è¿™æ ·å®ç°çš„é¡ºåºå®é™…ä¸Šæ˜¯åŒæ­¥çš„ã€‚å®ƒå°†ç”Ÿæˆå…ƒç´ ï¼Œå¹¶åœ¨ç»ˆæ­¢ä¹‹å‰subscribeè°ƒç”¨è¿”å›disposableã€‚å› ä¸ºå®ƒçš„è¿”å›å¹¶ä¸é‡è¦æ‰€ä»¥ç”Ÿæˆå…ƒç´ çš„è¿‡ç¨‹ä¸ä¼šè¢«æ‰“æ–­. åœ¨ç”ŸæˆåŒæ­¥åºåˆ—æ—¶ï¼Œé€šå¸¸ä½¿ç”¨çš„disposableè¿”å›æ˜¯NopDisposableå®ä¾‹. ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æ•°ç»„ä¸­è¿”å›å…ƒç´ çš„observable. å®é™…çš„å®ç° 123456789101112131415161718192021222324252627282930func myFrom&lt;E&gt;(_ sequence: [E]) -&gt; Observable&lt;E&gt; &#123; return Observable.create &#123; observer in for element in sequence &#123; observer.on(.next(element)) &#125; observer.on(.completed) return Disposables.create() &#125;&#125;let stringCounter = myFrom([\"first\", \"second\"])print(\"Started ----\")// first timestringCounter .subscribe(onNext: &#123; n in print(n) &#125;)print(\"----\")// againstringCounter .subscribe(onNext: &#123; n in print(n) &#125;)print(\"Ended ----\") å°†æ‰“å°: 1234567Started ----firstsecond----firstsecondEnded ---- åˆ›é€ ä¸€ä¸ª Observable æ‰§è¡Œå·¥ä½œå¥½äº†ï¼Œç°åœ¨æ›´æœ‰è¶£äº†ã€‚æˆ‘ä»¬æ¥åˆ›å»ºä¹‹å‰ä¾‹å­ä¸­ä½¿ç”¨çš„intervalæ“ä½œç¬¦. è¿™ç›¸å½“äºåˆ†æ´¾é˜Ÿåˆ—è°ƒåº¦ç¨‹åºçš„å®é™…å®ç° 123456789101112131415161718192021222324func myInterval(_ interval: TimeInterval) -&gt; Observable&lt;Int&gt; &#123; return Observable.create &#123; observer in print(\"Subscribed\") let timer = DispatchSource.makeTimerSource(queue: DispatchQueue.global()) timer.scheduleRepeating(deadline: DispatchTime.now() + interval, interval: interval) let cancel = Disposables.create &#123; print(\"Disposed\") timer.cancel() &#125; var next = 0 timer.setEventHandler &#123; if cancel.isDisposed &#123; return &#125; observer.on(.next(next)) next += 1 &#125; timer.resume() return cancel &#125;&#125; 123456789101112131415let counter = myInterval(0.1)print(\"Started ----\")let subscription = counter .subscribe(onNext: &#123; n in print(n) &#125;)Thread.sleep(forTimeInterval: 0.5)subscription.dispose()print(\"Ended ----\") å°†æ‰“å° 123456789Started ----Subscribed01234DisposedEnded ---- å¦‚æœä½ æƒ³å†™ 12345678910111213141516171819202122let counter = myInterval(0.1)print(\"Started ----\")let subscription1 = counter .subscribe(onNext: &#123; n in print(\"First \\(n)\") &#125;)let subscription2 = counter .subscribe(onNext: &#123; n in print(\"Second \\(n)\") &#125;)Thread.sleep(forTimeInterval: 0.5)subscription1.dispose()Thread.sleep(forTimeInterval: 0.5)subscription2.dispose()print(\"Ended ----\") å°†æ‰“å°: 123456789101112131415161718192021Started ----SubscribedSubscribedFirst 0Second 0First 1Second 1First 2Second 2First 3Second 3First 4Second 4DisposedSecond 5Second 6Second 7Second 8Second 9DisposedEnded ---- è®¢é˜…çš„æ¯ä¸ªè®¢é˜…è€…é€šå¸¸ä¼šç”Ÿæˆå®ƒè‡ªå·±çš„å•ç‹¬çš„å…ƒç´ åºåˆ—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ“ä½œç¬¦æ˜¯æ— çŠ¶æ€çš„ã€‚æœ‰å¾ˆå¤šæ— çŠ¶æ€çš„æ“ä½œç¬¦æ¯”æœ‰çŠ¶æ€çš„å¤š. å…±äº«è®¢é˜…å’ŒshareReplayæ“ä½œç¬¦ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¸Œæœ›å¤šä¸ªè§‚å¯Ÿè€…åªä»ä¸€ä¸ªè®¢é˜…ä¸­å…±äº«äº‹ä»¶(å…ƒç´ )ï¼Œè¯¥æ€ä¹ˆåŠå‘¢? æœ‰ä¸¤ä»¶äº‹éœ€è¦å®šä¹‰ã€‚ åœ¨æ–°ç”¨æˆ·å¯¹å®ƒä»¬æ„Ÿå…´è¶£ä¹‹å‰,å¦‚ä½•å¤„ç†ä»¥å‰æ¥æ”¶åˆ°çš„è¿‡å»çš„å…ƒç´ (ä»…é‡æ”¾æœ€æ–°ã€é‡æ”¾æ‰€æœ‰ã€é‡æ”¾æœ€ånä¸ª) å¦‚ä½•å†³å®šä½•æ—¶è§¦å‘å…±äº«è®¢é˜…(refCountã€æ‰‹åŠ¨æˆ–å…¶ä»–ç®—æ³•) é€šå¸¸çš„é€‰æ‹©æ˜¯replay(1).refCount() ä¹Ÿå¯ä»¥ shareReplay(). 1234567891011121314151617181920212223let counter = myInterval(0.1) .shareReplay(1)print(\"Started ----\")let subscription1 = counter .subscribe(onNext: &#123; n in print(\"First \\(n)\") &#125;)let subscription2 = counter .subscribe(onNext: &#123; n in print(\"Second \\(n)\") &#125;)Thread.sleep(forTimeInterval: 0.5)subscription1.dispose()Thread.sleep(forTimeInterval: 0.5)subscription2.dispose()print(\"Ended ----\") å°†æ‰“å° 1234567891011121314151617181920Started ----SubscribedFirst 0Second 0First 1Second 1First 2Second 2First 3Second 3First 4Second 4First 5Second 5Second 6Second 7Second 8Second 9DisposedEnded ---- æ³¨æ„ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªSubscribedå’ŒDisposedäº‹ä»¶. URL observablesçš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„. è¿™å°±æ˜¯åœ¨Rxä¸­å°è£…HTTPè¯·æ±‚çš„æ–¹å¼ã€‚å®ƒå’Œintervalæ“ä½œç¬¦çš„æ¨¡å¼æ˜¯ä¸€æ ·çš„. 1234567891011121314151617181920212223242526extension Reactive where Base: URLSession &#123; public func response(_ request: URLRequest) -&gt; Observable&lt;(Data, HTTPURLResponse)&gt; &#123; return Observable.create &#123; observer in let task = self.dataTaskWithRequest(request) &#123; (data, response, error) in guard let response = response, let data = data else &#123; observer.on(.error(error ?? RxCocoaURLError.Unknown)) return &#125; guard let httpResponse = response as? HTTPURLResponse else &#123; observer.on(.error(RxCocoaURLError.nonHTTPResponse(response: response))) return &#125; observer.on(.next(data, httpResponse)) observer.on(.completed) &#125; task.resume() return Disposables.create &#123; task.cancel() &#125; &#125; &#125;&#125; æ“ä½œç¬¦åœ¨RxSwiftä¸­å®ç°äº†è®¸å¤šæ“ä½œç¬¦. æ‰€æœ‰æ“ä½œç¬¦çš„å¤§ç†çŸ³å›¾è¡¨éƒ½å¯ä»¥åœ¨ ReactiveX.io å‡ ä¹æ‰€æœ‰çš„è¿ç®—ç¬¦éƒ½åœ¨ Playgrounds. è¦ä½¿ç”¨playgroundsï¼Œè¯·æ‰“å¼€Rx.xcworkspaceï¼Œæ„å»ºRxSwift-macOS schemeï¼Œç„¶ååœ¨Rx.xcworkspaceä¸Šæ‰“å¼€playgroundsçš„æ ‘è§†å›¾. å¦‚æœä½ éœ€è¦ä¸€ä¸ªæ“ä½œç¬¦ï¼Œä¸çŸ¥é“æ€ä¹ˆæ‰¾åˆ°å®ƒï¼Œè¿™æœ‰ä¸€ä¸ªæ“ä½œç¬¦æ ‘. è‡ªå®šä¹‰æ“ä½œç¬¦å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æ“ä½œç¬¦æœ‰ä¸¤ç§æ–¹æ³•. ç®€å•çš„æ–¹æ³•æ‰€æœ‰çš„å†…éƒ¨ä»£ç éƒ½ä½¿ç”¨äº†é«˜åº¦ä¼˜åŒ–çš„æ“ä½œç¬¦ï¼Œå› æ­¤å®ƒä»¬å¹¶ä¸æ˜¯æœ€å¥½çš„æ•™ç¨‹ææ–™ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨æ ‡å‡†æ“ä½œç¬¦çš„åŸå› . å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥åˆ›å»ºæ“ä½œç¬¦ã€‚åˆ›å»ºæ–°çš„è¿ç®—ç¬¦å®é™…ä¸Šæ˜¯å…³äºåˆ›å»ºobservablesï¼Œè€Œä¹‹å‰çš„ç« èŠ‚å·²ç»æè¿°äº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹. è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°ä¸€ä¸ªæœªä¼˜åŒ–çš„æ˜ å°„æ“ä½œç¬¦. 12345678910111213141516171819extension ObservableType &#123; func myMap&lt;R&gt;(transform: @escaping (E) -&gt; R) -&gt; Observable&lt;R&gt; &#123; return Observable.create &#123; observer in let subscription = self.subscribe &#123; e in switch e &#123; case .next(let value): let result = transform(value) observer.on(.next(result)) case .error(let error): observer.on(.error(error)) case .completed: observer.on(.completed) &#125; &#125; return subscription &#125; &#125;&#125; ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„mapäº†: 1234567let subscription = myInterval(0.1) .myMap &#123; e in return \"This is simply \\(e)\" &#125; .subscribe(onNext: &#123; n in print(n) &#125;) å°†æ‰“å°: 1234567891011SubscribedThis is simply 0This is simply 1This is simply 2This is simply 3This is simply 4This is simply 5This is simply 6This is simply 7This is simply 8... Life happensé‚£ä¹ˆï¼Œå¦‚æœä¸ç”¨è‡ªå®šä¹‰æ“ä½œç¬¦æ¥è§£å†³æŸäº›æƒ…å†µä¼šæ€ä¹ˆæ ·å‘¢? æ‚¨å¯ä»¥é€€å‡ºå•ä¸ªRxï¼Œåœ¨çœŸå®ä¸–ç•Œä¸­æ‰§è¡Œæ´»åŠ¨ï¼Œç„¶åä½¿ç”¨Subjectså°†ç»“æœå†æ¬¡ä½¿ç”¨åˆ°Rx. è¿™ä¸æ˜¯åº”è¯¥ç»å¸¸ç»ƒä¹ çš„ä¸œè¥¿ï¼Œè€Œä¸”æ˜¯ä¸€ç§ä¸å¥½çš„ä»£ç å‘³é“ï¼Œä½†ä½ å¯ä»¥è¿™æ ·åš. 123456789101112131415161718192021222324252627let magicBeings: Observable&lt;MagicBeing&gt; = summonFromMiddleEarth()magicBeings .subscribe(onNext: &#123; being in // exit the Rx monad self.doSomeStateMagic(being) &#125;) .disposed(by: disposeBag)//// Mess//let kitten = globalParty( // calculate something in messy world being, UIApplication.delegate.dataSomething.attendees)kittens.on(.next(kitten)) // send result back to rx//// Another mess//let kittens = Variable(firstKitten) // again back in Rx monadkittens.asObservable() .map &#123; kitten in return kitten.purr() &#125; // .... æ¯æ¬¡ä½ è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œæœ‰äººå¯èƒ½ä¼šæŠŠè¿™ä¸ªä»£ç å†™åœ¨æŸä¸ªåœ°æ–¹: 12345kittens .subscribe(onNext: &#123; kitten in // do something with kitten &#125;) .disposed(by: disposeBag) æ‰€ä»¥è¯·å°½é‡ä¸è¦è¿™æ ·åš. Playgroundså¦‚æœä½ ä¸ç¡®å®šå…¶ä¸­çš„ä¸€äº›æ“ä½œç¬¦æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼ŒplaygroundsåŒ…å«å‡ ä¹æ‰€æœ‰çš„æ“ä½œç¬¦ï¼Œéƒ½å·²ç»å‡†å¤‡å¥½äº†æ¼”ç¤ºä»–ä»¬è¡Œä¸ºçš„å°ä¾‹å­. è¦ä½¿ç”¨playgroundsï¼Œè¯·æ‰“å¼€Rx.xcworkspaceï¼Œæ„å»ºRxSwift-macOS schemeï¼Œç„¶ååœ¨Rx.xcworkspaceä¸Šæ‰“å¼€playgroundsçš„æ ‘è§†å›¾. è¦æŸ¥çœ‹playgroundsä¸Šçš„ç¤ºä¾‹ç»“æœï¼Œè¯·æ‰“å¼€Assistant Editorã€‚æ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»View &gt; Assistant Editor &gt; Show Assistant Editoræ¥æ‰“å¼€Assistant Editor é”™è¯¯å¤„ç†æœ‰ä¸¤ç§é”™è¯¯æœºåˆ¶. observablesä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†æœºåˆ¶é”™è¯¯å¤„ç†éå¸¸ç®€å•ã€‚å¦‚æœä¸€ä¸ªåºåˆ—ä»¥é”™è¯¯ç»“æŸï¼Œé‚£ä¹ˆæ‰€æœ‰ä¾èµ–åºåˆ—éƒ½å°†ä»¥é”™è¯¯ç»“æŸã€‚è¿™æ˜¯é€šå¸¸çš„çŸ­è·¯é€»è¾‘ã€‚ æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨catchæ“ä½œç¬¦æ¥æ¢å¤overloadsçš„æ•…éšœã€‚æœ‰å„ç§é‡è½½ä½¿æ‚¨èƒ½å¤Ÿè¯¦ç»†åœ°æŒ‡å®šæ¢å¤. è¿˜æœ‰retryæ“ä½œç¬¦ï¼Œå¯ä»¥åœ¨å‡ºç°é”™è¯¯åºåˆ—æ—¶è¿›è¡Œé‡è¯•. è°ƒè¯•ç¼–è¯‘é”™è¯¯åœ¨ç¼–å†™ä¼˜é›…çš„rxswift/rxcocoaä»£ç æ—¶ï¼Œæ‚¨å¯èƒ½éå¸¸ä¾èµ–äºç¼–è¯‘å™¨æ¥æ¨æ–­Observableçš„ç±»å‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆSwiftå¾ˆæ£’çš„åŸå› ä¹‹ä¸€ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šè®©äººæ²®ä¸§. 12345678images = word .filter &#123; $0.containsString(\"important\") &#125; .flatMap &#123; word in return self.api.loadFlickrFeed(\"karate\") .catchError &#123; error in return just(JSON(1)) &#125; &#125; å¦‚æœç¼–è¯‘å™¨æŠ¥å‘Šåœ¨è¿™ä¸ªè¡¨è¾¾å¼çš„æŸä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘å»ºè®®é¦–å…ˆæ³¨é‡Šè¿”å›ç±»å‹. 12345678images = word .filter &#123; s -&gt; Bool in s.containsString(\"important\") &#125; .flatMap &#123; word -&gt; Observable&lt;JSON&gt; in return self.api.loadFlickrFeed(\"karate\") .catchError &#123; error -&gt; Observable&lt;JSON&gt; in return just(JSON(1)) &#125; &#125; å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šç±»å‹æ³¨é‡Šï¼Œç›´åˆ°å°†é”™è¯¯æœ¬åœ°åŒ–. 12345678images = word .filter &#123; (s: String) -&gt; Bool in s.containsString(\"important\") &#125; .flatMap &#123; (word: String) -&gt; Observable&lt;JSON&gt; in return self.api.loadFlickrFeed(\"karate\") .catchError &#123; (error: Error) -&gt; Observable&lt;JSON&gt; in return just(JSON(1)) &#125; &#125; æˆ‘å»ºè®®é¦–å…ˆæ³¨é‡Šè¿”å›ç±»å‹å’Œé—­åŒ…çš„å‚æ•°. é€šå¸¸åœ¨æ‚¨ä¿®å¤äº†é”™è¯¯ä¹‹åï¼Œæ‚¨å¯ä»¥åˆ é™¤ç±»å‹æ³¨é‡Šæ¥é‡æ–°æ¸…ç†æ‚¨çš„ä»£ç . è°ƒè¯•å•ç‹¬ä½¿ç”¨è°ƒè¯•å™¨æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†æ˜¯é€šå¸¸ä½¿ç”¨debugä¼šæ›´æœ‰æ•ˆã€‚debugæ“ä½œç¬¦å°†æŠŠæ‰€æœ‰äº‹ä»¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œæ‚¨è¿˜å¯ä»¥æ·»åŠ æ ‡è®°è¿™äº›äº‹ä»¶ã€‚. debugå°±åƒä¸€ä¸ªæ¢é’ˆã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä½¿ç”¨å®ƒçš„ä¾‹å­: 123456789101112let subscription = myInterval(0.1) .debug(\"my probe\") .map &#123; e in return \"This is simply \\(e)\" &#125; .subscribe(onNext: &#123; n in print(n) &#125;)Thread.sleepForTimeInterval(0.5)subscription.dispose() å°†æ‰“å° 1234567891011121314[my probe] subscribedSubscribed[my probe] -&gt; Event next(Box(0))This is simply 0[my probe] -&gt; Event next(Box(1))This is simply 1[my probe] -&gt; Event next(Box(2))This is simply 2[my probe] -&gt; Event next(Box(3))This is simply 3[my probe] -&gt; Event next(Box(4))This is simply 4[my probe] disposeDisposed æ‚¨è¿˜å¯ä»¥è½»æ¾åœ°åˆ›å»ºdebugæ“ä½œç¬¦çš„ç‰ˆæœ¬. 123456789101112131415161718192021222324extension ObservableType &#123; public func myDebug(identifier: String) -&gt; Observable&lt;Self.E&gt; &#123; return Observable.create &#123; observer in print(\"subscribed \\(identifier)\") let subscription = self.subscribe &#123; e in print(\"event \\(identifier) \\(e)\") switch e &#123; case .next(let value): observer.on(.next(value)) case .error(let error): observer.on(.error(error)) case .completed: observer.on(.completed) &#125; &#125; return Disposables.create &#123; print(\"disposing \\(identifier)\") subscription.dispose() &#125; &#125; &#125; &#125; å¯ç”¨è°ƒè¯•æ¨¡å¼ä½¿ç”¨RxSwift.Resourcesæ¥è°ƒè¯•å†…å­˜æ³„æ¼æˆ–è‡ªåŠ¨è®°å½•æ‰€æœ‰HTTPè¯·æ±‚ï¼Œæ‚¨å¿…é¡»å¯ç”¨è°ƒè¯•æ¨¡å¼. ä¸ºäº†å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œå¿…é¡»å°†ä¸€ä¸ªTRACE_RESOURCESæ ‡å¿—æ·»åŠ åˆ°RxSwiftç›®æ ‡æ„å»ºè®¾ç½®ä¸­ï¼Œåœ¨Other Swift Flagsä¸‹. æœ‰å…³å¦‚ä½•ç”¨Cocoapods &amp; Carthageè®¾ç½®TRACE_RESOURCESæ ‡å¿—çš„è¿›ä¸€æ­¥è®¨è®ºå’ŒæŒ‡å¯¼ï¼Œè¯·å‚é˜… #378 è°ƒè¯•å†…å­˜æ³„æ¼åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ï¼ŒRxåœ¨å…¨å±€å˜é‡Resources.totalä¸­è·Ÿè¸ªæ‰€æœ‰åˆ†é…çš„èµ„æº. å¦‚æœæ‚¨æƒ³è¦æœ‰ä¸€äº›èµ„æºæ³„æ¼æ£€æµ‹é€»è¾‘ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æ‰“å°RxSwift.Resources.totalå‘¨æœŸæ€§çš„è¾“å‡º. 1234567/* add somewhere infunc application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey : Any]? = nil)*/_ = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .subscribe(onNext: &#123; _ in print(\"Resource count \\(RxSwift.Resources.total)\") &#125;) æµ‹è¯•å†…å­˜æ³„æ¼çš„æœ€æœ‰æ•ˆæ–¹æ³•æ˜¯: å¯¼èˆªåˆ°ä½ çš„å±å¹•å¹¶ä½¿ç”¨å®ƒ å¯¼èˆªè¿”å› è§‚å¯Ÿåˆå§‹èµ„æºæ•° ç¬¬äºŒæ¬¡æµè§ˆä½ çš„å±å¹•å¹¶ä½¿ç”¨å®ƒ å¯¼èˆªè¿”å› è§‚å¯Ÿæœ€ç»ˆçš„èµ„æºæ•° å¦‚æœåœ¨åˆå§‹èµ„æºå’Œæœ€ç»ˆèµ„æºè®¡æ•°ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œå¯èƒ½ä¼šå‡ºç°å†…å­˜æ³„æ¼. ä¹‹æ‰€ä»¥å»ºè®®2ä¸ªå¯¼èˆªï¼Œæ˜¯å› ä¸ºç¬¬ä¸€ä¸ªå¯¼èˆªå¼ºåˆ¶åŠ è½½äº†æƒ°æ€§èµ„æº. VariablesVariablesè¡¨ç¤ºä¸€äº›observableçŠ¶æ€ã€‚ä¸åŒ…å«å€¼çš„Variableä¸èƒ½å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦åˆå§‹å€¼. Variableå°è£…Subjectã€‚æ›´å…·ä½“åœ°è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªBehaviorSubjectã€‚ä¸BehaviorSubjectä¸åŒï¼Œå®ƒåªæ˜¾ç¤ºå€¼æ¥å£ï¼Œå› æ­¤variableæ°¸è¿œä¸èƒ½ä»¥é”™è¯¯ç»“æŸ. å®ƒè¿˜ä¼šåœ¨è®¢é˜…ä¸­ç«‹å³æ’­æ”¾å®ƒçš„å½“å‰ä»·. åœ¨variableè¢«é‡Šæ”¾åï¼Œå®ƒå°†å®Œæˆä».asObservable()è¿”å›observableåºåˆ—. 1234567891011121314151617181920212223242526272829let variable = Variable(0)print(\"Before first subscription ---\")_ = variable.asObservable() .subscribe(onNext: &#123; n in print(\"First \\(n)\") &#125;, onCompleted: &#123; print(\"Completed 1\") &#125;)print(\"Before send 1\")variable.value = 1print(\"Before second subscription ---\")_ = variable.asObservable() .subscribe(onNext: &#123; n in print(\"Second \\(n)\") &#125;, onCompleted: &#123; print(\"Completed 2\") &#125;)print(\"Before send 2\")variable.value = 2print(\"End ---\") å°†æ‰“å° 123456789101112Before first subscription ---First 0Before send 1First 1Before second subscription ---Second 1Before send 2First 2Second 2End ---Completed 1Completed 2 KVOKVOæ˜¯ä¸€ç§Objective-Cæœºåˆ¶ã€‚è¿™æ„å‘³ç€å®ƒå¹¶ä¸æ˜¯åœ¨è€ƒè™‘ç±»å‹å®‰å…¨çš„æƒ…å†µä¸‹å»ºç«‹èµ·æ¥çš„ã€‚è¿™ä¸ªé¡¹ç›®è¯•å›¾è§£å†³ä¸€äº›é—®é¢˜ã€‚ è¿™ä¸ªåº“æ”¯æŒKVOçš„æ–¹å¼æœ‰ä¸¤ç§ã€‚ 1234567891011// KVOextension Reactive where Base: NSObject &#123; public func observe&lt;E&gt;(type: E.Type, _ keyPath: String, options: KeyValueObservingOptions, retainSelf: Bool = true) -&gt; Observable&lt;E?&gt; &#123;&#125;&#125;#if !DISABLE_SWIZZLING// KVOextension Reactive where Base: NSObject &#123; public func observeWeakly&lt;E&gt;(type: E.Type, _ keyPath: String, options: KeyValueObservingOptions) -&gt; Observable&lt;E?&gt; &#123;&#125;&#125;#endif ä¾‹å¦‚å¦‚ä½•è§‚å¯ŸUIViewçš„frame. è­¦å‘Š:UIKitä¸æ˜¯KVOå…¼å®¹çš„ï¼Œä½†è¿™æ˜¯å¯è¡Œçš„. 12345view .rx.observe(CGRect.self, \"frame\") .subscribe(onNext: &#123; frame in ... &#125;) æˆ– 12345view .rx.observeWeakly(CGRect.self, \"frame\") .subscribe(onNext: &#123; frame in ... &#125;) rx.observerx.observeæ›´æœ‰æ€§èƒ½ï¼Œå› ä¸ºå®ƒåªæ˜¯å›´ç»•KVOæœºåˆ¶çš„ä¸€ä¸ªç®€å•åŒ…è£…ï¼Œä½†å®ƒçš„ä½¿ç”¨åœºæ™¯æ›´æœ‰é™ å®ƒå¯ä»¥ç”¨äºobserveè·¯å¾„å¼€å§‹äºæ¥è‡ªselfæˆ–æ¥è‡ªæ‰€æœ‰æƒçš„ç¥–å…ˆ (retainSelf = false) å®ƒå¯ä»¥ç”¨äºobserveè·¯å¾„å¼€å§‹äºä»æ‰€æœ‰æƒä¸­çš„åä»£ (retainSelf = true) è·¯å¾„å¿…é¡»åªåŒ…å« strongå±æ€§ï¼Œå¦åˆ™ï¼Œåœ¨deallocä¹‹å‰ï¼Œæ‚¨å¯èƒ½ä¼šå†’ç€ç ´åç³»ç»Ÿçš„é£é™©. å¦‚ 1self.rx.observe(CGRect.self, \"view.frame\", retainSelf: false) rx.observeWeaklyrx.observeWeaklyçš„é€Ÿåº¦æ¯”rx.observeæ…¢ä¸€äº›ã€‚è§‚å¯Ÿå› ä¸ºå®ƒå¿…é¡»åœ¨å¼±å¼•ç”¨çš„æƒ…å†µä¸‹å¤„ç†å¯¹è±¡çš„äº¤æ˜“. å®ƒå¯ä»¥åœ¨rx.observeçš„æ‰€æœ‰æƒ…å†µä¸‹ä½¿ç”¨ å› ä¸ºå®ƒä¸ä¼šæŒæœ‰observedçš„ç›®æ ‡ï¼Œå®ƒå¯ä»¥ç”¨æ¥observeä»»æ„çš„å¯¹è±¡ï¼Œå®ƒçš„æ‰€æœ‰æƒå…³ç³»æ˜¯æœªçŸ¥çš„ å®ƒå¯ä»¥ç”¨æ¥è§‚å¯Ÿweakå±æ€§ å¦‚ 1someSuspiciousViewController.rx.observeWeakly(Bool.self, \"behavingOk\") è§‚å¯Ÿç»“æ„KVOæ˜¯ä¸€ç§Objective-Cæœºåˆ¶ï¼Œå› æ­¤å®ƒéå¸¸ä¾èµ–äºNSValue. RxCocoaä¸ºKVOæä¾›äº†å¯¹CGRectã€CGSizeå’ŒCGPointç»“æ„çš„æ”¯æŒ. å½“è§‚å¯Ÿå…¶ä»–ç»“æ„ä½“æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨ä»NSValueä¸­æå–è¿™äº›ç»“æ„ã€‚ RxCocoa/Foundation/KVORepresentable+CoreGraphics.swift)æ˜¯å¦‚ä½•æ‰©å±•ç¤ºä¾‹KVOè§‚å¯Ÿæœºåˆ¶å’Œrx.observe*çš„æ–¹æ³•ï¼Œé€šè¿‡å®ç°KVORepresentableåè®®ã€‚ UIå±‚æç¤ºå½“ç»‘å®šåˆ°UIKitæ§ä»¶æ—¶ä½ çš„Observables çš„ä¸€äº›ä¸œè¥¿åœ¨UIå±‚ä¸­éœ€è¦æ»¡è¶³. çº¿ç¨‹Observableséœ€è¦åœ¨MainScheduler(UIThread)ä¸Šå‘é€å€¼ã€‚è¿™åªæ˜¯æ™®é€šçš„UIKit/Cocoaéœ€æ±‚. å¯¹äºæ‚¨çš„apiæ¥è¯´ï¼Œåœ¨MainSchedulerä¸Šè¿”å›ç»“æœé€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å¦‚æœæ‚¨è¯•å›¾ä»åå°çº¿ç¨‹ä¸­ç»‘å®šæŸä¸ªä¸œè¥¿ï¼Œåœ¨è°ƒè¯•æ„å»ºRxCocoaä¸­é€šå¸¸ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸æ¥é€šçŸ¥æ‚¨è¿™ä¸€ç‚¹ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨éœ€è¦æ·»åŠ observeOn(MainScheduler.instance). URLSessionæ‰©å±•åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šè¿”å›MainScheduler. é”™è¯¯ä½ ä¸èƒ½å°†å¤±è´¥ç»‘å®šåˆ°UIKitæ§ä»¶å› ä¸ºè¿™æ˜¯æœªå®šä¹‰çš„è¡Œä¸º. å¦‚æœä½ ä¸çŸ¥é“Observableå¯èƒ½å¤±è´¥,æ‚¨å¯ä»¥ä½¿ç”¨catchErrorJustReturn(valueThatIsReturnedWhenErrorHappens)ç¡®ä¿å®ƒä¸èƒ½å¤±è´¥,ä½†æ˜¯ï¼Œåœ¨å‘ç”Ÿé”™è¯¯ä¹‹åï¼Œåº•å±‚çš„åºåˆ—ä»ç„¶ä¼šå®Œæˆ. å¦‚æœæƒ³è¦çš„è¡Œä¸ºæ˜¯åº•å±‚åºåˆ—ç»§ç»­ç”Ÿæˆå…ƒç´ ï¼Œåˆ™éœ€è¦æŸäº›ç‰ˆæœ¬çš„retryæ“ä½œç¬¦. åˆ†äº«è®¢é˜…æ‚¨é€šå¸¸å¸Œæœ›åœ¨UIå±‚ä¸­å…±äº«è®¢é˜…ã€‚æ‚¨ä¸éœ€è¦å•ç‹¬è¿›è¡ŒHTTPè°ƒç”¨æ¥å°†ç›¸åŒçš„æ•°æ®ç»‘å®šåˆ°å¤šä¸ªUIå…ƒç´ . å‡è®¾ä½ æœ‰è¿™æ ·çš„ä¸œè¥¿: 12345678910let searchResults = searchText .throttle(0.3, $.mainScheduler) .distinctUntilChanged .flatMapLatest &#123; query in API.getSearchResults(query) .retry(3) .startWith([]) // clears results on new search term .catchErrorJustReturn([]) &#125; .shareReplay(1) // &lt;- notice the `shareReplay` operator ä½ é€šå¸¸æƒ³è¦çš„æ˜¯åˆ†äº«æœç´¢ç»“æœã€‚è¿™å°±æ˜¯shareReplayçš„æ„æ€ã€‚ åœ¨UIå±‚ä¸­ï¼Œåœ¨è½¬æ¢é“¾çš„æœ«å°¾æ·»åŠ shareReplayé€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»éªŒæ³•åˆ™ï¼Œå› ä¸ºæ‚¨ç¡®å®æƒ³è¦å…±äº«è®¡ç®—ç»“æœã€‚å½“å°†æœç´¢ç»“æœç»‘å®šåˆ°å¤šä¸ªUIå…ƒç´ æ—¶ï¼Œæ‚¨ä¸å¸Œæœ›è§¦å‘å•ç‹¬çš„HTTPè¿æ¥ã€‚ å†çœ‹ä¸€ä¸‹Driverå•å…ƒã€‚å®ƒè¢«è®¾è®¡ä¸ºé€æ˜åœ°åŒ…è£…è¿™äº›å…±äº«è°ƒç”¨ï¼Œç¡®ä¿åœ¨ä¸»UIçº¿ç¨‹ä¸Šè§‚å¯Ÿåˆ°å…ƒç´ ï¼Œå¹¶ä¸”æ²¡æœ‰é”™è¯¯å¯ä»¥ç»‘å®šåˆ°UIã€‚ HTTPè¯·æ±‚httpè¯·æ±‚æ˜¯äººä»¬å°è¯•çš„ç¬¬ä¸€ä»¶äº‹ã€‚ é¦–å…ˆéœ€è¦æ„å»ºä¸€ä¸ªè¡¨ç¤ºéœ€è¦å®Œæˆçš„å·¥ä½œçš„URLRequestå¯¹è±¡. è¯·æ±‚ç¡®å®šæ˜¯GETè¯·æ±‚ï¼Œè¿˜æ˜¯POSTè¯·æ±‚ï¼Œè¯·æ±‚ä¸»ä½“æ˜¯ä»€ä¹ˆï¼ŒæŸ¥è¯¢å‚æ•° â€¦ è¿™å°±æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„GETè¯·æ±‚ 1let req = URLRequest(url: URL(string: \"http://en.wikipedia.org/w/api.php?action=parse&amp;page=Pizza&amp;format=json\")) å¦‚æœæ‚¨æƒ³åœ¨ç»„åˆä¹‹å¤–æ‰§è¡Œå…¶ä»–observablesçš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯éœ€è¦åšçš„äº‹æƒ…ã€‚ 123456789101112131415let responseJSON = URLSession.shared.rx.json(request: req)// æ²¡æœ‰ä»»ä½•è¯·æ±‚ä¼šè¢«æ‰§è¡Œåˆ°responseJSON,åªæ˜¯ä¸€ä¸ªæè¿°å¦‚ä½•è·å–å“åº”let cancelRequest = responseJSON // this will fire the request .subscribe(onNext: &#123; json in print(json) &#125;)Thread.sleep(forTimeInterval: 3.0)// å¦‚æœä½ æƒ³åœ¨3ç§’åå–æ¶ˆè¯·æ±‚cancelRequest.dispose() URLSessionæ‰©å±•ä¸ä¼šåœ¨é»˜è®¤æƒ…å†µä¸‹è¿”å›MainScheduler. å¦‚æœæ‚¨æƒ³è¦ä¸€ä¸ªæ›´ä½çº§åˆ«è®¿é—®å“åº”ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨: 12345678910111213141516171819URLSession.shared.rx.response(myURLRequest) .debug(\"my request\") // å°†æŠŠä¿¡æ¯æ‰“å°åˆ°æ§åˆ¶å° .flatMap &#123; (data: NSData, response: URLResponse) -&gt; Observable&lt;String&gt; in if let response = response as? HTTPURLResponse &#123; if 200 ..&lt; 300 ~= response.statusCode &#123; return just(transform(data)) &#125; else &#123; return Observable.error(yourNSError) &#125; &#125; else &#123; rxFatalError(\"response = nil\") return Observable.error(yourNSError) &#125; &#125; .subscribe &#123; event in print(event) // å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œä¹Ÿä¼šå°†é”™è¯¯è¾“å‡ºåˆ°æ§åˆ¶å° &#125; æ—¥å¿—è®°å½•HTTPæµé‡åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ï¼ŒRxCocoaå°†é»˜è®¤å°†æ‰€æœ‰HTTPè¯·æ±‚è®°å½•åˆ°æ§åˆ¶å°ã€‚å¦‚æœæ‚¨æƒ³è¦æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œè¯·è®¾ç½®Logging.URLRequestsçš„è¿‡æ»¤å™¨ã€‚. 123456789101112// è¯»è‡ªå·±çš„é…ç½®public struct Logging &#123; public typealias LogURLRequest = (URLRequest) -&gt; Bool public static var URLRequests: LogURLRequest = &#123; _ in #if DEBUG return true #else return false #endif &#125;&#125; RxDataSourcesâ€¦ æ˜¯ä¸€ç»„ä¸ºUITableView så’ŒUICollectionViewæä¾›å…¨åŠŸèƒ½çš„å“åº”å¼æ•°æ®æºçš„ç±»ã€‚ RxDataSourcesè¢«ç»‘å®šåœ¨ è¿™é‡Œ. åœ¨RxExampleé¡¹ç›®ä¸­åŒ…å«äº†å¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„åŠŸèƒ½å®Œæ•´çš„æ¼”ç¤ºã€‚","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift ä¾‹å­","slug":"RxSwift-Examples","date":"2017-10-26T02:21:15.000Z","updated":"2020-07-25T02:57:18.161Z","comments":true,"path":"2017/10/26/RxSwift-Examples/","link":"","permalink":"https://jigangduan.github.io/2017/10/26/RxSwift-Examples/","excerpt":"è®¡ç®—å˜é‡ ç®€å•çš„UIç»‘å®š è‡ªåŠ¨è¾“å…¥éªŒè¯","text":"è®¡ç®—å˜é‡ ç®€å•çš„UIç»‘å®š è‡ªåŠ¨è¾“å…¥éªŒè¯ è®¡ç®—å˜é‡é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»ä¸€äº›å‘½ä»¤å¼ä»£ç å¼€å§‹ã€‚æœ¬ä¾‹çš„ç›®çš„æ˜¯å°†æ ‡è¯†ç¬¦cç»‘å®šåˆ°ä»aå’Œbè®¡ç®—çš„å€¼ï¼Œåœ¨æ»¡è¶³æŸäº›æ¡ä»¶ä¸‹ã€‚ ä¸‹é¢æ˜¯è®¡ç®—cå€¼çš„å‘½ä»¤å¼ä»£ç : 12345678// æ ‡å‡†çš„å‘½ä»¤å¼ä»£ç var c: Stringvar a = 1 // åªæ˜¯èµ‹å€¼`1`åˆ°`a`ä¸€æ¬¡var b = 2 // åªæ˜¯èµ‹å€¼`2`åˆ°`b`ä¸€æ¬¡if a + b &gt;= 0 &#123; c = \"\\(a + b) is positive\" // åªæ˜¯èµ‹å€¼`c`ä¸€æ¬¡&#125; cæ–°çš„å€¼æ˜¯3 is positive. ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å°†açš„å€¼æ›´æ”¹ä¸º4ï¼Œé‚£ä¹ˆcä»ç„¶ä¼šåŒ…å«æ—§çš„å€¼ã€‚ 12a = 4 // `c` ä»ç„¶ç­‰äº \"3 is positive\", è¿™æ˜¯ä¸å¥½çš„ // æˆ‘ä»¬æƒ³è®© `c` ç­‰äº \"6 is positive\" å› ä¸º 4 + 2 = 6 è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¡Œä¸º. ä½¿ç”¨RxSwiftæ”¹è¿›çš„é€»è¾‘: 12345678910111213141516171819202122232425262728293031let a /*: Observable&lt;Int&gt;*/ = Variable(1) // a = 1let b /*: Observable&lt;Int&gt;*/ = Variable(2) // b = 2// ä½¿ç”¨`+`ç»„åˆæœ€æ–°`a`å’Œ`b`çš„å˜é‡å€¼let c = Observable.combineLatest(a.asObservable(), b.asObservable()) &#123; $0 + $1 &#125; .filter &#123; $0 &gt;= 0 &#125; // å¦‚æœ `a + b &gt;= 0` æ˜¯ `true`, `a + b` è¢«ä¼ é€’ç»™ `map` æ“ä½œç¬¦ .map &#123; \"\\($0) is positive\" &#125; // maps `a + b` åä¸º \"\\(a + b) is positive\"// å› ä¸ºåˆå§‹å€¼æ˜¯a=1å’Œb=2// 1 + 2 = 3 æ˜¯ &gt;= 0, æ‰€ä»¥ `c` ä¸€å¼€å§‹ç­‰äº \"3 is positive\"// è¦ä»Rx `Observable`ä¸­æå–å€¼ï¼Œè¯·ä»`c`çš„å€¼è®¢é˜…// `subscribe(onNext:)` æ„å‘³ç€è®¢é˜…`c`çš„ä¸‹ä¸€ä¸ª(æ–°)å€¼// è¿™ä¹ŸåŒ…æ‹¬åˆå§‹å€¼ \"3 is positive\".c.subscribe(onNext: &#123; print($0) &#125;) // æ‰“å°: \"3 is positive\"// ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ”¹å˜`a`çš„å€¼a.value = 4 // æ‰“å°: 6 is positive// æœ€æ–°å€¼çš„æ€»å’Œ, `4` + `2`, æ˜¯ `6`.// å› ä¸º `&gt;= 0`, `map` äº§ç”Ÿ \"6 is positive\"// è¿™ä¸ªç»“æœè¢«èµ‹å€¼ç»™ `c`.// ç”±äº`c`çš„å€¼æ”¹å˜äº†, `&#123; print($0) &#125;` å°†è¢«æ‰§è¡Œ,// \"6 is positive\" å°†è¢«æ‰“å°å‡ºæ¥.// ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ”¹å˜`b`çš„å€¼b.value = -8 // æ²¡æœ‰ä»»ä½•æ‰“å°// æœ€æ–°å€¼çš„æ€»å’Œ, `4 + (-8)`, æ˜¯ `-4`.// å› ä¸ºè¿™ä¸æ˜¯ `&gt;= 0`, `map` æ²¡æœ‰è¢«æ‰§è¡Œ.// è¿™æ„å‘³ç€ `c` ä»ç„¶åŒ…å« \"6 is positive\"// ç”±äº`c`æ²¡æœ‰è¢«æ›´æ–°ï¼Œæ‰€ä»¥æ²¡æœ‰äº§ç”Ÿæ–°çš„â€œnextâ€å€¼// `&#123; print($0) &#125;` ä¸ä¼šè¢«è°ƒç”¨. ç®€å•çš„UIç»‘å®š ä¸å†æ˜¯ç»‘å®šå˜é‡, è®©æˆ‘ä»¬ç»‘å®šUITextFieldçš„å€¼ä½¿ç”¨rx.textå±æ€§ ç„¶å, map ç±»å‹ String åˆ°ç±»å‹ Int ä½¿ç”¨å¼‚æ­¥APIç¡®å®šè¿™ä¸ªæ•°å­—æ˜¯å¦ä¸ºè´¨æ•° å¦‚æœåœ¨å¼‚æ­¥è°ƒç”¨å®Œæˆä¹‹å‰ä¿®æ”¹äº†æ–‡æœ¬ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„asyncè°ƒç”¨å°†é€šè¿‡concatæ¥æ›¿ä»£å®ƒ å°†ç»“æœç»‘å®šåˆ° UILabel 12345678910111213let subscription/*: Disposable */ = primeTextField.rx.text // ç±»å‹æ˜¯ Observable&lt;String&gt; .map &#123; WolframAlphaIsPrime(Int($0) ?? 0) &#125; // ç±»å‹æ˜¯ Observable&lt;Observable&lt;Prime&gt;&gt; .concat() // ç±»å‹æ˜¯ Observable&lt;Prime&gt; .map &#123; \"number \\($0.n) is prime? \\($0.isPrime)\" &#125; // ç±»å‹æ˜¯ Observable&lt;String&gt; .bind(to: resultLabel.rx.text) // è¿”å› Disposable å¯ç”¨äºè§£é™¤æ‰€æœ‰å†…å®¹// è¿™å°†è®¾ç½® `resultLabel.text` ä¸º \"number 43 is prime? true\" åœ¨æœåŠ¡å™¨è°ƒç”¨å®ŒæˆåprimeTextField.text = \"43\"// ...// è¦è§£ç»‘æ‰€æœ‰ï¼Œåªéœ€è°ƒç”¨å®ƒsubscription.dispose() æœ¬ä¾‹ä¸­ä½¿ç”¨çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯å’Œç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ“ä½œç¬¦ä¸€æ ·çš„ã€‚æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„. è‡ªåŠ¨è¾“å…¥éªŒè¯å¦‚æœæ‚¨æ˜¯Rxçš„æ–°æ‰‹ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªä¾‹å­å¯èƒ½ä¼šæœ‰ç‚¹è®©äººéš¾ä»¥æŠ—æ‹’ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ¼”ç¤ºRxSwiftä»£ç åœ¨ç°å®ä¸–ç•Œä¸­çš„æ ·å­. è¿™ä¸ªç¤ºä¾‹åŒ…å«å¤æ‚çš„async UIéªŒè¯é€»è¾‘ï¼Œå…¶ä¸­åŒ…å«äº†è¿›åº¦é€šçŸ¥ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½è¢«disposeBagå–æ¶ˆäº†ã€‚ è®©æˆ‘ä»¬æ¥è¯•ä¸€è¯•. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566enum Availability &#123; case available(message: String) case taken(message: String) case invalid(message: String) case pending(message: String) var message: String &#123; switch self &#123; case .available(message: let message), .taken(message: let message), .invalid(message: let message), .pending(message: let message): return message &#125; &#125;&#125;// ç›´æ¥ç»‘å®šUIæ§åˆ¶å€¼// ä½¿ç”¨`usernameOutlet`çš„`username`ä½œä¸ºusernameçš„å€¼æºself.usernameOutlet.rx.text .map &#123; username in // åŒæ­¥éªŒè¯ï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ if username.isEmpty &#123; // æ„å»ºåŒæ­¥ç»“æœçš„æ–¹ä¾¿æ€§. // å¦‚æœåœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­æœ‰æ··åˆçš„åŒæ­¥å’Œå¼‚æ­¥ä»£ç , // é‚£ä¹ˆè¿™å°†æ„é€ ä¸€ä¸ªç«‹å³è§£æçš„å¼‚æ­¥ç»“æœ. return Observable.just(Availability.invalid(message: \"Username can't be empty.\")) &#125; // ... // å½“å¼‚æ­¥æ“ä½œæ‰§è¡Œæ—¶ï¼Œç”¨æˆ·ç•Œé¢åº”è¯¥æ˜¾ç¤ºä¸€äº›çŠ¶æ€ let loadingValue = Availability.pending(message: \"Checking availability ...\") // è¿™å°†è§¦å‘ä¸€ä¸ªæœåŠ¡å™¨è°ƒç”¨æ¥æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²ç»å­˜åœ¨. // å®ƒçš„ç±»å‹æ˜¯ `Observable&lt;ValidationResult&gt;` return API.usernameAvailable(username) .map &#123; available in if available &#123; return Availability.available(message: \"Username available\") &#125; else &#123; return Availability.unavailable(message: \"Username already taken\") &#125; &#125; // ä½¿ç”¨ `loadingValue` ç›´åˆ°æœåŠ¡å™¨å“åº” .startWith(loadingValue) &#125;// å› ä¸ºæˆ‘ä»¬ç°åœ¨æœ‰ `Observable&lt;Observable&lt;ValidationResult&gt;&gt;`// æˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ªç®€å•çš„ `Observable&lt;ValidationResult&gt;`.// æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­çš„concatæ“ä½œç¬¦ï¼Œä½†æ˜¯å¦‚æœæä¾›äº†ä¸€ä¸ªæ–°çš„ç”¨æˆ·åï¼Œæˆ‘ä»¬ç¡®å®å¸Œæœ›å–æ¶ˆæ­£åœ¨ç­‰å¾…çš„å¼‚æ­¥æ“ä½œã€‚// è¿™å°±ä¸ºä»€ä¹ˆä½¿ç”¨ `switchLatest` äº†. .switchLatest()// ç°åœ¨æˆ‘ä»¬éœ€è¦å°†å®ƒç»‘å®šåˆ°ç”¨æˆ·ç•Œé¢.// å¥½çš„æ—§æ–¹æ³• `subscribe(onNext:)` èƒ½å¤Ÿå®ç°.// è¿™å°±æ˜¯`Observable`é“¾çš„æœ«ç«¯. .subscribe(onNext: &#123; validity in errorLabel.textColor = validationColor(validity) errorLabel.text = validity.message &#125;)// è¿™å°†ç”Ÿæˆä¸€ä¸ª`Disposable`å¯¹è±¡ï¼Œèƒ½è§£ç»‘æ‰€æœ‰äº‹å¹¶å–æ¶ˆæ­£åœ¨ç­‰å¾…çš„å¼‚æ­¥æ“ä½œã€‚// è€Œä¸æ˜¯æ‰‹åŠ¨æ“ä½œï¼Œè¿™å¾ˆéº»çƒ¦,// è®©æˆ‘ä»¬åœ¨view controller deallocæ—¶è‡ªåŠ¨å¤„ç†ä¸€åˆ‡. .disposed(by: disposeBag)","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift è®¾è®¡åŸç†","slug":"RxSwift-DesignRationale","date":"2017-10-26T02:13:53.000Z","updated":"2020-07-25T02:57:18.161Z","comments":true,"path":"2017/10/26/RxSwift-DesignRationale/","link":"","permalink":"https://jigangduan.github.io/2017/10/26/RxSwift-DesignRationale/","excerpt":"ä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ™®é€šçš„é”™è¯¯ç±»å‹","text":"ä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ™®é€šçš„é”™è¯¯ç±»å‹ 12345enum Event&lt;Element&gt; &#123; case next(Element) // next element of a sequence case error(Error) // sequence failed with error case completed // sequence terminated successfully&#125; è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹Errorçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªé€šç”¨çš„é”™è¯¯ç±»å‹ï¼Œæ‚¨å°†åœ¨ä¸¤ä¸ªobservablesä¹‹é—´åˆ›å»ºé¢å¤–çš„é˜»æŠ—å¤±é…ã€‚ å‡è®¾ä½ æœ‰: Observable&lt;String, E1&gt; å’Œ Observable&lt;String, E2&gt; å¦‚æœä¸çŸ¥é“æœ€ç»ˆçš„é”™è¯¯ç±»å‹å°†ä¼šæ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¤šå°‘å¯ä»¥åšçš„äº†ã€‚ æ˜¯E1ï¼ŒE2è¿˜æ˜¯ä¸€äº›æ–°çš„E3å‘¢?ä½ éœ€è¦ä¸€å¥—æ–°çš„è¿ç®—ç¬¦æ¥è§£å†³é˜»æŠ—å¤±é…ã€‚ è¿™æŸå®³äº†åˆæˆå±æ€§ï¼ŒRxä¸å…³å¿ƒä¸ºä»€ä¹ˆä¸€ä¸ªåºåˆ—å¤±è´¥äº†ï¼Œå®ƒé€šå¸¸ä¼šåœ¨observableé“¾ä¸Šè¿›ä¸€æ­¥å‘å‰æ¨è¿›ã€‚ è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„é—®é¢˜ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºæŸäº›å†…éƒ¨é”™è¯¯ï¼Œæ“ä½œç¬¦å¯èƒ½ä¼šå¤±è´¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å°†æ— æ³•æ„é€ ä¸€ä¸ªå…¸å‹é”™è¯¯å¹¶æŠ¥å‘Šå¤±è´¥ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡å®ƒï¼Œå‡è®¾æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¯¹ä¸å‡ºé”™çš„åºåˆ—è¿›è¡Œå»ºæ¨¡ã€‚å®ƒå¯¹è¿™ä¸ªç›®çš„æœ‰ç”¨å—? æ˜¯çš„ï¼Œå®ƒæœ‰å¯èƒ½æ˜¯ï¼Œä½†æ˜¯è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ä¸ºä»€ä¹ˆä½ æƒ³è¦ä½¿ç”¨ä¸ä¼šå‡ºé”™çš„åºåˆ—ã€‚ ä¸€ä¸ªå…¸å‹çš„åº”ç”¨æ˜¯åœ¨UIå±‚ä¸­ä¿æŒæµï¼Œé©±åŠ¨æ•´ä¸ªUIã€‚å½“æ‚¨è€ƒè™‘è¿™ç§æƒ…å†µæ—¶ï¼Œä»…ä»…ä½¿ç”¨ç¼–è¯‘å™¨æ¥è¯æ˜åºåˆ—ä¸ä¼šå‡ºé”™ï¼Œè¿™è¿˜ä¸å¤Ÿï¼Œæ‚¨è¿˜éœ€è¦è¯æ˜å…¶ä»–å±æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨MainSchedulerä¸Šè§‚å¯Ÿåˆ°è¿™äº›å…ƒç´ ã€‚ ä½ çœŸæ­£éœ€è¦çš„æ˜¯ä¸€ç§é€šç”¨çš„æ–¹æ³•æ¥è¯æ˜observableåºåˆ—çš„ç‰¹å¾ã€‚æœ‰å¾ˆå¤šä½ å¯èƒ½æ„Ÿå…´è¶£çš„å±æ€§ã€‚ä¾‹å¦‚: åºåˆ—åœ¨æœ‰é™æ—¶é—´å†…ç»ˆæ­¢(æœåŠ¡å™¨ç«¯) åºåˆ—åªåŒ…å«ä¸€ä¸ªå…ƒç´ (å¦‚æœæ‚¨æ­£åœ¨è¿è¡Œä¸€äº›è®¡ç®—) åºåˆ—ä¸ä¼šå‡ºé”™ï¼Œä¹Ÿä¸ä¼šç»ˆæ­¢ï¼Œå¹¶ä¸”å…ƒç´ åœ¨ä¸»è°ƒåº¦å™¨(UI) åºåˆ—ä¸ä¼šå‡ºé”™ï¼Œæ°¸è¿œä¸ä¼šç»ˆæ­¢ï¼Œå¹¶ä¸”å…ƒç´ åœ¨ä¸»è°ƒåº¦å™¨ä¸Šä¼ é€’ï¼Œå¹¶ä¸”é‡æ–°è®¡ç®—å…±äº«(UI) åºåˆ—ä¸ä¼šå‡ºé”™ï¼Œä¹Ÿä¸ä¼šç»ˆæ­¢ï¼Œå¹¶ä¸”å…ƒç´ åœ¨ç‰¹å®šçš„åå°è°ƒåº¦ç¨‹åºä¸­è¢«ä¼ é€(éŸ³é¢‘å¼•æ“) ä½ çœŸæ­£æƒ³è¦çš„æ˜¯ä¸€ä¸ªç”¨äºobservableåºåˆ—çš„ä¸€èˆ¬çš„ç¼–è¯‘å™¨å¼ºåˆ¶ç³»ç»Ÿï¼Œä»¥åŠä¸€ç»„ç”¨äºé‚£äº›æƒ³è¦å±æ€§çš„ä¸å˜é‡è¿ç®—ç¬¦ã€‚ ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç±»æ¯”: 121, 3.14, e, 2.79, 1 + 1i &lt;-&gt; Observable&lt;E&gt;1m/s, 1T, 5kg, 1.3 pounds &lt;-&gt; æ— é”™è¯¯observable, UI observable, æœ‰é™ observable ... åœ¨Swiftä¸­æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥é€šè¿‡ä½¿ç”¨ç»„åˆæˆ–ç»§æ‰¿observablesæ¥å®Œæˆè¿™æ ·çš„äº‹æƒ…ã€‚ ä½¿ç”¨å•å…ƒç³»ç»Ÿçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œæ‚¨å¯ä»¥è¯æ˜UIä»£ç åœ¨ç›¸åŒçš„è°ƒåº¦å™¨ä¸Šæ‰§è¡Œï¼Œå› æ­¤åœ¨æ‰€æœ‰è½¬æ¢ä¸­ä½¿ç”¨æ— é”çš„æ“ä½œç¬¦ã€‚ å› ä¸ºRxSwiftå·²ç»æ²¡æœ‰äº†å•ä¸ªåºåˆ—æ“ä½œçš„é”ï¼Œå¹¶ä¸”æ‰€æœ‰å­˜åœ¨çš„é”éƒ½æ˜¯æœ‰çŠ¶æ€çš„ç»„ä»¶(ä¾‹å¦‚UI)ï¼Œæ‰€ä»¥RxSwiftä»£ç ä¸­å‡ ä¹æ²¡æœ‰é”ï¼Œè¿™ä½¿å¾—ç¼–è¯‘å™¨å¯ä»¥å¼ºåˆ¶æ‰§è¡Œè¿™äº›ç»†èŠ‚ã€‚ åœ¨ä¿ç•™Rxç»„åˆè¯­ä¹‰çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨Erroré”™è¯¯ä¸èƒ½ä»¥å…¶ä»–æ›´å¹²å‡€çš„æ–¹å¼å®ç°ï¼Œè¿™æ˜¯æ²¡æœ‰å¥½å¤„çš„ã€‚","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"RxSwift","slug":"RxSwift","date":"2017-10-24T06:36:35.000Z","updated":"2020-07-25T02:57:18.164Z","comments":true,"path":"2017/10/24/RxSwift/","link":"","permalink":"https://jigangduan.github.io/2017/10/24/RxSwift/","excerpt":"ä»‹ç» ä¸ºä»€ä¹ˆä½¿ç”¨RxSwift æ¦‚å¿µ Observableså’Œobservers(è§‚å¯Ÿè€…)(aka subscribers è®¢é˜…è€…)(aka subscribers è®¢é˜…è€…)) åˆ›å»ºå’Œè®¢é˜…Observables never empty just of from create range repeatElement generate deferred error doOn Subjects PublishSubject ReplaySubject BehaviorSubject Variable åˆå¹¶æ“ä½œç¬¦ switchLatest combineLatest zip merge startWith è½¬æ¢æ“ä½œç¬¦ map flatMap å’Œ flatMapLatest scan è¿‡æ»¤å’Œæ¡ä»¶è¿ç®—ç¬¦ filter distinctUntilChanged elementAt single take takeLast takeWhile takeUntil skip skipWhile skipWhileWithIndex skipUntil æ•°å­¦è¿ç®—åŠèšåˆæ“ä½œç¬¦ toArray reduce concat è¿æ¥æ“ä½œç¬¦ é”™è¯¯å¤„ç†æ“ä½œç¬¦ catchErrorJustReturn catchError retry retry(_:) è°ƒè¯•æ“ä½œç¬¦ debug RxSwift.Resources.total ä½¿èƒ½RxSwift.Resources.total","text":"ä»‹ç» ä¸ºä»€ä¹ˆä½¿ç”¨RxSwift æ¦‚å¿µ Observableså’Œobservers(è§‚å¯Ÿè€…)(aka subscribers è®¢é˜…è€…)(aka subscribers è®¢é˜…è€…)) åˆ›å»ºå’Œè®¢é˜…Observables never empty just of from create range repeatElement generate deferred error doOn Subjects PublishSubject ReplaySubject BehaviorSubject Variable åˆå¹¶æ“ä½œç¬¦ switchLatest combineLatest zip merge startWith è½¬æ¢æ“ä½œç¬¦ map flatMap å’Œ flatMapLatest scan è¿‡æ»¤å’Œæ¡ä»¶è¿ç®—ç¬¦ filter distinctUntilChanged elementAt single take takeLast takeWhile takeUntil skip skipWhile skipWhileWithIndex skipUntil æ•°å­¦è¿ç®—åŠèšåˆæ“ä½œç¬¦ toArray reduce concat è¿æ¥æ“ä½œç¬¦ é”™è¯¯å¤„ç†æ“ä½œç¬¦ catchErrorJustReturn catchError retry retry(_:) è°ƒè¯•æ“ä½œç¬¦ debug RxSwift.Resources.total ä½¿èƒ½RxSwift.Resources.total ä»‹ç»ä¸ºä»€ä¹ˆä½¿ç”¨RxSwift ?æˆ‘ä»¬ç¼–å†™çš„ç»å¤§å¤šæ•°ä»£ç éƒ½ä¼šæ¶‰åŠåˆ°å¯¹å¤–éƒ¨äº‹ä»¶çš„å“åº”ã€‚ å½“ç”¨æˆ·æ“ä½œä¸€ä¸ªcontrolæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª@IBActionæ–¹æ³•å¤„ç†å“åº”ã€‚ å½“é”®ç›˜ä½•æ—¶æ”¹å˜ä½ç½®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯Ÿé€šçŸ¥æ¥æ£€æµ‹ã€‚ å½“URLä¼šè¯å“åº”ç½‘ç»œæ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›é—­åŒ…æ¥æ‰§è¡Œã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨KVOæ¥æ£€æµ‹å˜é‡çš„å˜åŒ–ã€‚ æ‰€æœ‰è¿™äº›ä¸åŒçš„æ–¹æ³•ä½¿æˆ‘ä»¬çš„ä»£ç å˜å¾—ä¸å¿…è¦åœ°å¤æ‚ã€‚å¦‚æœæœ‰ä¸€ä¸ªä¸€è‡´æ€§çš„æ–¹å¼æ¥å¤„ç†æˆ‘ä»¬çš„æ‰€æœ‰çš„è°ƒç”¨/å“åº”ï¼Œéš¾é“ä¸æ˜¯æ›´å¥½å—?Rxå°±æ˜¯è¿™æ ·ä¸€ä¸ªæœºåˆ¶ã€‚ RxSwiftæ˜¯ Reactiveï¼ˆRxï¼‰çš„æ­£å¼å®ç°, å¤§å¤šæ•°ä¸»è¦è¯­è¨€å’Œå¹³å°éƒ½æœ‰ã€‚ æ¦‚å¿µ æ¯ä¸ªå¯è§‚å¯Ÿ(Observable)å®ä¾‹éƒ½æ˜¯ä¸€ä¸ªåºåˆ—(Sequence)ã€‚ å¯è§‚å¯Ÿ(Observable)åºåˆ—ä¸Swiftåºåˆ—çš„å…³é”®ä¼˜åŠ¿åœ¨äºï¼Œå®ƒè¿˜å¯ä»¥å¼‚æ­¥åœ°æ¥æ”¶å…ƒç´ ã€‚è¿™å°±æ˜¯RxSwiftçš„ç²¾é«“æ‰€åœ¨ã€‚å…¶ä»–çš„ä¸€åˆ‡éƒ½æ‰©å±•äº†è¿™ä¸ªæ¦‚å¿µã€‚ ä¸€ä¸ªObservable(ObservableType)ç›¸å½“äºä¸€ä¸ªåºåˆ—(Sequence)ã€‚ ObservableType.subscribe(_:)æ–¹æ³•ç›¸å½“äºSequence.makeIterator()ã€‚ ObservableType.subscribe(_:)æ¥æ”¶ä¸€ä¸ªobserver(è§‚å¯Ÿè€…)(ObserverType)å‚æ•°ï¼Œå®ƒå°†è¢«è®¢é˜…è‡ªåŠ¨æ¥æ”¶ç”±Observableå‘å°„çš„åºåˆ—äº‹ä»¶å’Œå…ƒç´ ï¼Œè€Œä¸æ˜¯åœ¨è¿”å›çš„ç”Ÿæˆå™¨ä¸Šæ‰‹åŠ¨è°ƒç”¨next()ã€‚ å¦‚æœä¸€ä¸ªObservableå‘å‡ºäº†nextäº‹ä»¶(Event.next(Element))ï¼Œå®ƒå¯ä»¥ç»§ç»­å‘å‡ºæ›´å¤šçš„äº‹ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœObservableå‘å‡ºäº†ä¸€ä¸ªerroräº‹ä»¶(Event.error(ErrorType))æˆ–ä¸€ä¸ªcompletedäº‹ä»¶(Event.completed)ï¼ŒObservableåºåˆ—å°±ä¸èƒ½å†å‘è®¢é˜…è€…å‘å‡ºå…¶å®ƒçš„äº‹ä»¶äº†ã€‚ é¡ºåºè¯­æ³•æ›´ç®€æ˜åœ°è§£é‡Šäº†è¿™ä¸€ç‚¹: next* (error | completed)? è¿™ä¹Ÿå¯ä»¥ç”¨å›¾è¡¨æ¥æ›´ç›´è§‚åœ°è§£é‡Š: 12345--1--2--3--4--5--6--|----&gt; // &quot;|&quot; = æ­£å¸¸ç»ˆæ­¢--a--b--c--d--e--f--X----&gt; // &quot;X&quot; = ç»ˆæ­¢ä¸ä¸€ä¸ªé”™è¯¯--tap--tap----------tap--&gt; // &quot;|&quot; = æ— é™æœŸåœ°ç»§ç»­ä¸‹å»ï¼Œæ¯”å¦‚æŒ‰é’®æŒ‰ä¸‹çš„åºåˆ— è¿™äº›å›¾è¡¨è¢«ç§°ä¸ºå¤§ç†çŸ³å›¾è¡¨ã€‚ä½ å¯ä»¥åœ¨RxMarbles.comä¸Šäº†è§£æ›´å¤šå…³äºä»–ä»¬çš„ä¿¡æ¯ã€‚ Observableså’Œobservers(è§‚å¯Ÿè€…)(aka subscribers è®¢é˜…è€…)é™¤éæœ‰è®¢é˜…è€…ï¼Œå¦åˆ™Observablesä¸ä¼šæ‰§è¡Œä»–ä»¬çš„è®¢é˜…é—­åŒ…ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒObservableçš„é—­åŒ…å°†æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºæ²¡æœ‰è®¢é˜…è€…: 12345678example(\"Observable with no subscribers\") &#123; _ = Observable&lt;String&gt;.create &#123; observerOfString -&gt; Disposable in print(\"This will never be printed\") observerOfString.on(.next(\"ğŸ˜¬\")) observerOfString.on(.completed) return Disposables.create() &#125;&#125; åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå½“subscribe(_:)è¢«è°ƒç”¨æ—¶ï¼Œé—­åŒ…å°†è¢«æ‰§è¡Œã€‚ 1234567891011example(\"Observable with subscriber\") &#123; _ = Observable&lt;String&gt;.create &#123; observerOfString in print(\"Observable created\") observerOfString.on(.next(\"ğŸ˜‰\")) observerOfString.on(.completed) return Disposables.create() &#125; .subscribe &#123; event in print(event) &#125;&#125; subscribe(_:)è¿”å›ä¸€ä¸ªDisposableå®ä¾‹ï¼Œè¯¥å®ä¾‹è¡¨ç¤ºä¸€ä¸ªå¯ä½¿ç”¨çš„èµ„æºï¼Œå¦‚è®¢é˜…ã€‚åœ¨å‰é¢çš„ç®€å•ç¤ºä¾‹ä¸­ï¼Œå®ƒè¢«å¿½ç•¥äº†ï¼Œä½†æ˜¯åº”è¯¥æ­£å¸¸åœ°å¤„ç†å®ƒã€‚è¿™é€šå¸¸æ„å‘³ç€å°†å®ƒæ·»åŠ åˆ°ä¸€ä¸ªDisposeBagå®ä¾‹ä¸­ã€‚æ‰€æœ‰çš„ä¾‹å­éƒ½å°†åŒ…æ‹¬æ­£ç¡®çš„å¤„ç†ï¼Œå› ä¸ºï¼Œå®è·µæ˜¯æ°¸ä¹…çš„ğŸ™‚ã€‚æ‚¨å¯ä»¥åœ¨å…¥é—¨æŒ‡å—çš„å¤„ç†éƒ¨åˆ†ä¸­äº†è§£æ›´å¤šå…³äºæ­¤çš„ä¿¡æ¯ã€‚ åˆ›å»ºå’Œè®¢é˜…Observablesæœ‰å‡ ç§æ–¹æ³•å¯ä»¥åˆ›å»ºå’Œè®¢é˜…Observableåºåˆ—ã€‚ neveråˆ›å»ºä¸€ä¸ªæ°¸ä¸ç»ˆæ­¢ä¸”ä»ä¸å‘å‡ºä»»ä½•äº‹ä»¶çš„åºåˆ—ã€‚æ›´å¤šä¿¡æ¯ 1234567891011example(\"never\") &#123; let disposeBag = DisposeBag() let neverSequence = Observable&lt;String&gt;.never() let neverSequenceSubscription = neverSequence .subscribe &#123; _ in print(\"This will never be printed\") &#125; neverSequenceSubscription.disposed(by: disposeBag)&#125; emptyåˆ›å»ºä¸€ä¸ªç©ºçš„å¯è§‚å¯Ÿåºåˆ—ï¼Œå®ƒåªä¼šå‘å‡ºä¸€ä¸ªå·²å®Œæˆçš„äº‹ä»¶ã€‚æ›´å¤šä¿¡æ¯ 123456789example(\"empty\") &#123; let disposeBag = DisposeBag() Observable&lt;Int&gt;.empty() .subscribe &#123; event in print(event) &#125; .disposed(by: disposeBag)&#125; è¿™ä¸ªä¾‹å­è¿˜ä»‹ç»äº†è¿æ¥åˆ›å»ºå’Œè®¢é˜…å¯è§‚å¯Ÿåºåˆ—çš„é“¾æ¥ã€‚ justç”¨ä¸€ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ã€‚æ›´å¤šä¿¡æ¯ 123456789example(\"just\") &#123; let disposeBag = DisposeBag() Observable.just(\"ğŸ”´\") .subscribe &#123; event in print(event) &#125; .disposed(by: disposeBag)&#125; ofç”¨å›ºå®šæ•°é‡çš„å…ƒç´ åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ã€‚ 123456789example(\"of\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ¶\", \"ğŸ±\", \"ğŸ­\", \"ğŸ¹\") .subscribe(onNext: &#123; element in print(element) &#125;) .disposed(by: disposeBag)&#125; è¿™ä¸ªä¾‹å­è¿˜ä»‹ç»äº†ä½¿ç”¨subscribe(onNext:)ä¾¿åˆ©æ–¹æ³•ã€‚ä¸åŒäºsubscribe(:)ï¼Œå®ƒè®¢é˜…äº†æ‰€æœ‰äº‹ä»¶ç±»å‹çš„äº‹ä»¶(Next, Error, Completed)ï¼Œsubscribe(onNext:)è®¢é˜…ä¸€ç§å…ƒç´ ï¼Œå®ƒå°†å¿½ç•¥Errorå’ŒCompletedçš„äº‹ä»¶ï¼Œå¹¶ä¸”åªç”ŸæˆNextäº‹ä»¶å…ƒç´ ã€‚è¿˜æœ‰subscribe(onError:)å’Œsubscribe(on:)çš„ä¾¿åˆ©æ–¹æ³•ã€‚å’Œæœ‰ä¸€ä¸ªsubscribe(onNext:onError:oncomplete:onDisposed:)çš„æ–¹æ³•,ä½ å¯ä»¥å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ç±»å‹å’Œè®¢é˜…æ—¶ç”±äºä»»ä½•åŸå› ç»ˆæ­¢,æˆ–å¤„ç†: Example 1234567&gt; someObservable.subscribe( onNext: &#123; print(&quot;Element:&quot;, $0) &#125;, onError: &#123; print(&quot;Error:&quot;, $0) &#125;, onCompleted: &#123; print(&quot;Completed&quot;) &#125;, onDisposed: &#123; print(&quot;Disposed&quot;) &#125;)&gt; fromä»é›†åˆä¸­åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿçš„åºåˆ—ï¼Œå¦‚Arrayã€Dictionaryæˆ–Setã€‚ 1234567example(\"from\") &#123; let disposeBag = DisposeBag() Observable.from([\"ğŸ¶\", \"ğŸ±\", \"ğŸ­\", \"ğŸ¹\"]) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; è¿™ä¸ªä¾‹å­è¿˜æ¼”ç¤ºäº†ä½¿ç”¨é»˜è®¤å‚æ•°$0è€Œä¸æ˜¯æ˜¾å¼åœ°å‘½åå‚æ•°ã€‚ createåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è§‚å¯Ÿåºåˆ—ã€‚æ›´å¤šä¿¡æ¯ 123456789101112131415example(\"create\") &#123; let disposeBag = DisposeBag() let myJust = &#123; (element: String) -&gt; Observable&lt;String&gt; in return Observable.create &#123; observer in observer.on(.next(element)) observer.on(.completed) return Disposables.create() &#125; &#125; myJust(\"ğŸ”´\") .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)&#125; rangeåˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ï¼Œå®ƒä¼šé‡Šæ”¾ä¸€ç³»åˆ—é¡ºåºçš„æ•´æ•°ï¼Œç„¶åç»ˆæ­¢ã€‚æ›´å¤šä¿¡æ¯ 1234567example(\"range\") &#123; let disposeBag = DisposeBag() Observable.range(start: 1, count: 10) .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)&#125; repeatElementåˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿçš„åºåˆ—ï¼Œå®ƒå¯ä»¥æ— é™åœ°é‡Šæ”¾ç»™å®šçš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"repeatElement\") &#123; let disposeBag = DisposeBag() Observable.repeatElement(\"ğŸ”´\") .take(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; è¿™ä¸ªä¾‹å­è¿˜ä»‹ç»äº†ä½¿ç”¨takeæ“ä½œç¬¦ä»ä¸€ä¸ªåºåˆ—å¼€å§‹è¿”å›æŒ‡å®šæ•°é‡çš„å…ƒç´ ã€‚ generateåˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ï¼Œåªè¦æä¾›çš„æ¡ä»¶å€¼ä¸ºtrueï¼Œå°±å¯ä»¥ç”Ÿæˆå€¼ã€‚ 1234567891011example(\"generate\") &#123; let disposeBag = DisposeBag() Observable.generate( initialState: 0, condition: &#123; $0 &lt; 3 &#125;, iterate: &#123; $0 + 1 &#125; ) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; deferredä¸ºæ¯ä¸ªè®¢é˜…è€…åˆ›å»ºä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿåºåˆ—ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122232425example(\"deferred\") &#123; let disposeBag = DisposeBag() var count = 1 let deferredSequence = Observable&lt;String&gt;.deferred &#123; print(\"Creating \\(count)\") count += 1 return Observable.create &#123; observer in print(\"Emitting...\") observer.onNext(\"ğŸ¶\") observer.onNext(\"ğŸ±\") observer.onNext(\"ğŸµ\") return Disposables.create() &#125; &#125; deferredSequence .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) deferredSequence .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; erroråˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ï¼Œè¯¥åºåˆ—ä¸ä¼šå‘é€ä»»ä½•æ¡ç›®ï¼Œå¹¶ç«‹å³ç»ˆæ­¢é”™è¯¯ã€‚ 1234567example(\"error\") &#123; let disposeBag = DisposeBag() Observable&lt;Int&gt;.error(TestError.test) .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)&#125; doOnä¸ºæ¯ä¸ªå‘å‡ºçš„äº‹ä»¶è°ƒç”¨ä¸€ä¸ªå‰¯æ“ä½œï¼Œå¹¶è¿”å›(é€šè¿‡)åŸå§‹äº‹ä»¶ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"doOn\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ\", \"ğŸ\", \"ğŸŠ\", \"ğŸ‹\") .do(onNext: &#123; print(\"Intercepted:\", $0) &#125;, onError: &#123; print(\"Intercepted error:\", $0) &#125;, onCompleted: &#123; print(\"Completed\") &#125;) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; è¿˜æœ‰ doOnNext(:), doOnError(:), doOnCompleted(_:)ä¾¿åˆ©æ–¹æ³•æ‹¦æˆªè¿™äº›ç‰¹å®šäº‹ä»¶,å’ŒdoOn(onNext:onError:oncomplete)æ‹¦æˆªä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ã€‚ Subjectsä¸»é¢˜ ä¸»é¢˜æ˜¯ä¸€ç§æ¡¥æ¢æˆ–ä»£ç†ï¼Œå®ƒåœ¨Rxçš„æŸäº›å®ç°ä¸­å¯ç”¨ï¼Œå®ƒæ—¢æ˜¯è§‚å¯Ÿè€…(observer)ï¼Œä¹Ÿæ˜¯å¯è§‚å¯Ÿå¯¹è±¡(Observable)ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå®ƒå¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œå®ƒå¯ä»¥é€šè¿‡å®ƒæ‰€è§‚å¯Ÿåˆ°çš„äº‹ä»¶é‡æ–°å‘å°„å®ƒä»¬ï¼Œå®ƒä¹Ÿå¯ä»¥å‘å°„æ–°çš„äº‹ä»¶ã€‚æ›´å¤šä¿¡æ¯ 1234567891011121314151617extension ObservableType &#123; /** Add observer with `id` and print each emitted event. - parameter id: an identifier for the subscription. */ func addObserver(_ id: String) -&gt; Disposable &#123; return subscribe &#123; print(\"Subscription:\", id, \"Event:\", $0) &#125; &#125;&#125;func writeSequenceToConsole&lt;O: ObservableType&gt;(name: String, sequence: O) -&gt; Disposable &#123; return sequence.subscribe &#123; event in print(\"Subscription: \\(name), event: \\(event)\") &#125;&#125; PublishSubjectå‘æ‰€æœ‰çš„è§‚å¯Ÿè€…å¹¿æ’­æ–°çš„äº‹ä»¶ï¼Œä»ä»–ä»¬è®¢é˜…æ—¶å¼€å§‹ã€‚ 123456789101112example(\"PublishSubject\") &#123; let disposeBag = DisposeBag() let subject = PublishSubject&lt;String&gt;() subject.addObserver(\"1\").disposed(by: disposeBag) subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") subject.addObserver(\"2\").disposed(by: disposeBag) subject.onNext(\"ğŸ…°ï¸\") subject.onNext(\"ğŸ…±ï¸\")&#125; è¿™ä¸ªä¾‹å­è¿˜ä»‹ç»äº†ä½¿ç”¨onNext(:)ä¾¿åˆ©æ–¹æ³•ï¼Œå®ƒç­‰ä»·äºon(.next(:)ï¼Œå®ƒä¼šå°†ä¸€ä¸ªæ–°äº‹ä»¶å‘é€ç»™å¸¦æœ‰æ‰€æä¾›å…ƒç´ çš„è®¢é˜…è€…ã€‚è¿˜æœ‰onError(:)å’ŒonCompleted()ä¾¿åˆ©æ–¹æ³•ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”äºon(.error(:))å’Œon(.completed)ã€‚ ReplaySubjectå‘æ‰€æœ‰è®¢é˜…è€…å¹¿æ’­æ–°äº‹ä»¶ï¼Œå¹¶å‘æ–°è®¢æˆ·æŒ‡å®šç‰¹å®šç¼“å†²åŒºå¤§å°çš„å…ˆå‰äº‹ä»¶ã€‚ 123456789101112example(\"ReplaySubject\") &#123; let disposeBag = DisposeBag() let subject = ReplaySubject&lt;String&gt;.create(bufferSize: 1) subject.addObserver(\"1\").disposed(by: disposeBag) subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") subject.addObserver(\"2\").disposed(by: disposeBag) subject.onNext(\"ğŸ…°ï¸\") subject.onNext(\"ğŸ…±ï¸\")&#125; BehaviorSubjectå‘æ‰€æœ‰è®¢é˜…è€…å¹¿æ’­æ–°äº‹ä»¶ï¼Œä»¥åŠæœ€è¿‘(æˆ–æœ€åˆ)å¯¹æ–°è®¢æˆ·çš„äº‹ä»¶ã€‚ 12345678910111213141516example(\"BehaviorSubject\") &#123; let disposeBag = DisposeBag() let subject = BehaviorSubject(value: \"ğŸ”´\") subject.addObserver(\"1\").disposed(by: disposeBag) subject.onNext(\"ğŸ¶\") subject.onNext(\"ğŸ±\") subject.addObserver(\"2\").disposed(by: disposeBag) subject.onNext(\"ğŸ…°ï¸\") subject.onNext(\"ğŸ…±ï¸\") subject.addObserver(\"3\").disposed(by: disposeBag) subject.onNext(\"ğŸ\") subject.onNext(\"ğŸŠ\")&#125; æ³¨æ„å‰é¢çš„ä¾‹å­ä¸­é—æ¼äº†ä»€ä¹ˆ?ä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶ã€‚PublishSubjectã€ReplaySubjectå’ŒBehaviorSubjectåœ¨å³å°†disposedæ—¶ä¸ä¼šè‡ªåŠ¨å‘å‡ºCompletedäº‹ä»¶ã€‚ VariableåŒ…è£…ä¸€ä¸ªBehaviorSubjectï¼Œå› æ­¤å®ƒå°†å‘æ–°è®¢æˆ·å‘é€æœ€æ–°(æˆ–åˆå§‹)å€¼ã€‚å˜é‡ä¹Ÿä¿æŒå½“å‰çš„å€¼çŠ¶æ€ã€‚å˜é‡æ°¸è¿œä¸ä¼šå‘å‡ºé”™è¯¯äº‹ä»¶ã€‚ä½†æ˜¯ï¼Œå®ƒå°†è‡ªåŠ¨å‘å‡ºä¸€ä¸ªå·²å®Œæˆçš„äº‹ä»¶ï¼Œå¹¶åœ¨deinitä¸Šç»ˆæ­¢ã€‚ 123456789101112example(\"Variable\") &#123; let disposeBag = DisposeBag() let variable = Variable(\"ğŸ”´\") variable.asObservable().addObserver(\"1\").disposed(by: disposeBag) variable.value = \"ğŸ¶\" variable.value = \"ğŸ±\" variable.asObservable().addObserver(\"2\").disposed(by: disposeBag) variable.value = \"ğŸ…°ï¸\" variable.value = \"ğŸ…±ï¸\"&#125; åœ¨ä¸€ä¸ªVariableå®ä¾‹ä¸Šè°ƒç”¨asObservable()å¯ä»¥è®¿é—®å…¶åŸºç¡€çš„BehaviorSubjectåºåˆ—ã€‚å˜é‡æ²¡æœ‰å®ç°onè¿ç®—ç¬¦(æˆ–onNext(:))ï¼Œè€Œæ˜¯å…¬å¼€ä¸€ä¸ªå¯ç”¨äºè·å–å½“å‰å€¼çš„valueå±æ€§ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªæ–°å€¼ã€‚è®¾ç½®ä¸€ä¸ªæ–°å€¼ä¹Ÿä¼šå°†è¯¥å€¼æ·»åŠ åˆ°å…¶åŸºç¡€BehaviorSubjectåºåˆ—ä¸­ã€‚ åˆå¹¶æ“ä½œç¬¦å°†å¤šä¸ªæºObservablesç»„åˆæˆä¸€ä¸ªObservableçš„æ“ä½œç¬¦ã€‚ startWithåœ¨å¯è§‚å¯Ÿçš„æºå¼€å§‹å‘å°„å…ƒç´ ä¹‹å‰ï¼Œå‘å°„æŒ‡å®šçš„å…ƒç´ åºåˆ—ã€‚æ›´å¤šä¿¡æ¯ 12345678910example(\"startWith\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ¶\", \"ğŸ±\", \"ğŸ­\", \"ğŸ¹\") .startWith(\"1ï¸âƒ£\") .startWith(\"2ï¸âƒ£\") .startWith(\"3ï¸âƒ£\", \"ğŸ…°ï¸\", \"ğŸ…±ï¸\") .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; mergeå°†æºå¯è§‚å¯Ÿåºåˆ—ä¸­çš„å…ƒç´ ç»„åˆæˆä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿåºåˆ—ï¼Œå¹¶åœ¨æ¯ä¸ªæºå¯è§‚å¯Ÿåºåˆ—ä¸­é‡Šæ”¾å‡ºæ¯ä¸ªå…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 1234567891011121314151617181920212223example(\"merge\") &#123; let disposeBag = DisposeBag() let subject1 = PublishSubject&lt;String&gt;() let subject2 = PublishSubject&lt;String&gt;() Observable.of(subject1, subject2) .merge() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) subject1.onNext(\"ğŸ…°ï¸\") subject1.onNext(\"ğŸ…±ï¸\") subject2.onNext(\"â‘ \") subject2.onNext(\"â‘¡\") subject1.onNext(\"ğŸ†\") subject2.onNext(\"â‘¢\")&#125; zipå°†å¤šè¾¾8ä¸ªæºå¯è§‚å¯Ÿåºåˆ—ç»„åˆæˆä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿåºåˆ—ï¼Œå¹¶å°†ä»ç»„åˆçš„å¯è§‚å¯Ÿåºåˆ—ä¸­å‘å°„å‡ºç›¸åº”çš„å¯è§‚å¯Ÿåºåˆ—çš„å„ä¸ªå…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122example(\"zip\") &#123; let disposeBag = DisposeBag() let stringSubject = PublishSubject&lt;String&gt;() let intSubject = PublishSubject&lt;Int&gt;() Observable.zip(stringSubject, intSubject) &#123; stringElement, intElement in \"\\(stringElement) \\(intElement)\" &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) stringSubject.onNext(\"ğŸ…°ï¸\") stringSubject.onNext(\"ğŸ…±ï¸\") intSubject.onNext(1) intSubject.onNext(2) stringSubject.onNext(\"ğŸ†\") intSubject.onNext(3)&#125; combineLatestå°†æœ€å¤š8ä¸ªæºå¯è§‚å¯Ÿåºåˆ—ç»„åˆæˆä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿåºåˆ—åºåˆ—,å¹¶å°†å¼€å§‹å‘å‡ºè”åˆå¯è§‚å¯Ÿåºåˆ—çš„æ¯ä¸ªæºçš„æœ€æ–°å…ƒç´ å¯è§‚æµ‹åºåˆ—ä¸€æ—¦æ‰€æœ‰æ’æ”¾æºåºåˆ—è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ ,å¹¶ä¸”å½“æºå¯è§‚æµ‹åºåˆ—å‘å‡ºçš„ä»»ä½•ä¸€ä¸ªæ–°å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 123456789101112131415161718192021example(\"combineLatest\") &#123; let disposeBag = DisposeBag() let stringSubject = PublishSubject&lt;String&gt;() let intSubject = PublishSubject&lt;Int&gt;() Observable.combineLatest(stringSubject, intSubject) &#123; stringElement, intElement in \"\\(stringElement) \\(intElement)\" &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) stringSubject.onNext(\"ğŸ…°ï¸\") stringSubject.onNext(\"ğŸ…±ï¸\") intSubject.onNext(1) intSubject.onNext(2) stringSubject.onNext(\"ğŸ†\")&#125; è¿˜æœ‰ä¸€ä¸ªcombineLatestçš„å˜ä½“ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªæ•°ç»„(æˆ–ä»»ä½•å…¶ä»–å¯è§‚å¯Ÿåºåˆ—çš„é›†åˆ): 12345678910111213example(\"Array.combineLatest\") &#123; let disposeBag = DisposeBag() let stringObservable = Observable.just(\"â¤ï¸\") let fruitObservable = Observable.from([\"ğŸ\", \"ğŸ\", \"ğŸŠ\"]) let animalObservable = Observable.of(\"ğŸ¶\", \"ğŸ±\", \"ğŸ­\", \"ğŸ¹\") Observable.combineLatest([stringObservable, fruitObservable, animalObservable]) &#123; \"\\($0[0]) \\($0[1]) \\($0[2])\" &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; ç”±äºcombineLatestå˜ä½“é‡‡ç”¨å°†æ•°ç»„ä¼ é€’ç»™é€‰æ‹©å™¨å‡½æ•°ï¼Œæ‰€ä»¥å®ƒè¦æ±‚æ‰€æœ‰çš„æºå¯è§‚å¯Ÿåºåˆ—éƒ½æ˜¯ç›¸åŒç±»å‹çš„ã€‚ switchLatestå°†å¯è§‚å¯Ÿåºåˆ—å‘å°„çš„å…ƒç´ è½¬æ¢æˆå¯è§‚å¯Ÿçš„åºåˆ—ï¼Œå¹¶ä»æœ€è¿‘çš„å†…éƒ¨å¯è§‚å¯Ÿåºåˆ—ä¸­é‡Šæ”¾å‡ºå…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122example(\"switchLatest\") &#123; let disposeBag = DisposeBag() let subject1 = BehaviorSubject(value: \"âš½ï¸\") let subject2 = BehaviorSubject(value: \"ğŸ\") let variable = Variable(subject1) variable.asObservable() .switchLatest() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) subject1.onNext(\"ğŸˆ\") subject1.onNext(\"ğŸ€\") variable.value = subject2 subject1.onNext(\"âš¾ï¸\") subject2.onNext(\"ğŸ\")&#125; åœ¨æœ¬ä¾‹ä¸­ï¼Œåœ¨è®¾ç½®variable.valueä¸ºsubject2åæ·»åŠ âš¾ï¸åˆ°subject1æ²¡æœ‰æ•ˆæœï¼Œå› ä¸ºåªæœ‰æœ€è¿‘çš„å†…å¯è§‚å¯Ÿåºåˆ—(subject2)æ‰ä¼šå‘å°„å…ƒç´ ã€‚ è½¬æ¢æ“ä½œç¬¦é€šè¿‡å¯è§‚å¯Ÿçš„åºåˆ—å¯¹ä¸‹ä¸€ä¸ªäº‹ä»¶å…ƒç´ è¿›è¡Œè½¬æ¢çš„æ“ä½œç¬¦ã€‚ 1234567example(\"map\") &#123; let disposeBag = DisposeBag() Observable.of(1, 2, 3) .map &#123; $0 * $0 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; mapå°†ä¸€ä¸ªè½¬æ¢é—­åŒ…åº”ç”¨åˆ°å¯è§‚å¯Ÿåºåˆ—æ‰€å‘å°„çš„å…ƒç´ ä¸Šï¼Œå¹¶è¿”å›è½¬æ¢åçš„å…ƒç´ çš„ä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿåºåˆ—ã€‚æ›´å¤šä¿¡æ¯ flatMap å’Œ flatMapLatestå°†å¯è§‚å¯Ÿåºåˆ—å‘å°„çš„å…ƒç´ è½¬æ¢æˆå¯è§‚å¯Ÿçš„åºåˆ—ï¼Œå¹¶å°†ä¸¤ä¸ªå¯è§‚æµ‹åºåˆ—çš„æ’æ”¾é‡åˆå¹¶æˆä¸€ä¸ªå¯è§‚å¯Ÿçš„åºåˆ—ã€‚å½“ä½ æœ‰ä¸€ä¸ªå¯è§‚å¯Ÿçš„åºåˆ—ï¼Œå®ƒæœ¬èº«ä¼šå‘å‡ºå¯è§‚æµ‹çš„åºåˆ—ï¼Œä½ æƒ³è¦èƒ½å¤Ÿå¯¹ä»»ä½•å¯è§‚å¯Ÿåºåˆ—çš„æ–°æ’æ”¾åšå‡ºååº”ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚flatMapå’ŒflatMapLatestçš„åŒºåˆ«åœ¨äºï¼ŒflatMapLateståªä¼šä»æœ€è¿‘çš„å†…éƒ¨å¯è§‚å¯Ÿåºåˆ—ä¸­å‘å°„å‡ºå…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122232425example(\"flatMap and flatMapLatest\") &#123; let disposeBag = DisposeBag() struct Player &#123; var score: Variable&lt;Int&gt; &#125; let ğŸ‘¦ğŸ» = Player(score: Variable(80)) let ğŸ‘§ğŸ¼ = Player(score: Variable(90)) let player = Variable(ğŸ‘¦ğŸ») player.asObservable() .flatMap &#123; $0.score.asObservable() &#125; // Change flatMap to flatMapLatest and observe change in printed output .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) ğŸ‘¦ğŸ».score.value = 85 player.value = ğŸ‘§ğŸ¼ ğŸ‘¦ğŸ».score.value = 95 // Will be printed when using flatMap, but will not be printed when using flatMapLatest ğŸ‘§ğŸ¼.score.value = 100&#125; flatMapLatestå®é™…ä¸Šæ˜¯mapå’ŒswitchLatestæ“ä½œç¬¦çš„ç»“åˆã€‚ scanä»ä¸€ä¸ªåˆå§‹å€¼å¼€å§‹ï¼Œç„¶åå¯¹ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—å‘å°„çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªç´¯åŠ å™¨é—­åŒ…ï¼Œå¹¶å°†æ¯ä¸ªä¸­é—´ç»“æœä½œä¸ºä¸€ä¸ªå•å…ƒç´ å¯è§‚å¯Ÿçš„åºåˆ—è¿”å›ã€‚æ›´å¤šä¿¡æ¯ 12345678910example(\"scan\") &#123; let disposeBag = DisposeBag() Observable.of(10, 100, 1000) .scan(1) &#123; aggregateValue, newValue in aggregateValue + newValue &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; è¿‡æ»¤å’Œæ¡ä»¶è¿ç®—ç¬¦æœ‰é€‰æ‹©æ€§åœ°ä»ä¸€ä¸ªå¯è§‚å¯Ÿåˆ°çš„åºåˆ—ä¸­å‘å°„å…ƒç´ çš„æ“ä½œè€…ã€‚ filteråªä»å¯è§‚å¯Ÿçš„åºåˆ—ä¸­å‘å°„å‡ºç¬¦åˆæŒ‡å®šæ¡ä»¶çš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213example(\"filter\") &#123; let disposeBag = DisposeBag() Observable.of( \"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ±\", \"ğŸ°\", \"ğŸ¹\", \"ğŸ¸\", \"ğŸ±\") .filter &#123; $0 == \"ğŸ±\" &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; distinctUntilChangedæŠ‘åˆ¶å¯è§‚å¯Ÿåºåˆ—å‘å‡ºçš„åºåˆ—é‡å¤å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"distinctUntilChanged\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ·\", \"ğŸ±\", \"ğŸ±\", \"ğŸ±\", \"ğŸµ\", \"ğŸ±\") .distinctUntilChanged() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; 1&quot;ğŸ±&quot; &quot;ğŸ·&quot; &quot;ğŸ±&quot; &quot;ğŸµ&quot; &quot;ğŸ±&quot; elementAtåªåœ¨ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—æ‰€å‘å°„æŒ‡å®šç´¢å¼•ä¸­çš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"elementAt\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .elementAt(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; 1&quot;ğŸ¸&quot; singleåªå‘å‡ºç”±å¯è§‚å¯Ÿåºåˆ—å‘å‡ºçš„ç¬¬ä¸€ä¸ªå…ƒç´ (æˆ–ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ )ã€‚å¦‚æœå¯è§‚æµ‹çš„åºåˆ—ä¸å‘å°„ä¸€ä¸ªå…ƒç´ ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ 123456789101112131415161718192021222324252627example(\"single\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .single() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125;example(\"single with conditions\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .single &#123; $0 == \"ğŸ¸\" &#125; .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ±\", \"ğŸ°\", \"ğŸ¶\") .single &#123; $0 == \"ğŸ°\" &#125; .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .single &#123; $0 == \"ğŸ”µ\" &#125; .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)&#125; takeåªä»å¯è§‚å¯Ÿåºåˆ—çš„å¼€å¤´å‘å‡ºæŒ‡å®šæ•°é‡çš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"take\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .take(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; 1&quot;ğŸ±&quot; &quot;ğŸ°&quot; &quot;ğŸ¶&quot; takeLaståªä»å¯è§‚å¯Ÿåºåˆ—çš„æœ«å°¾å‘å‡ºæŒ‡å®šæ•°é‡çš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"takeLast\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .takeLast(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; 1&quot;ğŸ¸&quot; &quot;ğŸ·&quot; &quot;ğŸµ&quot; takeWhileåªä»å¯è§‚å¯Ÿåºåˆ—çš„å¼€å¤´å‘å‡º,è¦æŒ‡å®šæ¡ä»¶çš„å€¼ä¸ºtrue å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"takeWhile\") &#123; let disposeBag = DisposeBag() Observable.of(1, 2, 3, 4, 5, 6) .takeWhile &#123; $0 &lt; 4 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; takeUntilä»ä¸€ä¸ªæºå¯è§‚å¯Ÿåºåˆ—ä¸­å‘å°„å…ƒç´ ï¼Œç›´åˆ°ä¸€ä¸ªå¯è§‚å¯Ÿçš„åºåˆ—é‡Šæ”¾å‡ºä¸€ä¸ªå…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 123456789101112131415161718192021example(\"takeUntil\") &#123; let disposeBag = DisposeBag() let sourceSequence = PublishSubject&lt;String&gt;() let referenceSequence = PublishSubject&lt;String&gt;() sourceSequence .takeUntil(referenceSequence) .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) sourceSequence.onNext(\"ğŸ±\") sourceSequence.onNext(\"ğŸ°\") sourceSequence.onNext(\"ğŸ¶\") referenceSequence.onNext(\"ğŸ”´\") sourceSequence.onNext(\"ğŸ¸\") sourceSequence.onNext(\"ğŸ·\") sourceSequence.onNext(\"ğŸµ\")&#125; 1&quot;ğŸ±&quot; &quot;ğŸ°&quot; &quot;ğŸ¶&quot; skipä»ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—å¼€å§‹ï¼ŒæŠ‘åˆ¶å‘å°„æŒ‡å®šæ•°é‡çš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"skip\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .skip(2) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; skipWhileä»ä¸€ä¸ªå¯è§‚å¯Ÿåˆ°çš„åºåˆ—çš„å¼€å§‹,æŠ‘åˆ¶æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„å…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"skipWhile\") &#123; let disposeBag = DisposeBag() Observable.of(1, 2, 3, 4, 5, 6) .skipWhile &#123; $0 &lt; 4 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; skipWhileWithIndexæŠ‘åˆ¶ä»ä¸€ä¸ªå¯è§‚å¯Ÿåˆ°çš„åºåˆ—çš„å¼€å§‹ï¼Œæ»¡è¶³æŒ‡å®šæ¡ä»¶çš„å…ƒç´ ï¼Œå¹¶å‘å°„å‰©ä¸‹çš„å…ƒç´ ã€‚é—­åŒ…å‚æ•°åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚ 12345678910example(\"skipWhileWithIndex\") &#123; let disposeBag = DisposeBag() Observable.of(\"ğŸ±\", \"ğŸ°\", \"ğŸ¶\", \"ğŸ¸\", \"ğŸ·\", \"ğŸµ\") .skipWhileWithIndex &#123; element, index in index &lt; 3 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; skipUntilæŠ‘åˆ¶å…ƒç´ ä»ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ä¸­å‘å°„å‡ºæ¥ï¼Œç›´åˆ°ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—å‘å°„å‡ºä¸€ä¸ªå…ƒç´ ã€‚æ›´å¤šä¿¡æ¯ 123456789101112131415161718192021example(\"skipUntil\") &#123; let disposeBag = DisposeBag() let sourceSequence = PublishSubject&lt;String&gt;() let referenceSequence = PublishSubject&lt;String&gt;() sourceSequence .skipUntil(referenceSequence) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) sourceSequence.onNext(\"ğŸ±\") sourceSequence.onNext(\"ğŸ°\") sourceSequence.onNext(\"ğŸ¶\") referenceSequence.onNext(\"ğŸ”´\") sourceSequence.onNext(\"ğŸ¸\") sourceSequence.onNext(\"ğŸ·\") sourceSequence.onNext(\"ğŸµ\")&#125; æ•°å­¦è¿ç®—åŠèšåˆæ“ä½œç¬¦è½¬æ¢æ¯ä¸ªå¯è§‚å¯Ÿå…ƒç´ æˆå•ä¸ªObservableçš„æ“ä½œã€‚ toArrayå°†å¯è§‚å¯Ÿåºåˆ—è½¬æ¢ä¸ºæ•°ç»„ï¼Œå°†è¯¥æ•°ç»„ä½œä¸ºä¸€ä¸ªæ–°çš„å•å…ƒç´ å¯è§‚å¯Ÿåºåˆ—å‘å°„ï¼Œç„¶åç»ˆæ­¢ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"toArray\") &#123; let disposeBag = DisposeBag() Observable.range(start: 1, count: 10) .toArray() .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)&#125; reduceä»ä¸€ä¸ªåˆå§‹å€¼å¼€å§‹ï¼Œç„¶åå°†ä¸€ä¸ªç´¯åŠ é—­åŒ…åº”ç”¨åˆ°ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—æ‰€å‘å°„çš„æ‰€æœ‰å…ƒç´ ä¸Šï¼Œå¹¶å°†æ€»ç»“æœä½œä¸ºä¸€ä¸ªå•å…ƒç´ å¯è§‚å¯Ÿçš„åºåˆ—è¿”å›ã€‚æ›´å¤šä¿¡æ¯ 12345678example(\"reduce\") &#123; let disposeBag = DisposeBag() Observable.of(10, 100, 1000) .reduce(1, accumulator: +) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; concatä»åºåˆ—çš„å¯è§‚å¯Ÿåºåˆ—çš„å†…å¯è§‚å¯Ÿåºåˆ—ä¸­åŠ å…¥å…ƒç´ ï¼Œç­‰å¾…æ¯ä¸ªåºåˆ—åœ¨ä»ä¸‹ä¸€ä¸ªåºåˆ—ä¸­é‡Šæ”¾å…ƒç´ ä¹‹å‰æˆåŠŸç»ˆæ­¢ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122232425example(\"concat\") &#123; let disposeBag = DisposeBag() let subject1 = BehaviorSubject(value: \"ğŸ\") let subject2 = BehaviorSubject(value: \"ğŸ¶\") let variable = Variable(subject1) variable.asObservable() .concat() .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) subject1.onNext(\"ğŸ\") subject1.onNext(\"ğŸŠ\") variable.value = subject2 subject2.onNext(\"I would be ignored\") subject2.onNext(\"ğŸ±\") subject1.onCompleted() subject2.onNext(\"ğŸ­\")&#125; è¿æ¥æ“ä½œç¬¦å¯è¿æ¥çš„å¯è§‚å¯Ÿåºåˆ—ä¸æ™®é€šè§‚å¯Ÿåºåˆ—ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒä»¬ä¸æ˜¯åœ¨è®¢é˜…æ—¶å¼€å§‹å‘å°„å…ƒç´ ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨connect()æ–¹æ³•æ—¶æ‰å¼€å§‹å‘å°„å…ƒç´ ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ç­‰å¾…æ‰€æœ‰é¢„å®šçš„è®¢é˜…è€…åœ¨å¼€å§‹å‘å‡ºå…ƒç´ ä¹‹å‰è®¢é˜…ä¸€ä¸ªå¯è¿æ¥çš„å¯è§‚å¯Ÿåºåˆ—ã€‚ åœ¨å­¦ä¹ è¿æ¥æ“ä½œç¬¦ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªéè¿æ¥æ“ä½œç¬¦çš„ç¤ºä¾‹: 123456789101112131415func sampleWithoutConnectableOperators() &#123; printExampleHeader(#function) let interval = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) _ = interval .subscribe(onNext: &#123; print(\"Subscription: 1, Event: \\($0)\") &#125;) delay(5) &#123; _ = interval .subscribe(onNext: &#123; print(\"Subscription: 2, Event: \\($0)\") &#125;) &#125;&#125;//sampleWithoutConnectableOperators() // âš ï¸ Uncomment to run this example; comment to stop running publishå°†æºå¯è§‚å¯Ÿåºåˆ—è½¬æ¢ä¸ºè¿æ¥åºåˆ—ã€‚æ›´å¤šä¿¡æ¯ 1234567891011121314151617181920212223func sampleWithPublish() &#123; printExampleHeader(#function) let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .publish() _ = intSequence .subscribe(onNext: &#123; print(\"Subscription 1:, Event: \\($0)\") &#125;) delay(2) &#123; _ = intSequence.connect() &#125; delay(4) &#123; _ = intSequence .subscribe(onNext: &#123; print(\"Subscription 2:, Event: \\($0)\") &#125;) &#125; delay(6) &#123; _ = intSequence .subscribe(onNext: &#123; print(\"Subscription 3:, Event: \\($0)\") &#125;) &#125;&#125;//sampleWithPublish() // âš ï¸ Uncomment to run this example; comment to stop running replayå°†æºå¯è§‚å¯Ÿåºåˆ—è½¬æ¢ä¸ºè¿æ¥åºåˆ—ï¼Œå¹¶å°†å…ˆå‰æ’æ”¾çš„ç¼“å†²åŒºå¤§å°é‡æ”¾ç»™æ¯ä¸ªæ–°è®¢æˆ·ã€‚æ›´å¤šä¿¡æ¯ 1234567891011121314151617181920212223func sampleWithReplayBuffer() &#123; printExampleHeader(#function) let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .replay(5) _ = intSequence .subscribe(onNext: &#123; print(\"Subscription 1:, Event: \\($0)\") &#125;) delay(2) &#123; _ = intSequence.connect() &#125; delay(4) &#123; _ = intSequence .subscribe(onNext: &#123; print(\"Subscription 2:, Event: \\($0)\") &#125;) &#125; delay(8) &#123; _ = intSequence .subscribe(onNext: &#123; print(\"Subscription 3:, Event: \\($0)\") &#125;) &#125;&#125;// sampleWithReplayBuffer() // âš ï¸ Uncomment to run this example; comment to stop running multicastå°†å¯è§‚å¯Ÿçš„åºåˆ—è½¬æ¢æˆå¯è¿æ¥çš„åºåˆ—ï¼Œå¹¶é€šè¿‡æŒ‡å®šçš„ä¸»é¢˜å¹¿æ’­å…¶å‘å°„ã€‚ 12345678910111213141516171819202122232425262728func sampleWithMulticast() &#123; printExampleHeader(#function) let subject = PublishSubject&lt;Int&gt;() _ = subject .subscribe(onNext: &#123; print(\"Subject: \\($0)\") &#125;) let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .multicast(subject) _ = intSequence .subscribe(onNext: &#123; print(\"\\tSubscription 1:, Event: \\($0)\") &#125;) delay(2) &#123; _ = intSequence.connect() &#125; delay(4) &#123; _ = intSequence .subscribe(onNext: &#123; print(\"\\tSubscription 2:, Event: \\($0)\") &#125;) &#125; delay(6) &#123; _ = intSequence .subscribe(onNext: &#123; print(\"\\tSubscription 3:, Event: \\($0)\") &#125;) &#125;&#125;//sampleWithMulticast() // âš ï¸ Uncomment to run this example; comment to stop running é”™è¯¯å¤„ç†æ“ä½œç¬¦å¸®åŠ©ä»Observableçš„é”™è¯¯é€šçŸ¥ä¸­æ¢å¤çš„æ“ä½œç¬¦ã€‚ catchErrorJustReturnä»é”™è¯¯äº‹ä»¶ä¸­æ¢å¤ï¼Œè¿”å›ä¸€ä¸ªå¯è§‚å¯Ÿåºåˆ—ï¼Œè¯¥åºåˆ—é‡Šæ”¾ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åç»ˆæ­¢ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516example(\"catchErrorJustReturn\") &#123; let disposeBag = DisposeBag() let sequenceThatFails = PublishSubject&lt;String&gt;() sequenceThatFails .catchErrorJustReturn(\"ğŸ˜Š\") .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) sequenceThatFails.onNext(\"ğŸ˜¬\") sequenceThatFails.onNext(\"ğŸ˜¨\") sequenceThatFails.onNext(\"ğŸ˜¡\") sequenceThatFails.onNext(\"ğŸ”´\") sequenceThatFails.onError(TestError.test)&#125; catchErroré€šè¿‡åˆ‡æ¢åˆ°æ‰€æä¾›çš„æ¢å¤å¯è§‚å¯Ÿåºåˆ—æ¥ä»é”™è¯¯äº‹ä»¶ä¸­æ¢å¤ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122example(\"catchError\") &#123; let disposeBag = DisposeBag() let sequenceThatFails = PublishSubject&lt;String&gt;() let recoverySequence = PublishSubject&lt;String&gt;() sequenceThatFails .catchError &#123; print(\"Error:\", $0) return recoverySequence &#125; .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) sequenceThatFails.onNext(\"ğŸ˜¬\") sequenceThatFails.onNext(\"ğŸ˜¨\") sequenceThatFails.onNext(\"ğŸ˜¡\") sequenceThatFails.onNext(\"ğŸ”´\") sequenceThatFails.onError(TestError.test) recoverySequence.onNext(\"ğŸ˜Š\")&#125; retryé€šè¿‡é‡æ–°è®¢é˜…å¯è§‚å¯Ÿçš„åºåˆ—ï¼Œå¯ä»¥æ— é™åœ°æ¢å¤é‡å¤çš„é”™è¯¯äº‹ä»¶ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122232425262728example(\"retry\") &#123; let disposeBag = DisposeBag() var count = 1 let sequenceThatErrors = Observable&lt;String&gt;.create &#123; observer in observer.onNext(\"ğŸ\") observer.onNext(\"ğŸ\") observer.onNext(\"ğŸŠ\") if count == 1 &#123; observer.onError(TestError.test) print(\"Error encountered\") count += 1 &#125; observer.onNext(\"ğŸ¶\") observer.onNext(\"ğŸ±\") observer.onNext(\"ğŸ­\") observer.onCompleted() return Disposables.create() &#125; sequenceThatErrors .retry() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; retry(_:)é€šè¿‡é‡æ–°è®¢é˜…å¯è§‚å¯Ÿåˆ°çš„åºåˆ—ï¼Œå†ä»é”™è¯¯äº‹ä»¶ä¸­æ¢å¤ï¼Œç›´åˆ°maxé‡è¯•æ¬¡æ•°çš„é‡è¯•æ¬¡æ•°ã€‚æ›´å¤šä¿¡æ¯ 12345678910111213141516171819202122232425262728example(\"retry maxAttemptCount\") &#123; let disposeBag = DisposeBag() var count = 1 let sequenceThatErrors = Observable&lt;String&gt;.create &#123; observer in observer.onNext(\"ğŸ\") observer.onNext(\"ğŸ\") observer.onNext(\"ğŸŠ\") if count &lt; 5 &#123; observer.onError(TestError.test) print(\"Error encountered\") count += 1 &#125; observer.onNext(\"ğŸ¶\") observer.onNext(\"ğŸ±\") observer.onNext(\"ğŸ­\") observer.onCompleted() return Disposables.create() &#125; sequenceThatErrors .retry(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; è°ƒè¯•æ“ä½œç¬¦å¸®åŠ©è°ƒè¯•Rxä»£ç çš„æ“ä½œç¬¦ã€‚ debugæ‰“å°å‡ºæ‰€æœ‰è®¢é˜…ã€äº‹ä»¶å’Œdisposalsã€‚ 1234567891011121314151617181920212223242526272829example(\"debug\") &#123; let disposeBag = DisposeBag() var count = 1 let sequenceThatErrors = Observable&lt;String&gt;.create &#123; observer in observer.onNext(\"ğŸ\") observer.onNext(\"ğŸ\") observer.onNext(\"ğŸŠ\") if count &lt; 5 &#123; observer.onError(TestError.test) print(\"Error encountered\") count += 1 &#125; observer.onNext(\"ğŸ¶\") observer.onNext(\"ğŸ±\") observer.onNext(\"ğŸ­\") observer.onCompleted() return Disposables.create() &#125; sequenceThatErrors .retry(3) .debug() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)&#125; RxSwift.Resources.totalæä¾›æ‰€æœ‰Rxèµ„æºåˆ†é…çš„è®¡æ•°ï¼Œè¿™å¯¹äºå¼€å‘æœŸé—´æ£€æµ‹æ³„æ¼éå¸¸æœ‰ç”¨ã€‚ 123456789101112131415161718192021222324252627282930#if NOT_IN_PLAYGROUND#elseexample(\"RxSwift.Resources.total\") &#123; print(RxSwift.Resources.total) let disposeBag = DisposeBag() print(RxSwift.Resources.total) let variable = Variable(\"ğŸ\") let subscription1 = variable.asObservable().subscribe(onNext: &#123; print($0) &#125;) print(RxSwift.Resources.total) let subscription2 = variable.asObservable().subscribe(onNext: &#123; print($0) &#125;) print(RxSwift.Resources.total) subscription1.dispose() print(RxSwift.Resources.total) subscription2.dispose() print(RxSwift.Resources.total)&#125;print(RxSwift.Resources.total)#endif ä½¿èƒ½RxSwift.Resources.totalåœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼ŒæŒ‰ç…§ä¸‹åˆ—æŒ‡ç¤ºæ¥å¯ç”¨RxSwift.Resources.total: CocoaPods åœ¨ä½ çš„Podfileä¸­æ·»åŠ ä¸€ä¸ªpost_install, å¦‚ä¸‹æ‰€ç¤º: è¿è¡Œ pod update æ„å»ºé¡¹ç›®(Product -&gt; Build) Podfileï¼š 123456789101112131415target &apos;AppTarget&apos; dopod &apos;RxSwift&apos;endpost_install do |installer| installer.pods_project.targets.each do |target| if target.name == &apos;RxSwift&apos; target.build_configurations.each do |config| if config.name == &apos;Debug&apos; config.build_settings[&apos;OTHER_SWIFT_FLAGS&apos;] ||= [&apos;-D&apos;, &apos;TRACE_RESOURCES&apos;] end end end endend Carthage è¿è¡Œ carthage build â€“configuration Debug æ„å»ºå·¥ç¨‹(Product -&gt; Build)","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"}]},{"title":"Appç ”å‘å½• ç¬”è®°(ä¸€): é«˜æ•ˆAppæ¡†æ¶è®¾è®¡ä¸é‡æ„","slug":"ã€ŠAppç ”å‘å½•ã€‹ç¬”è®°-ç¬¬ä¸€éƒ¨åˆ†-é«˜æ•ˆAppæ¡†æ¶è®¾è®¡ä¸é‡æ„","date":"2017-10-20T08:11:59.000Z","updated":"2020-07-25T02:57:18.235Z","comments":true,"path":"2017/10/20/ã€ŠAppç ”å‘å½•ã€‹ç¬”è®°-ç¬¬ä¸€éƒ¨åˆ†-é«˜æ•ˆAppæ¡†æ¶è®¾è®¡ä¸é‡æ„/","link":"","permalink":"https://jigangduan.github.io/2017/10/20/ã€ŠAppç ”å‘å½•ã€‹ç¬”è®°-ç¬¬ä¸€éƒ¨åˆ†-é«˜æ•ˆAppæ¡†æ¶è®¾è®¡ä¸é‡æ„/","excerpt":"ç¬¬ä¸€éƒ¨åˆ† é«˜æ•ˆAppæ¡†æ¶è®¾è®¡ä¸é‡æ„","text":"ç¬¬ä¸€éƒ¨åˆ† é«˜æ•ˆAppæ¡†æ¶è®¾è®¡ä¸é‡æ„ ç¬¬1ç«  é‡æ„ å¯¹äº App æ¥è¯´ï¼Œè¦ä¹ˆå°±ä¸€æ¬¡æ€§æŠŠå®ƒè®¾è®¡å¥½ï¼Œå¦åˆ™ï¼Œå°±åªèƒ½é‡æ„äº†ã€‚ é‡æ–°è§„åˆ’ Android é¡¹ç›®çš„ç›®å½•ç»“æ„ å»ºç«‹ AndroidLib ç±»åº“ï¼Œå°†ä¸ä¸šåŠ¡æ— å…³çš„é€»è¾‘è½¬ç§»åˆ° AndroidLibã€‚ com.infrastructure.activity: ä¸šåŠ¡æ— å…³çš„ Activity åŸºç±» AndroidLib ä¸‹çš„åŸºç±» BaseActivity å°è£…çš„æ˜¯ä¸šåŠ¡æ— å…³çš„å…¬ç”¨é€»è¾‘ AppBaseActivity åŸºç±»å°è£…çš„æ˜¯ä¸šåŠ¡ç›¸å…³çš„å…¬ç”¨é€»è¾‘ com.infrastructure.net: ç½‘ç»œåº•å±‚å°è£… com.infrastructure.cache: ç¼“å­˜æ•°æ®å’Œå›¾ç‰‡çš„ç›¸å…³å¤„ç† com.infrastructure.ui: è‡ªå®šä¹‰æ§ä»¶ com.infrastructure.utils: å„ç§ä¸ä¸šåŠ¡æ— å…³çš„å…¬ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚å¯¹ SharedPreferences çš„å°è£… ä¸»é¡¹ç›®ä¸­çš„ç±»åˆ†é—¨åˆ«ç±»åœ°è¿›è¡Œåˆ’åˆ† activity:æˆ‘ä»¬æŒ‰ç…§æ¨¡å—ç»§ç»­æ‹†åˆ†ï¼Œå°†ä¸åŒæ¨¡å—çš„ Activity åˆ’åˆ†åˆ°ä¸åŒçš„åŒ…ä¸‹ã€‚ Â‰ adapter:æ‰€æœ‰é€‚é…å™¨éƒ½æ”¾åœ¨ä¸€èµ· Â‰entity:å°†æ‰€æœ‰çš„å®ä½“éƒ½æ”¾åœ¨ä¸€èµ· Â‰db:SQLLite ç›¸å…³é€»è¾‘çš„å°è£… Â‰engine:å°†ä¸šåŠ¡ç›¸å…³çš„ç±»éƒ½æ”¾åœ¨ä¸€èµ· Â‰ui:å°†è‡ªå®šä¹‰æ§ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªåŒ…ä¸­ utils:å°†æ‰€æœ‰çš„å…¬ç”¨æ–¹æ³•éƒ½æ”¾åœ¨è¿™é‡Œ interfaces:çœŸæ­£æ„ä¹‰ä¸Šçš„æ¥å£ï¼Œå‘½åä»¥ I ä½œä¸ºå¼€å¤´ listener:åŸºäº Listener çš„æ¥å£ï¼Œå‘½åä»¥ On ä½œä¸ºå¼€å¤´ æ¯ä¸ªæ–‡ä»¶åªæœ‰ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œä¸è¦æœ‰åµŒå¥—ç±»ï¼Œæ¯”å¦‚åœ¨ Activity ä¸­åµŒå¥— Adapterã€Entity å°† Activity æŒ‰ç…§æ¨¡å—æ‹†åˆ†å½’ç±»åï¼Œå¯ä»¥è¿…é€Ÿå®šä½å…·ä½“çš„ä¸€ä¸ªé¡µé¢ã€‚æ­¤å¤–ï¼Œå°†å¼€å‘äººå‘˜æŒ‰ç…§æ¨¡å—åˆ’åˆ†åï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½åªè´Ÿè´£è‡ªå·±çš„é‚£ä¸ªåŒ…ï¼Œå¼€å‘è¾¹ç•Œçº¿å¾ˆæ¸…æ™°ã€‚ ä¸º Activity å®šä¹‰æ–°çš„ç”Ÿå‘½å‘¨æœŸ å•ä¸€èŒè´£:ä¸€ä¸ªç±»æˆ–æ–¹æ³•ï¼Œåªåšä¸€ä»¶äº‹æƒ… initVariables: åˆå§‹åŒ–å˜é‡ï¼ŒåŒ…æ‹¬ Intent å¸¦çš„æ•°æ®å’Œ Activity å†…çš„å˜é‡ Â‰initViews: åŠ è½½ layout å¸ƒå±€æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ§ä»¶ï¼Œä¸ºæ§ä»¶æŒ‚ä¸Šäº‹ä»¶æ–¹æ³• loadData: è°ƒç”¨ MobileAPI è·å–æ•°æ® AndroidLib è¿™ä¸ªç±»åº“çš„ BaseActivity ä¸­ï¼Œé‡å†™ onCreate æ–¹æ³• ç»Ÿä¸€äº‹ä»¶ç¼–ç¨‹æ¨¡å‹å®ä½“åŒ–ç¼–ç¨‹ä½¿ç”¨ fastJSON æˆ– GSON å®ä½“ç”Ÿæˆå™¨ åœ¨é¡µé¢è·³è½¬ä¸­ä½¿ç”¨å®ä½“ Adapter æ¨¡æ¿BaseAdapter Â‰getCount() Â‰getItem() Â‰getItemId() Â‰getView() ViewHolderå†…ç½®ä¸€ä¸ª Holder åµŒå¥—ç±»ï¼Œç”¨äºå­˜æ”¾ ListView ä¸­æ¯ä¸€è¡Œä¸­çš„æ§ä»¶ã€‚ViewHolder çš„å­˜åœ¨ï¼Œå¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºåŒä¸€ä¸ªåˆ—è¡¨é¡¹ï¼Œä»è€Œæå¤§åœ°èŠ‚çœå†…å­˜ã€‚ 1234class ViewHolder &#123; TextView tvCinemaName; TextView tvCinemaId;&#125; ç±»å‹å®‰å…¨è½¬æ¢å‡½æ•° å› ä¸ºç±»å‹è½¬æ¢ä¸æ­£ç¡®å¯¼è‡´çš„å´©æºƒå äº†å¾ˆå¤§çš„æ¯”ä¾‹ ç©ºç±»å‹ åŒºåŸŸè¶Šç•Œ ç¬¬2ç«  Android ç½‘ç»œåº•å±‚æ¡†æ¶è®¾è®¡ç½‘ç»œä½å±‚å°è£…æŠ›å¼ƒ AsyncTask ç¼ºç‚¹ï¼Œä¸èƒ½çµæ´»æ§åˆ¶å…¶å†…éƒ¨çš„çº¿ç¨‹æ±  æ²¡æœ‰æš´éœ² å‡ºå–æ¶ˆè¿™äº›è¯·æ±‚çš„æ–¹æ³• ThreadPoolExecutor + Runnable + Handler UrlConfigManager MobileAPI æ¥å£çš„ä¿¡æ¯éƒ½ æ”¾åœ¨ url.xml æ–‡ä»¶ä¸­: 12345678910111213&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;Node Key=\"getWeatherInfo\" Expires=\"300\" NetType=\"get\" Url=\"http://www.weather.com.cn/data/sk/101010100.html\" /&gt; &lt;Node Key=\"login\" Expires=\"0\" NetType=\"post\" Url=\"http://www.weather.com.cn/data/login.api\" /&gt;&lt;/url&gt; é€šè¿‡ UrlConfigManager çš„ findURL æ–¹æ³•æ‰¾åˆ°èŠ‚ç‚¹ RemoteService å’Œ RequestCallbackã€RequestParameter 12345678910111213141516171819202122@Overrideprotected void loadData() &#123; weatherCallback = new RequestCallback() &#123; @Override public void onSuccess(String content) &#123; //TODO: &#125; @Override public void onFail(String errorMessage) &#123; //TODO: &#125; &#125;; ArrayList&lt;RequestParameter&gt; params = new ArrayList&lt;RequestParameter&gt;(); RequestParameter rp1 = new RequestParameter(\"cityId\", \"111\"); RequestParameter rp2 = new RequestParameter(\"cityName\", \"Beijing\"); params.add(rp1); params.add(rp2); RemoteService.getInstance().invoke(this, \"getWeatherInfo\", params, weatherCallback);&#125; RemoteService è¿™ä¸ªå•ä¾‹æ˜¯ç”¨æ¥å‘èµ·è¯·æ±‚çš„ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª requestï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° RequestManager ä¸­ï¼Œç„¶åæ”¾åˆ° DefaultThreadPool çš„ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œè¿™ä¸ª request. RequestManager RequestManager è¿™ä¸ªé›†åˆç±»æ˜¯ç”¨äºå–æ¶ˆè¯·æ±‚(cancelRequest)çš„ DefaultThreadPool å¯¹ ThreadPoolExecutor å’Œ ArrayBlockingQueue çš„ç®€å•å°è£… HttpRequest HttpRequest æ˜¯å‘èµ· Http è¯·æ±‚çš„åœ°æ–¹ï¼Œå®ƒå®ç°äº† Runnable ç½‘ç»œåº•å±‚çš„ä¸€äº›ä¼˜åŒ–å·¥ä½œonFail çš„ç»Ÿä¸€å¤„ç†æœºåˆ¶ å¦‚æœè®¿é—® MobileAPI è¯·æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¸Œæœ›åªæ˜¯åœ¨ App ä¸Šç®€å•åœ°å¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ï¼Œå‘Š è¯‰ç”¨æˆ·ç½‘ç»œæœ‰å¼‚å¸¸ã€‚ è‡ªå®šä¹‰ç±» AbstractRequestCallback 12345678910111213public abstract class AppBaseActivity extends BaseActivity &#123; public abstract class AbstractRequestCallback implements RequestCallback &#123; public abstract void onSuccess(String content); public void onFail(String errorMessage) &#123; new AlertDialog.Builder(AppBaseActivity.this) .setTitle(\" å‡ºé”™å•¦ \").setMessage(errorMessage) .setPositiveButton(\" ç¡®å®š \", null).show(); &#125; &#125;&#125; UrlConfigManager çš„ä¼˜åŒ– åœ¨ App å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§å°† url.xml æ–‡ä»¶éƒ½è¯»å–åˆ°å†…å­˜ï¼ŒæŠŠæ‰€æœ‰ çš„ UrlData å®ä½“ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åæ¯æ¬¡è°ƒç”¨ MobileAPI æ¥å£ï¼Œç›´æ¥ä»å†…å­˜çš„è¿™ä¸ªé›† åˆä¸­æŸ¥æ‰¾ã€‚ ä¸æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦å›è°ƒçš„ ProgressBar çš„å¤„ç† App æ•°æ®ç¼“å­˜è®¾è®¡æ•°æ®ç¼“å­˜ç­–ç•¥ å¯¹äº App è€Œè¨€ï¼Œå®ƒæ˜¯æ„Ÿå—ä¸åˆ°å–çš„æ˜¯ç¼“å­˜æ•°æ®è¿˜æ˜¯è°ƒç”¨ MobileAPIã€‚å…·ä½“å·¥ä½œç”±ç½‘ç»œåº•å±‚å®Œæˆã€‚ åœ¨ url.xml ä¸­ä¸ºæ¯ä¸€ä¸ª MobileAPI æ¥å£é…ç½®ç¼“å­˜æ—¶é—´ Expiredã€‚å¯¹äº postï¼Œä¸€å¾‹è®¾ç½®ä¸º 0ï¼Œå› ä¸º post ä¸éœ€è¦ç¼“å­˜ã€‚ åœ¨ HttpRequest ç±»ä¸­çš„ run æ–¹æ³•ä¸­ï¼Œæ”¹åŠ¨ 3 ä¸ªåœ°æ–¹: å†™ä¸€ä¸ªæ’åºç®—æ³• sortKeysï¼Œå¯¹ URL ä¸­çš„ key è¿›è¡Œæ’åºã€‚ å°† newUrl ä½œä¸º keyï¼Œæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰åˆ™ç›´æ¥è¿”å›;å¦åˆ™ï¼Œç»§ç»­è°ƒç”¨MobileAPI æ¥å£ã€‚ MobileAPI æ¥å£è¿”å›æ•°æ®åï¼Œå°†æ•°æ®å­˜å…¥ç¼“å­˜ã€‚ CacheManager ç”¨äºæ“ä½œè¯»å†™ç¼“å­˜æ•°æ®ï¼Œå¹¶åˆ¤æ–­ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸã€‚ç¼“å­˜ä¸­å­˜æ”¾çš„å® ä½“å°±æ˜¯ CacheItemã€‚ åœ¨ App é¡¹ç›®ä¸­ï¼Œåˆ›å»º YoungHeartApplication è¿™ä¸ª Application çº§åˆ«çš„ç±»ï¼Œåœ¨ç¨‹åºå¯åŠ¨ æ—¶ï¼Œåˆå§‹åŒ–ç¼“å­˜çš„ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¹‹ã€‚ å¼ºåˆ¶æ›´æ–° App MockServiceç”¨æˆ·ç™»å½•è‡ªåŠ¨ç™»å½•Cookie Cookie è¿‡æœŸçš„ç»Ÿä¸€å¤„ç†é˜²æ­¢é»‘å®¢åˆ·åº“ä¸€ç§å®‰å…¨è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºç™»å½•æ¥å£å¢åŠ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ŒéªŒè¯ç ã€‚æ¯æ¬¡ç™»å½• éƒ½å¿…é¡»è¾“å…¥éªŒè¯ç ï¼Œå…¶å®å°±æ˜¯ä¸ºäº†é˜²æ­¢è¢«é»‘å®¢åˆ·åº“ é˜²æ­¢é»‘å®¢åˆ·åº“HTTP å¤´ä¸­çš„å¥¥å¦™acceptaccept-languagereferreruser-agentÂ‰accept-encodingcheck-value: AppId ClientType MD5 æ—¶é—´æ ¡å‡† Date æ°¸è¿œä½¿ç”¨UTC æ—¶é—´ å¼€å¯ gzip å‹ç¼©ç¬¬3ç«  Android ç»å…¸åœºæ™¯è®¾è®¡App ç¼“å­˜åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œæ•°æ®ç¼“å­˜å’Œå›¾ç‰‡ç¼“å­˜ã€‚ App å›¾ç‰‡ç¼“å­˜è®¾è®¡ImageLoader è®¾è®¡åŸç† ImageLoader çš„ç›®çš„æ˜¯ä¸ºäº†å®ç°å¼‚æ­¥çš„ç½‘ç»œå›¾ç‰‡ åŠ è½½ã€ç¼“å­˜åŠæ˜¾ç¤ºï¼Œæ”¯æŒå¤šçº¿ç¨‹å¼‚æ­¥åŠ è½½ã€‚ ImageLoader çš„å·¥ä½œåŸç† : åœ¨æ˜¾ç¤ºå›¾ç‰‡çš„æ—¶å€™ï¼Œå…ˆåœ¨å†…å­˜ä¸­æŸ¥æ‰¾; å¦‚æœæ²¡æœ‰ï¼Œå°±å»æœ¬åœ°æŸ¥æ‰¾;å¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±å¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹å»ä¸‹è½½è¿™å¼ å›¾ç‰‡ï¼Œä¸‹è½½æˆåŠŸä¼šæŠŠå›¾ç‰‡åŒæ—¶ç¼“å­˜åˆ°å†…å­˜å’Œæœ¬åœ°ã€‚ æ¯æ¬¡é€€å‡ºä¸€ä¸ªé¡µé¢çš„æ—¶å€™ï¼ŒæŠŠ ImageLoader å†…å­˜ä¸­çš„ç¼“å­˜å…¨éƒ½æ¸…é™¤ï¼Œè¿™æ ·å°±èŠ‚çœäº†å¤§é‡å†…å­˜ã€‚ ImageLoader å¯¹å›¾ç‰‡æ˜¯è½¯å¼•ç”¨çš„å½¢å¼ï¼Œæ‰€ä»¥å†…å­˜ä¸­çš„å›¾ç‰‡ä¼šåœ¨å†…å­˜ä¸è¶³çš„æ—¶ å€™è¢«ç³»ç»Ÿå›æ”¶(å†…å­˜è¶³å¤Ÿçš„æ—¶å€™ä¸ä¼šå¯¹å…¶è¿›è¡Œåƒåœ¾å›æ”¶)ã€‚ ImageLoader ä¼˜åŒ– åœ¨ AppBaseActivity ä¸­çš„ onDestroy æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œ ImageLoader çš„ clearMemoryCache æ–¹æ³•ï¼Œä»¥ç¡®ä¿é¡µé¢é”€æ¯æ—¶ï¼ŒæŠŠä¸ºäº†æ˜¾ç¤ºè¿™ä¸ªé¡µé¢è€Œå¢åŠ çš„å†…å­˜ç¼“å­˜æ¸…é™¤ã€‚ å›¾ç‰‡åŠ è½½åˆ©å™¨ FrescoFresco çš„åŸç†æ˜¯ï¼Œè®¾è®¡äº†ä¸€ä¸ª Image Pipeline çš„æ¦‚å¿µï¼Œå®ƒè´Ÿè´£å…ˆåæ£€æŸ¥å†…å­˜ã€ç£ç›˜æ–‡ä»¶ (Disk)ï¼Œå¦‚æœéƒ½æ²¡æœ‰å†è€è€å®å®ä»ç½‘ç»œä¸‹è½½å›¾ç‰‡. Fresco æœ‰3ä¸ªçº¿ç¨‹æ± ï¼Œå…¶ä¸­ 3ä¸ªçº¿ç¨‹ç”¨äºç½‘ç»œä¸‹è½½å›¾ç‰‡ï¼Œ2ä¸ªçº¿ç¨‹ç”¨äºç£ç›˜æ–‡ä»¶çš„è¯»å†™ï¼Œ è¿˜æœ‰ 2ä¸ªçº¿ç¨‹ç”¨äº CPUç›¸å…³æ“ä½œï¼Œæ¯”å¦‚å›¾ç‰‡è§£ç ã€è½¬æ¢ï¼Œä»¥åŠæ”¾åœ¨åå°æ‰§è¡Œçš„ä¸€äº›è´¹æ—¶æ“ä½œ. Fresco ä¸‰å±‚ç¼“å­˜: ç¬¬ä¸€å±‚:Bitmap ç¼“å­˜ Android 5.0 ç³»ç»Ÿä¸­, Bitmap ç¼“å­˜ä½äº Java çš„å †(heap)ä¸­ Android 4.x å’Œæ›´ä½çš„ç³»ç»Ÿï¼ŒBitmap ç¼“å­˜ä½äº ashmemã€‚åˆ›å»ºå’Œå›æ”¶ä¸ä¼šå¼•å‘è¿‡å¤šçš„ GC å½“ App åˆ‡æ¢åˆ°åå°æ—¶ï¼ŒBitmap ç¼“å­˜ä¼šè¢«æ¸…ç©ºã€‚ ç¬¬äºŒå±‚:å†…å­˜ç¼“å­˜ å†…å­˜ç¼“å­˜ä¸­å­˜å‚¨äº†å›¾ç‰‡çš„åŸå§‹å‹ç¼©æ ¼å¼ã€‚ä»å†…å­˜ç¼“å­˜ä¸­å–å‡ºçš„å›¾ç‰‡ï¼Œåœ¨æ˜¾ç¤ºå‰å¿…é¡»å…ˆè§£ç ã€‚å½“ App åˆ‡æ¢åˆ°åå°æ—¶ï¼Œå†…å­˜ç¼“å­˜ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚ ç¬¬ä¸‰å±‚:ç£ç›˜ç¼“å­˜ ç£ç›˜ç¼“å­˜ï¼Œåˆåæœ¬åœ°å­˜å‚¨ã€‚ç£ç›˜ç¼“å­˜ä¸­å­˜å‚¨çš„ä¹Ÿæ˜¯å›¾ç‰‡çš„åŸå§‹å‹ç¼©æ ¼å¼ã€‚åœ¨ä½¿ç”¨å‰ä¹Ÿè¦ å…ˆè§£ç ã€‚å½“ App åˆ‡æ¢åˆ°åå°æ—¶ï¼Œç£ç›˜ç¼“å­˜ä¸ä¼šä¸¢å¤±ï¼Œå³ä½¿å…³æœºä¹Ÿä¸ä¼šã€‚ å¯¹ç½‘ç»œæµé‡è¿›è¡Œä¼˜åŒ–API å±‚é¢è¿›è¡Œä¼˜åŒ–: è¦ä½¿ç”¨ gzip è¿›è¡Œå‹ç¼©ã€‚æ³¨æ„:å¤§äº 1KB æ‰è¿›è¡Œå‹ç¼©ï¼Œ å¦åˆ™å¾—ä¸å¿å¤±ã€‚ç»è¿‡ gzip å‹ç¼©åï¼Œè¿”å›çš„æ•°æ®é‡å¤§å¹…å‡å°‘ JSON æ ¼å¼ æˆ– ProtoBuffer å°‘ç½‘ç»œ è®¿é—®æ¬¡æ•°ï¼Œèƒ½è°ƒç”¨ä¸€æ¬¡ MobileAPI æ¥å£å°±èƒ½å–åˆ°æ•°æ®çš„ï¼Œå°±ä¸è¦è°ƒç”¨ä¸¤æ¬¡ TCP é•¿è¿æ¥ï¼Œä»¥æé«˜è®¿é—® çš„é€Ÿåº¦ã€‚ç¼ºç‚¹æ˜¯ä¸€å°æœåŠ¡å™¨èƒ½æ”¯æŒçš„é•¿è¿æ¥ä¸ªæ•°ä¸å¤šï¼Œæ‰€ä»¥éœ€è¦æ›´å¤šçš„æœåŠ¡å™¨é›†æˆ è¦å»ºç«‹å–æ¶ˆç½‘ç»œè¯·æ±‚çš„æœºåˆ¶ å¢åŠ é‡è¯•æœºåˆ¶ï¼Œget è¯·æ±‚é…ç½®é‡è¯•æœºåˆ¶ï¼Œæ¯”å¦‚ get è¯·æ±‚å¤±è´¥åé‡è¯• 3 æ¬¡ å›¾ç‰‡ç­–ç•¥ä¼˜åŒ– è¦ç¡®ä¿ä¸‹è½½çš„æ¯å¼ å›¾ï¼Œéƒ½ç¬¦åˆ ImageView æ§ä»¶çš„å¤§å° http://www.aaa.com/a.png?width=100&amp;height=50 ä½æµé‡æ¨¡å¼ åœ¨ 2G å’Œ 3G ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é€‚å½“é™ä½å›¾ç‰‡çš„è´¨é‡ã€‚é™ä½å›¾ç‰‡è´¨é‡ï¼Œç›¸åº”çš„å›¾ç‰‡ å¤§å°ä¹Ÿä¼šé™ä½ï¼Œæˆ‘ä»¬ç§°ä¸ºä½æµé‡æ¨¡å¼ã€‚ æé€Ÿæ¨¡å¼ åœ¨ 2G å’Œ 3G ç½‘ç»œç¯å¢ƒä¸‹ï¼Œç”¨æˆ·å¤§å¤šå¯¹å›¾ç‰‡ä¸æ„Ÿå…´è¶£ï¼Œä»–ä»¬å¯èƒ½å°±æ˜¯æƒ³ å¿«é€Ÿä¸‹å•å¹¶æ”¯ä»˜ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–è®¾è®¡ä¸€äº›é¡µé¢ï¼ŒåŒºåˆ«äºæ­£å¸¸æ¨¡å¼ä¸‹å›¾æ–‡å¹¶èŒ‚çš„é¡µé¢ï¼Œè¿™äº›åªæœ‰æ–‡å­—çš„é¡µé¢ç§°ä¸ºæé€Ÿæ¨¡å¼ã€‚ åŸå¸‚åˆ—è¡¨çš„è®¾è®¡ æœ¬åœ°ä¿å­˜ çº¿ä¸Šæœ€æ–°çš„åŸå¸‚åˆ—è¡¨æ•°æ®(åºåˆ—åŒ–åçš„)ä»¥åŠå¯¹åº”çš„ç‰ˆæœ¬å·ã€‚æ¯æ¬¡å‘ç‰ˆå‰åšä¸€æ¬¡åŸå¸‚æ•°æ®åŒæ­¥ã€‚ æ¯æ¬¡è¿›å…¥åˆ°åŸå¸‚åˆ—è¡¨è¿™ä¸ªé¡µé¢æ—¶ï¼Œå°†æœ¬åœ°åŸå¸‚åˆ—è¡¨æ•°æ®å¯¹åº”çš„ç‰ˆæœ¬å· version ä¼ å…¥åˆ° MobileAPI æ¥å£ï¼Œæ ¹æ®è¿”å›çš„ isMatch å€¼æ¥å†³å®šæ˜¯å¦ç‰ˆæœ¬å·ä¸€è‡´ã€‚å¦‚æœä¸€è‡´ï¼Œåˆ™ç›´æ¥ä»æœ¬åœ° æ–‡ä»¶ä¸­åŠ è½½åŸå¸‚åˆ—è¡¨æ•°æ®;å¦åˆ™ï¼Œå°±è§£æ MobileAPI æ¥å£è¿”å›çš„æ•°æ®ï¼Œåœ¨æ˜¾ç¤ºåˆ—è¡¨çš„åŒæ—¶ï¼Œ è®°å¾—è¦æŠŠæœ€æ–°çš„åŸå¸‚åˆ—è¡¨æ•°æ®å’Œç‰ˆæœ¬å·ä¿å­˜åˆ°æœ¬åœ°ã€‚ å¦‚æœ MobileAPI æ¥å£æ²¡æœ‰è°ƒç”¨æˆåŠŸï¼Œä¹Ÿæ˜¯ç›´æ¥ä»æœ¬åœ°æ–‡ä»¶ä¸­åŠ è½½åŸå¸‚åˆ—è¡¨æ•°æ®ï¼Œä»¥ ç¡®ä¿ä¸»æµç¨‹æ˜¯ç•…é€šçš„ã€‚ æ¯æ¬¡è°ƒç”¨ MobileAPI æ—¶ï¼Œä¼šè·å–åˆ°å¤§é‡çš„æ•°æ®ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šæ‰“å¼€ gzip å¯¹æ•°æ®è¿›è¡Œå‹ ç¼©ï¼Œä»¥ç¡®ä¿ä¼ è¾“çš„æ•°æ®é‡æœ€å° åŸå¸‚åˆ—è¡¨æ•°æ®çš„å¢é‡æ›´æ–°æœºåˆ¶ App ä¸ HTML5 çš„äº¤äº’App æ“ä½œ HTML5 é¡µé¢çš„æ–¹æ³• é¦–å…ˆè¦å®šå¥½é€šä¿¡åè®®ï¼Œä¹Ÿå°±æ˜¯ App è¦è°ƒç”¨çš„ HTML5 é¡µé¢ä¸­ JavaScript çš„æ–¹æ³•åç§°ã€‚ HTML5: 12345&lt;script type=\"text/javascript\"&gt; function changeColor (color) &#123; document.body.style.backgroundColor = color; &#125;&lt;/script&gt; Android: 12345678910wvAds.getSettings().setJavaScriptEnabled(true);wvAds.loadUrl(\"file:// /android_asset/104.html\");btnShowAlert.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; String color = \"#00ee00\"; wvAds.loadUrl(\"javascript: changeColor ('\" + color + \"');\"); &#125;&#125;); HTML5 é¡µé¢æ“ä½œ App é¡µé¢çš„æ–¹æ³• ä»ç„¶æ˜¯å…ˆå®šä¹‰é€šä¿¡åè®®ï¼Œè¿™æ¬¡å®šä¹‰çš„æ˜¯ JavaScript è¦è°ƒç”¨çš„ Android ä¸­æ–¹æ³•åç§°ã€‚ HTML5: 12&lt;a onclick=\"baobao.callAndroidMethod(100,100,'ccc',true)\"&gt; CallAndroidMethod&lt;/a&gt; Android: 1234567891011class JSInteface1 &#123; public void callAndroidMethod(int a, float b, String c, boolean d) &#123; if (d) &#123; String strMessage = \"-\" + (a + 1) + \"-\" + (b + 1) + \"-\" + c + \"-\" + d; new AlertDialog.Builder(MainActivity.this) .setTitle(\"title\") .setMessage(strMessage).show(); &#125; &#125;&#125; æ³¨å†Œ baobao å’Œ JSInterface1 çš„å¯¹åº”å…³ç³»: 1wvAds.addJavascriptInterface(new JSInteface1(), &quot;baobao&quot;); App å’Œ HTML5 ä¹‹é—´å®šä¹‰è·³è½¬åè®® åœ¨è¿™ä¸ª HTML5 é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å„ç§ JavaScript ç‚¹å‡»äº‹ä»¶ï¼Œä»è€Œè·³è½¬å› App çš„ä»» æ„ Native é¡µé¢ã€‚ åœ¨ App ä¸­å†…ç½® HTML5 é¡µé¢ çµæ´»åˆ‡æ¢ Native å’Œ HTML5 é¡µé¢çš„ç­–ç•¥ ç»å¸¸æ”¹åŠ¨çš„é¡µé¢ï¼ŒåšæˆHTML5é¡µé¢ï¼Œ WebViewçš„å½¢å¼åŠ è½½ã€‚é¿å…äº† Nativeé¡µé¢æ¯æ¬¡ä¿®æ”¹ï¼Œéƒ½è¦ç­‰ä¸€æ¬¡è¿­ä»£ä¸Šçº¿åæ‰èƒ½çœ‹åˆ°ã€‚ HTML5 å¼€å‘å‘¨æœŸçŸ­ HTML5 çš„ç¼ºç‚¹æ˜¯æ…¢ éœ€è¦åšä¸€ä¸ªåå°ï¼Œæ ¹æ®ç‰ˆæœ¬è¿›è¡Œé…ç½®æ¯ä¸ªé¡µé¢æ˜¯ä½¿ç”¨ Native é¡µé¢è¿˜æ˜¯ HTML5 é¡µé¢ã€‚ åœ¨ App å¯åŠ¨çš„æ—¶å€™ï¼Œä» MobileAPI è·å–åˆ°æ¯ä¸ªé¡µé¢æ˜¯ Native è¿˜æ˜¯ HTML5ã€‚ åœ¨ App çš„ä»£ç å±‚é¢ï¼Œé¡µé¢ä¹‹é—´è¦å®ç°æ¾è€¦åˆã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªå¯¼èˆªå™¨Navigatorï¼Œç”±å®ƒæ¥æ§åˆ¶è¯¥è·³è½¬åˆ° Native é¡µé¢è¿˜æ˜¯ HTML5 é¡µé¢ã€‚æœ€å¤§çš„æŒ‘æˆ˜æ˜¯é¡µé¢é—´å‚æ•°ä¼ é€’ï¼Œå­—å…¸æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„å½¢å¼ï¼Œæ¶ˆé™¤äº†ä¸åŒé¡µé¢å¯¹å‚æ•°ç±»å‹çš„ä¸åŒè¦æ±‚ã€‚ é¡µé¢åˆ†å‘å™¨ 1234&lt;a onclick=\"baobao.gotoAnyWhere( 'com.example.youngheart.MovieDetailActivity, iOS.MovieDetailViewController:movieId=(int)123')\"&gt; gotoAnyWhere&lt;/a&gt; 12345678910111213141516171819202122public class BaseActivity extends Activity &#123; public void gotoAnyWhere(String url) &#123; if (url == null) return; String pageName = getAndroidPageName(url); if (pageName == null || pageName.trim() == \"\") return; Intent intent = new Intent(); ... try &#123; intent.setClass(this, Class.forName(pageName)); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; startActivity(intent); &#125;&#125; æ¶ˆç­å…¨å±€å˜é‡é‡ç°åœºæ™¯å°±æ˜¯åœ¨ Appåˆ‡æ¢åˆ°åå°ï¼Œé—²ç½®äº†ä¸€æ®µæ—¶é—´åå†ç»§ ç»­ä½¿ç”¨æ—¶ï¼Œå°±ä¼šå´©æºƒã€‚å°¤å…¶æ˜¯ä¸€äº›é…ç½®å¾ˆä½çš„æ‰‹æœºï¼Œ ç½ªé­ç¥¸é¦–å°±æ˜¯å…¨å±€å˜é‡ æƒ³å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±ä¸€å®šè¦ä½¿ç”¨åºåˆ—åŒ–æŠ€æœ¯ æŠŠæ•°æ®ä½œä¸º Intent çš„å‚æ•°ä¼ é€’ æŠŠå…¨å±€å˜é‡åºåˆ—åŒ–åˆ°æœ¬åœ° åºåˆ—åŒ–åªæ˜¯è¿‡æ¸¡å‹è§£å†³æ–¹æ¡ˆï¼Œæœ‰å‡ ä¸ªç¡¬ä¼¤ ç±»å‹ æ˜¯å¦æ”¯æŒåºåˆ—åŒ– ç®€å•ç±»å‹ int, String, Boolean ç­‰ æ”¯æŒ String[] æ”¯æŒ Boolean[] æ”¯æŒ int[] æ”¯æŒ String[][] æ”¯æŒ int[][] æ”¯æŒ ArrayList æ”¯æŒ Calendar æ”¯æŒ JSONObject ä¸æ”¯æŒ JSONArray ä¸æ”¯æŒ HashMap&lt;String, Objeject&gt; å› ä¸º Object å¯èƒ½æ˜¯ä¸æ”¯æŒåºåˆ—åŒ–çš„ JSONObject ç±»å‹ï¼Œæ‰€ä»¥HashMap&lt;String, Object&gt; ä¸ä¸€å®šæ”¯æŒåºåˆ—åŒ– ArrayList&lt;HashMap&lt;String, Object&gt;&gt; å› ä¸º Object å¯èƒ½æ˜¯ä¸æ”¯æŒåºåˆ—åŒ–çš„ JSONObject ç±»å‹ï¼Œæ‰€ä»¥ ArrayList&lt;HashMap&lt;String, Object&gt;&gt; ä¸ä¸€å®šæ”¯æŒåºåˆ—åŒ– å¦‚æœ Activity ä¹Ÿè¢«é”€æ¯äº†å‘¢ å¦‚æœå†…å­˜ä¸è¶³å¯¼è‡´å½“å‰ Activity ä¹Ÿè¢«é”€æ¯äº†å‘¢?æ¯”å¦‚è¯´æ—‹è½¬å±å¹•ä»ç«–å±åˆ°æ¨ªå±ã€‚ å³ä½¿ Activity è¢«é”€æ¯äº†ï¼Œä¼ é€’åˆ°è¿™ä¸ª Activity çš„ Intent å¹¶ä¸ä¼šä¸¢å¤±ï¼Œåœ¨é‡æ–°æ‰§è¡Œ Activity çš„ onCreate æ–¹æ³•æ—¶ï¼ŒIntent æºå¸¦çš„ bundle å‚æ•°è¿˜æ˜¯åœ¨çš„ã€‚ Â‰onSaveInstanceState()Â‰* onRestoreInstanceState() å¦‚ä½•çœ‹å¾… SharedPreferences SharedPreferences æ˜¯å…¨å±€å˜é‡åºåˆ—åŒ–åˆ°æœ¬åœ°çš„å¦ä¸€ç§å½¢å¼ User æ˜¯å”¯ä¸€ä¾‹å¤–çš„å…¨å±€å˜é‡ ç¬¬4ç«  Android å‘½åè§„èŒƒå’Œç¼–ç è§„èŒƒ å°½é‡ç®€å•ï¼Œå¤šå†™æ³¨é‡Š Android å‘½åè§„èŒƒJava ç±»æ–‡ä»¶å‘½åè§„èŒƒï¼š Activity: ä»¥Activityä½œä¸ºåç¼€ï¼Œæ¯”å¦‚ PersonActivity Adapter: ä»¥Adapterä½œä¸ºåç¼€ï¼Œæ¯”å¦‚ PersonAdapter Entity: ä»¥Entityä½œä¸ºåç¼€ï¼Œæ¯”å¦‚ PersonEntity èµ„æºæ–‡ä»¶å‘½åè§„èŒƒï¼š layout é¡µé¢å¸ƒå±€æ–‡ä»¶ï¼š act_ä¸ºå‰ç¼€ï¼Œä»¥Activityæ‰€åœ¨çš„ Package ä¸ºä¸­ç¼€ï¼Œä»¥Activityçš„åç§°(å»æ‰Activity)ä½œä¸ºåç¼€ã€‚éƒ½æ˜¯å°å†™ã€‚æ¯”å¦‚ act_person_customer.xml ListViewä¸­çš„itemå¸ƒå±€æ–‡ä»¶ï¼šitem_ä¸ºå‰ç¼€ï¼ŒListViewæ§ä»¶åç§°ä¸ºåç¼€ã€‚ æ¯”å¦‚æ§ä»¶åç§°lvUserListæ—¶item_lv_user_list.xml Dialogå¸ƒå±€æ–‡ä»¶ï¼šdlg_ + åç§° drawable å¯¹äºåªåœ¨ä¸€ä¸ªé¡µé¢ä½¿ç”¨çš„èµ„æºï¼Œä»¥è¯¥é¡µé¢çš„åç§°ä¸ºå‰ç¼€ å¯¹äºåªåœ¨ä¸€ä¸ªæ¨¡å—ä¸‹å¤šä¸ªé¡µé¢ä½¿ç”¨çš„èµ„æºï¼Œä»¥è¯¥æ¨¡å—çš„åç§°ä¸ºå‰ç¼€ å¯¹äºåœ¨å„ä¸ªæ¨¡å—ï¼Œå„ä¸ªé¡µé¢éƒ½æœ‰å¯èƒ½ä½¿ç”¨çš„èµ„æºï¼Œæ¯”å¦‚ä¸‹å¯¼èˆªï¼Œä¸‹å¯¼èˆªï¼Œä»¥commonä½œä¸ºå‰ç¼€ Javaç±»ä¸­æ§ä»¶å¯¹è±¡çš„å‘½åè§„èŒƒ æ§ä»¶ç±»å‹ç¼©å†™ + æ§ä»¶çš„é€»è¾‘åç§°ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ æ¯”å¦‚ç™»å½•æŒ‰é’®ï¼šbtnLogin æ§ ä»¶ ç¼©å†™ LayoutView lv RelativeView rv TextView tv Button btn ImageButton img ImageView iv CheckBox chk RadioButton rb DatePicker dp EditText et TimePicker tp toggleButton tb ProgressBar pb WebView wv RantingBar rb Tab tab List lv MapView mv Layout ä¸­æ§ä»¶å¯¹è±¡çš„å‘½åè§„èŒƒ æ§ä»¶çš„é€»è¾‘åç§°ï¼ˆå°å†™ï¼‰ + æ§ä»¶ç±»å‹ æ¯”å¦‚ï¼š login_button string.xml ä¸­å¸¸é‡çš„å‘½åè§„èŒƒ loginActivity_btnLogin_text common_ Java ä¸­çš„å¸¸é‡å‘½å åªèƒ½åŒ…æ‹¬å­—æ¯å’Œä¸‹åˆ’çº¿_ï¼Œå­—æ¯å…¨å¤§å†™ï¼Œå•è¯ä¹‹é—´ç”¨ _ éš”ç©º Android ç¼–ç¨‹è§„èŒƒ ä¸èƒ½ä¸ºäº†è§„èŒƒè€Œè§„èŒƒ è¦åˆ†é—¨åˆ«ç±»å­˜æ”¾å„ç§ç±» è¦æ€ä¹ˆä½¿ç”¨findViewByIdè¯­å¥ï¼Ÿ Layoutä¸­çš„å¸¸é‡ï¼Œè¦åœ¨èµ„æºstrings.xmlä¸­å®šä¹‰ Layoutä¸­çš„æ‰€æœ‰æ§ä»¶çš„å­—ä½“å¤§å°ï¼Œåœ¨dimens.xmlä¸­ åœ¨Acitivityä¸­å®šä¹‰æ–°çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‹†åˆ†onCreate (initVariables -&gt; initViews -&gt; loadData) ä½¿ç”¨fastJSONå®ä½“åŒ–æ•°æ® é¡µé¢ä¹‹é—´ä¼ å€¼ï¼Œä½¿ç”¨Intentæºå¸¦åºåˆ—åŒ–å®ä½“æ•°æ® ä¸ºæ§ä»¶æ·»åŠ äº‹ä»¶ï¼Œç»Ÿä¸€ä½¿ç”¨æ–¹æ³• Activityä¸­ä¸è¦åµŒå¥—å†…éƒ¨ç±»ï¼Œå°½é‡ç‹¬ç«‹å‡ºæ¥ Adapter æ‰€æœ‰Adapterï¼Œéƒ½æ”¾åœ¨ adapter åŒ…ä¸­ Adapterç»‘å®šçš„æ•°æ®ï¼Œä¸€å¾‹ä¸º ArrayList&lt;è‡ªå®šä¹‰å¯åºåˆ—åŒ–å®ä½“&gt; åœ¨Adapterä¸­åˆ›å»ºé€‚åˆäºåˆ—è¡¨è‡ªèº«çš„ViewHolderå®ä½“ç±»ï¼Œç»Ÿä¸€å‘½åä¸º ViewHolder å®ä½“ä¸è¦åœ¨ä¸åŒæ¨¡å—é—´å…±äº«ï¼Œä½†å¯ä»¥åœ¨åŒä¸€æ¨¡å—ä¸‹çš„ä¸åŒé¡µé¢é—´å…±äº« ä¸ºèŠ‚çœå†…å­˜ï¼Œè¯·ä½¿ç”¨ArrayList&lt;è‡ªå®šä¹‰å®ä½“&gt;ï¼Œè€Œä¸æ˜¯HashMap å›¾ç‰‡å¤„ç†ï¼Œè¯·ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨SharedPreferencesï¼Ÿ ç®€å•é…ç½®ä¿¡æ¯ å°½é‡ä½¿ç”¨ApplicationContextä»£æ›¿Contextï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ æ•°æ®ç±»å‹è½¬æ¢ä¸€å®šè¦è¿›è¡Œæ ¡éªŒï¼Œé˜²æ­¢ç©ºæŒ‡é’ˆæˆ–ç±»å‹è½¬æ¢å¤±è´¥ ä½¿ç”¨å¸¸é‡ä»£æ›¿æšä¸¾ ç»Ÿä¸€ä»£ç æ ¼å¼Androidæºç ä¸­åŒ…å«äº†ä¸€ä»½ android-formatting.xml, ä¸“é—¨ç”¨äºç»Ÿä¸€ä»£ç æ ¼å¼ã€‚å¯¼å…¥ IDEåï¼Œä½¿ç”¨å¿«æ·é”®ï¼Œå°±å¯ä»¥è°ƒæ•´ä»£ç æ ¼å¼ è‡ªåŠ¨æ£€æŸ¥å·¥å…· checkstyle","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"Android/è¯»ä¹¦ç¬”è®°","permalink":"https://jigangduan.github.io/categories/Android/è¯»ä¹¦ç¬”è®°/"},{"name":"Appç ”å‘å½•","slug":"Android/è¯»ä¹¦ç¬”è®°/Appç ”å‘å½•","permalink":"https://jigangduan.github.io/categories/Android/è¯»ä¹¦ç¬”è®°/Appç ”å‘å½•/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"notes","slug":"notes","permalink":"https://jigangduan.github.io/tags/notes/"},{"name":"app","slug":"app","permalink":"https://jigangduan.github.io/tags/app/"}]},{"title":"TCLMOVE æŠ€æœ¯é€‰å‹","slug":"TCLMOVE-æŠ€æœ¯é€‰å‹","date":"2017-10-19T11:50:15.000Z","updated":"2020-07-25T02:57:18.170Z","comments":true,"path":"2017/10/19/TCLMOVE-æŠ€æœ¯é€‰å‹/","link":"","permalink":"https://jigangduan.github.io/2017/10/19/TCLMOVE-æŠ€æœ¯é€‰å‹/","excerpt":"Swift Storyboard RxSwfit Rleam R.Swfit Moya+Alamofire+ObjectMapper SwiftyBeaver Kingfisher CocoPod â€¦","text":"Swift Storyboard RxSwfit Rleam R.Swfit Moya+Alamofire+ObjectMapper SwiftyBeaver Kingfisher CocoPod â€¦ ç¼–ç¨‹è¯­è¨€é€‰æ‹© Swift Object-C Swiftçš„ä¼˜åŠ¿ï¼š è¶‹åŠ¿ è‹¹æœå·²ç»æ˜ç¡®ï¼ŒSwiftå°†æ˜¯æœªæ¥çš„ä¸»åŠ›å¼€å‘è¯­è¨€ Swiftå®šä½æ˜¯å®‰å…¨ï¼Œå¿«é€Ÿï¼Œè·¨å¹³å°çš„è¯­è¨€ gitHubä¸Šæ–°å¢çš„ç¬¬ä¸‰æ–¹å¼€æºåº“ï¼ŒSwiftç‰ˆæœ¬è¦å¤šä½™Object-Cçš„ç‰ˆæœ¬ Swiftçš„ç¼ºç‚¹ï¼š ä¸æ”¯æŒRuntime ç¼–è¯‘é€Ÿåº¦æ…¢ Swiftæ ¸å¿ƒåº“ä¼šæ‰“åŒ…åœ¨APPä¸­ï¼Œå¢åŠ äº†APPä½“ç§¯ å»ºè®®ï¼š å¯¹äºæ–°é¡¹ç›®å°½é‡é‡‡ç”¨Swiftï¼Œå¯¹äºä¸šåŠ¡å¤æ‚çš„æ—§é¡¹ç›®Object-Cç»§ç»­ç»´æŒ ä»£ç æ‰‹å†™ UI å’Œ Storyboard ä¹‹é—´çš„å–èˆæ„å»º UI æ–¹å¼çš„äº‰è®ºå°±åœ¨ Cocoa å¼€å‘è€…ç¤¾åŒºé‡Œä¸€ç›´å‘ç”Ÿç€ï¼ŒStoryboard è¢«è¯Ÿç—…æœ€å¤šçš„ æ˜¯å†²çªé£é™©å’ŒåŠ è½½é€Ÿåº¦ã€‚ å†²çªé£é™© Storyboard ä¸€ç›´åœ¨è¿›æ­¥ï¼Œåœ¨ Xcode 7 å¼•å…¥äº† SB reference ä»¥åï¼Œã€ŒSB å®¹æ˜“å†²çªã€å·²ç»å¾—åˆ°å¾ˆå¥½çš„è§£å†³äº†ã€‚ åŠ è½½é€Ÿåº¦ ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œé¡¹ç›®é‡Œç”¨åˆ°çš„ SB æ–‡ä»¶ä¹Ÿä¼šè¢«ç¼–è¯‘ï¼Œå¹¶ä»¥ storyboardc ä¸ºæ‰©å±•åä¿å­˜åœ¨æœ€ç»ˆçš„ app åŒ…å†…ã€‚è¿™ä¸ªæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜å‚¨äº†ä¸€ç³»åˆ— .nib æ–‡ä»¶ã€‚SB ä¸­çš„æ¯ä¸ªå¯¹è±¡å°†ä¼šè¢«ç¼–è¯‘ä¸ºä¸€ä¸ªå•ç‹¬çš„ .nibã€‚ Storyboard ä¼˜åŠ¿ Storyboardå¯ä»¥ç®€åŒ–UIçš„å¼€å‘ï¼Œå±æ€§è®¾ç½®å’Œå¸ƒå±€éƒ½å¯ä»¥ç®€å•åŒ–ï¼Œå®ç°å’Œé€»è¾‘ä»£ç çš„åˆ†ç¦»ï¼Œä¸ä¼šæ±¡æŸ“ä»£ç ã€‚ å»ºè®®ï¼š é‡‡ç”¨Storyboard RxSwiftRxSwiftæ˜¯Swiftå‡½æ•°å“åº”å¼ç¼–ç¨‹çš„ä¸€ä¸ªå¼€æºåº“ï¼Œç”±Githubçš„ReactiveXç»„ç»‡å¼€å‘ï¼Œç»´æŠ¤ã€‚ RxSwiftçš„ä¼˜ç‚¹ Composable å¯ç»„åˆï¼Œåœ¨è®¾è®¡æ¨¡å¼ä¸­æœ‰ä¸€ç§æ¨¡å¼å«åšç»„åˆæ¨¡å¼ï¼Œä½ å¯ä»¥æ–¹ä¾¿çš„ç”¨ä¸åŒçš„ç»„åˆå®ç°ä¸åŒçš„ç±» Reusable ä»£ç å¯é‡ç”¨ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå¯¹åº”RxSwiftï¼Œå°±æ˜¯ä¸€å †Obserable Declarative å“åº”å¼çš„ï¼Œå› ä¸ºçŠ¶æ€ä¸å¯å˜ï¼Œåªæœ‰æ•°æ®å˜åŒ– Understandable and concise ç®€æ´ï¼Œå®¹æ˜“ç†è§£ã€‚ Stable ç¨³å®šï¼Œå› ä¸ºRxSwiftå†™å‡ºçš„ä»£ç ï¼Œå•å…ƒæµ‹è¯•æ—¶åˆ†æ–¹ä¾¿ Less stateful â€œæ— â€çŠ¶æ€æ€§ï¼Œå› ä¸ºå¯¹äºå“åº”å¼ç¼–ç¨‹ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°±æ˜¯ä¸€å †æ•°æ®æµ Without leaks æ²¡æœ‰æ³„æ¼ï¼Œå› ä¸ºèµ„æºç®¡ç†éå¸¸ç®€å• RleamRealmæ˜¯ç”±Y Combinatorå­µåŒ–çš„åˆ›ä¸šå›¢é˜Ÿå¼€æºå‡ºæ¥çš„ä¸€æ¬¾å¯ä»¥ç”¨äºiOS(åŒæ ·é€‚ç”¨äºSwift&amp;Objective-C)å’ŒAndroidçš„è·¨å¹³å°ç§»åŠ¨æ•°æ®åº“ã€‚ è·¨å¹³å°ï¼šæ”¯æŒçš„å¹³å°åŒ…æ‹¬Javaï¼ŒObjective-Cï¼ŒSwiftï¼ŒReact Nativeï¼ŒXamarinã€‚ ç®€å•æ˜“ç”¨ï¼šCore Data å’Œ SQLite å†—ä½™ã€ç¹æ‚çš„çŸ¥è¯†å’Œä»£ç ï¼Œè€ŒRealmï¼Œå¯ä»¥æå¤§åœ°å‡å°‘å­¦ä¹ æˆæœ¬ï¼Œç«‹å³å­¦ä¼šæœ¬åœ°åŒ–å­˜å‚¨çš„æ–¹æ³•ã€‚ å¯è§†åŒ–ï¼šRealm è¿˜æä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æŸ¥çœ‹å·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹æ•°æ®åº“å½“ä¸­çš„å†…å®¹ï¼Œæ‰§è¡Œç®€å•çš„æ’å…¥å’Œåˆ é™¤æ•°æ®çš„æ“ä½œã€‚ R.SwfitR.Swfit åœ¨Swifté¡¹ç›®ä¸­è‡ªåŠ¨ç”Ÿæˆèµ„æºï¼ˆåƒå›¾ç‰‡ï¼Œå­—ä½“ï¼Œè½¬åœºï¼‰ç›¸å…³çš„å¼ºç±»å‹å˜é‡ï¼Œå¯ä»¥ä¼˜é›…çš„è·å–èµ„æºï¼Œä»¿Androidèµ„æºæ–‡ä»¶ä½¿ç”¨çš„æ–¹æ³•ã€‚ ç›¸å…³èµ„æºï¼š Swift-é¢œè‰²è®¾ç½®æŠ€å·§å’Œ(.clr)æ–‡ä»¶çš„åˆ›å»ºå’Œä½¿ç”¨ Sipï¼šåšå±å¹•å–è‰²æ²¡äººæ¯”æˆ‘å¼º Moya+Alamofire+ObjectMapperMoyaçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œæä¾›ä¸€äº›ç½‘ç»œæŠ½è±¡å±‚ï¼Œå®ƒä»¬è¢«å……åˆ†çš„å°è£…äº†ä¸”å®é™…ä¸Šç›´æ¥è°ƒç”¨äº†Alamofire. å®ƒä¸ä»…åœ¨æ™®é€šçš„ç®€å•çš„äº‹æƒ…ä¸Šå¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œè€Œä¸”åœ¨ç»¼åˆçš„å¤æ‚çš„äº‹æƒ…ä¸Šä¹Ÿå®¹æ˜“ä½¿ç”¨ å¦‚æœä½ ä½¿ç”¨ Alamofire æ¥æŠ½è±¡ URLSession, é‚£ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ä¸€äº›æ–¹å¼æ¥æŠ½è±¡URLså’Œparametersç­‰ç­‰çš„æœ¬è´¨å‘¢?Moyaçš„ä¸€äº›ç‰¹è‰²åŠŸèƒ½: å¯¹æ­£ç¡®çš„APIç«¯ç‚¹è®¿é—®è¿›è¡Œç¼–è¯‘æ—¶æ£€æŸ¥. è®©æ‚¨ä½¿ç”¨å…³è”çš„æšä¸¾å€¼å®šä¹‰ä¸åŒç«¯ç‚¹çš„æ¸…æ™°ç”¨æ³•. æŠŠtest stubä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œæ‰€ä»¥å•å…ƒæµ‹è¯•è¶…çº§ç®€å•. Alamofire æ˜¯ä¸€ä¸ªç”¨Swiftç¼–å†™çš„HTTPç½‘ç»œåº“. ç‰¹æ€§ï¼š é“¾å¼çš„è¯·æ±‚/å“åº”æ–¹æ³• URL/JSON/plistå‚æ•°ç¼–ç  ä¸Šä¼ æ–‡ä»¶/æ•°æ®/æµ/MultipartFormData ä½¿ç”¨è¯·æ±‚æˆ–æ¢å¤æ•°æ®ä¸‹è½½æ–‡ä»¶ èº«ä»½éªŒè¯ä½¿ç”¨URLCredential HTTPå“åº”éªŒè¯ ä¸Šä¼ å’Œä¸‹è½½è¿›åº¦é—­åŒ… cURLå‘½ä»¤è¾“å‡º åŠ¨æ€è°ƒæ•´å’Œé‡è¯•è¯·æ±‚ TLSè¯ä¹¦å’Œå…¬é’¥å›ºå®š ç½‘ç»œå¯è¾¾æ€§ ç»¼åˆå•å…ƒå’Œé›†æˆæµ‹è¯•è¦†ç›– å®Œæ•´çš„æ–‡æ¡£ ObjectMapperæ˜¯ä¸€ä¸ªç”¨Swiftç¼–å†™çš„æ¡†æ¶ï¼Œå®ƒä½¿æ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†æ¨¡å‹å¯¹è±¡(ç±»å’Œç»“æ„)è½¬æ¢ä¸ºJSONã€‚ ç‰¹æ€§ï¼š JSONå¯¹è±¡æ˜ å°„ å°†å¯¹è±¡æ˜ å°„åˆ°JSON åµŒå¥—å¯¹è±¡(åœ¨æ•°ç»„æˆ–å­—å…¸ä¸­å•ç‹¬ä½¿ç”¨) è‡ªå®šä¹‰è½¬æ¢æœŸé—´æ˜ å°„ ç»“æ„æ”¯æŒ å¸¸é‡çš„æ”¯æŒ SwiftyBeaverSwiftyBeaverï¼ŒSwiftå¤šå½©æ—¥å¿—è®°å½•ã€‚ ç‰¹æ€§: å¼€å‘æœŸé—´: å½©è‰²è®°å½•åˆ°Xcodeæ§åˆ¶å° å¼€å‘æœŸé—´: å½©è‰²è®°å½•æ–‡ä»¶ å‘å¸ƒæœŸé—´: åŠ å¯†è®°å½•åˆ°SwiftyBeaverå¹³å° é€šè¿‡Mac Appæ¥æµè§ˆã€æœç´¢å’Œè¿‡æ»¤ KingfisherKingfisheræ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€çº¯Swiftçš„åº“ï¼Œç”¨äºä»webä¸Šä¸‹è½½å’Œç¼“å­˜å›¾åƒã€‚è¿™ä¸ªé¡¹ç›®æ·±å—æµè¡Œçš„SDWebImageçš„å¯å‘ã€‚ ç‰¹æ€§: å¼‚æ­¥å›¾åƒä¸‹è½½å’Œç¼“å­˜ã€‚ åŸºäºURLSessionã€‚åŸºæœ¬çš„å›¾åƒå¤„ç†å™¨å’Œè¿‡æ»¤å™¨ã€‚ ç”¨äºå†…å­˜å’Œç£ç›˜çš„å¤šå±‚ç¼“å­˜ã€‚ å¯å–æ¶ˆä¸‹è½½å’Œå¤„ç†ä»»åŠ¡ä»¥æé«˜æ€§èƒ½ã€‚ ç‹¬ç«‹çš„ç»„ä»¶ã€‚æ ¹æ®éœ€è¦åˆ†åˆ«ä½¿ç”¨ä¸‹è½½ç¨‹åºæˆ–ç¼“å­˜ç³»ç»Ÿã€‚ é¢„å–å›¾åƒå¹¶åœ¨å¿…è¦æ—¶ä»ç¼“å­˜ä¸­æ˜¾ç¤ºå®ƒä»¬ã€‚ ç”¨äºUIImageViewã€NSImageå’ŒUIButtonçš„æ‰©å±•ï¼Œå¯ä»¥ç›´æ¥ä»URLä¸­è®¾ç½®å›¾åƒã€‚ è®¾ç½®æ˜ åƒæ—¶å†…ç½®çš„è½¬æ¢åŠ¨ç”»ã€‚ å¯å®šåˆ¶çš„å ä½ç¬¦ï¼ŒåŒæ—¶è½½å…¥å›¾ç‰‡ã€‚ å¯æ‰©å±•çš„å›¾åƒå¤„ç†å’Œå›¾åƒæ ¼å¼æ”¯æŒ CocoPodsCocoaPods iOSç«¯çš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚ ä½¿ç”¨CocoPodsä½œé¡¹ç›®ä¾èµ–åº“çš„ç®¡ç†å·¥å…·ï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹å’Œæœ¬åœ°çš„ã€‚","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"æ¶æ„è®¾è®¡","slug":"iOS/æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/categories/iOS/æ¶æ„è®¾è®¡/"},{"name":"TCLMOVE","slug":"iOS/æ¶æ„è®¾è®¡/TCLMOVE","permalink":"https://jigangduan.github.io/categories/iOS/æ¶æ„è®¾è®¡/TCLMOVE/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"}]},{"title":"TCLMOVE æ¶æ„è®¾è®¡","slug":"TCLMOVE-æ¶æ„è®¾è®¡","date":"2017-10-19T11:49:52.000Z","updated":"2020-07-25T02:57:18.171Z","comments":true,"path":"2017/10/19/TCLMOVE-æ¶æ„è®¾è®¡/","link":"","permalink":"https://jigangduan.github.io/2017/10/19/TCLMOVE-æ¶æ„è®¾è®¡/","excerpt":"æ¶æ„ï¼Œå°±æ˜¯å¯¹è½¯ä»¶å¤æ‚åº¦çš„ç®¡ç†ã€‚","text":"æ¶æ„ï¼Œå°±æ˜¯å¯¹è½¯ä»¶å¤æ‚åº¦çš„ç®¡ç†ã€‚ å±‚æ¬¡åˆ’åˆ† ä¸‰å±‚ç»“æ„æ¡†æ¶ UI Layer Logic Layer Persistence Layer UI Layer å±•ç°å±‚UI Layer é‡‡ç”¨MVVMæ¡†æ¶ã€‚ View Vå¯¹åº”Viewï¼Œè´£ä»»åªè´Ÿè´£æ˜¾ç¤ºï¼Œä¸ä¿å­˜ä»»ä½•çŠ¶æ€ï¼Œä¿è¯Viewçš„æ— çŠ¶æ€æ€§ï¼Œstates åªèƒ½æ¥æºäºå¤–éƒ¨ï¼ŒåŒæ ·çš„statesè®¾ç½®ï¼ŒView æ˜¾ç¤ºæ˜¾ç¤ºå†…å®¹ä¸€æ ·ã€‚ Viewæœ€ä¸»è¦çš„æ˜¯å®ç°ç»„ä»¶åŒ–ï¼Œä¸å…¶å®ƒç»„ä»¶å’Œæ¨¡å—ä¿æŒæœ€å¤§åŒ–çš„éš”ç¦»ï¼Œå¯¹å†…çš„æ¥å£åªæœ‰states,å¯¹å¤–çš„æ¥å£åªæœ‰events. æ¯”å¦‚ åŸºäºRxçš„æ–¹å¼ : 12view.rx.statesview.rx.events.click Viewçš„å¤æ‚åº¦åœ¨äºè‡ªèº«çš„å®ç°(å¤æ‚çš„ç»˜åˆ¶ï¼åŠ¨ç”»)ï¼Œä»¥åŠViewsä¹‹é—´çš„ç»„åˆï¼Œç»„ä»¶ä¹‹é—´çš„æœ€å¤§åŒ–çš„éš”ç¦»æ˜¯é˜²æ­¢å¤æ‚åº¦çš„è†¨èƒ€ã€‚ ViewModel VMå¯¹åº”ViewModel, è´Ÿè´£ç»‘å®šæ•°æ®å’ŒViewsã€‚MVVMçš„æœºåˆ¶æ˜¯VMå®ç°Vå’ŒMçš„æ•°æ®ç»‘å®šï¼ŒåŒå‘ç»‘å®šæˆ–å•å‘ç»‘å®šï¼Œç”±äºè¦å®ç°Viewçš„æ— çŠ¶æ€ï¼Œåœ¨æ­¤åªä½œå•å‘çš„æ•°æ®ç»‘å®šï¼Œæ•°æ®æ¥æºäºMï¼Œå•å‘æµäºviewçš„statesã€‚ ViewModelå¯¹åº”ä¸€ä¸ªViewController,æ­¤Sceneä¸­æ‰€æœ‰çš„viewsçŠ¶æ€è®¾ç½®éƒ½é›†ä¸­åœ¨å…¶ä¸­ï¼Œç»Ÿä¸€å¤„ç†ï¼Œé¿å…ä»£ç åˆ†æ•£åœ¨ViewControllerå„å¤„ï¼Œé€ æˆé€»è¾‘æ··ä¹±ï¼›viewsçš„enentsä¹Ÿæ˜¯ç»ç”±æ­¤åœ°ï¼Œäº§ç”ŸActions. ViewModelä¼šåˆ†æ‹…å¤§éƒ¨åˆ†ViewControllerä¸Šçš„é€»è¾‘ä»£ç ï¼Œä½†ä¹Ÿåªæ˜¯UIå±‚é¢çš„ï¼Œä¸»è¦å·¥ä½œæ˜¯stateså’Œeventsçš„åˆ†å‘å’Œä¸­é—´çŠ¶æ€çš„è½¬åŒ–ï¼Œä¸€äº›ç®€å•çš„é™åˆ¶åˆ¤æ–­å’Œstatesçš„ç»„åˆï¼åˆ†è§£ï¼Œä»…æ­¤è€Œå·²ã€‚ Model Må¯¹åº”Modelï¼ŒUI Layerä»¥ä¸‹å¯¹åº”MVVMçš„Model. Vå’ŒVMè´Ÿè´£å±•ç°å±‚ä¸Šçš„éƒ¨åˆ†ï¼Œä½œåˆ°æ— çŠ¶æ€åŒ–ã€‚è€Œæ‰€æœ‰çš„çŠ¶æ€éƒ½åœ¨Modelä¹‹ä¸­ï¼ŒçŠ¶æ€æ”¹å˜UIå‘ˆç°æ”¹å˜ã€‚ Logic Layer ä¸šåŠ¡å±‚Logic Layerä¼šæ ¹æ®ä¸šåŠ¡åˆ’åˆ†å‡ºè®¸å¤šåŠŸèƒ½æ¨¡å—ï¼Œä¸šåŠ¡å±‚åº”è¯¥æœ€å…ˆè¿›å…¥è¯¦ç»†è®¾è®¡ï¼Œå¯¹æ¯”éœ€æ±‚åˆ†ææœ‰æ•ˆçš„åˆ†ç¦»å‡ºç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ã€‚ ä¸šåŠ¡å±‚ä¸»è¦æœ‰ä¸‰ä¸ªè§’è‰²ï¼š Manager ç®¡ç†è€… Worker Protocl å·¥ä½œåè®® Worker å·¥ä½œè€… ä»¥ä¸‹æˆ‘ä»¬å°†ä»¥å…¬å¸ç»„ç»‡ç»“æ„ç±»æ¯”çš„æ–¹å¼ä»‹ç»ä¸šåŠ¡å±‚å’Œä¸‰ä¸ªè§’è‰²ã€‚ ä¸šåŠ¡å±‚ä¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ’åˆ†å‡ºç›¸åº”çš„åŠŸèƒ½æ¨¡å—ï¼Œå°±åƒå…¬å¸çš„å„ä¸ªä¸åŒçš„èŒèƒ½éƒ¨é—¨ï¼Œå„è‡ªæœ‰è‡ªå·±çš„åˆ†å·¥ä¸åä½œã€‚ å„éƒ¨é—¨ç»„ç»‡æˆå‘˜éƒ½æœ‰Managerå’ŒWorkerï¼Œæœ‰è‡ªå·±çš„èŒè´£ã€‚ Manager ä¸»è¦èŒè´£æ˜¯ ç®¡ç†Workers, åˆ†å‘ä»»åŠ¡ï¼Œ åè°ƒä»»åŠ¡ï¼Œ ä¸ä¸Šå±‚äº¤äº’ã€‚Manager ä¸ä¼šå¤„ç†å…·ä½“çš„å·¥ä½œï¼Œå…·ä½“å·¥ä½œç”±Workeræ¥å®ç°ã€‚ Workeråªå…³å¿ƒä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ï¼Œå…¶å®ƒçš„äº‹æƒ…ä¸æ¶‰åŠï¼Œè€Œä¸”åªå¯¹ä»–è‡ªå·±çš„Managerè´Ÿè´£ã€‚Workeræ‰€éœ€è¦çš„èµ„æºå’Œå·¥å…·æ¥æºäºä¸‹æ¸¸ã€‚ å·¥ä½œä»»åŠ¡ç”±Managerä¸‹æ´¾ï¼Œé€šè¿‡å·¥ä½œæ¸…å•å³Worker Protoclã€‚Worker Protoclæ˜¯å·¥ä½œè§„èŒƒï¼ˆå³æ¥å£ä¹Ÿå«åè®®ï¼‰ï¼ŒæŒ‡æ˜äº†éœ€è¦å®ç°çš„æ“ä½œã€‚è€Œèƒ½å¤Ÿå®Œæˆè¿™äº›è§„èŒƒçš„Workersï¼Œä¸åªä¸€ä¸ªï¼Œæ¯”å¦‚ç»ç†(Manager)éœ€è¦å­˜å‚¨ä¸€ä»½æ–‡æ¡£ï¼Œä¸€ä¸ªå°ç§˜(Worker)è¯´å¥¹å¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸€ä¸ªç å†œ(Worker)è¯´ä»–å¯ä»¥ä¸Šä¼ å­˜å‚¨åˆ°æœåŠ¡å™¨ï¼Œè‡³äºä½¿ç”¨é‚£ä¸ªWorkerç”±Managerå†³å®šã€‚ éƒ¨é—¨ä¹‹é—´çš„åä½œä¹Ÿæ˜¯ç”±Managerå®Œæˆï¼Œéƒ¨é—¨ç»ç†ä¼šå‘å…¶å®ƒéƒ¨é—¨è·å–ç»“æœã€‚å¦‚æœä¸€é¡¹å·¥ä½œéœ€è¦å‡ ä¸ªéƒ¨é—¨åä½œå®Œæˆï¼Œå¯ä»¥äº§ç”Ÿä¸€ä¸ªæ›´é«˜çº§çš„Managerï¼Œç®¡ç†è¿™å‡ ä¸ªéƒ¨é—¨çš„Managersã€‚ Persistence Layer æŒä¹…å±‚æŒä¹…å±‚æ˜¯å¯¹æ¥åŸºç¡€è®¾æ–½ï¼Œèµ„æºçš„å‡ºå…¥å£ï¼Œä¹Ÿå¯ä»¥å«èµ„æºå±‚ã€‚ å…¶ä¸»è¦åŒ…æ‹¬ï¼š HTTP Client æ•°æ®åº“ BLE æœ¬åœ°æ–‡ä»¶ èµ„æºæ–‡ä»¶ â€¦ HTTP Client æœåŠ¡å™¨ç«¯é‡‡ç”¨HTTP/RESTfulï¼Œç§»åŠ¨ç«¯å¯¹åº”é‡‡ç”¨APIå±‚å’ŒClientå±‚ã€‚ Clientå±‚ å¯¹åº”HTTPå®¢æˆ·ç«¯åŠŸèƒ½ï¼Œå®ŒæˆHTTPç½‘ç»œè¯·æ±‚åŠŸèƒ½ã€‚ APIå±‚ å¯¹åº”Restï¼Œå®Œæˆæ¥å£å®šä¹‰ï¼Œè®©ä¸Šå±‚é€šè¿‡æ¥å£ç›´æ¥æ“ä½œèµ„æºã€‚ è¿˜éœ€è¦å®Œæˆæœ¬åœ°ç¼“å­˜åŠŸèƒ½ï¼Œé…åˆæœåŠ¡ç«¯çš„HTTPç¼“å­˜æœºåˆ¶ï¼Œå’Œè‡ªå·±çš„ç¦»çº¿ç¼“å­˜ã€‚ æ•°æ®åº“ æ•°æ®åº“å®ç°DAOï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼‰ï¼Œç»Ÿä¸€æ•°æ®åº“çš„æ•°æ®æ“ä½œæ ‡å‡†ã€‚ æ•°æ®åº“é‡‡ç”¨ORM(å¯¹è±¡å…³ç³»æ˜ å°„)æ¡†æ¶ï¼Œå±è”½SQLçš„æ“ä½œæ­¥éª¤ã€‚ Change Events,å½“æ•°æ®åº“æ•°æ®æ”¹å˜æ—¶ï¼Œäº§ç”Ÿç›¸åº”çš„é€šçŸ¥äº‹ä»¶ã€‚ BLE File Manage Resource Manage ä¸‰å±‚ä¹‹é—´çš„æ¡¥æ¢ä¸‰å±‚ç»“æ„UI Layerï¼ŒLogic Layerï¼ŒPersistence Layerå¦‚ä¸Šæ‰€è¿°ï¼Œå„è‡ªæœ‰å„è‡ªçš„èŒè´£ï¼Œå½¼æ­¤ä¹‹é—´ä¹Ÿæ˜¯éš”ç¦»çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ†é…ç»™ä¸åŒçš„å¼€å‘äººå‘˜ï¼Œç‹¬ç«‹çš„å•å…ƒæµ‹è¯•ã€‚è€Œå®ƒä»¬ä¹‹é—´éœ€æ±‚å»ºç«‹æ²Ÿé€šçš„æ¡¥æ¢ã€‚ App StatesApp Statesçš„æ€æƒ³æ¥æºä¸Fluxæ¶æ„ï¼Œå®ç°å®ƒçš„æœ‰å‰ç«¯çš„Reduxã€‚ã€å¯å‚è€ƒ Reduxã€‘ App Statesæ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨ï¼Œå¦‚ä¸Šæ‰€è¿°UIå±‚æ˜¯æ— çŠ¶æ€çš„ï¼Œè€Œå®ƒçš„çŠ¶æ€æ¥æºæ˜¯App Statesï¼Œå¹¶ä¸”ä½œçŠ¶æ€çš„ç»Ÿä¸€ç®¡ç†ã€‚ App Statesä¿å­˜äº†æ‰€æœ‰çš„çŠ¶æ€ï¼Œé€šè¿‡View Modelç»‘å®šViewï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ç›¸åº”çš„Viewä¼šå‘ç”Ÿæ”¹å˜ã€‚ è¿™é‡Œæœ€å¤§çš„éš¾åº¦æ˜¯statesã€‚å½’çº³stateséœ€è¦å³è¦å…¨é¢ä¹Ÿè¦ç²¾å‡†,é‚£äº›å€¼å¯ä»¥æ˜¯stateé‚£äº›ä¸æ˜¯è¯·æ…é‡è€ƒè™‘ã€‚æ¯”å¦‚ä¸šåŠ¡æ•°æ®ä¸­çš„å°å­©å­ä¿¡æ¯æ˜¯ä¸€å®šåœ¨statesä¸­ï¼Œè¿˜æœ‰åƒ æ­£åœ¨è·å–é”€æ¯ä¿¡æ¯çš„çŠ¶æ€ ä¹Ÿæ˜¯ä¸€ä¸ªå¸ƒå°”çš„stateï¼Œä½†åƒå°å­©å­çš„æ•°ç›®è¿™ç§å€¼ï¼Œå·²ç»å¯ä»¥ä»ç»„ç»‡sizeä¸­çŸ¥é“ï¼Œå°±ä¸åº”è¯¥åœ¨statesï¼Œè¿™äº›å€¼ä¼šç…§æˆstateså†—ä½™çš„ï¼Œä½¿å¾—ç®¡ç†å¤æ‚åŒ–ã€‚ ç„¶åï¼Œè®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š State æ˜¯åªè¯»çš„ æƒŸä¸€æ”¹å˜ State çš„æ–¹æ³•å°±æ˜¯è§¦å‘ actionï¼Œé€šè¿‡ reducers æ”¹å˜ states statesçš„ç»“æ„å°½é‡æ‰å¹³åŒ–ï¼Œä¸è¦æœ‰å¤ªå¤šçš„åµŒå¥—ã€‚ RepositoryRepositoryé‡‡ç”¨å¤–è§‚æ¨¡å¼ã€‚ Repositoryå¯¹æ¥Persistence Layerï¼Œæä¾›ä¸€ç»„ä¸€è‡´çš„æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œä¸Šå±‚ä¸å…³å¿ƒæ•°æ®æ¥æºäºé‚£é‡Œï¼ˆé‚£ä¸ªç½‘ç»œæœåŠ¡å™¨æˆ–è“ç‰™æˆ–æ•°æ®åº“ï¼‰ï¼Œå®ƒåªå…³å¿ƒå®ƒè¦çš„æ•°æ®ã€‚","categories":[{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"æ¶æ„è®¾è®¡","slug":"iOS/æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/categories/iOS/æ¶æ„è®¾è®¡/"},{"name":"TCLMOVE","slug":"iOS/æ¶æ„è®¾è®¡/TCLMOVE","permalink":"https://jigangduan.github.io/categories/iOS/æ¶æ„è®¾è®¡/TCLMOVE/"}],"tags":[{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"}]},{"title":"PlantUML","slug":"PlantUML","date":"2017-10-17T06:34:26.000Z","updated":"2020-07-25T02:57:18.160Z","comments":true,"path":"2017/10/17/PlantUML/","link":"","permalink":"https://jigangduan.github.io/2017/10/17/PlantUML/","excerpt":"","text":"PlantUMLæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ”¯æŒå¿«é€Ÿç»˜åˆ¶ï¼š æ—¶åºå›¾ Sequence diagram ç”¨ä¾‹å›¾ Usecase diagram ç±»å›¾ Class diagram æ´»åŠ¨å›¾ Activity diagram ç»„ä»¶å›¾ Component diagram çŠ¶æ€å›¾ State diagram éƒ¨ç½²å›¾ Deployment diagram å¯¹è±¡å›¾ Object diagram çº¿æ¡†å›¾å½¢ç•Œé¢ wireframe graphical interface æ—¶åºå›¾ Timing Diagram ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒå¦‚ä¸‹æ–‡æ¡£ï¼š _å®˜ç½‘_ ä½¿ç”¨ PlantUML ç»˜åˆ¶çš„ UML å®‰è£…PlantUML æ˜¾ç¤ºä¾èµ– Graphviz , éœ€è¦å…ˆå®‰è£… Graphviz Mac å®‰è£… Graphviz 1brew install Graphviz Ubuntu å®‰è£… Graphviz 1apt-get install graphviz Windows ä¸‹ä½¿ç”¨chocoæ¥å®‰è£…Graphviz åœ¨cmdä¸­å®‰è£…chocolatey 1@powershell -NoProfile -ExecutionPolicy unrestricted -Command &quot;iex ((new-object net.webclient).DownloadString(&apos;http://bit.ly/psChocInstall&apos;))&quot; &amp;&amp; SET PATH=%PATH%;%systemdrive%\\chocolatey\\bin åœ¨cmdä¸­å®‰è£…Graphviz 1choco install Graphviz åœ¨Atomä¸­å®‰è£…å®‰è£…ä¸¤ä¸ªPackage : language-plantumlã€ plantuml-preview åœ¨IDEä¸­å®‰è£…å®‰è£…æ’ä»¶ PlantUML integration ä½¿ç”¨åœ¨Atomä¸­ä½¿ç”¨ æ–°å»ºæ–‡ä»¶ï¼Œä¿å­˜ä¸º.puæ–‡ä»¶ 1234567891011121314151617181920212223242526@startumlabstract class AbstractListabstract AbstractCollectioninterface Listinterface CollectionList &lt;|-- AbstractListCollection &lt;|-- AbstractCollectionCollection &lt;|- ListAbstractCollection &lt;|- AbstractListAbstractList &lt;|-- ArrayListclass ArrayList &#123; Object[] elementData size()&#125;enum TimeUnit &#123; DAYS HOURS MINUTES&#125;@enduml æ‰“å¼€ plantuml-preview å¦‚æœå‡ºç°ä¸‹åˆ—é”™è¯¯æƒ…å†µï¼Œæ˜¯éœ€è¦æŒ‡å®šplantuml.jar plantuml.jar å¯ä»¥é€šè¿‡PlantUMLå®˜ç½‘ä¸‹è½½ è®¾ç½® plantuml-preview çš„ plantuml.jar å¯¹åº”çš„UMLå›¾å¦‚ä¸‹æ‰€ç¤º åœ¨IDEä¸­ä½¿ç”¨é€šè¿‡Fileèœå•æ‰“å¼€ï¼š ç¤ºä¾‹æ•ˆæœå±•ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š ä»¥ä¸‹ä¸ºä¸€ä¸ªæ¡†æ¶å›¾ PlantUML code: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213@startumltitle TCLMOVE æ¶æ„å›¾skinparam backgroundColor #DBDBD8skinparam handwritten trueskinparam package &#123; backgroundColor&lt;&lt;Scenes&gt;&gt; #7BD2F7 borderColor&lt;&lt;Scenes&gt;&gt; #90D2F7 fontSize&lt;&lt;Scenes&gt;&gt; 13 backgroundColor&lt;&lt;Servers&gt;&gt; #DBEAD0 borderColor&lt;&lt;Servers&gt;&gt; #DBEAD0 backgroundColor&lt;&lt;Models&gt;&gt; #FEFECE borderColor&lt;&lt;Models&gt;&gt; #FEFEAE&#125;skinparam folder &#123; backgroundColor&lt;&lt;Managers&gt;&gt; #BBDAC0 borderColor&lt;&lt;Managers&gt;&gt; #DBEAD0 backgroundColor&lt;&lt;Workers&gt;&gt; #DBEAA0 borderColor&lt;&lt;Workers&gt;&gt; #DBEAD0&#125;skinparam interface &#123; backgroundColor RosyBrown borderColor orange&#125;skinparam entity &#123; backgroundColor RosyBrown borderColor orange&#125;skinparam cloud &#123; backgroundColor #00 borderColor #00&#125;skinparam database &#123; backgroundColor #B1BFC3 borderColor #B1BFE3&#125;skinparam component &#123; backgroundColor #5ABAA7 borderColor #7ABAA7&#125;skinparam node &#123; backgroundColor #E68274 borderColor #E68274&#125;package &quot;UI Layer&quot; &lt;&lt;Scenes&gt;&gt; &#123; [View1] as v1 [ViewModel1] as vm1 v1 -(0)- vm1 [View2] as v2 [ViewModel2] as vm2 v2 -(0)- vm2 [View3] as v3 [ViewModel3] as vm3 v3 -(0)- vm3 component &quot;View&quot; as v component &quot;ViewModel&quot; as vm v -(0)- vm&#125;node &quot;State&quot; &#123; component &quot;App State&quot; as state component &quot;Reducer&quot; as reducer component &quot;Action&quot; as action component &quot;Action Creator&quot; as creator state &lt;- reducer reducer &lt;-- action creator -&gt; action&#125;vm &lt;... statevm1 &lt;.. statevm2 &lt;.. statevm3 &lt;.. statepackage &quot;Logic Layer&quot; &lt;&lt;Servers&gt;&gt; &#123;folder Managers &lt;&lt;Managers&gt;&gt; &#123; [Account Manager] as am [Device Manager] as dm [Location Manager] as lm [Message Manager] as mm [Notification Manager] as nm [... Manager] as om&#125;creator &lt;-- amcreator &lt;-- dmcreator &lt;-- lmcreator &lt;-- mmcreator &lt;- nmcreator &lt;- omfolder Workers &lt;&lt;Workers&gt;&gt; as workers &#123; interface &quot;Account Worker Protocl&quot; as awp [Account Worker] as aw awp ^-- aw interface &quot;Device Worker Protocl&quot; as dwp [Device Worker] as dw dwp ^-- dw interface &quot;Location Worker Protocl&quot; as lwp [Location Worker] as lw lwp ^-- lw interface &quot;Message Worker Protocl&quot; as mwp [Message Worker] as mw mwp ^-- mw interface &quot;Notification Worker Protocl&quot; as nwp [Notification Worker] as nw nwp ^-- nw interface &quot;... Worker Protocl&quot; as owp [... Worker] as ow owp ^-- ow&#125;am --&gt; awpdm --&gt; dwplm --&gt; lwpmm --&gt; mwpnm --&gt; nwpom --&gt; owp&#125;node &quot;Repository&quot; as repositoryskinparam rectangle &#123; roundCorner&lt;&lt;API&gt;&gt; 25 roundCorner&lt;&lt;BLE&gt;&gt; 8 roundCorner&lt;&lt;DAO&gt;&gt; 12 roundCorner&lt;&lt;...&gt;&gt; 35 backgroundColor&lt;&lt;API&gt;&gt; #C4DADF borderColor&lt;&lt;API&gt;&gt; #E0DADF backgroundColor&lt;&lt;BLE&gt;&gt; #C4DFDA borderColor&lt;&lt;BLE&gt;&gt; #E4DFDA backgroundColor&lt;&lt;DAO&gt;&gt; #DFC4DA borderColor&lt;&lt;DAO&gt;&gt; #DFC4EA backgroundColor #AFC4DA borderColor #AFC4EA&#125;package &quot;Persistence Layer&quot; &lt;&lt;Models&gt;&gt; as models &#123; rectangle &quot;... Managements&quot; &lt;&lt;...&gt;&gt; &#123; rectangle &quot;...&quot; &lt;&lt;...&gt;&gt; &#125; rectangle &quot;BLE Managements&quot; &lt;&lt;BLE&gt;&gt; as blem &#123; rectangle &quot;BLE attributes&quot; &lt;&lt;BLE&gt;&gt; as ble rectangle &quot;Local Storage&quot; rectangle &quot;Events&quot; &#125; rectangle &quot;DAO Managements&quot; &lt;&lt;DAO&gt;&gt; as daom &#123; rectangle &quot;DAO&quot; &lt;&lt;DAO&gt;&gt; as dao rectangle &quot;Change Events&quot; &#125; rectangle &quot;API Managements&quot; &lt;&lt;API&gt;&gt; as apim &#123; rectangle &quot;Resource APIs&quot; &lt;&lt;API&gt;&gt; as rapis rectangle &quot;Local Cache&quot; &#125; [Http Client] as httpclient [database orm] as orm [BLE å¤–è®¾] as blew rapis &lt;-- httpclient dao &lt;-- orm ble &lt;-- blew&#125;aw --&gt; repositorydw --&gt; repositorylw --&gt; repositorymw --&gt; repositorynw --&gt; repositoryow --&gt; repositoryrepository --&gt; apimrepository --&gt; daomrepository --&gt; blemcloud Cloud as clouddatabase &quot;database&quot; as databaseentity &quot;BLE&quot; as ble_entityhttpclient --&gt; cloudorm --&gt; databaseblew --&gt; ble_entity@enduml","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/categories/å·¥å…·/"}],"tags":[{"name":"atom","slug":"atom","permalink":"https://jigangduan.github.io/tags/atom/"},{"name":"idea","slug":"idea","permalink":"https://jigangduan.github.io/tags/idea/"},{"name":"uml","slug":"uml","permalink":"https://jigangduan.github.io/tags/uml/"}]},{"title":"impress.js","slug":"ImportJs","date":"2017-10-11T03:18:41.000Z","updated":"2020-07-25T02:57:18.157Z","comments":true,"path":"2017/10/11/ImportJs/","link":"","permalink":"https://jigangduan.github.io/2017/10/11/ImportJs/","excerpt":"impress.js æ˜¯ä¸€ä¸ªJavascriptç¨‹åºåŒ…ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©ä½ åˆ¶ä½œå‡ºä»¤äººçœ©ç›®çš„å†…å®¹å±•ç¤ºæ•ˆæœï¼Œä¸»è¦é‡Œåˆ©ç”¨äº†CSS 3D Transforms é‡Œçš„æ—‹è½¬ï¼Œæ‰­æ›²ï¼Œç¼©æ”¾ç­‰ç‰¹æ€§ã€‚ç®€è¨€ä¹‹ï¼Œä»£æ›¿pptã€‚","text":"impress.js æ˜¯ä¸€ä¸ªJavascriptç¨‹åºåŒ…ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯è®©ä½ åˆ¶ä½œå‡ºä»¤äººçœ©ç›®çš„å†…å®¹å±•ç¤ºæ•ˆæœï¼Œä¸»è¦é‡Œåˆ©ç”¨äº†CSS 3D Transforms é‡Œçš„æ—‹è½¬ï¼Œæ‰­æ›²ï¼Œç¼©æ”¾ç­‰ç‰¹æ€§ã€‚ç®€è¨€ä¹‹ï¼Œä»£æ›¿pptã€‚ å¯¹æ¯”ï¼š nodeppt æ–‡æ¡£: impress.jsâ€”â€”ç”¨HTMLâ€œå†™â€å¹»ç¯ç‰‡ impress.jsåˆä½“éªŒ - å‰ç«¯è£…Xåˆ©å™¨ impress.js ä¸­æ–‡ç‰ˆ å­¦ä¹ ","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"å¹»ç¯ç‰‡","slug":"å‰ç«¯/å¹»ç¯ç‰‡","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/å¹»ç¯ç‰‡/"}],"tags":[{"name":"ppt","slug":"ppt","permalink":"https://jigangduan.github.io/tags/ppt/"},{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/tags/å·¥å…·/"}]},{"title":"android ä»£ç ä¼˜åŒ– - æ³¨è§£æ£€æŸ¥","slug":"android-code-lint","date":"2017-10-10T06:16:32.000Z","updated":"2020-07-25T02:57:18.172Z","comments":true,"path":"2017/10/10/android-code-lint/","link":"","permalink":"https://jigangduan.github.io/2017/10/10/android-code-lint/","excerpt":"","text":"ä½¿ç”¨ Lint æ”¹è¿›æ‚¨çš„ä»£ç  ä½¿ç”¨æ³¨è§£æ”¹è¿›ä»£ç æ£€æŸ¥ android.support.annotation èµ„æºç±»æ³¨è§£: æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° e.g. AnimatorRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ åŠ¨ç”»èµ„æºå¼•ç”¨ android.R.animator.fade_in AnimRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ animèµ„æºå¼•ç”¨ android.R.animator.fade_in AnyRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ ä»»ä½•ç±»å‹çš„èµ„æºå¼•ç”¨ - ArrayRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ æ•°ç»„èµ„æºå¼•ç”¨ android.R.array.phoneTypes AttrRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å±æ€§å¼•ç”¨ android.R.attr.action BoolRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¸ƒå°”èµ„æºå¼•ç”¨ - ColorRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ é¢œè‰²èµ„æºå¼•ç”¨ android.R.color.black DimenRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å°ºå¯¸èµ„æºå¼•ç”¨ android.R.dimen.app_icon_size DrawableRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ Drawableèµ„æºå¼•ç”¨ android.R.attr.alertDialogIcon FontRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å­—ä½“èµ„æºå¼•ç”¨ R.font.myfont StringRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ Stringèµ„æºå¼•ç”¨ android.R.string.ok StyleableRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ styleableèµ„æºå¼•ç”¨ android.R.styleable.TextView_text StyleRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ styleèµ„æºå¼•ç”¨ android.R.style.TextAppearance TransitionRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ transitionèµ„æºå¼•ç”¨ - LayoutRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¸ƒå±€èµ„æºå¼•ç”¨ android.R.layout.list_content MenuRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ èœå•èµ„æºå¼•ç”¨ - NavigationRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¯¼èˆªèµ„æºå¼•ç”¨ R.navigation.flow PluralsRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¤æ•°çš„èµ„æºå¼•ç”¨ - RawRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ rawèµ„æºå¼•ç”¨ - XmlRes ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ XMLèµ„æºå¼•ç”¨ - ç‰¹å®šç±»å‹å€¼ç›¸å…³æ³¨è§£ï¼š æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° ColorInt ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¡«å……è‰²çš„intï¼ŒAARRGGBB ColorLong ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¡«å……Colorçš„long Dimension ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ è¡¨ç¤ºä¸€ä¸ªå°ºå¯¸ Px ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ è¡¨ç¤ºä¸€ä¸ªåƒç´ ç»´åº¦ çº¿ç¨‹ç›¸å…³æ³¨è§£ï¼š æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° AnyThread âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ è¡¨ç¤ºå¯ä»¥ä»ä»»ä½•çº¿ç¨‹è°ƒç”¨å¸¦æ³¨é‡Šçš„æ–¹æ³•(ä¾‹å¦‚ï¼Œå®ƒæ˜¯â€œçº¿ç¨‹å®‰å…¨çš„â€)ã€‚å¦‚æœå¸¦æ³¨é‡Šçš„å…ƒç´ æ˜¯ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥ä»ä»»ä½•çº¿ç¨‹è°ƒç”¨ã€‚ BinderThread âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ åœ¨Binderçº¿ç¨‹ä¸Šè°ƒç”¨ MainThread âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ åº”è¯¥åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨ UiThread âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ åº”è¯¥åœ¨UIçº¿ç¨‹ä¸Šè°ƒç”¨ WorkerThread âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ åº”è¯¥åªåœ¨å·¥ä½œçº¿ç¨‹ä¸Šè°ƒç”¨ 12@AnyThreadpublic void deliverResult(D data) &#123; ... &#125; å››ä¸ªçº¿ç¨‹ç›¸å…³æ³¨è§£çš„å·®å¼‚ å‚è€ƒè¿™é‡Œ å–å€¼èŒƒå›´æ³¨è§£ï¼š æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° FloatRange âŒ æµ®ç‚¹æ•°æˆ–åŒç²¾åº¦æ•°ç»™å®šèŒƒå›´å†… IntRange âŒ intæˆ–longç»™å®šèŒƒå›´å†… 1234@FloatRange(from=0.0,to=1.0)public float getAlpha() &#123; ...&#125; ç©ºæŒ‡é’ˆæ£€æŸ¥: æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° NonNull ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ æ°¸è¿œä¸èƒ½ä¸ºç©º Nullable ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ å¯ä»¥ä¸ºnull æƒé™ç›¸å…³æ³¨è§£ï¼š æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° RequiresPermission âŒ ğŸ‘Œ âŒ ğŸ‘Œ ğŸ‘Œ éœ€è¦(æˆ–å¯èƒ½éœ€è¦)ä¸€ä¸ªæˆ–å¤šä¸ªæƒé™ RequiresPermission.Read âŒ ğŸ‘Œ âŒ ğŸ‘Œ ğŸ‘Œ æŒ‡å®šçš„æƒé™æ˜¯è¯»æ“ä½œæ‰€å¿…éœ€çš„ RequiresPermission.Write âŒ ğŸ‘Œ âŒ ğŸ‘Œ ğŸ‘Œ æŒ‡å®šçš„æƒé™æ˜¯å†™æ“ä½œæ‰€å¿…éœ€çš„ å¯è§æ€§ç›¸å…³æ³¨è§£ï¼š æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° RequiresApi âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ åœ¨ç»™å®šçš„APIçº§åˆ«æˆ–æ›´é«˜çº§åˆ«ä¸Šè°ƒç”¨ RestrictTo âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ åº”è¯¥åªä»ä¸€ä¸ªç‰¹å®šçš„èŒƒå›´å†…è®¿é—®(ç”±RestrictTo.Scopeå®šä¹‰) VisibleForTesting âŒ ğŸ‘Œ âŒ ğŸ‘Œ ğŸ‘Œ æµ‹è¯•å¯è§ å…¶ä»–æ³¨è§£ï¼š æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° CallSuper âŒ âŒ âŒ ğŸ‘Œ âŒ è¡¨ç¤ºä»»ä½•å¤å†™æ–¹æ³•éƒ½åº”è¯¥è°ƒç”¨æ­¤æ–¹æ³• Keep âŒ âŒ âŒ ğŸ‘Œ ğŸ‘Œ è¡¨ç¤ºå½“ä»£ç åœ¨æ„å»ºæ—¶è¢«å‹ç¼©æ—¶ï¼Œä¸åº”è¯¥åˆ é™¤å¸¦æ³¨é‡Šçš„å…ƒç´ ã€‚è¿™é€šå¸¸ç”¨äºæ–¹æ³•å’Œç±»ï¼Œè¿™äº›æ–¹æ³•å’Œç±»åªèƒ½é€šè¿‡åå°„æ¥è®¿é—®ï¼Œå› æ­¤ç¼–è¯‘å™¨å¯èƒ½è®¤ä¸ºä»£ç æ˜¯æœªä½¿ç”¨çš„ã€‚ æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° StringDef ğŸ‘Œ ğŸ‘Œ ğŸ‘Œ âŒ âŒ è¡¨ç¤ºä¸€ä¸ªé€»è¾‘ç±»å‹ï¼Œå®ƒçš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ˜¾å¼å‘½åçš„å¸¸é‡ 123456789101112@Retention(SOURCE) @StringDef(&#123; POWER_SERVICE, WINDOW_SERVICE, LAYOUT_INFLATER_SERVICE &#125;) public @interface ServiceName &#123;&#125; public static final String POWER_SERVICE = \"power\"; public static final String WINDOW_SERVICE = \"window\"; public static final String LAYOUT_INFLATER_SERVICE = \"layout_inflater\"; ... public abstract Object getSystemService(@ServiceName String name); æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° Size ğŸ‘Œ âŒ ğŸ‘Œ âŒ âŒ å¤æ•°çš„èµ„æºå¼•ç”¨,ç”¨äºæ•°ç»„æˆ–é›†åˆï¼ŒæŒ‡å®šå¤§å°æˆ–é•¿åº¦ 123public void getLocationInWindow(@Size(2) int[] location) &#123; ...&#125; æ³¨é‡Š å‚æ•° å­—æ®µ æ–¹æ³•è¿”å›å€¼ æ–¹æ³• ç±» æè¿° CheckResult âŒ âŒ ğŸ‘Œ âŒ âŒ è¡¨ç¤ºå¸¦æ³¨é‡Šçš„æ–¹æ³•è¿”å›ä¸€ä¸ªç»“æœ,é€šå¸¸ç”¨äºæ²¡æœ‰å‰¯ä½œç”¨çš„æ–¹æ³• CheckResult(suggest) âŒ âŒ âŒ ğŸ‘Œ âŒ å»ºè®®çš„æ–¹æ³•çš„åç§° 123456789public @CheckResult String trim(String s) &#123; return s.trim(); &#125; ... s.trim(); // this is probably an error s = s.trim(); // ok // CheckResult(suggest) @CheckResult(suggest=\"#redirectErrorStream(boolean)\") public boolean redirectErrorStream() &#123; ... &#125;","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Androidä¼˜åŒ–","slug":"Android/Androidä¼˜åŒ–","permalink":"https://jigangduan.github.io/categories/Android/Androidä¼˜åŒ–/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"}]},{"title":"Android Theme å’Œ Style","slug":"android-theme-style","date":"2017-10-09T09:02:11.000Z","updated":"2020-07-25T02:57:18.173Z","comments":true,"path":"2017/10/09/android-theme-style/","link":"","permalink":"https://jigangduan.github.io/2017/10/09/android-theme-style/","excerpt":"Android 5.0 å¸¦æ¥äº†æ–°çš„åŠŸèƒ½ï¼Œå…è®¸ä½ ä¸ºè§†å›¾(ä»¥åŠä»»ä½•åä»£)æŒ‡å®šä¸€ä¸ªè¦†ç›–ä¸»é¢˜ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨å®ƒä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒã€‚","text":"Android 5.0 å¸¦æ¥äº†æ–°çš„åŠŸèƒ½ï¼Œå…è®¸ä½ ä¸ºè§†å›¾(ä»¥åŠä»»ä½•åä»£)æŒ‡å®šä¸€ä¸ªè¦†ç›–ä¸»é¢˜ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨å®ƒä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒã€‚ ä¸ºä»€ä¹ˆ?æ‚¨å¯èƒ½å·²ç»åœ¨ä¸çŸ¥é“çš„æƒ…å†µä¸‹ä½¿ç”¨äº†è¿™ä¸ªåŠŸèƒ½:Theme.Holo.Light.DarkActionBarã€‚ è€ƒè™‘ä¸€ä¸‹Light.DarkActionBarä¸»é¢˜ã€‚å†…å®¹æ˜¯äº®ç³»çš„ä¸»é¢˜(èƒŒæ™¯æ˜¯äº®çš„ï¼Œå‰æ™¯æ˜¯æš—çš„)ï¼Œä½†æ˜¯åŠ¨ä½œæ¡ä½¿ç”¨äº†ä¸€ä¸ªæš—çš„ä¸»é¢˜(æš—èƒŒæ™¯å’Œäº®å‰æ™¯è‰²)ã€‚ å¦‚æœä¸èƒ½æä¾›ä¸€ä¸ªå•ç‹¬çš„ä¸»é¢˜ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨å°†æ–‡æœ¬é¢œè‰²å’Œå…¶ä»–å‰æ™¯é¢œè‰²è®¾ç½®ä¸ºæŸç§ç›¸åè‰²ã€‚ è¿™é‡Œå°±æ˜¯æ—§çš„actionBarWidgetThemeå±æ€§å‡ºç°çš„åœ°æ–¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šåªç”¨äºä½ çš„æ“ä½œæ çš„ä¸»é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯¥å¹³å°çš„DarkActionBarä¸»é¢˜: 123&lt;style name=\"Theme.Holo.Light.DarkActionBar\"&gt; &lt;item name=\"android:actionBarWidgetTheme\"&gt;@android:style/Theme.Holo&lt;/item&gt;&lt;/style&gt; å› æ­¤ï¼Œä½ å¯ä»¥åœ¨action barä¸Šä½¿ç”¨æš—ä¸»é¢˜ã€‚ åŸºæœ¬åŠŸèƒ½å¦‚ä½•å·¥ä½œçš„å‘¢?ç®€å•åœ°è¯´ï¼Œå®ƒæ˜¯API v1çš„ä¸€ä¸ªå¯ç”¨çš„ContextThemeWrapperç±»ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯: å®ƒåŒ…è£…åœ¨ç°æœ‰çš„Context (æ¯”å¦‚Activity)ï¼Œç„¶åå°†ä¸€ä¸ªæ–°ä¸»é¢˜è¦†ç›–åˆ°è¯¥Contextçš„ä¸»é¢˜ä¹‹ä¸Šã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´â€¦â€¦ ThemeOverlayæ‚¨å¯èƒ½å·²ç»åœ¨Lollipop SDKä¸­çœ‹åˆ°äº†è¿™äº›ä¸»é¢˜ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„è¦†ç›–: ThemeOverlay.Material.Light ThemeOverlay.Material.Dark é‚£ä¹ˆè¿™äº›æ˜¯ä»€ä¹ˆå‘¢?åŒæ ·ï¼Œçº¿ç´¢åœ¨åç§°ä¸­ï¼Œå®ƒä»¬ä¸ContextThemeWrapperçš„å·¥ä½œæ–¹å¼æ˜¯ç›´æ¥åŒ¹é…çš„ã€‚ å®ƒä»¬æ˜¯ç‰¹æ®Šçš„ä¸»é¢˜ï¼Œè¦†ç›–äº†æ­£å¸¸çš„Theme.Materialä¸»é¢˜ï¼Œè¦†ç›–äº†ç›¸å…³çš„å±æ€§ï¼Œä½¿å®ƒä»¬å˜å¾—äº®/æš—ã€‚ ThemeOverlay + ActionBarä½ æ•é”çš„çœ¼ç›ä¹Ÿä¼šçœ‹åˆ°ActionBar ThemeOverlayè¡ç”Ÿå“: ThemeOverlay.Material.Light.ActionBar ThemeOverlay.Material.Dark.ActionBar è¿™äº›åªåº”è¯¥é€šè¿‡æ–°çš„actionBarThemeå±æ€§ä¸Action Barä¸€èµ·ä½¿ç”¨ï¼Œæˆ–è€…ç›´æ¥è®¾ç½®åœ¨æ‚¨çš„Toolbarä¸Š(è§ä¸‹é¢)ã€‚ ç›®å‰å¯¹ä»–ä»¬çš„çˆ¶æ¯æ¥è¯´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä»–ä»¬å°†colorControlNormalæ›´æ”¹ä¸ºandroid:textColorPrimaryï¼Œä»è€Œä½¿ä»»ä½•æ–‡æœ¬å’Œå›¾æ ‡éƒ½ä¸é€æ˜ã€‚ android:themeè®©æˆ‘ä»¬å›åˆ°æ–°çš„LollipopåŠŸèƒ½ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œç°åœ¨å¯ä»¥ç›´æ¥åœ¨å¸ƒå±€ä¸­æŒ‡å®šä¸€ä¸ªä¸»é¢˜ã€‚æœ€å¸¸è§çš„ä½¿ç”¨(å¯èƒ½)æ˜¯ä½¿ç”¨Toolbar: 12345&lt;Toolbar android:layout_height=\"?android:attr/actionBarSize\" android:layout_width=\"match_parent\" android:background=\"?android:attr/colorPrimaryDark\" android:theme=\"@android:style/ThemeOverlay.Material.Dark.ActionBar\" /&gt; å¸Œæœ›ä½ ä»¬ç°åœ¨èƒ½çœ‹åˆ°å®ƒä»¬æ˜¯å¦‚ä½•ç»“åˆåœ¨ä¸€èµ·çš„ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»è®©Toolbaræœ‰äº†ä¸€ä¸ªé»‘è‰²çš„ä¸»é¢˜ï¼Œç¡®ä¿å®ƒçš„å†…å®¹æ˜¯æµ…è‰²çš„ï¼Œå¹¶ä¸”ä¸é»‘æš—èƒŒæ™¯å½¢æˆå¯¹æ¯”ã€‚ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Lollipopä¸Šçš„android:themeæœ‰æ•ˆäºæ‰€æœ‰åœ¨å¸ƒå±€ä¸­å£°æ˜çš„å­©å­ä»¬: 123456&lt;LinearLayout android:theme=\"@android:style/ThemeOverlay.Material.Dark\"&gt; &lt;!-- Anything here will also have a dark theme --&gt;&lt;/LinearLayout&gt; å¦‚æœéœ€è¦ï¼Œä½ çš„å­©å­å¯ä»¥è®¾å®šè‡ªå·±çš„ä¸»é¢˜ã€‚ ä¾‹å­è®©æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹æˆ‘æœ€è¿‘è¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜: æˆ‘å¦‚ä½•è®¾ç½®android:colorEdgeEffectï¼Œä½¿å®ƒåªåœ¨ä¸€ä¸ªè§†å›¾ä¸Šç”Ÿæ•ˆ? colorEdgeEffectå±æ€§æ˜¯Android 5.0ä¸­çš„ä¸€ä¸ªæ–°ä¸»é¢˜å±æ€§ï¼Œç”¨äºè‡ªå®šä¹‰åˆ—è¡¨çš„è¶…æ»šåŠ¨æ•ˆæœçš„é¢œè‰²ã€‚ å› ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸»é¢˜å±æ€§ï¼Œæ‚¨ä¸èƒ½ç›´æ¥åœ¨è§†å›¾ä¸Šè®¾ç½®å®ƒã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªå®šåˆ¶çš„themeå åŠ æ¥ä½¿ç”¨android:themeã€‚æˆ‘ä»¬çš„è‡ªå®šä¹‰è¦†ç›–åªæ˜¯å°†android:colorEdgeEffectè®¾ä¸ºçº¢è‰²ã€‚ç„¶åæˆ‘ä»¬å°†è¿™ä¸ªä¸»é¢˜è®¾ç½®ä¸ºè§†å›¾ï¼Œè¿™æ ·å®ƒå°±ä¼šç”Ÿæ•ˆã€‚ res/values/themes.xml 123&lt;style name=\"RedThemeOverlay\" parent=\"android:ThemeOverlay.Material\"&gt; &lt;item name=\"android:colorEdgeEffect\"&gt;#FF0000&lt;/item&gt;&lt;/style&gt; res/layout/fragment_list.xml 123&lt;ListView ... android:theme=\"RedThemeOverlay\" /&gt; éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒcolorEdgeEffectåªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¿™ä¸ªæŠ€æœ¯å¯ä»¥ä¸æ‰€æœ‰çš„ä¸»é¢˜å±æ€§ä¸€èµ·ä½¿ç”¨ã€‚ Theme å’Œ Styleé‚£ä¹ˆåŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢?å®ƒä»¬éƒ½æ˜¯ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼å£°æ˜çš„(ä½ å·²ç»çŸ¥é“äº†)ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºå®ƒä»¬æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚ ä¸»é¢˜æ˜¯ä¸ºä½ çš„åº”ç”¨ç¨‹åºè®¾è®¡çš„å…¨å±€æ ·å¼ï¼Œæ–°åŠŸèƒ½å¹¶æ²¡æœ‰æ”¹å˜ï¼Œå®ƒåªæ˜¯å…è®¸ä½ æ ¹æ®æ¯ä¸ªè§†å›¾è¿›è¡Œè°ƒæ•´ã€‚ æ ·å¼æ˜¯åœ¨ä¸€ä¸ªè§†å›¾çº§åˆ«ä¸Šåº”ç”¨çš„ã€‚åœ¨å†…éƒ¨ï¼Œå½“æ‚¨åœ¨è§†å›¾ä¸Šè®¾ç½®æ ·å¼æ—¶ï¼ŒLayoutInflaterå°†è¯»å–è¯¥æ ·å¼å¹¶åœ¨ä»»ä½•æ˜¾å¼å±æ€§ä¹‹å‰å°†å…¶åº”ç”¨åˆ°AttributeSet(è¿™å…è®¸æ‚¨åœ¨è§†å›¾ä¸Šè¦†ç›–æ ·å¼å€¼)ã€‚ å±æ€§é›†ä¸­çš„å€¼å¯ä»¥å¼•ç”¨è§†å›¾çš„ä¸»é¢˜ä¸­çš„å€¼ã€‚ ä¸»é¢˜æ˜¯å…¨å±€çš„ï¼Œé£æ ¼æ˜¯å±€éƒ¨çš„ã€‚ AppCompaté‚£ä¹ˆAppCompatæ˜¯å¦‚ä½•é€‚åº”è¿™ä¸€æƒ…å†µçš„å‘¢?å¾ˆæ˜æ˜¾ï¼Œå®ƒä¼šè¿”å›ä¸€äº›æ–°çš„é¢œè‰²ä¸»é¢˜å±æ€§ã€‚ å®ƒè¿˜æ”¯æŒæŸäº›widgetsçš„android:themeåŠŸèƒ½ï¼Œç›®å‰åªæœ‰android.support.v7.widget.Toolbarã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"}]},{"title":"Javaç•Œçš„ç¥å™¨-ä½¿ç”¨Lombokæ¥æ¶ˆé™¤ä½ çš„å†—ä½™ä»£ç é‡","slug":"Javaç•Œçš„ç¥å™¨-ä½¿ç”¨Lombokæ¥æ¶ˆé™¤ä½ çš„å†—ä½™ä»£ç é‡","date":"2017-10-09T03:23:46.000Z","updated":"2020-07-25T02:57:18.158Z","comments":true,"path":"2017/10/09/Javaç•Œçš„ç¥å™¨-ä½¿ç”¨Lombokæ¥æ¶ˆé™¤ä½ çš„å†—ä½™ä»£ç é‡/","link":"","permalink":"https://jigangduan.github.io/2017/10/09/Javaç•Œçš„ç¥å™¨-ä½¿ç”¨Lombokæ¥æ¶ˆé™¤ä½ çš„å†—ä½™ä»£ç é‡/","excerpt":"ç®€ä»‹ä»–æ˜¯ä¸€ä¸ªé€šè¿‡æ³¨è§£æ–¹å¼æ¥å‡å°‘ä½ çš„POJOç±»çš„getterå’Œsetterç­‰æ–¹æ³•çš„ä¸€ä¸ªå·¥å…·ï¼Œæˆ‘è¿™é‡Œæ¼”ç¤ºçš„åœ¨Android Studioä¸­çš„ä½¿ç”¨æ–¹å¼ï¼Œå½“ç„¶å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ideaé‚£ä¹ˆè¿™æ–¹æ³•ä¹Ÿé€šç”¨ï¼Œå¦‚æœä½ ç”¨çš„æ˜¯eclipseï¼Œé‚£ä¹ˆå®˜ç½‘ä¹Ÿæœ‰è§†é¢‘æ•™ç¨‹ï¼Œæˆ‘è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†","text":"ç®€ä»‹ä»–æ˜¯ä¸€ä¸ªé€šè¿‡æ³¨è§£æ–¹å¼æ¥å‡å°‘ä½ çš„POJOç±»çš„getterå’Œsetterç­‰æ–¹æ³•çš„ä¸€ä¸ªå·¥å…·ï¼Œæˆ‘è¿™é‡Œæ¼”ç¤ºçš„åœ¨Android Studioä¸­çš„ä½¿ç”¨æ–¹å¼ï¼Œå½“ç„¶å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ideaé‚£ä¹ˆè¿™æ–¹æ³•ä¹Ÿé€šç”¨ï¼Œå¦‚æœä½ ç”¨çš„æ˜¯eclipseï¼Œé‚£ä¹ˆå®˜ç½‘ä¹Ÿæœ‰è§†é¢‘æ•™ç¨‹ï¼Œæˆ‘è¿™é‡Œå°±ä¸æ¼”ç¤ºäº† å®‰è£…ä¾èµ–ä¼—æ‰€å‘¨çŸ¥åœ¨åœ¨Android Studioä¸­æ·»åŠ ä¾èµ–æœ‰ç›´æ¥ä¸‹è½½jaråŒ…å’Œä½¿ç”¨cradleçš„dependenciesæ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨dependenciesæ–¹æ³• æ·»åŠ gradleä¾èµ–åœ¨ä½ çš„é¡¹ç›®çš„build.gradeæ–‡ä»¶ä¸­æ·»åŠ  1provided &apos;org.projectlombok:lombok:1.12.6&apos; è‡³äºä¸ºä»€ä¹ˆæ˜¯providedè€Œä¸æ˜¯compileï¼Œå› ä¸ºè¿™ä¸ªæ¡†æ¶æ˜¯åœ¨å°†javaç¼–è¯‘ä¸ºclasså‰å¤„ç†ä»£ç äº†ï¼Œæ„æ€æ˜¯åœ¨ç”Ÿæˆçš„classæ–‡ä»¶ä¸­å·²ç»ç”Ÿæˆäº†getterå’Œsetterï¼Œæ‰€ä»¥è¿™ä¸ªä¾èµ–æ˜¯æˆ‘ä»¬åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨ï¼Œä¸éœ€è¦æ‰“åŒ…åˆ°apkä¸­ å®‰è£…Lombokæ’ä»¶è™½ç„¶æˆ‘ä»¬æ·»åŠ äº†ä¾èµ–ï¼Œä½†æ˜¯Android Studioä»–çŸ¥é“æ€ä¹ˆå¤„ç†è¿™ä¸ªæ–‡ä»¶å—ï¼Œè‚¯å®šæ˜¯ä¸çŸ¥é“å•¦ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å®‰è£…ä¸€ä¸ªæ’ä»¶æ¥å‘Šè¯‰ä»–æ€ä¹ˆå¤„ç† Preferences &gt; Plugins &gt; Browse repositories åœ¨è¾“å…¥æ¡†å†…è¾“å…¥comboï¼Œå¯çœ‹åˆ°å·²ç»æœç´¢å‡ºæ¥äº†è¿™ä¸ªæ’ä»¶ï¼Œæˆ‘ä»¬ç‚¹å‡»æ—è¾¹çš„å®‰è£…ï¼Œå®‰è£…å®Œæˆåé‡å¯æ’ä»¶æˆ‘ä»¬å°±å®‰è£…å®Œæ¯•äº†ï¼Œå®ƒçš„ä½¿ç”¨ä½¿ç”¨è¯´æ˜å¯ä»¥æŸ¥çœ‹æ’ä»¶ä¸»é¡µ ç°åœ¨æ’ä»¶è™½ç„¶å®‰è£…å®Œäº†ï¼Œä½†æ˜¯Android Studioä»–æ€ä¹ˆçŸ¥é“ä»€ä¹ˆæ—¶å€™æ¥ä½¿ç”¨è¿™ä¸ªæ’ä»¶å‘¢ï¼Œä»–æ˜¯ä¸æ˜¯æœ‰ä¸ªå¼€å…³ä»€ä¹ˆçš„ï¼Œæ²¡é”™ï¼ä½ çŒœå¯¹äº† å¼€å¯é¡¹ç›®çš„Annotation processé¦–å…ˆæˆ‘ä»¬æ‰“å¼€é¡¹ç›®çš„è®¾ç½®ï¼Œè¦å¼ºè°ƒçš„æ˜¯é¡¹ç›®çš„ï¼Œè€Œä¸æ˜¯å·¥å…·å…¨å±€çš„è®¾ç½®ï¼Œå¦‚ä¸‹å›¾ æ‰“å¼€åæŒ‰ç…§ä¸‹å›¾å‹¾é€‰Enable annotation processing é…ç½®æ–‡ä»¶ lombok.configç„¶ååœ¨Moduleæ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªlombok.configé…ç½®æ–‡ä»¶ï¼ŒåŠ å…¥ä¸¤è¡Œé…ç½® lombok.anyConstructor.suppressConstructorProperties = truelombok.addGeneratedAnnotation = false ä¸¤ä¸ªé…ç½®çš„ä½œç”¨æ˜¯ç¦ç”¨æ‰ä¸€äº›åœ¨androidä¸Šä¸å­˜åœ¨çš„ç±»ï¼Œè¿™äº›ç±»åœ¨æ ‡å‡†javaä¸­æ‰å­˜åœ¨ã€‚ åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå·¥å…·å’ŒåŸºæœ¬ç¯å¢ƒæˆ‘ä»¬åŸºæœ¬é…ç½®å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ¥æµ‹è¯• ä¸€äº›å¸¸ç”¨æ³¨è§£@Getter and @Setterå¯ä»¥å¾ˆç›´è§‚çš„ä»åå­—çœ‹å‡ºè¿™ä¸ªä¸¤ä¸ªæ˜¯åˆ†åˆ«ç”¨æ¥ç”ŸæˆGetterå’ŒSetteræ–¹æ³•çš„ 1234public class User &#123; @Getter @Setter private boolean employed = true; @Setter(AccessLevel.PROTECTED) private String name;&#125; ç›¸å½“äº 1234567891011121314151617181920public class User &#123; private boolean employed = true; private String name; public User() &#123; &#125; public boolean isEmployed() &#123; return this.employed; &#125; public void setEmployed(boolean employed) &#123; this.employed = employed; &#125; protected void setName(String name) &#123; this.name = name; &#125;&#125; åˆ°è¿™é‡Œï¼Œå¤§å®¶è‚¯å®šè¦é—®äº†ï¼Œä½ è¯´ç›¸å½“å°±ç­‰å•Šï¼Œæˆ–è€…ä¸Šé¢ç›¸ç­‰çš„ä»£ç æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Œå…¶ä»–æˆ‘ä»¬å¯ä»¥ç›´æ¥åç¼–è¯‘ç”Ÿæˆçš„classæ–‡ä»¶æŸ¥çœ‹ï¼Œæ‰“å¼€Android Studioçš„classç›®å½•ä¸‹çš„User.classæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ° åŒæ ·ä¸‹é¢çš„å®ä¾‹ä»£ç ä½ å¯ä»¥è¿™æ ·æŸ¥çœ‹ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ç”¨é€šè¿‡Android Studioçš„ ä»ä¸Šå›¾æˆ‘ä»¬å‘ç°æˆ‘ä»¬æ²¡æœ‰åœ¨æºä»£ç å†™ä¸€äº›Getteræ–¹æ³•ï¼Œä½†æ˜¯ä»Structureçª—å£çœ‹åˆ°è¿™äº›æ–¹æ³•å·²ç»è‡ªåŠ¨ç”Ÿæˆäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ @NonNullæä¾›ä¸€ä¸ªå‚æ•°çš„éç©ºåˆ¤æ–­ 12@Getter @Setter @NonNullprivate List&lt;String&gt; members; ç­‰åŒäº 123456789101112131415@NonNullprivate List&lt;String&gt; members;@NonNullpublic List&lt;String&gt; getMembers() &#123; return this.members;&#125;public void setMembers(@NonNull List&lt;String&gt; members) &#123; if(members == null) &#123; throw new NullPointerException(&quot;members&quot;); &#125; else &#123; this.members = members; &#125;&#125; @ToString123456789101112@ToString(exclude=&quot;name&quot;)public class User &#123; @Getter @Setter private boolean employed = true; @Setter(AccessLevel.PROTECTED) private String name; @Getter @Setter @NonNull private List&lt;String&gt; members;&#125; ç­‰åŒäº 123public String toString() &#123; return &quot;User(employed=&quot; + this.isEmployed() + &quot;, members=&quot; + this.getMembers() + &quot;)&quot;;&#125; @EqualsAndHashCode123456789101112@EqualsAndHashCode(exclude=&#123;&quot;name&quot;&#125;)public class User &#123; @Getter @Setter private boolean employed = true; @Setter(AccessLevel.PROTECTED) private String name; @Getter @Setter @NonNull private List&lt;String&gt; members;&#125; ç­‰åŒäº 123456789101112131415161718192021222324252627282930313233343536 public boolean equals(Object o) &#123; if(o == this) &#123; return true; &#125; else if(!(o instanceof User)) &#123; return false; &#125; else &#123; User other = (User)o; if(!other.canEqual(this)) &#123; return false; &#125; else if(this.isEmployed() != other.isEmployed()) &#123; return false; &#125; else &#123; List this$members = this.getMembers(); List other$members = other.getMembers(); if(this$members == null) &#123; if(other$members != null) &#123; return false; &#125; &#125; else if(!this$members.equals(other$members)) &#123; return false; &#125; return true; &#125; &#125;&#125;public boolean canEqual(Object other) &#123; return other instanceof User;&#125;public int hashCode() &#123; boolean PRIME = true; byte result = 1; int result1 = result * 59 + (this.isEmployed()?79:97); List $members = this.getMembers(); result1 = result1 * 59 + ($members == null?0:$members.hashCode()); return result1;&#125; @Dataè¿™ä¸ªæ³¨è§£ç›¸å½“äºåŒæ—¶ä½¿ç”¨@ToString, @EqualsAndHashCode, @Getterå’Œ@Setter 123456@Datapublic class User &#123; private boolean employed = true; private String name; private List&lt;String&gt; members;&#125; ç­‰åŒäº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475 public class User &#123; private boolean employed = true; private String name; private List&lt;String&gt; members; public User() &#123; &#125; public boolean isEmployed() &#123; return this.employed; &#125; public String getName() &#123; return this.name; &#125; public List&lt;String&gt; getMembers() &#123; return this.members; &#125; public void setEmployed(boolean employed) &#123; this.employed = employed; &#125; public void setName(String name) &#123; this.name = name; &#125; public void setMembers(List&lt;String&gt; members) &#123; this.members = members; &#125; public boolean equals(Object o) &#123; if(o == this) &#123; return true; &#125; else if(!(o instanceof User)) &#123; return false; &#125; else &#123; User other = (User)o; if(!other.canEqual(this)) &#123; return false; &#125; else if(this.isEmployed() != other.isEmployed()) &#123; return false; &#125; else &#123; String this$name = this.getName(); String other$name = other.getName(); if(this$name == null) &#123; if(other$name != null) &#123; return false; &#125; &#125; else if(!this$name.equals(other$name)) &#123; return false; &#125; List this$members = this.getMembers(); List other$members = other.getMembers(); if(this$members == null) &#123; if(other$members != null) &#123; return false; &#125; &#125; else if(!this$members.equals(other$members)) &#123; return false; &#125; return true; &#125; &#125; &#125; public boolean canEqual(Object other) &#123; return other instanceof User; &#125; public int hashCode() &#123; boolean PRIME = true; byte result = 1; int result1 = result * 59 + (this.isEmployed()?79:97); String $name = this.getName(); result1 = result1 * 59 + ($name == null?0:$name.hashCode()); List $members = this.getMembers(); result1 = result1 * 59 + ($members == null?0:$members.hashCode()); return result1; &#125; public String toString() &#123; return &quot;User(employed=&quot; + this.isEmployed() + &quot;, name=&quot; + this.getName() + &quot;, members=&quot; + this.getMembers() + &quot;)&quot;; &#125;&#125; @Cleanupä»–å¯ä»¥å¸®æˆ‘ä»¬åœ¨éœ€è¦é‡Šæ”¾çš„èµ„æºä½ç½®è‡ªåŠ¨åŠ ä¸Šé‡Šæ”¾ä»£ç  123456789 public void testCleanUp() &#123; try &#123; @Cleanup ByteArrayOutputStream baos = new ByteArrayOutputStream(); baos.write(new byte[] &#123;&apos;Y&apos;,&apos;e&apos;,&apos;s&apos;&#125;); System.out.println(baos.toString()); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; ç­‰åŒäº 123456789101112131415 public void testCleanUp() &#123; try &#123; ByteArrayOutputStream e = new ByteArrayOutputStream(); try &#123; e.write(new byte[]&#123;(byte)89, (byte)101, (byte)115&#125;); System.out.println(e.toString()); &#125; finally &#123; if(Collections.singletonList(e).get(0) != null) &#123; e.close(); &#125; &#125; &#125; catch (IOException var6) &#123; var6.printStackTrace(); &#125;&#125; @Synchronizedå¯ä»¥å¸®æˆ‘ä»¬åœ¨æ–¹æ³•ä¸Šæ·»åŠ åŒæ­¥ä»£ç å— 1234567 public class TestSync &#123; private DateFormat format = new SimpleDateFormat(&quot;MM-dd-YYYY&quot;); @Synchronized public String synchronizedFormat(Date date) &#123; return format.format(date); &#125;&#125; ç­‰åŒäº 123456789101112 public class TestSync &#123; private final Object $lock = new Object[0]; private DateFormat format = new SimpleDateFormat(&quot;MM-dd-YYYY&quot;); public TestSync() &#123; &#125; public String synchronizedFormat(Date date) &#123; Object var2 = this.$lock; synchronized(this.$lock) &#123; return this.format.format(date); &#125; &#125;&#125; åŸºæœ¬çš„ä½¿ç”¨å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸‹é¢ä¸€ä»½å®Œæ•´ä»£ç User.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package com.woblog.testlombok;import java.io.ByteArrayInputStream;import java.io.IOException;import java.io.InputStream;import java.util.List;import lombok.AccessLevel;import lombok.Cleanup;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.Getter;import lombok.NonNull;import lombok.Setter;import lombok.SneakyThrows;import lombok.Synchronized;import lombok.ToString;/** * Created by renpingqing on 16/6/18. */@Data@ToString(callSuper = true)/** * è¿™é‡Œå¦‚æœä¸å†™false,ä¼šæŠ¥é”™, * Error:(21, 1) è­¦å‘Š: Generating equals/hashCode implementation but without a call to superclass, * even though this class does not extend java.lang.Object. If this is intentional, * add &apos;@EqualsAndHashCode(callSuper=false)&apos; to your type. */@EqualsAndHashCode(callSuper = false)public class User extends BasePOJO &#123; private final Object lockObj = new Object(); /** * useridåªç”ŸæˆgetUserId */ private @Getter String userId; private String username; private int gender; private float price; @Setter(AccessLevel.PROTECTED) private boolean vip = false; //vip,æˆ–è€…isVipéƒ½ä¼šç”ŸæˆisVip private List&lt;String&gt; members; /** * nameä¸èƒ½ä¸ºç©º * * @param name * @return */ private String sayHello(@NonNull String name) &#123; return String.format(&quot;hi %s&quot;, name); &#125; @SneakyThrows(IOException.class) public void closeabale() &#123; @Cleanup InputStream is = new ByteArrayInputStream(&quot;hello world&quot;.getBytes()); System.out.println(is.available()); &#125; @Synchronized(&quot;lockObj&quot;) public void lockMethod() &#123; System.out.println(&quot;test lock method&quot;); &#125;&#125; ä»–ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174//// Source code recreated from a .class file by IntelliJ IDEA// (powered by Fernflower decompiler)//package com.woblog.testlombok;import com.woblog.testlombok.BasePOJO;import java.io.ByteArrayInputStream;import java.io.IOException;import java.util.Collections;import java.util.List;import lombok.NonNull;public class User extends BasePOJO &#123; private final Object lockObj = new Object(); private String userId; private String username; private int gender; private float price; private boolean vip = false; private List&lt;String&gt; members; private String sayHello(@NonNull String name) &#123; if(name == null) &#123; throw new NullPointerException(&quot;name&quot;); &#125; else &#123; return String.format(&quot;hi %s&quot;, new Object[]&#123;name&#125;); &#125; &#125; public void closeabale() &#123; try &#123; ByteArrayInputStream $ex = new ByteArrayInputStream(&quot;hello world&quot;.getBytes()); try &#123; System.out.println($ex.available()); &#125; finally &#123; if(Collections.singletonList($ex).get(0) != null) &#123; $ex.close(); &#125; &#125; &#125; catch (IOException var6) &#123; throw var6; &#125; &#125; public void lockMethod() &#123; Object var1 = this.lockObj; synchronized(this.lockObj) &#123; System.out.println(&quot;test lock method&quot;); &#125; &#125; public User() &#123; &#125; public Object getLockObj() &#123; return this.lockObj; &#125; public String getUsername() &#123; return this.username; &#125; public int getGender() &#123; return this.gender; &#125; public float getPrice() &#123; return this.price; &#125; public boolean isVip() &#123; return this.vip; &#125; public List&lt;String&gt; getMembers() &#123; return this.members; &#125; public void setUserId(String userId) &#123; this.userId = userId; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public void setGender(int gender) &#123; this.gender = gender; &#125; public void setPrice(float price) &#123; this.price = price; &#125; public void setMembers(List&lt;String&gt; members) &#123; this.members = members; &#125; public String toString() &#123; return &quot;User(super=&quot; + super.toString() + &quot;, lockObj=&quot; + this.getLockObj() + &quot;, userId=&quot; + this.getUserId() + &quot;, username=&quot; + this.getUsername() + &quot;, gender=&quot; + this.getGender() + &quot;, price=&quot; + this.getPrice() + &quot;, vip=&quot; + this.isVip() + &quot;, members=&quot; + this.getMembers() + &quot;)&quot;; &#125; public boolean equals(Object o) &#123; if(o == this) &#123; return true; &#125; else if(!(o instanceof User)) &#123; return false; &#125; else &#123; User other = (User)o; if(!other.canEqual(this)) &#123; return false; &#125; else &#123; label71: &#123; Object this$lockObj = this.getLockObj(); Object other$lockObj = other.getLockObj(); if(this$lockObj == null) &#123; if(other$lockObj == null) &#123; break label71; &#125; &#125; else if(this$lockObj.equals(other$lockObj)) &#123; break label71; &#125; return false; &#125; String this$userId = this.getUserId(); String other$userId = other.getUserId(); if(this$userId == null) &#123; if(other$userId != null) &#123; return false; &#125; &#125; else if(!this$userId.equals(other$userId)) &#123; return false; &#125; label57: &#123; String this$username = this.getUsername(); String other$username = other.getUsername(); if(this$username == null) &#123; if(other$username == null) &#123; break label57; &#125; &#125; else if(this$username.equals(other$username)) &#123; break label57; &#125; return false; &#125; if(this.getGender() != other.getGender()) &#123; return false; &#125; else if(Float.compare(this.getPrice(), other.getPrice()) != 0) &#123; return false; &#125; else if(this.isVip() != other.isVip()) &#123; return false; &#125; else &#123; List this$members = this.getMembers(); List other$members = other.getMembers(); if(this$members == null) &#123; if(other$members != null) &#123; return false; &#125; &#125; else if(!this$members.equals(other$members)) &#123; return false; &#125; return true; &#125; &#125; &#125; &#125; public boolean canEqual(Object other) &#123; return other instanceof User; &#125; public int hashCode() &#123; boolean PRIME = true; byte result = 1; Object $lockObj = this.getLockObj(); int result1 = result * 59 + ($lockObj == null?0:$lockObj.hashCode()); String $userId = this.getUserId(); result1 = result1 * 59 + ($userId == null?0:$userId.hashCode()); String $username = this.getUsername(); result1 = result1 * 59 + ($username == null?0:$username.hashCode()); result1 = result1 * 59 + this.getGender(); result1 = result1 * 59 + Float.floatToIntBits(this.getPrice()); result1 = result1 * 59 + (this.isVip()?79:97); List $members = this.getMembers(); result1 = result1 * 59 + ($members == null?0:$members.hashCode()); return result1; &#125; public String getUserId() &#123; return this.userId; &#125; protected void setVip(boolean vip) &#123; this.vip = vip; &#125;&#125; å¯ä»¥çœ‹åˆ°ä»£ç é‡å·®ä¸å¤šç¼©å‡äº†ä¸‰å€ï¼Œä½†æ˜¯ä»–ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ï¼š å¤§å¤§é™ä½äº†æºä»£ç æ–‡ä»¶çš„å¯è¯»æ€§å’Œå®Œæ•´æ€§ï¼Œé™ä½äº†é˜…è¯»æºä»£ç çš„èˆ’é€‚åº¦ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://jigangduan.github.io/categories/Java/"},{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"Java/ç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/Java/ç¬¬ä¸‰æ–¹åº“/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"}]},{"title":"è‡ªå®šä¹‰è§†å›¾(4) â€”â€” ä¼˜åŒ–è§†å›¾","slug":"custom-views-optimizing-view","date":"2017-08-13T06:50:46.000Z","updated":"2020-07-25T02:57:18.197Z","comments":true,"path":"2017/08/13/custom-views-optimizing-view/","link":"","permalink":"https://jigangduan.github.io/2017/08/13/custom-views-optimizing-view/","excerpt":"ç°åœ¨ï¼Œæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„è§†å›¾ï¼Œå¯ä»¥å“åº”çŠ¶æ€ä¹‹é—´çš„æ‰‹åŠ¿å’Œè½¬æ¢ï¼Œç¡®ä¿è§†å›¾è¿è¡Œå¾—å¾ˆå¿«ã€‚ä¸ºäº†é¿å…åœ¨å›æ”¾æœŸé—´æ„Ÿè§‰è¿Ÿé’æˆ–åœæ»çš„UIï¼Œç¡®ä¿åŠ¨ç”»å§‹ç»ˆä»¥æ¯ç§’60å¸§çš„é€Ÿåº¦è¿è¡Œã€‚","text":"ç°åœ¨ï¼Œæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„è§†å›¾ï¼Œå¯ä»¥å“åº”çŠ¶æ€ä¹‹é—´çš„æ‰‹åŠ¿å’Œè½¬æ¢ï¼Œç¡®ä¿è§†å›¾è¿è¡Œå¾—å¾ˆå¿«ã€‚ä¸ºäº†é¿å…åœ¨å›æ”¾æœŸé—´æ„Ÿè§‰è¿Ÿé’æˆ–åœæ»çš„UIï¼Œç¡®ä¿åŠ¨ç”»å§‹ç»ˆä»¥æ¯ç§’60å¸§çš„é€Ÿåº¦è¿è¡Œã€‚ å°‘åšäº‹ï¼Œé¢‘ç‡å°‘ä¸ºäº†åŠ å¿«è§†å›¾çš„é€Ÿåº¦ï¼Œä»ç»å¸¸è°ƒç”¨çš„ä¾‹ç¨‹ä¸­åˆ é™¤ä¸å¿…è¦çš„ä»£ç ã€‚å…ˆä»onDraw()å¼€å§‹ï¼Œè¿™å°†ç»™ä½ æœ€å¤§çš„å›æŠ¥ã€‚ç‰¹åˆ«æ˜¯æ‚¨åº”è¯¥æ¶ˆé™¤onDraw()ä¸­çš„åˆ†é…ï¼Œå› ä¸ºåˆ†é…å¯èƒ½ä¼šå¯¼è‡´åƒåœ¾æ”¶é›†ï¼Œä»è€Œå¯¼è‡´å£åƒã€‚åœ¨åˆå§‹åŒ–æœŸé—´æˆ–åœ¨åŠ¨ç”»ä¹‹é—´åˆ†é…å¯¹è±¡ã€‚å½“åŠ¨ç”»è¿è¡Œæ—¶ï¼Œä¸è¦è¿›è¡Œåˆ†é…ã€‚ é™¤äº†ä½¿onDraw()æ›´ç²¾ç®€ï¼Œä¹Ÿè¦ç¡®ä¿å®ƒè¢«å°½å¯èƒ½å°‘åœ°è°ƒç”¨ã€‚å¤§å¤šæ•°å¯¹onDraw()çš„è°ƒç”¨éƒ½æ˜¯è°ƒç”¨invalidate()çš„ç»“æœï¼Œå› æ­¤æ¶ˆé™¤ä¸å¿…è¦çš„invalidate()è°ƒç”¨ã€‚ å¦ä¸€ä¸ªéå¸¸æ˜‚è´µçš„æ“ä½œæ˜¯éå†å¸ƒå±€ã€‚æ¯å½“è§†å›¾è°ƒç”¨requestLayout()æ—¶ï¼ŒAndroid UIç³»ç»Ÿéœ€è¦éå†æ•´ä¸ªè§†å›¾å±‚æ¬¡ç»“æ„ï¼Œä»¥æ‰¾å‡ºæ¯ä¸ªè§†å›¾éœ€è¦å¤šå¤§çš„å¤§å°ã€‚å¦‚æœå‘ç°å†²çªçš„åº¦é‡ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡éå†å±‚æ¬¡ç»“æ„ã€‚UIè®¾è®¡äººå‘˜æœ‰æ—¶ä¼šåˆ›å»ºåµŒå¥—çš„ViewGroupå¯¹è±¡çš„æ·±å±‚å±‚æ¬¡ç»“æ„ï¼Œä»¥ä¾¿è®©UIæ­£å¸¸å·¥ä½œã€‚è¿™äº›æ·±å±‚è§†å›¾å±‚æ¬¡ç»“æ„ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä½¿æ‚¨çš„è§†å›¾å±‚æ¬¡å°½å¯èƒ½åœ°æµ…ã€‚ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå¤æ‚çš„UIï¼Œè¯·è€ƒè™‘ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ViewGroupæ¥æ‰§è¡Œå®ƒçš„å¸ƒå±€ã€‚ä¸å†…ç½®è§†å›¾ä¸åŒï¼Œæ‚¨çš„è‡ªå®šä¹‰è§†å›¾å¯ä»¥å¯¹å…¶å­çš„å¤§å°å’Œå½¢çŠ¶åšå‡ºç‰¹å®šäºåº”ç”¨ç¨‹åºçš„å‡è®¾ï¼Œå› æ­¤é¿å…éå†å…¶å­æ¥è®¡ç®—åº¦é‡ã€‚PieChartçš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å°†ViewGroupæ‰©å±•ä¸ºè‡ªå®šä¹‰è§†å›¾çš„ä¸€éƒ¨åˆ†ã€‚PieChartæœ‰å­©å­çš„è§‚ç‚¹ï¼Œä½†ä»æ¥æ²¡æœ‰è¡¡é‡ä»–ä»¬çš„è§‚ç‚¹ã€‚ç›¸åï¼Œå®ƒç›´æ¥æ ¹æ®è‡ªå·±çš„å®šåˆ¶å¸ƒå±€ç®—æ³•æ¥è®¾ç½®å®ƒä»¬çš„å¤§å°ã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","permalink":"https://jigangduan.github.io/categories/Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"}]},{"title":"è‡ªå®šä¹‰è§†å›¾(3) â€”â€” è§†å›¾äº¤äº’","slug":"custom-views-making-interactive","date":"2017-08-13T05:28:45.000Z","updated":"2020-07-25T02:57:18.196Z","comments":true,"path":"2017/08/13/custom-views-making-interactive/","link":"","permalink":"https://jigangduan.github.io/2017/08/13/custom-views-making-interactive/","excerpt":"ç»˜åˆ¶UIåªæ˜¯åˆ›å»ºè‡ªå®šä¹‰è§†å›¾çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨è¿˜éœ€è¦è®©æ‚¨çš„è§†å›¾ä»¥ä¸€ç§ä¸æ‚¨æ¨¡æ‹Ÿçš„å®é™…æ“ä½œéå¸¸ç›¸ä¼¼çš„æ–¹å¼å¯¹ç”¨æˆ·è¾“å…¥ä½œå‡ºå“åº”ã€‚å¯¹è±¡åº”è¯¥ä»¥ä¸å®é™…å¯¹è±¡ç›¸åŒçš„æ–¹å¼æ“ä½œã€‚ä¾‹å¦‚ï¼Œå›¾åƒä¸åº”è¯¥ç«‹å³è·³å‡ºå­˜åœ¨å¹¶é‡æ–°å‡ºç°åœ¨å…¶ä»–åœ°æ–¹ï¼Œå› ä¸ºç°å®ä¸–ç•Œä¸­çš„ç‰©ä½“ä¸è¿™æ ·åšã€‚ç›¸åï¼Œå›¾åƒåº”è¯¥ä»ä¸€ä¸ªåœ°æ–¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚ ç”¨æˆ·è¿˜å¯ä»¥åœ¨ç•Œé¢ä¸­æ„ŸçŸ¥å¾®å¦™çš„è¡Œä¸ºæˆ–æ„Ÿè§‰ï¼Œå¹¶å¯¹æ¨¡ä»¿çœŸå®ä¸–ç•Œçš„ç»†å¾®å·®åˆ«åšå‡ºæœ€å¥½çš„ååº”ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·flingä¸€ä¸ªUIå¯¹è±¡æ—¶ï¼Œä»–ä»¬åº”è¯¥åœ¨å¼€å§‹æ—¶æ„Ÿè§‰åˆ°æ‘©æ“¦åŠ›ï¼Œä»è€Œå»¶è¿Ÿäº†è¿™ä¸ªåŠ¨ä½œï¼Œç„¶ååœ¨ç»“æŸæ—¶æ„Ÿè§‰çš„åŠ¨é‡ï¼Œä½¿è¿™ä¸ªåŠ¨ä½œè¶…è¶Šäº†flingã€‚ è¿™ä¸ªè¯¾ç¨‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨Androidæ¡†æ¶çš„ç‰¹æ€§å°†è¿™äº›çœŸå®çš„è¡Œä¸ºæ·»åŠ åˆ°æ‚¨çš„è‡ªå®šä¹‰è§†å›¾ä¸­ã€‚","text":"ç»˜åˆ¶UIåªæ˜¯åˆ›å»ºè‡ªå®šä¹‰è§†å›¾çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨è¿˜éœ€è¦è®©æ‚¨çš„è§†å›¾ä»¥ä¸€ç§ä¸æ‚¨æ¨¡æ‹Ÿçš„å®é™…æ“ä½œéå¸¸ç›¸ä¼¼çš„æ–¹å¼å¯¹ç”¨æˆ·è¾“å…¥ä½œå‡ºå“åº”ã€‚å¯¹è±¡åº”è¯¥ä»¥ä¸å®é™…å¯¹è±¡ç›¸åŒçš„æ–¹å¼æ“ä½œã€‚ä¾‹å¦‚ï¼Œå›¾åƒä¸åº”è¯¥ç«‹å³è·³å‡ºå­˜åœ¨å¹¶é‡æ–°å‡ºç°åœ¨å…¶ä»–åœ°æ–¹ï¼Œå› ä¸ºç°å®ä¸–ç•Œä¸­çš„ç‰©ä½“ä¸è¿™æ ·åšã€‚ç›¸åï¼Œå›¾åƒåº”è¯¥ä»ä¸€ä¸ªåœ°æ–¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚ ç”¨æˆ·è¿˜å¯ä»¥åœ¨ç•Œé¢ä¸­æ„ŸçŸ¥å¾®å¦™çš„è¡Œä¸ºæˆ–æ„Ÿè§‰ï¼Œå¹¶å¯¹æ¨¡ä»¿çœŸå®ä¸–ç•Œçš„ç»†å¾®å·®åˆ«åšå‡ºæœ€å¥½çš„ååº”ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·flingä¸€ä¸ªUIå¯¹è±¡æ—¶ï¼Œä»–ä»¬åº”è¯¥åœ¨å¼€å§‹æ—¶æ„Ÿè§‰åˆ°æ‘©æ“¦åŠ›ï¼Œä»è€Œå»¶è¿Ÿäº†è¿™ä¸ªåŠ¨ä½œï¼Œç„¶ååœ¨ç»“æŸæ—¶æ„Ÿè§‰çš„åŠ¨é‡ï¼Œä½¿è¿™ä¸ªåŠ¨ä½œè¶…è¶Šäº†flingã€‚ è¿™ä¸ªè¯¾ç¨‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨Androidæ¡†æ¶çš„ç‰¹æ€§å°†è¿™äº›çœŸå®çš„è¡Œä¸ºæ·»åŠ åˆ°æ‚¨çš„è‡ªå®šä¹‰è§†å›¾ä¸­ã€‚ å¤„ç†è¾“å…¥çš„æ‰‹åŠ¿ä¸è®¸å¤šå…¶ä»–çš„UIæ¡†æ¶ä¸€æ ·ï¼ŒAndroidæ”¯æŒè¾“å…¥äº‹ä»¶æ¨¡å‹ã€‚ç”¨æˆ·æ“ä½œè¢«è½¬æ¢ä¸ºè§¦å‘å›è°ƒçš„äº‹ä»¶ï¼Œæ‚¨å¯ä»¥è¦†ç›–å›è°ƒï¼Œä»¥å®šåˆ¶åº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·çš„å“åº”ã€‚Androidç³»ç»Ÿä¸­æœ€å¸¸è§çš„è¾“å…¥äº‹ä»¶æ˜¯è§¦æ‘¸ï¼Œå®ƒè§¦å‘onTouchEvent(android.view.motionevent))ã€‚è¦†ç›–è¯¥æ–¹æ³•æ¥å¤„ç†äº‹ä»¶: 1234@Overridepublic boolean onTouchEvent(MotionEvent event) &#123; return super.onTouchEvent(event);&#125; è§¦æ‘¸äº‹ä»¶æœ¬èº«å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚ç°ä»£çš„è§¦æ‘¸UIså®šä¹‰äº†äº¤äº’ä½œç”¨ï¼Œæ¯”å¦‚ç‚¹å‡»ã€æ‹‰åŠ¨ã€æ¨é€ã€æŠ•æ·å’Œç¼©æ”¾ç­‰ã€‚ä¸ºäº†å°†åŸå§‹çš„è§¦æ‘¸äº‹ä»¶è½¬åŒ–ä¸ºæ‰‹åŠ¿ï¼ŒAndroidæä¾›äº†æ‰‹åŠ¿æ¢æµ‹å™¨(GestureDetector)ã€‚ é€šè¿‡ä¼ é€’ä¸€ä¸ªå®ç°GestureDetector.OnGestureListenerçš„ç±»çš„å®ä¾‹æ¥æ„é€ ä¸€ä¸ªæ‰‹åŠ¿æ£€æµ‹å™¨ã€‚å¦‚æœæ‚¨åªæƒ³å¤„ç†ä¸€äº›æ‰‹åŠ¿ï¼Œæ‚¨å¯ä»¥æ‰©å±•GestureDetector.SimpleOnGestureListenerï¼Œè€Œä¸æ˜¯å®ç°GestureDetector.OnGestureListeneræ¥å£ã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ‰©å±•GestureDetector.SimpleOnGestureListenerå’Œè¦†ç›–onDown(MotionEvent))çš„ç±»ã€‚ 1234567class mListener extends GestureDetector.SimpleOnGestureListener &#123; @Override public boolean onDown(MotionEvent e) &#123; return true; &#125;&#125;mDetector = new GestureDetector(PieChart.this.getContext(), new mListener()); æ— è®ºæ‚¨æ˜¯å¦ä½¿ç”¨GestureDetector.SimpleOnGestureListenerï¼Œæ‚¨å¿…é¡»å§‹ç»ˆå®ç°ä¸€ä¸ªè¿”å›trueçš„onDown())æ–¹æ³•ã€‚è¿™ä¸€æ­¥æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„æ‰‹åŠ¿éƒ½æ˜¯ä»onDown()æ¶ˆæ¯å¼€å§‹çš„ã€‚å¦‚æœonDown()è¿”å›falseï¼Œå¦‚GestureDetector.OnGestureListeneræ‰€åšçš„é‚£æ ·ï¼Œç³»ç»Ÿå‡å®šæ‚¨æƒ³è¦å¿½ç•¥è¯¥æ‰‹åŠ¿çš„å…¶ä½™éƒ¨åˆ†ï¼Œè€ŒGestureDetector.OnGestureListenerçš„å…¶ä»–æ–¹æ³•åˆ™æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ‚¨çœŸçš„æƒ³å¿½ç•¥ä¸€ä¸ªå®Œæ•´çš„æ‰‹åŠ¿ï¼Œé‚£ä¹ˆæƒŸä¸€æ—¶é—´æ˜¯onDown()è¿”å›falseçš„ã€‚ä¸€æ—¦æ‚¨å®ç°äº†GestureDetector.OnGestureListenerå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ‰‹åŠ¿æ£€æµ‹å™¨çš„å®ä¾‹ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨æ‚¨çš„æ‰‹åŠ¿æ£€æµ‹å™¨æ¥è§£é‡Šæ‚¨åœ¨onTouchEvent())ä¸­æ¥æ”¶åˆ°çš„è§¦æ‘¸äº‹ä»¶ã€‚ 1234567891011@Overridepublic boolean onTouchEvent(MotionEvent event) &#123; boolean result = mDetector.onTouchEvent(event); if (!result) &#123; if (event.getAction() == MotionEvent.ACTION_UP) &#123; stopScrolling(); result = true; &#125; &#125; return result;&#125; å½“æ‚¨é€šè¿‡onTouchEvent()ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶æ—¶ï¼Œå®ƒä¸æ‰¿è®¤å®ƒæ˜¯ä¸€ä¸ªæ‰‹åŠ¿çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¿”å›falseã€‚ç„¶åä½ å¯ä»¥è¿è¡Œä½ è‡ªå·±çš„è‡ªå®šä¹‰æ‰‹åŠ¿æ£€æµ‹ä»£ç ã€‚ åˆ›å»ºç‰©ç†ä¸Šåˆç†çš„è¿åŠ¨æ‰‹åŠ¿æ˜¯æ§åˆ¶è§¦å±è®¾å¤‡çš„ä¸€ç§å¼ºæœ‰åŠ›çš„æ–¹å¼ï¼Œä½†å®ƒä»¬å¯èƒ½æ˜¯è¿åç›´è§‰çš„ï¼Œè€Œä¸”å¾ˆéš¾è®°ä½ï¼Œé™¤éå®ƒä»¬äº§ç”Ÿäº†çœ‹ä¼¼åˆç†çš„ç»“æœã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯â€œflingâ€æ‰‹åŠ¿ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿåœ°å°†æ‰‹æŒ‡ç§»åŠ¨åˆ°å±å¹•ä¸Šï¼Œç„¶åæŠ¬èµ·å®ƒã€‚å¦‚æœUIçš„å“åº”æ˜¯å¿«é€Ÿç§»åŠ¨åˆ°flingçš„æ–¹å‘ï¼Œç„¶åå‡é€Ÿï¼Œå°±åƒç”¨æˆ·æ¨ç€ä¸€ä¸ªé£è½®å¹¶è®©å®ƒæ—‹è½¬ä¸€æ ·ï¼Œè¿™ä¸ªæ‰‹åŠ¿æ˜¯æœ‰æ„ä¹‰çš„ã€‚ ç„¶è€Œï¼Œæ¨¡æ‹Ÿé£è½®çš„æ„Ÿè§‰å¹¶ä¸ç®€å•ã€‚éœ€è¦å¤§é‡çš„ç‰©ç†å’Œæ•°å­¦æ‰èƒ½ä½¿é£è½®æ¨¡å‹æ­£å¸¸å·¥ä½œã€‚å¹¸è¿çš„æ˜¯ï¼ŒAndroidæä¾›äº†å¸®åŠ©ç±»æ¥æ¨¡æ‹Ÿè¿™ä¸ªå’Œå…¶ä»–è¡Œä¸ºã€‚Scrollerç±»æ˜¯å¤„ç†é£è½®å¼é£æ ¼çš„æŠ•æ·åŠ¨ä½œçš„åŸºç¡€ã€‚ è¦å¼€å§‹ä¸€ä¸ªæŠ•æ·ï¼Œè°ƒç”¨fling())ä»¥åˆå§‹é€Ÿåº¦å’Œæœ€å°å€¼å’Œæœ€å¤§å€¼xå’Œyå€¼ã€‚å¯¹äºé€Ÿåº¦å€¼ï¼Œå¯ä»¥ä½¿ç”¨æ‰‹åŠ¿æ£€æµ‹å™¨è®¡ç®—çš„å€¼ã€‚ 12345@Overridepublic boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) &#123; mScroller.fling(currentX, currentY, velocityX / SCALE, velocityY / SCALE, minX, minY, maxX, maxY); postInvalidate();&#125; âš ï¸:è™½ç„¶æ‰‹åŠ¿æ£€æµ‹çš„é€Ÿåº¦æ˜¯ç‰©ç†ç²¾ç¡®çš„ï¼Œä½†æ˜¯å¾ˆå¤šå¼€å‘è€…è®¤ä¸ºä½¿ç”¨è¿™ä¸ªå€¼ä¼šè®©åŠ¨ç”»çš„é€Ÿåº¦å¤ªå¿«ã€‚æŠŠxå’Œyçš„é€Ÿåº¦é™¤ä»¥4åˆ°8æ˜¯å¾ˆå¸¸è§çš„ã€‚ fling()çš„è°ƒç”¨å»ºç«‹äº†æŠ•æ·åŠ¨ä½œçš„ç‰©ç†æ¨¡å‹ã€‚ç„¶åï¼Œæ‚¨éœ€è¦é€šè¿‡å®šæœŸè°ƒç”¨Scroller.computeScrollOffset())æ¥æ›´æ–°Scrollerã€‚é€šè¿‡è¯»å–å½“å‰æ—¶é—´å’Œä½¿ç”¨ç‰©ç†æ¨¡å‹æ¥è®¡ç®—xå’Œyçš„ä½ç½®ï¼ŒcomputeScrollOffset()æ›´æ–°Scrollerå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚è°ƒç”¨getCurrX()å’ŒgetCurrY()æ¥æ£€ç´¢è¿™äº›å€¼ã€‚ å¤§å¤šæ•°è§†å›¾å°†Scrollerå¯¹è±¡çš„xå’Œyä½ç½®ç›´æ¥ä¼ é€’ç»™scrollTo()ã€‚PieChartçš„ä¾‹å­æœ‰ä¸€ç‚¹ä¸åŒ:å®ƒä½¿ç”¨å½“å‰çš„scroll yè½´æ¥è®¾ç½®å›¾è¡¨çš„æ—‹è½¬è§’åº¦ã€‚ 1234if (!mScroller.isFinished()) &#123; mScroller.computeScrollOffset(); setPieRotation(mScroller.getCurrY());&#125; Scrollerç±»ä¸ºæ‚¨è®¡ç®—æ»šåŠ¨ä½ç½®ï¼Œä½†å®ƒä¸ä¼šè‡ªåŠ¨å°†è¿™äº›ä½ç½®åº”ç”¨åˆ°æ‚¨çš„è§†å›¾ä¸­ã€‚ä½ çš„è´£ä»»æ˜¯ç¡®ä¿ä½ å¾—åˆ°å¹¶åº”ç”¨æ–°çš„åæ ‡ï¼Œä½¿æ»šåŠ¨çš„åŠ¨ç”»çœ‹èµ·æ¥å¾ˆå¹³æ»‘ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹: åœ¨è°ƒç”¨fling()ä¹‹åè°ƒç”¨postInvalidate()ï¼Œä»¥å¼ºåˆ¶é‡æ–°ç»˜åˆ¶ã€‚è¯¥æŠ€æœ¯è¦æ±‚æ‚¨åœ¨onDraw()ä¸­è®¡ç®—æ»šåŠ¨åç§»é‡ï¼Œå¹¶åœ¨æ¯æ¬¡æ»šåŠ¨åç§»é‡å˜åŒ–æ—¶è°ƒç”¨postInvalidate()ã€‚ åœ¨flingçš„æŒç»­æ—¶é—´è®¾ç½®ä¸€ä¸ªValueAnimatorï¼Œå¹¶æ·»åŠ ä¸€ä¸ªä¾¦å¬å™¨ï¼Œé€šè¿‡è°ƒç”¨addUpdateListener()æ¥å¤„ç†åŠ¨ç”»æ›´æ–°ã€‚ PieChartçš„ä¾‹å­ä½¿ç”¨äº†ç¬¬äºŒç§æ–¹æ³•ã€‚è¿™ç§æŠ€æœ¯çš„è®¾ç½®ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯å®ƒä¸åŠ¨ç”»ç³»ç»Ÿæ›´ç´§å¯†åœ°åˆä½œï¼Œå¹¶ä¸”ä¸éœ€è¦æ½œåœ¨çš„ä¸å¿…è¦çš„è§†å›¾å¤±æ•ˆã€‚ç¼ºç‚¹æ˜¯ï¼ŒValueAnimatoråœ¨APIçº§åˆ«11ä¹‹å‰æ˜¯ä¸å¯ç”¨çš„ï¼Œæ‰€ä»¥è¿™ç§æŠ€æœ¯ä¸èƒ½ç”¨äºè¿è¡ŒAndroidç‰ˆæœ¬ä½äº3.0çš„è®¾å¤‡ä¸Šã€‚ æ³¨æ„:æ‚¨å¯ä»¥åœ¨é’ˆå¯¹è¾ƒä½APIçº§åˆ«çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ValueAnimatorã€‚æ‚¨åªéœ€è¦ç¡®ä¿åœ¨è¿è¡Œæ—¶æ£€æŸ¥å½“å‰çš„APIçº§åˆ«ï¼Œå¦‚æœå½“å‰çº§åˆ«ä½äº11ï¼Œå°±å¿½ç•¥å¯¹è§†å›¾åŠ¨ç”»ç³»ç»Ÿçš„è°ƒç”¨ã€‚ 1234567891011121314mScroller = new Scroller(getContext(), null, true); mScrollAnimator = ValueAnimator.ofFloat(0,1); mScrollAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator valueAnimator) &#123; if (!mScroller.isFinished()) &#123; mScroller.computeScrollOffset(); setPieRotation(mScroller.getCurrY()); &#125; else &#123; mScrollAnimator.cancel(); onScrollFinished(); &#125; &#125; &#125;); è®©ä½ çš„è¿‡æ¸¡å¹³æ»‘ç”¨æˆ·æœŸæœ›ä¸€ä¸ªç°ä»£çš„UIåœ¨çŠ¶æ€ä¹‹é—´å¹³ç¨³åœ°è¿‡æ¸¡ã€‚UIå…ƒç´ ä¼šæ·¡å…¥æ·¡å‡ºï¼Œè€Œä¸æ˜¯å‡ºç°å’Œæ¶ˆå¤±ã€‚è¿åŠ¨çš„å¼€å§‹å’Œç»“æŸéƒ½å¾ˆé¡ºåˆ©ï¼Œè€Œä¸æ˜¯çªç„¶å¼€å§‹å’Œåœæ­¢ã€‚Android 3.0ç‰ˆæœ¬çš„Androidå±æ€§åŠ¨ç”»æ¡†æ¶ä½¿å¾—æµç•…çš„è¿‡æ¸¡å˜å¾—å®¹æ˜“ã€‚ è¦ä½¿ç”¨åŠ¨ç”»ç³»ç»Ÿï¼Œåªè¦å±æ€§æ›´æ”¹ä¼šå½±å“è§†å›¾çš„å¤–è§‚ï¼Œå°±ä¸è¦ç›´æ¥æ›´æ”¹å±æ€§ã€‚ç›¸åï¼Œä½¿ç”¨ValueAnimatoræ¥è¿›è¡Œæ›´æ”¹ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¿®æ”¹å½“å‰é€‰ä¸­çš„é¥¼å›¾åœ¨PieChartä¸­ä¼šä½¿æ•´ä¸ªå›¾è¡¨æ—‹è½¬ï¼Œä»¥ä¾¿é€‰æ‹©æŒ‡é’ˆä½äºæ‰€é€‰çš„åˆ‡ç‰‡ä¸­ã€‚ValueAnimatorä¼šåœ¨å‡ ç™¾æ¯«ç§’å†…æ”¹å˜æ—‹è½¬ï¼Œè€Œä¸æ˜¯ç«‹å³è®¾ç½®æ–°çš„æ—‹è½¬å€¼ã€‚ 1234mAutoCenterAnimator = ObjectAnimator.ofInt(PieChart.this, \"PieRotation\", 0);mAutoCenterAnimator.setIntValues(targetAngle);mAutoCenterAnimator.setDuration(AUTOCENTER_ANIM_DURATION);mAutoCenterAnimator.start(); å¦‚æœæ‚¨æƒ³è¦æ›´æ”¹çš„å€¼æ˜¯åŸºæœ¬è§†å›¾å±æ€§ä¹‹ä¸€ï¼Œé‚£ä¹ˆåšåŠ¨ç”»å°±æ›´å®¹æ˜“äº†ï¼Œå› ä¸ºè§†å›¾æœ‰ä¸€ä¸ªå†…ç½®çš„ViewPropertyAnimatorï¼Œå®ƒé’ˆå¯¹å¤šä¸ªå±æ€§çš„åŒæ­¥åŠ¨ç”»è¿›è¡Œäº†ä¼˜åŒ–ã€‚ä¾‹å¦‚: 1animate().rotation(targetAngle).setDuration(ANIM_DURATION).start();","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","permalink":"https://jigangduan.github.io/categories/Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"}]},{"title":"è‡ªå®šä¹‰è§†å›¾(2) â€”â€” è‡ªå®šä¹‰ç»˜åˆ¶","slug":"custom-views-custom-drawing","date":"2017-08-13T04:40:03.000Z","updated":"2020-07-25T02:57:18.196Z","comments":true,"path":"2017/08/13/custom-views-custom-drawing/","link":"","permalink":"https://jigangduan.github.io/2017/08/13/custom-views-custom-drawing/","excerpt":"è‡ªå®šä¹‰è§†å›¾æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯å®ƒçš„å¤–è§‚ã€‚æ ¹æ®æ‚¨çš„åº”ç”¨ç¨‹åºçš„éœ€è¦ï¼Œè‡ªå®šä¹‰ç»˜åˆ¶å¯ä»¥å¾ˆç®€å•æˆ–å¤æ‚ã€‚è¿™ä¸€è¯¾æ¶µç›–äº†ä¸€äº›æœ€å¸¸è§çš„æ“ä½œã€‚","text":"è‡ªå®šä¹‰è§†å›¾æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯å®ƒçš„å¤–è§‚ã€‚æ ¹æ®æ‚¨çš„åº”ç”¨ç¨‹åºçš„éœ€è¦ï¼Œè‡ªå®šä¹‰ç»˜åˆ¶å¯ä»¥å¾ˆç®€å•æˆ–å¤æ‚ã€‚è¿™ä¸€è¯¾æ¶µç›–äº†ä¸€äº›æœ€å¸¸è§çš„æ“ä½œã€‚ è¦†å†™onDraw()ç»˜åˆ¶è‡ªå®šä¹‰è§†å›¾æœ€é‡è¦çš„æ­¥éª¤æ˜¯è¦†ç›–onDraw())æ–¹æ³•ã€‚onDraw()çš„å‚æ•°æ˜¯ä¸€ä¸ªç”»å¸ƒå¯¹è±¡ï¼Œè§†å›¾å¯ä»¥ä½¿ç”¨å®ƒæ¥ç»˜åˆ¶è‡ªå·±ã€‚Canvasç±»å®šä¹‰äº†ç”¨äºç»˜åˆ¶æ–‡æœ¬ã€è¡Œã€ä½å›¾å’Œè®¸å¤šå…¶ä»–å›¾å½¢åŸè¯­çš„æ–¹æ³•ã€‚æ‚¨å¯ä»¥åœ¨onDraw()ä¸­ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥åˆ›å»ºå®šåˆ¶çš„ç”¨æˆ·ç•Œé¢(UI)ã€‚ ä¸è¿‡ï¼Œåœ¨æ‚¨è°ƒç”¨ä»»ä½•ç»˜å›¾æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªPaintå¯¹è±¡ã€‚ä¸‹ä¸€èŠ‚å°†æ›´è¯¦ç»†åœ°è®¨è®ºPaint åˆ›å»ºç»˜å›¾å¯¹è±¡android.graphicsæ¡†æ¶å°†ç»˜å›¾åˆ†ä¸ºä¸¤ä¸ªé¢†åŸŸ: ç”»ä»€ä¹ˆï¼Œç”¨Canvasæ¥å¤„ç† å¦‚ä½•ç”»ï¼Œç”¨Paintæ¥å¤„ç† ä¾‹å¦‚ï¼ŒCanvasæä¾›äº†ä¸€ç§ç»˜åˆ¶çº¿æ¡çš„æ–¹æ³•ï¼Œè€ŒPaintåˆ™æä¾›äº†å®šä¹‰çº¿æ¡é¢œè‰²çš„æ–¹æ³•ã€‚Canvasæœ‰ä¸€ä¸ªç»˜åˆ¶çŸ©å½¢çš„æ–¹æ³•ï¼Œè€ŒPaintåˆ™å®šä¹‰äº†æ˜¯ç”¨ä¸€ä¸ªé¢œè‰²å¡«å……è¿™ä¸ªçŸ©å½¢ï¼Œè¿˜æ˜¯æŠŠå®ƒç•™ç©ºã€‚ç®€å•åœ°è¯´ï¼ŒCanvaså®šä¹‰äº†ä½ å¯ä»¥åœ¨å±å¹•ä¸Šç»˜åˆ¶çš„å›¾å½¢ï¼Œè€ŒPaintåˆ™å®šä¹‰äº†ä½ æ‰€ç»˜åˆ¶çš„æ¯ä¸€ä¸ªå›¾å½¢çš„é¢œè‰²ã€æ ·å¼ã€å­—ä½“ç­‰ç­‰ã€‚ å› æ­¤ï¼Œåœ¨ç»˜åˆ¶ä»»ä½•ä¸œè¥¿ä¹‹å‰ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªPaintå¯¹è±¡ã€‚PieChartçš„ä¾‹å­åœ¨ä¸€ä¸ªåä¸ºinitçš„æ–¹æ³•ä¸­è¿™æ ·åšï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨çš„: 123456789101112131415161718private void init() &#123; mTextPaint = new Paint(Paint.ANTI_ALIAS_FLAG); mTextPaint.setColor(mTextColor); if (mTextHeight == 0) &#123; mTextHeight = mTextPaint.getTextSize(); &#125; else &#123; mTextPaint.setTextSize(mTextHeight); &#125; mPiePaint = new Paint(Paint.ANTI_ALIAS_FLAG); mPiePaint.setStyle(Paint.Style.FILL); mPiePaint.setTextSize(mTextHeight); mShadowPaint = new Paint(0); mShadowPaint.setColor(0xff101010); mShadowPaint.setMaskFilter(new BlurMaskFilter(8, BlurMaskFilter.Blur.NORMAL)); ... æå‰åˆ›å»ºå¯¹è±¡æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–ã€‚è§†å›¾ç»å¸¸è¢«é‡æ–°ç»˜åˆ¶ï¼Œè®¸å¤šç»˜å›¾å¯¹è±¡éœ€è¦æ˜‚è´µçš„åˆå§‹åŒ–ã€‚åœ¨onDraw()æ–¹æ³•ä¸­åˆ›å»ºç»˜å›¾å¯¹è±¡å¯ä»¥æ˜¾è‘—é™ä½æ€§èƒ½ï¼Œå¹¶ä½¿UIæ˜¾å¾—è¿Ÿç¼“ã€‚ å¤„ç†å¸ƒå±€äº‹ä»¶ä¸ºäº†æ­£ç¡®åœ°ç»˜åˆ¶æ‚¨çš„è‡ªå®šä¹‰è§†å›¾ï¼Œæ‚¨éœ€è¦çŸ¥é“å®ƒçš„å¤§å°ã€‚å¤æ‚çš„è‡ªå®šä¹‰è§†å›¾é€šå¸¸éœ€è¦æ ¹æ®å±å¹•ä¸Šçš„åŒºåŸŸçš„å¤§å°å’Œå½¢çŠ¶æ¥æ‰§è¡Œå¤šä¸ªå¸ƒå±€è®¡ç®—ã€‚ä½ ä¸åº”è¯¥åœ¨å±å¹•ä¸Šå¯¹è§†å›¾çš„å¤§å°åšå‡ºå‡è®¾ã€‚å³ä½¿åªæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ä½ çš„è§†å›¾ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¹Ÿéœ€è¦å¤„ç†ä¸åŒçš„å±å¹•å¤§å°ï¼Œå±å¹•å¯†åº¦ï¼Œä»¥åŠæ¨ªå‘å’Œæ¨ªå‘æ¨¡å¼çš„ä¸åŒæ–¹é¢çš„æ¯”ç‡ã€‚ å°½ç®¡è§†å›¾æœ‰è®¸å¤šç”¨äºå¤„ç†åº¦é‡çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬ä¸­çš„å¤§å¤šæ•°ä¸éœ€è¦è¢«è¦†ç›–ã€‚å¦‚æœæ‚¨çš„è§†å›¾ä¸éœ€è¦å¯¹å®ƒçš„å¤§å°è¿›è¡Œç‰¹æ®Šçš„æ§åˆ¶ï¼Œé‚£ä¹ˆæ‚¨åªéœ€è¦†ç›–ä¸€ä¸ªæ–¹æ³•:onSizeChanged())ã€‚ onSizeChanged())æ˜¯åœ¨æ‚¨çš„è§†å›¾ç¬¬ä¸€æ¬¡åˆ†é…ä¸€ä¸ªå¤§å°æ—¶è°ƒç”¨çš„ï¼Œå¦‚æœæ‚¨çš„è§†å›¾çš„å¤§å°å› ä»»ä½•åŸå› è€Œå‘ç”Ÿå˜åŒ–ï¼Œåˆ™è°ƒç”¨onSizeChanged()ã€‚åœ¨onSizeChanged()ä¸­è®¡ç®—ä½ç½®ã€ç»´åº¦å’Œå…¶ä»–ä¸è§†å›¾å¤§å°ç›¸å…³çš„å€¼ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ç»˜åˆ¶æ—¶éƒ½é‡æ–°è®¡ç®—å®ƒä»¬ã€‚åœ¨PieChartçš„ä¾‹å­ä¸­ï¼ŒonSizeChanged()æ˜¯PieChartè§†å›¾è®¡ç®—é¥¼å›¾çš„è¾¹ç•ŒçŸ©å½¢å’Œæ–‡æœ¬æ ‡ç­¾å’Œå…¶ä»–å¯è§†å…ƒç´ çš„ç›¸å¯¹ä½ç½®çš„åœ°æ–¹ã€‚ å½“æ‚¨çš„è§†å›¾è¢«åˆ†é…ä¸€ä¸ªå¤§å°æ—¶ï¼Œå¸ƒå±€ç®¡ç†å™¨å‡è®¾è¿™ä¸ªå¤§å°åŒ…å«äº†æ‰€æœ‰è§†å›¾çš„paddingã€‚åœ¨è®¡ç®—è§†å›¾çš„å¤§å°æ—¶ï¼Œå¿…é¡»å¤„ç†paddingå€¼ã€‚ä¸‹é¢æ˜¯PieChart.onSizeChanged()çš„ä¸€ä¸ªç‰‡æ®µï¼Œå±•ç¤ºäº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹: 123456789101112// Account for paddingfloat xpad = (float)(getPaddingLeft() + getPaddingRight());float ypad = (float)(getPaddingTop() + getPaddingBottom());// Account for the labelif (mShowText) xpad += mTextWidth;float ww = (float)w - xpad;float hh = (float)h - ypad;// Figure out how big we can make the pie.float diameter = Math.min(ww, hh); å¦‚æœæ‚¨éœ€è¦æ›´å¥½åœ°æ§åˆ¶è§†å›¾çš„å¸ƒå±€å‚æ•°ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°onMeasure()ã€‚è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯View.MeasureSpecå€¼ï¼Œå®ƒå‘Šè¯‰ä½ è§†å›¾çš„çˆ¶è§†å›¾æœ‰å¤šå¤§ï¼Œå®ƒçš„å¤§å°æ˜¯ä¸€ä¸ªç¡¬çš„æœ€å¤§å€¼è¿˜æ˜¯ä¸€ä¸ªå»ºè®®ã€‚ä½œä¸ºä¸€ä¸ªä¼˜åŒ–ï¼Œè¿™äº›å€¼è¢«å­˜å‚¨ä¸ºæ‰“åŒ…çš„æ•´æ•°ï¼Œæ‚¨ä½¿ç”¨View.MeasureSpecçš„é™æ€æ–¹æ³•æ¥è§£å­˜å‚¨åœ¨æ¯ä¸ªæ•´æ•°ä¸­çš„ä¿¡æ¯ã€‚ ä¸‹é¢æ˜¯onMeasure()çš„ä¸€ä¸ªç¤ºä¾‹å®ç°ã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼ŒPieChartè¯•å›¾è®©å®ƒçš„åŒºåŸŸè¶³å¤Ÿå¤§ï¼Œä½¿è¿™ä¸ªé¦…é¥¼å’Œå®ƒçš„labelä¸€æ ·å¤§: 12345678910111213@Overrideprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; // Try for a width based on our minimum int minw = getPaddingLeft() + getPaddingRight() + getSuggestedMinimumWidth(); int w = resolveSizeAndState(minw, widthMeasureSpec, 1); // Whatever the width ends up being, ask for a height that would let the pie // get as big as it can int minh = MeasureSpec.getSize(w) - (int)mTextWidth + getPaddingBottom() + getPaddingTop(); int h = resolveSizeAndState(MeasureSpec.getSize(w) - (int)mTextWidth, heightMeasureSpec, 0); setMeasuredDimension(w, h);&#125; åœ¨è¿™æ®µä»£ç ä¸­æœ‰ä¸‰ä»¶é‡è¦çš„äº‹æƒ…éœ€è¦æ³¨æ„: è®¡ç®—è€ƒè™‘åˆ°è§†å›¾çš„å¡«å……ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œè¿™æ˜¯è§†å›¾çš„è´£ä»»ã€‚ åŠ©æ‰‹æ–¹æ³•resolveSizeAndState())ç”¨äºåˆ›å»ºæœ€ç»ˆçš„å®½åº¦å’Œé«˜åº¦å€¼ã€‚é€šè¿‡å°†è§†å›¾æ‰€éœ€çš„å¤§å°ä¸ä¼ é€’ç»™onMeasure())çš„è§„èŒƒç›¸æ¯”è¾ƒï¼Œè¿™ä¸ªåŠ©æ‰‹è¿”å›ä¸€ä¸ªé€‚å½“çš„View.MeasureSpecå€¼ã€‚ onMeasure()æ²¡æœ‰è¿”å›å€¼ã€‚ç›¸åï¼Œè¯¥æ–¹æ³•é€šè¿‡è°ƒç”¨setMeasuredDimension())æ¥ä¼ é€’å…¶ç»“æœã€‚è°ƒç”¨æ­¤æ–¹æ³•æ˜¯å¼ºåˆ¶æ€§çš„ã€‚å¦‚æœçœç•¥äº†è¿™ä¸ªè°ƒç”¨ï¼Œè§†å›¾ç±»ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚ ç»˜åˆ¶ä¸€æ—¦æ‚¨åˆ›å»ºäº†å¯¹è±¡åˆ›å»ºå’Œåº¦é‡ä»£ç ï¼Œæ‚¨å°±å¯ä»¥å®ç°onDraw()ã€‚æ¯ä¸ªè§†å›¾éƒ½ä»¥ä¸åŒçš„æ–¹å¼å®ç°onDraw()ï¼Œä½†æ˜¯æœ‰ä¸€äº›å¸¸è§çš„æ“ä½œæ˜¯å¤§å¤šæ•°è§†å›¾å…±äº«çš„: ç»˜åˆ¶æ–‡æœ¬ä½¿ç”¨drawText())ã€‚é€šè¿‡è°ƒç”¨setTypeface()æ¥æŒ‡å®šå­—ä½“ï¼Œå¹¶é€šè¿‡è°ƒç”¨setColor()æ¥æŒ‡å®šæ–‡æœ¬é¢œè‰²ã€‚ ä½¿ç”¨drawRect())ã€drawOval())å’ŒdrawArc()ç»˜åˆ¶åŸå§‹å›¾å½¢ã€‚é€šè¿‡è°ƒç”¨setStyle()æ¥æ”¹å˜è¿™äº›å½¢çŠ¶æ˜¯å¦å¡«å……ã€æ¦‚æ‹¬æˆ–ä¸¤è€…éƒ½æœ‰ã€‚ ä½¿ç”¨Pathç±»ç»˜åˆ¶æ›´å¤æ‚çš„å›¾å½¢ã€‚é€šè¿‡å‘è·¯å¾„å¯¹è±¡æ·»åŠ è¡Œå’Œæ›²çº¿æ¥å®šä¹‰ä¸€ä¸ªå½¢çŠ¶ï¼Œç„¶åä½¿ç”¨drawPath())æ¥ç»˜åˆ¶å›¾å½¢ã€‚å°±åƒåŸå§‹çš„å½¢çŠ¶ä¸€æ ·ï¼Œå¯ä»¥æ ¹æ®setStyle()å¯¹è·¯å¾„è¿›è¡Œæ¦‚è¿°ã€å¡«å……ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¯ä»¥ã€‚ é€šè¿‡åˆ›å»ºLinearGradientå¯¹è±¡æ¥å®šä¹‰æ¸å˜å¡«å……ã€‚è°ƒç”¨setShader()åœ¨å¡«å……çš„å›¾å½¢ä¸Šä½¿ç”¨ä½ çš„çº¿æ€§æ¸å˜ã€‚ ç»˜åˆ¶ä½å›¾ä½¿ç”¨drawBitmap())ã€‚ ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯ç»˜åˆ¶PieChartçš„ä»£ç ã€‚å®ƒä½¿ç”¨äº†æ–‡æœ¬ã€çº¿æ¡å’Œå½¢çŠ¶çš„æ··åˆã€‚ 1234567891011121314151617181920212223242526protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); // Draw the shadow canvas.drawOval( mShadowBounds, mShadowPaint ); // Draw the label text canvas.drawText(mData.get(mCurrentItem).mLabel, mTextX, mTextY, mTextPaint); // Draw the pie slices for (int i = 0; i &lt; mData.size(); ++i) &#123; Item it = mData.get(i); mPiePaint.setShader(it.mShader); canvas.drawArc(mBounds, 360 - it.mEndAngle, it.mEndAngle - it.mStartAngle, true, mPiePaint); &#125; // Draw the pointer canvas.drawLine(mTextX, mPointerY, mPointerX, mPointerY, mTextPaint); canvas.drawCircle(mPointerX, mPointerY, mPointerSize, mTextPaint);&#125;","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","permalink":"https://jigangduan.github.io/categories/Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"}]},{"title":"è‡ªå®šä¹‰è§†å›¾(1) â€”â€” åˆ›å»ºè‡ªå®šä¹‰è§†å›¾ç±»","slug":"custom-views","date":"2017-08-10T12:02:30.000Z","updated":"2020-07-25T02:57:18.197Z","comments":true,"path":"2017/08/10/custom-views/","link":"","permalink":"https://jigangduan.github.io/2017/08/10/custom-views/","excerpt":"ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„è‡ªå®šä¹‰è§†å›¾ä¸å…¶ä»–è®¾è®¡è‰¯å¥½çš„ç±»éå¸¸ç›¸ä¼¼ã€‚å®ƒå°è£…äº†ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½é›†ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œå®ƒæœ‰æ•ˆåœ°ä½¿ç”¨CPUå’Œå†…å­˜ï¼Œç­‰ç­‰ã€‚é™¤äº†æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ç±»ä¹‹å¤–ï¼Œè‡ªå®šä¹‰è§†å›¾åº”è¯¥æ˜¯: ç¬¦åˆAndroidæ ‡å‡† æä¾›ä¸Android XMLå¸ƒå±€å…¼å®¹çš„å®šåˆ¶æ ·å¼å±æ€§ å‘é€è®¿é—®äº‹ä»¶ ä¸å¤šä¸ªAndroidå¹³å°å…¼å®¹ Androidæ¡†æ¶æä¾›äº†ä¸€ç»„åŸºç±»å’ŒXMLæ ‡è®°ï¼Œä»¥å¸®åŠ©æ‚¨åˆ›å»ºæ»¡è¶³æ‰€æœ‰è¿™äº›éœ€æ±‚çš„è§†å›¾ã€‚æœ¬è¯¾ç¨‹å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨Androidæ¡†æ¶æ¥åˆ›å»ºè§†å›¾ç±»çš„æ ¸å¿ƒåŠŸèƒ½ã€‚","text":"ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„è‡ªå®šä¹‰è§†å›¾ä¸å…¶ä»–è®¾è®¡è‰¯å¥½çš„ç±»éå¸¸ç›¸ä¼¼ã€‚å®ƒå°è£…äº†ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½é›†ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œå®ƒæœ‰æ•ˆåœ°ä½¿ç”¨CPUå’Œå†…å­˜ï¼Œç­‰ç­‰ã€‚é™¤äº†æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ç±»ä¹‹å¤–ï¼Œè‡ªå®šä¹‰è§†å›¾åº”è¯¥æ˜¯: ç¬¦åˆAndroidæ ‡å‡† æä¾›ä¸Android XMLå¸ƒå±€å…¼å®¹çš„å®šåˆ¶æ ·å¼å±æ€§ å‘é€è®¿é—®äº‹ä»¶ ä¸å¤šä¸ªAndroidå¹³å°å…¼å®¹ Androidæ¡†æ¶æä¾›äº†ä¸€ç»„åŸºç±»å’ŒXMLæ ‡è®°ï¼Œä»¥å¸®åŠ©æ‚¨åˆ›å»ºæ»¡è¶³æ‰€æœ‰è¿™äº›éœ€æ±‚çš„è§†å›¾ã€‚æœ¬è¯¾ç¨‹å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨Androidæ¡†æ¶æ¥åˆ›å»ºè§†å›¾ç±»çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ å­ç±»åŒ–Viewåœ¨Androidæ¡†æ¶ä¸­å®šä¹‰çš„æ‰€æœ‰è§†å›¾ç±»éƒ½æ‰©å±•Viewã€‚æ‚¨çš„è‡ªå®šä¹‰è§†å›¾ä¹Ÿå¯ä»¥ç›´æ¥æ‰©å±•Viewï¼Œæˆ–è€…æ‚¨å¯ä»¥é€šè¿‡æ‰©å±•ç°æœ‰çš„è§†å›¾å­ç±»ï¼Œä¾‹å¦‚Buttonæ¥èŠ‚çœæ—¶é—´ã€‚ ä¸ºäº†è®©Android Studioèƒ½å¤Ÿä¸è§†å›¾äº¤äº’ï¼Œè‡³å°‘å¿…é¡»æä¾›ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¯¥æ„é€ å‡½æ•°å°†Contextå’ŒAttributeSetå¯¹è±¡ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªæ„é€ å‡½æ•°å…è®¸å¸ƒå±€ç¼–è¾‘å™¨åˆ›å»ºå’Œç¼–è¾‘è§†å›¾çš„å®ä¾‹ã€‚ 12345class PieChart extends View &#123; public PieChart(Context context, AttributeSet attrs) &#123; super(context, attrs); &#125;&#125; å®šä¹‰è‡ªå®šä¹‰å±æ€§è¦å‘ç”¨æˆ·ç•Œé¢æ·»åŠ å†…ç½®è§†å›¾ï¼Œéœ€è¦åœ¨XMLå…ƒç´ ä¸­æŒ‡å®šå®ƒï¼Œå¹¶ä½¿ç”¨å…ƒç´ å±æ€§æ§åˆ¶å…¶å¤–è§‚å’Œè¡Œä¸ºã€‚ç¼–å†™è‰¯å¥½çš„è‡ªå®šä¹‰è§†å›¾ä¹Ÿå¯ä»¥é€šè¿‡XMLæ·»åŠ å’Œæ ·å¼åŒ–ã€‚è¦åœ¨æ‚¨çš„è‡ªå®šä¹‰è§†å›¾ä¸­å¯ç”¨è¯¥è¡Œä¸ºï¼Œæ‚¨å¿…é¡»: åœ¨&lt;declare-styleable&gt;èµ„æºå…ƒç´ ä¸­ä¸ºè§†å›¾å®šä¹‰å®šåˆ¶å±æ€§ ä¸ºXMLå¸ƒå±€ä¸­çš„å±æ€§æŒ‡å®šå€¼ åœ¨è¿è¡Œæ—¶æ£€ç´¢å±æ€§å€¼ å°†æ£€ç´¢åˆ°çš„å±æ€§å€¼åº”ç”¨åˆ°æ‚¨çš„è§†å›¾ä¸­ æœ¬èŠ‚è®¨è®ºå¦‚ä½•å®šä¹‰è‡ªå®šä¹‰å±æ€§å¹¶æŒ‡å®šå®ƒä»¬çš„å€¼ã€‚ä¸‹ä¸€èŠ‚å°†è®¨è®ºå¦‚ä½•åœ¨è¿è¡Œæ—¶æ£€ç´¢å’Œåº”ç”¨è¿™äº›å€¼ã€‚ è¦å®šä¹‰è‡ªå®šä¹‰å±æ€§ï¼Œè¯·å°†&lt;declare-styleable&gt;èµ„æºæ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚æŒ‰ç…§æƒ¯ä¾‹å°†è¿™äº›èµ„æºæ”¾å…¥ä¸€ä¸ªres/values/attrs.xmlæ–‡ä»¶ä¸­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªattrs.xmlæ–‡ä»¶çš„ä¾‹å­: 123456789&lt;resources&gt; &lt;declare-styleable name=\"PieChart\"&gt; &lt;attr name=\"showText\" format=\"boolean\" /&gt; &lt;attr name=\"labelPosition\" format=\"enum\"&gt; &lt;enum name=\"left\" value=\"0\"/&gt; &lt;enum name=\"right\" value=\"1\"/&gt; &lt;/attr&gt; &lt;/declare-styleable&gt;&lt;/resources&gt; è¿™æ®µä»£ç å£°æ˜äº†ä¸¤ä¸ªè‡ªå®šä¹‰å±æ€§ï¼ŒshowTextå’ŒlabelPositionï¼Œå®ƒä»¬å±äºä¸€ä¸ªåä¸ºPieChartçš„æ ·å¼å®ä½“ã€‚æ ¹æ®æƒ¯ä¾‹ï¼Œæ ·å¼åŒ–å®ä½“çš„åç§°ä¸å®šä¹‰è‡ªå®šä¹‰è§†å›¾çš„ç±»çš„åç§°ç›¸åŒã€‚è™½ç„¶æ²¡æœ‰å¿…è¦éµå¾ªè¿™ä¸ªæƒ¯ä¾‹ï¼Œä½†æ˜¯è®¸å¤šæµè¡Œçš„ä»£ç ç¼–è¾‘å™¨éƒ½ä¾èµ–äºè¿™ä¸ªå‘½åçº¦å®šæ¥æä¾›è¯­å¥å®Œæˆã€‚ ä¸€æ—¦å®šä¹‰äº†å®šåˆ¶å±æ€§ï¼Œå°±å¯ä»¥åœ¨å¸ƒå±€XMLæ–‡ä»¶ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„å±æ€§ä¸€æ ·ã€‚æƒŸä¸€çš„åŒºåˆ«æ˜¯ï¼Œæ‚¨çš„è‡ªå®šä¹‰å±æ€§å±äºä¸åŒçš„åç§°ç©ºé—´ã€‚è€Œä¸æ˜¯å±äºhttp://schemas.android.com/apk/res/androidåç§°ç©ºé—´,ä»–ä»¬å±äºhttp://schemas.android.com/apk/res/(ä½ çš„åŒ…åç§°)ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ä¸ºPieChartå®šä¹‰çš„å±æ€§: 1234567&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:custom=\"http://schemas.android.com/apk/res/com.example.customviews\"&gt; &lt;com.example.customviews.charting.PieChart custom:showText=\"true\" custom:labelPosition=\"left\" /&gt;&lt;/LinearLayout&gt; ä¸ºäº†é¿å…é‡å¤å†—é•¿çš„åç§°ç©ºé—´URIï¼Œè¯¥ç¤ºä¾‹ä½¿ç”¨äº†xmlnsæŒ‡ä»¤ã€‚è¿™ä¸ªæŒ‡ä»¤åˆ†é…åˆ«åå®šä¹‰å‘½åç©ºé—´http://schemas.android.com/apk/res/com.example.customviewsã€‚æ‚¨å¯ä»¥ä¸ºæ‚¨çš„å‘½åç©ºé—´é€‰æ‹©ä»»ä½•åˆ«åã€‚ è¯·æ³¨æ„å°†è‡ªå®šä¹‰è§†å›¾æ·»åŠ åˆ°å¸ƒå±€çš„XMLæ ‡è®°çš„åç§°ã€‚å®ƒæ˜¯è‡ªå®šä¹‰è§†å›¾ç±»çš„å®Œå…¨é™å®šåã€‚å¦‚æœæ‚¨çš„è§†å›¾ç±»æ˜¯å†…éƒ¨ç±»ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è§†å›¾çš„å¤–å±‚ç±»çš„åç§°è¿›ä¸€æ­¥é™å®šå®ƒã€‚è¿›ä¸€æ­¥ã€‚ä¾‹å¦‚ï¼ŒPieChartç±»æœ‰ä¸€ä¸ªåä¸ºPieViewçš„å†…éƒ¨ç±»ã€‚ä½¿ç”¨è¿™ä¸ªç±»çš„è‡ªå®šä¹‰å±æ€§,å¯ä»¥ä½¿ç”¨æ ‡ç­¾com.example.customviews.charting.PieChart$PieViewã€‚ åº”ç”¨è‡ªå®šä¹‰å±æ€§å½“ä»XMLå¸ƒå±€åˆ›å»ºè§†å›¾æ—¶ï¼ŒXMLæ ‡è®°ä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ä»èµ„æºåŒ…ä¸­è¯»å–çš„ï¼Œå¹¶ä½œä¸ºAttributeSetä¼ é€’åˆ°è§†å›¾çš„æ„é€ å‡½æ•°ä¸­ã€‚è™½ç„¶å¯ä»¥ç›´æ¥ä»AttributeSetä¸­è¯»å–å€¼ï¼Œä½†æ˜¯è¿™æ ·åšæœ‰ä¸€äº›ç¼ºç‚¹: å±æ€§å€¼ä¸­çš„èµ„æºå¼•ç”¨æ²¡æœ‰è¢«è§£æ ä¸èƒ½åº”ç”¨é£æ ¼ ç›¸åï¼Œå°†AttributeSetä¼ é€’åˆ°obtainStyledAttributes())ã€‚è¿™ä¸ªæ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªå·²ç»è¢«å–æ¶ˆå’Œæ ·å¼åŒ–çš„å€¼çš„TypedArrayæ•°ç»„ã€‚ Androidèµ„æºç¼–è¯‘å™¨ä¸ºæ‚¨åšäº†å¾ˆå¤šå·¥ä½œï¼Œä½¿è°ƒç”¨obtainStyledAttributes()æ›´å®¹æ˜“ã€‚å¯¹äºresç›®å½•ä¸­çš„æ¯ä¸ªèµ„æºï¼Œç”Ÿæˆçš„R.javaå®šä¹‰äº†ä¸€ä¸ªå±æ€§idæ•°ç»„å’Œä¸€ç»„å¸¸é‡ï¼Œè¿™äº›å¸¸é‡ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå±æ€§å®šä¹‰ç´¢å¼•ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„å¸¸é‡æ¥è¯»å–TypedArrayçš„å±æ€§ã€‚ä¸‹é¢æ˜¯å‹ç”µå›¾ç±»å¦‚ä½•è¯»å–å®ƒçš„å±æ€§: 1234567891011121314public PieChart(Context context, AttributeSet attrs) &#123; super(context, attrs); TypedArray a = context.getTheme().obtainStyledAttributes( attrs, R.styleable.PieChart, 0, 0); try &#123; mShowText = a.getBoolean(R.styleable.PieChart_showText, false); mTextPos = a.getInteger(R.styleable.PieChart_labelPosition, 0); &#125; finally &#123; a.recycle(); &#125;&#125; æ³¨æ„ï¼ŒTypedArrayå¯¹è±¡æ˜¯ä¸€ä¸ªå…±äº«èµ„æºï¼Œå¿…é¡»åœ¨ä½¿ç”¨åå›æ”¶ã€‚ æ·»åŠ å±æ€§å’Œäº‹ä»¶å±æ€§æ˜¯æ§åˆ¶è§†å›¾çš„è¡Œä¸ºå’Œå¤–è§‚çš„ä¸€ç§å¼ºå¤§çš„æ–¹å¼ï¼Œä½†æ˜¯åªæœ‰åœ¨è§†å›¾åˆå§‹åŒ–æ—¶æ‰èƒ½è¯»å–å®ƒä»¬ã€‚ä¸ºäº†æä¾›åŠ¨æ€è¡Œä¸ºï¼Œä¸ºæ¯ä¸ªå®šåˆ¶å±æ€§å…¬å¼€ä¸€ä¸ªå±æ€§å¯¹ getterå’Œsetterã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†PieChartå¦‚ä½•å…¬å¼€ä¸€ä¸ªåä¸ºshowTextçš„å±æ€§: 123456789public boolean isShowText() &#123; return mShowText;&#125;public void setShowText(boolean showText) &#123; mShowText = showText; invalidate(); requestLayout();&#125; æ³¨æ„ï¼ŒsetShowTextè°ƒç”¨invalidate())å’ŒrequestLayout())ã€‚è¿™äº›è°ƒç”¨å¯¹äºç¡®ä¿è§†å›¾çš„è¡Œä¸ºå¯é æ˜¯è‡³å…³é‡è¦çš„ã€‚æ‚¨å¿…é¡»åœ¨å¯¹å¯èƒ½æ›´æ”¹å…¶å¤–è§‚çš„å±æ€§è¿›è¡Œä»»ä½•æ›´æ”¹ä¹‹åï¼Œä½¿è§†å›¾invalidateï¼Œä»¥ä¾¿ç³»ç»ŸçŸ¥é“éœ€è¦é‡æ–°ç»˜åˆ¶å®ƒã€‚åŒæ ·åœ°ï¼Œå¦‚æœå±æ€§æ›´æ”¹å¯èƒ½å½±å“è§†å›¾çš„å¤§å°æˆ–å½¢çŠ¶ï¼Œåˆ™éœ€è¦è¯·æ±‚ä¸€ä¸ªæ–°çš„å¸ƒå±€ã€‚å¿˜è®°è¿™äº›æ–¹æ³•è°ƒç”¨ä¼šå¯¼è‡´éš¾ä»¥æ‰¾åˆ°çš„bugã€‚ è‡ªå®šä¹‰è§†å›¾è¿˜åº”è¯¥æ”¯æŒäº‹ä»¶ä¾¦å¬å™¨æ¥é€šä¿¡é‡è¦äº‹ä»¶ã€‚ä¾‹å¦‚ï¼ŒPieChartå…¬å¼€ä¸€ä¸ªåä¸ºOnCurrentItemChangedçš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œä»¥é€šçŸ¥ä¾¦å¬å™¨å‘ŠçŸ¥ï¼Œç”¨æˆ·å·²ç»å°†é¥¼å›¾è½¬åˆ°ä¸€ä¸ªæ–°çš„é¥¼å›¾ä¸Šã€‚ å¾ˆå®¹æ˜“å¿˜è®°æš´éœ²å±æ€§å’Œäº‹ä»¶ï¼Œå°¤å…¶æ˜¯å½“æ‚¨æ˜¯è‡ªå®šä¹‰è§†å›¾çš„å”¯ä¸€ç”¨æˆ·æ—¶ã€‚èŠ±ä¸€äº›æ—¶é—´ä»”ç»†åœ°å®šä¹‰è§†å›¾çš„æ¥å£å¯ä»¥å‡å°‘å°†æ¥çš„ç»´æŠ¤æˆæœ¬ã€‚ä¸€ä¸ªå¥½çš„è§„åˆ™æ˜¯å§‹ç»ˆå…¬å¼€ä»»ä½•å½±å“æ‚¨çš„è‡ªå®šä¹‰è§†å›¾çš„å¯è§å¤–è§‚æˆ–è¡Œä¸ºçš„å±æ€§ã€‚ å¯è®¿é—®æ€§çš„è®¾è®¡æ‚¨çš„è‡ªå®šä¹‰è§†å›¾åº”è¯¥æ”¯æŒæœ€å¹¿æ³›çš„ç”¨æˆ·ã€‚è¿™åŒ…æ‹¬æœ‰æ®‹ç–¾çš„ç”¨æˆ·é˜»æ­¢ä»–ä»¬çœ‹åˆ°æˆ–ä½¿ç”¨è§¦æ‘¸å±ã€‚ä¸ºäº†æ”¯æŒæ®‹ç–¾ç”¨æˆ·ï¼Œæ‚¨åº”è¯¥: æ ‡ç­¾ä½ è¾“å…¥å­—æ®µä½¿ç”¨android:contentDescriptionå±æ€§ åœ¨é€‚å½“çš„æ—¶å€™ï¼Œé€šè¿‡è°ƒç”¨sendAccessibilityEvent()) æ¥å‘é€å¯è®¿é—®æ€§äº‹ä»¶ã€‚ æ”¯æŒå¤‡ç”¨æ§åˆ¶å™¨ï¼Œå¦‚D-padå’Œè½¨è¿¹çƒ æœ‰å…³åˆ›å»ºå¯è®¿é—®è§†å›¾çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§åœ¨Androidå¼€å‘äººå‘˜æŒ‡å—ä¸­å¯è®¿é—®çš„åº”ç”¨ç¨‹åºã€‚","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","permalink":"https://jigangduan.github.io/categories/Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"}]},{"title":"ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"best-practices-user-interface","date":"2017-08-10T11:41:39.000Z","updated":"2020-07-25T02:57:18.194Z","comments":true,"path":"2017/08/10/best-practices-user-interface/","link":"","permalink":"https://jigangduan.github.io/2017/08/10/best-practices-user-interface/","excerpt":"è¿™ç±»æ•™ç¨‹æ•™ä½ å¦‚ä½•ä½¿ç”¨Androidå¸ƒå±€ä¸ºæ‰€æœ‰ç±»å‹çš„è®¾å¤‡å»ºç«‹ä¸€ä¸ªç”¨æˆ·ç•Œé¢ã€‚Androidä¸ºUIè®¾è®¡æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ¡†æ¶ï¼Œè®©ä½ çš„åº”ç”¨å¯ä»¥æ˜¾ç¤ºä¸åŒè®¾å¤‡çš„ä¸åŒå¸ƒå±€ï¼Œåˆ›å»ºå®šåˆ¶çš„UIå°éƒ¨ä»¶ï¼Œç”šè‡³å¯ä»¥æ§åˆ¶åº”ç”¨çª—å£ä¹‹å¤–çš„ç³»ç»ŸUIã€‚","text":"è¿™ç±»æ•™ç¨‹æ•™ä½ å¦‚ä½•ä½¿ç”¨Androidå¸ƒå±€ä¸ºæ‰€æœ‰ç±»å‹çš„è®¾å¤‡å»ºç«‹ä¸€ä¸ªç”¨æˆ·ç•Œé¢ã€‚Androidä¸ºUIè®¾è®¡æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ¡†æ¶ï¼Œè®©ä½ çš„åº”ç”¨å¯ä»¥æ˜¾ç¤ºä¸åŒè®¾å¤‡çš„ä¸åŒå¸ƒå±€ï¼Œåˆ›å»ºå®šåˆ¶çš„UIå°éƒ¨ä»¶ï¼Œç”šè‡³å¯ä»¥æ§åˆ¶åº”ç”¨çª—å£ä¹‹å¤–çš„ç³»ç»ŸUIã€‚ å¤šå±è®¾è®¡å¦‚ä½•æ„å»ºä¸€ä¸ªè¶³å¤Ÿçµæ´»çš„ç”¨æˆ·ç•Œé¢ï¼Œèƒ½å¤Ÿå®Œç¾åœ°é€‚åº”ä»»ä½•å±å¹•ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºé’ˆå¯¹ä¸åŒå±å¹•å¤§å°è¿›è¡Œä¼˜åŒ–çš„ä¸åŒäº¤äº’æ¨¡å¼ã€‚ æ”¯æŒä¸åŒçš„å±å¹•å°ºå¯¸ æ”¯æŒä¸åŒçš„å±å¹•å¯†åº¦ å®ç°è‡ªé€‚åº”UIæµ ä½¿ç”¨çº¦æŸå¸ƒå±€æ„å»ºå“åº”æ€§çš„UIå¦‚ä½•ä½¿ç”¨çº¦æŸå¸ƒå±€å’ŒAndroid Studioå¸ƒå±€ç¼–è¾‘å™¨æ¥æ„å»ºå¸ƒå±€ã€‚ æ·»åŠ åº”ç”¨æ å¦‚ä½•ä½¿ç”¨æ”¯æŒåº“çš„toolbarå°éƒ¨ä»¶æ¥å®ç°ä¸€ä¸ªåº”ç”¨æ ï¼Œåœ¨å„ç§è®¾å¤‡ä¸Šæ­£ç¡®æ˜¾ç¤ºã€‚ è®¾ç½®åº”ç”¨æ  æ·»åŠ å’Œå¤„ç†Actions æ·»åŠ Up Action Action Viewså’ŒAction Providers æ˜¾ç¤ºå¼¹å‡ºå¼æ¶ˆæ¯å¦‚ä½•ä½¿ç”¨æ”¯æŒåº“çš„Snackbarå°éƒ¨ä»¶æ¥æ˜¾ç¤ºä¸€ä¸ªç®€çŸ­çš„å¼¹å‡ºæ¶ˆæ¯ã€‚ æ„å»ºå¹¶æ˜¾ç¤ºå¼¹å‡ºæ¶ˆæ¯ å‘æ¶ˆæ¯ä¸­æ·»åŠ Action åˆ›å»ºè‡ªå®šä¹‰è§†å›¾Androidæ¡†æ¶æœ‰å¤§é‡çš„Viewç±»ï¼Œç”¨äºä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œå¹¶æ˜¾ç¤ºå„ç§ç±»å‹çš„æ•°æ®ã€‚ä½†æœ‰æ—¶ä½ çš„åº”ç”¨ç¨‹åºæœ‰ç‹¬ç‰¹çš„éœ€æ±‚ï¼Œæ²¡æœ‰å†…ç½®è§†å›¾çš„è¦†ç›–ã€‚æœ¬æ–‡å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºæ‚¨è‡ªå·±çš„è§†å›¾ï¼Œè¿™äº›è§†å›¾æ˜¯å¥å£®ä¸”å¯é‡ç”¨çš„ã€‚ åˆ›å»ºè‡ªå®šä¹‰è§†å›¾ç±» åˆ›å»ºä¸€ä¸ªç±»ä¼¼å†…ç½®è§†å›¾çš„ç±»ï¼Œå¸¦æœ‰è‡ªå®šä¹‰å±æ€§å’Œæ”¯æŒAndroid Studioå¸ƒå±€ç¼–è¾‘å™¨ã€‚ å®ç°è‡ªå®šä¹‰ç»˜åˆ¶ ä½¿ç”¨Androidå›¾å½¢ç³»ç»Ÿä½¿ä½ çš„è§†å›¾å…·æœ‰è§†è§‰ä¸Šçš„ä¸ä¼—ä¸åŒã€‚ è§†å›¾äº¤äº’ ç”¨æˆ·å¸Œæœ›è§†å›¾èƒ½å¤Ÿå¹³ç¨³ã€è‡ªç„¶åœ°å“åº”è¾“å…¥æ‰‹åŠ¿ã€‚è¿™ä¸ªè¯¾ç¨‹å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨æ‰‹åŠ¿æ£€æµ‹ã€ç‰©ç†å’ŒåŠ¨ç”»æ¥ç»™ç”¨æˆ·ç•Œé¢æä¾›ä¸“ä¸šçš„æ„Ÿè§‰ã€‚ ä¼˜åŒ–è§†å›¾ ä¸ç®¡ä½ çš„UIæœ‰å¤šæ¼‚äº®ï¼Œç”¨æˆ·éƒ½ä¸ä¼šå–œæ¬¢å®ƒï¼Œå¦‚æœå®ƒä¸ä»¥ä¸€è´¯çš„é«˜å¸§ç‡è¿è¡Œçš„è¯ã€‚å­¦ä¹ å¦‚ä½•é¿å…å¸¸è§çš„æ€§èƒ½é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿä½¿æ‚¨çš„è‡ªå®šä¹‰å›¾å½¢è¿è¡Œå¾—æ›´å¿«ã€‚ åˆ›å»ºå‘åå…¼å®¹UIså¦‚ä½•åœ¨æœ€æ–°ç‰ˆæœ¬çš„Androidä¸­ä½¿ç”¨UIç»„ä»¶å’Œå…¶ä»–APIsï¼ŒåŒæ—¶ä¸æ—§ç‰ˆæœ¬çš„å¹³å°å…¼å®¹ã€‚ æŠ½è±¡æ–°APIs ä»£ç†æ–°APIs ä½¿ç”¨æ—§çš„APIsåˆ›å»ºå®ç° ä½¿ç”¨ç‰ˆæœ¬æ„ŸçŸ¥ç»„ä»¶ å®ç°å¯è®¿é—®æ€§å¦‚ä½•è®©ä½ çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¢«è§†åŠ›éšœç¢æˆ–å…¶ä»–èº«ä½“æ®‹ç–¾çš„ç”¨æˆ·è®¿é—®ã€‚ å¼€å‘å¯è®¿é—®æ€§æœåŠ¡ æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºçš„å¯è®¿é—®æ€§ ç®¡ç†ç³»ç»Ÿç”¨æˆ·ç•Œé¢å¦‚ä½•éšè—å’Œæ˜¾ç¤ºä¸åŒç‰ˆæœ¬Androidçš„çŠ¶æ€å’Œå¯¼èˆªæ¡ï¼ŒåŒæ—¶ç®¡ç†å…¶ä»–å±å¹•ç»„ä»¶çš„æ˜¾ç¤ºã€‚ æ¨¡ç³Šç³»ç»Ÿæ  éšè—çŠ¶æ€æ  éšè—å¯¼èˆªæ  ä½¿ç”¨ä¾µå…¥å¼çš„å…¨å±æ¨¡å¼ å¯¹UIå¯è§æ€§å˜åŒ–åšå‡ºå“åº” åˆ›å»ºMaterial Designåº”ç”¨ç¨‹åºå¦‚ä½•åœ¨Androidä¸Šå®ç°Material Designã€‚ å¼€å§‹ ä½¿ç”¨Materialä¸»é¢˜ åˆ›å»ºåˆ—è¡¨å’Œå¡ç‰‡ å®šä¹‰é˜´å½±å’Œå‰ªåˆ‡è§†å›¾ ä½¿ç”¨ç”»æ¿ å®šä¹‰è‡ªå®šä¹‰åŠ¨ç”» ä¿æŒå…¼å®¹æ€§ ä½¿ç”¨è°ƒè‰²æ¿APIé€‰æ‹©é¢œè‰² ä½¿ç”¨è®¾è®¡æ”¯æŒåº“","categories":[{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","permalink":"https://jigangduan.github.io/categories/Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ/"}],"tags":[{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"}]},{"title":"Pythonå¤šç‰ˆæœ¬é…ç½®","slug":"Pythonå¤šç‰ˆæœ¬-1","date":"2017-07-15T07:47:10.000Z","updated":"2020-07-25T02:57:18.161Z","comments":true,"path":"2017/07/15/Pythonå¤šç‰ˆæœ¬-1/","link":"","permalink":"https://jigangduan.github.io/2017/07/15/Pythonå¤šç‰ˆæœ¬-1/","excerpt":"Pythonæ˜“ç”¨ï¼Œä½†ç”¨å¥½å´ä¸æ˜“ï¼Œå…¶ä¸­æ¯”è¾ƒå¤´ç–¼çš„å°±æ˜¯åŒ…ç®¡ç†å’ŒPythonä¸åŒç‰ˆæœ¬çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæœ‰ä¸å°‘å‘è¡Œç‰ˆçš„Pythonï¼Œæ¯”å¦‚WinPythonã€Anacondaç­‰ï¼Œè¿™äº›å‘è¡Œç‰ˆå°†pythonå’Œè®¸å¤šå¸¸ç”¨çš„packageæ‰“åŒ…ï¼Œæ–¹ä¾¿pythonersç›´æ¥ä½¿ç”¨ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰virtualenvã€pyenvç­‰å·¥å…·ç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚ ä¸€èˆ¬ç½‘ä¸Šæ¯”è¾ƒå¤šçš„æ˜¯ä½¿ç”¨pip + pyenv + virtualenvã€‚å¼€å§‹å°è¯•pyenvï¼Œä½†å®‰è£…è¿‡ç¨‹ä¸­é‡è§å¾ˆå¤šçš„å‘ï¼Œæœ€ç»ˆé€‰æ‹©äº†Anacondaã€‚","text":"Pythonæ˜“ç”¨ï¼Œä½†ç”¨å¥½å´ä¸æ˜“ï¼Œå…¶ä¸­æ¯”è¾ƒå¤´ç–¼çš„å°±æ˜¯åŒ…ç®¡ç†å’ŒPythonä¸åŒç‰ˆæœ¬çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæœ‰ä¸å°‘å‘è¡Œç‰ˆçš„Pythonï¼Œæ¯”å¦‚WinPythonã€Anacondaç­‰ï¼Œè¿™äº›å‘è¡Œç‰ˆå°†pythonå’Œè®¸å¤šå¸¸ç”¨çš„packageæ‰“åŒ…ï¼Œæ–¹ä¾¿pythonersç›´æ¥ä½¿ç”¨ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰virtualenvã€pyenvç­‰å·¥å…·ç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚ ä¸€èˆ¬ç½‘ä¸Šæ¯”è¾ƒå¤šçš„æ˜¯ä½¿ç”¨pip + pyenv + virtualenvã€‚å¼€å§‹å°è¯•pyenvï¼Œä½†å®‰è£…è¿‡ç¨‹ä¸­é‡è§å¾ˆå¤šçš„å‘ï¼Œæœ€ç»ˆé€‰æ‹©äº†Anacondaã€‚ pyenvç»å¸¸é‡åˆ°è¿™æ ·çš„æƒ…å†µï¼š ç³»ç»Ÿè‡ªå¸¦çš„Pythonæ˜¯2.xï¼Œè‡ªå·±éœ€è¦Python 3.xï¼Œæµ‹è¯•å°é²œï¼› ç³»ç»Ÿæ˜¯2.6.xï¼Œå¼€å‘ç¯å¢ƒæ˜¯2.7.x ç”±äºMacæœºå™¨ç³»ç»Ÿä¿æŠ¤çš„åŸå› ï¼Œé»˜è®¤çš„Pythonä¸­æ— æ³•å¯¹PIPä¸€äº›åŒ…å‡çº§ï¼Œéœ€è¦ç»„å»ºæ–°çš„Pythonç¯å¢ƒã€‚ æ­¤æ—¶éœ€è¦åœ¨ç³»ç»Ÿä¸­å®‰è£…å¤šä¸ªPythonï¼Œä½†åˆä¸èƒ½å½±å“ç³»ç»Ÿè‡ªå¸¦çš„Pythonï¼Œå³éœ€è¦å®ç°Pythonçš„å¤šç‰ˆæœ¬å…±å­˜ã€‚pyenvå°±æ˜¯è¿™æ ·ä¸€ä¸ªPythonç‰ˆæœ¬ç®¡ç†å™¨ã€‚ å®‰è£…pyenv1brew install pyenv æŸ¥çœ‹å½“å‰æ¿€æ´»çš„æ˜¯é‚£ä¸ªç‰ˆæœ¬çš„Python12$ pyenv versionsystem (set by /Users/jiang.duan/.pyenv/version) æŸ¥çœ‹å·²ç»å®‰è£…äº†é‚£äº›ç‰ˆæœ¬çš„Python12$ pyenv versions* system (set by /Users/jiang.duan/.pyenv/version) å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Python1pyenv install 3.5.0 é‡åˆ°ä¸‹é¢é”™è¯¯ï¼š 1234567891011121314151617181920Downloading Python-3.5.0.tar.xz...-&gt; https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xzInstalling Python-3.5.0...BUILD FAILED (OS X 10.12.6 using python-build 20160602)Inspect or clean up the working tree at /var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115092041.13510Results logged to /var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115092041.13510.logLast 10 log lines: File &quot;/private/var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115092041.13510/Python-3.5.0/Lib/ensurepip/__main__.py&quot;, line 4, in &lt;module&gt; ensurepip._main() File &quot;/private/var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115092041.13510/Python-3.5.0/Lib/ensurepip/__init__.py&quot;, line 209, in _main default_pip=args.default_pip, File &quot;/private/var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115092041.13510/Python-3.5.0/Lib/ensurepip/__init__.py&quot;, line 116, in bootstrap _run_pip(args + [p[0] for p in _PROJECTS], additional_paths) File &quot;/private/var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115092041.13510/Python-3.5.0/Lib/ensurepip/__init__.py&quot;, line 40, in _run_pip import pipzipimport.ZipImportError: can&apos;t decompress data; zlib not availablemake: *** [install] Error 1 åŸå› ï¼š 1zipimport.ZipImportError: can&apos;t decompress data; zlib not available è¯¦æƒ…çœ‹è¿™é‡Œï¼šissues/25 æ‰§è¡Œä¸‹é¢çš„ä»£ç å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼š 1CFLAGS=\"-I$(xcrun --show-sdk-path)/usr/include\" pyenv install -v 3.5.0 é‡åˆ°ä¸‹é¢é”™è¯¯ï¼š1234567891011121314warning: xz not found; consider installing `xz` package/var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115122939.26443/Python-3.5.0 /var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115122939.26443 ~/WorkSpace/js/hexo/jigang-duan.github.io/hexo/jigangchecking build system type... x86_64-apple-darwin16.7.0checking host system type... x86_64-apple-darwin16.7.0checking for --enable-universalsdk... nochecking for --with-universal-archs... nochecking MACHDEP... darwinchecking for --without-gcc... nochecking for gcc... clangchecking whether the C compiler works... noconfigure: error: in `/var/folders/ks/yhszh_sx2qzb22rn46b145xr0000gn/T/python-build.20171115122939.26443/Python-3.5.0&apos;:configure: error: C compiler cannot create executablesSee `config.log&apos; for more detailsmake: *** No targets specified and no makefile found. Stop. è¯¦æƒ…çœ‹è¿™é‡Œï¼šissues/843 ä»ä¸­å‘ç°äº†Anaconda, pyenvå‘å¤šï¼Œæ‰€ä»¥æ”¾å¼ƒï¼Œæ”¹ç”¨Anacondaã€‚ Anacondaä»‹ç» æ˜¯ä¸æ˜¯åœ¨å¼€å§‹æ—¶å°±é‡åˆ°å„ç§éº»çƒ¦å‘¢ï¼Ÿ åˆ°åº•è¯¥è£… Python2 å‘¢è¿˜æ˜¯ Python3 ï¼Ÿ ä¸ºä»€ä¹ˆå®‰è£… Python æ—¶æ€»æ˜¯å‡ºé”™ï¼Ÿ æ€ä¹ˆå®‰è£…å·¥å…·åŒ…å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆæç¤ºè¯´åœ¨å®‰è£…è¿™ä¸ªå·¥å…·å‰å¿…é¡»å…ˆå®‰è£…ä¸€å †å…¶ä»–ä¸æ˜æ‰€ä»¥çš„å·¥å…·ï¼Ÿ Anacondaçš„å®‰è£…Anacondaçš„ä¸‹è½½é¡µå‚è§å®˜ç½‘ä¸‹è½½ï¼ŒLinuxã€Macã€Windowså‡æ”¯æŒã€‚ ä¸‹è½½å‘½ä»¤è¡Œç‰ˆæœ¬ ï¼š macOS installer å®‰è£…ï¼š 1bash ~/Downloads/Anaconda2-5.0.1-MacOSX-x86_64.sh å¯¹äºMacã€Linuxç³»ç»Ÿï¼ŒAnacondaå®‰è£…å¥½åï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä¸»ç›®å½•ä¸‹å¤šäº†ä¸ªæ–‡ä»¶å¤¹ï¼ˆ~/anacondaï¼‰è€Œå·²ï¼ŒWindowsä¼šå†™å…¥æ³¨å†Œè¡¨ã€‚å®‰è£…æ—¶ï¼Œå®‰è£…ç¨‹åºä¼šæŠŠbinç›®å½•åŠ å…¥PATHï¼ˆLinux/Macå†™å…¥~/.bashrcï¼ŒWindowsæ·»åŠ åˆ°ç³»ç»Ÿå˜é‡PATHï¼‰ï¼Œè¿™äº›æ“ä½œä¹Ÿå®Œå…¨å¯ä»¥è‡ªå·±å®Œæˆã€‚ä»¥Linux/Macä¸ºä¾‹ï¼Œå®‰è£…å®Œæˆåè®¾ç½®PATHçš„æ“ä½œæ˜¯ 1234# å°†anacondaçš„binç›®å½•åŠ å…¥PATHï¼Œæ ¹æ®ç‰ˆæœ¬ä¸åŒï¼Œä¹Ÿå¯èƒ½æ˜¯~/anaconda3/binecho 'export PATH=\"~/anaconda3/bin:$PATH\"' &gt;&gt; ~/.bashrc# æ›´æ–°bashrcä»¥ç«‹å³ç”Ÿæ•ˆsource ~/.bashrc æ£€æŸ¥æ˜¯å¦æ­£ç¡® 1234$ conda --versionconda 4.3.30$ python --versionPython 3.6.3 :: Anaconda, Inc. Condaçš„ç¯å¢ƒç®¡ç†åˆ›å»ºä¸€ä¸ªåä¸ºpython27çš„ç¯å¢ƒï¼ŒæŒ‡å®šPythonç‰ˆæœ¬æ˜¯2.7ï¼ˆä¸ç”¨ç®¡æ˜¯2.7.xï¼Œcondaä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨å¯»æ‰¾2.7.xä¸­çš„æœ€æ–°ç‰ˆæœ¬ï¼‰ 123$ conda create --name py27 python=2.7Package plan for installation in environment /Users/jiang.duan/anaconda3/envs/py27: æ˜¾ç¤ºæ‰€æœ‰çš„ç¯å¢ƒï¼š 12345$ conda env list# conda environments:#py27 /Users/jiang.duan/anaconda3/envs/py27root * /Users/jiang.duan/anaconda3 å®‰è£…å¥½åï¼Œä½¿ç”¨activateæ¿€æ´»æŸä¸ªç¯å¢ƒ: 1$ source activate py27 æŸ¥çœ‹ç¯å¢ƒï¼š 1234567(py27) $ conda env list# conda environments:#py27 * /Users/jiang.duan/anaconda3/envs/py27root /Users/jiang.duan/anaconda3(py27) $ python --versionPython 2.7.14 :: Anaconda, Inc. é€€å‡ºå½“å‰ç¯å¢ƒï¼š 1$ source deactivate åˆ é™¤åä¸º py27 çš„ç¯å¢ƒï¼š 123$ conda env remove -n py27Package plan for package removal in environment /Users/jiang.duan/anaconda3/envs/py27: æŸ¥çœ‹ç¯å¢ƒï¼š 1234jiangduandeiMac:py jiang.duan$ conda env list# conda environments:#root * /Users/jiang.duan/anaconda3 ç”¨æˆ·å®‰è£…çš„ä¸åŒpythonç¯å¢ƒéƒ½ä¼šè¢«æ”¾åœ¨ç›®å½•~/anaconda/envsä¸‹ï¼Œå¯ä»¥åœ¨å‘½ä»¤ä¸­è¿è¡Œconda info -eæŸ¥çœ‹å·²å®‰è£…çš„ç¯å¢ƒï¼Œå½“å‰è¢«æ¿€æ´»çš„ç¯å¢ƒä¼šæ˜¾ç¤ºæœ‰ä¸€ä¸ªæ˜Ÿå·æˆ–è€…æ‹¬å·ã€‚ Condaçš„åŒ…ç®¡ç†Condaçš„åŒ…ç®¡ç†å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œè¿™éƒ¨åˆ†åŠŸèƒ½ä¸pipç±»ä¼¼ã€‚ condaçš„ä¸€äº›å¸¸ç”¨æ“ä½œå¦‚ä¸‹ï¼š 12345678910111213141516171819# æŸ¥çœ‹å½“å‰ç¯å¢ƒä¸‹å·²å®‰è£…çš„åŒ…conda list# æŸ¥çœ‹æŸä¸ªæŒ‡å®šç¯å¢ƒçš„å·²å®‰è£…åŒ…conda list -n python34# æŸ¥æ‰¾packageä¿¡æ¯conda search numpy# å®‰è£…packageconda install -n python34 numpy# å¦‚æœä¸ç”¨-næŒ‡å®šç¯å¢ƒåç§°ï¼Œåˆ™è¢«å®‰è£…åœ¨å½“å‰æ´»è·ƒç¯å¢ƒ# ä¹Ÿå¯ä»¥é€šè¿‡-cæŒ‡å®šé€šè¿‡æŸä¸ªchannelå®‰è£…# æ›´æ–°packageconda update -n python34 numpy# åˆ é™¤packageconda remove -n python34 numpy condaå°†condaã€pythonç­‰éƒ½è§†ä¸ºpackageï¼Œå› æ­¤ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨condaæ¥ç®¡ç†condaå’Œpythonçš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ 123456789# æ›´æ–°condaï¼Œä¿æŒcondaæœ€æ–°conda update conda# æ›´æ–°anacondaconda update anaconda# æ›´æ–°pythonconda update python# å‡è®¾å½“å‰ç¯å¢ƒæ˜¯python 3.4, condaä¼šå°†pythonå‡çº§ä¸º3.4.xç³»åˆ—çš„å½“å‰æœ€æ–°ç‰ˆæœ¬ è¡¥å……ï¼šå¦‚æœåˆ›å»ºæ–°çš„pythonç¯å¢ƒï¼Œæ¯”å¦‚2.7ï¼Œè¿è¡Œconda create -n python27 python=2.7ä¹‹åï¼Œcondaä»…å®‰è£…python 2.7ç›¸å…³çš„å¿…é¡»é¡¹ï¼Œå¦‚python, pipç­‰ï¼Œå¦‚æœå¸Œæœ›è¯¥ç¯å¢ƒåƒé»˜è®¤ç¯å¢ƒé‚£æ ·ï¼Œå®‰è£…anacondaé›†åˆåŒ…ï¼Œåªéœ€è¦ï¼š 123456# åœ¨å½“å‰ç¯å¢ƒä¸‹å®‰è£…anacondaåŒ…é›†åˆconda install anaconda# ç»“åˆåˆ›å»ºç¯å¢ƒçš„å‘½ä»¤ï¼Œä»¥ä¸Šæ“ä½œå¯ä»¥åˆå¹¶ä¸ºconda create -n python34 python=3.4 anaconda# ä¹Ÿå¯ä»¥ä¸ç”¨å…¨éƒ¨å®‰è£…ï¼Œæ ¹æ®éœ€æ±‚å®‰è£…è‡ªå·±éœ€è¦çš„packageå³å¯ åˆ†äº«ç¯å¢ƒå½“åˆ†äº«ä»£ç çš„æ—¶å€™ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å°†è¿è¡Œç¯å¢ƒåˆ†äº«ç»™å¤§å®¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥å°†å½“å‰ç¯å¢ƒä¸‹çš„ package ä¿¡æ¯å­˜å…¥åä¸º environment çš„ YAML æ–‡ä»¶ä¸­ã€‚ 1conda env export &gt; environment.yaml åŒæ ·ï¼Œå½“æ‰§è¡Œä»–äººçš„ä»£ç æ—¶ï¼Œä¹Ÿéœ€è¦é…ç½®ç›¸åº”çš„ç¯å¢ƒã€‚è¿™æ—¶ä½ å¯ä»¥ç”¨å¯¹æ–¹åˆ†äº«çš„ YAML æ–‡ä»¶æ¥åˆ›å»ºä¸€æ‘¸ä¸€æ ·çš„è¿è¡Œç¯å¢ƒã€‚ 1conda env create -f environment.yaml","categories":[{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"åŒ…ç®¡ç†å™¨","slug":"Python/åŒ…ç®¡ç†å™¨","permalink":"https://jigangduan.github.io/categories/Python/åŒ…ç®¡ç†å™¨/"}],"tags":[{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"}]},{"title":"Spring æŒ‡å—","slug":"spring-guides","date":"2017-07-14T06:07:38.000Z","updated":"2020-07-25T02:57:18.228Z","comments":true,"path":"2017/07/14/spring-guides/","link":"","permalink":"https://jigangduan.github.io/2017/07/14/spring-guides/","excerpt":"æ— è®ºæ‚¨åœ¨æ„å»ºä»€ä¹ˆï¼Œè¿™äº›æŒ‡å¯¼éƒ½æ˜¯ä¸ºäº†è®©æ‚¨å°½å¯èƒ½å¿«åœ°å·¥ä½œï¼Œä½¿ç”¨Springå›¢é˜Ÿæ¨èçš„æœ€æ–°Springé¡¹ç›®å‘å¸ƒå’ŒæŠ€æœ¯ã€‚","text":"æ— è®ºæ‚¨åœ¨æ„å»ºä»€ä¹ˆï¼Œè¿™äº›æŒ‡å¯¼éƒ½æ˜¯ä¸ºäº†è®©æ‚¨å°½å¯èƒ½å¿«åœ°å·¥ä½œï¼Œä½¿ç”¨Springå›¢é˜Ÿæ¨èçš„æœ€æ–°Springé¡¹ç›®å‘å¸ƒå’ŒæŠ€æœ¯ã€‚ å…¥é—¨æŒ‡å—è¿™äº›æŒ‡å—ä¸ºåœ¨15-30åˆ†é’Ÿå†…å®Œæˆï¼Œæä¾›äº†å¿«é€Ÿã€å®ç”¨çš„æŒ‡å¯¼ï¼Œç”¨äºæ„å»ºSpringçš„ä»»ä½•å¼€å‘ä»»åŠ¡çš„â€œHello Worldâ€ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæƒŸä¸€çš„å…ˆå†³æ¡ä»¶æ˜¯JDKå’Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚ æ„å»ºRESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springåˆ›å»ºä¸€ä¸ªRESTfulçš„webæœåŠ¡ã€‚ ä½¿ç”¨Gradleæ„å»ºJavaé¡¹ç›® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Gradleæ„å»ºJavaé¡¹ç›®ã€‚ æ–‡ä»¶ä¸Šä¼  å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªæ¥å—multi-partæ–‡ä»¶ä¸Šä¼ çš„Springåº”ç”¨ç¨‹åºã€‚ Redis æ¶ˆæ¯ä¼ é€’ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Redisä½œä¸ºæ¶ˆæ¯ä»£ç†ã€‚ è®¿é—®Twitteræ•°æ® å­¦ä¹ å¦‚ä½•ä»Twitterè®¿é—®ç”¨æˆ·æ•°æ®ã€‚ éªŒè¯è¡¨å•è¾“å…¥ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springæ‰§è¡Œè¡¨å•éªŒè¯ã€‚ åˆ›å»ºæ‰¹å¤„ç†æœåŠ¡ å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æ‰¹å¤„ç†è§£å†³æ–¹æ¡ˆã€‚ GemFireè®¿é—®æ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Gemfireçš„æ•°æ®ç»“æ„æ¥æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ ç®¡ç†äº‹åŠ¡ å­¦ä¹ å¦‚ä½•ç”¨äº‹åŠ¡åŒ…è£…ä»£ç çš„å…³é”®éƒ¨åˆ†ã€‚ ä½¿ç”¨Spring MVCæœåŠ¡Webå†…å®¹ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring MVCåˆ›å»ºä¸€ä¸ªwebé¡µé¢ã€‚ å¤„ç†è¡¨å•æäº¤ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springåˆ›å»ºå’Œæäº¤webè¡¨å•ã€‚ ä½¿ç”¨STSå·¥ä½œ å…¥é—¨æŒ‡å— å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springå·¥å…·å¥—ä»¶(STS)å¯¼å…¥å…¥é—¨æŒ‡å—ã€‚ ä½¿ç”¨jQueryæ¶ˆè´¹RESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨jQueryæ£€ç´¢webé¡µé¢æ•°æ®ã€‚ ç”¨Mavenæ„å»ºSpring YARNé¡¹ç›® å­¦ä¹ å¦‚ä½•ç”¨Mavenæ„å»ºä¸€ä¸ªSpring YARNé¡¹ç›® æ‰¹å¤„ç†YARNåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªSpringæ‰¹å¤„ç†YARNåº”ç”¨ç¨‹åº ä½¿ç”¨RESTè®¿é—®JPAæ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Data RESTæ¥å¤„ç†åŸºäºRESTfulã€åŸºäºè¶…åª’ä½“çš„æŒä¹…æ€§æ•°æ®ã€‚ ä½¿ç”¨RESTè®¿é—®Neo4jæ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Data RESTæ¥å¤„ç†RESTfulçš„ã€åŸºäºè¶…åª’ä½“çš„æŒä¹…æ€§æ•°æ®ã€‚ ä½¿ç”¨RESTè®¿é—®GemFireæ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Data RESTæ¥å¤„ç†åŸºäºRESTfulçš„ã€åŸºäºè¶…åª’ä½“çš„æŒä¹…æ€§æ•°æ®ã€‚ Springç¼“å­˜æ•°æ® å­¦ä¹ å¦‚ä½•åœ¨å†…å­˜ä¸­ä½¿ç”¨Springç¼“å­˜æ•°æ® ç”¨IntelliJ IDEAå¼€å§‹ä¸€ä¸ªå…¥é—¨æŒ‡å— å­¦ä¹ å¦‚ä½•ä½¿ç”¨IntelliJ IDEAå¼€å§‹å…¥é—¨æŒ‡å—ã€‚ é›†ä¸­é…ç½® å­¦ä¹ å¦‚ä½•ä»å¤–éƒ¨çš„ã€é›†ä¸­çš„æºç®¡ç†åº”ç”¨ç¨‹åºè®¾ç½® ä½¿ç”¨Ribbonå’ŒSpring Cloudçš„å®¢æˆ·ç«¯è´Ÿè½½å¹³è¡¡ åŠ¨æ€æ”¯æŒæœåŠ¡åœ¨ä¸ä¸­æ–­å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹è¿›è¡Œ åˆ›å»ºä¸€ä¸ªå¤šæ¨¡å—é¡¹ç›® å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªåº“ï¼Œå¹¶åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­å¯¹å…¶è¿›è¡Œæ‰“åŒ… è°ƒåº¦ä»»åŠ¡ å­¦ä¹ å¦‚ä½•ç”¨Springå®‰æ’ä»»åŠ¡ã€‚ ä½¿ç”¨Mavenæ„å»ºJavaé¡¹ç›® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Mavenæ„å»ºJavaé¡¹ç›®ã€‚ ä½¿ç”¨LDAPå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ å­¦ä¹ å¦‚ä½•ä½¿ç”¨LDAPä¿æŠ¤åº”ç”¨ç¨‹åºã€‚ ç”¨Twitteræ³¨å†Œä¸€ä¸ªåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•ç”¨Twitteræ³¨å†Œåº”ç”¨ç¨‹åºã€‚ è®¿é—®Facebookçš„æ•°æ® å­¦ä¹ å¦‚ä½•ä»åº”ç”¨ç¨‹åºä¸­è®¿é—®Facebookä¿¡æ¯ã€‚ ä½¿ç”¨Spring Boot Actuatoræ„å»ºä¸€ä¸ªRESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Boot Actuatoråˆ›å»ºä¸€ä¸ªRESTful WebæœåŠ¡ã€‚ ä¿æŠ¤Webåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Securityä¿æŠ¤æ‚¨çš„webåº”ç”¨ç¨‹åºã€‚ æ•´åˆæ•°æ® å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªä½¿ç”¨Spring Integrationæ¥è·å–æ•°æ®ã€å¤„ç†å®ƒå¹¶å°†å…¶å†™å…¥æ–‡ä»¶çš„åº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨JPAè®¿é—®æ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring data JPAè®¿é—®JPAæŒä¹…åŒ–æ•°æ®ã€‚ å°†Spring Boot JARåº”ç”¨ç¨‹åºè½¬æ¢ä¸ºWAR å­¦ä¹ å¦‚ä½•å°†Spring Bootåº”ç”¨ç¨‹åºè½¬æ¢ä¸ºWARæ–‡ä»¶ã€‚ ä½¿ç”¨Spring Bootæ„å»ºåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•ç”¨æœ€å°‘çš„é…ç½®æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨AngularJSæ¶ˆè´¹RESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨AngularJSæ£€ç´¢webé¡µé¢æ•°æ®ã€‚ æ”¯æŒRESTful WebæœåŠ¡çš„è·¨æºè¯·æ±‚ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springåˆ›å»ºä¸€ä¸ªæ”¯æŒè·¨æºèµ„æºå…±äº«(CORS)çš„RESTful webæœåŠ¡ã€‚ ç®€å•çš„YARNåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„Spring YARNåº”ç”¨ç¨‹åº å¯é‡å¯çš„æ‰¹å¤„ç†YARN åº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªå¯é‡å¯çš„Springæ‰¹å¤„ç†YARN åº”ç”¨ç¨‹åº ç”Ÿæˆä¸€ä¸ªSOAP webæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springåˆ›å»ºåŸºäºSOAPçš„webæœåŠ¡ã€‚ ä»STSéƒ¨ç½²åˆ°äº‘è®¡ç®— å­¦ä¹ å¦‚ä½•å°†Springåº”ç”¨ç¨‹åºä»STSéƒ¨ç½²åˆ°äº‘è®¡ç®—ä¸Š ä½¿ç”¨Vaadinåˆ›å»ºCRUD UI ä½¿ç”¨Vaadinå’ŒSpring Data JPAæ„å»ºä¸€ä¸ªåŠ¨æ€çš„UI è·¯ç”±å’Œè¿‡æ»¤ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Netflix Zuulçš„å¾®æœåŠ¡æ¥å‘é€å’Œè¿‡æ»¤è¯·æ±‚ æµ‹è¯•Webå±‚ å­¦ä¹ å¦‚ä½•æµ‹è¯•Spring Bootåº”ç”¨ç¨‹åºå’ŒMVCæ§åˆ¶å™¨ã€‚ ä½¿ç”¨Restdocsåˆ›å»ºAPIæ–‡æ¡£ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Restdocsä¸ºHTTPç«¯ç‚¹ç”Ÿæˆæ–‡æ¡£ æ¶ˆè´¹RESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springçš„RestTemplateæ£€ç´¢webé¡µé¢æ•°æ®ã€‚ Springä½¿ç”¨JDBCè®¿é—®å…³ç³»æ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springè®¿é—®å…³ç³»æ•°æ®ã€‚ ä½¿ç”¨Facebookæ³¨å†Œä¸€ä¸ªåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•æ³¨å†Œä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥ä¸Facebooké›†æˆã€‚ RabbitMQ æ¶ˆæ¯ä¼ é€’ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springå’ŒRabbitMQåˆ›å»ºä¸€ä¸ªç®€å•çš„å‘å¸ƒ-è®¢é˜…åº”ç”¨ç¨‹åºã€‚ Neo4jè®¿é—®æ•°æ® å­¦ä¹ å¦‚ä½•åœ¨Neo4jçš„NoSQLæ•°æ®å­˜å‚¨ä¸­æŒä¹…åŒ–å¯¹è±¡å’Œå»ºç«‹å…³ç³»ã€‚ JMSæ¶ˆæ¯ä¼ é€’ å­¦ä¹ å¦‚ä½•ä½¿ç”¨JMSä»£ç†å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ã€‚ æ„å»ºè¶…åª’ä½“é©±åŠ¨çš„RESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springåˆ›å»ºä¸€ä¸ªè¶…åª’ä½“é©±åŠ¨çš„RESTful WebæœåŠ¡ã€‚ GemFireç¼“å­˜æ•°æ® å­¦ä¹ å¦‚ä½•åœ¨GemFireä¸­ç¼“å­˜æ•°æ®ã€‚ MongoDBè®¿é—®æ•°æ® å­¦ä¹ å¦‚ä½•åœ¨MongoDBä¸­æŒä¹…åŒ–æ•°æ®ã€‚ åˆ›å»ºå¼‚æ­¥æ–¹æ³• å­¦ä¹ å¦‚ä½•åˆ›å»ºå¼‚æ­¥æœåŠ¡æ–¹æ³•ã€‚ ä½¿ç”¨WebSocketæ¥æ„å»ºä¸€ä¸ªäº¤äº’å¼webåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•é€šè¿‡WebSocketåœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ ä½¿ç”¨rest.jsæ¶ˆè´¹RESTful WebæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨rest.jsæ£€ç´¢webé¡µé¢æ•°æ®ã€‚ ä½¿ç”¨Gradle æ„å»ºSpring YARNé¡¹ç›® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Gradleæ„å»ºä¸€ä¸ªSpring YARNé¡¹ç›® æµ‹è¯•YARNåº”ç”¨ç¨‹åº å­¦ä¹ å¦‚ä½•æµ‹è¯•ä¸€ä¸ªSpring YARNåº”ç”¨ç¨‹åº æ¶ˆè´¹SOAP webæœåŠ¡ å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªä½¿ç”¨æ¶ˆè´¹åŸºäºWSDLæœåŠ¡çš„å®¢æˆ·ç«¯ ä½¿ç”¨RESTè®¿é—®MongoDBæ•°æ® å­¦ä¹ å¦‚ä½•ä½¿ç”¨Spring Data RESTæ¥å¤„ç†åŸºäºRESTfulçš„ã€åŸºäºè¶…åª’ä½“çš„æŒä¹…æ€§æ•°æ®ã€‚ ç®€å•YARNåº”ç”¨ å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„Spring YARNåº”ç”¨ç¨‹åº Spring Bootä¸Docker å­¦ä¹ å¦‚ä½•ä½¿ç”¨Mavenæˆ–Gradleä»Spring Bootåº”ç”¨ç¨‹åºä¸­åˆ›å»ºDockerå®¹å™¨ æœåŠ¡æ³¨å†Œå’Œå‘ç° å­¦ä¹ ä½¿ç”¨Eurekaå¦‚ä½•æ³¨å†Œå¹¶æ‰¾åˆ°æœåŠ¡ æ–­è·¯å™¨ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Hystrixä¼˜é›…é™çº§æœåŠ¡ MySQLè®¿é—®æ•°æ® å­¦ä¹ å¦‚ä½•åœ¨MySQLä¸­è®¾ç½®å’Œç®¡ç†ç”¨æˆ·å¸æˆ·ï¼Œä»¥åŠå¦‚ä½•é…ç½®Spring Bootä»¥åœ¨è¿è¡Œæ—¶è¿æ¥åˆ°å®ƒã€‚ å±€éƒ¨æŒ‡å—åœ¨ä¸€å°æ—¶æˆ–æ›´çŸ­çš„æ—¶é—´å†…ï¼Œè¢«è®¾è®¡æˆé˜…è¯»å’Œç†è§£ï¼Œæä¾›æ¯”å…¥é—¨æŒ‡å—æ›´å¹¿æ³›æˆ–æ›´ä¸»è§‚çš„å†…å®¹ã€‚ Springå®‰å…¨æ¶æ„ å…³äºSpring Securityçš„å±€éƒ¨æŒ‡å—ï¼Œè¿™äº›ä½æ˜¯å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·çš„ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•ä¸Spring Bootäº¤äº’ æ•™ç¨‹è¿™äº›æŒ‡å—å°†åœ¨2-3ä¸ªå°æ—¶å†…å®Œæˆï¼Œè¿™äº›æŒ‡å—æä¾›äº†ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘ä¸»é¢˜çš„æ›´æ·±å…¥çš„ã€ä¸Šä¸‹æ–‡ç›¸å…³çš„æ¢ç´¢ï¼Œè®©æ‚¨å‡†å¤‡å¥½å®ç°å®é™…çš„è§£å†³æ–¹æ¡ˆã€‚ ä½¿ç”¨Springæ„å»ºRESTæœåŠ¡ å­¦ä¹ å¦‚ä½•ä½¿ç”¨Springè½»æ¾æ„å»ºã€æµ‹è¯•å’Œå®‰å…¨çš„RESTfulæœåŠ¡ Spring Bootå’ŒOAuth2 å…³äºFacebookå’ŒGithubçš„â€œç¤¾äº¤â€ç™»å½•å’Œå•ç™»å½•çš„æ•™ç¨‹ Spring Securityå’ŒAngular å…³äºå¦‚ä½•ä½¿ç”¨å¸¦æœ‰å„ç§åç«¯ä½“ç³»ç»“æ„çš„å•ä¸€é¡µé¢åº”ç”¨ç¨‹åºæ¥ä½¿ç”¨Springå®‰å…¨æ€§çš„æ•™ç¨‹ï¼Œä»ç®€å•çš„å•ä¸€æœåŠ¡å™¨åˆ°å¸¦æœ‰OAuth2èº«ä»½éªŒè¯çš„APIç½‘å…³ã€‚ React.jså’ŒSpring Data REST 5ä¸ªåšå®¢ç³»åˆ—çš„æ•™ç¨‹","categories":[{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"æŒ‡å—","slug":"Spring/æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Spring/æŒ‡å—/"}],"tags":[{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"}]},{"title":"oneM2M æŠ€æœ¯è§„èŒƒ","slug":"oneM2M-æŠ€æœ¯è§„èŒƒ","date":"2017-05-03T04:18:05.000Z","updated":"2020-07-25T02:57:18.224Z","comments":true,"path":"2017/05/03/oneM2M-æŠ€æœ¯è§„èŒƒ/","link":"","permalink":"https://jigangduan.github.io/2017/05/03/oneM2M-æŠ€æœ¯è§„èŒƒ/","excerpt":"å®˜ç½‘ åŸæ–‡åœ°å€ æ–‡æ¡£ç¼–å· TS-0001-V2.10.0 æ–‡æ¡£æ ‡é¢˜ åŠŸèƒ½æ¶æ„ æ—¥æœŸ 2016 - 8æœˆ30æ—¥ æ‘˜è¦: è¿™ç¯‡æ–‡æ¡£è¯¦ç»†è¯´æ˜oneM2MæœåŠ¡å¹³å°çš„åŠŸèƒ½ä½“ç³»ç»“æ„ã€‚ (æ­¤ç‰ˆæœ¬æ–‡æ¡£æ˜¯ TS-0001-V2.9.1çš„å‡çº§ï¼ŒåŒ…å«â€œç»´æŠ¤â€å’Œâ€œæ ¡æ­£â€ ARC# 24ä¼šè®®) æœ¬è§„èŒƒä»…ä¾›oneM2Må†…æœªæ¥å‘å±•å·¥ä½œã€‚åˆä½œä¼™ä¼´æ¥å—ä¸è´£ä»»å¯¹äºä»»ä½•ä½¿ç”¨æœ¬è§„èŒƒã€‚ å½“å‰æ–‡æ¡£æ²¡æœ‰å—åˆ°ä»»ä½•å®¡æ‰¹ç¨‹åºç”±oneM2Mä¼™ä¼´1å‹ã€‚å‘è¡¨oneM2Mè§„èŒƒå®æ–½å’ŒæŠ¥å‘Šåº”é€šè¿‡oneM2Mè·å¾—åˆä½œä¼™ä¼´çš„å‡ºç‰ˆç‰©çš„åŠå…¬å®¤ã€‚","text":"å®˜ç½‘ åŸæ–‡åœ°å€ æ–‡æ¡£ç¼–å· TS-0001-V2.10.0 æ–‡æ¡£æ ‡é¢˜ åŠŸèƒ½æ¶æ„ æ—¥æœŸ 2016 - 8æœˆ30æ—¥ æ‘˜è¦: è¿™ç¯‡æ–‡æ¡£è¯¦ç»†è¯´æ˜oneM2MæœåŠ¡å¹³å°çš„åŠŸèƒ½ä½“ç³»ç»“æ„ã€‚ (æ­¤ç‰ˆæœ¬æ–‡æ¡£æ˜¯ TS-0001-V2.9.1çš„å‡çº§ï¼ŒåŒ…å«â€œç»´æŠ¤â€å’Œâ€œæ ¡æ­£â€ ARC# 24ä¼šè®®) æœ¬è§„èŒƒä»…ä¾›oneM2Må†…æœªæ¥å‘å±•å·¥ä½œã€‚åˆä½œä¼™ä¼´æ¥å—ä¸è´£ä»»å¯¹äºä»»ä½•ä½¿ç”¨æœ¬è§„èŒƒã€‚ å½“å‰æ–‡æ¡£æ²¡æœ‰å—åˆ°ä»»ä½•å®¡æ‰¹ç¨‹åºç”±oneM2Mä¼™ä¼´1å‹ã€‚å‘è¡¨oneM2Mè§„èŒƒå®æ–½å’ŒæŠ¥å‘Šåº”é€šè¿‡oneM2Mè·å¾—åˆä½œä¼™ä¼´çš„å‡ºç‰ˆç‰©çš„åŠå…¬å®¤ã€‚ å…³äºoneM2MoneM2Mçš„ç›®çš„å’Œç›®æ ‡æ˜¯å¼€å‘æŠ€æœ¯è§„èŒƒå¤„ç†éœ€è¦ä¸€ä¸ªå…±åŒçš„M2Må¾ˆå®¹æ˜“åµŒå…¥åˆ°å„ç§æœåŠ¡å±‚ç¡¬ä»¶å’Œè½¯ä»¶,å¹¶ä¾é è¿æ¥å„ç§è®¾å¤‡é¢†åŸŸM2Måº”ç”¨æœåŠ¡å™¨ã€‚ æ›´å¤šä¿¡æ¯oneM2Må¯èƒ½å‘ç°:http / / www.oneM2M.org 1. èŒƒå›´æœ¬æ–‡æ¡£æè¿°äº†ç«¯åˆ°ç«¯oneM2MåŠŸèƒ½ä½“ç³»ç»“æ„,åŒ…æ‹¬çš„æè¿°åŠŸèƒ½å®ä½“å’Œç›¸å…³çš„å‚è€ƒç‚¹ã€‚ oneM2MåŠŸèƒ½ä½“ç³»ç»“æ„ä¾§é‡äºæœåŠ¡å±‚æ–¹é¢,æ½œåœ¨çš„ç½‘ç»œè§†å›¾ç«¯åˆ°ç«¯æœåŠ¡ã€‚åº•å±‚ç½‘ç»œç”¨äºä¼ è¾“æ•°æ®å’Œæ½œåœ¨çš„å…¶ä»–æœåŠ¡ã€‚ 2. å¼•ç”¨2.1. å¼•ç”¨æ ‡å‡†ä»¥ä¸‹å¼•ç”¨æ–‡æ¡£æ˜¯å½“å‰æ–‡æ¡£çš„åº”ç”¨ç¨‹åºæ‰€å¿…éœ€çš„ã€‚ [1] oneM2M TS-0011: â€œå¸¸è§æœ¯è¯­â€. [2] oneM2M TS-0003: â€œ å®‰å…¨è§£å†³æ–¹æ¡ˆâ€. [3] oneM2M TS-0004: â€œæ ¸å¿ƒæœåŠ¡å±‚åè®®è§„èŒƒâ€. [4] W3C RDF 1.1 æ¦‚å¿µå’ŒæŠ½è±¡è¯­æ³•. [5] W3C SPARQL 1.1 æŸ¥è¯¢è¯­è¨€. [6] oneM2M TS-0012: â€œoneM2M åŸºç¡€æœ¬ä½“è®ºâ€. [7] oneM2M TS-0021: â€œoneM2M AllJoynäº’ç›¸é…åˆâ€. [8] oneM2M TS-0023: â€œå®¶ç”µä¿¡æ¯æ¨¡å‹å’Œæ˜ å°„â€. 2.2. æœ‰ç›Šçš„å‚è€ƒä»¥ä¸‹å¼•ç”¨æ–‡æ¡£ä¸æ˜¯å½“å‰æ–‡æ¡£çš„åº”ç”¨ç¨‹åºæ‰€å¿…éœ€çš„ä½†ä»–ä»¬ååŠ©ç”¨æˆ·å¯¹ç‰¹å®šä¸»é¢˜é¢†åŸŸã€‚ [i.1] oneM2M TS-0002: â€œéœ€æ±‚â€. [i.2] Broadband Forum TR-069: â€œCPEå¹¿åŸŸç½‘ç®¡ç†åè®®é—®é¢˜â€: 1 ä¿®æ”¹ 5æ—¥11æœˆ2013å¹´ [i.3] OMA-DM: â€œOMAè®¾å¤‡ç®¡ç†åè®®â€, 1.3ç‰ˆæœ¬,å¼€æ”¾ç§»åŠ¨è”ç›Ÿ. [i.4] LWM2M: â€œOMA LightweightM2Mâ€, 1.0ç‰ˆæœ¬,å¼€æ”¾ç§»åŠ¨è”ç›Ÿ. [i.5] OMA-TS-MLP-V3-4-20130226-C: â€œç§»åŠ¨ä½ç½®åè®®â€, 3.4ç‰ˆ. [i.6] OMA-TS-REST-NetAPI_TerminalLocation-V1_0-20130924-A: â€œç½‘ç»œRESTful APIç»ˆç«¯ä½ç½®â€, 1.0ç‰ˆ. [i.7] IETF RFC 1035: â€œåŸŸå-å®æ–½å’Œè§„èŒƒâ€. [i.8] IETF RFC 3588: â€œç›´å¾„åŸºæœ¬åè®®â€. [i.9] IETF RFC 3596: â€œDNSæ‰©å±•æ”¯æŒIPv6â€. [i.10] IETF RFC 3986: â€œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦(URI):ä¸€èˆ¬è¯­æ³•â€. [i.11] IETF RFC 4006: â€œç›´å¾„ä¸€äº›æ§åˆ¶ä¿¡è´·å¢é•¿çš„åº”ç”¨ç¨‹åºâ€. [i.12] IETF RFC 6895: â€œåŸŸåç³»ç»Ÿ(DNS)IANAçš„è€ƒè™‘â€. [i.13] GSMA-IR.67: â€œDNS / ENUè¡¨ç¤ºæŒ‡å—æœåŠ¡æä¾›å•†&amp; GRX / IPXæä¾›è€…â€. [i.14] 3GPP TS 23.682: â€œAæ¶æ„å¢å¼ºä¿ƒè¿›ä¸åˆ†ç»„æ•°æ®é€šä¿¡ç½‘ç»œå’Œåº”ç”¨ç¨‹åº(13)å‘å¸ƒâ€. [i.15] ETSI TS 132 240: â€œæ•°å­—èœ‚çªé€šä¿¡ç³»ç»Ÿ(2 +é˜¶æ®µ);é€šç”¨ç§»åŠ¨é€šä¿¡ç³»ç»Ÿ(UMTS);LTEé€šä¿¡ç®¡ç†;å……ç”µå……ç”µç®¡ç†;ä½“ç³»ç»“æ„å’ŒåŸåˆ™(3 GPP TS 32.240)â€. [i.16] ETSI TS 132 299: â€œæ•°å­—èœ‚çªé€šä¿¡ç³»ç»Ÿ(2 +é˜¶æ®µ);é€šç”¨ç§»åŠ¨é€šä¿¡ç³»ç»Ÿ(UMTS);LTEé€šä¿¡ç®¡ç†;å……ç”µç®¡ç†;ç›´å¾„æ”¶è´¹åº”ç”¨ç¨‹åº(3 GPP TS 32.299)â€. [i.17] 3GPP2 .S0068: â€œç½‘ç»œå¢å¼ºçš„æœºå™¨å¯¹æœºå™¨(M2M)â€.[i.18] JNI 6.0 API è§„èŒƒ: â€œJava Native Interface 6.0è§„èŒƒâ€. [i.19] 3GPP TS 23.401: â€œé€šç”¨åˆ†ç»„æ— çº¿æœåŠ¡(GPRS)ä¸ºå‘å±•æ™®éå¢å¼ºé™†åœ°æ— çº¿æ¥å…¥ç½‘(E-UTRAN)è®¿é—®â€. [i.20] 3GPP TS 23.402: â€œnon-3GPPè®¿é—®æ¶æ„å¢å¼ºâ€. [i.21] 3GPP TS 23.060: â€œé€šç”¨åˆ†ç»„æ— çº¿ä¸šåŠ¡(GPRS);æœåŠ¡æè¿°;ç¬¬äºŒé˜¶æ®µâ€. [i.22] 3GPP TS 22.368: â€œæœºå™¨ç±»å‹é€šä¿¡æœåŠ¡éœ€æ±‚(MTC);1é˜¶æ®µâ€. [i.23] 3GPP TS 23.003: â€œç¼–å·ã€å¯»å€å’Œè¯†åˆ«â€. [i.24] Recommendation ITU-T X.660 | ISO/IEC 9834-1: â€œä¿¡æ¯æŠ€æœ¯â€”â€”ç¨‹åºæ“ä½œå¯¹è±¡æ ‡è¯†ç¬¦çš„ç™»è®°æœºå…³:ä¸€èˆ¬ç¨‹åºå’Œé¡¶çº§çš„å¼§çº¿å›½é™…æ ‘å¯¹è±¡æ ‡è¯†ç¬¦â€. [i.25] oneM2M TR-0008: â€œåˆ†æoneM2Må®‰å…¨è§£å†³æ–¹æ¡ˆçš„ç³»ç»Ÿâ€. [i.26] IETF RFC 4122: â€œä¸€ä¸ªå…¨å±€æƒŸä¸€çš„æ ‡è¯†ç¬¦(UUID)ç¼¸åç§°ç©ºé—´â€. [i.27] oneM2M èµ·è‰è§„åˆ™.æ³¨æ„: Available at http://www.onem2m.org/images/files/oneM2M-Drafting-Rules.pdf [i.28] oneM2M TR-0007: â€œæŠ½è±¡å’Œè¯­ä¹‰æ”¯æŒçš„ç ”ç©¶â€. [i.29] 3GPP TS 22.101: æœåŠ¡æ–¹é¢,æœåŠ¡åŸåˆ™(å‘å¸ƒ13). [i.30] 3GPP TS 22.115: æœåŠ¡æ–¹é¢;å……ç”µå’Œè®¡è´¹(å‘å¸ƒ13). [i.31] 3GPP TS 29.336: å®¶åº­ç”¨æˆ·æœåŠ¡å™¨(HSS)ç›´å¾„æ¥å£ä¸æ•°æ®åŒ…äº¤äº’å·¥ä½œæ•°æ®ç½‘ç»œå’Œåº”ç”¨ç¨‹åºå‘å¸ƒ(13). [i.32] OMA-TS-REST-NetAPI-CommunicationPatterns-V1-0: â€˜â€œç½‘ç»œRESTful APIé€šä¿¡æ¨¡å¼â€™â€, 1.0ç‰ˆæœ¬å¼€æ”¾ç§»åŠ¨è”ç›Ÿ. 3. å®šä¹‰å’Œç¼©å†™3.1 å®šä¹‰æœ¬æ–‡æ¡£çš„ç›®çš„,ä¸‹åˆ—æœ¯è¯­å’Œå®šä¹‰é€‚ç”¨: è®¿é—®æ§åˆ¶å±æ€§:å‘èµ·äººè®¾ç½®çš„å‚æ•°,ç›®æ ‡èµ„æºå’Œç¯å¢ƒçš„å¯ä»¥è®¿é—®æ§åˆ¶è§„åˆ™è¯„ä¼° è®¿é—®å†³å®š:æˆæƒè¾¾åˆ°å½“ä¸€ä¸ªå®ä½“çš„ç‰¹æƒ,ä»¥åŠå…¶ä»–è®¿é—®æ§åˆ¶å±æ€§è¯„ä¼° åº”ç”¨ç¨‹åºå±‚:åŒ…æ‹¬oneM2Måº”ç”¨ç¨‹åºå’Œç›¸å…³çš„ä¸šåŠ¡å’Œæ“ä½œé€»è¾‘ å±æ€§:å­˜å‚¨æœ‰å…³çš„ä¿¡æ¯èµ„æº å…¬å…±æœåŠ¡å±‚:ç”±oneM2MæœåŠ¡åŠŸèƒ½,ä½¿oneM2Måº”ç”¨ç¨‹åº(ä¾‹å¦‚,ç®¡ç†,å‘ç°å’Œç­–ç•¥æ‰§è¡Œ) å…¬å…±æœåŠ¡åŠŸèƒ½(CSF):ä¿¡æ¯ä½“ç³»ç»“æ„æ„é€ çš„æ¦‚å¿µç»„ç»‡åœ¨ä¸€èµ·çš„é¡¹å­åŠŸèƒ½ åŸºäºå†…å®¹çš„å‘ç°:å‘ç°æ“ä½œèµ„æºç›¸åŒ¹é…çš„æ¡ä»¶æœ‰å…³å†…å®¹å±æ€§çš„&lt; contentInstance&gt;èµ„æºåœ¨ç‰¹å®š&lt;å®¹å™¨&gt; æ‰§è¡Œç¯å¢ƒ:é€»è¾‘å®ä½“,ä»£è¡¨ä¸€ä¸ªç¯å¢ƒèƒ½å¤Ÿè¿è¡Œè½¯ä»¶æ¨¡å— æ‰˜ç®¡CSE:CSEè§£å†³èµ„æºæ‰˜ç®¡ M2MæœåŠ¡æä¾›è€…åŸŸ:M2Mç³»ç»Ÿçš„ä¸€éƒ¨åˆ†,ä¸ä¸€ä¸ªç‰¹å®šçš„M2MæœåŠ¡æä¾›è€… æ‰˜ç®¡å®ä½“:å¯ä»¥æ˜¯ä¸€ä¸ªM2Mè£…ç½®,M2Mç½‘å…³,æˆ–M2MåŒºåŸŸç½‘ç»œè®¾å¤‡æˆ–M2Måº”ç”¨ç¨‹åºå±‚æˆ–M2MæœåŠ¡å±‚çš„è½¯ä»¶ç»„ä»¶ ç®¡ç†ä»£ç†:å®ä½“å†…çš„è®¾å¤‡ç®¡ç†æ¶æ„,ç»“åˆç®¡ç†å®¢æˆ·ç«¯,ä¹‹é—´å……å½“ä¸­ä»‹ç®¡ç†æœåŠ¡å™¨å’Œä»£ç†ç®¡ç†å®¢æˆ·ç«¯ ç½‘ç»œæœåŠ¡å±‚:æä¾›è¿è¾“ã€è¿æ¥å’ŒæœåŠ¡åŠŸèƒ½ èŠ‚ç‚¹:M2Mç³»ç»Ÿå¯è¯†åˆ«çš„é€»è¾‘å®ä½“ non-oneM2MèŠ‚ç‚¹:èŠ‚ç‚¹ä¸åŒ…å«oneM2Må®ä½“ é€šçŸ¥:æ‰˜ç®¡CSEå¯åŠ¨é€šçŸ¥é€šçŸ¥è®¢é˜…/é€šçŸ¥æ¡†æ¶æˆ–ç›®æ ‡éé˜»å¡asynchoronousæ–¹æ¡ˆ é€šçŸ¥ç›®æ ‡:æ˜¯ä¸€ä¸ªAEæˆ–CSEæ¥æ”¶é€šçŸ¥çš„é€šçŸ¥","categories":[],"tags":[]},{"title":"è¿œå’Œè¿‘","slug":"è¿œå’Œè¿‘","date":"2017-04-05T04:37:51.000Z","updated":"2020-07-25T02:57:18.236Z","comments":true,"path":"2017/04/05/è¿œå’Œè¿‘/","link":"","permalink":"https://jigangduan.github.io/2017/04/05/è¿œå’Œè¿‘/","excerpt":"","text":"ä½ ï¼Œ ä¸€ä¼šå„¿çœ‹æˆ‘ï¼Œ ä¸€ä¼šå„¿çœ‹äº‘ã€‚ æˆ‘è§‰å¾—ï¼Œ ä½ çœ‹æˆ‘æ—¶å¾ˆè¿œï¼Œ ä½ çœ‹äº‘æ—¶å¾ˆè¿‘ã€‚","categories":[{"name":"é¡¾åŸ","slug":"é¡¾åŸ","permalink":"https://jigangduan.github.io/categories/é¡¾åŸ/"}],"tags":[{"name":"è¯—","slug":"è¯—","permalink":"https://jigangduan.github.io/tags/è¯—/"},{"name":"é¡¾åŸ","slug":"é¡¾åŸ","permalink":"https://jigangduan.github.io/tags/é¡¾åŸ/"}]},{"title":"å°å··","slug":"å°å··","date":"2017-04-05T04:25:02.000Z","updated":"2020-07-25T02:57:18.236Z","comments":true,"path":"2017/04/05/å°å··/","link":"","permalink":"https://jigangduan.github.io/2017/04/05/å°å··/","excerpt":"","text":"å°å·· åˆå¼¯åˆé•¿ æ²¡æœ‰é—¨ æ²¡æœ‰çª— ä½ æ‹¿æŠŠæ—§é’¥åŒ™ æ•²ç€åšåšçš„å¢™","categories":[{"name":"é¡¾åŸ","slug":"é¡¾åŸ","permalink":"https://jigangduan.github.io/categories/é¡¾åŸ/"}],"tags":[{"name":"è¯—","slug":"è¯—","permalink":"https://jigangduan.github.io/tags/è¯—/"},{"name":"é¡¾åŸ","slug":"é¡¾åŸ","permalink":"https://jigangduan.github.io/tags/é¡¾åŸ/"}]},{"title":"Hexo","slug":"hello-world.1","date":"2017-03-25T04:26:28.000Z","updated":"2020-07-25T02:57:18.207Z","comments":true,"path":"2017/03/25/hello-world.1/","link":"","permalink":"https://jigangduan.github.io/2017/03/25/hello-world.1/","excerpt":"","text":"æ¬¢è¿ä½¿ç”¨ Hexo! è¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªå¸–å­. æŸ¥çœ‹ æ–‡æ¡£ äº†è§£æ›´å¤šä¿¡æ¯. å¦‚æœä½ åœ¨ä½¿ç”¨Hexoæ—¶æœ‰ä»»ä½•é—®é¢˜, ä½ å¯ä»¥åœ¨è¿™å„¿æ•…éšœæ’é™¤ æˆ–è®¿é—® GitHubæ‰¾åˆ°ç­”æ¡ˆ. å¿«é€Ÿå…¥é—¨åˆ›å»ºä¸€ä¸ªæ–°å¸–å­1$ hexo new \"My New Post\" æ›´å¤šä¿¡æ¯: å†™ä½œ è¿è¡ŒæœåŠ¡å™¨1$ hexo server æ›´å¤šä¿¡æ¯: Server ç”Ÿæˆé™æ€æ–‡ä»¶1$ hexo generate æ›´å¤šä¿¡æ¯: ç”Ÿæˆ éƒ¨ç½²åˆ°è¿œç¨‹ç«™ç‚¹1$ hexo deploy æ›´å¤šä¿¡æ¯: éƒ¨ç½²","categories":[],"tags":[]},{"title":"Jade - æ¨¡æ¿å¼•æ“","slug":"jade","date":"2017-03-25T04:26:28.000Z","updated":"2020-07-25T02:57:18.209Z","comments":true,"path":"2017/03/25/jade/","link":"","permalink":"https://jigangduan.github.io/2017/03/25/jade/","excerpt":"Jade - æ¨¡æ¿å¼•æ“Jade æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒæ·±å— Haml å½±å“ï¼Œå®ƒæ˜¯ç”¨ JavaScript å®ç°çš„, å¹¶ä¸”å¯ä»¥ä¾› Node ä½¿ç”¨. ç¿»è¯‘: è‰ä¾å±± ç­‰","text":"Jade - æ¨¡æ¿å¼•æ“Jade æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒæ·±å— Haml å½±å“ï¼Œå®ƒæ˜¯ç”¨ JavaScript å®ç°çš„, å¹¶ä¸”å¯ä»¥ä¾› Node ä½¿ç”¨. ç¿»è¯‘: è‰ä¾å±± ç­‰ å£°æ˜ä» Jade v0.31.0 å¼€å§‹æ”¾å¼ƒäº†å¯¹äº &lt;script&gt; å’Œ &lt;style&gt; æ ‡ç­¾çš„å¹³æ–‡æœ¬æ”¯æŒ. è¿™ä¸ªé—®é¢˜ä½ å¯ä»¥åœ¨ &lt;script&gt; &lt;style&gt; æ ‡ç­¾ååŠ ä¸Š . æ¥è§£å†³. å¸Œæœ›è¿™ä¸€ç‚¹èƒ½è®© Jade å¯¹æ–°æ‰‹æ›´å‹å¥½, åŒæ—¶ä¹Ÿä¸å½±å“åˆ° Jade æœ¬èº«çš„èƒ½åŠ›æˆ–è€…å¯¼è‡´è¿‡åº¦å†—é•¿. å¦‚æœä½ æœ‰å¤§é‡çš„æ–‡ä»¶éœ€è¦è½¬æ¢ä½ å¯ä»¥ç”¨ä¸‹ fix-jade å°è¯•è‡ªåŠ¨å®Œæˆè¿™ä¸ªè¿‡ç¨‹. Test driveä½ å¯ä»¥åœ¨ç½‘ä¸Šè¯•ç© Jade. README ç›®å½• ç‰¹æ€§ å…¶å®ƒå®ç° å®‰è£… æµè§ˆå™¨æ”¯æŒ å…¬å¼€ API è¯­æ³• è¡Œç»“æŸæ ‡å¿— æ ‡ç­¾ æ ‡ç­¾æ–‡æœ¬ æ³¨é‡Š å—æ³¨é‡Š å†…è” å—å±•å¼€ Case å±æ€§ HTML Doctypes è¿‡æ»¤å™¨ ä»£ç  å¾ªç¯ æ¡ä»¶è¯­å¥ æ¨¡æ¿ç»§æ‰¿ Block append/prepend åŒ…å« Mixins äº§ç”Ÿè¾“å‡º Makefile çš„ä¸€ä¸ªä¾‹å­ å‘½ä»¤è¡Œçš„ Jade æ•™ç¨‹ License ç‰¹æ€§ å®¢æˆ·ç«¯æ”¯æŒ ä»£ç é«˜å¯è¯» çµæ´»çš„ç¼©è¿› å—å±•å¼€ Mixins é™æ€åŒ…å« å±æ€§æ”¹å†™ å®‰å…¨ï¼Œé»˜è®¤ä»£ç æ˜¯è½¬ä¹‰çš„ è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶ä¸Šä¸‹æ–‡é”™è¯¯æŠ¥å‘Š å‘½ä»¤è¡Œä¸‹ç¼–è¯‘jadeæ¨¡æ¿ HTML5 æ¨¡å¼ (ä½¿ç”¨ !!! 5 doctype html æ–‡æ¡£ç±»å‹) åœ¨å†…å­˜ä¸­ç¼“å­˜(å¯é€‰) åˆå¹¶åŠ¨æ€å’Œé™æ€æ ‡ç­¾ç±» å¯ä»¥é€šè¿‡ filters ä¿®æ”¹æ ‘ æ¨¡æ¿ç»§æ‰¿ åŸç”Ÿæ”¯æŒ Express JS é€šè¿‡ each æšä¸¾å¯¹è±¡ã€æ•°ç»„ç”šè‡³æ˜¯ä¸èƒ½æšä¸¾çš„å¯¹è±¡ å—æ³¨é‡Š æ²¡æœ‰å‰ç¼€çš„æ ‡ç­¾ AST Filters è¿‡æ»¤å™¨ :stylus å¿…é¡»å·²ç»å®‰è£… stylus :less å¿…é¡»å·²ç»å®‰è£… less.js :markdown å¿…é¡»å·²ç»å®‰è£… markdown-js æˆ–è€… node-discount :cdata :coffeescript å¿…é¡»å·²ç»å®‰è£…coffee-script Emacs Mode Vim Syntax TextMate Bundle Coda/SubEtha syntax Mode Screencasts html2jade converter å…¶å®ƒå®ç° php scala ruby python java å®‰è£…é€šè¿‡ NPM: 1npm install jade æµè§ˆå™¨æ”¯æŒæŠŠ Jade ç¼–è¯‘ä¸ºä¸€ä¸ªå¯ä¾›æµè§ˆå™¨ä½¿ç”¨çš„å•æ–‡ä»¶ï¼Œåªéœ€è¦ç®€å•çš„æ‰§è¡Œ: 1$ make jade.js å¦‚æœä½ å·²ç»å®‰è£…äº† uglifyjs (npm install uglify-js)ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®ƒä¼šç”Ÿæˆæ‰€æœ‰çš„æ–‡ä»¶ã€‚å…¶å®æ¯ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬é‡Œéƒ½å¸®ä½ åšäº†è¿™äº‹ã€‚ 1make jade.min.js é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•Jadeä¼šæŠŠæ¨¡æ¿ç»„ç»‡æˆå¸¦æœ‰å½¢å¦‚ __.lineno = 3 çš„è¡Œå·çš„å½¢å¼ã€‚åœ¨æµè§ˆå™¨é‡Œä½¿ç”¨çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªé€‰é¡¹ { compileDebug: false } æ¥å»æ‰è¿™ä¸ªã€‚ä¸‹é¢çš„æ¨¡æ¿ 1p Hello #&#123;name&#125; ä¼šè¢«ç¿»è¯‘æˆä¸‹é¢çš„å‡½æ•°ï¼š 12345678function anonymous(locals, attrs, escape, rethrow) &#123; var buf = []; with (locals || &#123;&#125;) &#123; var interp; buf.push('\\n&lt;p&gt;Hello ' + escape((interp = name) == null ? '' : interp) + '\\n&lt;/p&gt;'); &#125; return buf.join(\"\");&#125; é€šè¿‡ä½¿ç”¨ Jade çš„ ./runtime.jsä½ å¯ä»¥åœ¨æµè§ˆå™¨ä½¿ç”¨è¿™äº›é¢„ç¼–è¯‘çš„æ¨¡æ¿è€Œä¸éœ€è¦ä½¿ç”¨ Jade, ä½ åªéœ€è¦ä½¿ç”¨ runtime.js é‡Œçš„å·¥å…·å‡½æ•°, å®ƒä»¬ä¼šæ”¾åœ¨ jade.attrs, jade.escape è¿™äº›é‡Œã€‚ æŠŠé€‰é¡¹ { client: true } ä¼ é€’ç»™ jade.compile(), Jade ä¼šæŠŠè¿™äº›å¸®åŠ©å‡½æ•°çš„å¼•ç”¨æ”¾åœ¨jade.attrs, jade.escape. 123456789function anonymous(locals, attrs, escape, rethrow) &#123; var attrs = jade.attrs, escape = jade.escape, rethrow = jade.rethrow; var buf = []; with (locals || &#123;&#125;) &#123; var interp; buf.push('\\n&lt;p&gt;Hello ' + escape((interp = name) == null ? '' : interp) + '\\n&lt;/p&gt;'); &#125; return buf.join(\"\");&#125; å…¬å¼€ API12345var jade = require('jade');// Compile a functionvar fn = jade.compile('string of jade', options);fn(locals); é€‰é¡¹ self ä½¿ç”¨ self å‘½åç©ºé—´æ¥æŒæœ‰æœ¬åœ°å˜é‡. (é»˜è®¤ä¸º false) locals æœ¬åœ°å˜é‡å¯¹è±¡ filename å¼‚å¸¸å‘ç”Ÿæ—¶ä½¿ç”¨ï¼Œincludes æ—¶å¿…éœ€ debug è¾“å‡º token å’Œç¿»è¯‘åçš„å‡½æ•°ä½“ compiler æ›¿æ¢æ‰ jade é»˜è®¤çš„ç¼–è¯‘å™¨ compileDebug falseçš„æ—¶å€™è°ƒè¯•çš„ç»“æ„ä¸ä¼šè¢«è¾“å‡º pretty ä¸ºè¾“å‡ºåŠ ä¸Šäº†æ¼‚äº®çš„ç©ºæ ¼ç¼©è¿› (é»˜è®¤ä¸º false) è¯­æ³• è¡Œç»“æŸæ ‡å¿—CRLF å’Œ CR ä¼šåœ¨ç¼–è¯‘ä¹‹å‰è¢«è½¬æ¢ä¸º LF æ ‡ç­¾æ ‡ç­¾å°±æ˜¯ä¸€ä¸ªç®€å•çš„å•è¯: 1html å®ƒä¼šè¢«è½¬æ¢ä¸º &lt;html&gt;&lt;/html&gt; æ ‡ç­¾ä¹Ÿæ˜¯å¯ä»¥æœ‰ id çš„: 1div#container å®ƒä¼šè¢«è½¬æ¢ä¸º &lt;div id=&quot;container&quot;&gt;&lt;/div&gt; æ€ä¹ˆåŠ  class å‘¢ï¼Ÿ 1div.user-details è½¬æ¢ä¸º &lt;div class=&quot;user-details&quot;&gt;&lt;/div&gt; å¤šä¸ª class å’Œ id? ä¹Ÿæ˜¯å¯ä»¥æå®šçš„: div#foo.bar.baz è½¬æ¢ä¸º &lt;div id=&quot;foo&quot; class=&quot;bar baz&quot;&gt;&lt;/div&gt; ä¸åœçš„ div div div å¾ˆè®¨åŒå•Š , å¯ä»¥è¿™æ ·: 12#foo.bar è¿™ä¸ªç®—æ˜¯æˆ‘ä»¬çš„è¯­æ³•ç³–ï¼Œå®ƒå·²ç»è¢«å¾ˆå¥½çš„æ”¯æŒäº†ï¼Œä¸Šé¢çš„ä¼šè¾“å‡ºï¼š 1&lt;div id=\"foo\"&gt;&lt;/div&gt;&lt;div class=\"bar\"&gt;&lt;/div&gt; æ ‡ç­¾æ–‡æœ¬åªéœ€è¦ç®€å•çš„æŠŠå†…å®¹æ”¾åœ¨æ ‡ç­¾ä¹‹åï¼š 1p wahoo! å®ƒä¼šè¢«æ¸²æŸ“ä¸º &lt;p&gt;wahoo!&lt;/p&gt;. å¾ˆå¸…å§ï¼Œä½†æ˜¯å¤§æ®µçš„æ–‡æœ¬æ€ä¹ˆåŠå‘¢ï¼š 12345p | foo bar baz | rawr rawr | super cool | go jade go æ¸²æŸ“ä¸º &lt;p&gt;foo bar baz rawr.....&lt;/p&gt; æ€ä¹ˆå’Œæ•°æ®ç»“åˆèµ·æ¥ï¼Ÿ æ‰€æœ‰ç±»å‹çš„æ–‡æœ¬å±•ç¤ºéƒ½å¯ä»¥å’Œæ•°æ®ç»“åˆèµ·æ¥ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ { name: &#39;tj&#39;, email: &#39;tj@vision-media.ca&#39; } ä¼ ç»™ç¼–è¯‘å‡½æ•°ï¼Œä¸‹é¢æ˜¯æ¨¡æ¿ä¸Šçš„å†™æ³•: 1#user #&#123;name&#125; &amp;lt;#&#123;email&#125;&amp;gt; å®ƒä¼šè¢«æ¸²æŸ“ä¸º &lt;div id=&quot;user&quot;&gt;tj &amp;lt;tj@vision-media.ca&amp;gt;&lt;/div&gt; å½“å°±æ˜¯è¦è¾“å‡º #{} çš„æ—¶å€™æ€ä¹ˆåŠ? è½¬ä¹‰ä¸€ä¸‹! p \\#{something} å®ƒä¼šè¾“å‡º &lt;p&gt;#{something}&lt;/p&gt; åŒæ ·å¯ä»¥ä½¿ç”¨éè½¬ä¹‰çš„å˜é‡ !{html}, ä¸‹é¢çš„æ¨¡æ¿å°†ç›´æ¥è¾“å‡ºä¸€ä¸ª &lt;script&gt; æ ‡ç­¾: 12- var html = &quot;&lt;script&gt;&lt;/script&gt;&quot;| !&#123;html&#125; å†…è”æ ‡ç­¾åŒæ ·å¯ä»¥ä½¿ç”¨æ–‡æœ¬å—æ¥åŒ…å«æ–‡æœ¬ï¼š 123label | Username: input(name=&apos;user[name]&apos;) æˆ–è€…ç›´æ¥ä½¿ç”¨æ ‡ç­¾æ–‡æœ¬: 12label Username: input(name=&apos;user[name]&apos;) _åª_ åŒ…å«æ–‡æœ¬çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ &lt;script&gt;, &lt;style&gt;, å’Œ &lt;textarea&gt; ä¸éœ€è¦å‰ç¼€ | å­—ç¬¦, æ¯”å¦‚: 123456789html head title Example script if (foo) &#123; bar(); &#125; else &#123; baz(); &#125; è¿™é‡Œè¿˜æœ‰ä¸€ç§é€‰æ‹©ï¼Œå¯ä»¥ä½¿ç”¨ . æ¥å¼€å§‹ä¸€æ®µæ–‡æœ¬å—ï¼Œæ¯”å¦‚ï¼š 123456p. foo asdf asdf asdfasdfaf asdf asd. ä¼šè¢«æ¸²æŸ“ä¸º: 1234567&lt;p&gt;foo asdfasdf asdfasdfaf asdfasd.&lt;/p&gt; è¿™å’Œå¸¦ä¸€ä¸ªç©ºæ ¼çš„ . æ˜¯ä¸ä¸€æ ·çš„, å¸¦ç©ºæ ¼çš„ä¼šè¢« Jade çš„è§£æå™¨å¿½ç•¥ï¼Œå½“ä½œä¸€ä¸ªæ™®é€šçš„æ–‡å­—: 1p . æ¸²æŸ“ä¸º: 1&lt;p&gt;.&lt;/p&gt; éœ€è¦æ³¨æ„çš„æ˜¯æ–‡æœ¬å—éœ€è¦ä¸¤æ¬¡è½¬ä¹‰ã€‚æ¯”å¦‚æƒ³è¦è¾“å‡ºä¸‹é¢çš„æ–‡æœ¬ï¼š 1&lt;p&gt;foo\\bar&lt;/p&gt; ä½¿ç”¨: 12p. foo\\\\bar æ³¨é‡Šå•è¡Œæ³¨é‡Šå’Œ JavaScript é‡Œæ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡ // æ¥å¼€å§‹ï¼Œå¹¶ä¸”å¿…é¡»å•ç‹¬ä¸€è¡Œï¼š 123// just some paragraphsp foop bar æ¸²æŸ“ä¸ºï¼š 123&lt;!-- just some paragraphs --&gt;&lt;p&gt;foo&lt;/p&gt;&lt;p&gt;bar&lt;/p&gt; Jade åŒæ ·æ”¯æŒä¸è¾“å‡ºçš„æ³¨é‡Šï¼ŒåŠ ä¸€ä¸ªçŸ­æ¨ªçº¿å°±è¡Œäº†ï¼š 123//- will not output within markupp foop bar æ¸²æŸ“ä¸ºï¼š 12&lt;p&gt;foo&lt;/p&gt;&lt;p&gt;bar&lt;/p&gt; å—æ³¨é‡Šå—æ³¨é‡Šä¹Ÿæ˜¯æ”¯æŒçš„ï¼š 1234body // #content h1 Example æ¸²æŸ“ä¸ºï¼š 1234567&lt;body&gt; &lt;!-- &lt;div id=\"content\"&gt; &lt;h1&gt;Example&lt;/h1&gt; &lt;/div&gt; --&gt;&lt;/body&gt; Jade åŒæ ·å¾ˆå¥½çš„æ”¯æŒäº†æ¡ä»¶æ³¨é‡Šï¼š 123body //if IE a(href=&apos;http://www.mozilla.com/en-US/firefox/&apos;) Get Firefox æ¸²æŸ“ä¸ºï¼š 12345&lt;body&gt; &lt;!--[if IE]&gt; &lt;a href=\"http://www.mozilla.com/en-US/firefox/\"&gt;Get Firefox&lt;/a&gt; &lt;![endif]--&gt;&lt;/body&gt; å†…è”Jade æ”¯æŒä»¥è‡ªç„¶çš„æ–¹å¼å®šä¹‰æ ‡ç­¾åµŒå¥—: 1234567ul li.first a(href=&apos;#&apos;) foo li a(href=&apos;#&apos;) bar li.last a(href=&apos;#&apos;) baz å—å±•å¼€å—å±•å¼€å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸€è¡Œå†…åˆ›å»ºåµŒå¥—çš„æ ‡ç­¾ï¼Œä¸‹é¢çš„ä¾‹å­å’Œä¸Šé¢çš„æ˜¯ä¸€æ ·çš„ï¼š 1234ul li.first: a(href=&apos;#&apos;) foo li: a(href=&apos;#&apos;) bar li.last: a(href=&apos;#&apos;) baz Casecase è¡¨è¾¾å¼æŒ‰ä¸‹é¢è¿™æ ·çš„å½¢å¼å†™: 12345678910html body friends = 10 case friends when 0 p you have no friends when 1 p you have a friend default p you have #&#123;friends&#125; friends å—å±•å¼€åœ¨è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨: 12345678friends = 5html body case friends when 0: p you have no friends when 1: p you have a friend default: p you have #&#123;friends&#125; friends å±æ€§Jade ç°åœ¨æ”¯æŒä½¿ç”¨ ( å’Œ ) ä½œä¸ºå±æ€§åˆ†éš”ç¬¦ 1a(href=&apos;/login&apos;, title=&apos;View login page&apos;) Login å½“ä¸€ä¸ªå€¼æ˜¯ undefined æˆ–è€… null å±æ€§ _ä¸_ ä¼šè¢«åŠ ä¸Š,æ‰€ä»¥å‘¢ï¼Œå®ƒä¸ä¼šç¼–è¯‘å‡º â€˜something=â€nullâ€â€˜. 1div(something=null) Boolean å±æ€§ä¹Ÿæ˜¯æ”¯æŒçš„: 1input(type=&quot;checkbox&quot;, checked) ä½¿ç”¨ä»£ç çš„ Boolean å±æ€§åªæœ‰å½“å±æ€§ä¸º true æ—¶æ‰ä¼šè¾“å‡ºï¼š 1input(type=&quot;checkbox&quot;, checked=someValue) å¤šè¡ŒåŒæ ·ä¹Ÿæ˜¯å¯ç”¨çš„ï¼š 123input(type=&apos;checkbox&apos;, name=&apos;agreement&apos;, checked) å¤šè¡Œçš„æ—¶å€™å¯ä»¥ä¸åŠ é€—å·ï¼š 123input(type=&apos;checkbox&apos; name=&apos;agreement&apos; checked) åŠ ç‚¹ç©ºæ ¼ï¼Œæ ¼å¼å¥½çœ‹ä¸€ç‚¹ï¼ŸåŒæ ·æ”¯æŒ 1234input( type=&apos;checkbox&apos; name=&apos;agreement&apos; checked) å†’å·ä¹Ÿæ˜¯æ”¯æŒçš„: 1rss(xmlns:atom=&quot;atom&quot;) å‡å¦‚æˆ‘æœ‰ä¸€ä¸ª user å¯¹è±¡ { id: 12, name: &#39;tobi&#39; }æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªæŒ‡å‘ /user/12 çš„é“¾æ¥ href, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ™®é€šçš„ JavaScript å­—ç¬¦ä¸²è¿æ¥ï¼Œå¦‚ä¸‹: 1a(href=&apos;/user/&apos; + user.id)= user.name æˆ–è€…æˆ‘ä»¬ä½¿ç”¨ Jade çš„ä¿®æ”¹æ–¹å¼, è¿™ä¸ªæˆ‘æƒ³å¾ˆå¤šä½¿ç”¨ Ruby æˆ–è€… CoffeeScript çš„äººä¼šçœ‹èµ·æ¥åƒæ™®é€šçš„ JS..: 1a(href=&apos;/user/#&#123;user.id&#125;&apos;)= user.name class å±æ€§æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œä½ å¯ä»¥ç›´æ¥ä¼ é€’ä¸€ä¸ªæ•°ç»„ï¼Œæ¯”å¦‚ bodyClasses = [&#39;user&#39;, &#39;authenticated&#39;] : 1body(class=bodyClasses) HTMLå†…è”çš„ HTML æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®¡é“å®šä¹‰ä¸€æ®µæ–‡æœ¬ : 1234html body | &lt;h1&gt;Title&lt;/h1&gt; | &lt;p&gt;foo bar baz&lt;/p&gt; æˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ . æ¥å‘Šè¯‰ Jade æˆ‘ä»¬éœ€è¦ä¸€æ®µæ–‡æœ¬ï¼š 1234html body. &lt;h1&gt;Title&lt;/h1&gt; &lt;p&gt;foo bar baz&lt;/p&gt; ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­éƒ½ä¼šæ¸²æŸ“æˆç›¸åŒçš„ç»“æœï¼š 123&lt;html&gt;&lt;body&gt;&lt;h1&gt;Title&lt;/h1&gt;&lt;p&gt;foo bar baz&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; è¿™æ¡è§„åˆ™é€‚åº”äºåœ¨ Jade é‡Œçš„ä»»ä½•æ–‡æœ¬ï¼š 123html body h1 User &lt;em&gt;#&#123;name&#125;&lt;/em&gt; Doctypesæ·»åŠ æ–‡æ¡£ç±»å‹åªéœ€è¦ç®€å•çš„ä½¿ç”¨ !!!, æˆ–è€… doctype è·Ÿä¸Šä¸‹é¢çš„å¯é€‰é¡¹: 1!!! ä¼šæ¸²æŸ“å‡º transitional æ–‡æ¡£ç±»å‹, æˆ–è€…: 1!!! 5 æˆ– 1!!! html æˆ– 1doctype html Doctype æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„, æ‰€ä»¥ä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸€æ ·çš„: 12doctype Basicdoctype basic å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥ä¼ é€’ä¸€æ®µæ–‡æ¡£ç±»å‹çš„æ–‡æœ¬ï¼š 1doctype html PUBLIC &quot;-//W3C//DTD XHTML Basic 1.1//EN&quot; æ¸²æŸ“å: 1&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML Basic 1.1//EN\"&gt; ä¼šè¾“å‡º HTML5 æ–‡æ¡£ç±»å‹. ä¸‹é¢çš„é»˜è®¤çš„æ–‡æ¡£ç±»å‹ï¼Œå¯ä»¥å¾ˆç®€å•çš„æ‰©å±•ï¼š 1234567891011var doctypes = exports.doctypes = &#123; '5': '&lt;!DOCTYPE html&gt;', 'xml': '&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;', 'default': '&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;', 'transitional': '&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;', 'strict': '&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;', 'frameset': '&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Frameset//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd\"&gt;', '1.1': '&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\" \"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\"&gt;', 'basic': '&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML Basic 1.1//EN\" \"http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd\"&gt;', 'mobile': '&lt;!DOCTYPE html PUBLIC \"-//WAPFORUM//DTD XHTML Mobile 1.2//EN\" \"http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd\"&gt;'&#125;; é€šè¿‡ä¸‹é¢çš„ä»£ç å¯ä»¥å¾ˆç®€å•çš„æ”¹å˜é»˜è®¤çš„æ–‡æ¡£ç±»å‹ï¼š 1jade.doctypes.default = 'whatever you want'; è¿‡æ»¤å™¨è¿‡æ»¤å™¨å‰ç¼€ :, æ¯”å¦‚ :markdown ä¼šæŠŠä¸‹é¢å—é‡Œçš„æ–‡æœ¬äº¤ç»™ä¸“é—¨çš„å‡½æ•°è¿›è¡Œå¤„ç†ã€‚æŸ¥çœ‹é¡¶éƒ¨ _ç‰¹æ€§_ é‡Œæœ‰å“ªäº›å¯ç”¨çš„è¿‡æ»¤å™¨ã€‚ 1234body :markdown Woah! jade _and_ markdown, very **cool** we can even link to [stuff](http://google.com) æ¸²æŸ“ä¸º: 1&lt;body&gt;&lt;p&gt;Woah! jade &lt;em&gt;and&lt;/em&gt; markdown, very &lt;strong&gt;cool&lt;/strong&gt; we can even link to &lt;a href=\"http://google.com\"&gt;stuff&lt;/a&gt;&lt;/p&gt;&lt;/body&gt; ä»£ç Jade ç›®å‰æ”¯æŒä¸‰ç§ç±»å‹çš„å¯æ‰§è¡Œä»£ç ã€‚ç¬¬ä¸€ç§æ˜¯å‰ç¼€ -ï¼Œ è¿™æ˜¯ä¸ä¼šè¢«è¾“å‡ºçš„ï¼š 1- var foo = &apos;bar&apos;; è¿™å¯ä»¥ç”¨åœ¨æ¡ä»¶è¯­å¥æˆ–è€…å¾ªç¯ä¸­ï¼š 12- for (var key in obj) p= obj[key] ç”±äº Jade çš„ç¼“å­˜æŠ€æœ¯ï¼Œä¸‹é¢çš„ä»£ç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š 1234567- if (foo) ul li yay li foo li worked- else p oh no! didnt work å“ˆå“ˆï¼Œç”šè‡³æ˜¯å¾ˆé•¿çš„å¾ªç¯ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š - if (items.length) ul - items.forEach(function(item){ li= item - }) æ‰€ä»¥ä½ æƒ³è¦çš„ï¼ ä¸‹ä¸€æ­¥æˆ‘ä»¬è¦ _è½¬ä¹‰_ è¾“å‡ºçš„ä»£ç ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿”å›ä¸€ä¸ªå€¼ï¼Œåªè¦å‰ç¼€ä¸€ä¸ª =ï¼š 123- var foo = &apos;bar&apos;= fooh1= foo å®ƒä¼šæ¸²æŸ“ä¸º bar&lt;h1&gt;bar&lt;/h1&gt;. ä¸ºäº†å®‰å…¨èµ·è§ï¼Œä½¿ç”¨ = è¾“å‡ºçš„ä»£ç é»˜è®¤æ˜¯è½¬ä¹‰çš„,å¦‚æœæƒ³ç›´æ¥è¾“å‡ºä¸è½¬ä¹‰çš„å€¼å¯ä»¥ä½¿ç”¨ !=ï¼š 1p!= aVarContainingMoreHTML Jade åŒæ ·æ˜¯è®¾è®¡å¸ˆå‹å¥½çš„ï¼Œå®ƒå¯ä»¥ä½¿ JavaScript æ›´ç›´æ¥æ›´å¯Œè¡¨ç°åŠ›ã€‚æ¯”å¦‚ä¸‹é¢çš„èµ‹å€¼è¯­å¥æ˜¯ç›¸ç­‰çš„ï¼ŒåŒæ—¶è¡¨è¾¾å¼è¿˜æ˜¯é€šå¸¸çš„ JavaScriptï¼š 12- var foo = &apos;foo &apos; + &apos;bar&apos;foo = &apos;foo &apos; + &apos;bar&apos; Jade ä¼šæŠŠ if, else if, else, until, while, unless åŒåˆ«çš„ä¼˜å…ˆå¯¹å¾…, ä½†æ˜¯ä½ å¾—è®°ä½å®ƒä»¬è¿˜æ˜¯æ™®é€šçš„ JavaScriptï¼š 1234567if foo == &apos;bar&apos; ul li yay li foo li workedelse p oh no! didnt work å¾ªç¯å°½ç®¡å·²ç»æ”¯æŒ JavaScript åŸç”Ÿä»£ç ï¼ŒJade è¿˜æ˜¯æ”¯æŒäº†ä¸€äº›ç‰¹æ®Šçš„æ ‡ç­¾ï¼Œå®ƒä»¬å¯ä»¥è®©æ¨¡æ¿æ›´åŠ æ˜“äºç†è§£ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ each, è¿™ç§å½¢å¼ï¼š 1each VAL[, KEY] in OBJ ä¸€ä¸ªéå†æ•°ç»„çš„ä¾‹å­ ï¼š 123- var items = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]each item in items li= item æ¸²æŸ“ä¸º: 123&lt;li&gt;one&lt;/li&gt;&lt;li&gt;two&lt;/li&gt;&lt;li&gt;three&lt;/li&gt; éå†ä¸€ä¸ªæ•°ç»„åŒæ—¶å¸¦ä¸Šç´¢å¼•ï¼š 123items = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]each item, i in items li #&#123;item&#125;: #&#123;i&#125; æ¸²æŸ“ä¸º: 123&lt;li&gt;one: 0&lt;/li&gt;&lt;li&gt;two: 1&lt;/li&gt;&lt;li&gt;three: 2&lt;/li&gt; éå†ä¸€ä¸ªæ•°ç»„çš„é”®å€¼ï¼š 123obj = &#123; foo: &apos;bar&apos; &#125;each val, key in obj li #&#123;key&#125;: #&#123;val&#125; å°†ä¼šæ¸²æŸ“ä¸ºï¼š&lt;li&gt;foo: bar&lt;/li&gt; Jade åœ¨å†…éƒ¨ä¼šæŠŠè¿™äº›è¯­å¥è½¬æ¢æˆåŸç”Ÿçš„ JavaScript è¯­å¥ï¼Œå°±åƒä½¿ç”¨ users.forEach(function(user){, è¯æ³•ä½œç”¨åŸŸå’ŒåµŒå¥—ä¼šåƒåœ¨æ™®é€šçš„ JavaScript ä¸­ä¸€æ ·ï¼š 123each user in users each role in user.roles li= role å¦‚æœä½ å–œæ¬¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ for ï¼š 123for user in users for role in user.roles li= role æ¡ä»¶è¯­å¥Jade æ¡ä»¶è¯­å¥å’Œä½¿ç”¨äº†(-) å‰ç¼€çš„ JavaScript è¯­å¥æ˜¯ä¸€è‡´çš„,ç„¶åå®ƒå…è®¸ä½ ä¸ä½¿ç”¨åœ†æ‹¬å·ï¼Œè¿™æ ·ä¼šçœ‹ä¸Šå»å¯¹è®¾è®¡å¸ˆæ›´å‹å¥½ä¸€ç‚¹ï¼ŒåŒæ—¶è¦åœ¨å¿ƒé‡Œè®°ä½è¿™ä¸ªè¡¨è¾¾å¼æ¸²æŸ“å‡ºçš„æ˜¯ _å¸¸è§„_ JavaScriptï¼š 12345for user in users if user.role == &apos;admin&apos; p #&#123;user.name&#125; is an admin else p= user.name å’Œä¸‹é¢çš„ä½¿ç”¨äº†å¸¸è§„ JavaScript çš„ä»£ç æ˜¯ç›¸ç­‰çš„ï¼š 12345for user in users - if (user.role == &apos;admin&apos;) p #&#123;user.name&#125; is an admin - else p= user.name Jade åŒæ—¶æ”¯æŒ unless, è¿™å’Œ if (!(expr)) æ˜¯ç­‰ä»·çš„ï¼š 12345for user in users unless user.isAnonymous p | Click to view a(href=&apos;/users/&apos; + user.id)= user.name æ¨¡æ¿ç»§æ‰¿Jade æ”¯æŒé€šè¿‡ block å’Œ extends å…³é”®å­—æ¥å®ç°æ¨¡æ¿ç»§æ‰¿ã€‚ ä¸€ä¸ªå—å°±æ˜¯ä¸€ä¸ª Jade çš„ block ï¼Œå®ƒå°†åœ¨å­æ¨¡æ¿ä¸­å®ç°ï¼ŒåŒæ—¶æ˜¯æ”¯æŒé€’å½’çš„ã€‚ Jade å—å¦‚æœæ²¡æœ‰å†…å®¹ï¼ŒJade ä¼šæ·»åŠ é»˜è®¤å†…å®¹ï¼Œä¸‹é¢çš„ä»£ç é»˜è®¤ä¼šè¾“å‡º block scripts, block content, å’Œ block foot. 12345678910html head h1 My Site - #&#123;title&#125; block scripts script(src=&apos;/jquery.js&apos;) body block content block foot #footer p some footer content ç°åœ¨æˆ‘ä»¬æ¥ç»§æ‰¿è¿™ä¸ªå¸ƒå±€ï¼Œç®€å•åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œåƒä¸‹é¢é‚£æ ·ç›´æ¥ä½¿ç”¨ extendsï¼Œç»™å®šè·¯å¾„ï¼ˆå¯ä»¥é€‰æ‹©å¸¦ .jade æ‰©å±•åæˆ–è€…ä¸å¸¦ï¼‰. ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–è€…æ›´å¤šçš„å—æ¥è¦†ç›–çˆ¶çº§å—å†…å®¹, æ³¨æ„åˆ°è¿™é‡Œçš„ foot å— _æ²¡æœ‰_ å®šä¹‰ï¼Œæ‰€ä»¥å®ƒè¿˜ä¼šè¾“å‡ºçˆ¶çº§çš„ â€œsome footer contentâ€ã€‚ 12345678910extends extend-layoutblock scripts script(src=&apos;/jquery.js&apos;) script(src=&apos;/pets.js&apos;)block content h1= title each pet in pets include pet åŒæ ·å¯ä»¥åœ¨ä¸€ä¸ªå­å—é‡Œæ·»åŠ å—ï¼Œå°±åƒä¸‹é¢å®ç°çš„å— content é‡Œåˆå®šä¹‰äº†ä¸¤ä¸ªå¯ä»¥è¢«å®ç°çš„å— sidebar å’Œ primaryï¼Œæˆ–è€…å­æ¨¡æ¿ç›´æ¥å®ç° contentã€‚ 123456789extends regular-layoutblock content .sidebar block sidebar p nothing .primary block primary p nothing å‰ç½®ã€è¿½åŠ ä»£ç å—Jadeå…è®¸ä½  _æ›¿æ¢_ ï¼ˆé»˜è®¤ï¼‰ã€ _å‰ç½®_ å’Œ _è¿½åŠ _ blocks. æ¯”å¦‚ï¼Œå‡è®¾ä½ å¸Œæœ›åœ¨ _æ‰€æœ‰_ é¡µé¢çš„å¤´éƒ¨éƒ½åŠ ä¸Šé»˜è®¤çš„è„šæœ¬ï¼Œä½ å¯ä»¥è¿™ä¹ˆåšï¼š 1234567html head block head script(src=&apos;/vendor/jquery.js&apos;) script(src=&apos;/vendor/caustic.js&apos;) body block content ç°åœ¨å‡è®¾ä½ æœ‰ä¸€ä¸ªJavascriptæ¸¸æˆçš„é¡µé¢ï¼Œä½ å¸Œæœ›åœ¨é»˜è®¤çš„è„šæœ¬ä¹‹å¤–æ·»åŠ ä¸€äº›æ¸¸æˆç›¸å…³çš„è„šæœ¬ï¼Œä½ å¯ä»¥ç›´æ¥appendä¸Šä»£ç å—ï¼š 12345extends layoutblock append head script(src=&apos;/vendor/three.js&apos;) script(src=&apos;/game.js&apos;) ä½¿ç”¨ block append æˆ– block prepend æ—¶ block æ˜¯å¯é€‰çš„: 12345extends layoutappend head script(src=&apos;/vendor/three.js&apos;) script(src=&apos;/game.js&apos;) åŒ…å«Includes å…è®¸ä½ é™æ€åŒ…å«ä¸€æ®µ Jade, æˆ–è€…åˆ«çš„å­˜æ”¾åœ¨å•ä¸ªæ–‡ä»¶ä¸­çš„ä¸œè¥¿æ¯”å¦‚ CSS, HTML éå¸¸å¸¸è§çš„ä¾‹å­æ˜¯åŒ…å«å¤´éƒ¨å’Œé¡µè„šã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸‹é¢ç›®å½•ç»“æ„çš„æ–‡ä»¶å¤¹ï¼š 1234./layout.jade./includes/ ./head.jade ./tail.jade ä¸‹é¢æ˜¯ layout.jade çš„å†…å®¹: 123456html include includes/head body h1 My Site p Welcome to my super amazing site. include includes/foot è¿™ä¸¤ä¸ªåŒ…å« includes/head å’Œ includes/foot éƒ½ä¼šè¯»å–ç›¸å¯¹äºç»™ layout.jade å‚æ•°filename çš„è·¯å¾„çš„æ–‡ä»¶, è¿™æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¸ç”¨æ‹…å¿ƒExpresså¸®ä½ æå®šè¿™äº›äº†ã€‚Include ä¼šè§£æè¿™äº›æ–‡ä»¶ï¼Œå¹¶ä¸”æ’å…¥åˆ°å·²ç»ç”Ÿæˆçš„è¯­æ³•æ ‘ä¸­ï¼Œç„¶åæ¸²æŸ“ä¸ºä½ æœŸå¾…çš„å†…å®¹ï¼š 1234567891011121314&lt;html&gt; &lt;head&gt; &lt;title&gt;My Site&lt;/title&gt; &lt;script src=\"/javascripts/jquery.js\"&gt; &lt;/script&gt;&lt;script src=\"/javascripts/app.js\"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;My Site&lt;/h1&gt; &lt;p&gt;Welcome to my super lame site.&lt;/p&gt; &lt;div id=\"footer\"&gt; &lt;p&gt;Copyright&gt;(c) foobar&lt;/p&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt; å‰é¢å·²ç»æåˆ°ï¼Œinclude å¯ä»¥åŒ…å«æ¯”å¦‚ HTML æˆ–è€… CSS è¿™æ ·çš„å†…å®¹ã€‚ç»™å®šä¸€ä¸ªæ‰©å±•ååï¼ŒJade ä¸ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶å½“ä½œä¸€ä¸ª Jade æºä»£ç ï¼Œå¹¶ä¸”ä¼šæŠŠå®ƒå½“ä½œä¸€ä¸ªæ™®é€šæ–‡æœ¬åŒ…å«è¿›æ¥ï¼š 123456789101112html head //- css and js have simple filters that wrap them in &lt;style&gt; and &lt;script&gt; tags, respectively include stylesheet.css include script.js body //- &quot;markdown&quot; files will use the &quot;markdown&quot; filter to convert Markdown to HTML include introduction.markdown //- html files have no filter and are included verbatim include content.html Include ä¹Ÿå¯ä»¥æ¥å—å—å†…å®¹ï¼Œç»™å®šçš„å—å°†ä¼šé™„åŠ åˆ°åŒ…å«æ–‡ä»¶ _æœ€å_ çš„å—é‡Œã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œhead.jade åŒ…å«ä¸‹é¢çš„å†…å®¹ï¼š 12head script(src=&apos;/jquery.js&apos;) æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢ç»™include headæ·»åŠ å†…å®¹, è¿™é‡Œæ˜¯æ·»åŠ ä¸¤ä¸ªè„šæœ¬. 123456html include head script(src=&apos;/foo.js&apos;) script(src=&apos;/bar.js&apos;) body h1 test åœ¨è¢«åŒ…å«çš„æ¨¡æ¿ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨yieldè¯­å¥ã€‚yieldè¯­å¥å…è®¸ä½ æ˜ç¡®åœ°æ ‡æ˜includeçš„ä»£ç å—çš„æ”¾ç½®ä½ç½®ã€‚æ¯”å¦‚ï¼Œå‡è®¾ä½ å¸Œæœ›æŠŠä»£ç å—æ”¾åœ¨scriptsä¹‹å‰ï¼Œè€Œä¸æ˜¯é™„åŠ åœ¨scriptsä¹‹åï¼š 1234head yield script(src=&apos;/jquery.js&apos;) script(src=&apos;/jquery.ui.js&apos;) ç”±äºè¢«åŒ…å«çš„Jadeä¼šæŒ‰å­—é¢è§£æå¹¶åˆå¹¶åˆ°ASTä¸­ï¼Œè¯æ³•èŒƒå›´çš„å˜é‡çš„æ•ˆæœå’Œç›´æ¥å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­çš„ç›¸åŒã€‚è¿™å°±æ„å‘³ç€includeå¯ä»¥ç”¨ä½œpartialçš„æ›¿ä»£ï¼Œä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¼•ç”¨äº†userå˜é‡çš„user.jade`æ–‡ä»¶ï¼š 12h1= user.namep= user.occupation æ¥ç€ï¼Œå½“æˆ‘ä»¬è¿­ä»£usersçš„æ—¶å€™ï¼Œåªéœ€ç®€å•åœ°åŠ ä¸Šinclude userã€‚å› ä¸ºåœ¨å¾ªç¯ä¸­userå˜é‡å·²ç»è¢«å®šä¹‰äº†ï¼Œè¢«åŒ…å«çš„æ¨¡æ¿å¯ä»¥è®¿é—®å®ƒã€‚ 12345users = [&#123; name: &apos;Tobi&apos;, occupation: &apos;Ferret&apos; &#125;]each user in users .user include user ä»¥ä¸Šä»£ç ä¼šç”Ÿæˆï¼š 1234&lt;div class=\"user\"&gt; &lt;h1&gt;Tobi&lt;/h1&gt; &lt;p&gt;Ferret&lt;/p&gt;&lt;/div&gt; user.jadeå¼•ç”¨äº†userå˜é‡ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„å˜é‡userï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ªæ–°å˜é‡user = personï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234each person in users .user user = person include user MixinsMixins åœ¨ç¼–è¯‘çš„æ¨¡æ¿é‡Œä¼šè¢« Jade è½¬æ¢ä¸ºæ™®é€šçš„ JavaScript å‡½æ•°ã€‚ Mixins å¯ä»¥è¿˜å‚æ•°ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ï¼š 12345mixin list ul li foo li bar li baz ä½¿ç”¨ä¸å¸¦å‚æ•°çš„ mixin çœ‹ä¸Šå»éå¸¸ç®€å•ï¼Œåœ¨ä¸€ä¸ªå—å¤–ï¼š 12h2 Groceriesmixin list Mixins ä¹Ÿå¯ä»¥å¸¦ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œå‚æ•°å°±æ˜¯æ™®é€šçš„ JavaScript è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š 123456789mixin pets(pets) ul.pets - each pet in pets li= petmixin profile(user) .user h2= user.name mixin pets(user.pets) ä¼šè¾“å‡ºåƒä¸‹é¢çš„ HTML: 123456789&lt;div class=\"user\"&gt; &lt;h2&gt;tj&lt;/h2&gt; &lt;ul class=\"pets\"&gt; &lt;li&gt;tobi&lt;/li&gt; &lt;li&gt;loki&lt;/li&gt; &lt;li&gt;jane&lt;/li&gt; &lt;li&gt;manny&lt;/li&gt; &lt;/ul&gt;&lt;/div&gt; äº§ç”Ÿè¾“å‡ºå‡è®¾æˆ‘ä»¬æœ‰ä¸‹é¢çš„ Jade æºç ï¼š 123- var title = &apos;yay&apos;h1.title #&#123;title&#125;p Just an example å½“ compileDebug é€‰é¡¹ä¸æ˜¯ false, Jade ä¼šç¼–è¯‘æ—¶ä¼šæŠŠå‡½æ•°é‡ŒåŠ ä¸Š __.lineno = n;, è¿™ä¸ªå‚æ•°ä¼šåœ¨ç¼–è¯‘å‡ºé”™æ—¶ä¼ é€’ç»™ rethrow(), è€Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨ Jade åˆå§‹è¾“å‡ºæ—¶ç»™å‡ºä¸€ä¸ªæœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯ã€‚ 1234567891011121314151617181920212223242526function anonymous(locals) &#123; var __ = &#123; lineno: 1, input: \"- var title = 'yay'\\nh1.title #&#123;title&#125;\\np Just an example\", filename: \"testing/test.js\" &#125;; var rethrow = jade.rethrow; try &#123; var attrs = jade.attrs, escape = jade.escape; var buf = []; with (locals || &#123;&#125;) &#123; var interp; __.lineno = 1; var title = 'yay' __.lineno = 2; buf.push('&lt;h1'); buf.push(attrs(&#123; \"class\": ('title') &#125;)); buf.push('&gt;'); buf.push('' + escape((interp = title) == null ? '' : interp) + ''); buf.push('&lt;/h1&gt;'); __.lineno = 3; buf.push('&lt;p&gt;'); buf.push('Just an example'); buf.push('&lt;/p&gt;'); &#125; return buf.join(\"\"); &#125; catch (err) &#123; rethrow(err, __.input, __.filename, __.lineno); &#125;&#125; å½“ compileDebug å‚æ•°æ˜¯ false, è¿™ä¸ªå‚æ•°ä¼šè¢«å»æ‰ï¼Œè¿™æ ·å¯¹äºè½»é‡çº§çš„æµè§ˆå™¨ç«¯æ¨¡æ¿æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ç»“åˆ Jade çš„å‚æ•°å’Œå½“å‰æºç åº“é‡Œçš„ ./runtime.js æ–‡ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡ toString() æ¥ç¼–è¯‘æ¨¡æ¿è€Œä¸éœ€è¦åœ¨æµè§ˆå™¨ç«¯è¿è¡Œæ•´ä¸ª Jade åº“ï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ï¼Œä¹Ÿå¯ä»¥å‡å°‘è½½å…¥çš„ JavaScript æ•°é‡ã€‚ 1234567891011121314151617function anonymous(locals) &#123; var attrs = jade.attrs, escape = jade.escape; var buf = []; with (locals || &#123;&#125;) &#123; var interp; var title = 'yay' buf.push('&lt;h1'); buf.push(attrs(&#123; \"class\": ('title') &#125;)); buf.push('&gt;'); buf.push('' + escape((interp = title) == null ? '' : interp) + ''); buf.push('&lt;/h1&gt;'); buf.push('&lt;p&gt;'); buf.push('Just an example'); buf.push('&lt;/p&gt;'); &#125; return buf.join(\"\");&#125; Makefile çš„ä¸€ä¸ªä¾‹å­é€šè¿‡æ‰§è¡Œ makeï¼Œ ä¸‹é¢çš„ Makefile ä¾‹å­å¯ä»¥æŠŠ pages/*.jade ç¼–è¯‘ä¸º pages/*.html ã€‚ 123456789101112JADE = $(shell find pages/*.jade)HTML = $(JADE:.jade=.html)all: $(HTML)%.html: %.jade jade &lt; $&lt; --path $&lt; &gt; $@clean: rm -f $(HTML).PHONY: clean è¿™ä¸ªå¯ä»¥å’Œ watch(1) å‘½ä»¤èµ·æ¥äº§ç”Ÿåƒä¸‹é¢çš„è¡Œä¸ºï¼š 1$ watch make å‘½ä»¤è¡Œçš„ Jade12345678910111213141516171819202122232425262728293031323334ä½¿ç”¨: jade [options] [dir|file ...]é€‰é¡¹: -h, --help è¾“å‡ºå¸®åŠ©ä¿¡æ¯ -v, --version è¾“å‡ºç‰ˆæœ¬å· -o, --out &lt;dir&gt; è¾“å‡ºç¼–è¯‘åçš„ HTML åˆ° &lt;dir&gt; -O, --obj &lt;str&gt; JavaScript é€‰é¡¹ -p, --path &lt;path&gt; åœ¨å¤„ç† stdio æ—¶ï¼ŒæŸ¥æ‰¾åŒ…å«æ–‡ä»¶æ—¶çš„æŸ¥æ‰¾è·¯å¾„ -P, --pretty æ ¼å¼åŒ– HTML è¾“å‡º -c, --client ç¼–è¯‘æµè§ˆå™¨ç«¯å¯ç”¨çš„ runtime.js -D, --no-debug å…³é—­ç¼–è¯‘çš„è°ƒè¯•é€‰é¡¹(å‡½æ•°ä¼šæ›´å°) -w, --watch ç›‘è§†æ–‡ä»¶æ”¹å˜è‡ªåŠ¨åˆ·æ–°ç¼–è¯‘ç»“æœExamples: # ç¼–è¯‘æ•´ä¸ªç›®å½• $ jade templates # ç”Ÿæˆ &#123;foo,bar&#125;.html $ jade &#123;foo,bar&#125;.jade # åœ¨æ ‡å‡†IOä¸‹ä½¿ç”¨jade $ jade &lt; my.jade &gt; my.html # åœ¨æ ‡å‡†IOä¸‹ä½¿ç”¨jade, åŒæ—¶æŒ‡å®šç”¨äºæŸ¥æ‰¾åŒ…å«çš„æ–‡ä»¶ $ jade &lt; my.jade -p my.jade &gt; my.html # åœ¨æ ‡å‡†IOä¸‹ä½¿ç”¨jade $ echo &quot;h1 Jade!&quot; | jade # foo, bar ç›®å½•æ¸²æŸ“åˆ° /tmp $ jade foo bar --out /tmp æ³¨æ„: ä» v0.31.0 çš„ -o é€‰é¡¹å·²ç»æŒ‡å‘ --out, -O ç›¸åº”åšäº†äº¤æ¢ æ•™ç¨‹ cssdeck interactive Jade syntax tutorial cssdeck interactive Jade logic tutorial in Japanese License(The MIT License) Copyright (c) 2009-2010 TJ Holowaychuk &lt;tj@vision-media.ca&gt; Permission is hereby granted, free of charge, to any person obtaininga copy of this software and associated documentation files (theâ€˜Softwareâ€™), to deal in the Software without restriction, includingwithout limitation the rights to use, copy, modify, merge, publish,distribute, sublicense, and/or sell copies of the Software, and topermit persons to whom the Software is furnished to do so, subject tothe following conditions: The above copyright notice and this permission notice shall beincluded in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED â€˜AS ISâ€™, WITHOUT WARRANTY OF ANY KIND,EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OFMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANYCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THESOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"æ¨¡æ¿å¼•æ“","slug":"å‰ç«¯/æ¨¡æ¿å¼•æ“","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/æ¨¡æ¿å¼•æ“/"}],"tags":[{"name":"æ¨¡æ¿å¼•æ“","slug":"æ¨¡æ¿å¼•æ“","permalink":"https://jigangduan.github.io/tags/æ¨¡æ¿å¼•æ“/"}]},{"title":"Markdown è¯­æ³•ç¬”è®°","slug":"Markdownè¯­æ³•ç¬”è®°","date":"2017-03-20T04:26:28.000Z","updated":"2020-07-25T02:57:18.159Z","comments":true,"path":"2017/03/20/Markdownè¯­æ³•ç¬”è®°/","link":"","permalink":"https://jigangduan.github.io/2017/03/20/Markdownè¯­æ³•ç¬”è®°/","excerpt":"å…³äºMarkdownMarkdownæ˜¯ä¸€ä¸ª Web ä¸Šä½¿ç”¨çš„æ–‡æœ¬åˆ°HTMLçš„è½¬æ¢å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ç®€å•ã€æ˜“è¯»æ˜“å†™çš„æ–‡æœ¬æ ¼å¼ç”Ÿæˆç»“æ„åŒ–çš„HTMLæ–‡æ¡£ã€‚","text":"å…³äºMarkdownMarkdownæ˜¯ä¸€ä¸ª Web ä¸Šä½¿ç”¨çš„æ–‡æœ¬åˆ°HTMLçš„è½¬æ¢å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ç®€å•ã€æ˜“è¯»æ˜“å†™çš„æ–‡æœ¬æ ¼å¼ç”Ÿæˆç»“æ„åŒ–çš„HTMLæ–‡æ¡£ã€‚ Markdownç®€å•è¯­æ³•ä¸»è¦åˆ†ä¸ºåŒºå—å…ƒç´ å’ŒåŒºæ®µå…ƒç´ ã€‚ åŒºå—å…ƒç´ 1.æ®µè½å’Œæ¢è¡Œä¸€ä¸ª Markdown æ®µè½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„æ–‡æœ¬è¡Œç»„æˆï¼Œå®ƒçš„å‰åè¦æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ç©ºè¡Œã€‚ 2.æ ‡é¢˜ç”¨#æ ‡è¯†ç¬¦è¡¨ç¤º12345# ä¸€çº§æ ‡é¢˜## äºŒçº§æ ‡é¢˜### ä¸‰çº§æ ‡é¢˜#### å››çº§æ ‡é¢˜##### äº”çº§æ ‡é¢˜ æ˜¾ç¤ºå¦‚ä¸‹ï¼š ä¸€çº§æ ‡é¢˜ äºŒçº§æ ‡é¢˜ä¸‰çº§æ ‡é¢˜å››çº§æ ‡é¢˜äº”çº§æ ‡é¢˜3.åŒºå—å¼•ç”¨ åœ¨æ®µè½çš„ç¬¬ä¸€è¡Œæœ€å‰é¢åŠ â€&gt;â€ åŒºå—å¼•ç”¨å¯ä»¥åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šå¼•ç”¨å†…çš„å¼•ç”¨ï¼‰ï¼Œåªè¦æ ¹æ®å±‚æ¬¡åŠ ä¸Šä¸åŒæ•°é‡çš„ &gt; åŒºå—å†…ä¹Ÿå¯ä»¥å¥—ç”¨å…¶ä»–çš„ Markdown è¯­æ³•ï¼ŒåŒ…æ‹¬åŠ ç²—ã€åˆ—è¡¨ã€ä»£ç åŒºå—ç­‰ 1234&gt;å¦‚äººä»¥æ‰‹ï¼ŒæŒ‡æœˆç¤ºäººã€‚å½¼äººå› æŒ‡ï¼Œå½“å› çœ‹æœˆã€‚è‹¥å¤è§‚æŒ‡ä»¥ä¸ºæœˆä½“ã€‚æ­¤äººå²‚å”¯äº¡å¤±æœˆè½®ï¼Œäº¦äº¡å…¶æŒ‡ã€‚ä½•ä»¥æ•…ï¼Œä»¥æ‰€æ ‡æŒ‡ä¸ºæ˜ç›®æ•…ï¼Œå²‚å”¯äº¡æŒ‡ï¼Œäº¦å¤ä¸è¯†æ˜ä¹‹ä¸æš—ã€‚ä½•ä»¥æ•…ï¼Œå³ä»¥æŒ‡ä½“ï¼Œä¸ºæœˆæ˜æ€§ï¼Œæ˜æš—äºŒæ€§ï¼Œæ— æ‰€äº†æ•…ã€‚&gt;&gt; ã€Šæ¥ä¸¥ç»ã€‹ æ˜¾ç¤ºå¦‚ä¸‹ï¼š å¦‚äººä»¥æ‰‹ï¼ŒæŒ‡æœˆç¤ºäººã€‚å½¼äººå› æŒ‡ï¼Œå½“å› çœ‹æœˆã€‚è‹¥å¤è§‚æŒ‡ä»¥ä¸ºæœˆä½“ã€‚æ­¤äººå²‚å”¯äº¡å¤±æœˆè½®ï¼Œäº¦äº¡å…¶æŒ‡ã€‚ä½•ä»¥æ•…ï¼Œä»¥æ‰€æ ‡æŒ‡ä¸ºæ˜ç›®æ•…ï¼Œå²‚å”¯äº¡æŒ‡ï¼Œäº¦å¤ä¸è¯†æ˜ä¹‹ä¸æš—ã€‚ä½•ä»¥æ•…ï¼Œå³ä»¥æŒ‡ä½“ï¼Œä¸ºæœˆæ˜æ€§ï¼Œæ˜æš—äºŒæ€§ï¼Œæ— æ‰€äº†æ•…ã€‚ ã€Šæ¥ä¸¥ç»ã€‹ 4.åˆ—è¡¨æœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨ä½¿ç”¨æ˜Ÿå·ã€åŠ å·æˆ–æ˜¯å‡å·ä½œä¸ºåˆ—è¡¨æ ‡è®° 123* æ˜Ÿå·+ åŠ å·- å‡å· æ˜¾ç¤ºå¦‚ä¸‹ï¼š æ˜Ÿå· åŠ å· å‡å· æœ‰åºåˆ—è¡¨åˆ™ä½¿ç”¨æ•°å­—æ¥ç€ä¸€ä¸ªè‹±æ–‡å¥ç‚¹ 121. ç¬¬ä¸€2. ç¬¬äºŒ æ˜¾ç¤ºå¦‚ä¸‹ï¼š ç¬¬ä¸€ ç¬¬äºŒ 5.ä»£ç åŒºå—è¦åœ¨ Markdown ä¸­å»ºç«‹ä»£ç åŒºå—å¾ˆç®€å•ï¼Œåªè¦ç®€å•åœ°ç¼©è¿› 4 ä¸ªç©ºæ ¼æˆ–æ˜¯ 1 ä¸ªåˆ¶è¡¨ç¬¦å°±å¯ä»¥1ä»£ç åŒºå— æ˜¾ç¤ºå¦‚ä¸‹ï¼š ä»£ç åŒºå— 6.åˆ†éš”çº¿ä½ å¯ä»¥åœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„æ˜Ÿå·ã€å‡å·ã€åº•çº¿æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼Œè¡Œå†…ä¸èƒ½æœ‰å…¶ä»–ä¸œè¥¿ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨æ˜Ÿå·æˆ–æ˜¯å‡å·ä¸­é—´æ’å…¥ç©ºæ ¼ã€‚1*** 1--- 1* * * åŒºæ®µå…ƒç´ 1.é“¾æ¥æ–¹å—æ‹¬å·åé¢ç´§æ¥ç€åœ†æ‹¬å·å¹¶æ’å…¥ç½‘å€é“¾æ¥å³å¯1[æˆ‘çš„åšå®¢åœ°å€](https://jigangduan.github.io) æˆ‘çš„åšå®¢åœ°å€ 2.å¼ºè°ƒ12*å¼ºè°ƒ*_å¼ºè°ƒ_ å¼ºè°ƒ_å¼ºè°ƒ_1**ç²—ä½“** ç²—ä½“1~~åˆ é™¤çº¿~~ åˆ é™¤çº¿ ç©ºæ ¼ Markdownè¯­æ³•ä¼šå¿½ç•¥é¦–è¡Œå¼€å¤´çš„ç©ºæ ¼ï¼Œå¦‚æœè¦ä½“ç°å‡ºé¦–è¡Œå¼€å¤´ç©ºä¸¤ä¸ªçš„æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ å…¨è§’ç¬¦å·ä¸‹çš„ç©ºæ ¼ ï¼Œwindowsä¸‹ä½¿ç”¨ shift+ç©ºæ ¼ åˆ‡æ¢ã€‚ 3.è¡Œå†…æ ‡è®°è¡Œå†…æ ‡è®°ç”¨åå¼•å·æŠŠå®ƒåŒ…èµ·æ¥â€™ â€˜ 4.æ’å…¥å›¾ç‰‡1![å¤©é»‘é»‘](URL) åæ–œæ Markdownå¯ä»¥åˆ©ç”¨åæ–œæ æ¥æ’å…¥ä¸€äº›åœ¨è¯­æ³•ä¸­æœ‰å…¶å®ƒæ„ä¹‰çš„ç¬¦å·ï¼Œä¾‹å¦‚ï¼šå¦‚æœä½ æƒ³è¦ç”¨æ˜Ÿå·åŠ åœ¨æ–‡å­—æ—è¾¹çš„æ–¹å¼æ¥åšå‡ºå¼ºè°ƒæ•ˆæœï¼Œä½ å¯ä»¥åœ¨æ˜Ÿå·çš„å‰é¢åŠ ä¸Šåæ–œæ  è‡ªåŠ¨é‚®ç®±é“¾æ¥Markdownæ”¯æŒä»¥æ¯”è¾ƒç®€çŸ­çš„è‡ªåŠ¨é“¾æ¥å½¢å¼æ¥å¤„ç†ç”µå­é‚®ä»¶ä¿¡ç®±1&lt;jigang.duan@tcl.com&gt; &#106;&#x69;&#x67;&#97;&#110;&#103;&#x2e;&#100;&#x75;&#97;&#x6e;&#64;&#116;&#99;&#108;&#46;&#99;&#x6f;&#x6d; æ­£æ–‡1. å†…å®¹ç›®å½•ä½¿ç”¨[TOC]å¼•ç”¨ç›®å½• å¤‡æ³¨ï¼š æœ‰ä¸€äº›ç¼–è¾‘å™¨ä¸æ”¯æŒ[TOC]æ ‡è®°,æ¯”å¦‚æˆ‘ä½¿ç”¨çš„Atom 2. åŠ å¼ºä»£ç å—ä½¿ç”¨``` + è¯­è¨€åç§° è¿›è¡Œæ ‡è®°12345678``` swift// MARK: - Date componentextension Date &#123; var year: Int &#123; return Calendar.current.component(.year, from: self) &#125;&#125; 12345678910æ˜¾ç¤ºå¦‚ä¸‹ï¼š``` swift// MARK: - Date componentextension Date &#123; var year: Int &#123; return Calendar.current.component(.year, from: self) &#125;&#125; 3. è„šæ³¨å¤‡æ³¨ï¼šå…³äºæ³¨è„šå¥½åƒæ¯ä¸ªç¼–è¾‘å™¨è¡¨ç¤ºæ–¹å¼ä¼šæœ‰æ‰€ä¸ç”¨ 4.æ ‡ç­¾å’Œåˆ†ç±»ä¸€èˆ¬åœ¨æ–‡é¦–è¾“å…¥tagsæ·»åŠ æ ‡ç­¾ï¼Œcategoriesæ·»åŠ åˆ†ç±»123456tags:- Markdown- è¯­è¨€categories:- æŠ€æœ¯ 5. å¾…åŠäº‹å®œ Todo åˆ—è¡¨ä½¿ç”¨å¸¦æœ‰ [ ] æˆ– [x] ï¼ˆæœªå®Œæˆæˆ–å·²å®Œæˆï¼‰é¡¹çš„åˆ—è¡¨è¯­æ³•æ’°å†™ä¸€ä¸ªå¾…åŠäº‹å®œåˆ—è¡¨ 6.è¡¨æ ¼1234|è¡¨å¤´| 1 | 2 || -- | --: | :--: || a | a1 | a2 || b | b1 | b2 | è¡¨å¤´ 1 2 a a1 a2 b b1 b2 7.æµç¨‹å›¾å’Œæ—¶åºå›¾ æµç¨‹å›¾ æ—¶åºå›¾ 8. LaTeX å…¬å¼å‚è€ƒwowubuntu.com/markdown","categories":[],"tags":[{"name":"markdown","slug":"markdown","permalink":"https://jigangduan.github.io/tags/markdown/"}]},{"title":"å®‰åˆ©","slug":"å®‰åˆ©","date":"2017-03-20T04:19:54.000Z","updated":"2020-07-25T02:57:18.235Z","comments":true,"path":"2017/03/20/å®‰åˆ©/","link":"","permalink":"https://jigangduan.github.io/2017/03/20/å®‰åˆ©/","excerpt":"","text":"GitBook æœç´¢ä¼¯ä¹åœ¨çº¿ githubgithubæ’ågithubæœç´¢å›¾çµç¤¾åŒº GitHub ä¸Šæœ‰å“ªäº›å€¼å¾—æ¨èçš„å¼€æºç”µå­ä¹¦ï¼Ÿ ç¼–ç¨‹ç±»å¼€æ”¾ä¹¦ç±èŸèƒ GUIåº”ç”¨ç¨‹åºæ¶æ„çš„åå¹´å˜è¿:MVC,MVP,MVVM,Unidirectional,Clean iOSSwiftSwiftGGèµ°å¿ƒçš„ Swift ç¿»è¯‘ç»„ Swift å­¦ä¹ æŒ‡å¼• å¼€å‘è€…çš„ç¬¬ä¸€ä»½ Swift è¯­è¨€ä¸­æ–‡å­¦ä¹ æŒ‡å— Swift è¯­è¨€æŒ‡å—è¿™ä»½æŒ‡å—æ±‡é›†äº† Swift è¯­è¨€ä¸»æµå­¦ä¹ èµ„æºï¼Œå¹¶ä»¥å¼€å‘è€…çš„è§†è§’æ•´ç†ç¼–æ’ã€‚å¯¹äºç²¾é€‰é¡¹ç›®åŠæ–‡ç« ï¼Œå¯ç›´æ¥è®¿é—®ã€ŠSwift é¡¹ç›®ç²¾é€‰ã€‹å’Œã€ŠSwift æ–‡ç« ç²¾é€‰ã€‹ã€‚è¿˜æœ‰å¼€å‘è€…ä»¬è‡ªå·±ç»´æŠ¤çš„ã€ŠSwift å¼€å‘è€…ã€é¡¹ç›®ã€æœ€ä½³å®è·µã€‹ã€‚å½“ç„¶ä¹Ÿä¸èƒ½é”™è¿‡é‚£äº›æ´»è·ƒã€ä¼˜ç§€çš„ã€Šå¼€å‘è€…ä¸ªäººèµ„æ–™é¡µã€‹ åŠ¨ç”» iOS Core Animation: Advanced Techniquesä¸­æ–‡è¯‘æœ¬ A-GUIDE-TO-iOS-ANIMATION Quartz2D ç¼–ç¨‹æŒ‡å— å·¥å…· CocoaPodsä½¿ç”¨æŒ‡å— ç¬¬ä¸‰æ–¹åº“ Swift æœ‰å“ªäº›ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹åº“ï¼Ÿ Swift å¼€æºé¡¹ç›®ç²¾é€‰ awesome-swift Awesome-Swift-Education awesome-ios - ( ã‚œ- ã‚œ)ã¤ãƒ­ Github-iOSå¤‡å¿˜ TimLiu-iOS iOSå¼€å‘å¸¸ç”¨ä¸‰æ–¹åº“ã€æ’ä»¶ã€çŸ¥ååšå®¢ç­‰ç­‰ iOSå¼€æºåº“ æœ‰äº›æŒºè€çš„äº† open-source-ios-apps ç›˜ç‚¹å›½å†…ç¨‹åºå‘˜ä¸å¸¸ç”¨çš„çƒ­é—¨iOSç¬¬ä¸‰æ–¹åº“:çœ‹å®Œ,è¿˜æ•¢è‡ªç§°â€ç²¾é€šiOSå¼€å‘â€å—? R.swift ä»¿Androidèµ„æºæ–‡ä»¶ä½¿ç”¨ SnapKit è‡ªåŠ¨å¸ƒå±€ SwiftyBeaver Log Moya + ObjectMapper + RxSwift RxSwift Observable RxCocoa/RxDataSources Realm æ•°æ®åº“ Kingfisher å›¾ç‰‡ä¸‹è½½å’Œç¼“å­˜åº“ï¼Œå–ä»£ SDWebImage [IQKeyboardManager] é¿å…é”®ç›˜é®æŒ¡ä¸‹æ–¹è¾“å…¥æ¡† [DZNEmptyDataSet] ç©ºç™½é¡µæˆ–è€…å‡ºé”™é¡µå°è£… OAuthSwift åŸºäºSwiftçš„ OAuth åº“ [MJRefresh] ä¸‹æ‹‰åˆ·æ–° [AFImageHelper] Image æ‰©å±•åº“ [SVPulsingAnnotationView] Map Annotion View FSCalendar æ—¥å†è§†å›¾ Android Androidå®˜æ–¹åŸ¹è®­è¯¾ç¨‹ä¸­æ–‡ç‰ˆ åˆ›å»ºä½¿ç”¨Material Designçš„åº”ç”¨ Kotlinkotlin-examples ç¬¬ä¸‰æ–¹åº“ TimLiu-Android æ€»ç»“çš„Androidå¼€æºé¡¹ç›®åŠåº“ å‰ç«¯ å‰ç«¯å·¥ç¨‹å¸ˆæ‰‹å†Œ å»–é›ªå³° æ•™ç¨‹ JavaScriptæ•™ç¨‹ React React ä¸­æ–‡ç´¢å¼• React å…¥é—¨æ•™ç¨‹ React-Nativeå­¦ä¹ æŒ‡å— React Native ä¸­æ–‡ç½‘ reactnativecn github Redux ä¸­æ–‡æ–‡æ¡£ å‰ç«¯å¼€å‘ TypeScript Handbookï¼ˆä¸­æ–‡ç‰ˆï¼‰ å¾®ä¿¡å°ç¨‹åº å®˜ç½‘ å¾®ä¿¡å°ç¨‹åºï¼ˆåº”ç”¨å·ï¼‰å¼€å‘å·¥å…·+Demo+æ•™ç¨‹ åç«¯Javaå¹¶å‘ç¼–ç¨‹ç½‘ - ifeve.com Javaåç«¯ä¹¦æ¶ Spring Cloudä¸­å›½ç¤¾åŒº Node.jsNode.js æ–°æ‰‹å…¥é—¨ - CNodeæŠ€æœ¯ç¤¾åŒº Nodeå…¥é—¨ æ·±å…¥æµ…å‡ºNode NVMä½¿ç”¨nvmå®‰è£…ç®¡ç†å¤šä¸ªç‰ˆæœ¬çš„node.js(é€‚ç”¨äºMacå’ŒWindowsç³»ç»Ÿ) ExpresszåŸºäº Node.js å¹³å°ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ web å¼€å‘æ¡†æ¶ã€‚ Rx å®˜ç½‘ ReactiveXæ–‡æ¡£ä¸­æ–‡ç¿»è¯‘ RxSwift GitHub RxMarbles RxSwift å­¦ä¹ æŒ‡å¯¼ RxSwiftå…¥å‘è§£è¯»-ä½ æ‰€éœ€è¦çŸ¥é“çš„å„ç§æ¦‚ RxSwiftå…¥å‘è§£è¯»-é‚£äº›éš¾ä»¥ç†è§£çš„ç»†èŠ‚ RxSwiftå®æˆ˜æ•™ç¨‹-æ ¸å¿ƒç”¨æ³• PHPSymfony symfonychina ZF2 èœèœé¸ŸZend Framework 2 ä¸å®Œå…¨å­¦ä¹ æ¶‚é¸¦ Python å»–é›ªå³° æ•™ç¨‹ Pythonæ•™ç¨‹ Pythonçˆ¬è™«å­¦ä¹ ç³»åˆ—æ•™ç¨‹ å·¥å…· Markdownè¯­æ³•è¯´æ˜ ç‰ˆæœ¬ç®¡ç†Git å»–é›ªå³° æ•™ç¨‹ Gitæ•™ç¨‹ GitHub JetBrains blogNEW LIFE CLAN Eliyarâ€™s Blog Coding I as limboy èƒ¡å‡¯ Android Huewan å…³æ³¨ä½†ä¸é™äº Androidã€iOSã€nodejs","categories":[],"tags":[]}],"categories":[{"name":"K.K éŸ³æ¨™","slug":"K-K-éŸ³æ¨™","permalink":"https://jigangduan.github.io/categories/K-K-éŸ³æ¨™/"},{"name":"è‹±è¯­","slug":"K-K-éŸ³æ¨™/è‹±è¯­","permalink":"https://jigangduan.github.io/categories/K-K-éŸ³æ¨™/è‹±è¯­/"},{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/categories/SQL/"},{"name":"SQLè¯­å¥","slug":"SQL/SQLè¯­å¥","permalink":"https://jigangduan.github.io/categories/SQL/SQLè¯­å¥/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://jigangduan.github.io/categories/ç¬”è®°/"},{"name":"æ¨è","slug":"ç¬”è®°/æ¨è","permalink":"https://jigangduan.github.io/categories/ç¬”è®°/æ¨è/"},{"name":"è™šæ‹Ÿç¯å¢ƒ","slug":"è™šæ‹Ÿç¯å¢ƒ","permalink":"https://jigangduan.github.io/categories/è™šæ‹Ÿç¯å¢ƒ/"},{"name":"Python","slug":"è™šæ‹Ÿç¯å¢ƒ/Python","permalink":"https://jigangduan.github.io/categories/è™šæ‹Ÿç¯å¢ƒ/Python/"},{"name":"Node.js","slug":"Node-js","permalink":"https://jigangduan.github.io/categories/Node-js/"},{"name":"Web","slug":"Node-js/Web","permalink":"https://jigangduan.github.io/categories/Node-js/Web/"},{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/categories/golang/"},{"name":"æ–‡æ¡£","slug":"æ–‡æ¡£","permalink":"https://jigangduan.github.io/categories/æ–‡æ¡£/"},{"name":"Java","slug":"Java","permalink":"https://jigangduan.github.io/categories/Java/"},{"name":"é«˜å¹¶å‘","slug":"Java/é«˜å¹¶å‘","permalink":"https://jigangduan.github.io/categories/Java/é«˜å¹¶å‘/"},{"name":"Spring Cloud Alibaba","slug":"Spring-Cloud-Alibaba","permalink":"https://jigangduan.github.io/categories/Spring-Cloud-Alibaba/"},{"name":"Spring Cloud","slug":"Spring-Cloud-Alibaba/Spring-Cloud","permalink":"https://jigangduan.github.io/categories/Spring-Cloud-Alibaba/Spring-Cloud/"},{"name":"Spring","slug":"Spring-Cloud-Alibaba/Spring-Cloud/Spring","permalink":"https://jigangduan.github.io/categories/Spring-Cloud-Alibaba/Spring-Cloud/Spring/"},{"name":"React","slug":"React","permalink":"https://jigangduan.github.io/categories/React/"},{"name":"React è§£æ","slug":"React/React-è§£æ","permalink":"https://jigangduan.github.io/categories/React/React-è§£æ/"},{"name":"MySQL","slug":"MySQL","permalink":"https://jigangduan.github.io/categories/MySQL/"},{"name":"MySQL ç¬”è®°","slug":"MySQL/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/MySQL/MySQL-ç¬”è®°/"},{"name":"VS Code","slug":"VS-Code","permalink":"https://jigangduan.github.io/categories/VS-Code/"},{"name":"MySQL ç¬”è®°","slug":"VS-Code/MySQL-ç¬”è®°","permalink":"https://jigangduan.github.io/categories/VS-Code/MySQL-ç¬”è®°/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/"},{"name":"CSS","slug":"å‰ç«¯/CSS","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/"},{"name":"CSSè®²è§£","slug":"å‰ç«¯/CSS/CSSè®²è§£","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/CSSè®²è§£/"},{"name":"å­¦ä¹ CSSå¸ƒå±€","slug":"å‰ç«¯/CSS/å­¦ä¹ CSSå¸ƒå±€","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/CSS/å­¦ä¹ CSSå¸ƒå±€/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/categories/å·¥å…·/"},{"name":"GitHubç²¾é€‰","slug":"golang/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/golang/GitHubç²¾é€‰/"},{"name":"Python","slug":"Python","permalink":"https://jigangduan.github.io/categories/Python/"},{"name":"Django","slug":"Python/Django","permalink":"https://jigangduan.github.io/categories/Python/Django/"},{"name":"Djangoå…¥é—¨æŒ‡å—","slug":"Python/Django/Djangoå…¥é—¨æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Python/Django/Djangoå…¥é—¨æŒ‡å—/"},{"name":"JSON API","slug":"JSON-API","permalink":"https://jigangduan.github.io/categories/JSON-API/"},{"name":"è§„èŒƒ","slug":"JSON-API/è§„èŒƒ","permalink":"https://jigangduan.github.io/categories/JSON-API/è§„èŒƒ/"},{"name":"å®ä¾‹","slug":"å®ä¾‹","permalink":"https://jigangduan.github.io/categories/å®ä¾‹/"},{"name":"GitHubç²¾é€‰","slug":"å‰ç«¯/GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/GitHubç²¾é€‰/"},{"name":"Android","slug":"Android","permalink":"https://jigangduan.github.io/categories/Android/"},{"name":"Android Jetpack","slug":"Android/Android-Jetpack","permalink":"https://jigangduan.github.io/categories/Android/Android-Jetpack/"},{"name":"GitHub ç²¾é€‰","slug":"Android/Android-Jetpack/GitHub-ç²¾é€‰","permalink":"https://jigangduan.github.io/categories/Android/Android-Jetpack/GitHub-ç²¾é€‰/"},{"name":"Kafka","slug":"Kafka","permalink":"https://jigangduan.github.io/categories/Kafka/"},{"name":"Kafkaå¹¶ä¸éš¾å­¦","slug":"Kafka/Kafkaå¹¶ä¸éš¾å­¦","permalink":"https://jigangduan.github.io/categories/Kafka/Kafkaå¹¶ä¸éš¾å­¦/"},{"name":"Spring","slug":"Spring","permalink":"https://jigangduan.github.io/categories/Spring/"},{"name":"Spring Boot","slug":"Spring/Spring-Boot","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/"},{"name":"ç²¾é«“","slug":"Spring/Spring-Boot/ç²¾é«“","permalink":"https://jigangduan.github.io/categories/Spring/Spring-Boot/ç²¾é«“/"},{"name":"ORYç¼–è¾‘å™¨","slug":"React/ORYç¼–è¾‘å™¨","permalink":"https://jigangduan.github.io/categories/React/ORYç¼–è¾‘å™¨/"},{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"React/ç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/React/ç¬¬ä¸‰æ–¹åº“/"},{"name":"GitHubç²¾é€‰","slug":"GitHubç²¾é€‰","permalink":"https://jigangduan.github.io/categories/GitHubç²¾é€‰/"},{"name":"Kafkaå¾®æœåŠ¡","slug":"Kafka/Kafkaå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/Kafka/Kafkaå¾®æœåŠ¡/"},{"name":"IoT","slug":"IoT","permalink":"https://jigangduan.github.io/categories/IoT/"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"IoT/æ¶ˆæ¯é˜Ÿåˆ—","permalink":"https://jigangduan.github.io/categories/IoT/æ¶ˆæ¯é˜Ÿåˆ—/"},{"name":"shell","slug":"shell","permalink":"https://jigangduan.github.io/categories/shell/"},{"name":"oh-my-zsh","slug":"shell/oh-my-zsh","permalink":"https://jigangduan.github.io/categories/shell/oh-my-zsh/"},{"name":"SQL Server","slug":"VS-Code/SQL-Server","permalink":"https://jigangduan.github.io/categories/VS-Code/SQL-Server/"},{"name":"ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","slug":"Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨","permalink":"https://jigangduan.github.io/categories/Node-js/ç¼–å†™è‡ªå·±çš„Yeomanç”Ÿæˆå™¨/"},{"name":"æ’ä»¶","slug":"VS-Code/æ’ä»¶","permalink":"https://jigangduan.github.io/categories/VS-Code/æ’ä»¶/"},{"name":"å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","slug":"Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨","permalink":"https://jigangduan.github.io/categories/Spring/å¼€å‘èŒƒä¾‹ä»£ç å¤§å…¨/"},{"name":"CASä¼ä¸šå•ç‚¹ç™»å½•","slug":"Spring/CASä¼ä¸šå•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/categories/Spring/CASä¼ä¸šå•ç‚¹ç™»å½•/"},{"name":"JavaScript","slug":"JavaScript","permalink":"https://jigangduan.github.io/categories/JavaScript/"},{"name":"Pixi.js","slug":"JavaScript/Pixi-js","permalink":"https://jigangduan.github.io/categories/JavaScript/Pixi-js/"},{"name":"WebAPP","slug":"å‰ç«¯/WebAPP","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/WebAPP/"},{"name":"Goå¾®æœåŠ¡","slug":"golang/Goå¾®æœåŠ¡","permalink":"https://jigangduan.github.io/categories/golang/Goå¾®æœåŠ¡/"},{"name":"Redis","slug":"Redis","permalink":"https://jigangduan.github.io/categories/Redis/"},{"name":"æ•°æ®åº“","slug":"Redis/æ•°æ®åº“","permalink":"https://jigangduan.github.io/categories/Redis/æ•°æ®åº“/"},{"name":"go-micro","slug":"golang/go-micro","permalink":"https://jigangduan.github.io/categories/golang/go-micro/"},{"name":"React Native","slug":"React/React-Native","permalink":"https://jigangduan.github.io/categories/React/React-Native/"},{"name":"Expo","slug":"React/React-Native/Expo","permalink":"https://jigangduan.github.io/categories/React/React-Native/Expo/"},{"name":"iOS","slug":"iOS","permalink":"https://jigangduan.github.io/categories/iOS/"},{"name":"iOSç¬¬ä¸‰æ–¹åº“","slug":"iOS/iOSç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/iOS/iOSç¬¬ä¸‰æ–¹åº“/"},{"name":"PHP","slug":"PHP","permalink":"https://jigangduan.github.io/categories/PHP/"},{"name":"Symfony","slug":"PHP/Symfony","permalink":"https://jigangduan.github.io/categories/PHP/Symfony/"},{"name":"ç”µå•†","slug":"PHP/Symfony/ç”µå•†","permalink":"https://jigangduan.github.io/categories/PHP/Symfony/ç”µå•†/"},{"name":"é¢„ç ”","slug":"Android/é¢„ç ”","permalink":"https://jigangduan.github.io/categories/Android/é¢„ç ”/"},{"name":"é€†å‘","slug":"Android/é€†å‘","permalink":"https://jigangduan.github.io/categories/Android/é€†å‘/"},{"name":"MySQLç®€å•æ“ä½œ","slug":"MySQL/MySQLç®€å•æ“ä½œ","permalink":"https://jigangduan.github.io/categories/MySQL/MySQLç®€å•æ“ä½œ/"},{"name":"Browser Plugin","slug":"Android/Browser-Plugin","permalink":"https://jigangduan.github.io/categories/Android/Browser-Plugin/"},{"name":"åŒ…ç®¡ç†å™¨","slug":"åŒ…ç®¡ç†å™¨","permalink":"https://jigangduan.github.io/categories/åŒ…ç®¡ç†å™¨/"},{"name":"åŒ…ç®¡ç†å™¨","slug":"iOS/åŒ…ç®¡ç†å™¨","permalink":"https://jigangduan.github.io/categories/iOS/åŒ…ç®¡ç†å™¨/"},{"name":"Android è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/categories/Android/Android-è‡ªåŠ¨åŒ–æµ‹è¯•/"},{"name":"Androidæ¶æ„ç»„ä»¶","slug":"Android/Androidæ¶æ„ç»„ä»¶","permalink":"https://jigangduan.github.io/categories/Android/Androidæ¶æ„ç»„ä»¶/"},{"name":"Kotlin","slug":"Kotlin","permalink":"https://jigangduan.github.io/categories/Kotlin/"},{"name":"Anko","slug":"Kotlin/Anko","permalink":"https://jigangduan.github.io/categories/Kotlin/Anko/"},{"name":"ADB","slug":"Android/ADB","permalink":"https://jigangduan.github.io/categories/Android/ADB/"},{"name":"NDK","slug":"Android/NDK","permalink":"https://jigangduan.github.io/categories/Android/NDK/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"Android/è¯»ä¹¦ç¬”è®°","permalink":"https://jigangduan.github.io/categories/Android/è¯»ä¹¦ç¬”è®°/"},{"name":"Appç ”å‘å½•","slug":"Android/è¯»ä¹¦ç¬”è®°/Appç ”å‘å½•","permalink":"https://jigangduan.github.io/categories/Android/è¯»ä¹¦ç¬”è®°/Appç ”å‘å½•/"},{"name":"Swift","slug":"iOS/Swift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/"},{"name":"RxSwift","slug":"iOS/Swift/RxSwift","permalink":"https://jigangduan.github.io/categories/iOS/Swift/RxSwift/"},{"name":"æ¶æ„è®¾è®¡","slug":"iOS/æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/categories/iOS/æ¶æ„è®¾è®¡/"},{"name":"TCLMOVE","slug":"iOS/æ¶æ„è®¾è®¡/TCLMOVE","permalink":"https://jigangduan.github.io/categories/iOS/æ¶æ„è®¾è®¡/TCLMOVE/"},{"name":"å¹»ç¯ç‰‡","slug":"å‰ç«¯/å¹»ç¯ç‰‡","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/å¹»ç¯ç‰‡/"},{"name":"Androidä¼˜åŒ–","slug":"Android/Androidä¼˜åŒ–","permalink":"https://jigangduan.github.io/categories/Android/Androidä¼˜åŒ–/"},{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"Java/ç¬¬ä¸‰æ–¹åº“","permalink":"https://jigangduan.github.io/categories/Java/ç¬¬ä¸‰æ–¹åº“/"},{"name":"Android ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","slug":"Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ","permalink":"https://jigangduan.github.io/categories/Android/Android-ç”¨æˆ·ç•Œé¢çš„æœ€ä½³å®è·µ/"},{"name":"åŒ…ç®¡ç†å™¨","slug":"Python/åŒ…ç®¡ç†å™¨","permalink":"https://jigangduan.github.io/categories/Python/åŒ…ç®¡ç†å™¨/"},{"name":"æŒ‡å—","slug":"Spring/æŒ‡å—","permalink":"https://jigangduan.github.io/categories/Spring/æŒ‡å—/"},{"name":"é¡¾åŸ","slug":"é¡¾åŸ","permalink":"https://jigangduan.github.io/categories/é¡¾åŸ/"},{"name":"æ¨¡æ¿å¼•æ“","slug":"å‰ç«¯/æ¨¡æ¿å¼•æ“","permalink":"https://jigangduan.github.io/categories/å‰ç«¯/æ¨¡æ¿å¼•æ“/"}],"tags":[{"name":"K.K éŸ³æ¨™","slug":"K-K-éŸ³æ¨™","permalink":"https://jigangduan.github.io/tags/K-K-éŸ³æ¨™/"},{"name":"SQL","slug":"SQL","permalink":"https://jigangduan.github.io/tags/SQL/"},{"name":"æ¨è","slug":"æ¨è","permalink":"https://jigangduan.github.io/tags/æ¨è/"},{"name":"python","slug":"python","permalink":"https://jigangduan.github.io/tags/python/"},{"name":"javascript","slug":"javascript","permalink":"https://jigangduan.github.io/tags/javascript/"},{"name":"nodejs","slug":"nodejs","permalink":"https://jigangduan.github.io/tags/nodejs/"},{"name":"golang","slug":"golang","permalink":"https://jigangduan.github.io/tags/golang/"},{"name":"æ–‡æ¡£","slug":"æ–‡æ¡£","permalink":"https://jigangduan.github.io/tags/æ–‡æ¡£/"},{"name":"java","slug":"java","permalink":"https://jigangduan.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://jigangduan.github.io/tags/spring/"},{"name":"spring cloud","slug":"spring-cloud","permalink":"https://jigangduan.github.io/tags/spring-cloud/"},{"name":"nacos","slug":"nacos","permalink":"https://jigangduan.github.io/tags/nacos/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://jigangduan.github.io/tags/å‰ç«¯/"},{"name":"reactjs","slug":"reactjs","permalink":"https://jigangduan.github.io/tags/reactjs/"},{"name":"mysql","slug":"mysql","permalink":"https://jigangduan.github.io/tags/mysql/"},{"name":"sql","slug":"sql","permalink":"https://jigangduan.github.io/tags/sql/"},{"name":"css","slug":"css","permalink":"https://jigangduan.github.io/tags/css/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://jigangduan.github.io/tags/å·¥å…·/"},{"name":"linux","slug":"linux","permalink":"https://jigangduan.github.io/tags/linux/"},{"name":"django","slug":"django","permalink":"https://jigangduan.github.io/tags/django/"},{"name":"api","slug":"api","permalink":"https://jigangduan.github.io/tags/api/"},{"name":"å®ä¾‹","slug":"å®ä¾‹","permalink":"https://jigangduan.github.io/tags/å®ä¾‹/"},{"name":"github","slug":"github","permalink":"https://jigangduan.github.io/tags/github/"},{"name":"android","slug":"android","permalink":"https://jigangduan.github.io/tags/android/"},{"name":"jetpack","slug":"jetpack","permalink":"https://jigangduan.github.io/tags/jetpack/"},{"name":"kafka","slug":"kafka","permalink":"https://jigangduan.github.io/tags/kafka/"},{"name":"maps","slug":"maps","permalink":"https://jigangduan.github.io/tags/maps/"},{"name":"spring-boot","slug":"spring-boot","permalink":"https://jigangduan.github.io/tags/spring-boot/"},{"name":"httpie","slug":"httpie","permalink":"https://jigangduan.github.io/tags/httpie/"},{"name":"editor","slug":"editor","permalink":"https://jigangduan.github.io/tags/editor/"},{"name":"sites","slug":"sites","permalink":"https://jigangduan.github.io/tags/sites/"},{"name":"blog","slug":"blog","permalink":"https://jigangduan.github.io/tags/blog/"},{"name":"oos","slug":"oos","permalink":"https://jigangduan.github.io/tags/oos/"},{"name":"minio","slug":"minio","permalink":"https://jigangduan.github.io/tags/minio/"},{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"https://jigangduan.github.io/tags/ç¿»è¯‘/"},{"name":"iot","slug":"iot","permalink":"https://jigangduan.github.io/tags/iot/"},{"name":"mq","slug":"mq","permalink":"https://jigangduan.github.io/tags/mq/"},{"name":"paas","slug":"paas","permalink":"https://jigangduan.github.io/tags/paas/"},{"name":"shell","slug":"shell","permalink":"https://jigangduan.github.io/tags/shell/"},{"name":"vscode","slug":"vscode","permalink":"https://jigangduan.github.io/tags/vscode/"},{"name":"sql-server","slug":"sql-server","permalink":"https://jigangduan.github.io/tags/sql-server/"},{"name":"yeoman","slug":"yeoman","permalink":"https://jigangduan.github.io/tags/yeoman/"},{"name":"extension","slug":"extension","permalink":"https://jigangduan.github.io/tags/extension/"},{"name":"å•ç‚¹ç™»å½•","slug":"å•ç‚¹ç™»å½•","permalink":"https://jigangduan.github.io/tags/å•ç‚¹ç™»å½•/"},{"name":"pixijs","slug":"pixijs","permalink":"https://jigangduan.github.io/tags/pixijs/"},{"name":"æ¸¸æˆ","slug":"æ¸¸æˆ","permalink":"https://jigangduan.github.io/tags/æ¸¸æˆ/"},{"name":"hexi","slug":"hexi","permalink":"https://jigangduan.github.io/tags/hexi/"},{"name":"webapp","slug":"webapp","permalink":"https://jigangduan.github.io/tags/webapp/"},{"name":"go-micro","slug":"go-micro","permalink":"https://jigangduan.github.io/tags/go-micro/"},{"name":"redis","slug":"redis","permalink":"https://jigangduan.github.io/tags/redis/"},{"name":"react-native","slug":"react-native","permalink":"https://jigangduan.github.io/tags/react-native/"},{"name":"expo","slug":"expo","permalink":"https://jigangduan.github.io/tags/expo/"},{"name":"ios","slug":"ios","permalink":"https://jigangduan.github.io/tags/ios/"},{"name":"swift","slug":"swift","permalink":"https://jigangduan.github.io/tags/swift/"},{"name":"php","slug":"php","permalink":"https://jigangduan.github.io/tags/php/"},{"name":"symfony","slug":"symfony","permalink":"https://jigangduan.github.io/tags/symfony/"},{"name":"ç”µå•†","slug":"ç”µå•†","permalink":"https://jigangduan.github.io/tags/ç”µå•†/"},{"name":"é€†å‘","slug":"é€†å‘","permalink":"https://jigangduan.github.io/tags/é€†å‘/"},{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","permalink":"https://jigangduan.github.io/tags/åç¼–è¯‘/"},{"name":"jvm","slug":"jvm","permalink":"https://jigangduan.github.io/tags/jvm/"},{"name":"cocoapods","slug":"cocoapods","permalink":"https://jigangduan.github.io/tags/cocoapods/"},{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","slug":"è‡ªåŠ¨åŒ–æµ‹è¯•","permalink":"https://jigangduan.github.io/tags/è‡ªåŠ¨åŒ–æµ‹è¯•/"},{"name":"æ¶æ„è®¾è®¡","slug":"æ¶æ„è®¾è®¡","permalink":"https://jigangduan.github.io/tags/æ¶æ„è®¾è®¡/"},{"name":"kotlin","slug":"kotlin","permalink":"https://jigangduan.github.io/tags/kotlin/"},{"name":"kotlinx.coroutines","slug":"kotlinx-coroutines","permalink":"https://jigangduan.github.io/tags/kotlinx-coroutines/"},{"name":"anko","slug":"anko","permalink":"https://jigangduan.github.io/tags/anko/"},{"name":"adb","slug":"adb","permalink":"https://jigangduan.github.io/tags/adb/"},{"name":"ndk","slug":"ndk","permalink":"https://jigangduan.github.io/tags/ndk/"},{"name":"notes","slug":"notes","permalink":"https://jigangduan.github.io/tags/notes/"},{"name":"app","slug":"app","permalink":"https://jigangduan.github.io/tags/app/"},{"name":"rxswift","slug":"rxswift","permalink":"https://jigangduan.github.io/tags/rxswift/"},{"name":"atom","slug":"atom","permalink":"https://jigangduan.github.io/tags/atom/"},{"name":"idea","slug":"idea","permalink":"https://jigangduan.github.io/tags/idea/"},{"name":"uml","slug":"uml","permalink":"https://jigangduan.github.io/tags/uml/"},{"name":"ppt","slug":"ppt","permalink":"https://jigangduan.github.io/tags/ppt/"},{"name":"android-ui","slug":"android-ui","permalink":"https://jigangduan.github.io/tags/android-ui/"},{"name":"è¯—","slug":"è¯—","permalink":"https://jigangduan.github.io/tags/è¯—/"},{"name":"é¡¾åŸ","slug":"é¡¾åŸ","permalink":"https://jigangduan.github.io/tags/é¡¾åŸ/"},{"name":"æ¨¡æ¿å¼•æ“","slug":"æ¨¡æ¿å¼•æ“","permalink":"https://jigangduan.github.io/tags/æ¨¡æ¿å¼•æ“/"},{"name":"markdown","slug":"markdown","permalink":"https://jigangduan.github.io/tags/markdown/"}]}