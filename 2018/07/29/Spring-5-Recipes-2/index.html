<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>spring 核心任务 | 朝着牛逼的道路一路狂奔</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="javaspring">
  
  
  
  
  <meta name="description" content="在本章中，您将了解与Spring相关的核心任务。Spring框架的核心是Spring控制反转(Io0043)容器。IoC容器用于管理和配置普通的旧Java对象(POJOs)。因为Spring框架的主要诉求之一是使用pojo构建Java应用程序，Spring的许多核心任务都涉及到在IoC容器中管理和配置POJOs。 因此，无论您打算在web应用程序、企业集成或其他类型的项目中使用Spring框架，">
<meta name="keywords" content="java,spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 核心任务">
<meta property="og:url" content="https://jigangduan.github.io/2018/07/29/Spring-5-Recipes-2/index.html">
<meta property="og:site_name" content="朝着牛逼的道路一路狂奔">
<meta property="og:description" content="在本章中，您将了解与Spring相关的核心任务。Spring框架的核心是Spring控制反转(Io0043)容器。IoC容器用于管理和配置普通的旧Java对象(POJOs)。因为Spring框架的主要诉求之一是使用pojo构建Java应用程序，Spring的许多核心任务都涉及到在IoC容器中管理和配置POJOs。 因此，无论您打算在web应用程序、企业集成或其他类型的项目中使用Spring框架，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1532860369549&di=2a8997ffc5dad85bea5e24cfa55877f7&imgtype=0&src=http%3A%2F%2Fpic.58pic.com%2F58pic%2F14%2F21%2F83%2F158PICJ58PICmFp_1024.jpg">
<meta property="og:updated_time" content="2020-07-25T02:57:18.165Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring 核心任务">
<meta name="twitter:description" content="在本章中，您将了解与Spring相关的核心任务。Spring框架的核心是Spring控制反转(Io0043)容器。IoC容器用于管理和配置普通的旧Java对象(POJOs)。因为Spring框架的主要诉求之一是使用pojo构建Java应用程序，Spring的许多核心任务都涉及到在IoC容器中管理和配置POJOs。 因此，无论您打算在web应用程序、企业集成或其他类型的项目中使用Spring框架，">
<meta name="twitter:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1532860369549&di=2a8997ffc5dad85bea5e24cfa55877f7&imgtype=0&src=http%3A%2F%2Fpic.58pic.com%2F58pic%2F14%2F21%2F83%2F158PICJ58PICmFp_1024.jpg">
  
    <link rel="alternate" href="/atom.xml" title="朝着牛逼的道路一路狂奔" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt; src:url("/css/fonts/FuturaPTBold.otf") format("woff");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt-light; src:url("/css/fonts/FuturaPTBook.otf") format("woff");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt-italic; src:url("/css/fonts/FuturaPTBookOblique.otf") format("woff");font-weight:400;font-style:italic;}
}

  </style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css">
  

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Spring-5-Recipes-2" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Spring 核心任务
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/07/29/Spring-5-Recipes-2/" class="article-date">
	  <time datetime="2018-07-29T10:05:28.000Z" itemprop="datePublished">2018-07-29</time>
	</a>

      
    <a class="article-category-link" href="/categories/Spring/">Spring</a><a class="article-category-link" href="/categories/Spring/开发范例代码大全/">开发范例代码大全</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1532860369549&amp;di=2a8997ffc5dad85bea5e24cfa55877f7&amp;imgtype=0&amp;src=http%3A%2F%2Fpic.58pic.com%2F58pic%2F14%2F21%2F83%2F158PICJ58PICmFp_1024.jpg" alt="spring"></p>
<p>在本章中，您将了解与Spring相关的核心任务。Spring框架的核心是Spring控制反转(Io0043)容器。IoC容器用于管理和配置普通的旧Java对象(POJOs)。因为Spring框架的主要诉求之一是使用pojo构建Java应用程序，Spring的许多核心任务都涉及到在IoC容器中管理和配置POJOs。</p>
<p>因此，无论您打算在web应用程序、企业集成或其他类型的项目中使用Spring框架，使用pojo和IoC容器是您需要采取的第一步。本章的大部分食谱涵盖了您将在本书中使用的任务，并在日常基础上开发Spring应用程序。</p>
<blockquote>
<p>■注意术语使用POJO bean交替使用实例在春天在这本书和文档。两者都引用从Java类创建的对象实例。此外，在本书和Spring文档中，术语组件可与POJO类互换使用。两者都引用创建对象实例的实际Java类。<br>■提示下载的源代码组织使用Gradle(通过Gradle包装器)来构建菜谱应用程序。Gradle将负责加载所有必需的Java类和依赖项，并创建一个可执行的JAR文件。第1章描述了如何设置渐变工具。此外，如果一个菜谱演示了不止一种方法，那么源代码将使用罗马字母(例如Recipe_2_1_i、Recipe_2_1_ii、Recipe_2_1_iii等)进行分类。</p>
</blockquote>
<p>要构建每个应用程序，请进入Recipe目录(例如Ch2/Recipe_2_1_i/)并执行./gradlew构建命令来编译源代码。编译源代码之后，将使用应用程序可执行文件创建一个build/libs子目录。然后可以从命令行运行应用程序JAR(例如，java -jar Recipe_2_1_i-4.0.0.jar)。</p>
<h1 id="使用Java配置来配置POJOs"><a href="#使用Java配置来配置POJOs" class="headerlink" title="使用Java配置来配置POJOs"></a>使用Java配置来配置POJOs</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>您希望使用Spring的IoC容器管理带有注释的POJOs。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>设计一个POJO类。接下来，使用@Configuration和@Bean注释创建一个Java配置类，以配置POJO实例值，或者使用@Component、@Repository、@Service或@Controller注释设置Java组件，以稍后创建POJO实例值。接下来，实例化Spring IoC容器，以使用注释扫描Java类。然后可以访问POJO实例或bean实例，将它们作为应用程序的一部分放在一起。</p>
<h2 id="它是如何工作的"><a href="#它是如何工作的" class="headerlink" title="它是如何工作的"></a>它是如何工作的</h2><p>假设您要开发一个应用程序来生成序列号，并且需要许多系列的序列号来满足不同的用途。每个序列都有自己的前缀、后缀和初始值。因此，您必须为应用程序创建和维护多个生成器实例。创建一个POJO类来使用Java配置创建bean。</p>
<p>按照要求，您创建了一个具有三个属性的SequenceGenerator类:前缀、后缀和initial。您还可以创建一个私有字段计数器来存储每个生成器的数值。每次在生成器实例上调用getSequence()方法时，都会得到最后一个序列号，其中包含前缀和后缀。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> initial;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger counter = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SequenceGenerator</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInitial</span><span class="params">(<span class="keyword">int</span> initial)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.initial = initial;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSequence</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        builder.append(prefix)</span><br><span class="line">                .append(initial)</span><br><span class="line">                .append(counter.getAndIncrement())</span><br><span class="line">                .append(suffix);</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-Configuration和-Bean创建一个Java配置来创建POJOs"><a href="#使用-Configuration和-Bean创建一个Java配置来创建POJOs" class="headerlink" title="使用@Configuration和@Bean创建一个Java配置来创建POJOs"></a>使用@Configuration和@Bean创建一个Java配置来创建POJOs</h2><p>要在Spring IoC容器中定义POJO类的实例，可以使用实例化值创建一个Java配置类。带有POJO或bean定义的Java配置类如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGeneratorConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SequenceGenerator <span class="title">sequenceGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SequenceGenerator seqgen = <span class="keyword">new</span> SequenceGenerator();</span><br><span class="line">        seqgen.setPrefix(<span class="string">"30"</span>);</span><br><span class="line">        seqgen.setSuffix(<span class="string">"A"</span>);</span><br><span class="line">        seqgen.setInitial(<span class="string">"100000"</span>);</span><br><span class="line">        <span class="keyword">return</span> seqgen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，<code>SequenceGeneratorConfiguration</code>类被<code>@Configuration</code>注释修饰;这告诉Spring它是一个配置类。当Spring遇到带有<code>@Configuration</code>注释的类时，它会在类中查找bean实例定义，这是用@Bean注释修饰的Java方法。Java方法创建并返回一个bean实例。</p>
<p>使用@Bean注释修饰的任何方法定义都会基于方法名生成一个bean名。或者，您可以使用name属性显式地在@Bean注释中指定bean名称。例如，@Bean(name=”mys1”)使bean可用作mys1。</p>
<blockquote>
<p>■注意如果您显式地指定bean名称,方法名被忽略的bean创建。</p>
</blockquote>
<h2 id="实例化Spring-IoC容器以扫描注释"><a href="#实例化Spring-IoC容器以扫描注释" class="headerlink" title="实例化Spring IoC容器以扫描注释"></a>实例化Spring IoC容器以扫描注释</h2><p>您必须实例化Spring IoC容器来扫描包含注释的Java类。这样，Spring将检测<code>@Configuration</code>和<code>@Bean</code>注释，以便以后可以从IoC容器本身获得bean实例。</p>
<p>Spring提供了两种类型的IoC容器实现。最基本的一个叫做bean factory。更高级的称为应用程序上下文，它与bean工厂兼容。注意，这两种IoC容器的配置文件是相同的。</p>
<p>应用程序上下文提供比bean工厂更高级的特性，同时保持基本特性的兼容性。因此，我们强烈建议在每个应用程序中使用应用程序上下文，除非应用程序的资源受到限制(例如，当为一个applet运行Spring时，或者移动设备)。bean工厂的接口和应用程序上下文分别是BeanFactory和ApplicationContext。ApplicationContext接口是BeanFactory的一个子接口，用于维护兼容性。</p>
<p>由于<code>ApplicationContext</code>是一个接口，您必须实例化一个实现它。Spring有几个应用程序上下文实现;我们建议您使用<code>AnnotationConfigApplicationContext</code>，这是最新且最灵活的实现。通过这个类，您可以加载Java配置文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext</span><br><span class="line">    (SequenceGeneratorConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>一旦实例化了应用程序上下文，对象引用(在本例中是上下文)提供了访问POJO实例或bean的入口点。</p>
<h2 id="从IoC容器获取POJO实例或bean"><a href="#从IoC容器获取POJO实例或bean" class="headerlink" title="从IoC容器获取POJO实例或bean"></a>从IoC容器获取POJO实例或bean</h2><p>要从bean工厂或应用程序上下文获取已声明的bean，只需调用<code>getBean()</code>方法并传入惟一的bean名称。<code>getBean()</code>方法的返回类型是<code>java.lang.Object</code>，因此必须在使用它之前将它转换为它的实际类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SequenceGenerator generator =</span><br><span class="line">    (SequenceGenerator) context.getBean(<span class="string">"sequenceGenerator"</span>);</span><br></pre></td></tr></table></figure>
<p>getBean()方法还支持另一种变体，您可以在其中提供bean类名，以避免强制转换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SequenceGenerator generator = context.getBean(<span class="string">"sequenceGenerator"</span>,SequenceGenerator<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>如果只有一个bean，则可以省略该bean的名称。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SequenceGenerator generator = context.getBean(SequenceGenerator<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>一旦您达到这个步骤，您就可以使用POJO或bean，就像在Spring之外使用构造函数创建的任何对象一样。<br>运行序列生成器应用程序的主类如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.config.SequenceGeneratorConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context =</span><br><span class="line">            <span class="keyword">new</span> AnnotationConfigApplicationContext(SequenceGeneratorConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        SequenceGenerator generator = context.getBean(SequenceGenerator<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(generator.getSequence());</span><br><span class="line">        System.out.println(generator.getSequence());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果Java类路径中所有内容都可用(SequenceGenerator POJO类和Spring JAR)<br>您应该看到以下输出，以及一些日志消息:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">30100000A</span><br><span class="line">30100001A</span><br></pre></td></tr></table></figure>
<h2 id="使用-Component注释创建POJO类，以使用DAO创建Beans"><a href="#使用-Component注释创建POJO类，以使用DAO创建Beans" class="headerlink" title="使用@Component注释创建POJO类，以使用DAO创建Beans"></a>使用@Component注释创建POJO类，以使用DAO创建Beans</h2><p>到目前为止，Spring bean实例化是通过硬编码Java配置类中的值来完成的。这是简化Spring示例的首选方法。</p>
<p>然而，大多数应用程序的POJO实例化过程都是通过数据库或用户输入完成的。所以，现在是时候向前迈进，使用更真实的场景了。对于本节，我们将使用域类和数据访问对象(DAO)类来创建pojo。您仍然不需要设置数据库—实际上，您将在DAO类中硬编码值—但是熟悉这种类型的应用程序结构非常重要，因为它是大多数真实应用程序和未来菜谱的基础。</p>
<p>假设您被要求开发一个序列生成器应用程序，就像您在前一节中所做的那样。您需要稍微修改类结构以适应域类和DAO模式。首先，创建一个名为Sequence的域类，其中包含id、前缀和后缀属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sequence</span><span class="params">(String id, String prefix, String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，为DAO创建一个接口，这个接口负责从数据库访问数据。getSequence()方法通过ID从数据库表中加载POJO或Sequence对象，而getNextValue()方法检索特定数据库序列的下一个值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SequenceDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sequence <span class="title">getSequence</span><span class="params">(String sequenceId)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNextValue</span><span class="params">(String sequenceId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在生产应用程序中，您将实现这个DAO接口来使用数据访问技术。但是为了简化这个示例，您将在映射中实现一个带有硬编码值的DAO来存储序列实例和值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"sequenceDao"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceDaoImpl</span> <span class="keyword">implements</span> <span class="title">SequenceDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Sequence&gt; sequences = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, AtomicInteger&gt; values = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SequenceDaoImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sequences.put(<span class="string">"IT"</span>, <span class="keyword">new</span> Sequence(<span class="string">"IT"</span>, <span class="string">"30"</span>, <span class="string">"A"</span>));</span><br><span class="line">        values.put(<span class="string">"IT"</span>, <span class="keyword">new</span> AtomicInteger(<span class="number">10000</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sequence <span class="title">getSequence</span><span class="params">(String sequenceId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sequences.get(sequenceId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNextValue</span><span class="params">(String sequenceId)</span> </span>&#123;</span><br><span class="line">        AtomicInteger value = values.get(sequenceId);</span><br><span class="line">        <span class="keyword">return</span> value.getAndIncrement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察SequenceDaoImpl类是如何用@Component(“sequenceDao”)注释来修饰的。这将标记类，以便Spring可以从中创建POJOs。@Component注释内的值定义了bean实例ID，在本例中为sequenceDao。如果@Component注释中没有提供bean值名，那么默认情况下，bean名被指定为大写的非限定类名。例如，对于SequenceDaoImpl类，默认的bean名称是SequenceDaoImpl。<br>对getSequence方法的调用返回给定sequenceID的值。对getNextValue方法的调用基于给定的sequenceID的值创建一个新值，并返回新值。</p>
<p>POJOs在应用程序层中被分类。在Spring中，有三个层:persistence, service, 和 presentation。@Component是一个通用的注释，用于装饰用于Spring检测的POJOs，而@Repository、@Service和@Controller是@Component的专门化，用于处理与持久性、服务和表示层相关的pojo的更具体的情况。</p>
<p>如果您不确定POJO的用途，可以使用@Component注释来修饰它。但是，最好尽可能地使用专门化注释，因为这些注释提供了基于POJO目的的额外功能(例如，@Repository将异常包装为DataAccessExceptions，这使调试更容易)。</p>
<h2 id="用过滤器实例化Spring-IoC容器，以扫描注释"><a href="#用过滤器实例化Spring-IoC容器，以扫描注释" class="headerlink" title="用过滤器实例化Spring IoC容器，以扫描注释"></a>用过滤器实例化Spring IoC容器，以扫描注释</h2><p>在默认情况下，Spring检测所有使用@Configuration、@Bean、@Component、@Repository、@Service和@Controller注释的类，以及其他。您可以自定义扫描过程以包含一个或多个包含/排除过滤器。当Java包有几十或几百个类时，这是很有用的。对于某些Spring应用程序上下文，可能需要排除或包含带有特定注释的pojo。</p>
<blockquote>
<p>■警告扫描每个包都可以降低不必要的启动过程。</p>
</blockquote>
<p>Spring支持四种类型的过滤器表达式。注释和可分配的类型是指定一个注释类型和一个用于过滤的类/接口。regex和aspectj类型允许您指定正则表达式和aspectj切入点表达式来匹配类。您还可以使用use-default-filters属性禁用默认过滤器。</p>
<p>例如，下面的组件扫描包括com.apress.springrecipe中的所有类。序列，其名称包含单词Dao或服务，并排除带有@Controller注释的类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    includeFilters = &#123;</span><br><span class="line">        <span class="meta">@ComponentScan</span>.Filter(</span><br><span class="line">            type = FilterType.REGEX,</span><br><span class="line">            pattern = &#123;<span class="string">"com.apress.springrecipes.sequence.*Dao"</span>,</span><br><span class="line">                       <span class="string">"com.apress.springrecipes.sequence.*Service"</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    excludeFilters = &#123;</span><br><span class="line">        <span class="meta">@ComponentScan</span>.Filter(</span><br><span class="line">            type = FilterType.ANNOTATION,</span><br><span class="line">            classes = &#123;org.springframework.stereotype.Controller<span class="class">.<span class="keyword">class</span>&#125;) &#125;</span></span><br><span class="line"><span class="class">)</span></span><br></pre></td></tr></table></figure>
<p>当应用包含过滤器时，可以检测所有名称包含“Dao”或“服务”的类。<br>没有注释的类被自动检测。</p>
<h2 id="从IoC容器获取POJO实例或bean-1"><a href="#从IoC容器获取POJO实例或bean-1" class="headerlink" title="从IoC容器获取POJO实例或bean"></a>从IoC容器获取POJO实例或bean</h2><p>然后，您可以使用以下主要类来测试前面的组件:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context =</span><br><span class="line">            <span class="keyword">new</span> AnnotationConfigApplicationContext(<span class="string">"com.apress.springrecipes.sequence"</span>);</span><br><span class="line">        SequenceDao sequenceDao = context.getBean(SequenceDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(sequenceDao.getNextValue(<span class="string">"IT"</span>));</span><br><span class="line">        System.out.println(sequenceDao.getNextValue(<span class="string">"IT"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="通过调用构造函数创建POJOs"><a href="#通过调用构造函数创建POJOs" class="headerlink" title="通过调用构造函数创建POJOs"></a>通过调用构造函数创建POJOs</h1><p>问题</p>
<p>您希望通过调用其构造函数在Spring IoC容器中创建POJO实例或bean，这是创建bean的最常见和最直接的方式。这相当于使用新的操作符在Java中创建对象。</p>
<p>解决方案</p>
<p>使用构造函数或构造函数定义POJO类。接下来，创建一个Java配置类，用构造函数为Spring IoC容器配置POJO实例值。接下来，实例化Spring IoC容器，以使用注释扫描Java类。POJO实例或bean实例可以作为应用程序的一部分放在一起。</p>
<p>它是如何工作的</p>
<p>假设您要开发一个商店应用程序来在线销售产品。首先，创建Product POJO类，它有几个属性，比如产品名称和价格。由于您的商店中有许多类型的产品，所以您将产品类抽象为不同的产品子类扩展它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String name, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">// Getters and Setters</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">" "</span> + price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用构造函数创建POJO类"><a href="#使用构造函数创建POJO类" class="headerlink" title="使用构造函数创建POJO类"></a>使用构造函数创建POJO类</h2><p>然后创建两个产品子类:电池和磁盘。它们每个都有自己的属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Battery</span> <span class="keyword">extends</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> rechargeable;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Battery</span><span class="params">()</span> </span>&#123; <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Battery</span><span class="params">(String name, <span class="keyword">double</span> price)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">super</span>(name, price);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">// Getters and Setters</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Disc</span> <span class="keyword">extends</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Disc</span><span class="params">()</span> </span>&#123; <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Disc</span><span class="params">(String name, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, price);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="为POJO创建一个Java配置"><a href="#为POJO创建一个Java配置" class="headerlink" title="为POJO创建一个Java配置"></a>为POJO创建一个Java配置</h2><p>要在Spring IoC容器中定义POJO类的实例，必须创建具有实例化值的Java配置类。<br>通过调用构造函数生成具有POJO或bean定义的Java配置类应该如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Battery;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Disc;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Product;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">aaa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Battery p1 = <span class="keyword">new</span> Battery(<span class="string">"AAA"</span>, <span class="number">2.5</span>);</span><br><span class="line">        p1.setRechargeable(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> p1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">cdrw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Disc p2 = <span class="keyword">new</span> Disc(<span class="string">"CD-RW"</span>, <span class="number">1.5</span>);</span><br><span class="line">        p2.setCapacity(<span class="number">700</span>);</span><br><span class="line">        <span class="keyword">return</span> p2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，通过从Spring IoC容器中检索产品，您可以编写以下主要类来测试产品:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.config.ShopConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ApplicationContext context =</span><br><span class="line">            <span class="keyword">new</span> AnnotationConfigApplicationContext(ShopConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Product aaa = context.getBean(<span class="string">"aaa"</span>, Product<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Product cdrw = context.getBean(<span class="string">"cdrw"</span>, Product<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(aaa);</span><br><span class="line">        System.out.println(cdrw);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用POJO引用和自动连接与其他POJO交互"><a href="#使用POJO引用和自动连接与其他POJO交互" class="headerlink" title="使用POJO引用和自动连接与其他POJO交互"></a>使用POJO引用和自动连接与其他POJO交互</h1><p>问题</p>
<p>组成应用程序的POJO实例或bean通常需要相互协作才能完成应用程序的功能。您希望使用注释来使用POJO引用和自动连接。</p>
<p>解决方案</p>
<p>对于Java配置类中定义的POJO实例，可以使用标准Java代码在bean之间创建引用。要自动连接POJO引用，可以使用@Autowired注释标记字段、setter方法、构造函数，甚至任意方法。</p>
<p>它是如何工作的</p>
<p>首先，我们将介绍使用构造函数、字段和属性的不同的自动配线方法。最后，您将了解如何解决自动装配中的问题。</p>
<h2 id="在Java配置类中引用POJOs"><a href="#在Java配置类中引用POJOs" class="headerlink" title="在Java配置类中引用POJOs"></a>在Java配置类中引用POJOs</h2><p>当POJO实例在Java配置类中定义时(如2-1和2- POJO引用中所示)，使用起来很简单，因为一切都是Java代码。在下面的示例中，bean属性引用另一个bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.DatePrefixGenerator;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.SequenceGenerator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DatePrefixGenerator <span class="title">datePrefixGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DatePrefixGenerator dpg = <span class="keyword">new</span> DatePrefixGenerator();</span><br><span class="line">        dpg.setPattern(<span class="string">"yyyyMMdd"</span>);</span><br><span class="line">        <span class="keyword">return</span> dpg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SequenceGenerator <span class="title">sequenceGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SequenceGenerator sequence = <span class="keyword">new</span> SequenceGenerator();</span><br><span class="line">        sequence.setInitial(<span class="number">100000</span>);</span><br><span class="line">        sequence.setSuffix(<span class="string">"A"</span>);</span><br><span class="line">        sequence.setPrefixGenerator(datePrefixGenerator()); </span><br><span class="line">        <span class="keyword">return</span> sequence;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SequenceGenerator类的前缀生成器属性是DatePrefixGenerator bean的实例。<br>第一个bean声明创建一个DatePrefixGenerator POJO。<br>按照约定，bean可以通过bean名称datePrefixGenerator(例如。方法名)。<br>但是由于bean实例化逻辑也是一种标准的Java方法，因此通过进行标准Java调用也可以访问bean。<br>当prefixGenerator属性被放置到第二个bean中时，通过settera对datePrefixGenerator()方法进行标准的Java调用，以引用bean。</p>
<h2 id="使用-Autowired注释自动连接POJO字段"><a href="#使用-Autowired注释自动连接POJO字段" class="headerlink" title="使用@Autowired注释自动连接POJO字段"></a>使用@Autowired注释自动连接POJO字段</h2><p>接下来，让我们在2-1的第二部分介绍的DAO SequenceDaoImpl类的SequenceDao字段上使用自动布线。您将向应用程序添加一个服务类，以说明与DAO类的自动连接。<br>一个服务类生成服务对象是另一个真实世界的应用程序的最佳实践,充当faç正面直接访问DAOs-instead访问DAOs。在内部，服务对象与DAO交互以处理序列生成请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SequenceDao sequenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSequenceDao</span><span class="params">(SequenceDao sequenceDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sequenceDao = sequenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generate</span><span class="params">(String sequenceId)</span> </span>&#123;</span><br><span class="line">        Sequence sequence = sequenceDao.getSequence(sequenceId);</span><br><span class="line">        <span class="keyword">int</span> value = sequenceDao.getNextValue(sequenceId);</span><br><span class="line">        <span class="keyword">return</span> sequence.getPrefix() + value + sequence.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SequenceService类使用@Component注释进行修饰。这允许Spring检测POJO。因为@Component注释没有名称，所以默认的bean名称是sequenceService，它基于类名。</p>
<p>SequenceService类的sequenceDao属性使用@Autowired注释进行修饰。这允许Spring使用sequenceDao bean(即SequenceDaoImpl类)。</p>
<p>@Autowired注解还可以应用于数组类型的属性，使Spring自动连接所有匹配的bean。例如，可以使用@Autowired对前缀生成器[]属性进行注释。然后，Spring将一次自动连接所有类型与前缀生成器兼容的bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PrefixGenerator[] prefixGenerators;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有多个bean的类型与IoC容器中定义的前缀生成器兼容，它们将自动添加到前缀生成器数组中。<br>以类似的方式，您可以将@Autowired注释应用于类型安全的集合。Spring可以读取此集合的类型信息，并自动连接类型兼容的所有bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;PrefixGenerator&gt; prefixGenerators;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果Spring注意到@Autowired注释被应用到类型安全的 java.util.Map，字符串为键，它将把兼容类型的所有bean(以bean名称作为键)添加到这个map中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, PrefixGenerator&gt; prefixGenerators;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-Autowired注解的Autowire-POJO方法和构造函数，并可选择自动配线"><a href="#使用-Autowired注解的Autowire-POJO方法和构造函数，并可选择自动配线" class="headerlink" title="使用@Autowired注解的Autowire POJO方法和构造函数，并可选择自动配线"></a>使用@Autowired注解的Autowire POJO方法和构造函数，并可选择自动配线</h2><p>@Autowired注解也可以直接应用于POJO的setter方法。例如，可以使用@Autowired对prefixGenerator属性的setter方法进行注释。然后，Spring尝试连接类型与前缀生成器兼容的bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefixGenerator</span><span class="params">(PrefixGenerator prefixGenerator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefixGenerator = prefixGenerator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，所有带有@Autowired的属性都是必需的。当Spring无法找到匹配的bean时，它将抛出异常。如果您希望某个属性是可选的，那么将@Autowired的required属性设置为false。然后，当Spring无法找到匹配的bean时，它将保留此属性未设置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Autowired</span>(required=<span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefixGenerator</span><span class="params">(PrefixGenerator prefixGenerator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefixGenerator = prefixGenerator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您还可以将@Autowired注释应用于具有任意名称和任意数量参数的方法;在这种情况下，Spring尝试用兼容的类型为每一个方法参数连接一个bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myOwnCustomInjectionName</span><span class="params">(PrefixGenerator prefixGenerator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefixGenerator = prefixGenerator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，还可以将@Autowired注释应用到希望用于自动连接的构造函数。构造函数可以有任意数量的参数，Spring将尝试为每个构造函数参数连接具有兼容类型的bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SequenceDao sequenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SequenceService</span><span class="params">(SequenceDao sequenceDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sequenceDao=sequenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generate</span><span class="params">(String sequenceId)</span> </span>&#123;</span><br><span class="line">        Sequence sequence = sequenceDao.getSequence(sequenceId);</span><br><span class="line">        <span class="keyword">int</span> value = sequenceDao.getNextValue(sequenceId);</span><br><span class="line">        <span class="keyword">return</span> sequence.getPrefix() + value + sequence.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="用注释解决自动连接的模糊性"><a href="#用注释解决自动连接的模糊性" class="headerlink" title="用注释解决自动连接的模糊性"></a>用注释解决自动连接的模糊性</h2><p>默认情况下，当IoC容器中有多个具有兼容类型的bean，并且属性不是组类型(如数组、列表、映射)时，按类型自动连接将不起作用。但是，如果有多个相同类型的bean: @Primary注释和@Qualifier注释，则有两个方法可以根据类型自动连接。</p>
<h3 id="用-Primary注释解决自动连接的歧义"><a href="#用-Primary注释解决自动连接的歧义" class="headerlink" title="用@Primary注释解决自动连接的歧义"></a>用@Primary注释解决自动连接的歧义</h3><p>Spring允许您通过使用@Primary注释装饰候选bean，按类型指定候选bean。@Primary注释在多个候选对象符合自动连接单值依赖项的条件时，为bean提供优先级。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatePrefixGenerator</span> <span class="keyword">implements</span> <span class="title">PrefixGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd"</span>);</span><br><span class="line">        <span class="keyword">return</span> formatter.format(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，前面的POJO实现了PrefixGenerator接口，并使用@Primary注释进行修饰。如果您尝试使用PrefixGenerator类型自动连接一个bean，即使Spring有多个具有相同PrefixGenerator类型的bean实例，Spring也会自动连接DatePrefixGenerator，因为它使用@Primary注释进行标记。</p>
<h3 id="用-Qualifier注解解决自动连接的歧义"><a href="#用-Qualifier注解解决自动连接的歧义" class="headerlink" title="用@Qualifier注解解决自动连接的歧义"></a>用@Qualifier注解解决自动连接的歧义</h3><p>Spring还允许您通过在@Qualifier注释中提供其名称来按类型指定候选bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="meta">@Qualifier</span>(<span class="string">"datePrefixGenerator"</span>)</span><br><span class="line">    <span class="keyword">private</span> PrefixGenerator prefixGenerator;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完成此操作之后，Spring尝试在IoC容器中查找具有该名称的bean，并将其连接到属性中。<br>@Qualifier注释也可以应用于自动连接的方法参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myOwnCustomInjectionName</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Qualifier(<span class="string">"datePrefixGenerator"</span>)</span> PrefixGenerator prefixGenerator) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefixGenerator = prefixGenerator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果希望按名称自动连接bean属性，可以使用下一个菜谱中描述的JSR-250 @Resource注释一个setter方法、构造函数或字段。</p>
<h2 id="解析来自多个位置的POJO引用"><a href="#解析来自多个位置的POJO引用" class="headerlink" title="解析来自多个位置的POJO引用"></a>解析来自多个位置的POJO引用</h2><p>随着应用程序的增长，在单个Java配置类中管理每个POJO会变得很困难。</p>
<p>一个常见的实践是，根据pojo的功能将它们分成多个Java配置类。当您创建多个Java配置类时，获取在不同类中定义的引用和自动连接pojo并不像在单个Java配置类中一样简单。</p>
<p>一种方法是使用每个Java配置类的位置初始化应用程序上下文。通过这种方式，每个Java配置类的pojo都被加载到上下文和引用中，pojo之间的自动连接是可能的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext</span><br><span class="line">    (PrefixConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">SequenceGeneratorConfiguration</span>.<span class="title">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>另一种选择是使用@Import注释，因此Spring使来自一个配置文件的pojo在另一个配置文件中可用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.SequenceGenerator;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.PrefixGenerator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="meta">@Import</span>(PrefixConfiguration<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SequenceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"#&#123;datePrefixGenerator&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> PrefixGenerator prefixGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SequenceGenerator <span class="title">sequenceGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SequenceGenerator sequence= <span class="keyword">new</span> SequenceGenerator();</span><br><span class="line">        sequence.setInitial(<span class="number">100000</span>); sequence.setSuffix(<span class="string">"A"</span>);</span><br><span class="line">        sequence.setPrefixGenerator(prefixGenerator);</span><br><span class="line">        <span class="keyword">return</span> sequence;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sequenceGenerator bean要求您设置一个prefixGenerator bean。但是请注意，Java配置类中没有定义前缀生成器bean。prefixGenerator bean在一个名为PrefixConfiguration的单独Java配置类中定义。使用@Import(PrefixConfiguration.class)注释，Spring将Java配置类中的所有pojo都带到当前配置类的范围中。在作用域中使用来自PrefixConfiguration的pojo，您可以使用@Value注释和SpEL将名为datePrefixGenerator的bean注入到prefixGenerator字段中。注入bean之后，可以使用它为sequenceGenerator bean设置一个prefixGenerator bean。</p>
<h1 id="使用-Resource和-Inject注解来连接POJOs"><a href="#使用-Resource和-Inject注解来连接POJOs" class="headerlink" title="使用@Resource和@Inject注解来连接POJOs"></a>使用@Resource和@Inject注解来连接POJOs</h1><p>问题</p>
<p>您希望使用Java标准@Resource和@Inject注解来通过自动连接引用pojo，而不是使用特定于spring的@Autowired注解。</p>
<p>解决方案</p>
<p>JSR-250，或Java平台的通用注释，定义了@Resource注释，以名称自动连接POJO引用。JSR-330，或用于注入的标准注解，定义了@Inject注解，按类型来连接POJO引用。</p>
<p>它是如何工作的</p>
<p>前面的菜谱中描述的@Autowired注释属于Spring框架，具体到org.springframework.beans.factory。注释包。这意味着它只能在Spring框架的上下文中使用。<br>在Spring添加了对@Autowired注释的支持之后，Java语言标准化了各种注释，以实现@Autowired注释的相同目的。这些注释是@Resource，属于javax。注释包和@Inject，属于javax.inject package。</p>
<h2 id="使用-Resource注释自动连接POJOs"><a href="#使用-Resource注释自动连接POJOs" class="headerlink" title="使用@Resource注释自动连接POJOs"></a>使用@Resource注释自动连接POJOs</h2><p>默认情况下，@Resource注释的工作方式类似于Spring的@Autowired注释，并尝试通过类型来自动连接。例如，下面的POJO属性被修饰为@Resource注释，因此Spring尝试定位匹配PrefixGenerator类型的POJO。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PrefixGenerator prefixGenerator;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，与@Autowired注释不同，它需要@Qualifier注释来按名称自动连接POJO，如果存在多个相同类型的POJO类型，则可以消除@Resource歧义。本质上，@Resource注释提供了与将@Autowired注释和@Qualifier注释放在一起相同的功能。</p>
<h2 id="使用-Inject注释的Autowire-POJOs"><a href="#使用-Inject注释的Autowire-POJOs" class="headerlink" title="使用@Inject注释的Autowire POJOs"></a>使用@Inject注释的Autowire POJOs</h2><p>另外，@Inject注释尝试按类型自动连接，比如@Resource和@Autowired注释。例如，下面的POJO属性被修饰为@Inject注释，因此Spring尝试定位与PrefixGenerator类型匹配的POJO:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">private</span> PrefixGenerator prefixGenerator;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，就像@Resource和@Autowired注解一样，如果存在多个相同类型的POJO类型，则必须使用不同的方法来匹配POJO的名称或避免歧义。使用@Inject注释进行名称自动连接的第一步是创建自定义注释，以标识POJO注入类和POJO注入点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> javax.inject.Qualifier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.FIELD, ElementType.PARAMETER&#125;)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DatePrefixAnnotation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，自定义注释使用了@Qualifier注释。这个注释与Spring的@Qualifier注释使用的注释不同，因为最后一个类与@Inject注释属于同一个Java包。(javax.inject)。</p>
<p>一旦完成了自定义注释，就需要装饰生成bean实例的POJO注入类，在本例中是DatePrefixGenerator类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line">...</span><br><span class="line"><span class="meta">@DatePrefixAnnotation</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatePrefixGenerator</span> <span class="keyword">implements</span> <span class="title">PrefixGenerator</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，POJO属性或注入点使用相同的自定义注释来限定POJO并消除任何歧义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span> <span class="meta">@DataPrefixAnnotation</span></span><br><span class="line">    <span class="keyword">private</span> PrefixGenerator prefixGenerator;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正如您在菜谱2-3和2-4中看到的，@Autowired、@Resource和@Inject这三个注解可以实现相同的结果。@Autowired注释是基于spring的解决方案，而@Resource和@Inject注释是Java标准(即:JSR)解决方案。如果要进行基于名称的自动连接，@Resource注释提供了最简单的语法。对于按类类型自动连接，这三个注释都很容易使用，因为这三个注释都需要一个注释。</p>
<h1 id="使用-Scope注释设置POJO的范围"><a href="#使用-Scope注释设置POJO的范围" class="headerlink" title="使用@Scope注释设置POJO的范围"></a>使用@Scope注释设置POJO的范围</h1><p>问题</p>
<p>当您使用像@Component这样的注释声明POJO实例时，您实际上是在为bean创建定义一个模板，而不是一个实际的bean实例。当getBean()方法请求bean或从其他bean引用时，Spring根据bean作用域决定应该返回哪个bean实例。有时，您必须为bean设置适当的范围，而不是默认的范围。</p>
<p>解决方案</p>
<p>使用@Scope注释设置bean的范围。默认情况下，Spring为IoC容器中声明的每个bean创建一个实例，这个实例在整个IoC容器的范围内共享。对于所有后续的getBean()调用和bean引用，将返回这个惟一的bean实例。这个范围称为singleton，它是所有bean的默认范围。表2-1列出了Spring中所有有效的bean作用域。</p>
<table>
<thead>
<tr>
<th>Scope</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>singleton</td>
<td>每个Spring IoC容器创建一个bean实例</td>
</tr>
<tr>
<td>prototype</td>
<td>每次请求时创建一个新的bean实例</td>
</tr>
<tr>
<td>request</td>
<td>每个HTTP请求创建一个bean实例;仅在web应用程序的上下文中有效</td>
</tr>
<tr>
<td>session</td>
<td>每个HTTP会话创建一个单独的bean实例;仅在web应用程序的上下文中有效</td>
</tr>
<tr>
<td>globalSession</td>
<td>每个全局HTTP会话创建一个bean实例;仅在门户应用程序的上下文中有效</td>
</tr>
</tbody>
</table>
<p>它是如何工作的</p>
<p>为了演示bean作用域的概念，让我们考虑购物应用程序中的购物车示例。<br>首先，创建ShoppingCart类如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShoppingCart</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Product&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(Product item)</span> </span>&#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，在Java配置文件中声明一些产品bean，以便稍后将它们添加到购物车中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Battery;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Disc;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Product;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.apress.springrecipes.shop"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">aaa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Battery p1 = <span class="keyword">new</span> Battery();</span><br><span class="line">        p1.setName(<span class="string">"AAA"</span>);</span><br><span class="line">        p1.setPrice(<span class="number">2.5</span>);</span><br><span class="line">        p1.setRechargeable(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> p1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">cdrw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Disc p2 = <span class="keyword">new</span> Disc(<span class="string">"CD-RW"</span>, <span class="number">1.5</span>);</span><br><span class="line">        p2.setCapacity(<span class="number">700</span>);</span><br><span class="line">        <span class="keyword">return</span> p2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">dvdrw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Disc p2 = <span class="keyword">new</span> Disc(<span class="string">"DVD-RW"</span>, <span class="number">3.0</span>);</span><br><span class="line">        p2.setCapacity(<span class="number">700</span>);</span><br><span class="line">        <span class="keyword">return</span> p2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦您这样做了，您就可以通过添加一些产品来定义一个主类来测试购物车。假设有两个客户同时在您的商店中导航。第一个通过getBean()方法获得购物车并向其中添加两个产品。然后，第二个客户还通过getBean()方法获得一个购物车，并向其中添加另一个产品。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.config.ShopConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ApplicationContext context =</span><br><span class="line">            <span class="keyword">new</span> AnnotationConfigApplicationContext(ShopConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Product aaa = context.getBean(<span class="string">"aaa"</span>, Product<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Product cdrw = context.getBean(<span class="string">"cdrw"</span>, Product<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Product dvdrw = context.getBean(<span class="string">"dvdrw"</span>, Product<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        ShoppingCart cart1 = context.getBean(<span class="string">"shoppingCart"</span>, ShoppingCart<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        cart1.addItem(aaa);</span><br><span class="line">        cart1.addItem(cdrw);</span><br><span class="line">        System.out.println(<span class="string">"Shopping cart 1 contains "</span> + cart1.getItems());</span><br><span class="line">        ShoppingCart cart2 = context.getBean(<span class="string">"shoppingCart"</span>, ShoppingCart<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        cart2.addItem(dvdrw);</span><br><span class="line">        System.out.println(<span class="string">"Shopping cart 2 contains "</span> + cart2.getItems());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于前面的bean声明，您可以看到两个客户获得了相同的购物车实例。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Shopping cart 1 contains [AAA 2.5, CD-RW 1.5]</span><br><span class="line">Shopping cart 2 contains [AAA 2.5, CD-RW 1.5, DVD-RW 3.0]</span><br></pre></td></tr></table></figure>
<p>这是因为Spring的默认bean作用域是单例的，这意味着Spring每个IoC容器只创建一个购物车实例。<br>在您的shop应用程序中，当调用getBean()方法时，您希望每个客户获得不同的购物车实例。为了确保这种行为，需要将shoppingCart bean的范围设置为prototype。然后Spring为每个getBean()方法调用创建一个新的bean实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShoppingCart</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>现在，如果您再次运行Main类，您可以看到两个客户获得不同的购物车实例。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Shopping cart 1 contains [AAA 2.5, CD-RW 1.5]</span><br><span class="line">Shopping cart 2 contains [DVD-RW 3.0]</span><br></pre></td></tr></table></figure>
<h1 id="使用来自外部资源的数据-文本文件、XML文件、属性文件或图像文件"><a href="#使用来自外部资源的数据-文本文件、XML文件、属性文件或图像文件" class="headerlink" title="使用来自外部资源的数据(文本文件、XML文件、属性文件或图像文件)"></a>使用来自外部资源的数据(文本文件、XML文件、属性文件或图像文件)</h1><p>问题</p>
<p>有时应用程序需要从不同的位置(例如文件系统、类路径或URL)读取外部资源(例如，文本文件、XML文件、属性文件或图像文件)。通常，您必须处理从不同位置加载资源的不同api。</p>
<p>解决方案</p>
<p>Spring提供了@PropertySource注释作为加载.properties文件内容的工具(例如，键-值对)来设置bean属性。<br>Spring还有一个资源加载器机制，该机制提供一个统一的资源接口，用于通过资源路径检索任何类型的外部资源。可以为该路径指定不同的前缀，以便使用@Value注释从不同位置加载资源。要从文件系统加载资源，可以使用文件前缀。要从类路径中加载资源，可以使用类路径前缀。还可以在资源路径中指定URL。</p>
<p>它是如何工作的</p>
<p>读取属性文件的内容(例如要设置bean属性，可以使用带有PropertySourcesPlaceholderConfigurer的Spring的@PropertySource注释。如果希望读取任何文件的内容，可以使用用@Value注释修饰的Spring的资源机制。</p>
<h2 id="使用属性文件数据设置POJO实例化值"><a href="#使用属性文件数据设置POJO实例化值" class="headerlink" title="使用属性文件数据设置POJO实例化值"></a>使用属性文件数据设置POJO实例化值</h2><p>让我们假设您希望在属性文件中访问一系列值来设置bean属性。通常，这可以是数据库的配置属性或由键值组成的其他应用程序值。例如，取存储在名为discounts.properties文件中的下列关键值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">specialcustomer.discount=0.1</span><br><span class="line">summer.discount=0.15</span><br><span class="line">endofyear.discount=0.2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要阅读国际化(i18n)目的的属性文件，请参阅下一个菜谱。<br>提供折扣的内容。属性文件可用于设置其他bean，您可以使用@PropertySource注释将键值转换为Java配置类中的bean。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Battery;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Disc;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.Product;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.PropertySourcesPlaceholderConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="meta">@PropertySource</span>(<span class="string">"classpath:discounts.properties"</span>)</span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.apress.springrecipes.shop"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;endofyear.discount:0&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> specialEndofyearDiscountField;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer</span><br><span class="line">            propertySourcesPlaceholderConfigurer() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">dvdrw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Disc p2 = <span class="keyword">new</span> Disc(<span class="string">"DVD-RW"</span>, <span class="number">3.0</span>, specialEndofyearDiscountField);</span><br><span class="line">        p2.setCapacity(<span class="number">700</span>);</span><br><span class="line">        <span class="keyword">return</span> p2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以定义一个带有类路径值:折扣的@PropertySource注释。属性来修饰Java配置类。类路径:前缀告诉Spring查找折扣。Java类路径中的属性文件。<br>定义了@PropertySource注释以加载属性文件之后，还需要使用@Bean注释定义PropertySourcePlaceholderConfigurer bean。Spring会自动连接@PropertySource折扣。属性文件，使其属性可作为bean属性访问。<br>接下来，您需要定义Java变量，以便从折扣折扣中获取值。属性文件。要使用这些值定义Java变量值，可以使用带有占位符表达式的@Value注释。<br>语法是<code>@Value(&quot;${key:default_value}&quot;)</code>。搜索所有加载的应用程序属性中的键值。如果在属性文件中找到了匹配的键=值，则将相应的值分配给bean属性。如果加载的应用程序属性中没有找到匹配的key=value，那么default_value(即，在${key:)之后分配给bean属性。<br>在用折扣值设置Java变量之后，您可以使用它为bean的折扣属性设置bean实例。<br>如果您希望将属性文件数据用于与设置bean属性不同的目的，那么您应该使用Spring的资源机制，后面将对此进行描述。</p>
<h2 id="在POJO中使用来自任何外部资源文件的数据"><a href="#在POJO中使用来自任何外部资源文件的数据" class="headerlink" title="在POJO中使用来自任何外部资源文件的数据"></a>在POJO中使用来自任何外部资源文件的数据</h2><p>假设您想在应用程序启动时显示一个横幅。banner由以下字符组成，存储在一个名为banner.txt的文本文件中。这个文件可以放在应用程序的类路径中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*************************</span><br><span class="line">*  Welcome to My Shop!  *</span><br><span class="line">*************************</span><br></pre></td></tr></table></figure>
<p>接下来，让我们编写一个BannerLoader POJO类来加载横幅并将其输出到控制台。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BannerLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Resource banner;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBanner</span><span class="params">(Resource banner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.banner = banner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showBanner</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream in = banner.getInputStream();</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            String line = reader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (line == <span class="keyword">null</span>) <span class="keyword">break</span>;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，POJO banner字段是一个Spring资源类型。当创建bean实例时，将通过setter注入填充字段值——稍后进行解释。showBanner()方法调用getInputStream()方法来从资源字段检索输入流。一旦有了InputStream，就可以使用标准的Java文件操作类。在本例中，文件内容是逐行读取的，带有BufferedReader和输出到控制台。</p>
<p>还请注意showBanner()方法使用@PostConstruct注释进行装饰。因为您希望在启动时显示banner，所以使用这个注释告诉Spring在创建后自动调用方法。这保证了showBanner()方法是应用程序运行的第一个方法之一，因此确保了横幅出现在开始。<br>接下来，需要将POJO BannerLoader初始化为实例。此外，还需要注入BannerLoader的banner字段。因此，让我们为这些任务创建一个Java配置类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="meta">@PropertySource</span>(<span class="string">"classpath:discounts.properties"</span>)</span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.apress.springrecipes.shop"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"classpath:banner.txt"</span>)</span><br><span class="line">    <span class="keyword">private</span> Resource banner;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title">propertySourcesPlaceholderConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BannerLoader <span class="title">bannerLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BannerLoader bl = <span class="keyword">new</span> BannerLoader();</span><br><span class="line">        bl.setBanner(banner);</span><br><span class="line">        <span class="keyword">return</span> bl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看如何使用@Value(“classpath:banner.txt”)注释修饰banner属性。这告诉春天去搜索横幅。在类路径中插入txt文件。Spring使用预先注册的属性编辑器ResourceEditor将文件定义转换为资源对象，然后将其注入到bean中。<br>注入banner属性后，通过setter注入将其分配给BannerLoader bean实例。<br>由于banner文件位于Java类路径中，资源路径从classpath: prefix开始。前面的资源路径指定文件系统的相对路径中的资源。也可以指定绝对路径。</p>
<p><code>file:c:/shop/banner.txt</code></p>
<p>当资源位于Java的类路径中时，必须使用类路径前缀。如果没有显示路径信息，它将从类路径的根加载。</p>
<p><code>classpath:banner.txt</code></p>
<p>如果资源位于特定的包中，您可以指定来自类路径根的绝对路径。</p>
<p><code>classpath:com/apress/springrecipes/shop/banner.txt</code></p>
<p>除了支持从文件系统路径或类路径加载外，还可以通过指定URL来加载资源。</p>
<p><code>http://springrecipes.apress.com/shop/banner.txt</code></p>
<p>由于bean类在showBanner()方法上使用@PostConstruct注释，所以banner在IoC容器建立时被发送到输出。正因为如此，没有必要去修补应用程序的上下文或显式调用bean来输出横幅。然而，有时需要访问外部资源来与应用程序的上下文进行交互。现在，假设您希望在应用程序的末尾显示一个图例。图例包含了折扣中先前描述的折扣。属性文件。要访问属性文件的内容，还可以利用Spring的资源机制。<br>接下来，让我们使用Spring的资源机制，但这一次是直接在应用程序的主类中，在应用程序完成时输出一个图例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PropertiesLoaderUtils;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">"discounts.properties"</span>);</span><br><span class="line">        Properties props = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">        System.out.println(<span class="string">"And don't forget our discounts!"</span>);</span><br><span class="line">        System.out.println(props);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring的ClassPathResource类用于访问<code>discounts.properties</code>文件，该文件将文件的内容转换为资源对象。接下来，资源对象被处理成具有Spring的PropertiesLoaderUtils类的属性对象。最后，属性对象的内容作为应用程序的最终输出发送到控制台。<br>因为图例文件(即在Java类路径中，资源通过Spring的ClassPathResource类来访问。如果外部资源位于文件系统路径中，则资源将被加载到Spring的文件系统资源中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Resource resource = <span class="keyword">new</span> FileSystemResource(<span class="string">"c:/shop/banner.txt"</span>)</span><br></pre></td></tr></table></figure>
<p>如果外部资源位于URL中，则资源将被加载到Spring的UrlResource中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Resource resource = <span class="keyword">new</span> UrlResource(<span class="string">"http://www.apress.com/"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="解析属性文件中不同地区的I18N文本消息"><a href="#解析属性文件中不同地区的I18N文本消息" class="headerlink" title="解析属性文件中不同地区的I18N文本消息"></a>解析属性文件中不同地区的I18N文本消息</h1><p>问题</p>
<p>您希望应用程序通过注释支持国际化。</p>
<p>解决方案</p>
<p>MessageSource是一个接口，定义了用于解析资源包中的消息的几种方法。ResourceBundleMessageSource是最常见的MessageSource实现，它从不同的地区解决来自资源包的消息。在实现ResourceBundleMessageSource POJO之后，您可以在Java配置文件中使用@Bean注释，以使应用程序中的i18n数据可用。</p>
<p>它是如何工作的</p>
<p>例如，在美国为英语创建一个名为<code>messages_en_US.properties</code>的资源包。资源包是从类路径的根加载的，所以要确保它在Java类路径中可用。在文件中放置以下键值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alert.checkout=A shopping cart has been checked out.</span><br><span class="line">alert.inventory.checkout=A shopping cart with &#123;0&#125; has been checked out at &#123;1&#125;.</span><br></pre></td></tr></table></figure>
<p>为了解析资源包中的消息，让我们使用<code>ReloadableResourceBundleMessageSource</code> bean的实例创建一个Java配置文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ReloadableResourceBundleMessageSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ReloadableResourceBundleMessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ReloadableResourceBundleMessageSource messageSource = <span class="keyword">new</span> ReloadableResourceBundleMessageSource();</span><br><span class="line">        messageSource.setBasenames(<span class="string">"classpath:messages"</span>);</span><br><span class="line">        messageSource.setCacheSeconds(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> messageSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>bean实例必须有应用程序上下文的名称messageSource来检测它。<br>在bean定义中，您通过setBasenames方法声明一个字符串列表，以便为ResourceBundleMessageSource定位bundle。在这种情况下，您只需指定默认约定来查找位于以消息开头的Java类路径中的文件。此外，setCacheSeconds方法将缓存设置为1秒，以避免读取过时的消息。注意，刷新尝试在重新加载属性文件之前首先检查属性文件的最后修改时间戳，因此如果文件没有更改，则可以将setCacheSeconds间隔设置得相当低，因为刷新尝试实际上并没有重新加载。<br>对于这个MessageSource定义，如果您查找美国语言环境的文本消息(其首选语言是英语)，则查找messages_en_US资源包。属性被认为是第一个。如果没有这样的资源束，或者无法找到消息，那么messages_en。考虑与语言匹配的属性文件。如果仍然找不到资源包，则默认消息。属性<br>选择所有地区。有关资源包加载的更多信息，可以参考<code>java.util.ResourceBundle</code>类的Javadoc。<br>接下来，您可以配置应用程序上下文来使用getMessage()方法解析消息。第一个参数是消息对应的键，第三个参数是目标语言环境。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.shop.config.ShopConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ApplicationContext context =</span><br><span class="line">        <span class="keyword">new</span> AnnotationConfigApplicationContext(ShopConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        String alert = context.getMessage(<span class="string">"alert.checkout"</span>, <span class="keyword">null</span>, Locale.US);</span><br><span class="line">        String alert_inventory = context.getMessage(<span class="string">"alert.inventory.checkout"</span>, <span class="keyword">new</span> Object[] &#123;<span class="string">"[DVD-RW 3.0]"</span>, <span class="keyword">new</span> Date()&#125;, Locale.US);</span><br><span class="line">        System.out.println(<span class="string">"The I18N message for alert.checkout is: "</span> + alert);</span><br><span class="line">        System.out.println(<span class="string">"The I18N message for alert.inventory.checkout is: "</span> + alert_inventory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getMessage()方法的第二个参数是消息参数数组。在第一个字符串语句中，值为null，在第二个字符串语句中，使用一个对象数组来填充消息参数。<br>在Main类中，可以解析文本消息，因为可以直接访问应用程序上下文。但是要让bean解析文本消息，您必须将MessageSource实现注入到需要解析文本消息的bean中。让我们为购物应用程序实现一个出纳员类，它演示了如何解析消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cashier</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessageSource</span><span class="params">(MessageSource messageSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.messageSource = messageSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(ShoppingCart cart)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String alert = messageSource.getMessage(<span class="string">"alert.inventory.checkout"</span>,</span><br><span class="line">            <span class="keyword">new</span> Object[] &#123; cart.getItems(), <span class="keyword">new</span> Date() &#125;, Locale.US);</span><br><span class="line">        System.out.println(alert);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，POJO messageSource字段是Spring messageSource类型。字段值用@Autowired注释修饰，因此在创建bean实例时通过注入填充。然后，checkout方法可以访问messageSource字段，该字段允许bean访问getMessage方法，以便基于i18n标准访问文本消息。</p>
<h1 id="使用注释定制POJO初始化和销毁"><a href="#使用注释定制POJO初始化和销毁" class="headerlink" title="使用注释定制POJO初始化和销毁"></a>使用注释定制POJO初始化和销毁</h1><p>问题</p>
<p>有些pojo在使用前必须执行某些类型的初始化任务。这些任务可以包括打开文件、打开网络/数据库连接、分配内存等。此外，这些pojo必须在生命周期结束时执行相应的销毁任务。因此，有时需要在Spring IoC容器中定制bean的初始化和销毁。</p>
<p>解决方案</p>
<p>Spring可以通过在Java配置类中设置@Bean定义的initMethod和驱逐舰方法属性来识别初始化和销毁回调方法。或者，如果POJO方法分别用@PostConstruct和@PreDestroy注解修饰，Spring也可以识别初始化和销毁回调方法。Spring还可以使用@Lazy注释将bean的创建延迟到需要的时候(一个称为惰性初始化的过程)。Spring还可以使用@DependsOn注释确保某些bean的初始化。</p>
<p>它是如何工作的</p>
<p>定义在使用@Bean初始化和销毁POJO之前要运行的方法。让我们以购物应用程序为例，考虑一个涉及checkout函数的示例。让我们修改出纳员类，将购物车的产品和结帐时间记录到文本文件中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cashier</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">    <span class="keyword">private</span> BufferedWriter writer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.path = path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File targetDir = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (!targetDir.exists()) &#123;</span><br><span class="line">            targetDir.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        File checkoutFile = <span class="keyword">new</span> File(path, fileName + <span class="string">".txt"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!checkoutFile.exists()) &#123;</span><br><span class="line">            checkoutFile.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line">        writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter( <span class="keyword">new</span> FileOutputStream(checkoutFile, <span class="keyword">true</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(ShoppingCart cart)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        writer.write(<span class="keyword">new</span> Date() + <span class="string">"\t"</span> + cart.getItems() + <span class="string">"\r\n"</span>); writer.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在出纳员类中，openFile()方法首先验证要写入数据的目标目录和文件是否存在。然后在指定的系统路径中打开文本文件并将其分配给writer字段。然后每次调用checkout()方法时，将日期和购物车项目附加到文本文件中。最后，closeFile()方法关闭文件，释放其系统资源。<br>接下来，让我们研究如何在Java config类中设置这个bean定义，以便在创建bean之前执行openFile()方法，在销毁bean之前执行closeFile()方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"openFile"</span>, destroyMethod = <span class="string">"closeFile"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cashier <span class="title">cashier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String path = System.getProperty(<span class="string">"java.io.tmpdir"</span>) + <span class="string">"/cashier"</span>;</span><br><span class="line">        Cashier c1 = <span class="keyword">new</span> Cashier();</span><br><span class="line">        c1.setFileName(<span class="string">"checkout"</span>);</span><br><span class="line">        c1.setPath(path);</span><br><span class="line">        <span class="keyword">return</span> c1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，POJO的初始化和销毁任务是使用@Bean注释的initMethod和驱逐舰方法属性定义的。通过在bean声明中设置这两个属性，当创建出纳类时，它首先触发openFile()方法，验证目标目录和文件是否存在，以及打开文件以添加记录。当bean被销毁时，它触发closeFile()方法，确保关闭文件引用以释放系统资源。</p>
<h2 id="定义使用-PostConstruct和-PreDestroy在POJO初始化和销毁之前运行的方法"><a href="#定义使用-PostConstruct和-PreDestroy在POJO初始化和销毁之前运行的方法" class="headerlink" title="定义使用@PostConstruct和@PreDestroy在POJO初始化和销毁之前运行的方法"></a>定义使用@PostConstruct和@PreDestroy在POJO初始化和销毁之前运行的方法</h2><p>如果在Java配置类之外定义POJO实例(例如，使用@Component注释)，另一种替代方法是直接在POJO类中使用@PostConstruct和@PreDestroy注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cashier</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"checkout"</span>)</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"c:/Windows/Temp/cashier"</span>)</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">    <span class="keyword">private</span> BufferedWriter writer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.path = path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File targetDir = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (!targetDir.exists()) &#123;</span><br><span class="line">            targetDir.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        File checkoutFile = <span class="keyword">new</span> File(path, fileName + <span class="string">".txt"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!checkoutFile.exists()) &#123;</span><br><span class="line">            checkoutFile.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line">        writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter( <span class="keyword">new</span> FileOutputStream(checkoutFile, <span class="keyword">true</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkout</span><span class="params">(ShoppingCart cart)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        writer.write(<span class="keyword">new</span> Date() + <span class="string">"\t"</span> +cart.getItems() + <span class="string">"\r\n"</span>); writer.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Component注释告诉Spring管理POJO，就像在以前的菜谱中使用的那样。POJO字段的两个值用@Value注释设置，在之前的菜谱中也讨论了这个概念。openFile()方法由@PostConstruct注释修饰，该注释告诉Spring在构造bean之后立即执行该方法。closeFile()方法被修饰为@PreDestroy注释，它告诉Spring在销毁bean之前执行这个方法。</p>
<h2 id="使用-Lazy为pojo定义延迟初始化"><a href="#使用-Lazy为pojo定义延迟初始化" class="headerlink" title="使用@Lazy为pojo定义延迟初始化"></a>使用@Lazy为pojo定义延迟初始化</h2><p>默认情况下，Spring对所有pojo执行热切初始化。这意味着pojo在启动时初始化。但是，在某些情况下，可以方便地将POJO初始化过程延迟到需要bean时。延迟初始化称为延迟初始化。<br>延迟初始化有助于限制启动时的资源消耗峰值，并保存整个系统资源。延迟初始化对于执行重量级操作(例如，网络连接、文件操作)的pojo尤其相关。要使用惰性初始化标记bean，您可以使用@Lazy注释来修饰bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.shop;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span> <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShoppingCart</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Product&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(Product item)</span> </span>&#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在前面的声明中，由于POJO被@Lazy注释修饰，如果应用程序从不需要POJO或被另一个POJO引用，它就不会实例化。</p>
<h2 id="在使用-DependsOn的其他pojo之前定义pojo的初始化"><a href="#在使用-DependsOn的其他pojo之前定义pojo的初始化" class="headerlink" title="在使用@DependsOn的其他pojo之前定义pojo的初始化"></a>在使用@DependsOn的其他pojo之前定义pojo的初始化</h2><p>作为应用程序的POJO增长，POJO初始化的数量也是如此。如果pojo相互引用，并且分布在不同的Java配置类中，则可以创建竞争条件。如果bean C需要bean B和bean F的逻辑，会发生什么呢?如果首先检测到bean C，而Spring没有初始化bean B和bean F，您将会得到一个很难检测到的错误。为了确保在其他pojo之前对某些pojo进行初始化，并在初始化过程失败时获得更具描述性的错误，Spring提供了@DependsOn注释。@DependsOn注释确保给定的bean在另一个bean之前被初始化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apress.springrecipes.sequence.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.DependsOn;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.DatePrefixGenerator;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.NumberPrefixGenerator;</span><br><span class="line"><span class="keyword">import</span> com.apress.springrecipes.sequence.SequenceGenerator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@DependsOn</span>(<span class="string">"datePrefixGenerator"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SequenceGenerator <span class="title">sequenceGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SequenceGenerator sequence= <span class="keyword">new</span> SequenceGenerator();</span><br><span class="line">        sequence.setInitial(<span class="number">100000</span>);</span><br><span class="line">        sequence.setSuffix(<span class="string">"A"</span>);</span><br><span class="line">        <span class="keyword">return</span> sequence;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="创建Post-Processors以验证和修改POJOs"><a href="#创建Post-Processors以验证和修改POJOs" class="headerlink" title="创建Post-Processors以验证和修改POJOs"></a>创建Post-Processors以验证和修改POJOs</h1><p>问题</p>
<p>您希望在构建期间将任务应用到所有bean实例或特定类型的实例，以根据特定的标准验证或修改bean属性。</p>
<p>解决方案</p>
<p>bean后处理器允许在初始化回调方法之前和之后进行bean处理<br>(i.e. 分配给@Bean注释的initMethod属性或用@PostConstruct注释修饰的方法的属性)。bean后处理器的主要特性是它处理IoC容器中的所有bean实例，而不只是单个bean实例。通常，bean后处理器用于检查bean属性的有效性，根据特定的标准修改bean属性，或者将某些任务应用到所有bean实例。<br>Spring还支持@Required注释，它由内置的Spring post-processor RequiredAnnotationBeanPostProcessor支持。RequiredAnnotationBeanPostProcessor bean事后处理器检查是否设置了所有带有@Required注释的bean属性。</p>
<p>它是如何工作的</p>
<p>假设您希望审计每个bean的创建。您可能希望这样做来调试应用程序、验证每个bean的属性，或者在其他场景中。bean后处理器是实现这个特性的理想选择，因为您不必修改任何现有的POJO代码。</p>
<h2 id="创建POJO来处理每个Bean实例"><a href="#创建POJO来处理每个Bean实例" class="headerlink" title="创建POJO来处理每个Bean实例"></a>创建POJO来处理每个Bean实例</h2><h1 id="使用工厂-静态方法、实例方法、Spring的FactoryBean-创建POJOs"><a href="#使用工厂-静态方法、实例方法、Spring的FactoryBean-创建POJOs" class="headerlink" title="使用工厂(静态方法、实例方法、Spring的FactoryBean)创建POJOs"></a>使用工厂(静态方法、实例方法、Spring的FactoryBean)创建POJOs</h1><h1 id="使用Spring环境和Profiles加载不同的POJOs集"><a href="#使用Spring环境和Profiles加载不同的POJOs集" class="headerlink" title="使用Spring环境和Profiles加载不同的POJOs集"></a>使用Spring环境和Profiles加载不同的POJOs集</h1><h1 id="让POJOs了解Spring的IoC容器资源"><a href="#让POJOs了解Spring的IoC容器资源" class="headerlink" title="让POJOs了解Spring的IoC容器资源"></a>让POJOs了解Spring的IoC容器资源</h1><h1 id="使用面向切面的编程和注释"><a href="#使用面向切面的编程和注释" class="headerlink" title="使用面向切面的编程和注释"></a>使用面向切面的编程和注释</h1><h1 id="访问连接点信息"><a href="#访问连接点信息" class="headerlink" title="访问连接点信息"></a>访问连接点信息</h1><h1 id="用-Order注释指定切面的优先级"><a href="#用-Order注释指定切面的优先级" class="headerlink" title="用@Order注释指定切面的优先级"></a>用@Order注释指定切面的优先级</h1><h1 id="重用方面切入点定义"><a href="#重用方面切入点定义" class="headerlink" title="重用方面切入点定义"></a>重用方面切入点定义</h1><h1 id="写AspectJ切入点表达式"><a href="#写AspectJ切入点表达式" class="headerlink" title="写AspectJ切入点表达式"></a>写AspectJ切入点表达式</h1><h1 id="将AOP用于POJOs的介绍"><a href="#将AOP用于POJOs的介绍" class="headerlink" title="将AOP用于POJOs的介绍"></a>将AOP用于POJOs的介绍</h1><h1 id="用AOP向POJOs引入状态"><a href="#用AOP向POJOs引入状态" class="headerlink" title="用AOP向POJOs引入状态"></a>用AOP向POJOs引入状态</h1><h1 id="在Spring使用Load-Time编织AspectJ切面"><a href="#在Spring使用Load-Time编织AspectJ切面" class="headerlink" title="在Spring使用Load-Time编织AspectJ切面"></a>在Spring使用Load-Time编织AspectJ切面</h1><h1 id="在Spring中配置AspectJ切面"><a href="#在Spring中配置AspectJ切面" class="headerlink" title="在Spring中配置AspectJ切面"></a>在Spring中配置AspectJ切面</h1><h1 id="用AOP将POJOs注入域对象"><a href="#用AOP将POJOs注入域对象" class="headerlink" title="用AOP将POJOs注入域对象"></a>用AOP将POJOs注入域对象</h1><h1 id="使用Spring和TaskExecutors应用并发"><a href="#使用Spring和TaskExecutors应用并发" class="headerlink" title="使用Spring和TaskExecutors应用并发"></a>使用Spring和TaskExecutors应用并发</h1><h1 id="在POJOs之间通信应用程序事件"><a href="#在POJOs之间通信应用程序事件" class="headerlink" title="在POJOs之间通信应用程序事件"></a>在POJOs之间通信应用程序事件</h1>
      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: '打赏支持', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者:  </strong>段纪刚</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接:  </strong>
          <a href="/2018/07/29/Spring-5-Recipes-2/" target="_blank" title="Spring 核心任务">https://jigangduan.github.io/2018/07/29/Spring-5-Recipes-2/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明:   </strong>
            本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            许可协议。转载请注明出处
          </li>
         
        </ul>
<div>

      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/08/01/Spring-5-Recipes-3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Spring MVC
        
      </div>
    </a>
  
  
    <a href="/2018/07/29/Spring-5-Recipes-1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Spring 5 开发工具</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Java配置来配置POJOs"><span class="nav-number">1.</span> <span class="nav-text">使用Java配置来配置POJOs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#问题"><span class="nav-number">1.1.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解决方案"><span class="nav-number">1.2.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#它是如何工作的"><span class="nav-number">1.3.</span> <span class="nav-text">它是如何工作的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Configuration和-Bean创建一个Java配置来创建POJOs"><span class="nav-number">1.4.</span> <span class="nav-text">使用@Configuration和@Bean创建一个Java配置来创建POJOs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例化Spring-IoC容器以扫描注释"><span class="nav-number">1.5.</span> <span class="nav-text">实例化Spring IoC容器以扫描注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从IoC容器获取POJO实例或bean"><span class="nav-number">1.6.</span> <span class="nav-text">从IoC容器获取POJO实例或bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Component注释创建POJO类，以使用DAO创建Beans"><span class="nav-number">1.7.</span> <span class="nav-text">使用@Component注释创建POJO类，以使用DAO创建Beans</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用过滤器实例化Spring-IoC容器，以扫描注释"><span class="nav-number">1.8.</span> <span class="nav-text">用过滤器实例化Spring IoC容器，以扫描注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从IoC容器获取POJO实例或bean-1"><span class="nav-number">1.9.</span> <span class="nav-text">从IoC容器获取POJO实例或bean</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#通过调用构造函数创建POJOs"><span class="nav-number">2.</span> <span class="nav-text">通过调用构造函数创建POJOs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用构造函数创建POJO类"><span class="nav-number">2.1.</span> <span class="nav-text">使用构造函数创建POJO类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为POJO创建一个Java配置"><span class="nav-number">2.2.</span> <span class="nav-text">为POJO创建一个Java配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用POJO引用和自动连接与其他POJO交互"><span class="nav-number">3.</span> <span class="nav-text">使用POJO引用和自动连接与其他POJO交互</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#在Java配置类中引用POJOs"><span class="nav-number">3.1.</span> <span class="nav-text">在Java配置类中引用POJOs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Autowired注释自动连接POJO字段"><span class="nav-number">3.2.</span> <span class="nav-text">使用@Autowired注释自动连接POJO字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Autowired注解的Autowire-POJO方法和构造函数，并可选择自动配线"><span class="nav-number">3.3.</span> <span class="nav-text">使用@Autowired注解的Autowire POJO方法和构造函数，并可选择自动配线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用注释解决自动连接的模糊性"><span class="nav-number">3.4.</span> <span class="nav-text">用注释解决自动连接的模糊性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用-Primary注释解决自动连接的歧义"><span class="nav-number">3.4.1.</span> <span class="nav-text">用@Primary注释解决自动连接的歧义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用-Qualifier注解解决自动连接的歧义"><span class="nav-number">3.4.2.</span> <span class="nav-text">用@Qualifier注解解决自动连接的歧义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解析来自多个位置的POJO引用"><span class="nav-number">3.5.</span> <span class="nav-text">解析来自多个位置的POJO引用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-Resource和-Inject注解来连接POJOs"><span class="nav-number">4.</span> <span class="nav-text">使用@Resource和@Inject注解来连接POJOs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Resource注释自动连接POJOs"><span class="nav-number">4.1.</span> <span class="nav-text">使用@Resource注释自动连接POJOs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Inject注释的Autowire-POJOs"><span class="nav-number">4.2.</span> <span class="nav-text">使用@Inject注释的Autowire POJOs</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-Scope注释设置POJO的范围"><span class="nav-number">5.</span> <span class="nav-text">使用@Scope注释设置POJO的范围</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用来自外部资源的数据-文本文件、XML文件、属性文件或图像文件"><span class="nav-number">6.</span> <span class="nav-text">使用来自外部资源的数据(文本文件、XML文件、属性文件或图像文件)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用属性文件数据设置POJO实例化值"><span class="nav-number">6.1.</span> <span class="nav-text">使用属性文件数据设置POJO实例化值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在POJO中使用来自任何外部资源文件的数据"><span class="nav-number">6.2.</span> <span class="nav-text">在POJO中使用来自任何外部资源文件的数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#解析属性文件中不同地区的I18N文本消息"><span class="nav-number">7.</span> <span class="nav-text">解析属性文件中不同地区的I18N文本消息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用注释定制POJO初始化和销毁"><span class="nav-number">8.</span> <span class="nav-text">使用注释定制POJO初始化和销毁</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#定义使用-PostConstruct和-PreDestroy在POJO初始化和销毁之前运行的方法"><span class="nav-number">8.1.</span> <span class="nav-text">定义使用@PostConstruct和@PreDestroy在POJO初始化和销毁之前运行的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Lazy为pojo定义延迟初始化"><span class="nav-number">8.2.</span> <span class="nav-text">使用@Lazy为pojo定义延迟初始化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在使用-DependsOn的其他pojo之前定义pojo的初始化"><span class="nav-number">8.3.</span> <span class="nav-text">在使用@DependsOn的其他pojo之前定义pojo的初始化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建Post-Processors以验证和修改POJOs"><span class="nav-number">9.</span> <span class="nav-text">创建Post-Processors以验证和修改POJOs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建POJO来处理每个Bean实例"><span class="nav-number">9.1.</span> <span class="nav-text">创建POJO来处理每个Bean实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用工厂-静态方法、实例方法、Spring的FactoryBean-创建POJOs"><span class="nav-number">10.</span> <span class="nav-text">使用工厂(静态方法、实例方法、Spring的FactoryBean)创建POJOs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Spring环境和Profiles加载不同的POJOs集"><span class="nav-number">11.</span> <span class="nav-text">使用Spring环境和Profiles加载不同的POJOs集</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#让POJOs了解Spring的IoC容器资源"><span class="nav-number">12.</span> <span class="nav-text">让POJOs了解Spring的IoC容器资源</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用面向切面的编程和注释"><span class="nav-number">13.</span> <span class="nav-text">使用面向切面的编程和注释</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#访问连接点信息"><span class="nav-number">14.</span> <span class="nav-text">访问连接点信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用-Order注释指定切面的优先级"><span class="nav-number">15.</span> <span class="nav-text">用@Order注释指定切面的优先级</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#重用方面切入点定义"><span class="nav-number">16.</span> <span class="nav-text">重用方面切入点定义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#写AspectJ切入点表达式"><span class="nav-number">17.</span> <span class="nav-text">写AspectJ切入点表达式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#将AOP用于POJOs的介绍"><span class="nav-number">18.</span> <span class="nav-text">将AOP用于POJOs的介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用AOP向POJOs引入状态"><span class="nav-number">19.</span> <span class="nav-text">用AOP向POJOs引入状态</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在Spring使用Load-Time编织AspectJ切面"><span class="nav-number">20.</span> <span class="nav-text">在Spring使用Load-Time编织AspectJ切面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在Spring中配置AspectJ切面"><span class="nav-number">21.</span> <span class="nav-text">在Spring中配置AspectJ切面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用AOP将POJOs注入域对象"><span class="nav-number">22.</span> <span class="nav-text">用AOP将POJOs注入域对象</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Spring和TaskExecutors应用并发"><span class="nav-number">23.</span> <span class="nav-text">使用Spring和TaskExecutors应用并发</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在POJOs之间通信应用程序事件"><span class="nav-number">24.</span> <span class="nav-text">在POJOs之间通信应用程序事件</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2020 朝着牛逼的道路一路狂奔 All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            朝着牛逼的道路一路狂奔
          </div>
          <div class="panel-body">
            Copyright © 2020 段纪刚 All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>